!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VePlayer=t()}(this,(function(){"use strict";function ownKeys$l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$7(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$l(Object(r),!0).forEach((function(t){_defineProperty$9(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _regeneratorRuntime$5(){_regeneratorRuntime$5=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(C){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i,a,o,s,u=t&&t.prototype instanceof d?t:d,h=Object.create(u.prototype),f=new S(n||[]);return h._invoke=(i=e,a=r,o=f,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return{value:void 0,done:!0}}for(o.method=e,o.arg=t;;){var r=o.delegate;if(r){var n=b(r,o);if(n){if(n===l)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===s)throw s="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s="executing";var u=c(i,a,o);if("normal"===u.type){if(s=o.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:o.done}}"throw"===u.type&&(s="completed",o.method="throw",o.arg=u.arg)}}),h}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(C){return{type:"throw",arg:C}}}e.wrap=u;var l={};function d(){}function h(){}function f(){}var p={};s(p,i,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(T([])));y&&y!==t&&r.call(y,i)&&(p=y);var m=f.prototype=d.prototype=Object.create(p);function v(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function n(i,a,o,s){var u=c(e[i],e,a);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(d).then((function(e){l.value=e,o(l)}),(function(e){return n("throw",e,o,s)}))}s(u.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function b(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function T(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:w}}function w(){return{value:void 0,done:!0}}return h.prototype=f,s(m,"constructor",f),s(f,"constructor",h),h.displayName=s(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},v(_.prototype),s(_.prototype,a,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new _(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},v(m),s(m,o,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=T,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;E(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function _typeof$7(e){return(_typeof$7="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep$7(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(c){return void r(c)}s.done?t(u):Promise.resolve(u).then(n,i)}function _asyncToGenerator$7(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$7(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$7(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck$8(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$9(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$9(e,t,r){return t&&_defineProperties$9(e.prototype,t),r&&_defineProperties$9(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$9(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$8(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$8(e,t)}function _getPrototypeOf$8(e){return(_getPrototypeOf$8=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$8(e,t){return(_setPrototypeOf$8=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$v(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _construct$4(e,t,r){return(_construct$4=_isNativeReflectConstruct$v()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&_setPrototypeOf$8(i,r.prototype),i}).apply(null,arguments)}function _objectWithoutPropertiesLoose$3(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function _objectWithoutProperties$3(e,t){if(null==e)return{};var r,n,i=_objectWithoutPropertiesLoose$3(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function _assertThisInitialized$8(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$8(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$8(e)}function _createSuper$u(e){var t=_isNativeReflectConstruct$v();return function(){var r,n=_getPrototypeOf$8(e);if(t){var i=_getPrototypeOf$8(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$8(this,r)}}function _superPropBase$2(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf$8(e)););return e}function _get$2(){return _get$2="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=_superPropBase$2(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},_get$2.apply(this,arguments)}function _slicedToArray$2(e,t){return _arrayWithHoles$2(e)||_iterableToArrayLimit$2(e,t)||_unsupportedIterableToArray$8(e,t)||_nonIterableRest$2()}function _toConsumableArray$3(e){return _arrayWithoutHoles$3(e)||_iterableToArray$3(e)||_unsupportedIterableToArray$8(e)||_nonIterableSpread$3()}function _arrayWithoutHoles$3(e){if(Array.isArray(e))return _arrayLikeToArray$8(e)}function _arrayWithHoles$2(e){if(Array.isArray(e))return e}function _iterableToArray$3(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterableToArrayLimit$2(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(u){s=!0,i=u}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}function _unsupportedIterableToArray$8(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$8(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$8(e,t):void 0}}function _arrayLikeToArray$8(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread$3(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest$2(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var freeGlobal="object"==("undefined"==typeof global?"undefined":_typeof$7(global))&&global&&global.Object===Object&&global,freeGlobal$1=freeGlobal,freeSelf="object"==("undefined"==typeof self?"undefined":_typeof$7(self))&&self&&self.Object===Object&&self,root=freeGlobal$1||freeSelf||Function("return this")(),root$1=root,_Symbol$3=root$1.Symbol,_Symbol$4=_Symbol$3,objectProto$f=Object.prototype,hasOwnProperty$f=objectProto$f.hasOwnProperty,nativeObjectToString$1=objectProto$f.toString,symToStringTag$1=_Symbol$4?_Symbol$4.toStringTag:void 0;function getRawTag(t){var r=hasOwnProperty$f.call(t,symToStringTag$1),n=t[symToStringTag$1];try{t[symToStringTag$1]=void 0;var i=!0}catch(e){}var a=nativeObjectToString$1.call(t);return i&&(r?t[symToStringTag$1]=n:delete t[symToStringTag$1]),a}var objectProto$e=Object.prototype,nativeObjectToString=objectProto$e.toString;function objectToString$1(e){return nativeObjectToString.call(e)}var nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=_Symbol$4?_Symbol$4.toStringTag:void 0;function baseGetTag(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString$1(e)}function isObjectLike(e){return null!=e&&"object"==_typeof$7(e)}var symbolTag$3="[object Symbol]";function isSymbol$7(e){return"symbol"==_typeof$7(e)||isObjectLike(e)&&baseGetTag(e)==symbolTag$3}function arrayMap(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}var isArray$9=Array.isArray,isArray$a=isArray$9,INFINITY$2=1/0,symbolProto$2=_Symbol$4?_Symbol$4.prototype:void 0,symbolToString=symbolProto$2?symbolProto$2.toString:void 0;function baseToString(e){if("string"==typeof e)return e;if(isArray$a(e))return arrayMap(e,baseToString)+"";if(isSymbol$7(e))return symbolToString?symbolToString.call(e):"";var t=e+"";return"0"==t&&1/e==-INFINITY$2?"-0":t}var reWhitespace=/\s/;function trimmedEndIndex(e){for(var t=e.length;t--&&reWhitespace.test(e.charAt(t)););return t}var reTrimStart=/^\s+/;function baseTrim(e){return e?e.slice(0,trimmedEndIndex(e)+1).replace(reTrimStart,""):e}function isObject$z(e){var t=_typeof$7(e);return null!=e&&("object"==t||"function"==t)}var NAN=NaN,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;function toNumber$1(e){if("number"==typeof e)return e;if(isSymbol$7(e))return NAN;if(isObject$z(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=isObject$z(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=baseTrim(e);var r=reIsBinary.test(e);return r||reIsOctal.test(e)?freeParseInt(e.slice(2),r?2:8):reIsBadHex.test(e)?NAN:+e}function identity(e){return e}var asyncTag="[object AsyncFunction]",funcTag$2="[object Function]",genTag$1="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction$2(e){if(!isObject$z(e))return!1;var t=baseGetTag(e);return t==funcTag$2||t==genTag$1||t==asyncTag||t==proxyTag}var coreJsData=root$1["__core-js_shared__"],coreJsData$1=coreJsData,maskSrcKey=(uid2=/[^.]+$/.exec(coreJsData$1&&coreJsData$1.keys&&coreJsData$1.keys.IE_PROTO||""),uid2?"Symbol(src)_1."+uid2:""),uid2;function isMasked(e){return!!maskSrcKey&&maskSrcKey in e}var funcProto$1=Function.prototype,funcToString$1=funcProto$1.toString;function toSource(t){if(null!=t){try{return funcToString$1.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto=Function.prototype,objectProto$d=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$e=objectProto$d.hasOwnProperty,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty$e).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative(e){return!(!isObject$z(e)||isMasked(e))&&(isFunction$2(e)?reIsNative:reIsHostCtor).test(toSource(e))}function getValue(e,t){return null==e?void 0:e[t]}function getNative(e,t){var r=getValue(e,t);return baseIsNative(r)?r:void 0}var WeakMap$3=getNative(root$1,"WeakMap"),WeakMap$4=WeakMap$3,objectCreate$2=Object.create,baseCreate=function(){function e(){}return function(t){if(!isObject$z(t))return{};if(objectCreate$2)return objectCreate$2(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),baseCreate$1=baseCreate;function apply$b(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function noop$2(){}function copyArray(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}var HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut(e){var t=0,r=0;return function(){var n=nativeNow(),i=HOT_SPAN-(n-r);if(r=n,i>0){if(++t>=HOT_COUNT)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function constant$2(e){return function(){return e}}var defineProperty$j=function(){try{var t=getNative(Object,"defineProperty");return t({},"",{}),t}catch(e){}}(),defineProperty$k=defineProperty$j,baseSetToString=defineProperty$k?function(e,t){return defineProperty$k(e,"toString",{configurable:!0,enumerable:!1,value:constant$2(t),writable:!0})}:identity,baseSetToString$1=baseSetToString,setToString=shortOut(baseSetToString$1),setToString$1=setToString;function arrayEach(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}function baseFindIndex(e,t,r,n){for(var i=e.length,a=r+(n?1:-1);n?a--:++a<i;)if(t(e[a],a,e))return a;return-1}function baseIsNaN(e){return e!=e}function strictIndexOf(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}function baseIndexOf(e,t,r){return t==t?strictIndexOf(e,t,r):baseFindIndex(e,baseIsNaN,r)}function arrayIncludes$1(e,t){return!!(null==e?0:e.length)&&baseIndexOf(e,t,0)>-1}var MAX_SAFE_INTEGER$4=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex(e,t){var r=_typeof$7(e);return!!(t=null==t?MAX_SAFE_INTEGER$4:t)&&("number"==r||"symbol"!=r&&reIsUint.test(e))&&e>-1&&e%1==0&&e<t}function baseAssignValue(e,t,r){"__proto__"==t&&defineProperty$k?defineProperty$k(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function eq(e,t){return e===t||e!=e&&t!=t}var objectProto$c=Object.prototype,hasOwnProperty$d=objectProto$c.hasOwnProperty;function assignValue(e,t,r){var n=e[t];hasOwnProperty$d.call(e,t)&&eq(n,r)&&(void 0!==r||t in e)||baseAssignValue(e,t,r)}function copyObject(e,t,r,n){var i=!r;r||(r={});for(var a=-1,o=t.length;++a<o;){var s=t[a],u=n?n(r[s],e[s],s,r,e):void 0;void 0===u&&(u=e[s]),i?baseAssignValue(r,s,u):assignValue(r,s,u)}return r}var nativeMax$1=Math.max;function overRest(e,t,r){return t=nativeMax$1(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,a=nativeMax$1(n.length-t,0),o=Array(a);++i<a;)o[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=r(o),apply$b(e,this,s)}}function baseRest(e,t){return setToString$1(overRest(e,t,identity),e+"")}var MAX_SAFE_INTEGER$3=9007199254740991;function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER$3}function isArrayLike(e){return null!=e&&isLength(e.length)&&!isFunction$2(e)}function isIterateeCall(e,t,r){if(!isObject$z(r))return!1;var n=_typeof$7(t);return!!("number"==n?isArrayLike(r)&&isIndex(t,r.length):"string"==n&&t in r)&&eq(r[t],e)}function createAssigner(e){return baseRest((function(t,r){var n=-1,i=r.length,a=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(a=e.length>3&&"function"==typeof a?(i--,a):void 0,o&&isIterateeCall(r[0],r[1],o)&&(a=i<3?void 0:a,i=1),t=Object(t);++n<i;){var s=r[n];s&&e(t,s,n,a)}return t}))}var objectProto$b=Object.prototype;function isPrototype$1(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||objectProto$b)}function baseTimes(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var argsTag$3="[object Arguments]";function baseIsArguments(e){return isObjectLike(e)&&baseGetTag(e)==argsTag$3}var objectProto$a=Object.prototype,hasOwnProperty$c=objectProto$a.hasOwnProperty,propertyIsEnumerable$2=objectProto$a.propertyIsEnumerable,isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike(e)&&hasOwnProperty$c.call(e,"callee")&&!propertyIsEnumerable$2.call(e,"callee")},isArguments$1=isArguments;function stubFalse(){return!1}var freeExports$2="object"==("undefined"==typeof exports?"undefined":_typeof$7(exports))&&exports&&!exports.nodeType&&exports,freeModule$2=freeExports$2&&"object"==("undefined"==typeof module?"undefined":_typeof$7(module))&&module&&!module.nodeType&&module,moduleExports$2=freeModule$2&&freeModule$2.exports===freeExports$2,Buffer$4=moduleExports$2?root$1.Buffer:void 0,nativeIsBuffer=Buffer$4?Buffer$4.isBuffer:void 0,isBuffer=nativeIsBuffer||stubFalse,isBuffer$1=isBuffer,argsTag$2="[object Arguments]",arrayTag$2="[object Array]",boolTag$3="[object Boolean]",dateTag$3="[object Date]",errorTag$2="[object Error]",funcTag$1="[object Function]",mapTag$5="[object Map]",numberTag$3="[object Number]",objectTag$3="[object Object]",regexpTag$3="[object RegExp]",setTag$5="[object Set]",stringTag$3="[object String]",weakMapTag$2="[object WeakMap]",arrayBufferTag$3="[object ArrayBuffer]",dataViewTag$4="[object DataView]",float32Tag$2="[object Float32Array]",float64Tag$2="[object Float64Array]",int8Tag$2="[object Int8Array]",int16Tag$2="[object Int16Array]",int32Tag$2="[object Int32Array]",uint8Tag$2="[object Uint8Array]",uint8ClampedTag$2="[object Uint8ClampedArray]",uint16Tag$2="[object Uint16Array]",uint32Tag$2="[object Uint32Array]",typedArrayTags={};function baseIsTypedArray(e){return isObjectLike(e)&&isLength(e.length)&&!!typedArrayTags[baseGetTag(e)]}function baseUnary(e){return function(t){return e(t)}}typedArrayTags[float32Tag$2]=typedArrayTags[float64Tag$2]=typedArrayTags[int8Tag$2]=typedArrayTags[int16Tag$2]=typedArrayTags[int32Tag$2]=typedArrayTags[uint8Tag$2]=typedArrayTags[uint8ClampedTag$2]=typedArrayTags[uint16Tag$2]=typedArrayTags[uint32Tag$2]=!0,typedArrayTags[argsTag$2]=typedArrayTags[arrayTag$2]=typedArrayTags[arrayBufferTag$3]=typedArrayTags[boolTag$3]=typedArrayTags[dataViewTag$4]=typedArrayTags[dateTag$3]=typedArrayTags[errorTag$2]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag$5]=typedArrayTags[numberTag$3]=typedArrayTags[objectTag$3]=typedArrayTags[regexpTag$3]=typedArrayTags[setTag$5]=typedArrayTags[stringTag$3]=typedArrayTags[weakMapTag$2]=!1;var freeExports$1="object"==("undefined"==typeof exports?"undefined":_typeof$7(exports))&&exports&&!exports.nodeType&&exports,freeModule$1=freeExports$1&&"object"==("undefined"==typeof module?"undefined":_typeof$7(module))&&module&&!module.nodeType&&module,moduleExports$1=freeModule$1&&freeModule$1.exports===freeExports$1,freeProcess=moduleExports$1&&freeGlobal$1.process,nodeUtil=function(){try{var t=freeModule$1&&freeModule$1.require&&freeModule$1.require("util").types;return t||freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}(),nodeUtil$1=nodeUtil,nodeIsTypedArray=nodeUtil$1&&nodeUtil$1.isTypedArray,isTypedArray$2=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray,isTypedArray$3=isTypedArray$2,objectProto$9=Object.prototype,hasOwnProperty$b=objectProto$9.hasOwnProperty;function arrayLikeKeys(e,t){var r=isArray$a(e),n=!r&&isArguments$1(e),i=!r&&!n&&isBuffer$1(e),a=!r&&!n&&!i&&isTypedArray$3(e),o=r||n||i||a,s=o?baseTimes(e.length,String):[],u=s.length;for(var c in e)!t&&!hasOwnProperty$b.call(e,c)||o&&("length"==c||i&&("offset"==c||"parent"==c)||a&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||isIndex(c,u))||s.push(c);return s}function overArg(e,t){return function(r){return e(t(r))}}var nativeKeys$1=overArg(Object.keys,Object),nativeKeys$2=nativeKeys$1,objectProto$8=Object.prototype,hasOwnProperty$a=objectProto$8.hasOwnProperty;function baseKeys(e){if(!isPrototype$1(e))return nativeKeys$2(e);var t=[];for(var r in Object(e))hasOwnProperty$a.call(e,r)&&"constructor"!=r&&t.push(r);return t}function keys$8(e){return isArrayLike(e)?arrayLikeKeys(e):baseKeys(e)}var objectProto$7=Object.prototype,hasOwnProperty$9=objectProto$7.hasOwnProperty,assign$5=createAssigner((function(e,t){if(isPrototype$1(t)||isArrayLike(t))copyObject(t,keys$8(t),e);else for(var r in t)hasOwnProperty$9.call(t,r)&&assignValue(e,r,t[r])})),assign$6=assign$5;function nativeKeysIn(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}var objectProto$6=Object.prototype,hasOwnProperty$8=objectProto$6.hasOwnProperty;function baseKeysIn(e){if(!isObject$z(e))return nativeKeysIn(e);var t=isPrototype$1(e),r=[];for(var n in e)("constructor"!=n||!t&&hasOwnProperty$8.call(e,n))&&r.push(n);return r}function keysIn(e){return isArrayLike(e)?arrayLikeKeys(e,!0):baseKeysIn(e)}var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey(e,t){if(isArray$a(e))return!1;var r=_typeof$7(e);return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!isSymbol$7(e))||(reIsPlainProp.test(e)||!reIsDeepProp.test(e)||null!=t&&e in Object(t))}var nativeCreate=getNative(Object,"create"),nativeCreate$1=nativeCreate;function hashClear(){this.__data__=nativeCreate$1?nativeCreate$1(null):{},this.size=0}function hashDelete(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var HASH_UNDEFINED$2="__lodash_hash_undefined__",objectProto$5=Object.prototype,hasOwnProperty$7=objectProto$5.hasOwnProperty;function hashGet(e){var t=this.__data__;if(nativeCreate$1){var r=t[e];return r===HASH_UNDEFINED$2?void 0:r}return hasOwnProperty$7.call(t,e)?t[e]:void 0}var objectProto$4=Object.prototype,hasOwnProperty$6=objectProto$4.hasOwnProperty;function hashHas(e){var t=this.__data__;return nativeCreate$1?void 0!==t[e]:hasOwnProperty$6.call(t,e)}var HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=nativeCreate$1&&void 0===t?HASH_UNDEFINED$1:t,this}function Hash(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function listCacheClear(){this.__data__=[],this.size=0}function assocIndexOf(e,t){for(var r=e.length;r--;)if(eq(e[r][0],t))return r;return-1}Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet;var arrayProto=Array.prototype,splice$1=arrayProto.splice;function listCacheDelete(e){var t=this.__data__,r=assocIndexOf(t,e);return!(r<0)&&(r==t.length-1?t.pop():splice$1.call(t,r,1),--this.size,!0)}function listCacheGet(e){var t=this.__data__,r=assocIndexOf(t,e);return r<0?void 0:t[r][1]}function listCacheHas(e){return assocIndexOf(this.__data__,e)>-1}function listCacheSet(e,t){var r=this.__data__,n=assocIndexOf(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function ListCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet;var Map$1=getNative(root$1,"Map"),Map$2=Map$1;function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Map$2||ListCache),string:new Hash}}function isKeyable(e){var t=_typeof$7(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function getMapData(e,t){var r=e.__data__;return isKeyable(t)?r["string"==typeof t?"string":"hash"]:r.map}function mapCacheDelete(e){var t=getMapData(this,e).delete(e);return this.size-=t?1:0,t}function mapCacheGet(e){return getMapData(this,e).get(e)}function mapCacheHas(e){return getMapData(this,e).has(e)}function mapCacheSet(e,t){var r=getMapData(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function MapCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet;var FUNC_ERROR_TEXT$2="Expected a function";function memoize(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(FUNC_ERROR_TEXT$2);var r=function r(){var n=arguments,i=t?t.apply(this,n):n[0],a=r.cache;if(a.has(i))return a.get(i);var o=e.apply(this,n);return r.cache=a.set(i,o)||a,o};return r.cache=new(memoize.Cache||MapCache),r}memoize.Cache=MapCache;var MAX_MEMOIZE_SIZE=500;function memoizeCapped(e){var t=memoize(e,(function(e){return r.size===MAX_MEMOIZE_SIZE&&r.clear(),e})),r=t.cache;return t}var rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=memoizeCapped((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(rePropName,(function(e,r,n,i){t.push(n?i.replace(reEscapeChar,"$1"):r||e)})),t})),stringToPath$1=stringToPath;function toString$y(e){return null==e?"":baseToString(e)}function castPath(e,t){return isArray$a(e)?e:isKey(e,t)?[e]:stringToPath$1(toString$y(e))}var INFINITY$1=1/0;function toKey(e){if("string"==typeof e||isSymbol$7(e))return e;var t=e+"";return"0"==t&&1/e==-INFINITY$1?"-0":t}function baseGet(e,t){for(var r=0,n=(t=castPath(t,e)).length;null!=e&&r<n;)e=e[toKey(t[r++])];return r&&r==n?e:void 0}function get$2(e,t,r){var n=null==e?void 0:baseGet(e,t);return void 0===n?r:n}function arrayPush(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}var getPrototype=overArg(Object.getPrototypeOf,Object),getPrototype$1=getPrototype;function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function stackGet(e){return this.__data__.get(e)}function stackHas(e){return this.__data__.has(e)}var LARGE_ARRAY_SIZE$1=200;function stackSet(e,t){var r=this.__data__;if(r instanceof ListCache){var n=r.__data__;if(!Map$2||n.length<LARGE_ARRAY_SIZE$1-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new MapCache(n)}return r.set(e,t),this.size=r.size,this}function Stack(e){var t=this.__data__=new ListCache(e);this.size=t.size}function baseAssign(e,t){return e&&copyObject(t,keys$8(t),e)}function baseAssignIn(e,t){return e&&copyObject(t,keysIn(t),e)}Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;var freeExports="object"==("undefined"==typeof exports?"undefined":_typeof$7(exports))&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==("undefined"==typeof module?"undefined":_typeof$7(module))&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,Buffer$3=moduleExports?root$1.Buffer:void 0,allocUnsafe=Buffer$3?Buffer$3.allocUnsafe:void 0;function cloneBuffer(e,t){if(t)return e.slice();var r=e.length,n=allocUnsafe?allocUnsafe(r):new e.constructor(r);return e.copy(n),n}function arrayFilter(e,t){for(var r=-1,n=null==e?0:e.length,i=0,a=[];++r<n;){var o=e[r];t(o,r,e)&&(a[i++]=o)}return a}function stubArray(){return[]}var objectProto$3=Object.prototype,propertyIsEnumerable$1=objectProto$3.propertyIsEnumerable,nativeGetSymbols$1=Object.getOwnPropertySymbols,getSymbols=nativeGetSymbols$1?function(e){return null==e?[]:(e=Object(e),arrayFilter(nativeGetSymbols$1(e),(function(t){return propertyIsEnumerable$1.call(e,t)})))}:stubArray,getSymbols$1=getSymbols;function copySymbols(e,t){return copyObject(e,getSymbols$1(e),t)}var nativeGetSymbols=Object.getOwnPropertySymbols,getSymbolsIn=nativeGetSymbols?function(e){for(var t=[];e;)arrayPush(t,getSymbols$1(e)),e=getPrototype$1(e);return t}:stubArray,getSymbolsIn$1=getSymbolsIn;function copySymbolsIn(e,t){return copyObject(e,getSymbolsIn$1(e),t)}function baseGetAllKeys(e,t,r){var n=t(e);return isArray$a(e)?n:arrayPush(n,r(e))}function getAllKeys(e){return baseGetAllKeys(e,keys$8,getSymbols$1)}function getAllKeysIn(e){return baseGetAllKeys(e,keysIn,getSymbolsIn$1)}var DataView$3=getNative(root$1,"DataView"),DataView$4=DataView$3,Promise$2=getNative(root$1,"Promise"),Promise$3=Promise$2,Set$1=getNative(root$1,"Set"),Set$2=Set$1,mapTag$4="[object Map]",objectTag$2="[object Object]",promiseTag="[object Promise]",setTag$4="[object Set]",weakMapTag$1="[object WeakMap]",dataViewTag$3="[object DataView]",dataViewCtorString=toSource(DataView$4),mapCtorString=toSource(Map$2),promiseCtorString=toSource(Promise$3),setCtorString=toSource(Set$2),weakMapCtorString=toSource(WeakMap$4),getTag=baseGetTag;(DataView$4&&getTag(new DataView$4(new ArrayBuffer(1)))!=dataViewTag$3||Map$2&&getTag(new Map$2)!=mapTag$4||Promise$3&&getTag(Promise$3.resolve())!=promiseTag||Set$2&&getTag(new Set$2)!=setTag$4||WeakMap$4&&getTag(new WeakMap$4)!=weakMapTag$1)&&(getTag=function(e){var t=baseGetTag(e),r=t==objectTag$2?e.constructor:void 0,n=r?toSource(r):"";if(n)switch(n){case dataViewCtorString:return dataViewTag$3;case mapCtorString:return mapTag$4;case promiseCtorString:return promiseTag;case setCtorString:return setTag$4;case weakMapCtorString:return weakMapTag$1}return t});var getTag$1=getTag,objectProto$2=Object.prototype,hasOwnProperty$5=objectProto$2.hasOwnProperty;function initCloneArray(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&hasOwnProperty$5.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var Uint8Array$3=root$1.Uint8Array,Uint8Array$4=Uint8Array$3;function cloneArrayBuffer(e){var t=new e.constructor(e.byteLength);return new Uint8Array$4(t).set(new Uint8Array$4(e)),t}function cloneDataView(e,t){var r=t?cloneArrayBuffer(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var reFlags=/\w*$/;function cloneRegExp(e){var t=new e.constructor(e.source,reFlags.exec(e));return t.lastIndex=e.lastIndex,t}var symbolProto$1=_Symbol$4?_Symbol$4.prototype:void 0,symbolValueOf$1=symbolProto$1?symbolProto$1.valueOf:void 0;function cloneSymbol(e){return symbolValueOf$1?Object(symbolValueOf$1.call(e)):{}}function cloneTypedArray(e,t){var r=t?cloneArrayBuffer(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var boolTag$2="[object Boolean]",dateTag$2="[object Date]",mapTag$3="[object Map]",numberTag$2="[object Number]",regexpTag$2="[object RegExp]",setTag$3="[object Set]",stringTag$2="[object String]",symbolTag$2="[object Symbol]",arrayBufferTag$2="[object ArrayBuffer]",dataViewTag$2="[object DataView]",float32Tag$1="[object Float32Array]",float64Tag$1="[object Float64Array]",int8Tag$1="[object Int8Array]",int16Tag$1="[object Int16Array]",int32Tag$1="[object Int32Array]",uint8Tag$1="[object Uint8Array]",uint8ClampedTag$1="[object Uint8ClampedArray]",uint16Tag$1="[object Uint16Array]",uint32Tag$1="[object Uint32Array]";function initCloneByTag(e,t,r){var n=e.constructor;switch(t){case arrayBufferTag$2:return cloneArrayBuffer(e);case boolTag$2:case dateTag$2:return new n(+e);case dataViewTag$2:return cloneDataView(e,r);case float32Tag$1:case float64Tag$1:case int8Tag$1:case int16Tag$1:case int32Tag$1:case uint8Tag$1:case uint8ClampedTag$1:case uint16Tag$1:case uint32Tag$1:return cloneTypedArray(e,r);case mapTag$3:return new n;case numberTag$2:case stringTag$2:return new n(e);case regexpTag$2:return cloneRegExp(e);case setTag$3:return new n;case symbolTag$2:return cloneSymbol(e)}}function initCloneObject(e){return"function"!=typeof e.constructor||isPrototype$1(e)?{}:baseCreate$1(getPrototype$1(e))}var mapTag$2="[object Map]";function baseIsMap(e){return isObjectLike(e)&&getTag$1(e)==mapTag$2}var nodeIsMap=nodeUtil$1&&nodeUtil$1.isMap,isMap=nodeIsMap?baseUnary(nodeIsMap):baseIsMap,isMap$1=isMap,setTag$2="[object Set]";function baseIsSet(e){return isObjectLike(e)&&getTag$1(e)==setTag$2}var nodeIsSet=nodeUtil$1&&nodeUtil$1.isSet,isSet=nodeIsSet?baseUnary(nodeIsSet):baseIsSet,isSet$1=isSet,CLONE_DEEP_FLAG$1=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG$1=4,argsTag$1="[object Arguments]",arrayTag$1="[object Array]",boolTag$1="[object Boolean]",dateTag$1="[object Date]",errorTag$1="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag$1="[object Map]",numberTag$1="[object Number]",objectTag$1="[object Object]",regexpTag$1="[object RegExp]",setTag$1="[object Set]",stringTag$1="[object String]",symbolTag$1="[object Symbol]",weakMapTag="[object WeakMap]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$1="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",cloneableTags={};function baseClone(e,t,r,n,i,a){var o,s=t&CLONE_DEEP_FLAG$1,u=t&CLONE_FLAT_FLAG,c=t&CLONE_SYMBOLS_FLAG$1;if(r&&(o=i?r(e,n,i,a):r(e)),void 0!==o)return o;if(!isObject$z(e))return e;var l=isArray$a(e);if(l){if(o=initCloneArray(e),!s)return copyArray(e,o)}else{var d=getTag$1(e),h=d==funcTag||d==genTag;if(isBuffer$1(e))return cloneBuffer(e,s);if(d==objectTag$1||d==argsTag$1||h&&!i){if(o=u||h?{}:initCloneObject(e),!s)return u?copySymbolsIn(e,baseAssignIn(o,e)):copySymbols(e,baseAssign(o,e))}else{if(!cloneableTags[d])return i?e:{};o=initCloneByTag(e,d,s)}}a||(a=new Stack);var f=a.get(e);if(f)return f;a.set(e,o),isSet$1(e)?e.forEach((function(n){o.add(baseClone(n,t,r,n,e,a))})):isMap$1(e)&&e.forEach((function(n,i){o.set(i,baseClone(n,t,r,i,e,a))}));var p=l?void 0:(c?u?getAllKeysIn:getAllKeys:u?keysIn:keys$8)(e);return arrayEach(p||e,(function(n,i){p&&(n=e[i=n]),assignValue(o,i,baseClone(n,t,r,i,e,a))})),o}cloneableTags[argsTag$1]=cloneableTags[arrayTag$1]=cloneableTags[arrayBufferTag$1]=cloneableTags[dataViewTag$1]=cloneableTags[boolTag$1]=cloneableTags[dateTag$1]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag$1]=cloneableTags[numberTag$1]=cloneableTags[objectTag$1]=cloneableTags[regexpTag$1]=cloneableTags[setTag$1]=cloneableTags[stringTag$1]=cloneableTags[symbolTag$1]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0,cloneableTags[errorTag$1]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=!1;var CLONE_DEEP_FLAG=1,CLONE_SYMBOLS_FLAG=4;function cloneDeep(e){return baseClone(e,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG)}var HASH_UNDEFINED="__lodash_hash_undefined__";function setCacheAdd(e){return this.__data__.set(e,HASH_UNDEFINED),this}function setCacheHas(e){return this.__data__.has(e)}function SetCache(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new MapCache;++t<r;)this.add(e[t])}function arraySome(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function cacheHas(e,t){return e.has(t)}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas;var COMPARE_PARTIAL_FLAG$5=1,COMPARE_UNORDERED_FLAG$3=2;function equalArrays(e,t,r,n,i,a){var o=r&COMPARE_PARTIAL_FLAG$5,s=e.length,u=t.length;if(s!=u&&!(o&&u>s))return!1;var c=a.get(e),l=a.get(t);if(c&&l)return c==t&&l==e;var d=-1,h=!0,f=r&COMPARE_UNORDERED_FLAG$3?new SetCache:void 0;for(a.set(e,t),a.set(t,e);++d<s;){var p=e[d],g=t[d];if(n)var y=o?n(g,p,d,t,e,a):n(p,g,d,e,t,a);if(void 0!==y){if(y)continue;h=!1;break}if(f){if(!arraySome(t,(function(e,t){if(!cacheHas(f,t)&&(p===e||i(p,e,r,n,a)))return f.push(t)}))){h=!1;break}}else if(p!==g&&!i(p,g,r,n,a)){h=!1;break}}return a.delete(e),a.delete(t),h}function mapToArray(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function setToArray(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var COMPARE_PARTIAL_FLAG$4=1,COMPARE_UNORDERED_FLAG$2=2,boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",mapTag="[object Map]",numberTag="[object Number]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",symbolProto=_Symbol$4?_Symbol$4.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function equalByTag(e,t,r,n,i,a,o){switch(r){case dataViewTag:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case arrayBufferTag:return!(e.byteLength!=t.byteLength||!a(new Uint8Array$4(e),new Uint8Array$4(t)));case boolTag:case dateTag:case numberTag:return eq(+e,+t);case errorTag:return e.name==t.name&&e.message==t.message;case regexpTag:case stringTag:return e==t+"";case mapTag:var s=mapToArray;case setTag:var u=n&COMPARE_PARTIAL_FLAG$4;if(s||(s=setToArray),e.size!=t.size&&!u)return!1;var c=o.get(e);if(c)return c==t;n|=COMPARE_UNORDERED_FLAG$2,o.set(e,t);var l=equalArrays(s(e),s(t),n,i,a,o);return o.delete(e),l;case symbolTag:if(symbolValueOf)return symbolValueOf.call(e)==symbolValueOf.call(t)}return!1}var COMPARE_PARTIAL_FLAG$3=1,objectProto$1=Object.prototype,hasOwnProperty$4=objectProto$1.hasOwnProperty;function equalObjects(e,t,r,n,i,a){var o=r&COMPARE_PARTIAL_FLAG$3,s=getAllKeys(e),u=s.length;if(u!=getAllKeys(t).length&&!o)return!1;for(var c=u;c--;){var l=s[c];if(!(o?l in t:hasOwnProperty$4.call(t,l)))return!1}var d=a.get(e),h=a.get(t);if(d&&h)return d==t&&h==e;var f=!0;a.set(e,t),a.set(t,e);for(var p=o;++c<u;){var g=e[l=s[c]],y=t[l];if(n)var m=o?n(y,g,l,t,e,a):n(g,y,l,e,t,a);if(!(void 0===m?g===y||i(g,y,r,n,a):m)){f=!1;break}p||(p="constructor"==l)}if(f&&!p){var v=e.constructor,_=t.constructor;v==_||!("constructor"in e)||!("constructor"in t)||"function"==typeof v&&v instanceof v&&"function"==typeof _&&_ instanceof _||(f=!1)}return a.delete(e),a.delete(t),f}var COMPARE_PARTIAL_FLAG$2=1,argsTag="[object Arguments]",arrayTag="[object Array]",objectTag="[object Object]",objectProto=Object.prototype,hasOwnProperty$3=objectProto.hasOwnProperty;function baseIsEqualDeep(e,t,r,n,i,a){var o=isArray$a(e),s=isArray$a(t),u=o?arrayTag:getTag$1(e),c=s?arrayTag:getTag$1(t),l=(u=u==argsTag?objectTag:u)==objectTag,d=(c=c==argsTag?objectTag:c)==objectTag,h=u==c;if(h&&isBuffer$1(e)){if(!isBuffer$1(t))return!1;o=!0,l=!1}if(h&&!l)return a||(a=new Stack),o||isTypedArray$3(e)?equalArrays(e,t,r,n,i,a):equalByTag(e,t,u,r,n,i,a);if(!(r&COMPARE_PARTIAL_FLAG$2)){var f=l&&hasOwnProperty$3.call(e,"__wrapped__"),p=d&&hasOwnProperty$3.call(t,"__wrapped__");if(f||p){var g=f?e.value():e,y=p?t.value():t;return a||(a=new Stack),i(g,y,r,n,a)}}return!!h&&(a||(a=new Stack),equalObjects(e,t,r,n,i,a))}function baseIsEqual(e,t,r,n,i){return e===t||(null==e||null==t||!isObjectLike(e)&&!isObjectLike(t)?e!=e&&t!=t:baseIsEqualDeep(e,t,r,n,baseIsEqual,i))}var COMPARE_PARTIAL_FLAG$1=1,COMPARE_UNORDERED_FLAG$1=2;function baseIsMatch(e,t,r,n){var i=r.length,a=i,o=!n;if(null==e)return!a;for(e=Object(e);i--;){var s=r[i];if(o&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<a;){var u=(s=r[i])[0],c=e[u],l=s[1];if(o&&s[2]){if(void 0===c&&!(u in e))return!1}else{var d=new Stack;if(n)var h=n(c,l,u,e,t,d);if(!(void 0===h?baseIsEqual(l,c,COMPARE_PARTIAL_FLAG$1|COMPARE_UNORDERED_FLAG$1,n,d):h))return!1}}return!0}function isStrictComparable(e){return e==e&&!isObject$z(e)}function getMatchData(e){for(var t=keys$8(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,isStrictComparable(i)]}return t}function matchesStrictComparable(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}}function baseMatches(e){var t=getMatchData(e);return 1==t.length&&t[0][2]?matchesStrictComparable(t[0][0],t[0][1]):function(r){return r===e||baseIsMatch(r,e,t)}}function baseHasIn(e,t){return null!=e&&t in Object(e)}function hasPath(e,t,r){for(var n=-1,i=(t=castPath(t,e)).length,a=!1;++n<i;){var o=toKey(t[n]);if(!(a=null!=e&&r(e,o)))break;e=e[o]}return a||++n!=i?a:!!(i=null==e?0:e.length)&&isLength(i)&&isIndex(o,i)&&(isArray$a(e)||isArguments$1(e))}function hasIn(e,t){return null!=e&&hasPath(e,t,baseHasIn)}var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function baseMatchesProperty(e,t){return isKey(e)&&isStrictComparable(t)?matchesStrictComparable(toKey(e),t):function(r){var n=get$2(r,e);return void 0===n&&n===t?hasIn(r,e):baseIsEqual(t,n,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}function baseProperty(e){return function(t){return null==t?void 0:t[e]}}function basePropertyDeep(e){return function(t){return baseGet(t,e)}}function property(e){return isKey(e)?baseProperty(toKey(e)):basePropertyDeep(e)}function baseIteratee(e){return"function"==typeof e?e:null==e?identity:"object"==_typeof$7(e)?isArray$a(e)?baseMatchesProperty(e[0],e[1]):baseMatches(e):property(e)}var now$1=function(){return root$1.Date.now()},now$2=now$1,FUNC_ERROR_TEXT$1="Expected a function",nativeMax=Math.max,nativeMin=Math.min;function debounce$2(e,t,r){var n,i,a,o,s,u,c=0,l=!1,d=!1,h=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT$1);function f(t){var r=n,a=i;return n=i=void 0,c=t,o=e.apply(a,r)}function p(e){return c=e,s=setTimeout(y,t),l?f(e):o}function g(e){var r=e-u;return void 0===u||r>=t||r<0||d&&e-c>=a}function y(){var e=now$2();if(g(e))return m(e);s=setTimeout(y,function(e){var r=t-(e-u);return d?nativeMin(r,a-(e-c)):r}(e))}function m(e){return s=void 0,h&&n?f(e):(n=i=void 0,o)}function v(){var e=now$2(),r=g(e);if(n=arguments,i=this,u=e,r){if(void 0===s)return p(u);if(d)return clearTimeout(s),s=setTimeout(y,t),f(u)}return void 0===s&&(s=setTimeout(y,t)),o}return t=toNumber$1(t)||0,isObject$z(r)&&(l=!!r.leading,a=(d="maxWait"in r)?nativeMax(toNumber$1(r.maxWait)||0,t):a,h="trailing"in r?!!r.trailing:h),v.cancel=function(){void 0!==s&&clearTimeout(s),c=0,n=u=i=s=void 0},v.flush=function(){return void 0===s?o:m(now$2())},v}function arrayIncludesWith(e,t,r){for(var n=-1,i=null==e?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1}var FUNC_ERROR_TEXT="Expected a function";function throttle(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);return isObject$z(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),debounce$2(e,t,{leading:n,maxWait:t,trailing:i})}var INFINITY=1/0,createSet=Set$2&&1/setToArray(new Set$2([,-0]))[1]==INFINITY?function(e){return new Set$2(e)}:noop$2,createSet$1=createSet,LARGE_ARRAY_SIZE=200;function baseUniq(e,t,r){var n=-1,i=arrayIncludes$1,a=e.length,o=!0,s=[],u=s;if(r)o=!1,i=arrayIncludesWith;else if(a>=LARGE_ARRAY_SIZE){var c=t?null:createSet$1(e);if(c)return setToArray(c);o=!1,i=cacheHas,u=new SetCache}else u=t?[]:s;e:for(;++n<a;){var l=e[n],d=t?t(l):l;if(l=r||0!==l?l:0,o&&d==d){for(var h=u.length;h--;)if(u[h]===d)continue e;t&&u.push(d),s.push(l)}else i(u,d,r)||(u!==s&&u.push(d),s.push(l))}return s}function uniqBy(e,t){return e&&e.length?baseUniq(e,baseIteratee(t)):[]}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})})),t}var proxy=function(){var e,t=null;function r(e){return!!e&&("object"===_typeof$7(e)||"function"==typeof e)}function n(e){if(null!==e&&!r(e))throw new TypeError("Object prototype may only be an Object or null: "+e)}var i=Object,a=Boolean(i.create)||!({__proto__:null}instanceof i),o=i.create||(a?function(e){return n(e),{__proto__:e}}:function(e){if(n(e),null===e)throw new SyntaxError("Native Object.create is required to create objects with null prototype");var t=function(){};return t.prototype=e,new t}),s=function(){return null},u=i.getPrototypeOf||([].__proto__===Array.prototype?function(e){var t=e.__proto__;return r(t)?t:null}:s);return e=function(c,l){if(void 0===(this&&this instanceof e?this.constructor:void 0))throw new TypeError("Constructor Proxy requires 'new'");if(!r(c)||!r(l))throw new TypeError("Cannot create proxy with a non-object as target or handler");var d=function(){};t=function(){c=null,d=function(e){throw new TypeError("Cannot perform '".concat(e,"' on a proxy that has been revoked"))}},setTimeout((function(){t=null}),0);var h=l;for(var f in l={get:null,set:null,apply:null,construct:null},h){if(!(f in l))throw new TypeError("Proxy polyfill does not support trap '".concat(f,"'"));l[f]=h[f]}"function"==typeof h&&(l.apply=h.apply.bind(h));var p,g=u(c),y=!1,m=!1;"function"==typeof c?(p=function(){var e=this&&this.constructor===p,t=Array.prototype.slice.call(arguments);if(d(e?"construct":"apply"),e&&l.construct)return l.construct.call(this,c,t);if(!e&&l.apply)return l.apply(c,this,t);if(e){t.unshift(c);var r=c.bind.apply(c,t);return new r}return c.apply(this,t)},y=!0):c instanceof Array?(p=[],m=!0):p=a||null!==g?o(g):{};var v=l.get?function(e){return d("get"),l.get(this,e,p)}:function(e){return d("get"),this[e]},_=l.set?function(e,t){d("set"),l.set(this,e,t,p)}:function(e,t){d("set"),this[e]=t},b=i.getOwnPropertyNames(c),A={};b.forEach((function(e){if(!y&&!m||!(e in p)){var t=i.getOwnPropertyDescriptor(c,e),r={enumerable:Boolean(t.enumerable),get:v.bind(c,e),set:_.bind(c,e)};i.defineProperty(p,e,r),A[e]=!0}}));var E=!0;if(y||m){var S=i.setPrototypeOf||([].__proto__===Array.prototype?function(e,t){return n(t),e.__proto__=t,e}:s);g&&S(p,g)||(E=!1)}if(l.get||!E)for(var T in c)A[T]||i.defineProperty(p,T,{get:v.bind(c,T)});return i.seal(c),i.seal(p),p},e.revocable=function(r,n){return{proxy:new e(r,n),revoke:t}},e},Proxy$1=proxy(),MyProxy=function(){function e(){_classCallCheck$8(this,e),this.subscribeId=0,this.watcherMap=new Map}return _createClass$9(e,[{key:"observe",value:function(e){var t=this,r=new Proxy$1(e,{set:function(e,n,i){var a=Reflect.get(e,n);Reflect.set(e,n,i);var o=t.watcherMap.get(r);return o&&(t.flushCallback(o),t.flushPropertyCallback(o,n,a,i)),!0}});return this.watcherMap.set(r,{pending:!1,queue:[],property:{}}),r}},{key:"subscribe",value:function(e,t){var r=this.watcherMap.get(e);if(r)return this.subscribeId++,r.queue.push({id:this.subscribeId,callback:t}),this.subscribeId}},{key:"unsubscribe",value:function(e,t){var r=this.watcherMap.get(e);if(r){var n=r.queue,i=n.findIndex((function(e){return e.id===t}));void 0!==i&&i>-1&&n.splice(i,1)}}},{key:"subscribeProperty",value:function(e,t,r){var n=this.watcherMap.get(e);n&&(this.subscribeId++,n.property[t]||(n.property[t]={pending:!1,timer:0,pre:null,queue:[]}),n.property[t].queue.push({id:this.subscribeId,callback:r}))}},{key:"unsubscribeProperty",value:function(e,t,r){var n=this.watcherMap.get(e);if(n){var i=n.property[t];if(i){var a=i.queue,o=a.findIndex((function(e){return e.id===r}));void 0!==o&&o>-1&&a.splice(o,1)}}}},{key:"flushCallback",value:function(e){e.pending||(e.pending=!0,setTimeout((function(){e.queue.forEach((function(e){return e.callback()})),e.pending=!1}),0))}},{key:"flushPropertyCallback",value:function(e,t,r,n){var i=e.property[t];i&&(clearTimeout(i.timer),!1===i.pending&&(i.pending=!0,i.pre=r),i.timer=setTimeout((function(){i.queue.forEach((function(e){return e.callback(i.pre,n)})),i.pending=!1}),0))}}]),e}(),MyProxy$1=new MyProxy;function ownKeys$k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$6(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$k(Object(r),!0).forEach((function(t){_defineProperty$8(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _typeof$6(e){return(_typeof$6="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck$7(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$8(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$8(e,t,r){return t&&_defineProperties$8(e.prototype,t),r&&_defineProperties$8(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$8(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$7(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$7(e,t)}function _getPrototypeOf$7(e){return(_getPrototypeOf$7=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$7(e,t){return(_setPrototypeOf$7=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _assertThisInitialized$7(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$7(e,t){if(t&&("object"===_typeof$7(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$7(e)}function _createSuper$t(e){var t=_isNativeReflectConstruct$u();return function(){var r,n=_getPrototypeOf$7(e);if(t){var i=_getPrototypeOf$7(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$7(this,r)}}function _superPropBase$1(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf$7(e)););return e}function _get$1(){return _get$1="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=_superPropBase$1(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},_get$1.apply(this,arguments)}function _toConsumableArray$2(e){return _arrayWithoutHoles$2(e)||_iterableToArray$2(e)||_unsupportedIterableToArray$7(e)||_nonIterableSpread$2()}function _arrayWithoutHoles$2(e){if(Array.isArray(e))return _arrayLikeToArray$7(e)}function _iterableToArray$2(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _unsupportedIterableToArray$7(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$7(e,t):void 0}}function _arrayLikeToArray$7(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread$2(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var check=function(e){return e&&e.Math==Math&&e},global$O=check("object"==("undefined"==typeof globalThis?"undefined":_typeof$7(globalThis))&&globalThis)||check("object"==("undefined"==typeof window?"undefined":_typeof$7(window))&&window)||check("object"==("undefined"==typeof self?"undefined":_typeof$7(self))&&self)||check("object"==_typeof$7(commonjsGlobal)&&commonjsGlobal)||function(){return this}()||Function("return this")(),objectGetOwnPropertyDescriptor={},fails$10=function(e){try{return!!e()}catch(t){return!0}},fails$$=fails$10,descriptors=!fails$$((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),fails$_=fails$10,functionBindNative=!fails$_((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),NATIVE_BIND$4=functionBindNative,call$v=Function.prototype.call,functionCall=NATIVE_BIND$4?call$v.bind(call$v):function(){return call$v.apply(call$v,arguments)},objectPropertyIsEnumerable={},$propertyIsEnumerable$2={}.propertyIsEnumerable,getOwnPropertyDescriptor$6=Object.getOwnPropertyDescriptor,NASHORN_BUG=getOwnPropertyDescriptor$6&&!$propertyIsEnumerable$2.call({1:2},1);objectPropertyIsEnumerable.f=NASHORN_BUG?function(e){var t=getOwnPropertyDescriptor$6(this,e);return!!t&&t.enumerable}:$propertyIsEnumerable$2;var createPropertyDescriptor$a=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},NATIVE_BIND$3=functionBindNative,FunctionPrototype$3=Function.prototype,call$u=FunctionPrototype$3.call,uncurryThisWithBind=NATIVE_BIND$3&&FunctionPrototype$3.bind.bind(call$u,call$u),functionUncurryThisRaw=function(e){return NATIVE_BIND$3?uncurryThisWithBind(e):function(){return call$u.apply(e,arguments)}},uncurryThisRaw$1=functionUncurryThisRaw,toString$x=uncurryThisRaw$1({}.toString),stringSlice$e=uncurryThisRaw$1("".slice),classofRaw$2=function(e){return stringSlice$e(toString$x(e),8,-1)},classofRaw$1=classofRaw$2,uncurryThisRaw=functionUncurryThisRaw,functionUncurryThis=function(e){if("Function"===classofRaw$1(e))return uncurryThisRaw(e)},uncurryThis$$=functionUncurryThis,fails$Z=fails$10,classof$i=classofRaw$2,$Object$4=Object,split$3=uncurryThis$$("".split),indexedObject=fails$Z((function(){return!$Object$4("z").propertyIsEnumerable(0)}))?function(e){return"String"==classof$i(e)?split$3(e,""):$Object$4(e)}:$Object$4,isNullOrUndefined$a=function(e){return null==e},isNullOrUndefined$9=isNullOrUndefined$a,$TypeError$l=TypeError,requireObjectCoercible$e=function(e){if(isNullOrUndefined$9(e))throw $TypeError$l("Can't call method on "+e);return e},IndexedObject$6=indexedObject,requireObjectCoercible$d=requireObjectCoercible$e,toIndexedObject$e=function(e){return IndexedObject$6(requireObjectCoercible$d(e))},documentAll$2="object"==("undefined"==typeof document?"undefined":_typeof$7(document))&&document.all,IS_HTMLDDA=void 0===documentAll$2&&void 0!==documentAll$2,documentAll_1={all:documentAll$2,IS_HTMLDDA:IS_HTMLDDA},$documentAll$1=documentAll_1,documentAll$1=$documentAll$1.all,isCallable$v=$documentAll$1.IS_HTMLDDA?function(e){return"function"==typeof e||e===documentAll$1}:function(e){return"function"==typeof e},isCallable$u=isCallable$v,$documentAll=documentAll_1,documentAll=$documentAll.all,isObject$y=$documentAll.IS_HTMLDDA?function(e){return"object"==_typeof$7(e)?null!==e:isCallable$u(e)||e===documentAll}:function(e){return"object"==_typeof$7(e)?null!==e:isCallable$u(e)},global$N=global$O,isCallable$t=isCallable$v,aFunction=function(e){return isCallable$t(e)?e:void 0},getBuiltIn$j=function(e,t){return arguments.length<2?aFunction(global$N[e]):global$N[e]&&global$N[e][t]},uncurryThis$_=functionUncurryThis,objectIsPrototypeOf=uncurryThis$_({}.isPrototypeOf),getBuiltIn$i=getBuiltIn$j,engineUserAgent=getBuiltIn$i("navigator","userAgent")||"",global$M=global$O,userAgent$7=engineUserAgent,process$5=global$M.process,Deno$1=global$M.Deno,versions=process$5&&process$5.versions||Deno$1&&Deno$1.version,v8=versions&&versions.v8,match,version$5;v8&&(match=v8.split("."),version$5=match[0]>0&&match[0]<4?1:+(match[0]+match[1])),!version$5&&userAgent$7&&(match=userAgent$7.match(/Edge\/(\d+)/),(!match||match[1]>=74)&&(match=userAgent$7.match(/Chrome\/(\d+)/),match&&(version$5=+match[1])));var engineV8Version=version$5,V8_VERSION$3=engineV8Version,fails$Y=fails$10,symbolConstructorDetection=!!Object.getOwnPropertySymbols&&!fails$Y((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&V8_VERSION$3&&V8_VERSION$3<41})),NATIVE_SYMBOL$6=symbolConstructorDetection,useSymbolAsUid=NATIVE_SYMBOL$6&&!Symbol.sham&&"symbol"==_typeof$7(Symbol.iterator),getBuiltIn$h=getBuiltIn$j,isCallable$s=isCallable$v,isPrototypeOf$a=objectIsPrototypeOf,USE_SYMBOL_AS_UID$1=useSymbolAsUid,$Object$3=Object,isSymbol$6=USE_SYMBOL_AS_UID$1?function(e){return"symbol"==_typeof$7(e)}:function(e){var t=getBuiltIn$h("Symbol");return isCallable$s(t)&&isPrototypeOf$a(t.prototype,$Object$3(e))},$String$4=String,tryToString$7=function(e){try{return $String$4(e)}catch(t){return"Object"}},isCallable$r=isCallable$v,tryToString$6=tryToString$7,$TypeError$k=TypeError,aCallable$c=function(e){if(isCallable$r(e))return e;throw $TypeError$k(tryToString$6(e)+" is not a function")},aCallable$b=aCallable$c,isNullOrUndefined$8=isNullOrUndefined$a,getMethod$7=function(e,t){var r=e[t];return isNullOrUndefined$8(r)?void 0:aCallable$b(r)},call$t=functionCall,isCallable$q=isCallable$v,isObject$x=isObject$y,$TypeError$j=TypeError,ordinaryToPrimitive$1=function(e,t){var r,n;if("string"===t&&isCallable$q(r=e.toString)&&!isObject$x(n=call$t(r,e)))return n;if(isCallable$q(r=e.valueOf)&&!isObject$x(n=call$t(r,e)))return n;if("string"!==t&&isCallable$q(r=e.toString)&&!isObject$x(n=call$t(r,e)))return n;throw $TypeError$j("Can't convert object to primitive value")},shared$7={exports:{}},isPure=!1,global$L=global$O,defineProperty$i=Object.defineProperty,defineGlobalProperty$3=function(e,t){try{defineProperty$i(global$L,e,{value:t,configurable:!0,writable:!0})}catch(r){global$L[e]=t}return t},global$K=global$O,defineGlobalProperty$2=defineGlobalProperty$3,SHARED="__core-js_shared__",store$3=global$K[SHARED]||defineGlobalProperty$2(SHARED,{}),sharedStore=store$3,store$2=sharedStore;(shared$7.exports=function(e,t){return store$2[e]||(store$2[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.25.5",mode:"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.5/LICENSE",source:"https://github.com/zloirock/core-js"});var requireObjectCoercible$c=requireObjectCoercible$e,$Object$2=Object,toObject$k=function(e){return $Object$2(requireObjectCoercible$c(e))},uncurryThis$Z=functionUncurryThis,toObject$j=toObject$k,hasOwnProperty$2=uncurryThis$Z({}.hasOwnProperty),hasOwnProperty_1=Object.hasOwn||function(e,t){return hasOwnProperty$2(toObject$j(e),t)},uncurryThis$Y=functionUncurryThis,id$1=0,postfix=Math.random(),toString$w=uncurryThis$Y(1..toString),uid$5=function(e){return"Symbol("+(void 0===e?"":e)+")_"+toString$w(++id$1+postfix,36)},global$J=global$O,shared$6=shared$7.exports,hasOwn$r=hasOwnProperty_1,uid$4=uid$5,NATIVE_SYMBOL$5=symbolConstructorDetection,USE_SYMBOL_AS_UID=useSymbolAsUid,WellKnownSymbolsStore$1=shared$6("wks"),_Symbol$2=global$J.Symbol,symbolFor=_Symbol$2&&_Symbol$2.for,createWellKnownSymbol=USE_SYMBOL_AS_UID?_Symbol$2:_Symbol$2&&_Symbol$2.withoutSetter||uid$4,wellKnownSymbol$u=function(e){if(!hasOwn$r(WellKnownSymbolsStore$1,e)||!NATIVE_SYMBOL$5&&"string"!=typeof WellKnownSymbolsStore$1[e]){var t="Symbol."+e;NATIVE_SYMBOL$5&&hasOwn$r(_Symbol$2,e)?WellKnownSymbolsStore$1[e]=_Symbol$2[e]:WellKnownSymbolsStore$1[e]=USE_SYMBOL_AS_UID&&symbolFor?symbolFor(t):createWellKnownSymbol(t)}return WellKnownSymbolsStore$1[e]},call$s=functionCall,isObject$w=isObject$y,isSymbol$5=isSymbol$6,getMethod$6=getMethod$7,ordinaryToPrimitive=ordinaryToPrimitive$1,wellKnownSymbol$t=wellKnownSymbol$u,$TypeError$i=TypeError,TO_PRIMITIVE=wellKnownSymbol$t("toPrimitive"),toPrimitive$3=function(e,t){if(!isObject$w(e)||isSymbol$5(e))return e;var r,n=getMethod$6(e,TO_PRIMITIVE);if(n){if(void 0===t&&(t="default"),r=call$s(n,e,t),!isObject$w(r)||isSymbol$5(r))return r;throw $TypeError$i("Can't convert object to primitive value")}return void 0===t&&(t="number"),ordinaryToPrimitive(e,t)},toPrimitive$2=toPrimitive$3,isSymbol$4=isSymbol$6,toPropertyKey$6=function(e){var t=toPrimitive$2(e,"string");return isSymbol$4(t)?t:t+""},global$I=global$O,isObject$v=isObject$y,document$3=global$I.document,EXISTS$1=isObject$v(document$3)&&isObject$v(document$3.createElement),documentCreateElement$2=function(e){return EXISTS$1?document$3.createElement(e):{}},DESCRIPTORS$y=descriptors,fails$X=fails$10,createElement$1=documentCreateElement$2,ie8DomDefine=!DESCRIPTORS$y&&!fails$X((function(){return 7!=Object.defineProperty(createElement$1("div"),"a",{get:function(){return 7}}).a})),DESCRIPTORS$x=descriptors,call$r=functionCall,propertyIsEnumerableModule$2=objectPropertyIsEnumerable,createPropertyDescriptor$9=createPropertyDescriptor$a,toIndexedObject$d=toIndexedObject$e,toPropertyKey$5=toPropertyKey$6,hasOwn$q=hasOwnProperty_1,IE8_DOM_DEFINE$1=ie8DomDefine,$getOwnPropertyDescriptor$2=Object.getOwnPropertyDescriptor;objectGetOwnPropertyDescriptor.f=DESCRIPTORS$x?$getOwnPropertyDescriptor$2:function(e,t){if(e=toIndexedObject$d(e),t=toPropertyKey$5(t),IE8_DOM_DEFINE$1)try{return $getOwnPropertyDescriptor$2(e,t)}catch(r){}if(hasOwn$q(e,t))return createPropertyDescriptor$9(!call$r(propertyIsEnumerableModule$2.f,e,t),e[t])};var objectDefineProperty={},DESCRIPTORS$w=descriptors,fails$W=fails$10,v8PrototypeDefineBug=DESCRIPTORS$w&&fails$W((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),isObject$u=isObject$y,$String$3=String,$TypeError$h=TypeError,anObject$p=function(e){if(isObject$u(e))return e;throw $TypeError$h($String$3(e)+" is not an object")},DESCRIPTORS$v=descriptors,IE8_DOM_DEFINE=ie8DomDefine,V8_PROTOTYPE_DEFINE_BUG$1=v8PrototypeDefineBug,anObject$o=anObject$p,toPropertyKey$4=toPropertyKey$6,$TypeError$g=TypeError,$defineProperty$1=Object.defineProperty,$getOwnPropertyDescriptor$1=Object.getOwnPropertyDescriptor,ENUMERABLE="enumerable",CONFIGURABLE$1="configurable",WRITABLE="writable";objectDefineProperty.f=DESCRIPTORS$v?V8_PROTOTYPE_DEFINE_BUG$1?function(e,t,r){if(anObject$o(e),t=toPropertyKey$4(t),anObject$o(r),"function"==typeof e&&"prototype"===t&&"value"in r&&WRITABLE in r&&!r[WRITABLE]){var n=$getOwnPropertyDescriptor$1(e,t);n&&n[WRITABLE]&&(e[t]=r.value,r={configurable:CONFIGURABLE$1 in r?r[CONFIGURABLE$1]:n[CONFIGURABLE$1],enumerable:ENUMERABLE in r?r[ENUMERABLE]:n[ENUMERABLE],writable:!1})}return $defineProperty$1(e,t,r)}:$defineProperty$1:function(e,t,r){if(anObject$o(e),t=toPropertyKey$4(t),anObject$o(r),IE8_DOM_DEFINE)try{return $defineProperty$1(e,t,r)}catch(n){}if("get"in r||"set"in r)throw $TypeError$g("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var DESCRIPTORS$u=descriptors,definePropertyModule$7=objectDefineProperty,createPropertyDescriptor$8=createPropertyDescriptor$a,createNonEnumerableProperty$c=DESCRIPTORS$u?function(e,t,r){return definePropertyModule$7.f(e,t,createPropertyDescriptor$8(1,r))}:function(e,t,r){return e[t]=r,e},makeBuiltIn$3={exports:{}},DESCRIPTORS$t=descriptors,hasOwn$p=hasOwnProperty_1,FunctionPrototype$2=Function.prototype,getDescriptor=DESCRIPTORS$t&&Object.getOwnPropertyDescriptor,EXISTS=hasOwn$p(FunctionPrototype$2,"name"),PROPER=EXISTS&&"something"===function(){}.name,CONFIGURABLE=EXISTS&&(!DESCRIPTORS$t||DESCRIPTORS$t&&getDescriptor(FunctionPrototype$2,"name").configurable),functionName={EXISTS:EXISTS,PROPER:PROPER,CONFIGURABLE:CONFIGURABLE},uncurryThis$X=functionUncurryThis,isCallable$p=isCallable$v,store$1=sharedStore,functionToString$2=uncurryThis$X(Function.toString);isCallable$p(store$1.inspectSource)||(store$1.inspectSource=function(e){return functionToString$2(e)});var inspectSource$3=store$1.inspectSource,global$H=global$O,isCallable$o=isCallable$v,WeakMap$2=global$H.WeakMap,weakMapBasicDetection=isCallable$o(WeakMap$2)&&/native code/.test(String(WeakMap$2)),shared$5=shared$7.exports,uid$3=uid$5,keys$7=shared$5("keys"),sharedKey$4=function(e){return keys$7[e]||(keys$7[e]=uid$3(e))},hiddenKeys$6={},NATIVE_WEAK_MAP=weakMapBasicDetection,global$G=global$O,isObject$t=isObject$y,createNonEnumerableProperty$b=createNonEnumerableProperty$c,hasOwn$o=hasOwnProperty_1,shared$4=sharedStore,sharedKey$3=sharedKey$4,hiddenKeys$5=hiddenKeys$6,OBJECT_ALREADY_INITIALIZED="Object already initialized",TypeError$7=global$G.TypeError,WeakMap$1=global$G.WeakMap,set$2,get$1,has,enforce=function(e){return has(e)?get$1(e):set$2(e,{})},getterFor$1=function(e){return function(t){var r;if(!isObject$t(t)||(r=get$1(t)).type!==e)throw TypeError$7("Incompatible receiver, "+e+" required");return r}};if(NATIVE_WEAK_MAP||shared$4.state){var store=shared$4.state||(shared$4.state=new WeakMap$1);store.get=store.get,store.has=store.has,store.set=store.set,set$2=function(e,t){if(store.has(e))throw TypeError$7(OBJECT_ALREADY_INITIALIZED);return t.facade=e,store.set(e,t),t},get$1=function(e){return store.get(e)||{}},has=function(e){return store.has(e)}}else{var STATE=sharedKey$3("state");hiddenKeys$5[STATE]=!0,set$2=function(e,t){if(hasOwn$o(e,STATE))throw TypeError$7(OBJECT_ALREADY_INITIALIZED);return t.facade=e,createNonEnumerableProperty$b(e,STATE,t),t},get$1=function(e){return hasOwn$o(e,STATE)?e[STATE]:{}},has=function(e){return hasOwn$o(e,STATE)}}var internalState={set:set$2,get:get$1,has:has,enforce:enforce,getterFor:getterFor$1},fails$V=fails$10,isCallable$n=isCallable$v,hasOwn$n=hasOwnProperty_1,DESCRIPTORS$s=descriptors,CONFIGURABLE_FUNCTION_NAME$2=functionName.CONFIGURABLE,inspectSource$2=inspectSource$3,InternalStateModule$b=internalState,enforceInternalState$3=InternalStateModule$b.enforce,getInternalState$a=InternalStateModule$b.get,defineProperty$h=Object.defineProperty,CONFIGURABLE_LENGTH=DESCRIPTORS$s&&!fails$V((function(){return 8!==defineProperty$h((function(){}),"length",{value:8}).length})),TEMPLATE=String(String).split("String"),makeBuiltIn$2=makeBuiltIn$3.exports=function(e,t,r){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!hasOwn$n(e,"name")||CONFIGURABLE_FUNCTION_NAME$2&&e.name!==t)&&(DESCRIPTORS$s?defineProperty$h(e,"name",{value:t,configurable:!0}):e.name=t),CONFIGURABLE_LENGTH&&r&&hasOwn$n(r,"arity")&&e.length!==r.arity&&defineProperty$h(e,"length",{value:r.arity});try{r&&hasOwn$n(r,"constructor")&&r.constructor?DESCRIPTORS$s&&defineProperty$h(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(i){}var n=enforceInternalState$3(e);return hasOwn$n(n,"source")||(n.source=TEMPLATE.join("string"==typeof t?t:"")),e};Function.prototype.toString=makeBuiltIn$2((function(){return isCallable$n(this)&&getInternalState$a(this).source||inspectSource$2(this)}),"toString");var isCallable$m=isCallable$v,definePropertyModule$6=objectDefineProperty,makeBuiltIn$1=makeBuiltIn$3.exports,defineGlobalProperty$1=defineGlobalProperty$3,defineBuiltIn$l=function(e,t,r,n){n||(n={});var i=n.enumerable,a=void 0!==n.name?n.name:t;if(isCallable$m(r)&&makeBuiltIn$1(r,a,n),n.global)i?e[t]=r:defineGlobalProperty$1(t,r);else{try{n.unsafe?e[t]&&(i=!0):delete e[t]}catch(o){}i?e[t]=r:definePropertyModule$6.f(e,t,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return e},objectGetOwnPropertyNames={},ceil$1=Math.ceil,floor$9=Math.floor,mathTrunc=Math.trunc||function(e){var t=+e;return(t>0?floor$9:ceil$1)(t)},trunc$1=mathTrunc,toIntegerOrInfinity$f=function(e){var t=+e;return t!=t||0===t?0:trunc$1(t)},toIntegerOrInfinity$e=toIntegerOrInfinity$f,max$6=Math.max,min$8=Math.min,toAbsoluteIndex$8=function(e,t){var r=toIntegerOrInfinity$e(e);return r<0?max$6(r+t,0):min$8(r,t)},toIntegerOrInfinity$d=toIntegerOrInfinity$f,min$7=Math.min,toLength$b=function(e){return e>0?min$7(toIntegerOrInfinity$d(e),9007199254740991):0},toLength$a=toLength$b,lengthOfArrayLike$n=function(e){return toLength$a(e.length)},toIndexedObject$c=toIndexedObject$e,toAbsoluteIndex$7=toAbsoluteIndex$8,lengthOfArrayLike$m=lengthOfArrayLike$n,createMethod$7=function(e){return function(t,r,n){var i,a=toIndexedObject$c(t),o=lengthOfArrayLike$m(a),s=toAbsoluteIndex$7(n,o);if(e&&r!=r){for(;o>s;)if((i=a[s++])!=i)return!0}else for(;o>s;s++)if((e||s in a)&&a[s]===r)return e||s||0;return!e&&-1}},arrayIncludes={includes:createMethod$7(!0),indexOf:createMethod$7(!1)},uncurryThis$W=functionUncurryThis,hasOwn$m=hasOwnProperty_1,toIndexedObject$b=toIndexedObject$e,indexOf$2=arrayIncludes.indexOf,hiddenKeys$4=hiddenKeys$6,push$b=uncurryThis$W([].push),objectKeysInternal=function(e,t){var r,n=toIndexedObject$b(e),i=0,a=[];for(r in n)!hasOwn$m(hiddenKeys$4,r)&&hasOwn$m(n,r)&&push$b(a,r);for(;t.length>i;)hasOwn$m(n,r=t[i++])&&(~indexOf$2(a,r)||push$b(a,r));return a},enumBugKeys$3=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],internalObjectKeys$1=objectKeysInternal,enumBugKeys$2=enumBugKeys$3,hiddenKeys$3=enumBugKeys$2.concat("length","prototype");objectGetOwnPropertyNames.f=Object.getOwnPropertyNames||function(e){return internalObjectKeys$1(e,hiddenKeys$3)};var objectGetOwnPropertySymbols={};objectGetOwnPropertySymbols.f=Object.getOwnPropertySymbols;var getBuiltIn$g=getBuiltIn$j,uncurryThis$V=functionUncurryThis,getOwnPropertyNamesModule$2=objectGetOwnPropertyNames,getOwnPropertySymbolsModule$3=objectGetOwnPropertySymbols,anObject$n=anObject$p,concat$4=uncurryThis$V([].concat),ownKeys$j=getBuiltIn$g("Reflect","ownKeys")||function(e){var t=getOwnPropertyNamesModule$2.f(anObject$n(e)),r=getOwnPropertySymbolsModule$3.f;return r?concat$4(t,r(e)):t},hasOwn$l=hasOwnProperty_1,ownKeys$i=ownKeys$j,getOwnPropertyDescriptorModule$3=objectGetOwnPropertyDescriptor,definePropertyModule$5=objectDefineProperty,copyConstructorProperties$3=function(e,t,r){for(var n=ownKeys$i(t),i=definePropertyModule$5.f,a=getOwnPropertyDescriptorModule$3.f,o=0;o<n.length;o++){var s=n[o];hasOwn$l(e,s)||r&&hasOwn$l(r,s)||i(e,s,a(t,s))}},fails$U=fails$10,isCallable$l=isCallable$v,replacement=/#|\.prototype\./,isForced$5=function(e,t){var r=data[normalize(e)];return r==POLYFILL||r!=NATIVE&&(isCallable$l(t)?fails$U(t):!!t)},normalize=isForced$5.normalize=function(e){return String(e).replace(replacement,".").toLowerCase()},data=isForced$5.data={},NATIVE=isForced$5.NATIVE="N",POLYFILL=isForced$5.POLYFILL="P",isForced_1=isForced$5,global$F=global$O,getOwnPropertyDescriptor$5=objectGetOwnPropertyDescriptor.f,createNonEnumerableProperty$a=createNonEnumerableProperty$c,defineBuiltIn$k=defineBuiltIn$l,defineGlobalProperty=defineGlobalProperty$3,copyConstructorProperties$2=copyConstructorProperties$3,isForced$4=isForced_1,_export=function(e,t){var r,n,i,a,o,s=e.target,u=e.global,c=e.stat;if(r=u?global$F:c?global$F[s]||defineGlobalProperty(s,{}):(global$F[s]||{}).prototype)for(n in t){if(a=t[n],i=e.dontCallGetSet?(o=getOwnPropertyDescriptor$5(r,n))&&o.value:r[n],!isForced$4(u?n:s+(c?".":"#")+n,e.forced)&&void 0!==i){if(_typeof$7(a)==_typeof$7(i))continue;copyConstructorProperties$2(a,i)}(e.sham||i&&i.sham)&&createNonEnumerableProperty$a(a,"sham",!0),defineBuiltIn$k(r,n,a,e)}},NATIVE_BIND$2=functionBindNative,FunctionPrototype$1=Function.prototype,apply$a=FunctionPrototype$1.apply,call$q=FunctionPrototype$1.call,functionApply="object"==("undefined"==typeof Reflect?"undefined":_typeof$7(Reflect))&&Reflect.apply||(NATIVE_BIND$2?call$q.bind(apply$a):function(){return call$q.apply(apply$a,arguments)}),isCallable$k=isCallable$v,$String$2=String,$TypeError$f=TypeError,aPossiblePrototype$1=function(e){if("object"==_typeof$7(e)||isCallable$k(e))return e;throw $TypeError$f("Can't set "+$String$2(e)+" as a prototype")},uncurryThis$U=functionUncurryThis,anObject$m=anObject$p,aPossiblePrototype=aPossiblePrototype$1,objectSetPrototypeOf=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=uncurryThis$U(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(n){}return function(r,n){return anObject$m(r),aPossiblePrototype(n),t?e(r,n):r.__proto__=n,r}}():void 0),defineProperty$g=objectDefineProperty.f,proxyAccessor$2=function(e,t,r){r in e||defineProperty$g(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})},isCallable$j=isCallable$v,isObject$s=isObject$y,setPrototypeOf$6=objectSetPrototypeOf,inheritIfRequired$6=function(e,t,r){var n,i;return setPrototypeOf$6&&isCallable$j(n=t.constructor)&&n!==r&&isObject$s(i=n.prototype)&&i!==r.prototype&&setPrototypeOf$6(e,i),e},wellKnownSymbol$s=wellKnownSymbol$u,TO_STRING_TAG$4=wellKnownSymbol$s("toStringTag"),test$2={};test$2[TO_STRING_TAG$4]="z";var toStringTagSupport="[object z]"===String(test$2),TO_STRING_TAG_SUPPORT$2=toStringTagSupport,isCallable$i=isCallable$v,classofRaw=classofRaw$2,wellKnownSymbol$r=wellKnownSymbol$u,TO_STRING_TAG$3=wellKnownSymbol$r("toStringTag"),$Object$1=Object,CORRECT_ARGUMENTS="Arguments"==classofRaw(function(){return arguments}()),tryGet=function(e,t){try{return e[t]}catch(r){}},classof$h=TO_STRING_TAG_SUPPORT$2?classofRaw:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=tryGet(t=$Object$1(e),TO_STRING_TAG$3))?r:CORRECT_ARGUMENTS?classofRaw(t):"Object"==(n=classofRaw(t))&&isCallable$i(t.callee)?"Arguments":n},classof$g=classof$h,$String$1=String,toString$v=function(e){if("Symbol"===classof$g(e))throw TypeError("Cannot convert a Symbol value to a string");return $String$1(e)},toString$u=toString$v,normalizeStringArgument$4=function(e,t){return void 0===e?arguments.length<2?"":t:toString$u(e)},isObject$r=isObject$y,createNonEnumerableProperty$9=createNonEnumerableProperty$c,installErrorCause$1=function(e,t){isObject$r(t)&&"cause"in t&&createNonEnumerableProperty$9(e,"cause",t.cause)},uncurryThis$T=functionUncurryThis,$Error=Error,replace$b=uncurryThis$T("".replace),TEST=String($Error("zxcasd").stack),V8_OR_CHAKRA_STACK_ENTRY=/\n\s*at [^:]*:[^\n]*/,IS_V8_OR_CHAKRA_STACK=V8_OR_CHAKRA_STACK_ENTRY.test(TEST),errorStackClear=function(e,t){if(IS_V8_OR_CHAKRA_STACK&&"string"==typeof e&&!$Error.prepareStackTrace)for(;t--;)e=replace$b(e,V8_OR_CHAKRA_STACK_ENTRY,"");return e},fails$T=fails$10,createPropertyDescriptor$7=createPropertyDescriptor$a,errorStackInstallable=!fails$T((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",createPropertyDescriptor$7(1,7)),7!==e.stack)})),getBuiltIn$f=getBuiltIn$j,hasOwn$k=hasOwnProperty_1,createNonEnumerableProperty$8=createNonEnumerableProperty$c,isPrototypeOf$9=objectIsPrototypeOf,setPrototypeOf$5=objectSetPrototypeOf,copyConstructorProperties$1=copyConstructorProperties$3,proxyAccessor$1=proxyAccessor$2,inheritIfRequired$5=inheritIfRequired$6,normalizeStringArgument$3=normalizeStringArgument$4,installErrorCause=installErrorCause$1,clearErrorStack$2=errorStackClear,ERROR_STACK_INSTALLABLE=errorStackInstallable,DESCRIPTORS$r=descriptors,wrapErrorConstructorWithCause$1=function(e,t,r,n){var i="stackTraceLimit",a=n?2:1,o=e.split("."),s=o[o.length-1],u=getBuiltIn$f.apply(null,o);if(u){var c=u.prototype;if(hasOwn$k(c,"cause")&&delete c.cause,!r)return u;var l=getBuiltIn$f("Error"),d=t((function(e,t){var r=normalizeStringArgument$3(n?t:e,void 0),i=n?new u(e):new u;return void 0!==r&&createNonEnumerableProperty$8(i,"message",r),ERROR_STACK_INSTALLABLE&&createNonEnumerableProperty$8(i,"stack",clearErrorStack$2(i.stack,2)),this&&isPrototypeOf$9(c,this)&&inheritIfRequired$5(i,this,d),arguments.length>a&&installErrorCause(i,arguments[a]),i}));d.prototype=c,"Error"!==s?setPrototypeOf$5?setPrototypeOf$5(d,l):copyConstructorProperties$1(d,l,{name:!0}):DESCRIPTORS$r&&i in u&&(proxyAccessor$1(d,u,i),proxyAccessor$1(d,u,"prepareStackTrace")),copyConstructorProperties$1(d,u);try{c.name!==s&&createNonEnumerableProperty$8(c,"name",s),c.constructor=d}catch(h){}return d}},$$1l=_export,global$E=global$O,apply$9=functionApply,wrapErrorConstructorWithCause=wrapErrorConstructorWithCause$1,WEB_ASSEMBLY="WebAssembly",WebAssembly$1=global$E[WEB_ASSEMBLY],FORCED$e=7!==Error("e",{cause:7}).cause,exportGlobalErrorCauseWrapper=function(e,t){var r={};r[e]=wrapErrorConstructorWithCause(e,t,FORCED$e),$$1l({global:!0,constructor:!0,arity:1,forced:FORCED$e},r)},exportWebAssemblyErrorCauseWrapper=function(e,t){if(WebAssembly$1&&WebAssembly$1[e]){var r={};r[e]=wrapErrorConstructorWithCause(WEB_ASSEMBLY+"."+e,t,FORCED$e),$$1l({target:WEB_ASSEMBLY,stat:!0,constructor:!0,arity:1,forced:FORCED$e},r)}};exportGlobalErrorCauseWrapper("Error",(function(e){return function(t){return apply$9(e,this,arguments)}})),exportGlobalErrorCauseWrapper("EvalError",(function(e){return function(t){return apply$9(e,this,arguments)}})),exportGlobalErrorCauseWrapper("RangeError",(function(e){return function(t){return apply$9(e,this,arguments)}})),exportGlobalErrorCauseWrapper("ReferenceError",(function(e){return function(t){return apply$9(e,this,arguments)}})),exportGlobalErrorCauseWrapper("SyntaxError",(function(e){return function(t){return apply$9(e,this,arguments)}})),exportGlobalErrorCauseWrapper("TypeError",(function(e){return function(t){return apply$9(e,this,arguments)}})),exportGlobalErrorCauseWrapper("URIError",(function(e){return function(t){return apply$9(e,this,arguments)}})),exportWebAssemblyErrorCauseWrapper("CompileError",(function(e){return function(t){return apply$9(e,this,arguments)}})),exportWebAssemblyErrorCauseWrapper("LinkError",(function(e){return function(t){return apply$9(e,this,arguments)}})),exportWebAssemblyErrorCauseWrapper("RuntimeError",(function(e){return function(t){return apply$9(e,this,arguments)}}));var uncurryThis$S=functionUncurryThis,aCallable$a=aCallable$c,NATIVE_BIND$1=functionBindNative,bind$e=uncurryThis$S(uncurryThis$S.bind),functionBindContext=function(e,t){return aCallable$a(e),void 0===t?e:NATIVE_BIND$1?bind$e(e,t):function(){return e.apply(t,arguments)}},classof$f=classofRaw$2,isArray$8=Array.isArray||function(e){return"Array"==classof$f(e)},uncurryThis$R=functionUncurryThis,fails$S=fails$10,isCallable$h=isCallable$v,classof$e=classof$h,getBuiltIn$e=getBuiltIn$j,inspectSource$1=inspectSource$3,noop$1=function(){},empty=[],construct$1=getBuiltIn$e("Reflect","construct"),constructorRegExp=/^\s*(?:class|function)\b/,exec$a=uncurryThis$R(constructorRegExp.exec),INCORRECT_TO_STRING$2=!constructorRegExp.exec(noop$1),isConstructorModern=function(e){if(!isCallable$h(e))return!1;try{return construct$1(noop$1,empty,e),!0}catch(t){return!1}},isConstructorLegacy=function(e){if(!isCallable$h(e))return!1;switch(classof$e(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return INCORRECT_TO_STRING$2||!!exec$a(constructorRegExp,inspectSource$1(e))}catch(t){return!0}};isConstructorLegacy.sham=!0;var isConstructor$4=!construct$1||fails$S((function(){var e;return isConstructorModern(isConstructorModern.call)||!isConstructorModern(Object)||!isConstructorModern((function(){e=!0}))||e}))?isConstructorLegacy:isConstructorModern,isArray$7=isArray$8,isConstructor$3=isConstructor$4,isObject$q=isObject$y,wellKnownSymbol$q=wellKnownSymbol$u,SPECIES$6=wellKnownSymbol$q("species"),$Array$5=Array,arraySpeciesConstructor$1=function(e){var t;return isArray$7(e)&&(t=e.constructor,(isConstructor$3(t)&&(t===$Array$5||isArray$7(t.prototype))||isObject$q(t)&&null===(t=t[SPECIES$6]))&&(t=void 0)),void 0===t?$Array$5:t},arraySpeciesConstructor=arraySpeciesConstructor$1,arraySpeciesCreate$3=function(e,t){return new(arraySpeciesConstructor(e))(0===t?0:t)},bind$d=functionBindContext,uncurryThis$Q=functionUncurryThis,IndexedObject$5=indexedObject,toObject$i=toObject$k,lengthOfArrayLike$l=lengthOfArrayLike$n,arraySpeciesCreate$2=arraySpeciesCreate$3,push$a=uncurryThis$Q([].push),createMethod$6=function(e){var t=1==e,r=2==e,n=3==e,i=4==e,a=6==e,o=7==e,s=5==e||a;return function(u,c,l,d){for(var h,f,p=toObject$i(u),g=IndexedObject$5(p),y=bind$d(c,l),m=lengthOfArrayLike$l(g),v=0,_=d||arraySpeciesCreate$2,b=t?_(u,m):r||o?_(u,0):void 0;m>v;v++)if((s||v in g)&&(f=y(h=g[v],v,p),e))if(t)b[v]=f;else if(f)switch(e){case 3:return!0;case 5:return h;case 6:return v;case 2:push$a(b,h)}else switch(e){case 4:return!1;case 7:push$a(b,h)}return a?-1:n||i?i:b}},arrayIteration={forEach:createMethod$6(0),map:createMethod$6(1),filter:createMethod$6(2),some:createMethod$6(3),every:createMethod$6(4),find:createMethod$6(5),findIndex:createMethod$6(6),filterReject:createMethod$6(7)},objectDefineProperties={},internalObjectKeys=objectKeysInternal,enumBugKeys$1=enumBugKeys$3,objectKeys$4=Object.keys||function(e){return internalObjectKeys(e,enumBugKeys$1)},DESCRIPTORS$q=descriptors,V8_PROTOTYPE_DEFINE_BUG=v8PrototypeDefineBug,definePropertyModule$4=objectDefineProperty,anObject$l=anObject$p,toIndexedObject$a=toIndexedObject$e,objectKeys$3=objectKeys$4;objectDefineProperties.f=DESCRIPTORS$q&&!V8_PROTOTYPE_DEFINE_BUG?Object.defineProperties:function(e,t){anObject$l(e);for(var r,n=toIndexedObject$a(t),i=objectKeys$3(t),a=i.length,o=0;a>o;)definePropertyModule$4.f(e,r=i[o++],n[r]);return e};var getBuiltIn$d=getBuiltIn$j,html$2=getBuiltIn$d("document","documentElement"),anObject$k=anObject$p,definePropertiesModule$1=objectDefineProperties,enumBugKeys=enumBugKeys$3,hiddenKeys$2=hiddenKeys$6,html$1=html$2,documentCreateElement$1=documentCreateElement$2,sharedKey$2=sharedKey$4,GT=">",LT="<",PROTOTYPE$2="prototype",SCRIPT="script",IE_PROTO$1=sharedKey$2("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(e){return LT+SCRIPT+GT+e+LT+"/"+SCRIPT+GT},NullProtoObjectViaActiveX=function(e){e.write(scriptTag("")),e.close();var t=e.parentWindow.Object;return e=null,t},NullProtoObjectViaIFrame=function(){var e,t=documentCreateElement$1("iframe"),r="java"+SCRIPT+":";return t.style.display="none",html$1.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(scriptTag("document.F=Object")),e.close(),e.F},activeXDocument,_NullProtoObject=function(){try{activeXDocument=new ActiveXObject("htmlfile")}catch(t){}_NullProtoObject="undefined"!=typeof document?document.domain&&activeXDocument?NullProtoObjectViaActiveX(activeXDocument):NullProtoObjectViaIFrame():NullProtoObjectViaActiveX(activeXDocument);for(var e=enumBugKeys.length;e--;)delete _NullProtoObject[PROTOTYPE$2][enumBugKeys[e]];return _NullProtoObject()};hiddenKeys$2[IE_PROTO$1]=!0;var objectCreate$1=Object.create||function(e,t){var r;return null!==e?(EmptyConstructor[PROTOTYPE$2]=anObject$k(e),r=new EmptyConstructor,EmptyConstructor[PROTOTYPE$2]=null,r[IE_PROTO$1]=e):r=_NullProtoObject(),void 0===t?r:definePropertiesModule$1.f(r,t)},wellKnownSymbol$p=wellKnownSymbol$u,create$9=objectCreate$1,defineProperty$f=objectDefineProperty.f,UNSCOPABLES=wellKnownSymbol$p("unscopables"),ArrayPrototype$1=Array.prototype;null==ArrayPrototype$1[UNSCOPABLES]&&defineProperty$f(ArrayPrototype$1,UNSCOPABLES,{configurable:!0,value:create$9(null)});var addToUnscopables$6=function(e){ArrayPrototype$1[UNSCOPABLES][e]=!0},$$1k=_export,$find$1=arrayIteration.find,addToUnscopables$5=addToUnscopables$6,FIND="find",SKIPS_HOLES$1=!0;FIND in[]&&Array(1)[FIND]((function(){SKIPS_HOLES$1=!1})),$$1k({target:"Array",proto:!0,forced:SKIPS_HOLES$1},{find:function(e){return $find$1(this,e,arguments.length>1?arguments[1]:void 0)}}),addToUnscopables$5(FIND);var TO_STRING_TAG_SUPPORT$1=toStringTagSupport,classof$d=classof$h,objectToString=TO_STRING_TAG_SUPPORT$1?{}.toString:function(){return"[object "+classof$d(this)+"]"},TO_STRING_TAG_SUPPORT=toStringTagSupport,defineBuiltIn$j=defineBuiltIn$l,toString$t=objectToString;TO_STRING_TAG_SUPPORT||defineBuiltIn$j(Object.prototype,"toString",toString$t,{unsafe:!0});var $TypeError$e=TypeError,MAX_SAFE_INTEGER$2=9007199254740991,doesNotExceedSafeInteger$4=function(e){if(e>MAX_SAFE_INTEGER$2)throw $TypeError$e("Maximum allowed index exceeded");return e},toPropertyKey$3=toPropertyKey$6,definePropertyModule$3=objectDefineProperty,createPropertyDescriptor$6=createPropertyDescriptor$a,createProperty$6=function(e,t,r){var n=toPropertyKey$3(t);n in e?definePropertyModule$3.f(e,n,createPropertyDescriptor$6(0,r)):e[n]=r},fails$R=fails$10,wellKnownSymbol$o=wellKnownSymbol$u,V8_VERSION$2=engineV8Version,SPECIES$5=wellKnownSymbol$o("species"),arrayMethodHasSpeciesSupport$5=function(e){return V8_VERSION$2>=51||!fails$R((function(){var t=[];return(t.constructor={})[SPECIES$5]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},$$1j=_export,fails$Q=fails$10,isArray$6=isArray$8,isObject$p=isObject$y,toObject$h=toObject$k,lengthOfArrayLike$k=lengthOfArrayLike$n,doesNotExceedSafeInteger$3=doesNotExceedSafeInteger$4,createProperty$5=createProperty$6,arraySpeciesCreate$1=arraySpeciesCreate$3,arrayMethodHasSpeciesSupport$4=arrayMethodHasSpeciesSupport$5,wellKnownSymbol$n=wellKnownSymbol$u,V8_VERSION$1=engineV8Version,IS_CONCAT_SPREADABLE=wellKnownSymbol$n("isConcatSpreadable"),IS_CONCAT_SPREADABLE_SUPPORT=V8_VERSION$1>=51||!fails$Q((function(){var e=[];return e[IS_CONCAT_SPREADABLE]=!1,e.concat()[0]!==e})),SPECIES_SUPPORT=arrayMethodHasSpeciesSupport$4("concat"),isConcatSpreadable=function(e){if(!isObject$p(e))return!1;var t=e[IS_CONCAT_SPREADABLE];return void 0!==t?!!t:isArray$6(e)},FORCED$d=!IS_CONCAT_SPREADABLE_SUPPORT||!SPECIES_SUPPORT;$$1j({target:"Array",proto:!0,arity:1,forced:FORCED$d},{concat:function(e){var t,r,n,i,a,o=toObject$h(this),s=arraySpeciesCreate$1(o,0),u=0;for(t=-1,n=arguments.length;t<n;t++)if(isConcatSpreadable(a=-1===t?o:arguments[t]))for(i=lengthOfArrayLike$k(a),doesNotExceedSafeInteger$3(u+i),r=0;r<i;r++,u++)r in a&&createProperty$5(s,u,a[r]);else doesNotExceedSafeInteger$3(u+1),createProperty$5(s,u++,a);return s.length=u,s}});var domIterables={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},documentCreateElement=documentCreateElement$2,classList=documentCreateElement("span").classList,DOMTokenListPrototype$2=classList&&classList.constructor&&classList.constructor.prototype,domTokenListPrototype=DOMTokenListPrototype$2===Object.prototype?void 0:DOMTokenListPrototype$2,fails$P=fails$10,arrayMethodIsStrict$8=function(e,t){var r=[][e];return!!r&&fails$P((function(){r.call(null,t||function(){return 1},1)}))},$forEach$2=arrayIteration.forEach,arrayMethodIsStrict$7=arrayMethodIsStrict$8,STRICT_METHOD$7=arrayMethodIsStrict$7("forEach"),arrayForEach=STRICT_METHOD$7?[].forEach:function(e){return $forEach$2(this,e,arguments.length>1?arguments[1]:void 0)},global$D=global$O,DOMIterables$1=domIterables,DOMTokenListPrototype$1=domTokenListPrototype,forEach$3=arrayForEach,createNonEnumerableProperty$7=createNonEnumerableProperty$c,handlePrototype$1=function(e){if(e&&e.forEach!==forEach$3)try{createNonEnumerableProperty$7(e,"forEach",forEach$3)}catch(t){e.forEach=forEach$3}};for(var COLLECTION_NAME$1 in DOMIterables$1)DOMIterables$1[COLLECTION_NAME$1]&&handlePrototype$1(global$D[COLLECTION_NAME$1]&&global$D[COLLECTION_NAME$1].prototype);handlePrototype$1(DOMTokenListPrototype$1);var $$1i=_export,toObject$g=toObject$k,nativeKeys=objectKeys$4,fails$O=fails$10,FAILS_ON_PRIMITIVES$4=fails$O((function(){nativeKeys(1)}));$$1i({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES$4},{keys:function(e){return nativeKeys(toObject$g(e))}});var uncurryThis$P=functionUncurryThis,arraySlice$c=uncurryThis$P([].slice),$$1h=_export,isArray$5=isArray$8,isConstructor$2=isConstructor$4,isObject$o=isObject$y,toAbsoluteIndex$6=toAbsoluteIndex$8,lengthOfArrayLike$j=lengthOfArrayLike$n,toIndexedObject$9=toIndexedObject$e,createProperty$4=createProperty$6,wellKnownSymbol$m=wellKnownSymbol$u,arrayMethodHasSpeciesSupport$3=arrayMethodHasSpeciesSupport$5,nativeSlice=arraySlice$c,HAS_SPECIES_SUPPORT$3=arrayMethodHasSpeciesSupport$3("slice"),SPECIES$4=wellKnownSymbol$m("species"),$Array$4=Array,max$5=Math.max;$$1h({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$3},{slice:function(e,t){var r,n,i,a=toIndexedObject$9(this),o=lengthOfArrayLike$j(a),s=toAbsoluteIndex$6(e,o),u=toAbsoluteIndex$6(void 0===t?o:t,o);if(isArray$5(a)&&(r=a.constructor,(isConstructor$2(r)&&(r===$Array$4||isArray$5(r.prototype))||isObject$o(r)&&null===(r=r[SPECIES$4]))&&(r=void 0),r===$Array$4||void 0===r))return nativeSlice(a,s,u);for(n=new(void 0===r?$Array$4:r)(max$5(u-s,0)),i=0;s<u;s++,i++)s in a&&createProperty$4(n,i,a[s]);return n.length=i,n}});var anObject$j=anObject$p,regexpFlags$1=function(){var e=anObject$j(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},fails$N=fails$10,global$C=global$O,$RegExp$2=global$C.RegExp,UNSUPPORTED_Y$3=fails$N((function(){var e=$RegExp$2("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),MISSED_STICKY$2=UNSUPPORTED_Y$3||fails$N((function(){return!$RegExp$2("a","y").sticky})),BROKEN_CARET=UNSUPPORTED_Y$3||fails$N((function(){var e=$RegExp$2("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),regexpStickyHelpers={BROKEN_CARET:BROKEN_CARET,MISSED_STICKY:MISSED_STICKY$2,UNSUPPORTED_Y:UNSUPPORTED_Y$3},fails$M=fails$10,global$B=global$O,$RegExp$1=global$B.RegExp,regexpUnsupportedDotAll=fails$M((function(){var e=$RegExp$1(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),fails$L=fails$10,global$A=global$O,$RegExp=global$A.RegExp,regexpUnsupportedNcg=fails$L((function(){var e=$RegExp("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),call$p=functionCall,uncurryThis$O=functionUncurryThis,toString$s=toString$v,regexpFlags=regexpFlags$1,stickyHelpers$2=regexpStickyHelpers,shared$3=shared$7.exports,create$8=objectCreate$1,getInternalState$9=internalState.get,UNSUPPORTED_DOT_ALL$2=regexpUnsupportedDotAll,UNSUPPORTED_NCG$1=regexpUnsupportedNcg,nativeReplace=shared$3("native-string-replace",String.prototype.replace),nativeExec=RegExp.prototype.exec,patchedExec=nativeExec,charAt$d=uncurryThis$O("".charAt),indexOf$1=uncurryThis$O("".indexOf),replace$a=uncurryThis$O("".replace),stringSlice$d=uncurryThis$O("".slice),UPDATES_LAST_INDEX_WRONG=(re12=/a/,re22=/b*/g,call$p(nativeExec,re12,"a"),call$p(nativeExec,re22,"a"),0!==re12.lastIndex||0!==re22.lastIndex),re12,re22,UNSUPPORTED_Y$2=stickyHelpers$2.BROKEN_CARET,NPCG_INCLUDED=void 0!==/()??/.exec("")[1],PATCH=UPDATES_LAST_INDEX_WRONG||NPCG_INCLUDED||UNSUPPORTED_Y$2||UNSUPPORTED_DOT_ALL$2||UNSUPPORTED_NCG$1;PATCH&&(patchedExec=function(e){var t,r,n,i,a,o,s,u=this,c=getInternalState$9(u),l=toString$s(e),d=c.raw;if(d)return d.lastIndex=u.lastIndex,t=call$p(patchedExec,d,l),u.lastIndex=d.lastIndex,t;var h=c.groups,f=UNSUPPORTED_Y$2&&u.sticky,p=call$p(regexpFlags,u),g=u.source,y=0,m=l;if(f&&(p=replace$a(p,"y",""),-1===indexOf$1(p,"g")&&(p+="g"),m=stringSlice$d(l,u.lastIndex),u.lastIndex>0&&(!u.multiline||u.multiline&&"\n"!==charAt$d(l,u.lastIndex-1))&&(g="(?: "+g+")",m=" "+m,y++),r=new RegExp("^(?:"+g+")",p)),NPCG_INCLUDED&&(r=new RegExp("^"+g+"$(?!\\s)",p)),UPDATES_LAST_INDEX_WRONG&&(n=u.lastIndex),i=call$p(nativeExec,f?r:u,m),f?i?(i.input=stringSlice$d(i.input,y),i[0]=stringSlice$d(i[0],y),i.index=u.lastIndex,u.lastIndex+=i[0].length):u.lastIndex=0:UPDATES_LAST_INDEX_WRONG&&i&&(u.lastIndex=u.global?i.index+i[0].length:n),NPCG_INCLUDED&&i&&i.length>1&&call$p(nativeReplace,i[0],r,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(i[a]=void 0)})),i&&h)for(i.groups=o=create$8(null),a=0;a<h.length;a++)o[(s=h[a])[0]]=i[s[1]];return i});var regexpExec$3=patchedExec,$$1g=_export,exec$9=regexpExec$3;$$1g({target:"RegExp",proto:!0,forced:/./.exec!==exec$9},{exec:exec$9});var $$1f=_export,call$o=functionCall,isCallable$g=isCallable$v,anObject$i=anObject$p,toString$r=toString$v,DELEGATES_TO_EXEC=(execCalled=!1,re3=/[ac]/,re3.exec=function(){return execCalled=!0,/./.exec.apply(this,arguments)},!0===re3.test("abc")&&execCalled),execCalled,re3,nativeTest=/./.test;$$1f({target:"RegExp",proto:!0,forced:!DELEGATES_TO_EXEC},{test:function(e){var t=anObject$i(this),r=toString$r(e),n=t.exec;if(!isCallable$g(n))return call$o(nativeTest,t,r);var i=call$o(n,t,r);return null!==i&&(anObject$i(i),!0)}});var uncurryThis$N=functionUncurryThis,defineBuiltIn$i=defineBuiltIn$l,regexpExec$2=regexpExec$3,fails$K=fails$10,wellKnownSymbol$l=wellKnownSymbol$u,createNonEnumerableProperty$6=createNonEnumerableProperty$c,SPECIES$3=wellKnownSymbol$l("species"),RegExpPrototype$6=RegExp.prototype,fixRegexpWellKnownSymbolLogic=function(e,t,r,n){var i=wellKnownSymbol$l(e),a=!fails$K((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),o=a&&!fails$K((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[SPECIES$3]=function(){return r},r.flags="",r[i]=/./[i]),r.exec=function(){return t=!0,null},r[i](""),!t}));if(!a||!o||r){var s=uncurryThis$N(/./[i]),u=t(i,""[e],(function(e,t,r,n,i){var o=uncurryThis$N(e),u=t.exec;return u===regexpExec$2||u===RegExpPrototype$6.exec?a&&!i?{done:!0,value:s(t,r,n)}:{done:!0,value:o(r,t,n)}:{done:!1}}));defineBuiltIn$i(String.prototype,e,u[0]),defineBuiltIn$i(RegExpPrototype$6,i,u[1])}n&&createNonEnumerableProperty$6(RegExpPrototype$6[i],"sham",!0)},isObject$n=isObject$y,classof$c=classofRaw$2,wellKnownSymbol$k=wellKnownSymbol$u,MATCH$2=wellKnownSymbol$k("match"),isRegexp=function(e){var t;return isObject$n(e)&&(void 0!==(t=e[MATCH$2])?!!t:"RegExp"==classof$c(e))},isConstructor$1=isConstructor$4,tryToString$5=tryToString$7,$TypeError$d=TypeError,aConstructor$3=function(e){if(isConstructor$1(e))return e;throw $TypeError$d(tryToString$5(e)+" is not a constructor")},anObject$h=anObject$p,aConstructor$2=aConstructor$3,isNullOrUndefined$7=isNullOrUndefined$a,wellKnownSymbol$j=wellKnownSymbol$u,SPECIES$2=wellKnownSymbol$j("species"),speciesConstructor$5=function(e,t){var r,n=anObject$h(e).constructor;return void 0===n||isNullOrUndefined$7(r=anObject$h(n)[SPECIES$2])?t:aConstructor$2(r)},uncurryThis$M=functionUncurryThis,toIntegerOrInfinity$c=toIntegerOrInfinity$f,toString$q=toString$v,requireObjectCoercible$b=requireObjectCoercible$e,charAt$c=uncurryThis$M("".charAt),charCodeAt$5=uncurryThis$M("".charCodeAt),stringSlice$c=uncurryThis$M("".slice),createMethod$5=function(e){return function(t,r){var n,i,a=toString$q(requireObjectCoercible$b(t)),o=toIntegerOrInfinity$c(r),s=a.length;return o<0||o>=s?e?"":void 0:(n=charCodeAt$5(a,o))<55296||n>56319||o+1===s||(i=charCodeAt$5(a,o+1))<56320||i>57343?e?charAt$c(a,o):n:e?stringSlice$c(a,o,o+2):i-56320+(n-55296<<10)+65536}},stringMultibyte={codeAt:createMethod$5(!1),charAt:createMethod$5(!0)},charAt$b=stringMultibyte.charAt,advanceStringIndex$3=function(e,t,r){return t+(r?charAt$b(e,t).length:1)},toAbsoluteIndex$5=toAbsoluteIndex$8,lengthOfArrayLike$i=lengthOfArrayLike$n,createProperty$3=createProperty$6,$Array$3=Array,max$4=Math.max,arraySliceSimple=function(e,t,r){for(var n=lengthOfArrayLike$i(e),i=toAbsoluteIndex$5(t,n),a=toAbsoluteIndex$5(void 0===r?n:r,n),o=$Array$3(max$4(a-i,0)),s=0;i<a;i++,s++)createProperty$3(o,s,e[i]);return o.length=s,o},call$n=functionCall,anObject$g=anObject$p,isCallable$f=isCallable$v,classof$b=classofRaw$2,regexpExec$1=regexpExec$3,$TypeError$c=TypeError,regexpExecAbstract=function(e,t){var r=e.exec;if(isCallable$f(r)){var n=call$n(r,e,t);return null!==n&&anObject$g(n),n}if("RegExp"===classof$b(e))return call$n(regexpExec$1,e,t);throw $TypeError$c("RegExp#exec called on incompatible receiver")},apply$8=functionApply,call$m=functionCall,uncurryThis$L=functionUncurryThis,fixRegExpWellKnownSymbolLogic$3=fixRegexpWellKnownSymbolLogic,anObject$f=anObject$p,isNullOrUndefined$6=isNullOrUndefined$a,isRegExp$2=isRegexp,requireObjectCoercible$a=requireObjectCoercible$e,speciesConstructor$4=speciesConstructor$5,advanceStringIndex$2=advanceStringIndex$3,toLength$9=toLength$b,toString$p=toString$v,getMethod$5=getMethod$7,arraySlice$b=arraySliceSimple,callRegExpExec=regexpExecAbstract,regexpExec=regexpExec$3,stickyHelpers$1=regexpStickyHelpers,fails$J=fails$10,UNSUPPORTED_Y$1=stickyHelpers$1.UNSUPPORTED_Y,MAX_UINT32=4294967295,min$6=Math.min,$push=[].push,exec$8=uncurryThis$L(/./.exec),push$9=uncurryThis$L($push),stringSlice$b=uncurryThis$L("".slice),SPLIT_WORKS_WITH_OVERWRITTEN_EXEC=!fails$J((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]}));fixRegExpWellKnownSymbolLogic$3("split",(function(e,t,r){var n;return n="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,r){var n=toString$p(requireObjectCoercible$a(this)),i=void 0===r?MAX_UINT32:r>>>0;if(0===i)return[];if(void 0===e)return[n];if(!isRegExp$2(e))return call$m(t,n,e,i);for(var a,o,s,u=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),l=0,d=new RegExp(e.source,c+"g");(a=call$m(regexpExec,d,n))&&!((o=d.lastIndex)>l&&(push$9(u,stringSlice$b(n,l,a.index)),a.length>1&&a.index<n.length&&apply$8($push,u,arraySlice$b(a,1)),s=a[0].length,l=o,u.length>=i));)d.lastIndex===a.index&&d.lastIndex++;return l===n.length?!s&&exec$8(d,"")||push$9(u,""):push$9(u,stringSlice$b(n,l)),u.length>i?arraySlice$b(u,0,i):u}:"0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:call$m(t,this,e,r)}:t,[function(t,r){var i=requireObjectCoercible$a(this),a=isNullOrUndefined$6(t)?void 0:getMethod$5(t,e);return a?call$m(a,t,i,r):call$m(n,toString$p(i),t,r)},function(e,i){var a=anObject$f(this),o=toString$p(e),s=r(n,a,o,i,n!==t);if(s.done)return s.value;var u=speciesConstructor$4(a,RegExp),c=a.unicode,l=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(UNSUPPORTED_Y$1?"g":"y"),d=new u(UNSUPPORTED_Y$1?"^(?:"+a.source+")":a,l),h=void 0===i?MAX_UINT32:i>>>0;if(0===h)return[];if(0===o.length)return null===callRegExpExec(d,o)?[o]:[];for(var f=0,p=0,g=[];p<o.length;){d.lastIndex=UNSUPPORTED_Y$1?0:p;var y,m=callRegExpExec(d,UNSUPPORTED_Y$1?stringSlice$b(o,p):o);if(null===m||(y=min$6(toLength$9(d.lastIndex+(UNSUPPORTED_Y$1?p:0)),o.length))===f)p=advanceStringIndex$2(o,p,c);else{if(push$9(g,stringSlice$b(o,f,p)),g.length===h)return g;for(var v=1;v<=m.length-1;v++)if(push$9(g,m[v]),g.length===h)return g;p=f=y}}return push$9(g,stringSlice$b(o,f)),g}]}),!SPLIT_WORKS_WITH_OVERWRITTEN_EXEC,UNSUPPORTED_Y$1);var $$1e=_export,uncurryThis$K=functionUncurryThis,IndexedObject$4=indexedObject,toIndexedObject$8=toIndexedObject$e,arrayMethodIsStrict$6=arrayMethodIsStrict$8,nativeJoin=uncurryThis$K([].join),ES3_STRINGS=IndexedObject$4!=Object,STRICT_METHOD$6=arrayMethodIsStrict$6("join",",");$$1e({target:"Array",proto:!0,forced:ES3_STRINGS||!STRICT_METHOD$6},{join:function(e){return nativeJoin(toIndexedObject$8(this),void 0===e?",":e)}});var DESCRIPTORS$p=descriptors,isArray$4=isArray$8,$TypeError$b=TypeError,getOwnPropertyDescriptor$4=Object.getOwnPropertyDescriptor,SILENT_ON_NON_WRITABLE_LENGTH_SET=DESCRIPTORS$p&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}(),arraySetLength=SILENT_ON_NON_WRITABLE_LENGTH_SET?function(e,t){if(isArray$4(e)&&!getOwnPropertyDescriptor$4(e,"length").writable)throw $TypeError$b("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},tryToString$4=tryToString$7,$TypeError$a=TypeError,deletePropertyOrThrow$4=function(e,t){if(!delete e[t])throw $TypeError$a("Cannot delete property "+tryToString$4(t)+" of "+tryToString$4(e))},$$1d=_export,toObject$f=toObject$k,toAbsoluteIndex$4=toAbsoluteIndex$8,toIntegerOrInfinity$b=toIntegerOrInfinity$f,lengthOfArrayLike$h=lengthOfArrayLike$n,setArrayLength$2=arraySetLength,doesNotExceedSafeInteger$2=doesNotExceedSafeInteger$4,arraySpeciesCreate=arraySpeciesCreate$3,createProperty$2=createProperty$6,deletePropertyOrThrow$3=deletePropertyOrThrow$4,arrayMethodHasSpeciesSupport$2=arrayMethodHasSpeciesSupport$5,HAS_SPECIES_SUPPORT$2=arrayMethodHasSpeciesSupport$2("splice"),max$3=Math.max,min$5=Math.min;$$1d({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$2},{splice:function(e,t){var r,n,i,a,o,s,u=toObject$f(this),c=lengthOfArrayLike$h(u),l=toAbsoluteIndex$4(e,c),d=arguments.length;for(0===d?r=n=0:1===d?(r=0,n=c-l):(r=d-2,n=min$5(max$3(toIntegerOrInfinity$b(t),0),c-l)),doesNotExceedSafeInteger$2(c+r-n),i=arraySpeciesCreate(u,n),a=0;a<n;a++)(o=l+a)in u&&createProperty$2(i,a,u[o]);if(i.length=n,r<n){for(a=l;a<c-n;a++)s=a+r,(o=a+n)in u?u[s]=u[o]:deletePropertyOrThrow$3(u,s);for(a=c;a>c-n+r;a--)deletePropertyOrThrow$3(u,a-1)}else if(r>n)for(a=c-n;a>l;a--)s=a+r-1,(o=a+n-1)in u?u[s]=u[o]:deletePropertyOrThrow$3(u,s);for(a=0;a<r;a++)u[a+l]=arguments[a+2];return setArrayLength$2(u,c-n+r),i}});var classof$a=classofRaw$2,global$z=global$O,engineIsNode="process"==classof$a(global$z.process),defineProperty$e=objectDefineProperty.f,hasOwn$j=hasOwnProperty_1,wellKnownSymbol$i=wellKnownSymbol$u,TO_STRING_TAG$2=wellKnownSymbol$i("toStringTag"),setToStringTag$9=function(e,t,r){e&&!r&&(e=e.prototype),e&&!hasOwn$j(e,TO_STRING_TAG$2)&&defineProperty$e(e,TO_STRING_TAG$2,{configurable:!0,value:t})},getBuiltIn$c=getBuiltIn$j,definePropertyModule$2=objectDefineProperty,wellKnownSymbol$h=wellKnownSymbol$u,DESCRIPTORS$o=descriptors,SPECIES$1=wellKnownSymbol$h("species"),setSpecies$5=function(e){var t=getBuiltIn$c(e),r=definePropertyModule$2.f;DESCRIPTORS$o&&t&&!t[SPECIES$1]&&r(t,SPECIES$1,{configurable:!0,get:function(){return this}})},isPrototypeOf$8=objectIsPrototypeOf,$TypeError$9=TypeError,anInstance$9=function(e,t){if(isPrototypeOf$8(t,e))return e;throw $TypeError$9("Incorrect invocation")},$TypeError$8=TypeError,validateArgumentsLength$6=function(e,t){if(e<t)throw $TypeError$8("Not enough arguments");return e},userAgent$6=engineUserAgent,engineIsIos=/(?:ipad|iphone|ipod).*applewebkit/i.test(userAgent$6),global$y=global$O,apply$7=functionApply,bind$c=functionBindContext,isCallable$e=isCallable$v,hasOwn$i=hasOwnProperty_1,fails$I=fails$10,html=html$2,arraySlice$a=arraySlice$c,createElement=documentCreateElement$2,validateArgumentsLength$5=validateArgumentsLength$6,IS_IOS$1=engineIsIos,IS_NODE$5=engineIsNode,set$1=global$y.setImmediate,clear$1=global$y.clearImmediate,process$4=global$y.process,Dispatch=global$y.Dispatch,Function$2=global$y.Function,MessageChannel=global$y.MessageChannel,String$1=global$y.String,counter=0,queue$1={},ONREADYSTATECHANGE="onreadystatechange",$location,defer,channel,port;try{$location=global$y.location}catch(error){}var run=function(e){if(hasOwn$i(queue$1,e)){var t=queue$1[e];delete queue$1[e],t()}},runner=function(e){return function(){run(e)}},listener$1=function(e){run(e.data)},post=function(e){global$y.postMessage(String$1(e),$location.protocol+"//"+$location.host)};set$1&&clear$1||(set$1=function(e){validateArgumentsLength$5(arguments.length,1);var t=isCallable$e(e)?e:Function$2(e),r=arraySlice$a(arguments,1);return queue$1[++counter]=function(){apply$7(t,void 0,r)},defer(counter),counter},clear$1=function(e){delete queue$1[e]},IS_NODE$5?defer=function(e){process$4.nextTick(runner(e))}:Dispatch&&Dispatch.now?defer=function(e){Dispatch.now(runner(e))}:MessageChannel&&!IS_IOS$1?(channel=new MessageChannel,port=channel.port2,channel.port1.onmessage=listener$1,defer=bind$c(port.postMessage,port)):global$y.addEventListener&&isCallable$e(global$y.postMessage)&&!global$y.importScripts&&$location&&"file:"!==$location.protocol&&!fails$I(post)?(defer=post,global$y.addEventListener("message",listener$1,!1)):defer=ONREADYSTATECHANGE in createElement("script")?function(e){html.appendChild(createElement("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this),run(e)}}:function(e){setTimeout(runner(e),0)});var task$1={set:set$1,clear:clear$1},userAgent$5=engineUserAgent,global$x=global$O,engineIsIosPebble=/ipad|iphone|ipod/i.test(userAgent$5)&&void 0!==global$x.Pebble,userAgent$4=engineUserAgent,engineIsWebosWebkit=/web0s(?!.*chrome)/i.test(userAgent$4),global$w=global$O,bind$b=functionBindContext,getOwnPropertyDescriptor$3=objectGetOwnPropertyDescriptor.f,macrotask=task$1.set,IS_IOS=engineIsIos,IS_IOS_PEBBLE=engineIsIosPebble,IS_WEBOS_WEBKIT=engineIsWebosWebkit,IS_NODE$4=engineIsNode,MutationObserver$1=global$w.MutationObserver||global$w.WebKitMutationObserver,document$2=global$w.document,process$3=global$w.process,Promise$1=global$w.Promise,queueMicrotaskDescriptor=getOwnPropertyDescriptor$3(global$w,"queueMicrotask"),queueMicrotask=queueMicrotaskDescriptor&&queueMicrotaskDescriptor.value,flush,head,last,notify$1,toggle,node,promise,then;queueMicrotask||(flush=function(){var e,t;for(IS_NODE$4&&(e=process$3.domain)&&e.exit();head;){t=head.fn,head=head.next;try{t()}catch(error){throw head?notify$1():last=void 0,error}}last=void 0,e&&e.enter()},IS_IOS||IS_NODE$4||IS_WEBOS_WEBKIT||!MutationObserver$1||!document$2?!IS_IOS_PEBBLE&&Promise$1&&Promise$1.resolve?(promise=Promise$1.resolve(void 0),promise.constructor=Promise$1,then=bind$b(promise.then,promise),notify$1=function(){then(flush)}):IS_NODE$4?notify$1=function(){process$3.nextTick(flush)}:(macrotask=bind$b(macrotask,global$w),notify$1=function(){macrotask(flush)}):(toggle=!0,node=document$2.createTextNode(""),new MutationObserver$1(flush).observe(node,{characterData:!0}),notify$1=function(){node.data=toggle=!toggle}));var microtask$1=queueMicrotask||function(e){var t={fn:e,next:void 0};last&&(last.next=t),head||(head=t,notify$1()),last=t},global$v=global$O,hostReportErrors$1=function(e,t){var r=global$v.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))},perform$3=function(e){try{return{error:!1,value:e()}}catch(error){return{error:!0,value:error}}},Queue$1=function(){this.head=null,this.tail=null};Queue$1.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var queue=Queue$1,global$u=global$O,promiseNativeConstructor=global$u.Promise,engineIsDeno="object"==("undefined"==typeof Deno?"undefined":_typeof$7(Deno))&&Deno&&"object"==_typeof$7(Deno.version),IS_DENO$1=engineIsDeno,IS_NODE$3=engineIsNode,engineIsBrowser=!IS_DENO$1&&!IS_NODE$3&&"object"==("undefined"==typeof window?"undefined":_typeof$7(window))&&"object"==("undefined"==typeof document?"undefined":_typeof$7(document)),global$t=global$O,NativePromiseConstructor$4=promiseNativeConstructor,isCallable$d=isCallable$v,isForced$3=isForced_1,inspectSource=inspectSource$3,wellKnownSymbol$g=wellKnownSymbol$u,IS_BROWSER=engineIsBrowser,IS_DENO=engineIsDeno,V8_VERSION=engineV8Version;NativePromiseConstructor$4&&NativePromiseConstructor$4.prototype;var SPECIES=wellKnownSymbol$g("species"),SUBCLASSING=!1,NATIVE_PROMISE_REJECTION_EVENT$1=isCallable$d(global$t.PromiseRejectionEvent),FORCED_PROMISE_CONSTRUCTOR$5=isForced$3("Promise",(function(){var e=inspectSource(NativePromiseConstructor$4),t=e!==String(NativePromiseConstructor$4);if(!t&&66===V8_VERSION)return!0;if(!V8_VERSION||V8_VERSION<51||!/native code/.test(e)){var r=new NativePromiseConstructor$4((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};if((r.constructor={})[SPECIES]=n,!(SUBCLASSING=r.then((function(){}))instanceof n))return!0}return!t&&(IS_BROWSER||IS_DENO)&&!NATIVE_PROMISE_REJECTION_EVENT$1})),promiseConstructorDetection={CONSTRUCTOR:FORCED_PROMISE_CONSTRUCTOR$5,REJECTION_EVENT:NATIVE_PROMISE_REJECTION_EVENT$1,SUBCLASSING:SUBCLASSING},newPromiseCapability$2={},aCallable$9=aCallable$c,$TypeError$7=TypeError,PromiseCapability=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw $TypeError$7("Bad Promise constructor");t=e,r=n})),this.resolve=aCallable$9(t),this.reject=aCallable$9(r)};newPromiseCapability$2.f=function(e){return new PromiseCapability(e)};var $$1c=_export,IS_NODE$2=engineIsNode,global$s=global$O,call$l=functionCall,defineBuiltIn$h=defineBuiltIn$l,setPrototypeOf$4=objectSetPrototypeOf,setToStringTag$8=setToStringTag$9,setSpecies$4=setSpecies$5,aCallable$8=aCallable$c,isCallable$c=isCallable$v,isObject$m=isObject$y,anInstance$8=anInstance$9,speciesConstructor$3=speciesConstructor$5,task=task$1.set,microtask=microtask$1,hostReportErrors=hostReportErrors$1,perform$2=perform$3,Queue=queue,InternalStateModule$a=internalState,NativePromiseConstructor$3=promiseNativeConstructor,PromiseConstructorDetection=promiseConstructorDetection,newPromiseCapabilityModule$3=newPromiseCapability$2,PROMISE="Promise",FORCED_PROMISE_CONSTRUCTOR$4=PromiseConstructorDetection.CONSTRUCTOR,NATIVE_PROMISE_REJECTION_EVENT=PromiseConstructorDetection.REJECTION_EVENT,NATIVE_PROMISE_SUBCLASSING=PromiseConstructorDetection.SUBCLASSING,getInternalPromiseState=InternalStateModule$a.getterFor(PROMISE),setInternalState$9=InternalStateModule$a.set,NativePromisePrototype$2=NativePromiseConstructor$3&&NativePromiseConstructor$3.prototype,PromiseConstructor=NativePromiseConstructor$3,PromisePrototype=NativePromisePrototype$2,TypeError$6=global$s.TypeError,document$1=global$s.document,process$2=global$s.process,newPromiseCapability$1=newPromiseCapabilityModule$3.f,newGenericPromiseCapability=newPromiseCapability$1,DISPATCH_EVENT=!!(document$1&&document$1.createEvent&&global$s.dispatchEvent),UNHANDLED_REJECTION="unhandledrejection",REJECTION_HANDLED="rejectionhandled",PENDING=0,FULFILLED=1,REJECTED=2,HANDLED=1,UNHANDLED=2,Internal,OwnPromiseCapability,PromiseWrapper,nativeThen,isThenable=function(e){var t;return!(!isObject$m(e)||!isCallable$c(t=e.then))&&t},callReaction=function(e,t){var r,n,i,a=t.value,o=t.state==FULFILLED,s=o?e.ok:e.fail,u=e.resolve,c=e.reject,l=e.domain;try{s?(o||(t.rejection===UNHANDLED&&onHandleUnhandled(t),t.rejection=HANDLED),!0===s?r=a:(l&&l.enter(),r=s(a),l&&(l.exit(),i=!0)),r===e.promise?c(TypeError$6("Promise-chain cycle")):(n=isThenable(r))?call$l(n,r,u,c):u(r)):c(a)}catch(error){l&&!i&&l.exit(),c(error)}},notify=function(e,t){e.notified||(e.notified=!0,microtask((function(){for(var r,n=e.reactions;r=n.get();)callReaction(r,e);e.notified=!1,t&&!e.rejection&&onUnhandled(e)})))},dispatchEvent=function(e,t,r){var n,i;DISPATCH_EVENT?((n=document$1.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),global$s.dispatchEvent(n)):n={promise:t,reason:r},!NATIVE_PROMISE_REJECTION_EVENT&&(i=global$s["on"+e])?i(n):e===UNHANDLED_REJECTION&&hostReportErrors("Unhandled promise rejection",r)},onUnhandled=function(e){call$l(task,global$s,(function(){var t,r=e.facade,n=e.value;if(isUnhandled(e)&&(t=perform$2((function(){IS_NODE$2?process$2.emit("unhandledRejection",n,r):dispatchEvent(UNHANDLED_REJECTION,r,n)})),e.rejection=IS_NODE$2||isUnhandled(e)?UNHANDLED:HANDLED,t.error))throw t.value}))},isUnhandled=function(e){return e.rejection!==HANDLED&&!e.parent},onHandleUnhandled=function(e){call$l(task,global$s,(function(){var t=e.facade;IS_NODE$2?process$2.emit("rejectionHandled",t):dispatchEvent(REJECTION_HANDLED,t,e.value)}))},bind$a=function(e,t,r){return function(n){e(t,n,r)}},internalReject=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=REJECTED,notify(e,!0))},internalResolve=function e(t,r,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===r)throw TypeError$6("Promise can't be resolved itself");var i=isThenable(r);i?microtask((function(){var n={done:!1};try{call$l(i,r,bind$a(e,n,t),bind$a(internalReject,n,t))}catch(error){internalReject(n,error,t)}})):(t.value=r,t.state=FULFILLED,notify(t,!1))}catch(error){internalReject({done:!1},error,t)}}};if(FORCED_PROMISE_CONSTRUCTOR$4&&(PromiseConstructor=function(e){anInstance$8(this,PromisePrototype),aCallable$8(e),call$l(Internal,this);var t=getInternalPromiseState(this);try{e(bind$a(internalResolve,t),bind$a(internalReject,t))}catch(error){internalReject(t,error)}},PromisePrototype=PromiseConstructor.prototype,Internal=function(e){setInternalState$9(this,{type:PROMISE,done:!1,notified:!1,parent:!1,reactions:new Queue,rejection:!1,state:PENDING,value:void 0})},Internal.prototype=defineBuiltIn$h(PromisePrototype,"then",(function(e,t){var r=getInternalPromiseState(this),n=newPromiseCapability$1(speciesConstructor$3(this,PromiseConstructor));return r.parent=!0,n.ok=!isCallable$c(e)||e,n.fail=isCallable$c(t)&&t,n.domain=IS_NODE$2?process$2.domain:void 0,r.state==PENDING?r.reactions.add(n):microtask((function(){callReaction(n,r)})),n.promise})),OwnPromiseCapability=function(){var e=new Internal,t=getInternalPromiseState(e);this.promise=e,this.resolve=bind$a(internalResolve,t),this.reject=bind$a(internalReject,t)},newPromiseCapabilityModule$3.f=newPromiseCapability$1=function(e){return e===PromiseConstructor||e===PromiseWrapper?new OwnPromiseCapability(e):newGenericPromiseCapability(e)},isCallable$c(NativePromiseConstructor$3)&&NativePromisePrototype$2!==Object.prototype)){nativeThen=NativePromisePrototype$2.then,NATIVE_PROMISE_SUBCLASSING||defineBuiltIn$h(NativePromisePrototype$2,"then",(function(e,t){var r=this;return new PromiseConstructor((function(e,t){call$l(nativeThen,r,e,t)})).then(e,t)}),{unsafe:!0});try{delete NativePromisePrototype$2.constructor}catch(error){}setPrototypeOf$4&&setPrototypeOf$4(NativePromisePrototype$2,PromisePrototype)}$$1c({global:!0,constructor:!0,wrap:!0,forced:FORCED_PROMISE_CONSTRUCTOR$4},{Promise:PromiseConstructor}),setToStringTag$8(PromiseConstructor,PROMISE,!1),setSpecies$4(PROMISE);var iterators={},wellKnownSymbol$f=wellKnownSymbol$u,Iterators$4=iterators,ITERATOR$a=wellKnownSymbol$f("iterator"),ArrayPrototype=Array.prototype,isArrayIteratorMethod$3=function(e){return void 0!==e&&(Iterators$4.Array===e||ArrayPrototype[ITERATOR$a]===e)},classof$9=classof$h,getMethod$4=getMethod$7,isNullOrUndefined$5=isNullOrUndefined$a,Iterators$3=iterators,wellKnownSymbol$e=wellKnownSymbol$u,ITERATOR$9=wellKnownSymbol$e("iterator"),getIteratorMethod$5=function(e){if(!isNullOrUndefined$5(e))return getMethod$4(e,ITERATOR$9)||getMethod$4(e,"@@iterator")||Iterators$3[classof$9(e)]},call$k=functionCall,aCallable$7=aCallable$c,anObject$e=anObject$p,tryToString$3=tryToString$7,getIteratorMethod$4=getIteratorMethod$5,$TypeError$6=TypeError,getIterator$4=function(e,t){var r=arguments.length<2?getIteratorMethod$4(e):t;if(aCallable$7(r))return anObject$e(call$k(r,e));throw $TypeError$6(tryToString$3(e)+" is not iterable")},call$j=functionCall,anObject$d=anObject$p,getMethod$3=getMethod$7,iteratorClose$2=function(e,t,r){var n,i;anObject$d(e);try{if(!(n=getMethod$3(e,"return"))){if("throw"===t)throw r;return r}n=call$j(n,e)}catch(error){i=!0,n=error}if("throw"===t)throw r;if(i)throw n;return anObject$d(n),r},bind$9=functionBindContext,call$i=functionCall,anObject$c=anObject$p,tryToString$2=tryToString$7,isArrayIteratorMethod$2=isArrayIteratorMethod$3,lengthOfArrayLike$g=lengthOfArrayLike$n,isPrototypeOf$7=objectIsPrototypeOf,getIterator$3=getIterator$4,getIteratorMethod$3=getIteratorMethod$5,iteratorClose$1=iteratorClose$2,$TypeError$5=TypeError,Result=function(e,t){this.stopped=e,this.result=t},ResultPrototype=Result.prototype,iterate$4=function(e,t,r){var n,i,a,o,s,u,c,l=r&&r.that,d=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),f=!(!r||!r.IS_ITERATOR),p=!(!r||!r.INTERRUPTED),g=bind$9(t,l),y=function(e){return n&&iteratorClose$1(n,"normal",e),new Result(!0,e)},m=function(e){return d?(anObject$c(e),p?g(e[0],e[1],y):g(e[0],e[1])):p?g(e,y):g(e)};if(h)n=e.iterator;else if(f)n=e;else{if(!(i=getIteratorMethod$3(e)))throw $TypeError$5(tryToString$2(e)+" is not iterable");if(isArrayIteratorMethod$2(i)){for(a=0,o=lengthOfArrayLike$g(e);o>a;a++)if((s=m(e[a]))&&isPrototypeOf$7(ResultPrototype,s))return s;return new Result(!1)}n=getIterator$3(e,i)}for(u=h?e.next:n.next;!(c=call$i(u,n)).done;){try{s=m(c.value)}catch(error){iteratorClose$1(n,"throw",error)}if("object"==_typeof$7(s)&&s&&isPrototypeOf$7(ResultPrototype,s))return s}return new Result(!1)},wellKnownSymbol$d=wellKnownSymbol$u,ITERATOR$8=wellKnownSymbol$d("iterator"),SAFE_CLOSING=!1;try{var called=0,iteratorWithReturn={next:function(){return{done:!!called++}},return:function(){SAFE_CLOSING=!0}};iteratorWithReturn[ITERATOR$8]=function(){return this},Array.from(iteratorWithReturn,(function(){throw 2}))}catch(error){}var checkCorrectnessOfIteration$4=function(e,t){if(!t&&!SAFE_CLOSING)return!1;var r=!1;try{var n={};n[ITERATOR$8]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(error){}return r},NativePromiseConstructor$2=promiseNativeConstructor,checkCorrectnessOfIteration$3=checkCorrectnessOfIteration$4,FORCED_PROMISE_CONSTRUCTOR$3=promiseConstructorDetection.CONSTRUCTOR,promiseStaticsIncorrectIteration=FORCED_PROMISE_CONSTRUCTOR$3||!checkCorrectnessOfIteration$3((function(e){NativePromiseConstructor$2.all(e).then(void 0,(function(){}))})),$$1b=_export,call$h=functionCall,aCallable$6=aCallable$c,newPromiseCapabilityModule$2=newPromiseCapability$2,perform$1=perform$3,iterate$3=iterate$4,PROMISE_STATICS_INCORRECT_ITERATION$1=promiseStaticsIncorrectIteration;$$1b({target:"Promise",stat:!0,forced:PROMISE_STATICS_INCORRECT_ITERATION$1},{all:function(e){var t=this,r=newPromiseCapabilityModule$2.f(t),n=r.resolve,i=r.reject,a=perform$1((function(){var r=aCallable$6(t.resolve),a=[],o=0,s=1;iterate$3(e,(function(e){var u=o++,c=!1;s++,call$h(r,t,e).then((function(e){c||(c=!0,a[u]=e,--s||n(a))}),i)})),--s||n(a)}));return a.error&&i(a.value),r.promise}});var $$1a=_export,FORCED_PROMISE_CONSTRUCTOR$2=promiseConstructorDetection.CONSTRUCTOR,NativePromiseConstructor$1=promiseNativeConstructor,getBuiltIn$b=getBuiltIn$j,isCallable$b=isCallable$v,defineBuiltIn$g=defineBuiltIn$l,NativePromisePrototype$1=NativePromiseConstructor$1&&NativePromiseConstructor$1.prototype;if($$1a({target:"Promise",proto:!0,forced:FORCED_PROMISE_CONSTRUCTOR$2,real:!0},{catch:function(e){return this.then(void 0,e)}}),isCallable$b(NativePromiseConstructor$1)){var method$1=getBuiltIn$b("Promise").prototype.catch;NativePromisePrototype$1.catch!==method$1&&defineBuiltIn$g(NativePromisePrototype$1,"catch",method$1,{unsafe:!0})}var $$19=_export,call$g=functionCall,aCallable$5=aCallable$c,newPromiseCapabilityModule$1=newPromiseCapability$2,perform=perform$3,iterate$2=iterate$4,PROMISE_STATICS_INCORRECT_ITERATION=promiseStaticsIncorrectIteration;$$19({target:"Promise",stat:!0,forced:PROMISE_STATICS_INCORRECT_ITERATION},{race:function(e){var t=this,r=newPromiseCapabilityModule$1.f(t),n=r.reject,i=perform((function(){var i=aCallable$5(t.resolve);iterate$2(e,(function(e){call$g(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}});var $$18=_export,call$f=functionCall,newPromiseCapabilityModule=newPromiseCapability$2,FORCED_PROMISE_CONSTRUCTOR$1=promiseConstructorDetection.CONSTRUCTOR;$$18({target:"Promise",stat:!0,forced:FORCED_PROMISE_CONSTRUCTOR$1},{reject:function(e){var t=newPromiseCapabilityModule.f(this);return call$f(t.reject,void 0,e),t.promise}});var anObject$b=anObject$p,isObject$l=isObject$y,newPromiseCapability=newPromiseCapability$2,promiseResolve$2=function(e,t){if(anObject$b(e),isObject$l(t)&&t.constructor===e)return t;var r=newPromiseCapability.f(e);return(0,r.resolve)(t),r.promise},$$17=_export,getBuiltIn$a=getBuiltIn$j,FORCED_PROMISE_CONSTRUCTOR=promiseConstructorDetection.CONSTRUCTOR,promiseResolve$1=promiseResolve$2;getBuiltIn$a("Promise"),$$17({target:"Promise",stat:!0,forced:FORCED_PROMISE_CONSTRUCTOR},{resolve:function(e){return promiseResolve$1(this,e)}});var DESCRIPTORS$n=descriptors,FUNCTION_NAME_EXISTS=functionName.EXISTS,uncurryThis$J=functionUncurryThis,defineProperty$d=objectDefineProperty.f,FunctionPrototype=Function.prototype,functionToString$1=uncurryThis$J(FunctionPrototype.toString),nameRE=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,regExpExec$3=uncurryThis$J(nameRE.exec),NAME$1="name";DESCRIPTORS$n&&!FUNCTION_NAME_EXISTS&&defineProperty$d(FunctionPrototype,NAME$1,{configurable:!0,get:function(){try{return regExpExec$3(nameRE,functionToString$1(this))[1]}catch(error){return""}}});var uncurryThis$I=functionUncurryThis,thisNumberValue$2=uncurryThis$I(1..valueOf),whitespaces$5="\t\n\v\f\r Â áš€â€€â€â€‚â€ƒâ€„â€…â€†â€‡â€ˆâ€‰â€Šâ€¯âŸã€€\u2028\u2029\ufeff",uncurryThis$H=functionUncurryThis,requireObjectCoercible$9=requireObjectCoercible$e,toString$o=toString$v,whitespaces$4=whitespaces$5,replace$9=uncurryThis$H("".replace),whitespace="["+whitespaces$4+"]",ltrim=RegExp("^"+whitespace+whitespace+"*"),rtrim=RegExp(whitespace+whitespace+"*$"),createMethod$4=function(e){return function(t){var r=toString$o(requireObjectCoercible$9(t));return 1&e&&(r=replace$9(r,ltrim,"")),2&e&&(r=replace$9(r,rtrim,"")),r}},stringTrim={start:createMethod$4(1),end:createMethod$4(2),trim:createMethod$4(3)},DESCRIPTORS$m=descriptors,global$r=global$O,uncurryThis$G=functionUncurryThis,isForced$2=isForced_1,defineBuiltIn$f=defineBuiltIn$l,hasOwn$h=hasOwnProperty_1,inheritIfRequired$4=inheritIfRequired$6,isPrototypeOf$6=objectIsPrototypeOf,isSymbol$3=isSymbol$6,toPrimitive$1=toPrimitive$3,fails$H=fails$10,getOwnPropertyNames$4=objectGetOwnPropertyNames.f,getOwnPropertyDescriptor$2=objectGetOwnPropertyDescriptor.f,defineProperty$c=objectDefineProperty.f,thisNumberValue$1=thisNumberValue$2,trim$2=stringTrim.trim,NUMBER="Number",NativeNumber=global$r[NUMBER],NumberPrototype=NativeNumber.prototype,TypeError$5=global$r.TypeError,arraySlice$9=uncurryThis$G("".slice),charCodeAt$4=uncurryThis$G("".charCodeAt),toNumeric=function(e){var t=toPrimitive$1(e,"number");return"bigint"==typeof t?t:toNumber(t)},toNumber=function(e){var t,r,n,i,a,o,s,u,c=toPrimitive$1(e,"number");if(isSymbol$3(c))throw TypeError$5("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=trim$2(c),43===(t=charCodeAt$4(c,0))||45===t){if(88===(r=charCodeAt$4(c,2))||120===r)return NaN}else if(48===t){switch(charCodeAt$4(c,1)){case 66:case 98:n=2,i=49;break;case 79:case 111:n=8,i=55;break;default:return+c}for(o=(a=arraySlice$9(c,2)).length,s=0;s<o;s++)if((u=charCodeAt$4(a,s))<48||u>i)return NaN;return parseInt(a,n)}return+c};if(isForced$2(NUMBER,!NativeNumber(" 0o1")||!NativeNumber("0b1")||NativeNumber("+0x1"))){for(var NumberWrapper=function(e){var t=arguments.length<1?0:NativeNumber(toNumeric(e)),r=this;return isPrototypeOf$6(NumberPrototype,r)&&fails$H((function(){thisNumberValue$1(r)}))?inheritIfRequired$4(Object(t),r,NumberWrapper):t},keys$6=DESCRIPTORS$m?getOwnPropertyNames$4(NativeNumber):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),j$1=0,key$3;keys$6.length>j$1;j$1++)hasOwn$h(NativeNumber,key$3=keys$6[j$1])&&!hasOwn$h(NumberWrapper,key$3)&&defineProperty$c(NumberWrapper,key$3,getOwnPropertyDescriptor$2(NativeNumber,key$3));NumberWrapper.prototype=NumberPrototype,NumberPrototype.constructor=NumberWrapper,defineBuiltIn$f(global$r,NUMBER,NumberWrapper,{constructor:!0})}var $$16=_export,$map$1=arrayIteration.map,arrayMethodHasSpeciesSupport$1=arrayMethodHasSpeciesSupport$5,HAS_SPECIES_SUPPORT$1=arrayMethodHasSpeciesSupport$1("map");$$16({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$1},{map:function(e){return $map$1(this,e,arguments.length>1?arguments[1]:void 0)}});var $$15=_export,$filter$1=arrayIteration.filter,arrayMethodHasSpeciesSupport=arrayMethodHasSpeciesSupport$5,HAS_SPECIES_SUPPORT=arrayMethodHasSpeciesSupport("filter");$$15({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT},{filter:function(e){return $filter$1(this,e,arguments.length>1?arguments[1]:void 0)}});var DESCRIPTORS$l=descriptors,uncurryThis$F=functionUncurryThis,call$e=functionCall,fails$G=fails$10,objectKeys$2=objectKeys$4,getOwnPropertySymbolsModule$2=objectGetOwnPropertySymbols,propertyIsEnumerableModule$1=objectPropertyIsEnumerable,toObject$e=toObject$k,IndexedObject$3=indexedObject,$assign=Object.assign,defineProperty$b=Object.defineProperty,concat$3=uncurryThis$F([].concat),objectAssign=!$assign||fails$G((function(){if(DESCRIPTORS$l&&1!==$assign({b:1},$assign(defineProperty$b({},"a",{enumerable:!0,get:function(){defineProperty$b(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach((function(e){t[e]=e})),7!=$assign({},e)[r]||objectKeys$2($assign({},t)).join("")!=n}))?function(e,t){for(var r=toObject$e(e),n=arguments.length,i=1,a=getOwnPropertySymbolsModule$2.f,o=propertyIsEnumerableModule$1.f;n>i;)for(var s,u=IndexedObject$3(arguments[i++]),c=a?concat$3(objectKeys$2(u),a(u)):objectKeys$2(u),l=c.length,d=0;l>d;)s=c[d++],DESCRIPTORS$l&&!call$e(o,u,s)||(r[s]=u[s]);return r}:$assign,$$14=_export,assign$4=objectAssign;$$14({target:"Object",stat:!0,arity:2,forced:Object.assign!==assign$4},{assign:assign$4});var eventemitter3={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,n,a,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,a||e,o),u=r?r+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,a=n.length,o=new Array(a);i<a;i++)o[i]=n[i].fn;return o},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,a,o){var s=r?r+e:e;if(!this._events[s])return!1;var u,c,l=this._events[s],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,i),!0;case 5:return l.fn.call(l.context,t,n,i,a),!0;case 6:return l.fn.call(l.context,t,n,i,a,o),!0}for(c=1,u=new Array(d-1);c<d;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var h,f=l.length;for(c=0;c<f;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),d){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,n);break;case 4:l[c].fn.call(l[c].context,t,n,i);break;default:if(!u)for(h=1,u=new Array(d-1);h<d;h++)u[h-1]=arguments[h];l[c].fn.apply(l[c].context,u)}}return!0},s.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||o(this,a);else{for(var u=0,c=[],l=s.length;u<l;u++)(s[u].fn!==t||i&&!s[u].once||n&&s[u].context!==n)&&c.push(s[u]);c.length?this._events[a]=1===c.length?c[0]:c:o(this,a)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}(eventemitter3);var EventEmitter$1=eventemitter3.exports,call$d=functionCall,fixRegExpWellKnownSymbolLogic$2=fixRegexpWellKnownSymbolLogic,anObject$a=anObject$p,isNullOrUndefined$4=isNullOrUndefined$a,toLength$8=toLength$b,toString$n=toString$v,requireObjectCoercible$8=requireObjectCoercible$e,getMethod$2=getMethod$7,advanceStringIndex$1=advanceStringIndex$3,regExpExec$2=regexpExecAbstract;fixRegExpWellKnownSymbolLogic$2("match",(function(e,t,r){return[function(t){var r=requireObjectCoercible$8(this),n=isNullOrUndefined$4(t)?void 0:getMethod$2(t,e);return n?call$d(n,t,r):new RegExp(t)[e](toString$n(r))},function(e){var n=anObject$a(this),i=toString$n(e),a=r(t,n,i);if(a.done)return a.value;if(!n.global)return regExpExec$2(n,i);var o=n.unicode;n.lastIndex=0;for(var s,u=[],c=0;null!==(s=regExpExec$2(n,i));){var l=toString$n(s[0]);u[c]=l,""===l&&(n.lastIndex=advanceStringIndex$1(i,toLength$8(n.lastIndex),o)),c++}return 0===c?null:u}]}));var call$c=functionCall,hasOwn$g=hasOwnProperty_1,isPrototypeOf$5=objectIsPrototypeOf,regExpFlags$1=regexpFlags$1,RegExpPrototype$5=RegExp.prototype,regexpGetFlags=function(e){var t=e.flags;return void 0!==t||"flags"in RegExpPrototype$5||hasOwn$g(e,"flags")||!isPrototypeOf$5(RegExpPrototype$5,e)?t:call$c(regExpFlags$1,e)},DESCRIPTORS$k=descriptors,global$q=global$O,uncurryThis$E=functionUncurryThis,isForced$1=isForced_1,inheritIfRequired$3=inheritIfRequired$6,createNonEnumerableProperty$5=createNonEnumerableProperty$c,getOwnPropertyNames$3=objectGetOwnPropertyNames.f,isPrototypeOf$4=objectIsPrototypeOf,isRegExp$1=isRegexp,toString$m=toString$v,getRegExpFlags$1=regexpGetFlags,stickyHelpers=regexpStickyHelpers,proxyAccessor=proxyAccessor$2,defineBuiltIn$e=defineBuiltIn$l,fails$F=fails$10,hasOwn$f=hasOwnProperty_1,enforceInternalState$2=internalState.enforce,setSpecies$3=setSpecies$5,wellKnownSymbol$c=wellKnownSymbol$u,UNSUPPORTED_DOT_ALL$1=regexpUnsupportedDotAll,UNSUPPORTED_NCG=regexpUnsupportedNcg,MATCH$1=wellKnownSymbol$c("match"),NativeRegExp=global$q.RegExp,RegExpPrototype$4=NativeRegExp.prototype,SyntaxError$1=global$q.SyntaxError,exec$7=uncurryThis$E(RegExpPrototype$4.exec),charAt$a=uncurryThis$E("".charAt),replace$8=uncurryThis$E("".replace),stringIndexOf$2=uncurryThis$E("".indexOf),stringSlice$a=uncurryThis$E("".slice),IS_NCG=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,re1=/a/g,re2=/a/g,CORRECT_NEW=new NativeRegExp(re1)!==re1,MISSED_STICKY$1=stickyHelpers.MISSED_STICKY,UNSUPPORTED_Y=stickyHelpers.UNSUPPORTED_Y,BASE_FORCED=DESCRIPTORS$k&&(!CORRECT_NEW||MISSED_STICKY$1||UNSUPPORTED_DOT_ALL$1||UNSUPPORTED_NCG||fails$F((function(){return re2[MATCH$1]=!1,NativeRegExp(re1)!=re1||NativeRegExp(re2)==re2||"/a/i"!=NativeRegExp(re1,"i")}))),handleDotAll=function(e){for(var t,r=e.length,n=0,i="",a=!1;n<=r;n++)"\\"!==(t=charAt$a(e,n))?a||"."!==t?("["===t?a=!0:"]"===t&&(a=!1),i+=t):i+="[\\s\\S]":i+=t+charAt$a(e,++n);return i},handleNCG=function(e){for(var t,r=e.length,n=0,i="",a=[],o={},s=!1,u=!1,c=0,l="";n<=r;n++){if("\\"===(t=charAt$a(e,n)))t+=charAt$a(e,++n);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:exec$7(IS_NCG,stringSlice$a(e,n+1))&&(n+=2,u=!0),i+=t,c++;continue;case">"===t&&u:if(""===l||hasOwn$f(o,l))throw new SyntaxError$1("Invalid capture group name");o[l]=!0,a[a.length]=[l,c],u=!1,l="";continue}u?l+=t:i+=t}return[i,a]};if(isForced$1("RegExp",BASE_FORCED)){for(var RegExpWrapper=function(e,t){var r,n,i,a,o,s,u=isPrototypeOf$4(RegExpPrototype$4,this),c=isRegExp$1(e),l=void 0===t,d=[],h=e;if(!u&&c&&l&&e.constructor===RegExpWrapper)return e;if((c||isPrototypeOf$4(RegExpPrototype$4,e))&&(e=e.source,l&&(t=getRegExpFlags$1(h))),e=void 0===e?"":toString$m(e),t=void 0===t?"":toString$m(t),h=e,UNSUPPORTED_DOT_ALL$1&&"dotAll"in re1&&(n=!!t&&stringIndexOf$2(t,"s")>-1)&&(t=replace$8(t,/s/g,"")),r=t,MISSED_STICKY$1&&"sticky"in re1&&(i=!!t&&stringIndexOf$2(t,"y")>-1)&&UNSUPPORTED_Y&&(t=replace$8(t,/y/g,"")),UNSUPPORTED_NCG&&(e=(a=handleNCG(e))[0],d=a[1]),o=inheritIfRequired$3(NativeRegExp(e,t),u?this:RegExpPrototype$4,RegExpWrapper),(n||i||d.length)&&(s=enforceInternalState$2(o),n&&(s.dotAll=!0,s.raw=RegExpWrapper(handleDotAll(e),r)),i&&(s.sticky=!0),d.length&&(s.groups=d)),e!==h)try{createNonEnumerableProperty$5(o,"source",""===h?"(?:)":h)}catch(error){}return o},keys$5=getOwnPropertyNames$3(NativeRegExp),index$4=0;keys$5.length>index$4;)proxyAccessor(RegExpWrapper,NativeRegExp,keys$5[index$4++]);RegExpPrototype$4.constructor=RegExpWrapper,RegExpWrapper.prototype=RegExpPrototype$4,defineBuiltIn$e(global$q,"RegExp",RegExpWrapper,{constructor:!0})}setSpecies$3("RegExp");var makeBuiltIn=makeBuiltIn$3.exports,defineProperty$a=objectDefineProperty,defineBuiltInAccessor$5=function(e,t,r){return r.get&&makeBuiltIn(r.get,t,{getter:!0}),r.set&&makeBuiltIn(r.set,t,{setter:!0}),defineProperty$a.f(e,t,r)},DESCRIPTORS$j=descriptors,UNSUPPORTED_DOT_ALL=regexpUnsupportedDotAll,classof$8=classofRaw$2,defineBuiltInAccessor$4=defineBuiltInAccessor$5,getInternalState$8=internalState.get,RegExpPrototype$3=RegExp.prototype,$TypeError$4=TypeError;DESCRIPTORS$j&&UNSUPPORTED_DOT_ALL&&defineBuiltInAccessor$4(RegExpPrototype$3,"dotAll",{configurable:!0,get:function(){if(this!==RegExpPrototype$3){if("RegExp"===classof$8(this))return!!getInternalState$8(this).dotAll;throw $TypeError$4("Incompatible receiver, RegExp required")}}});var DESCRIPTORS$i=descriptors,MISSED_STICKY=regexpStickyHelpers.MISSED_STICKY,classof$7=classofRaw$2,defineBuiltInAccessor$3=defineBuiltInAccessor$5,getInternalState$7=internalState.get,RegExpPrototype$2=RegExp.prototype,$TypeError$3=TypeError;DESCRIPTORS$i&&MISSED_STICKY&&defineBuiltInAccessor$3(RegExpPrototype$2,"sticky",{configurable:!0,get:function(){if(this!==RegExpPrototype$2){if("RegExp"===classof$7(this))return!!getInternalState$7(this).sticky;throw $TypeError$3("Incompatible receiver, RegExp required")}}});var PROPER_FUNCTION_NAME$3=functionName.PROPER,defineBuiltIn$d=defineBuiltIn$l,anObject$9=anObject$p,$toString$3=toString$v,fails$E=fails$10,getRegExpFlags=regexpGetFlags,TO_STRING$1="toString",RegExpPrototype$1=RegExp.prototype,nativeToString=RegExpPrototype$1[TO_STRING$1],NOT_GENERIC=fails$E((function(){return"/a/b"!=nativeToString.call({source:"a",flags:"b"})})),INCORRECT_NAME=PROPER_FUNCTION_NAME$3&&nativeToString.name!=TO_STRING$1;(NOT_GENERIC||INCORRECT_NAME)&&defineBuiltIn$d(RegExp.prototype,TO_STRING$1,(function(){var e=anObject$9(this);return"/"+$toString$3(e.source)+"/"+$toString$3(getRegExpFlags(e))}),{unsafe:!0});var PROPER_FUNCTION_NAME$2=functionName.PROPER,fails$D=fails$10,whitespaces$3=whitespaces$5,non="â€‹Â…á Ž",stringTrimForced=function(e){return fails$D((function(){return!!whitespaces$3[e]()||non[e]()!==non||PROPER_FUNCTION_NAME$2&&whitespaces$3[e].name!==e}))},$$13=_export,$trim=stringTrim.trim,forcedStringTrimMethod=stringTrimForced;$$13({target:"String",proto:!0,forced:forcedStringTrimMethod("trim")},{trim:function(){return $trim(this)}});var uncurryThis$D=functionUncurryThis,toObject$d=toObject$k,floor$8=Math.floor,charAt$9=uncurryThis$D("".charAt),replace$7=uncurryThis$D("".replace),stringSlice$9=uncurryThis$D("".slice),SUBSTITUTION_SYMBOLS=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,SUBSTITUTION_SYMBOLS_NO_NAMED=/\$([$&'`]|\d{1,2})/g,getSubstitution$1=function(e,t,r,n,i,a){var o=r+e.length,s=n.length,u=SUBSTITUTION_SYMBOLS_NO_NAMED;return void 0!==i&&(i=toObject$d(i),u=SUBSTITUTION_SYMBOLS),replace$7(a,u,(function(a,u){var c;switch(charAt$9(u,0)){case"$":return"$";case"&":return e;case"`":return stringSlice$9(t,0,r);case"'":return stringSlice$9(t,o);case"<":c=i[stringSlice$9(u,1,-1)];break;default:var l=+u;if(0===l)return a;if(l>s){var d=floor$8(l/10);return 0===d?a:d<=s?void 0===n[d-1]?charAt$9(u,1):n[d-1]+charAt$9(u,1):a}c=n[l-1]}return void 0===c?"":c}))},apply$6=functionApply,call$b=functionCall,uncurryThis$C=functionUncurryThis,fixRegExpWellKnownSymbolLogic$1=fixRegexpWellKnownSymbolLogic,fails$C=fails$10,anObject$8=anObject$p,isCallable$a=isCallable$v,isNullOrUndefined$3=isNullOrUndefined$a,toIntegerOrInfinity$a=toIntegerOrInfinity$f,toLength$7=toLength$b,toString$l=toString$v,requireObjectCoercible$7=requireObjectCoercible$e,advanceStringIndex=advanceStringIndex$3,getMethod$1=getMethod$7,getSubstitution=getSubstitution$1,regExpExec$1=regexpExecAbstract,wellKnownSymbol$b=wellKnownSymbol$u,REPLACE=wellKnownSymbol$b("replace"),max$2=Math.max,min$4=Math.min,concat$2=uncurryThis$C([].concat),push$8=uncurryThis$C([].push),stringIndexOf$1=uncurryThis$C("".indexOf),stringSlice$8=uncurryThis$C("".slice),maybeToString=function(e){return void 0===e?e:String(e)},REPLACE_KEEPS_$0="$0"==="a".replace(/./,"$0"),REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE=!!/./[REPLACE]&&""===/./[REPLACE]("a","$0"),REPLACE_SUPPORTS_NAMED_GROUPS=!fails$C((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}));fixRegExpWellKnownSymbolLogic$1("replace",(function(e,t,r){var n=REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE?"$":"$0";return[function(e,r){var n=requireObjectCoercible$7(this),i=isNullOrUndefined$3(e)?void 0:getMethod$1(e,REPLACE);return i?call$b(i,e,n,r):call$b(t,toString$l(n),e,r)},function(e,i){var a=anObject$8(this),o=toString$l(e);if("string"==typeof i&&-1===stringIndexOf$1(i,n)&&-1===stringIndexOf$1(i,"$<")){var s=r(t,a,o,i);if(s.done)return s.value}var u=isCallable$a(i);u||(i=toString$l(i));var c=a.global;if(c){var l=a.unicode;a.lastIndex=0}for(var d=[];;){var h=regExpExec$1(a,o);if(null===h)break;if(push$8(d,h),!c)break;""===toString$l(h[0])&&(a.lastIndex=advanceStringIndex(o,toLength$7(a.lastIndex),l))}for(var f="",p=0,g=0;g<d.length;g++){for(var y=toString$l((h=d[g])[0]),m=max$2(min$4(toIntegerOrInfinity$a(h.index),o.length),0),v=[],_=1;_<h.length;_++)push$8(v,maybeToString(h[_]));var b=h.groups;if(u){var A=concat$2([y],v,m,o);void 0!==b&&push$8(A,b);var E=toString$l(apply$6(i,void 0,A))}else E=getSubstitution(y,o,m,v,b,i);m>=p&&(f+=stringSlice$8(o,p,m)+E,p=m+y.length)}return f+stringSlice$8(o,p)}]}),!REPLACE_SUPPORTS_NAMED_GROUPS||!REPLACE_KEEPS_$0||REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE);var arraySlice$8=arraySliceSimple,floor$7=Math.floor,mergeSort=function e(t,r){var n=t.length,i=floor$7(n/2);return n<8?insertionSort(t,r):merge(t,e(arraySlice$8(t,0,i),r),e(arraySlice$8(t,i),r),r)},insertionSort=function(e,t){for(var r,n,i=e.length,a=1;a<i;){for(n=a,r=e[a];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==a++&&(e[n]=r)}return e},merge=function(e,t,r,n){for(var i=t.length,a=r.length,o=0,s=0;o<i||s<a;)e[o+s]=o<i&&s<a?n(t[o],r[s])<=0?t[o++]:r[s++]:o<i?t[o++]:r[s++];return e},arraySort$1=mergeSort,userAgent$3=engineUserAgent,firefox=userAgent$3.match(/firefox\/(\d+)/i),engineFfVersion=!!firefox&&+firefox[1],UA=engineUserAgent,engineIsIeOrEdge=/MSIE|Trident/.test(UA),userAgent$2=engineUserAgent,webkit=userAgent$2.match(/AppleWebKit\/(\d+)\./),engineWebkitVersion=!!webkit&&+webkit[1],$$12=_export,uncurryThis$B=functionUncurryThis,aCallable$4=aCallable$c,toObject$c=toObject$k,lengthOfArrayLike$f=lengthOfArrayLike$n,deletePropertyOrThrow$2=deletePropertyOrThrow$4,toString$k=toString$v,fails$B=fails$10,internalSort$1=arraySort$1,arrayMethodIsStrict$5=arrayMethodIsStrict$8,FF$2=engineFfVersion,IE_OR_EDGE$1=engineIsIeOrEdge,V8$1=engineV8Version,WEBKIT$1=engineWebkitVersion,test$1=[],nativeSort$1=uncurryThis$B(test$1.sort),push$7=uncurryThis$B(test$1.push),FAILS_ON_UNDEFINED=fails$B((function(){test$1.sort(void 0)})),FAILS_ON_NULL=fails$B((function(){test$1.sort(null)})),STRICT_METHOD$5=arrayMethodIsStrict$5("sort"),STABLE_SORT$1=!fails$B((function(){if(V8$1)return V8$1<70;if(!(FF$2&&FF$2>3)){if(IE_OR_EDGE$1)return!0;if(WEBKIT$1)return WEBKIT$1<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)test$1.push({k:t+n,v:r})}for(test$1.sort((function(e,t){return t.v-e.v})),n=0;n<test$1.length;n++)t=test$1[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}})),FORCED$c=FAILS_ON_UNDEFINED||!FAILS_ON_NULL||!STRICT_METHOD$5||!STABLE_SORT$1,getSortCompare$1=function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:toString$k(t)>toString$k(r)?1:-1}};$$12({target:"Array",proto:!0,forced:FORCED$c},{sort:function(e){void 0!==e&&aCallable$4(e);var t=toObject$c(this);if(STABLE_SORT$1)return void 0===e?nativeSort$1(t):nativeSort$1(t,e);var r,n,i=[],a=lengthOfArrayLike$f(t);for(n=0;n<a;n++)n in t&&push$7(i,t[n]);for(internalSort$1(i,getSortCompare$1(e)),r=lengthOfArrayLike$f(i),n=0;n<r;)t[n]=i[n++];for(;n<a;)deletePropertyOrThrow$2(t,n++);return t}});var XG_DEBUG_OPEN="undefined"!=typeof window&&window.location&&window.location.href.indexOf("xgplayerdebugger=1")>-1,STYLE={info:"color: #525252; background-color: #90ee90;",error:"color: #525252; background-color: red;",warn:"color: #525252; background-color: yellow; "},XGTAG="%c[xgplayer]",XG_DEBUG={config:{debug:XG_DEBUG_OPEN?3:1},logInfo:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this.config.debug>=3&&(t=console).log.apply(t,[XGTAG,STYLE.info,e].concat(n))},logWarn:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this.config.debug>=1&&(t=console).warn.apply(t,[XGTAG,STYLE.warn,e].concat(n))},logError:function(e){var t;if(!(this.config.debug<1)){for(var r=this.config.debug>=2?"trace":"error",n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];(t=console)[r].apply(t,[XGTAG,STYLE.error,e].concat(i))}}};function bindDebug(e){e.logInfo=XG_DEBUG.logInfo.bind(e),e.logWarn=XG_DEBUG.logWarn.bind(e),e.logError=XG_DEBUG.logError.bind(e)}var XgplayerTimeRange=function(){function e(t){_classCallCheck$7(this,e),this.bufferedList=t}return _createClass$8(e,[{key:"start",value:function(e){return this.bufferedList[e].start}},{key:"end",value:function(e){return this.bufferedList[e].end}},{key:"length",get:function(){return this.bufferedList.length}}]),e}(),util$2={};function checkIsIn(e,t){for(var r=0,n=t.length;r<n;r++)if(e.indexOf(t[r])>-1)return!0;return!1}util$2.createDom=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=document.createElement(e);return i.className=n,i.innerHTML=t,Object.keys(r).forEach((function(t){var n=t,a=r[t];"video"===e||"audio"===e||"live-video"===e?a&&i.setAttribute(n,a):i.setAttribute(n,a)})),i},util$2.createDomFromHtml=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{var n=document.createElement("div");n.innerHTML=e;var i=n.children;return n=null,i.length>0?(i=i[0],r&&util$2.addClass(i,r),t&&Object.keys(t).forEach((function(e){i.setAttribute(e,t[e])})),i):null}catch(a){return XG_DEBUG.logError("util.createDomFromHtml",a),null}},util$2.hasClass=function(t,r){if(!t||!r)return!1;try{return Array.prototype.some.call(t.classList,(function(e){return e===r}))}catch(e){var n=t.className&&"object"===_typeof$6(t.className)?t.getAttribute("class"):t.className;return n&&!!n.match(new RegExp("(\\s|^)"+r+"(\\s|$)"))}},util$2.addClass=function(t,r){if(t&&r)try{r.trim().split(/\s+/g).forEach((function(e){e&&t.classList.add(e)}))}catch(e){util$2.hasClass(t,r)||(t.className&&"object"===_typeof$6(t.className)?t.setAttribute("class",t.getAttribute("class")+" "+r):t.className+=" "+r)}},util$2.removeClass=function(t,r){if(t&&r)try{r.trim().split(/\s+/g).forEach((function(e){e&&t.classList.remove(e)}))}catch(e){util$2.hasClass(t,r)&&r.split(/\s+/g).forEach((function(e){var r=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className&&"object"===_typeof$6(t.className)?t.setAttribute("class",t.getAttribute("class").replace(r," ")):t.className=t.className.replace(r," ")}))}},util$2.toggleClass=function(e,t){e&&t.split(/\s+/g).forEach((function(t){util$2.hasClass(e,t)?util$2.removeClass(e,t):util$2.addClass(e,t)}))},util$2.classNames=function(){for(var e=arguments,t=[],r=function(r){"String"===util$2.typeOf(e[r])?t.push(e[r]):"Object"===util$2.typeOf(e[r])&&Object.keys(e[r]).map((function(n){e[r][n]&&t.push(n)}))},n=0;n<arguments.length;n++)r(n);return t.join(" ")},util$2.findDom=function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,n=arguments.length>1?arguments[1]:void 0;try{t=r.querySelector(n)}catch(e){XG_DEBUG.logError("util.findDom",e),0===n.indexOf("#")&&(t=r.getElementById(n.slice(1)))}return t},util$2.getCss=function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,!1)[t]},util$2.padStart=function(e,t,r){for(var n=String(r),i=t>>0,a=Math.ceil(i/n.length),o=[],s=String(e);a--;)o.push(n);return o.join("").substring(0,i-s.length)+s},util$2.format=function(e){if(window.isNaN(e))return"";e=Math.round(e);var t=util$2.padStart(Math.floor(e/3600),2,0),r=util$2.padStart(Math.floor((e-3600*t)/60),2,0),n=util$2.padStart(Math.floor(e-3600*t-60*r),2,0);return("00"===t?[r,n]:[t,r,n]).join(":")},util$2.event=function(e){if(e.touches){var t=e.touches[0]||e.changedTouches[0];e.clientX=t.clientX||0,e.clientY=t.clientY||0,e.offsetX=t.pageX-t.target.offsetLeft,e.offsetY=t.pageY-t.target.offsetTop}e._target=e.target||e.srcElement},util$2.typeOf=function(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]},util$2.deepCopy=function(e,t){if("Object"===util$2.typeOf(t)&&"Object"===util$2.typeOf(e))return Object.keys(t).forEach((function(r){"Object"!==util$2.typeOf(t[r])||t[r]instanceof Node?"Array"===util$2.typeOf(t[r])?e[r]="Array"===util$2.typeOf(e[r])?e[r].concat(t[r]):t[r]:e[r]=t[r]:void 0===e[r]||void 0===e[r]?e[r]=t[r]:util$2.deepCopy(e[r],t[r])})),e},util$2.deepMerge=function(e,t){return Object.keys(t).map((function(r){var n;"Array"===util$2.typeOf(t[r])&&"Array"===util$2.typeOf(e[r])?"Array"===util$2.typeOf(e[r])&&(n=e[r]).push.apply(n,_toConsumableArray$2(t[r])):util$2.typeOf(e[r])!==util$2.typeOf(t[r])||null===e[r]||"Object"!==util$2.typeOf(e[r])||t[r]instanceof window.Node?null!==t[r]&&(e[r]=t[r]):util$2.deepMerge(e[r],t[r])})),e},util$2.getBgImage=function(e){var t=(e.currentStyle||window.getComputedStyle(e,null)).backgroundImage;if(!t||"none"===t)return"";var r=document.createElement("a");return r.href=t.replace(/url\("|"\)/g,""),r.href},util$2.copyDom=function(e){if(e&&1===e.nodeType){var t=document.createElement(e.tagName);return Array.prototype.forEach.call(e.attributes,(function(e){t.setAttribute(e.name,e.value)})),e.innerHTML&&(t.innerHTML=e.innerHTML),t}return""},util$2.setInterval=function(e,t,r,n){e._interval[t]||(e._interval[t]=setInterval(r.bind(e),n))},util$2.clearInterval=function(e,t){clearInterval(e._interval[t]),e._interval[t]=null},util$2.setTimeout=function(e,t,r){e._timers||(e._timers=[]);var n=setTimeout((function(){t(),util$2.clearTimeout(e,n)}),r);return e._timers.push(n),n},util$2.clearTimeout=function(e,t){var r=e._timers;if("Array"===util$2.typeOf(r)){for(var n=0;n<r.length;n++)if(r[n]===t){r.splice(n,1),clearTimeout(t);break}}else clearTimeout(t)},util$2.clearAllTimers=function(e){var t=e._timers;"Array"===util$2.typeOf(t)&&(t.map((function(e){clearTimeout(e)})),e._timerIds=[])},util$2.createImgBtn=function(e,t,r,n){var i,a,o,s=util$2.createDom("xg-".concat(e),"",{},"xgplayer-".concat(e,"-img"));(s.style.backgroundImage='url("'.concat(t,'")'),r&&n)&&(["px","rem","em","pt","dp","vw","vh","vm","%"].every((function(e){return!(r.indexOf(e)>-1&&n.indexOf(e)>-1)||(i=parseFloat(r.slice(0,r.indexOf(e)).trim()),a=parseFloat(n.slice(0,n.indexOf(e)).trim()),o=e,!1)})),s.style.width="".concat(i).concat(o),s.style.height="".concat(a).concat(o),s.style.backgroundSize="".concat(i).concat(o," ").concat(a).concat(o),s.style.margin="start"===e?"-".concat(a/2).concat(o," auto auto -").concat(i/2).concat(o):"auto 5px auto 5px");return s},util$2.Hex2RGBA=function(e,t){var r=[];if(/^\#[0-9A-F]{3}$/i.test(e)){var n="#";e.replace(/[0-9A-F]/gi,(function(e){n+=e+e})),e=n}return/^#[0-9A-F]{6}$/i.test(e)?(e.replace(/[0-9A-F]{2}/gi,(function(e){r.push(parseInt(e,16))})),"rgba(".concat(r.join(","),", ").concat(t,")")):"rgba(255, 255, 255, 0.1)"},util$2.getFullScreenEl=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},util$2.checkIsFunction=function(e){return e&&"function"==typeof e},util$2.checkIsObject=function(e){return null!==e&&"object"===_typeof$6(e)},util$2.hide=function(e){e.style.display="none"},util$2.show=function(e,t){e.style.display=t||"block"},util$2.isUndefined=function(e){if(null==e)return!0},util$2.setStyleFromCsstext=function(e,t){t&&("String"===util$2.typeOf(t)?t.replace(/\s+/g,"").split(";").map((function(t){if(t){var r=t.split(":");r.length>1&&(e.style[r[0]]=r[1])}})):Object.keys(t).map((function(r){e.style[r]=t[r]})))},util$2.filterStyleFromText=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["width","height","top","left","bottom","right","position","z-index","padding","margin","transform"],r=e.style.cssText;if(!r)return{};var n=r.replace(/\s+/g,"").split(";"),i={},a={};return n.map((function(e){if(e){var r=e.split(":");r.length>1&&(checkIsIn(r[0],t)?i[r[0]]=r[1]:a[r[0]]=r[1])}})),e.setAttribute("style",""),Object.keys(a).map((function(t){e.style[t]=a[t]})),i},util$2.getStyleFromCsstext=function(e){var t=e.style.cssText;if(!t)return{};var r=t.replace(/\s+/g,"").split(";"),n={};return r.map((function(e){if(e){var t=e.split(":");t.length>1&&(n[t[0]]=t[1])}})),n},util$2.preloadImg=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(e){var n=new window.Image;n.complete?t&&t():(n.onload=function(e){n=null,t&&t(e)},n.onerror=function(e){n=null,r&&r(e)}),n.src=e}},util$2.stopPropagation=function(e){e&&(e.stopPropagation(),e.cancelable&&e.preventDefault())},util$2.scrollTop=function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},util$2.scrollLeft=function(){return window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0},util$2.checkTouchSupport=function(){return"ontouchstart"in window},util$2.getBuffered2=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,r=[],n=0;n<e.length;n++)r.push({start:e.start(n)<.5?0:e.start(n),end:e.end(n)});r.sort((function(e,t){var r=e.start-t.start;return r||t.end-e.end}));var i=[];if(t)for(var a=0;a<r.length;a++){var o=i.length;if(o){var s=i[o-1].end;r[a].start-s<t?r[a].end>s&&(i[o-1].end=r[a].end):i.push(r[a])}else i.push(r[a])}else i=r;return new XgplayerTimeRange(i)},util$2.getEventPos=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return{x:e.x/t,y:e.y/t,clientX:e.clientX/t,clientY:e.clientY/t,offsetX:e.offsetX/t,offsetY:e.offsetY/t,pageX:e.pageX/t,pageY:e.pageY/t}},util$2.requestAnimationFrame=function(e){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(t)return t(e)},util$2.getHostFromUrl=function(e){if(null==e||""===e||"string"!=typeof e)return"";var t=e.split("/"),r="";return t.length>3&&t[2]&&(r=t[2]),r},util$2.cancelAnimationFrame=function(e){var t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame;t&&t(e)};var VERSION_REG={android:/(Android)\s([\d.]+)/,ios:/(Version)\/([\d.]+)/},H264_MIMETYPES=["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"],sniffer$1={get device(){return sniffer$1.os.isPc?"pc":"mobile"},get browser(){if("undefined"==typeof navigator)return"";var e=navigator.userAgent.toLowerCase(),t={ie:/rv:([\d.]+)\) like gecko/,firefox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(t).filter((function(r){return t[r].test(e)})))[0]},get os(){if("undefined"==typeof navigator)return{};var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),r=/(?:SymbianOS)/.test(e)||t,n=/(?:Android)/.test(e),i=/(?:Firefox)/.test(e),a=/(?:iPad|PlayBook)/.test(e)||n&&!/(?:Mobile)/.test(e)||i&&/(?:Tablet)/.test(e),o=/(?:iPhone)/.test(e)&&!a,s=!(o||n||r||a),u=/(?:iPad|PlayBook)/.test(e);return{isTablet:a,isPhone:o,isIpad:u,isIos:o||u,isAndroid:n,isPc:s,isSymbian:r,isWindowsPhone:t,isFireFox:i}},get osVersion(){var e=navigator.userAgent,t="",r=(t=/(?:iPhone)|(?:iPad|PlayBook)/.test(e)?VERSION_REG.ios:VERSION_REG.android)?t.exec(e):[];if(r&&r.length>=3){var n=r[2].split(".");return n.length>0?parseInt(n[0]):0}return 0},get isWeixin(){if("undefined"==typeof navigator)return!1;return!!/(micromessenger)\/([\d.]+)/.exec(navigator.userAgent.toLocaleLowerCase())||void 0},isSupportMP4:function(){if(this.supportResult)return this.supportResult;var e=document.createElement("video"),t={isSupport:!1,mime:""};return"function"==typeof e.canPlayType&&H264_MIMETYPES.map((function(r){"probably"===e.canPlayType('video/mp4; codecs="'.concat(r,'"'))&&(t.isSupport=!0,t.mime+="||".concat(r))})),this.supportResult=t,e=null,t}},version$4="3.0.0-next.28",ERROR_TYPE_MAP={1:"network",2:"network",3:"decoder",4:"format"},Errors$1=_createClass$8((function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{errorType:"",errorCode:0,errorMessage:"",originError:"",ext:{},mediaError:null};_classCallCheck$7(this,e);var n=t&&t.i18n?t.i18n.ERROR_TYPES:null;if(t.video){var i=r.mediaError?r.mediaError:t.video.error||{},a=t.duration,o=t.currentTime,s=t.ended,u=t.src,c=t.currentSrc,l=t.video,d=l.readyState,h=l.networkState,f={playerVersion:version$4,currentTime:o,duration:a,ended:s,readyState:d,networkState:h,src:u||c,errorType:r.errorType,errorCode:r.errorCode||i.code,message:r.errorMessage||i.message,mediaError:i,originError:r.originError?r.originError.stack:""};return r.ext&&Object.keys(r.ext).map((function(e){f[e]=r.ext[e]})),f}if(arguments.length>1){for(var p={playerVersion:version$4,domain:document.domain},g=["errorType","currentTime","duration","networkState","readyState","src","currentSrc","ended","errd","errorCode","mediaError"],y=0;y<arguments.length;y++)p[g[y]]=arguments[y];return p.ex=n?(n[arguments[0]]||{}).msg:"",p}})),PLAY="play",PLAYING="playing",ENDED="ended",PAUSE="pause",ERROR$3="error",SEEKING="seeking",SEEKED="seeked",TIME_UPDATE="timeupdate",WAITING="waiting",CANPLAY="canplay",CANPLAY_THROUGH="canplaythrough",DURATION_CHANGE="durationchange",VOLUME_CHANGE="volumechange",LOADED_DATA="loadeddata",RATE_CHANGE="ratechange",PROGRESS="progress",LOAD_START="loadstart",EMPTIED="emptied",STALLED="stalled",SUSPEND="suspend",ABORT="abort",BUFFER_CHANGE="bufferedChange",PLAYER_FOCUS="focus",PLAYER_BLUR="blur",READY="ready",URL_NULL="urlNull",AUTOPLAY_STARTED="autoplay_started",AUTOPLAY_PREVENTED="autoplay_was_prevented",COMPLETE="complete",REPLAY="replay",DESTROY="destroy",URL_CHANGE="urlchange",FULLSCREEN_CHANGE="fullscreen_change",CSS_FULLSCREEN_CHANGE="cssFullscreen_change",MINI_STATE_CHANGE="mini_state_change",DEFINITION_CHANGE="definition_change",BEFORE_DEFINITION_CHANGE="before_definition_change",AFTER_DEFINITION_CHANGE="after_definition_change",SEI_PARSED="SEI_PARSED",RETRY="retry",VIDEO_RESIZE="video_resize",PIP_CHANGE="pip_change",ROTATE="rotate",SCREEN_SHOT="screenShot",PLAYNEXT="playnext",SHORTCUT="shortcut",XGLOG="xglog",USER_ACTION="user_action",USER_ACTION1="user_action1",VIDEO_EVENTS=["play","playing","ended","pause","error","seeking","seeked","timeupdate","waiting","canplay","canplaythrough","durationchange","volumechange","loadeddata","ratechange","progress","loadstart","emptied","stalled","suspend","abort"],STATS_EVENTS$2={STATS_INFO:"stats_info",STATS_DOWNLOAD:"stats_download",STATS_RESET:"stats_reset"},Events$1=Object.freeze(Object.defineProperty({__proto__:null,ABORT:ABORT,AFTER_DEFINITION_CHANGE:AFTER_DEFINITION_CHANGE,AUTOPLAY_PREVENTED:AUTOPLAY_PREVENTED,AUTOPLAY_STARTED:AUTOPLAY_STARTED,BEFORE_DEFINITION_CHANGE:BEFORE_DEFINITION_CHANGE,BUFFER_CHANGE:BUFFER_CHANGE,CANPLAY:CANPLAY,CANPLAY_THROUGH:CANPLAY_THROUGH,COMPLETE:COMPLETE,CSS_FULLSCREEN_CHANGE:CSS_FULLSCREEN_CHANGE,DEFINITION_CHANGE:DEFINITION_CHANGE,DESTROY:DESTROY,DURATION_CHANGE:DURATION_CHANGE,EMPTIED:EMPTIED,ENDED:ENDED,ERROR:ERROR$3,FULLSCREEN_CHANGE:FULLSCREEN_CHANGE,LOADED_DATA:LOADED_DATA,LOAD_START:LOAD_START,MINI_STATE_CHANGE:MINI_STATE_CHANGE,PAUSE:PAUSE,PIP_CHANGE:PIP_CHANGE,PLAY:PLAY,PLAYER_BLUR:PLAYER_BLUR,PLAYER_FOCUS:PLAYER_FOCUS,PLAYING:PLAYING,PLAYNEXT:PLAYNEXT,PROGRESS:PROGRESS,RATE_CHANGE:RATE_CHANGE,READY:READY,REPLAY:REPLAY,RETRY:RETRY,ROTATE:ROTATE,SCREEN_SHOT:SCREEN_SHOT,SEEKED:SEEKED,SEEKING:SEEKING,SEI_PARSED:SEI_PARSED,SHORTCUT:SHORTCUT,STALLED:STALLED,STATS_EVENTS:STATS_EVENTS$2,SUSPEND:SUSPEND,TIME_UPDATE:TIME_UPDATE,URL_CHANGE:URL_CHANGE,URL_NULL:URL_NULL,USER_ACTION:USER_ACTION,USER_ACTION1:USER_ACTION1,VIDEO_EVENTS:VIDEO_EVENTS,VIDEO_RESIZE:VIDEO_RESIZE,VOLUME_CHANGE:VOLUME_CHANGE,WAITING:WAITING,XGLOG:XGLOG},Symbol.toStringTag,{value:"Module"}));function emitVideoEvent(e,t){this&&this.emit&&("error"===e?this.errorHandler(e):this.emit(e,t))}function getVideoEventHandler(e,t){return function(r){var n={player:t,eventName:e,originalEvent:r,detail:r.detail||{},timeStamp:r.timeStamp,currentTime:t.currentTime,duration:t.duration,paused:t.paused,ended:t.ended,isInternalOp:!!t._internalOp[r.type],muted:t.muted,volume:t.volume,host:util$2.getHostFromUrl(t.currentSrc),vtype:t.vtype};if(t.removeInnerOP(r.type),"timeupdate"===e&&(t._currentTime=t.video&&t.video.currentTime),"durationchange"===e&&(t._duration=t.video.duration),"volumechange"===e&&(n.isMutedChange=t._lastMuted!==t.muted,t._lastMuted=t.muted),t.videoEventMiddleware[e])try{t.videoEventMiddleware[e].call(t,n,emitVideoEvent.bind(t))}catch(i){throw emitVideoEvent.call(t,e,n),i}else emitVideoEvent.call(t,e,n)}}var VideoProxy=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(e){var n;_classCallCheck$7(this,r),(n=t.call(this,e))._hasStart=!1,n._currentTime=0,n._duration=0,n._internalOp={},n._lastMuted=!1,n.vtype="MP4",n.videoConfig=Object.assign({},{controls:!1,autoplay:e.autoplay,playsinline:e.playsinline,"x5-playsinline":e.playsinline,"webkit-playsinline":e.playsinline,"x5-video-player-fullscreen":e["x5-video-player-fullscreen"]||e.x5VideoPlayerFullscreen,"x5-video-orientation":e["x5-video-orientation"]||e.x5VideoOrientation,airplay:e.airplay,"webkit-airplay":e.airplay,tabindex:2,mediaType:e.mediaType||"video"},e.videoConfig,e.videoAttributes);var i=e["x5-video-player-type"]||e.x5VideoPlayerType;return sniffer$1.isWeixin&&sniffer$1.os.isAndroid&&i&&(n.videoConfig["x5-video-player-type"]=i,delete n.videoConfig.playsinline,delete n.videoConfig["webkit-playsinline"],delete n.videoConfig["x5-playsinline"]),e.loop&&(n.videoConfig.loop="loop"),n.video=util$2.createDom(n.videoConfig.mediaType,"",n.videoConfig,""),e.defaultPlaybackRate&&(n.video.defaultPlaybackRate=n.video.playbackRate=e.defaultPlaybackRate),"Number"===util$2.typeOf(e.volume)&&(n.volume=e.volume),e.autoplayMuted&&(n.video.muted=!0,n._lastMuted=!0),e.autoplay&&(n.video.autoplay=!0),n._interval={},n.videoEventMiddleware={},n.attachVideoEvents(),n}return _createClass$8(r,[{key:"setEventsMiddleware",value:function(e){var t=this;Object.keys(e).map((function(r){t.videoEventMiddleware[r]=e[r]}))}},{key:"removeEventsMiddleware",value:function(e){var t=this;Object.keys(e).map((function(e){delete t.videoEventMiddleware[e]}))}},{key:"attachVideoEvents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.video;this._evHandlers||(this._evHandlers=VIDEO_EVENTS.map((function(t){var r="on".concat(t.charAt(0).toUpperCase()).concat(t.slice(1));return"function"==typeof e[r]&&e.on(t,e[r]),_defineProperty$8({},t,getVideoEventHandler(t,e))}))),this._evHandlers.forEach((function(e){var r=Object.keys(e)[0];t.addEventListener(r,e[r],!1)}))}},{key:"detachVideoEvents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.video;this._evHandlers.forEach((function(e){var r=Object.keys(e)[0];t.removeEventListener(r,e[r],!1)})),this._evHandlers.forEach((function(t){var r=Object.keys(t)[0],n="on".concat(r.charAt(0).toUpperCase()).concat(r.slice(1));"function"==typeof e[n]&&e.off(r,e[n])})),this._evHandlers=null}},{key:"_attachSourceEvents",value:function(e,t){var r=this;e.removeAttribute("src"),t.forEach((function(e){r.video.appendChild(util$2.createDom("source","",{src:"".concat(e.src),type:"".concat(e.type||"")}))}));var n=e.children;if(n){this._videoSourceCount=n.length,!this._sourceError&&(this._sourceError=function(e){r._videoSourceCount--,0===r._videoSourceCount&&(r.videoEventMiddleware.error?r.videoEventMiddleware.error.call(r,e,(function(){r.errorHandler("error")})):r.errorHandler("error",{code:4,message:"sources load error"}))});for(var i=0;i<n.length;i++)n[i].addEventListener("error",this._sourceError)}}},{key:"_detachSourceEvents",value:function(e){var t=e.children;if(t&&0!==t.length&&this._sourceError){for(var r=0;r<t.length;r++)t[r].removeEventListener("error",this._sourceError);for(;t.length>0;)e.removeChild(t[0])}}},{key:"errorHandler",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.video&&(this.video.error||t)){var r=this.video.error||t,n=r.code?ERROR_TYPE_MAP[r.code]:"other";r.message;this.video.currentSrc||(r={code:6,message:"empty_src"}),this.emit(e,new Errors$1(this,{errorType:n,errorCode:r.code,errorMessage:r.message||"",mediaError:r}))}}},{key:"destroy",value:function(){for(var e in this.video&&(this.video.pause&&(this.video.pause(),this.video.muted=!0),this.video.removeAttribute("src"),this.video.load()),this._currentTime=0,this._duration=0,this.videoConfig=null,this._interval)clearInterval(this._interval[e]),this._interval[e]=null;this.detachVideoEvents(),this.video=null,this.videoEventMiddleware={},this.removeAllListeners()}},{key:"play",value:function(){return this.video?this.video.play():null}},{key:"pause",value:function(){this.video&&this.video.pause()}},{key:"canPlayType",value:function(e){return!!this.video&&this.video.canPlayType(e)}},{key:"getBufferedRange",value:function(e){var t=[0,0];if(!this.video)return t;e||(e=this.video.buffered);var r=this.video.currentTime;if(e)for(var n=0,i=e.length;n<i&&(t[0]=e.start(n),t[1]=e.end(n),!(t[0]<=r&&r<=t[1]));n++);return t[0]-r<=0&&r-t[1]<=0?t:[0,0]}},{key:"autoplay",get:function(){return!!this.video&&this.video.autoplay},set:function(e){this.video&&(this.video.autoplay=e)}},{key:"buffered",get:function(){return this.video?this.video.buffered:null}},{key:"buffered2",get:function(){return this.video?util$2.getBuffered2(this.video.buffered):null}},{key:"bufferedPoint",get:function(){var e={start:0,end:0};if(!this.video)return e;var t=this.video.buffered;if(!t||0===t.length)return e;for(var r=0;r<t.length;r++)if((t.start(r)<=this.currentTime||t.start(r)<.1)&&t.end(r)>=this.currentTime)return{start:t.start(r),end:t.end(r)};return e}},{key:"crossOrigin",get:function(){return this.video?this.video.crossOrigin:""},set:function(e){this.video&&(this.video.crossOrigin=e)}},{key:"currentSrc",get:function(){return this.video?this.video.currentSrc:""},set:function(e){this.video&&(this.video.currentSrc=e)}},{key:"currentTime",get:function(){return this.video?void 0!==this.video.currentTime?this.video.currentTime:this._currentTime:0},set:function(e){this.video&&(this.video.currentTime=e)}},{key:"defaultMuted",get:function(){return!!this.video&&this.video.defaultMuted},set:function(e){this.video&&(this.video.defaultMuted=e)}},{key:"duration",get:function(){return this._duration}},{key:"ended",get:function(){return!!this.video&&this.video.ended}},{key:"error",get:function(){return this.video.error}},{key:"errorNote",get:function(){if(!this.video.error)return"";return["MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED"][this.video.error.code-1]}},{key:"loop",get:function(){return!!this.video&&this.video.loop},set:function(e){this.video&&(this.video.loop=e)}},{key:"muted",get:function(){return!!this.video&&this.video.muted},set:function(e){this.video&&this.video.muted!==e&&(this._lastMuted=this.video.muted,this.video.muted=e)}},{key:"networkState",get:function(){return this.video.networkState}},{key:"paused",get:function(){return!this.video||this.video.paused}},{key:"playbackRate",get:function(){return this.video?this.video.playbackRate:0},set:function(e){this.video&&e!==1/0&&(this.video.playbackRate=e)}},{key:"played",get:function(){return this.video?this.video.played:null}},{key:"preload",get:function(){return!!this.video&&this.video.preload},set:function(e){this.video&&(this.video.preload=e)}},{key:"readyState",get:function(){return this.video.readyState}},{key:"seekable",get:function(){return!!this.video&&this.video.seekable}},{key:"seeking",get:function(){return!!this.video&&this.video.seeking}},{key:"src",get:function(){return this.video?this.video.src:""},set:function(e){this.video&&(this.emit(URL_CHANGE,e),this.emit(WAITING),this._currentTime=0,this._duration=0,/^blob/.test(this.video.currentSrc)||/^blob/.test(this.video.src)?this.onWaiting():(this._detachSourceEvents(this.video),"Array"===util$2.typeOf(e)?this._attachSourceEvents(this.video,e):this.video.src=e,this.load()))}},{key:"volume",get:function(){return this.video?this.video.volume:0},set:function(e){e!==1/0&&this.video&&(this.video.volume=e)}},{key:"addInnerOP",value:function(e){this._internalOp[e]=!0}},{key:"removeInnerOP",value:function(e){delete this._internalOp[e]}},{key:"emit",value:function(e,t){for(var n,i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];(n=_get$1(_getPrototypeOf$7(r.prototype),"emit",this)).call.apply(n,[this,e,t].concat(a))}},{key:"on",value:function(e,t){for(var n,i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];(n=_get$1(_getPrototypeOf$7(r.prototype),"on",this)).call.apply(n,[this,e,t].concat(a))}},{key:"once",value:function(e,t){for(var n,i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];(n=_get$1(_getPrototypeOf$7(r.prototype),"once",this)).call.apply(n,[this,e,t].concat(a))}},{key:"off",value:function(e,t){for(var n,i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];(n=_get$1(_getPrototypeOf$7(r.prototype),"off",this)).call.apply(n,[this,e,t].concat(a))}},{key:"offAll",value:function(){_get$1(_getPrototypeOf$7(r.prototype),"removeAllListeners",this).call(this)}}]),r}(EventEmitter$1),INDEXDB=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:"xgplayer",version:1,db:null,ojstore:{name:"xg-m4a",keypath:"vid"}};_classCallCheck$7(this,e),this.indexedDB=window.indexedDB||window.webkitindexedDB,this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,this.myDB=t}return _createClass$8(e,[{key:"openDB",value:function(e){var t=this,r=this,n=this.myDB.version||1,i=r.indexedDB.open(r.myDB.name,n);i.onerror=function(e){},i.onsuccess=function(n){t.myDB.db=n.target.result,e.call(r)},i.onupgradeneeded=function(e){var t=e.target.result;e.target.transaction,t.objectStoreNames.contains(r.myDB.ojstore.name)||t.createObjectStore(r.myDB.ojstore.name,{keyPath:r.myDB.ojstore.keypath})}}},{key:"deletedb",value:function(){this.indexedDB.deleteDatabase(this.myDB.name)}},{key:"closeDB",value:function(){this.myDB.db.close()}},{key:"addData",value:function(e,t){for(var r,n=this.myDB.db.transaction(e,"readwrite").objectStore(e),i=0;i<t.length;i++)(r=n.add(t[i])).onerror=function(){},r.onsuccess=function(){}}},{key:"putData",value:function(e,t){for(var r,n=this.myDB.db.transaction(e,"readwrite").objectStore(e),i=0;i<t.length;i++)(r=n.put(t[i])).onerror=function(){},r.onsuccess=function(){}}},{key:"getDataByKey",value:function(e,t,r){var n=this,i=this.myDB.db.transaction(e,"readwrite").objectStore(e).get(t);i.onerror=function(){r.call(n,null)},i.onsuccess=function(e){var t=e.target.result;r.call(n,t)}}},{key:"deleteData",value:function(e,t){this.myDB.db.transaction(e,"readwrite").objectStore(e).delete(t)}},{key:"clearData",value:function(e){this.myDB.db.transaction(e,"readwrite").objectStore(e).clear()}}]),e}(),FULLSCREEN_EVENTS=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],GET_FULLSCREEN_API=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],EXIT_FULLSCREEN_API=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"];function callHandler(e,t,r){for(var n=arguments.length,i=new Array(n>3?n-3:0),a=3;a<n;a++)i[a-3]=arguments[a];var o=t.call.apply(t,[e].concat(i));r&&"function"==typeof r&&(o&&o.then?o.then((function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];r.call.apply(r,[e].concat(n))})):r.call.apply(r,[e].concat(i)))}function hook(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{pre:null,next:null};return this.__hooks||(this.__hooks={}),!this.__hooks[t]&&(this.__hooks[t]=null),function(){var i=arguments,a=this;if(n.pre)try{var o;(o=n.pre).call.apply(o,[this].concat(Array.prototype.slice.call(arguments)))}catch(e){throw e.message="[pluginName: ".concat(this.pluginName,":").concat(t,":pre error] >> ").concat(e.message),e}if(this.__hooks&&this.__hooks[t])try{var s,u=(s=this.__hooks[t]).call.apply(s,[this,this].concat(Array.prototype.slice.call(arguments)));u?u.then?u.then((function(e){!1!==e&&callHandler.apply(void 0,[a,r,n.next].concat(_toConsumableArray$2(i)))})).catch((function(e){throw e})):callHandler.apply(void 0,[this,r,n.next].concat(Array.prototype.slice.call(arguments))):void 0===u&&callHandler.apply(void 0,[this,r,n.next].concat(Array.prototype.slice.call(arguments)))}catch(e){throw e.message="[pluginName: ".concat(this.pluginName,":").concat(t,"] >> ").concat(e.message),e}else callHandler.apply(void 0,[this,r,n.next].concat(Array.prototype.slice.call(arguments)))}.bind(this)}function useHooks(e,t){var r=this.__hooks;if(r)return r.hasOwnProperty(e)?(r&&(r[e]=t),!0):(console.warn("has no supported hook which name [".concat(e,"]")),!1)}function usePluginHooks(e){if(this.plugins&&this.plugins[e.toLowerCase()]){for(var t=this.plugins[e.toLowerCase()],r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return t.useHooks&&t.useHooks.apply(t,n)}}function hooksDescriptor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e.__hooks={},t&&t.map((function(t){e.__hooks[t]=null})),Object.defineProperty(e,"hooks",{get:function(){return e.__hooks&&Object.keys(e.__hooks).map((function(t){if(e.__hooks[t])return t}))}})}function delHooksDescriptor(e){e.__hooks=null}function runHooks(e,t,r){for(var n=arguments.length,i=new Array(n>3?n-3:0),a=3;a<n;a++)i[a-3]=arguments[a];if(!e.__hooks||!e.__hooks[t])return r.call.apply(r,[e,e].concat(i));var o,s=(o=e.__hooks[t]).call.apply(o,[e,e].concat(i));if(s&&s.then)s.then((function(t){return!1===t?null:r.call.apply(r,[e,e].concat(i))})).catch((function(e){console.warn("[runHooks]".concat(t," reject"),e.message)}));else if(!1!==s)return r.call.apply(r,[e,e].concat(i))}function showErrorMsg(e,t){XG_DEBUG.logError("[".concat(e,"] event or callback cant be undefined or null when call ").concat(t))}var BasePlugin=function(){function e(t){_classCallCheck$7(this,e),util$2.checkIsFunction(this.beforeCreate)&&this.beforeCreate(t),hooksDescriptor(this),this.__args=t,this.__events={},this.config=t.config||{},this.player=null,this.playerConfig={},this.pluginName="",this.__init(t)}return _createClass$8(e,[{key:"beforeCreate",value:function(e){}},{key:"afterCreate",value:function(){}},{key:"beforePlayerInit",value:function(){}},{key:"onPluginsReady",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"destroy",value:function(){}},{key:"__init",value:function(e){this.player=e.player,this.playerConfig=e.player&&e.player.config,this.pluginName=e.pluginName?e.pluginName.toLowerCase():this.constructor.pluginName.toLowerCase(),this.logger=e.player&&e.player.logger}},{key:"updateLang",value:function(e){e||(e=this.lang)}},{key:"lang",get:function(){return this.player.lang}},{key:"i18n",get:function(){return this.player.i18n}},{key:"i18nKeys",get:function(){return this.player.i18nKeys}},{key:"domEventType",get:function(){var e=util$2.checkTouchSupport()?"touch":"mouse";return!this.playerConfig||"touch"!==this.playerConfig.domEventType&&"mouse"!==this.playerConfig.domEventType||(e=this.playerConfig.domEventType),e}},{key:"on",value:function(e,t){var r=this;e&&t&&this.player?"string"==typeof e?(this.__events[e]=t,this.player.on(e,t)):Array.isArray(e)&&e.forEach((function(e){r.__events[e]=t,r.player.on(e,t)})):showErrorMsg(this.pluginName,"plugin.on(event, callback)")}},{key:"once",value:function(e,t){e&&t&&this.player?this.player.once(e,t):showErrorMsg(this.pluginName,"plugin.once(event, callback)")}},{key:"off",value:function(e,t){var r=this;e&&t&&this.player?"string"==typeof e?(delete this.__events[e],this.player.off(e,t)):Array.isArray(e)&&e.forEach((function(n){delete r.__events[e],r.player.off(n,t)})):showErrorMsg(this.pluginName,"plugin.off(event, callback)")}},{key:"offAll",value:function(){var e=this;Object.keys(this.__events).map((function(t){e.__events[t]&&e.off(t,e.__events[t]),t&&delete e.__events[t]})),this.__events={}}},{key:"emit",value:function(e){var t;if(this.player){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(t=this.player).emit.apply(t,[e].concat(n))}}},{key:"emitUserAction",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=_objectSpread2$6(_objectSpread2$6({},r),{},{pluginName:this.pluginName});this.player.emitUserAction(e,t,n)}},{key:"hook",value:function(e,t){return hook.call.apply(hook,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return useHooks.call.apply(useHooks,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"registerPlugin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(this.player)return r&&(t.pluginName=r),this.player.registerPlugin({plugin:e,options:t})}},{key:"getPlugin",value:function(e){return this.player?this.player.getPlugin(e):null}},{key:"__destroy",value:function(){var e=this,t=this.player,r=this.pluginName;this.offAll(),util$2.clearAllTimers(this),util$2.checkIsFunction(this.destroy)&&this.destroy(),["player","playerConfig","pluginName","logger","__args","__hooks"].map((function(t){e[t]=null})),t.unRegisterPlugin(r),delHooksDescriptor(this)}}],[{key:"defineGetterOrSetter",value:function(e,t){for(var r in t)Object.defineProperty(e,r,t[r])}},{key:"defaultConfig",get:function(){return{}}},{key:"pluginName",get:function(){return"pluginName"}}]),e}(),DOCUMENT_NODE_TYPE=9;if("undefined"!=typeof Element&&!Element.prototype.matches){var proto=Element.prototype;proto.matches=proto.matchesSelector||proto.mozMatchesSelector||proto.msMatchesSelector||proto.oMatchesSelector||proto.webkitMatchesSelector}function closest$2(e,t){for(;e&&e.nodeType!==DOCUMENT_NODE_TYPE;){if("function"==typeof e.matches&&e.matches(t))return e;e=e.parentNode}}var closest_1=closest$2,closest$1=closest_1;function _delegate(e,t,r,n,i){var a=listener.apply(this,arguments);return e.addEventListener(r,a,i),{destroy:function(){e.removeEventListener(r,a,i)}}}function delegate(e,t,r,n,i){return"function"==typeof e.addEventListener?_delegate.apply(null,arguments):"function"==typeof r?_delegate.bind(null,document).apply(null,arguments):("string"==typeof e&&(e=document.querySelectorAll(e)),Array.prototype.map.call(e,(function(e){return _delegate(e,t,r,n,i)})))}function listener(e,t,r,n){return function(r){r.delegateTarget=closest$1(r.target,t),r.delegateTarget&&n.call(e,r)}}var delegate_1=delegate,ROOT_TYPES={CONTROLS:"controls",ROOT:"root"},POSITIONS$a={ROOT:"root",ROOT_LEFT:"rootLeft",ROOT_RIGHT:"rootRight",ROOT_TOP:"rootTop",CONTROLS_LEFT:"controlsLeft",CONTROLS_RIGTH:"controlsRight",CONTROLS_RIGHT:"controlsRight",CONTROLS_CENTER:"controlsCenter",CONTROLS:"controls"};function isUrl(e){return!!e&&(e.indexOf&&/^(?:http|data:|\/)/.test(e))}function mergeIconClass(e,t){return"object"===_typeof$6(e)&&e.class&&"string"==typeof e.class?"".concat(t," ").concat(e.class):t}function mergeIconAttr(e,t){return"object"===_typeof$6(e)&&e.attr&&"object"===_typeof$6(e.attr)&&Object.keys(e.attr).map((function(r){t[r]=e.attr[r]})),t}function createIcon(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",o=null;if(t instanceof window.Element)return util$2.addClass(t,n),Object.keys(i).map((function(e){t.setAttribute(e,i[e])})),t;if(isUrl(t)||isUrl(t.url))return i.src=isUrl(t)?t:t.url||"",o=util$2.createDom(t.tag||"img","",i,"xg-img ".concat(n));if("function"==typeof t)try{return(o=t())instanceof window.Element?(util$2.addClass(o,n),Object.keys(i).map((function(e){o.setAttribute(e,i[e])})),o):(XG_DEBUG.logWarn("warn>>icons.".concat(r," in config of plugin named [").concat(a,"] is a function mast return an Element Object")),null)}catch(e){return XG_DEBUG.logError("Plugin named [".concat(a,"]:createIcon"),e),null}return"string"==typeof t?util$2.createDomFromHtml(t,i,n):(XG_DEBUG.logWarn("warn>>icons.".concat(r," in config of plugin named [").concat(a,"] is invalid")),null)}function registerIconsObj(e,t){var r=t.config.icons||t.playerConfig.icons;Object.keys(e).map((function(n){var i=e[n],a=i&&i.class?i.class:"",o=i&&i.attr?i.attr:{},s=null;r&&r[n]&&(a=mergeIconClass(r[n],a),o=mergeIconAttr(r[n],o),s=createIcon(r[n],n,a,o,t.pluginName)),!s&&i&&(s=createIcon(i.icon?i.icon:i,o,a,{},t.pluginName)),t.icons[n]=s}))}function registerTextObj(e,t){Object.keys(e).map((function(r){Object.defineProperty(t.langText,r,{get:function(){var n=t.lang,i=t.i18n;return i[r]?i[r]:e[r]&&e[r][n]||""}})}))}var Plugin=function(t){_inherits$7(n,t);var r=_createSuper$t(n);function n(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck$7(this,n),(e=r.call(this,t)).__delegates=[],e}return _createClass$8(n,[{key:"__init",value:function(t){if(_get$1(_getPrototypeOf$7(n.prototype),"__init",this).call(this,t),t.root){var r=t.root,i=null;this.icons={},this.root=null,this.parent=null,registerIconsObj(this.registerIcons()||{},this),this.langText={},registerTextObj(this.registerLanguageTexts()||{},this);var a="";try{a=this.render()}catch(e){throw XG_DEBUG.logError("Plugin:".concat(this.pluginName,":render"),e),new Error("Plugin:".concat(this.pluginName,":render:").concat(e.message))}if(a)(i=n.insert(a,r,t.index)).setAttribute("data-index",t.index);else{if(!t.tag)return;(i=util$2.createDom(t.tag,"",t.attr,t.name)).setAttribute("data-index",t.index),r.appendChild(i)}this.root=i,this.parent=r;var o=this.config.attr||{},s=this.config.style||{};this.setAttr(o),this.setStyle(s),this.config.index&&this.root.setAttribute("data-index",this.config.index),this.__registerChildren()}}},{key:"__registerChildren",value:function(){var e=this;if(this.root){this._children=[];var t=this.children();t&&"object"===_typeof$6(t)&&Object.keys(t).length>0&&Object.keys(t).map((function(r){var n,i,a=r,o=t[a],s={root:e.root};"function"==typeof o?(n=e.config[a]||{},i=o):"object"===_typeof$6(o)&&"function"==typeof o.plugin&&(n=o.options?util$2.deepCopy(e.config[a]||{},o.options):e.config[a]||{},i=o.plugin),s.config=n,void 0!==n.index&&(s.index=n.index),n.root&&(s.root=n.root),e.registerPlugin(i,s,a)}))}}},{key:"updateLang",value:function(e){e||(e=this.lang);var t=this.root,r=this.i18n,n=this.langText;t&&function e(t,r){for(var n=0;n<t.children.length;n++)t.children[n].children.length>0?e(t.children[n],r):r(t.children[n])}(t,(function(t){var i=t.getAttribute&&t.getAttribute("lang-key");if(i){var a=r[i.toUpperCase()]||n[i];a&&(t.innerHTML="function"==typeof a?a(e):a)}}))}},{key:"lang",get:function(){return this.player.lang}},{key:"changeLangTextKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=this.i18n||{},n=this.langText;e.setAttribute&&e.setAttribute("lang-key",t);var i=r[t]||n[t]||"";i&&(e.innerHTML=i)}},{key:"plugins",value:function(){return this._children}},{key:"children",value:function(){return{}}},{key:"registerPlugin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";t.root=t.root||this.root;var i=_get$1(_getPrototypeOf$7(n.prototype),"registerPlugin",this).call(this,e,t,r);return this._children.push(i),i}},{key:"registerIcons",value:function(){return{}}},{key:"registerLanguageTexts",value:function(){return{}}},{key:"find",value:function(e){if(this.root)return this.root.querySelector(e)}},{key:"bind",value:function(e,t,r){var i=this;if(arguments.length<3&&"function"==typeof t)Array.isArray(e)?e.forEach((function(e){i.bindEL(e,t)})):this.bindEL(e,t);else{var a=n.delegate.call(this,this.root,e,t,r);this.__delegates=this.__delegates.concat(a)}}},{key:"unbind",value:function(e,t){var r=this;if(arguments.length<3&&"function"==typeof t)Array.isArray(e)?e.forEach((function(e){r.unbindEL(e,t)})):this.unbindEL(e,t);else for(var n="".concat(e,"_").concat(t),i=0;i<this.__delegates.length;i++)if(this.__delegates[i].key===n){this.__delegates[i].destroy(),this.__delegates.splice(i,1);break}}},{key:"setStyle",value:function(e,t){var r=this;if(this.root)return"String"===util$2.typeOf(e)?this.root.style[e]=t:void("Object"===util$2.typeOf(e)&&Object.keys(e).map((function(t){r.root.style[t]=e[t]})))}},{key:"setAttr",value:function(e,t){var r=this;if(this.root)return"String"===util$2.typeOf(e)?this.root.setAttribute(e,t):void("Object"===util$2.typeOf(e)&&Object.keys(e).map((function(t){r.root.setAttribute(t,e[t])})))}},{key:"setHtml",value:function(e,t){this.root&&(this.root.innerHTML=e,"function"==typeof t&&t())}},{key:"bindEL",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.root&&"on".concat(e)in this.root&&"function"==typeof t&&this.root.addEventListener(e,t,r)}},{key:"unbindEL",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.root&&"on".concat(e)in this.root&&"function"==typeof t&&this.root.removeEventListener(e,t,r)}},{key:"show",value:function(e){if(this.root)return this.root.style.display=void 0!==e?e:"block","none"===window.getComputedStyle(this.root,null).getPropertyValue("display")?this.root.style.display="block":void 0}},{key:"hide",value:function(){this.root&&(this.root.style.display="none")}},{key:"appendChild",value:function(e,t){if(!this.root)return null;if(arguments.length<2&&arguments[0]instanceof window.Element)return this.root.appendChild(arguments[0]);if(!(t&&t instanceof window.Element))return null;try{return"string"==typeof e?this.find(e).appendChild(t):e.appendChild(t)}catch(r){return XG_DEBUG.logError("Plugin:appendChild",r),null}}},{key:"render",value:function(){return""}},{key:"destroy",value:function(){}},{key:"__destroy",value:function(){var e=this,t=this.player;this.__delegates.map((function(e){e.destroy()})),this.__delegates=[],this._children instanceof Array&&(this._children.map((function(e){t.unRegisterPlugin(e.pluginName)})),this._children=null),this.root&&(this.root.hasOwnProperty("remove")?this.root.remove():this.root.parentNode&&this.root.parentNode.removeChild(this.root)),_get$1(_getPrototypeOf$7(n.prototype),"__destroy",this).call(this),this.icons={},["root","parent"].map((function(t){e[t]=null}))}}],[{key:"insert",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=t.children.length,i=Number(r),a=e instanceof window.Node;if(n){for(var o=0,s=null,u="";o<n;o++){s=t.children[o];var c=Number(s.getAttribute("data-index"));if(c>=i){u="beforebegin";break}c<i&&(u="afterend")}return a?"afterend"===u?t.appendChild(e):t.insertBefore(e,s):s.insertAdjacentHTML(u,e),"afterend"===u?t.children[t.children.length-1]:t.children[o]}return a?t.appendChild(e):t.insertAdjacentHTML("beforeend",e),t.children[t.children.length-1]}},{key:"defaultConfig",get:function(){return{}}},{key:"delegate",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=[];if(e instanceof window.Node&&"function"==typeof n)if(Array.isArray(r))r.forEach((function(r){var o=delegate_1(e,t,r,n,i);o.key="".concat(t,"_").concat(r),a.push(o)}));else{var o=delegate_1(e,t,r,n,i);o.key="".concat(t,"_").concat(r),a.push(o)}return a}},{key:"ROOT_TYPES",get:function(){return ROOT_TYPES}},{key:"POSITIONS",get:function(){return POSITIONS$a}}]),n}(BasePlugin),fails$A=fails$10,correctPrototypeGetter=!fails$A((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),hasOwn$e=hasOwnProperty_1,isCallable$9=isCallable$v,toObject$b=toObject$k,sharedKey$1=sharedKey$4,CORRECT_PROTOTYPE_GETTER$1=correctPrototypeGetter,IE_PROTO=sharedKey$1("IE_PROTO"),$Object=Object,ObjectPrototype$4=$Object.prototype,objectGetPrototypeOf=CORRECT_PROTOTYPE_GETTER$1?$Object.getPrototypeOf:function(e){var t=toObject$b(e);if(hasOwn$e(t,IE_PROTO))return t[IE_PROTO];var r=t.constructor;return isCallable$9(r)&&t instanceof r?r.prototype:t instanceof $Object?ObjectPrototype$4:null},fails$z=fails$10,isCallable$8=isCallable$v,isObject$k=isObject$y,getPrototypeOf$3=objectGetPrototypeOf,defineBuiltIn$c=defineBuiltIn$l,wellKnownSymbol$a=wellKnownSymbol$u,ITERATOR$7=wellKnownSymbol$a("iterator"),BUGGY_SAFARI_ITERATORS$1=!1,IteratorPrototype$2,PrototypeOfArrayIteratorPrototype,arrayIterator;[].keys&&(arrayIterator=[].keys(),"next"in arrayIterator?(PrototypeOfArrayIteratorPrototype=getPrototypeOf$3(getPrototypeOf$3(arrayIterator)),PrototypeOfArrayIteratorPrototype!==Object.prototype&&(IteratorPrototype$2=PrototypeOfArrayIteratorPrototype)):BUGGY_SAFARI_ITERATORS$1=!0);var NEW_ITERATOR_PROTOTYPE=!isObject$k(IteratorPrototype$2)||fails$z((function(){var e={};return IteratorPrototype$2[ITERATOR$7].call(e)!==e}));NEW_ITERATOR_PROTOTYPE&&(IteratorPrototype$2={}),isCallable$8(IteratorPrototype$2[ITERATOR$7])||defineBuiltIn$c(IteratorPrototype$2,ITERATOR$7,(function(){return this}));var iteratorsCore={IteratorPrototype:IteratorPrototype$2,BUGGY_SAFARI_ITERATORS:BUGGY_SAFARI_ITERATORS$1},IteratorPrototype$1=iteratorsCore.IteratorPrototype,create$7=objectCreate$1,createPropertyDescriptor$5=createPropertyDescriptor$a,setToStringTag$7=setToStringTag$9,Iterators$2=iterators,returnThis$1=function(){return this},iteratorCreateConstructor=function(e,t,r,n){var i=t+" Iterator";return e.prototype=create$7(IteratorPrototype$1,{next:createPropertyDescriptor$5(+!n,r)}),setToStringTag$7(e,i,!1),Iterators$2[i]=returnThis$1,e},$$11=_export,call$a=functionCall,FunctionName$1=functionName,isCallable$7=isCallable$v,createIteratorConstructor$1=iteratorCreateConstructor,getPrototypeOf$2=objectGetPrototypeOf,setPrototypeOf$3=objectSetPrototypeOf,setToStringTag$6=setToStringTag$9,createNonEnumerableProperty$4=createNonEnumerableProperty$c,defineBuiltIn$b=defineBuiltIn$l,wellKnownSymbol$9=wellKnownSymbol$u,Iterators$1=iterators,IteratorsCore=iteratorsCore,PROPER_FUNCTION_NAME$1=FunctionName$1.PROPER,CONFIGURABLE_FUNCTION_NAME$1=FunctionName$1.CONFIGURABLE,IteratorPrototype=IteratorsCore.IteratorPrototype,BUGGY_SAFARI_ITERATORS=IteratorsCore.BUGGY_SAFARI_ITERATORS,ITERATOR$6=wellKnownSymbol$9("iterator"),KEYS="keys",VALUES="values",ENTRIES$1="entries",returnThis=function(){return this},iteratorDefine=function(e,t,r,n,i,a,o){createIteratorConstructor$1(r,t,n);var s,u,c,l=function(e){if(e===i&&g)return g;if(!BUGGY_SAFARI_ITERATORS&&e in f)return f[e];switch(e){case KEYS:case VALUES:case ENTRIES$1:return function(){return new r(this,e)}}return function(){return new r(this)}},d=t+" Iterator",h=!1,f=e.prototype,p=f[ITERATOR$6]||f["@@iterator"]||i&&f[i],g=!BUGGY_SAFARI_ITERATORS&&p||l(i),y="Array"==t&&f.entries||p;if(y&&(s=getPrototypeOf$2(y.call(new e)))!==Object.prototype&&s.next&&(getPrototypeOf$2(s)!==IteratorPrototype&&(setPrototypeOf$3?setPrototypeOf$3(s,IteratorPrototype):isCallable$7(s[ITERATOR$6])||defineBuiltIn$b(s,ITERATOR$6,returnThis)),setToStringTag$6(s,d,!0)),PROPER_FUNCTION_NAME$1&&i==VALUES&&p&&p.name!==VALUES&&(CONFIGURABLE_FUNCTION_NAME$1?createNonEnumerableProperty$4(f,"name",VALUES):(h=!0,g=function(){return call$a(p,this)})),i)if(u={values:l(VALUES),keys:a?g:l(KEYS),entries:l(ENTRIES$1)},o)for(c in u)(BUGGY_SAFARI_ITERATORS||h||!(c in f))&&defineBuiltIn$b(f,c,u[c]);else $$11({target:t,proto:!0,forced:BUGGY_SAFARI_ITERATORS||h},u);return f[ITERATOR$6]!==g&&defineBuiltIn$b(f,ITERATOR$6,g,{name:i}),Iterators$1[t]=g,u},createIterResultObject$3=function(e,t){return{value:e,done:t}},toIndexedObject$7=toIndexedObject$e,addToUnscopables$4=addToUnscopables$6,Iterators=iterators,InternalStateModule$9=internalState,defineProperty$9=objectDefineProperty.f,defineIterator$2=iteratorDefine,createIterResultObject$2=createIterResultObject$3,DESCRIPTORS$h=descriptors,ARRAY_ITERATOR="Array Iterator",setInternalState$8=InternalStateModule$9.set,getInternalState$6=InternalStateModule$9.getterFor(ARRAY_ITERATOR),es_array_iterator=defineIterator$2(Array,"Array",(function(e,t){setInternalState$8(this,{type:ARRAY_ITERATOR,target:toIndexedObject$7(e),index:0,kind:t})}),(function(){var e=getInternalState$6(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,createIterResultObject$2(void 0,!0)):createIterResultObject$2("keys"==r?n:"values"==r?t[n]:[n,t[n]],!1)}),"values"),values=Iterators.Arguments=Iterators.Array;if(addToUnscopables$4("keys"),addToUnscopables$4("values"),addToUnscopables$4("entries"),DESCRIPTORS$h&&"values"!==values.name)try{defineProperty$9(values,"name",{value:"values"})}catch(error){}var charAt$8=stringMultibyte.charAt,toString$j=toString$v,InternalStateModule$8=internalState,defineIterator$1=iteratorDefine,createIterResultObject$1=createIterResultObject$3,STRING_ITERATOR="String Iterator",setInternalState$7=InternalStateModule$8.set,getInternalState$5=InternalStateModule$8.getterFor(STRING_ITERATOR);defineIterator$1(String,"String",(function(e){setInternalState$7(this,{type:STRING_ITERATOR,string:toString$j(e),index:0})}),(function(){var e,t=getInternalState$5(this),r=t.string,n=t.index;return n>=r.length?createIterResultObject$1(void 0,!0):(e=charAt$8(r,n),t.index+=e.length,createIterResultObject$1(e,!1))}));var global$p=global$O,DOMIterables=domIterables,DOMTokenListPrototype=domTokenListPrototype,ArrayIteratorMethods=es_array_iterator,createNonEnumerableProperty$3=createNonEnumerableProperty$c,wellKnownSymbol$8=wellKnownSymbol$u,ITERATOR$5=wellKnownSymbol$8("iterator"),TO_STRING_TAG$1=wellKnownSymbol$8("toStringTag"),ArrayValues=ArrayIteratorMethods.values,handlePrototype=function(e,t){if(e){if(e[ITERATOR$5]!==ArrayValues)try{createNonEnumerableProperty$3(e,ITERATOR$5,ArrayValues)}catch(error){e[ITERATOR$5]=ArrayValues}if(e[TO_STRING_TAG$1]||createNonEnumerableProperty$3(e,TO_STRING_TAG$1,t),DOMIterables[t])for(var r in ArrayIteratorMethods)if(e[r]!==ArrayIteratorMethods[r])try{createNonEnumerableProperty$3(e,r,ArrayIteratorMethods[r])}catch(error){e[r]=ArrayIteratorMethods[r]}}};for(var COLLECTION_NAME in DOMIterables)handlePrototype(global$p[COLLECTION_NAME]&&global$p[COLLECTION_NAME].prototype,COLLECTION_NAME);handlePrototype(DOMTokenListPrototype,"DOMTokenList");var ResizeObserver=function(){function t(){var r=this;if(_classCallCheck$7(this,t),this.__handlers=[],this.timeStamp=0,this.observer=null,window.ResizeObserver)try{this.observer=new window.ResizeObserver((function(e){var t=(new Date).getTime();t-r.timeStamp<100||(r.timeStamp=t,r.__trigger(e))})),this.timeStamp=(new Date).getTime()}catch(e){console.error(e)}}return _createClass$8(t,[{key:"addObserver",value:function(e,t){if(this.observer){this.observer&&this.observer.observe(e);for(var r=this.__handlers,n=-1,i=0;i<r.length;i++)r[i]&&e===r[i].target&&(n=i);n>-1?this.__handlers[n].handler=t:this.__handlers.push({target:e,handler:t})}}},{key:"unObserver",value:function(t){var r=-1;this.__handlers.map((function(e,n){t===e.target&&(r=n)}));try{this.observer&&this.observer.unobserve(t)}catch(e){}this.observer&&this.observer.unobserve(t),r>-1&&this.__handlers.splice(r,1)}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(e){for(var t=this.__handlers,r=0;r<t.length;r++)if(t[r]&&e===t[r].target){try{t[r].handler(e)}catch(error){console.error(error)}return!0}return!1}},{key:"__trigger",value:function(e){for(var t=0;t<e.length;t++){if(this.__runHandler(e[t].target))break}}}]),t}(),resizeObserver=null;function addObserver(e,t){return resizeObserver||(resizeObserver=new ResizeObserver),resizeObserver.addObserver(e,t),resizeObserver}function unObserver(e,t){resizeObserver.unObserver(e,t)}var pluginsManager={init:function(e){var t=e._pluginInfoId;t||(t=(new Date).getTime(),e._pluginInfoId=t),this.pluginGroup||(this.pluginGroup={}),!e.config.closeResizeObserver&&addObserver(e.root,(function(){e.resize()})),0===Object.keys(this.pluginGroup).length&&(e.isUserActive=!0),this.pluginGroup[t]={_player:e,_originalOptions:e.config||{}}},checkPlayerRoot:function(e){if(this.pluginGroup){for(var t=Object.keys(this.pluginGroup),r=0;r<t.length;r++){var n=this.pluginGroup[t[r]]._player;if(n.root===e)return n}return null}return null},lazyRegister:function(e,t){var r=this,n=t.timeout||1500;return Promise.race([t.loader().then((function(t){var n;n=t&&t.__esModule?t.default:t,r.register(e,n,t.options)})),new Promise((function(e,t){setTimeout((function(){t(new Error("timeout"))}),n)}))])},register:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e&&t&&"function"==typeof t&&void 0!==t.prototype){var n=e._pluginInfoId;n&&this.pluginGroup&&this.pluginGroup[n]||(this.init(e),n=e._pluginInfoId),this.pluginGroup[n]._plugins||(this.pluginGroup[n]._plugins=[]);var i=this.pluginGroup[n]._plugins,a=this.pluginGroup[n]._originalOptions;r.player=this.pluginGroup[n]._player;var o=r.pluginName||t.pluginName;if(!o)throw new Error("The property pluginName is necessary");if(!t.isSupported||t.isSupported()){r.config||(r.config={});for(var s=Object.keys(a),u=0;u<s.length;u++)if(o.toLowerCase()===s[u].toLowerCase()){var c=a[s[u]];"Object"===util$2.typeOf(c)?r.config=Object.assign({},r.config,a[s[u]]):"Boolean"===util$2.typeOf(c)&&(r.config.disable=!c);break}t.defaultConfig&&Object.keys(t.defaultConfig).map((function(e){void 0===r.config[e]&&(r.config[e]=t.defaultConfig[e])})),r.root?"string"==typeof r.root&&(r.root=e[r.root]):r.root=e.root,r.index=r.config.index||0;try{i[o.toLowerCase()]&&(this.unRegister(n,o.toLowerCase()),console.warn("the is one plugin with same pluginName [".concat(o,"] exist, destroy the old instance")));var l=new t(r);return i[o.toLowerCase()]=l,i[o.toLowerCase()].func=t,l&&"function"==typeof l.afterCreate&&l.afterCreate(),l}catch(d){throw console.error(d),d}}else console.warn("not supported plugin [".concat(o,"]"))}},unRegister:function(t,r){t._pluginInfoId&&(t=t._pluginInfoId),r=r.toLowerCase();try{var n=this.pluginGroup[t]._plugins[r];n&&(n.pluginName&&n.__destroy(),delete this.pluginGroup[t]._plugins[r])}catch(e){console.error("[unRegister:".concat(r,"] cgid:[").concat(t,"] error"),e)}},deletePlugin:function(e,t){var r=e._pluginInfoId;r&&this.pluginGroup&&this.pluginGroup[r]&&this.pluginGroup[r]._plugins&&delete this.pluginGroup[r]._plugins[t]},getPlugins:function(e){var t=e._pluginInfoId;return t&&this.pluginGroup[t]?this.pluginGroup[t]._plugins:{}},findPlugin:function(e,t){var r=e._pluginInfoId;if(!this.pluginGroup||!r)return null;var n=t.toLowerCase();return this.pluginGroup[r]._plugins[n]},beforeInit:function(t){var r=this;function n(e){return e&&e.then?e:new Promise((function(e){e()}))}return new Promise((function(i){if(r.pluginGroup)return(t._loadingPlugins&&t._loadingPlugins.length?Promise.all(t._loadingPlugins):Promise.resolve()).then((function(){var a=t._pluginInfoId;if(r.pluginGroup[a]){for(var o=r.pluginGroup[a]._plugins,s=[],u=0,c=Object.keys(o);u<c.length;u++){var l=c[u];if(o[l]&&o[l].beforePlayerInit)try{var d=o[l].beforePlayerInit();s.push(n(d))}catch(e){throw s.push(n(null)),e}}Promise.all([].concat(s)).then((function(){i()})).catch((function(e){console.error(e),i()}))}else i()}))}))},afterInit:function(e){var t=e._pluginInfoId;if(this.pluginGroup&&t)for(var r=this.pluginGroup[t]._plugins,n=0,i=Object.keys(r);n<i.length;n++){var a=i[n];r[a]&&r[a].afterPlayerInit&&r[a].afterPlayerInit()}},setLang:function(e,t){var r=t._pluginInfoId;if(this.pluginGroup&&r){var n=this.pluginGroup[r]._plugins;Object.keys(n).map((function(t){if(n[t].updateLang)n[t].updateLang(e);else try{n[t].lang=e}catch(error){console.warn("".concat(t," setLang"))}}))}},reRender:function(e){var t=e._pluginInfoId;if(t){for(var r={},n=this.pluginGroup[t]._plugins,i=0,a=Object.keys(n);i<a.length;i++){var o=a[i];r[o]={plugin:n[o].func,options:n[o]._args},this.unRegister(t,o)}for(var s=0,u=Object.keys(r);s<u.length;s++){var c=u[s];this.register(t,c,r[c].plugin,r[c].options)}}},onPluginsReady:function(e){var t=e._pluginInfoId,r=this.pluginGroup[t]._plugins;t&&r&&Object.keys(r).map((function(e){r[e].onPluginsReady&&"function"==typeof r[e].onPluginsReady&&r[e].onPluginsReady()}))},setCurrentUserActive:function(e,t){if(this.pluginGroup&&this.pluginGroup[e]){if(!t)return this.pluginGroup[e]._player.isUserActive=t,e;for(var r=Object.keys(this.pluginGroup),n=0;n<r.length;n++){var i=this.pluginGroup[r[n]];if(i&&i._player){this.pluginGroup[r[n]]._player.isUserActive=!1;break}}return this.pluginGroup[e]._player.isUserActive=t,e}},getCurrentUseActiveId:function(){if(this.pluginGroup){for(var e=Object.keys(this.pluginGroup),t=0;t<e.length;t++){var r=this.pluginGroup[e[t]];if(r&&r._player&&r._player.isUserActive)return e[t]}return null}},destroy:function(e){var t=e._pluginInfoId;if(this.pluginGroup[t]){unObserver(e.root);for(var r=this.pluginGroup[t]._plugins,n=0,i=Object.keys(r);n<i.length;n++){var a=i[n];this.unRegister(t,a)}var o=e.isUseActive;if(delete this.pluginGroup[t],delete e._pluginInfoId,o){var s=Object.keys(this.pluginGroup);s.length>0&&this.setCurrentUserActive(s[s.length-1],!0)}}}},STATE_CLASS={DEFAULT:"xgplayer",DEFAULT_SKIN:"xgplayer-skin-default",ENTER:"xgplayer-is-enter",PAUSED:"xgplayer-pause",PLAYING:"xgplayer-playing",ENDED:"xgplayer-ended",CANPLAY:"xgplayer-canplay",LOADING:"xgplayer-isloading",ERROR:"xgplayer-is-error",REPLAY:"xgplayer-replay",NO_START:"xgplayer-nostart",ACTIVE:"xgplayer-active",INACTIVE:"xgplayer-inactive",FULLSCREEN:"xgplayer-is-fullscreen",CSS_FULLSCREEN:"xgplayer-is-cssfullscreen",ROTATE_FULLSCREEN:"xgplayer-rotate-fullscreen",PARENT_ROTATE_FULLSCREEN:"xgplayer-rotate-parent",PARENT_FULLSCREEN:"xgplayer-fullscreen-parent",INNER_FULLSCREEN:"xgplayer-fullscreen-inner",NO_CONTROLS:"no-controls",FLEX_CONTROLS:"flex-controls",CONTROLS_FOLLOW:"controls-follow",CONTROLS_AUTOHIDE:"controls-autohide",TOP_BAR_AUTOHIDE:"top-bar-autohide",NOT_ALLOW_AUTOPLAY:"not-allow-autoplay",SEEKING:"seeking",PC:"xgplayer-pc",MOBILE:"xgplayer-mobile",MINI:"xgplayer-mini"};function getDefaultConfig$1(){return{id:"",el:null,url:"",domEventType:"default",nullUrlStart:!1,width:600,height:337.5,fluid:!1,fitVideoSize:"fixed",videoFillMode:"auto",volume:.6,autoplay:!1,autoplayMuted:!1,loop:!1,isLive:!1,zoom:1,videoInit:!0,poster:"",isMobileSimulateMode:!1,defaultPlaybackRate:1,execBeforePluginsCall:null,allowSeekAfterEnded:!0,enableContextmenu:!1,closeVideoClick:!1,closeVideoDblclick:!1,closePlayerBlur:!1,closeDelayBlur:!1,leavePlayerTime:3e3,closePlayVideoFocus:!1,closePauseVideoFocus:!1,closeFocusVideoFocus:!1,closeControlsBlur:!1,topBarAutoHide:!0,videoAttributes:{},startTime:0,seekedStatus:"play",miniprogress:!1,disableSwipeHandler:function(){},enableSwipeHandler:function(){},ignores:[],whitelist:[],inactive:3e3,lang:(document.documentElement.getAttribute("lang")||navigator.language||"zh-cn").toLocaleLowerCase(),controls:!0,marginControls:!1,fullscreenTarget:null,controlsList:[],screenShot:!1,rotate:!1,pip:!1,download:!1,mini:!1,cssFullscreen:!0,keyShortcut:!0,presets:[],plugins:[],playbackRate:1,definition:{list:[]},playsinline:!0,customDuration:0,timeOffset:0,icons:{},i18n:[],thumbnail:null,commonStyle:{progressColor:"",playedColor:"",cachedColor:"",sliderBtnStyle:{},volumeColor:""}}}var usePreset=function(e,t){var r,n,i,a=t.preset&&t.options?new t.preset(t.options,e.config):new t({},e.config),o=a.plugins,s=void 0===o?[]:o,u=a.ignores,c=void 0===u?[]:u,l=a.icons,d=void 0===l?{}:l,h=a.i18n,f=void 0===h?[]:h;e.config.plugins||(e.config.plugins=[]),e.config.ignores||(e.config.ignores=[]),(r=e.config.plugins).push.apply(r,_toConsumableArray$2(s)),(n=e.config.ignores).push.apply(n,_toConsumableArray$2(c)),Object.keys(d).map((function(t){e.config.icons[t]||(e.config.icons[t]=d[t])})),(i=e.config.i18n).push.apply(i,_toConsumableArray$2(f))},Controls=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){var e;_classCallCheck$7(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$8(_assertThisInitialized$7(e=t.call.apply(t,[this].concat(i))),"onMouseEnter",(function(t){var r=_assertThisInitialized$7(e).player;r.userTimer&&(util$2.clearTimeout(r,r.userTimer),clearTimeout(r.userTimer))})),_defineProperty$8(_assertThisInitialized$7(e),"onMouseLeave",(function(){_assertThisInitialized$7(e).player.focus()})),e}return _createClass$8(r,[{key:"beforeCreate",value:function(e){e.config.mode||"mobile"!==sniffer$1.device||(e.config.mode="flex"),e.player.config.marginControls&&(e.config.autoHide=!1)}},{key:"afterCreate",value:function(){var e=this,t=this.config,r=t.disable,n=t.height,i=t.mode;if(!r){"flex"===i&&this.player.addClass(STATE_CLASS.FLEX_CONTROLS);var a={height:"".concat(n,"px")};Object.keys(a).map((function(t){e.root.style[t]=a[t]})),this.left=this.find("xg-left-grid"),this.center=this.find("xg-center-grid"),this.right=this.find("xg-right-grid"),this.innerRoot=this.find("xg-inner-controls"),this.on(MINI_STATE_CHANGE,(function(t){t?util$2.addClass(e.root,"mini-controls"):util$2.removeClass(e.root,"mini-controls")})),"mobile"!==sniffer$1.device&&(this.bind("mouseenter",this.onMouseEnter),this.bind("mouseleave",this.onMouseLeave))}}},{key:"focus",value:function(){this.player.focus({autoHide:!1})}},{key:"focusAwhile",value:function(){this.player.focus({autoHide:!0})}},{key:"blur",value:function(){this.player.blur({ignorePaused:!0})}},{key:"recoverAutoHide",value:function(){this.config.autoHide&&util$2.addClass(this.root,STATE_CLASS.CONTROLS_AUTOHIDE)}},{key:"pauseAutoHide",value:function(){util$2.removeClass(this.root,STATE_CLASS.CONTROLS_AUTOHIDE)}},{key:"show",value:function(){util$2.addClass(this.root,"show")}},{key:"hide",value:function(){util$2.removeClass(this.root,"show")}},{key:"mode",get:function(){return this.config.mode}},{key:"registerPlugin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(this.root){var i=e.defaultConfig||{};if(!t.root){var a=t.position?t.position:t.config&&t.config.position?t.config.position:i.position;switch(a){case POSITIONS$a.CONTROLS_LEFT:t.root=this.left;break;case POSITIONS$a.CONTROLS_RIGHT:t.root=this.right;break;case POSITIONS$a.CONTROLS_CENTER:t.root=this.center;break;case POSITIONS$a.CONTROLS:t.root=this.root;break;default:t.root=this.left}return _get$1(_getPrototypeOf$7(r.prototype),"registerPlugin",this).call(this,e,t,n)}}}},{key:"destroy",value:function(){"mobile"!==sniffer$1.device&&(this.unbind("mouseenter",this.onMouseEnter),this.unbind("mouseleave",this.onMouseLeave))}},{key:"render",value:function(){var e=this.config,t=e.mode,r=e.autoHide,n=e.initShow;if(!e.disable){var i=util$2.classNames({"xgplayer-controls":!0},{"flex-controls":"flex"===t},{"bottom-controls":"bottom"===t},_defineProperty$8({},STATE_CLASS.CONTROLS_AUTOHIDE,r),{"xgplayer-controls-initshow":n||!r});return'<xg-controls class="'.concat(i,'" unselectable="on" onselectstart="return false">\n    <xg-inner-controls class="xg-inner-controls xg-pos">\n      <xg-left-grid class="xg-left-grid">\n      </xg-left-grid>\n      <xg-center-grid class="xg-center-grid"></xg-center-grid>\n      <xg-right-grid class="xg-right-grid">\n      </xg-right-grid>\n    </xg-inner-controls>\n    </xg-controls>')}}}],[{key:"pluginName",get:function(){return"controls"}},{key:"defaultConfig",get:function(){return{disable:!1,autoHide:!0,mode:"",initShow:!1}}}]),r}(Plugin),EN={LANG:"en",TEXT:{ERROR_TYPES:{network:{code:1,msg:"video download error"},mse:{code:2,msg:"stream append error"},parse:{code:3,msg:"parsing error"},format:{code:4,msg:"wrong format"},decoder:{code:5,msg:"decoding error"},runtime:{code:6,msg:"grammatical errors"},timeout:{code:7,msg:"play timeout"},other:{code:8,msg:"other errors"}},HAVE_NOTHING:"There is no information on whether audio/video is ready",HAVE_METADATA:"Audio/video metadata is ready ",HAVE_CURRENT_DATA:"Data about the current play location is available, but there is not enough data to play the next frame/millisecond",HAVE_FUTURE_DATA:"Current and at least one frame of data is available",HAVE_ENOUGH_DATA:"The available data is sufficient to start playing",NETWORK_EMPTY:"Audio/video has not been initialized",NETWORK_IDLE:"Audio/video is active and has been selected for resources, but no network is used",NETWORK_LOADING:"The browser is downloading the data",NETWORK_NO_SOURCE:"No audio/video source was found",MEDIA_ERR_ABORTED:"The fetch process is aborted by the user",MEDIA_ERR_NETWORK:"An error occurred while downloading",MEDIA_ERR_DECODE:"An error occurred while decoding",MEDIA_ERR_SRC_NOT_SUPPORTED:"Audio/video is not supported",REPLAY:"Replay",ERROR:"Network is offline",PLAY_TIPS:"Play",PAUSE_TIPS:"Pause",PLAYNEXT_TIPS:"Play next",DOWNLOAD_TIPS:"Download",ROTATE_TIPS:"Rotate",RELOAD_TIPS:"Reload",FULLSCREEN_TIPS:"Fullscreen",EXITFULLSCREEN_TIPS:"Exit fullscreen",CSSFULLSCREEN_TIPS:"Cssfullscreen",EXITCSSFULLSCREEN_TIPS:"Exit cssfullscreen",TEXTTRACK:"Caption",PIP:"PIP",SCREENSHOT:"Screenshot",LIVE:"LIVE",OFF:"Off",OPEN:"Open",MINI_DRAG:"Click and hold to drag",MINISCREEN:"Miniscreen",REFRESH_TIPS:"Please Try",REFRESH:"Refresh",FORWARD:"forward",LIVE_TIP:"Live"}},XGI18nLang={},XGI18nTextKeys={},XGI18nLangKeys=[],XGI18nLangPreExtends={};function updateKeys(){Object.keys(XGI18nLang.en).map((function(e){XGI18nTextKeys[e]=e}))}function extend(e){("Array"!==util$2.typeOf(e)?Object.keys(e).map((function(t){return{LANG:"zh"===t?"zh-cn":t,TEXT:e[t]}})):e).map((function(e){XGI18nLang[e.LANG]?util$2.deepMerge(XGI18nLang[e.LANG]||{},e.TEXT||{}):XGI18nLangPreExtends[e.LANG]=e.TEXT})),updateKeys()}function use(e){var t=e.LANG,r=e.TEXT||{};XGI18nLang[t]||XGI18nLangKeys.push(t),XGI18nLang[t]?util$2.deepMerge(r,XGI18nLang[t]):XGI18nLang[t]=r,XGI18nLangPreExtends[t]&&(extend([{LANG:t,TEXT:XGI18nLangPreExtends[t]}]),delete XGI18nLangPreExtends[t]),"zh-cn"===t&&(XGI18nLang.zh=XGI18nLang["zh-cn"]),updateKeys()}use(EN);var I18N={get textKeys(){return XGI18nTextKeys},get langKeys(){return XGI18nLangKeys},get lang(){var e={};return XGI18nLangKeys.map((function(t){e[t]=XGI18nLang[t]})),e.zh=XGI18nLang["zh-cn"],e},extend:extend,use:use},STATES$3={INITIAL:1,READY:2,ATTACHING:3,ATTACHED:4,NOTALLOW:5,RUNNING:6,ENDED:7,DESTROYED:8},STATE_ARRAY=["ERROR","INITIAL","READY","ATTACHING","ATTACHED","NOTALLOW","RUNNING","ENDED","DESTROYED"],PlAYER_HOOKS=["play","pause","replay","retry"],Player=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(e){var n;_classCallCheck$7(this,r);var i=util$2.deepMerge(getDefaultConfig$1(),e);hooksDescriptor(_assertThisInitialized$7(n=t.call(this,i)),PlAYER_HOOKS),n.config=i,bindDebug(_assertThisInitialized$7(n));var a=n.constructor.defaultPreset;if(n.config.presets.length){var o=n.config.presets.indexOf("default");o>=0&&a&&(n.config.presets[o]=a)}else a&&n.config.presets.push(a);if(n.userTimer=null,n.waitTimer=null,n._state=STATES$3.INITIAL,n._isError=!1,n._hasStart=!1,n.isSeeking=!1,n.isCanplay=!1,n._runPending=!1,n.rotateDeg=0,n.isActive=!1,n.fullscreen=!1,n.cssfullscreen=!1,n.isRotateFullscreen=!1,n._fullscreenEl=null,n._cssfullscreenEl=null,n.curDefinition=null,n._orgCss="",n._fullScreenOffset=null,n._videoHeight=0,n._videoWidth=0,n._accPlayed={t:0,acc:0,loopAcc:0},n.innerContainer=null,n.controls=null,n.topBar=null,n.root=null,sniffer$1.os.isAndroid&&sniffer$1.osVersion>0&&sniffer$1.osVersion<6&&(n.config.autoplay=!1),n.database=new INDEXDB,n.isUserActive=!1,!n._initDOM())return console.error(new Error("can't find the dom which id is ".concat(n.config.id," or this.config.el does not exist"))),_possibleConstructorReturn$7(n);var s=n.config,u=s.definition,c=void 0===u?{}:u;if(!s.url&&c.list&&c.list.length>0){var l=c.list.find((function(e){return e.definition&&e.definition===c.defaultDefinition}));l||(c.defaultDefinition=c.list[0].definition,l=c.list[0]),n.config.url=l.url,n.curDefinition=l.definition}return n._bindEvents(),n._registerPresets(),n._registerPlugins(),pluginsManager.onPluginsReady(_assertThisInitialized$7(n)),n.setState(STATES$3.READY),n.emit(READY),n.onReady&&n.onReady(),(n.config.videoInit||n.config.autoplay)&&(!n.hasStart||n.state<STATES$3.ATTACHED)&&n.start(),n}return _createClass$8(r,[{key:"_initDOM",value:function(){var e=this;if(this.root=this.config.id?document.getElementById(this.config.id):null,!this.root){var t=this.config.el;if(!t||1!==t.nodeType)return this.emit(ERROR$3,new Errors$1("use",this.config.vid,{line:32,handle:"Constructor",msg:"container id can't be empty"})),console.error("this.confg.id or this.config.el can't be empty"),!1;this.root=t}var r=pluginsManager.checkPlayerRoot(this.root);r&&(XG_DEBUG.logWarn("The is an Player instance already exists in this.root, destroy it and reinitialize"),r.destroy()),this._initBaseDoms();var n=this.constructor.XgVideoProxy;if(n&&this.videoConfig.mediaType===n.mediaType){var i=this.innerContainer||this.root;this.detachVideoEvents(this.video);var a=new n(i,this.config,this.videoConfig);this.attachVideoEvents(a),this.video=a}if(this.config.controls){var o=pluginsManager.register(this,Controls);this.controls=o}var s=this.config.isMobileSimulateMode?"mobile":sniffer$1.device;if(this.addClass("".concat(STATE_CLASS.DEFAULT," ").concat(STATE_CLASS.INACTIVE," xgplayer-").concat(s," ").concat(this.config.controls?"":STATE_CLASS.NO_CONTROLS)),this.config.autoplay?this.addClass(STATE_CLASS.ENTER):this.addClass(STATE_CLASS.NO_START),this.config.fluid){var u=this.config,c=u.width,l=u.height;"number"==typeof c&&"number"==typeof l||(c=600,l=337.5);var d={width:"100%",height:"0","max-width":"100%","padding-top":"".concat(100*l/c,"%")};Object.keys(d).forEach((function(t){e.root.style[t]=d[t]}))}else["width","height"].forEach((function(t){e.config[t]&&("number"!=typeof e.config[t]?e.root.style[t]=e.config[t]:e.root.style[t]="".concat(e.config[t],"px"))}));return!0}},{key:"_initBaseDoms",value:function(){this.topBar=util$2.createDom("xg-bar","",{"data-index":-1},"xg-top-bar"),this.leftBar=util$2.createDom("xg-bar","",{"data-index":-1},"xg-left-bar"),this.rightBar=util$2.createDom("xg-bar","",{"data-index":-1},"xg-right-bar"),this.config.marginControls&&(this.innerContainer=util$2.createDom("xg-video-container","",{"data-index":-1},"xg-video-container"),this.root.appendChild(this.innerContainer)),this.config.topBarAutoHide&&util$2.addClass(this.topBar,STATE_CLASS.TOP_BAR_AUTOHIDE),this.root.appendChild(this.topBar),this.root.appendChild(this.leftBar),this.root.appendChild(this.rightBar)}},{key:"_bindEvents",value:function(){var e=this;["focus","blur"].forEach((function(t){e.on(t,e["on"+t.charAt(0).toUpperCase()+t.slice(1)])})),this.onFullscreenChange=function(t,r){var n=util$2.getFullScreenEl();if(e._fullActionFrom?e._fullActionFrom="":e.emit(USER_ACTION,{eventType:"system",action:"switch_fullscreen",pluginName:"player",currentTime:e.currentTime,duration:e.duration,props:[{prop:"fullscreen",from:!0,to:!1}]}),r||n&&(n===e._fullscreenEl||"VIDEO"===n.tagName))util$2.setTimeout(e,(function(){e.resize()}),100),!e.config.closeFocusVideoFocus&&e.video.focus(),e.fullscreen=!0,e.changeFullStyle(e.root,n,STATE_CLASS.FULLSCREEN),e.emit(FULLSCREEN_CHANGE,!0,e._fullScreenOffset),e.cssfullscreen&&e.exitCssFullscreen();else if(e.fullscreen){util$2.setTimeout(e,(function(){e.resize()}),100);var i=e._fullScreenOffset;e.config.needFullscreenScroll?(window.scrollTo(i.left,i.top),util$2.setTimeout(e,(function(){e.fullscreen=!1,e._fullScreenOffset=null}),100)):(!e.config.closeFocusVideoFocus&&e.video.focus(),e.fullscreen=!1,e._fullScreenOffset=null),e.cssfullscreen?e.removeClass(STATE_CLASS.FULLSCREEN):e.recoverFullStyle(e.root,e._fullscreenEl,STATE_CLASS.FULLSCREEN),e._fullscreenEl=null,e.emit(FULLSCREEN_CHANGE,!1)}},FULLSCREEN_EVENTS.forEach((function(t){document&&document.addEventListener(t,e.onFullscreenChange)})),this.__webkitbeginfullscreen=function(t){e._fullscreenEl=e.video,e.onFullscreenChange(t,!0)},this.__webkitendfullscreen=function(t){e.onFullscreenChange(t,!1)},sniffer$1.os.isIos&&(this.video.addEventListener("webkitbeginfullscreen",this.__webkitbeginfullscreen),this.video.addEventListener("webkitendfullscreen",this.__webkitendfullscreen)),this.once(LOADED_DATA,this.resize),this.playFunc=function(){e.config.closeFocusVideoFocus||e.video.focus()},this.once(PLAY,this.playFunc)}},{key:"_unbindEvents",value:function(){var e=this;this.root.removeEventListener("mousemove",this.mousemoveFunc),FULLSCREEN_EVENTS.forEach((function(t){document.removeEventListener(t,e.onFullscreenChange)})),this.playFunc&&this.off(PLAY,this.playFunc),this.canPlayFunc&&this.off(CANPLAY,this.canPlayFunc),this.video.removeEventListener("webkitbeginfullscreen",this.__webkitbeginfullscreen),this.video.removeEventListener("webkitendfullscreen",this.__webkitendfullscreen)}},{key:"_startInit",value:function(e){var t=this;if(this.video&&(e&&""!==e&&("Array"!==util$2.typeOf(e)||0!==e.length)||(e="",this.emit(URL_NULL),XG_DEBUG.logWarn("config.url is null, please get url and run player._startInit(url)"),!this.config.nullUrlStart))){this.canPlayFunc=function(){if(t.config){var e=t.config,r=e.autoplay,n=e.startTime,i=e.defaultPlaybackRate;XG_DEBUG.logInfo("player","canPlayFunc",n),n&&(t.currentTime=n>t.duration?t.duration:n,t.config.startTime=0),1!==i&&(t.playbackRate=i),r&&t.videoPlay(),t.off(CANPLAY,t.canPlayFunc),t.removeClass(STATE_CLASS.ENTER)}},this._detachSourceEvents(this.video),"Array"===util$2.typeOf(e)?this._attachSourceEvents(this.video,e):this.video.src=e,"Number"===util$2.typeOf(this.config.volume)&&(this.volume=this.config.volume),this.loadeddataFunc&&this.once(LOADED_DATA,this.loadeddataFunc);var r=this.innerContainer?this.innerContainer:this.root;this.video instanceof window.Element&&!r.contains(this.video)&&r.insertBefore(this.video,r.firstChild);var n=this.video.readyState;XG_DEBUG.logInfo("_startInit readyState",n),this.config.autoplay&&(!/^blob/.test(this.video.currentSrc)&&!/^blob/.test(this.video.src)&&this.load(),(sniffer$1.os.isIpad||sniffer$1.os.isPhone)&&this.videoPlay()),n>=2?this.canPlayFunc():this.once(CANPLAY,this.canPlayFunc),(!this.hasStart||this.state<STATES$3.ATTACHED)&&pluginsManager.afterInit(this),this.hasStart=!0,this.setState(STATES$3.ATTACHED),util$2.setTimeout(this,(function(){t.emit(COMPLETE)}),0)}}},{key:"_registerPlugins",value:function(){var e=this;this._loadingPlugins=[];var t=this.config.ignores||[],r=this.config.plugins||[];(this.config.i18n||[]).forEach((function(e){I18N.use(e)}));var n=t.join("||").toLowerCase().split("||");r.forEach((function(t){try{var r=t.plugin?t.plugin.pluginName:t.pluginName;if(r&&n.indexOf(r.toLowerCase())>-1)return;if(t.lazy&&t.loader){var i=pluginsManager.lazyRegister(e,t);return void(t.forceBeforeInit&&(i.then((function(){e._loadingPlugins.splice(e._loadingPlugins.indexOf(i),1)})).catch((function(t){XG_DEBUG.logError("_registerPlugins:loadingPlugin",t),e._loadingPlugins.splice(e._loadingPlugins.indexOf(i),1)})),e._loadingPlugins.push(i)))}return e.registerPlugin(t)}catch(a){XG_DEBUG.logError("_registerPlugins:",a)}}))}},{key:"_registerPresets",value:function(){var e=this;this.config.presets.forEach((function(t){usePreset(e,t)}))}},{key:"registerPlugin",value:function(e,t){var r=null,n=null;e.plugin&&"function"==typeof e.plugin?(r=e.plugin,n=e.options):(r=e,n={}),t&&(n.config=t);for(var i=Object.keys(this.config),a=0;a<i.length;a++)if(r.pluginName.toLowerCase()===i[a].toLowerCase()){var o=this.config[i[a]];"Object"===util$2.typeOf(o)&&(o.root&&(n.root=o.root),o.position&&(n.position=o.position));break}var s=n.position?n.position:n.config&&n.config.position||r.defaultConfig&&r.defaultConfig.position,u=Plugin.POSITIONS;if(!n.root&&"string"==typeof s&&s.indexOf("controls")>-1)return this.controls&&this.controls.registerPlugin(r,n,r.pluginName);if(!n.root)switch(s){case u.ROOT_RIGHT:n.root=this.rightBar;break;case u.ROOT_LEFT:n.root=this.leftBar;break;case u.ROOT_TOP:n.root=this.topBar;break;default:n.root=this.innerContainer||this.root}return pluginsManager.register(this,r,n)}},{key:"deregister",value:function(e){"string"==typeof e?pluginsManager.unRegister(this,e):e instanceof BasePlugin&&pluginsManager.unRegister(this,e.pluginName)}},{key:"unRegisterPlugin",value:function(e){this.deregister(e)}},{key:"plugins",get:function(){return pluginsManager.getPlugins(this)}},{key:"getPlugin",value:function(e){var t=pluginsManager.findPlugin(this,e);return t&&t.pluginName?t:null}},{key:"addClass",value:function(e){this.root&&(util$2.hasClass(this.root,e)||util$2.addClass(this.root,e))}},{key:"removeClass",value:function(e){this.root&&util$2.removeClass(this.root,e)}},{key:"hasClass",value:function(e){if(this.root)return util$2.hasClass(this.root,e)}},{key:"setAttribute",value:function(e,t){this.root&&this.root.setAttribute(e,t)}},{key:"removeAttribute",value:function(e,t){this.root&&this.root.removeAttribute(e,t)}},{key:"start",value:function(e){var t=this;return this.hasStart||this.state>=STATES$3.ATTACHING?Promise.resolve():(this.hasStart=!0,this.setState(STATES$3.ATTACHING),pluginsManager.beforeInit(this).then((function(){if(t.config)return e||(e=t.url||t.config.url),t._startInit(e)})).catch((function(e){throw e.fileName="player",e.lineNumber="236",XG_DEBUG.logError("start:beforeInit:",e),e})))}},{key:"switchURL",value:function(e){var t=this,r=e;"Object"===util$2.typeOf(e)&&(r=e.url);var n=this.currentTime,i=this.paused;return this.src=r,new Promise((function(e){var r=function(){t.currentTime=n,i&&t.once("canplay",(function(){t.pause()})),e()};sniffer$1.os.isAndroid?t.once("timeupdate",(function(){r()})):t.once("canplay",(function(){r()})),t.play()}))}},{key:"load",value:function(){this.video&&this.video.load()}},{key:"videoPlay",value:function(){var e=this;if(this.hasStart||!(this.state<STATES$3.ATTACHED)){this.state<STATES$3.RUNNING&&(this.removeClass(STATE_CLASS.NO_START),!this.isCanplay&&this.addClass(STATE_CLASS.ENTER));var t=_get$1(_getPrototypeOf$7(r.prototype),"play",this).call(this);return void 0!==t&&t&&t.then?t.then((function(){e.removeClass(STATE_CLASS.NOT_ALLOW_AUTOPLAY),e.addClass(STATE_CLASS.PLAYING),e.state<STATES$3.RUNNING&&(XG_DEBUG.logInfo(">>>>playPromise.then"),e.setState(STATES$3.RUNNING),e.emit(AUTOPLAY_STARTED))})).catch((function(t){if(XG_DEBUG.logWarn(">>>>playPromise.catch",t.name),e.video&&e.video.error)return e.onError(),e.removeClass(STATE_CLASS.ENTER),void(e._isError=!0);"NotAllowedError"===t.name&&(e._errorTimer=util$2.setTimeout(e,(function(){e._errorTimer=null,e.emit(AUTOPLAY_PREVENTED),e.addClass(STATE_CLASS.NOT_ALLOW_AUTOPLAY),e.removeClass(STATE_CLASS.ENTER),e.pause(),e.setState(STATES$3.NOTALLOW)}),0))})):(XG_DEBUG.logWarn("video.play not return promise"),this.state<STATES$3.RUNNING&&(this.setState(STATES$3.RUNNING),this.removeClass(STATE_CLASS.NOT_ALLOW_AUTOPLAY),this.removeClass(STATE_CLASS.NO_START),this.removeClass(STATE_CLASS.ENTER),this.addClass(STATE_CLASS.PLAYING),this.emit(AUTOPLAY_STARTED))),t}this.removeClass(STATE_CLASS.NO_START),this.addClass(STATE_CLASS.ENTER);var n=this.start();n&&n.then((function(t){!e.config.autoplay&&e.videoPlay()}))}},{key:"videoPause",value:function(){_get$1(_getPrototypeOf$7(r.prototype),"pause",this).call(this)}},{key:"play",value:function(){var e=this;this.removeClass(STATE_CLASS.PAUSED),runHooks(this,"play",(function(){e.videoPlay()}))}},{key:"pause",value:function(){var e=this;runHooks(this,"pause",(function(){_get$1(_getPrototypeOf$7(r.prototype),"pause",e).call(e)}))}},{key:"seek",value:function(e,t){var r=this;if(this.video&&!isNaN(Number(e))){var n=this.config,i=n.isSeekedPlay,a=n.seekedStatus,o=t||(i?"play":a);e=e<0?0:e>this.duration?parseInt(this.duration,10):e,this.once(CANPLAY,(function(){switch(r.removeClass(STATE_CLASS.ENTER),r.isSeeking=!1,o){case"play":r.play();break;case"pause":r.pause();break;default:!r.paused&&r.play()}})),this.state<STATES$3.RUNNING?(this.removeClass(STATE_CLASS.NO_START),this.addClass(STATE_CLASS.ENTER),this.currentTime=e,"play"===o&&this.play()):this.currentTime=e}}},{key:"changeDefinition",value:function(e,t){var r=this;if(this.emit(DEFINITION_CHANGE,{from:t,to:e}),this.curDefinition=e.definition,this.hasStart){var n=this.switchURL(e.url);n&&n.then?n.then((function(){r.emit(AFTER_DEFINITION_CHANGE,{from:t,to:e})})):this.emit(AFTER_DEFINITION_CHANGE,{from:t,to:e})}else this.config.url=e.url}},{key:"reload",value:function(){this.load(),this.reloadFunc=function(){this.play()},this.once(LOADED_DATA,this.reloadFunc)}},{key:"resetState",value:function(){var e=this,t=[STATE_CLASS.NOT_ALLOW_AUTOPLAY,STATE_CLASS.PLAYING,STATE_CLASS.NO_START,STATE_CLASS.PAUSED,STATE_CLASS.REPLAY,STATE_CLASS.ENTER,STATE_CLASS.ENDED,STATE_CLASS.ERROR,STATE_CLASS.LOADING];this.hasStart=!1,this.videoPause(),this._accPlayed.acc=0,this._accPlayed.t=0,this._accPlayed.loopAcc=0,t.forEach((function(t){e.removeClass(t)})),this.addClass(STATE_CLASS.ENTER),this.emit(EMPTIED)}},{key:"destroy",value:function(){var e=this,t=this.innerContainer,n=this.root,i=this.video;if(n&&i){if(this._hasStart=!1,this.updateAcc("destroy"),this._unbindEvents(),this._detachSourceEvents(this.video),util$2.clearAllTimers(this),this.emit(DESTROY),pluginsManager.destroy(this),delHooksDescriptor(this),_get$1(_getPrototypeOf$7(r.prototype),"destroy",this).call(this),this.fullscreen&&this._fullscreenEl===this.root&&this.exitFullscreen(),t)for(var a=t.children,o=0;o<a.length;o++)t.removeChild(a[o]);!t&&i instanceof window.Node&&n.contains(i)&&n.removeChild(i),["topBar","leftBar","rightBar","innerContainer"].map((function(t){e[t]&&n.removeChild(e[t]),e[t]=null}));var s=n.className.split(" ");s.length>0?n.className=s.filter((function(e){return e.indexOf("xgplayer")<0})).join(" "):n.className="",this.removeAttribute("data-xgfill"),["isSeeking","isCanplay","isActive","cssfullscreen","fullscreen"].forEach((function(t){e[t]=!1}))}}},{key:"replay",value:function(){var e=this;this.removeClass(STATE_CLASS.ENDED),this.currentTime=0,this.isSeeking=!1,runHooks(this,"replay",(function(){e.once(CANPLAY,(function(){var t=e.videoPlay();t&&t.catch&&t.catch((function(e){console.log(e)}))})),e.play(),e.emit(REPLAY),e.onPlay()}))}},{key:"retry",value:function(){var e=this;this.removeClass(STATE_CLASS.ERROR),this.addClass(STATE_CLASS.LOADING),runHooks(this,"retry",(function(){var t=e.currentTime;e.videoPause(),e.src=e.config.url,!e.config.isLive&&(e.currentTime=t),e.once(CANPLAY,(function(){e.videoPlay()}))}))}},{key:"changeFullStyle",value:function(e,t,r,n){e&&(n||(n=STATE_CLASS.PARENT_FULLSCREEN),this._orgCss||(this._orgCss=util$2.filterStyleFromText(e)),util$2.addClass(e,r),t&&t!==e&&!this._orgPCss&&(this._orgPCss=util$2.filterStyleFromText(t),util$2.addClass(t,n)))}},{key:"recoverFullStyle",value:function(e,t,r,n){n||(n=STATE_CLASS.PARENT_FULLSCREEN),this._orgCss&&(util$2.setStyleFromCsstext(e,this._orgCss),this._orgCss=""),util$2.removeClass(e,r),t&&t!==e&&this._orgPCss&&(util$2.setStyleFromCsstext(t,this._orgPCss),this._orgPCss="",util$2.removeClass(t,n))}},{key:"getFullscreen",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.fullscreenTarget,t=this.root,r=this.video;e||(e=t),this._fullScreenOffset={top:util$2.scrollTop(),left:util$2.scrollLeft()},this._fullscreenEl=e,this._fullActionFrom="get";var n=util$2.getFullScreenEl();if(n!==this._fullscreenEl)try{for(var i=0;i<GET_FULLSCREEN_API.length;i++){var a=GET_FULLSCREEN_API[i];if(e[a]){var o="webkitRequestFullscreen"===a?e.webkitRequestFullscreen(window.Element.ALLOW_KEYBOARD_INPUT):e[a]();return o&&o.then?o:Promise.resolve()}}return r.fullscreenEnabled||r.webkitSupportsFullscreen?(r.webkitEnterFullscreen(),Promise.resolve()):Promise.reject(new Error("call getFullscreen fail"))}catch(s){return Promise.reject(new Error("call getFullscreen fail"))}else this.onFullscreenChange()}},{key:"exitFullscreen",value:function(e){if(this.isRotateFullscreen&&this.exitRotateFullscreen(),this._fullscreenEl||util$2.getFullScreenEl()){this.root;var t=this.video;this._fullActionFrom="exit";try{for(var r=0;r<EXIT_FULLSCREEN_API.length;r++){var n=EXIT_FULLSCREEN_API[r];if(document[n]){var i=document[n]();return i&&i.then?i:Promise.resolve()}}return t&&t.webkitSupportsFullscreen?(t.webkitExitFullScreen(),Promise.resolve()):Promise.reject(new Error("call exitFullscreen fail"))}catch(a){return Promise.reject(new Error("call exitFullscreen fail"))}}}},{key:"getCssFullscreen",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.fullscreenTarget;this.isRotateFullscreen?this.exitRotateFullscreen():this.fullscreen&&this.exitFullscreen();var t=e?"".concat(STATE_CLASS.INNER_FULLSCREEN," ").concat(STATE_CLASS.CSS_FULLSCREEN):STATE_CLASS.CSS_FULLSCREEN;this.changeFullStyle(this.root,e,t);var r=this.config.fullscreen,n=void 0===r?{}:r,i=!0===n.useCssFullscreen||"function"==typeof n.useCssFullscreen&&n.useCssFullscreen();i&&(this.fullscreen=!0,this.emit(FULLSCREEN_CHANGE,!0)),this._cssfullscreenEl=e,this.cssfullscreen=!0,this.emit(CSS_FULLSCREEN_CHANGE,!0)}},{key:"exitCssFullscreen",value:function(){var e=this._cssfullscreenEl?"".concat(STATE_CLASS.INNER_FULLSCREEN," ").concat(STATE_CLASS.CSS_FULLSCREEN):STATE_CLASS.CSS_FULLSCREEN;if(this.fullscreen){var t=this.config.fullscreen,r=void 0===t?{}:t;!0===r.useCssFullscreen||"function"==typeof r.useCssFullscreen&&r.useCssFullscreen()?(this.recoverFullStyle(this.root,this._cssfullscreenEl,e),this.fullscreen=!1,this.emit(FULLSCREEN_CHANGE,!1)):this.removeClass(e)}else this.recoverFullStyle(this.root,this._cssfullscreenEl,e);this._cssfullscreenEl=null,this.cssfullscreen=!1,this.emit(CSS_FULLSCREEN_CHANGE,!1)}},{key:"getRotateFullscreen",value:function(e){this.cssfullscreen&&this.exitCssFullscreen(e);var t=e?"".concat(STATE_CLASS.INNER_FULLSCREEN," ").concat(STATE_CLASS.ROTATE_FULLSCREEN):STATE_CLASS.ROTATE_FULLSCREEN;this._fullscreenEl=e||this.root,this.changeFullStyle(this.root,e,t,STATE_CLASS.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!0,this.fullscreen=!0,this.setRotateDeg(90),this.emit(FULLSCREEN_CHANGE,!0)}},{key:"exitRotateFullscreen",value:function(e){var t=this._fullscreenEl!==this.root?"".concat(STATE_CLASS.INNER_FULLSCREEN," ").concat(STATE_CLASS.ROTATE_FULLSCREEN):STATE_CLASS.ROTATE_FULLSCREEN;this.recoverFullStyle(this.root,this._fullscreenEl,t,STATE_CLASS.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!1,this.fullscreen=!1,this.setRotateDeg(0),this.emit(FULLSCREEN_CHANGE,!1)}},{key:"setRotateDeg",value:function(e){90===window.orientation||-90===window.orientation?this.rotateDeg=0:this.rotateDeg=e}},{key:"focus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{autoHide:!this.config.closePlayerBlur,delay:this.config.inactive};this.isActive?this.onFocus(e):this.emit(PLAYER_FOCUS,_objectSpread2$6({paused:this.paused,ended:this.ended},e))}},{key:"blur",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{ignorePaused:!1};this.isActive?this.emit(PLAYER_BLUR,_objectSpread2$6({paused:this.paused,ended:this.ended},e)):this.onBlur(e)}},{key:"onFocus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.autoHide,n=void 0===r?!this.config.closePlayerBlur:r,i=t.delay,a=void 0===i?this.config.inactive:i;this.isActive=!0,this.removeClass(STATE_CLASS.INACTIVE),this.userTimer&&util$2.clearTimeout(this,this.userTimer),n&&(this.userTimer=util$2.setTimeout(this,(function(){e.blur()}),a))}},{key:"onBlur",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.ignorePaused,r=void 0!==t&&t;if(this.isActive){var n=this.config.closePauseVideoFocus;this.isActive=!1,(r||n||!this.paused&&!this.ended)&&this.addClass(STATE_CLASS.INACTIVE)}}},{key:"onEmptied",value:function(){this.updateAcc("emptied")}},{key:"onCanplay",value:function(){this.state>=STATES$3.RUNNING&&this.removeClass(STATE_CLASS.ENTER),this.removeClass(STATE_CLASS.LOADING),this.isCanplay=!0,this.waitTimer&&util$2.clearTimeout(this,this.waitTimer)}},{key:"onPlay",value:function(){this.state===STATES$3.ENDED&&this.setState(STATES$3.RUNNING),this.removeClass(STATE_CLASS.PAUSED),this.ended&&this.removeClass(STATE_CLASS.ENDED),!this.config.closePlayVideoFocus&&this.focus()}},{key:"onPause",value:function(){this.addClass(STATE_CLASS.PAUSED),this.updateAcc("pause"),this.config.closePauseVideoFocus||(this.userTimer&&util$2.clearTimeout(this,this.userTimer),this.focus())}},{key:"onEnded",value:function(){this.updateAcc("ended"),this.addClass(STATE_CLASS.ENDED),this.setState(STATES$3.ENDED)}},{key:"onError",value:function(){this._isError=!0,this.updateAcc("error"),this.removeClass(STATE_CLASS.NOT_ALLOW_AUTOPLAY),this.removeClass(STATE_CLASS.NO_START),this.removeClass(STATE_CLASS.ENTER),this.removeClass(STATE_CLASS.LOADING),this.addClass(STATE_CLASS.ERROR)}},{key:"onSeeking",value:function(){this.isSeeking||this.updateAcc("seeking"),this.isSeeking=!0,this.addClass(STATE_CLASS.SEEKING)}},{key:"onSeeked",value:function(){this.isSeeking=!1,this.waitTimer&&util$2.clearTimeout(this,this.waitTimer),this.removeClass(STATE_CLASS.LOADING),this.removeClass(STATE_CLASS.SEEKING)}},{key:"onWaiting",value:function(){var e=this;this.waitTimer&&util$2.clearTimeout(this,this.waitTimer),this.updateAcc("waiting"),this.waitTimer=util$2.setTimeout(this,(function(){e.addClass(STATE_CLASS.LOADING),util$2.clearTimeout(e,e.waitTimer),e.waitTimer=null}),200)}},{key:"onPlaying",value:function(){var e=this;[STATE_CLASS.NO_START,STATE_CLASS.PAUSED,STATE_CLASS.ENDED,STATE_CLASS.ERROR,STATE_CLASS.REPLAY,STATE_CLASS.LOADING].forEach((function(t){e.removeClass(t)}))}},{key:"onTimeupdate",value:function(){!this._videoHeight&&this.resize(),(this.waitTimer||this.hasClass(STATE_CLASS.LOADING))&&this.video.readyState>2&&(this.removeClass(STATE_CLASS.LOADING),util$2.clearTimeout(this,this.waitTimer),this.waitTimer=null),this._accPlayed.t||this.paused||this.ended||(this._accPlayed.t=(new Date).getTime())}},{key:"onVolumechange",value:function(){"Number"===util$2.typeOf(this.config.volume)&&(this.config.volume=this.volume)}},{key:"onRatechange",value:function(){this.config.defaultPlaybackRate=this.playbackRate}},{key:"emitUserAction",value:function(e,t,r){if(this.video&&t&&e){var n="String"===util$2.typeOf(e)?e:e.type||"";r.props&&"Array"!==util$2.typeOf(r.props)&&(r.props=[r.props]),this.emit(USER_ACTION,_objectSpread2$6({eventType:n,action:t,currentTime:this.currentTime,duration:this.duration,ended:this.ended,event:e},r))}}},{key:"updateAcc",value:function(e){if(this._accPlayed.t){var t=(new Date).getTime()-this._accPlayed.t;this._accPlayed.acc+=t,this._accPlayed.t=0,("ended"===e||this.ended)&&(this._accPlayed.loopAcc=this._accPlayed.acc)}}},{key:"checkBuffer",value:function(e){var t=this.video.buffered;if(!t||0===t.length||!this.duration)return!0;for(var r=e||this.video.currentTime||.2,n=t.length,i=0;i<n;i++)if(t.start(i)<=r&&t.end(i)>r)return!0;return!1}},{key:"position",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{h:0,y:0,x:0,w:0};if(this.video&&e&&e.h){var t=1/e.h,r=1!==t?"scale(".concat(t,")"):"",n=0,i=0;e.y&&(i=(100-100*e.h)/2-100*e.y),e.w&&e.x&&(n=(100-100*e.w)/2-100*e.x),r+=" translate(".concat(n,"%, ").concat(i,"%)"),this.video.style.transform=r,this.video.style.webkitTransform=r}}},{key:"setConfig",value:function(e){var t=this;e&&Object.keys(e).forEach((function(r){t.config[r]=e[r];var n=t.plugins[r.toLowerCase()];n&&"Function"===util$2.typeOf(n.setConfig)&&n.setConfig(e[r])}))}},{key:"playNext",value:function(e){this.resetState(),this.setConfig(e),this.play(),this.emit(PLAYNEXT,e)}},{key:"resize",value:function(){var e=this;if(this.video){var t=this.video,r=t.videoWidth,n=t.videoHeight,i=this.config,a=i.fitVideoSize,o=i.videoFillMode;if("fill"!==o&&"cover"!==o||this.setAttribute("data-xgfill",o),n&&r){this._videoHeight=n,this._videoWidth=r;var s=this.root.getBoundingClientRect(),u=this.controls&&this.innerContainer?this.controls.root.getBoundingClientRect().height:0,c=s.width,l=s.height-u,d=parseInt(r/n*1e3,10),h=parseInt(c/l*1e3,10),f=c,p=l,g={};"auto"===a&&h>d||"fixWidth"===a?(p=c/d*1e3,this.config.fluid?g.paddingTop="".concat(100*p/f,"%"):g.height="".concat(p+u,"px")):("auto"===a&&h<d||"fixHeight"===a)&&(f=d*l/1e3,g.width="".concat(f,"px")),this.fullscreen||this.cssfullscreen||Object.keys(g).forEach((function(t){e.root.style[t]=g[t]})),("fillHeight"===o&&h<d||"fillWidth"===o&&h>d)&&this.setAttribute("data-xgfill","cover");var y={videoScale:d,vWidth:f,vHeight:p,cWidth:f,cHeight:p+u};this.emit(VIDEO_RESIZE,y)}}}},{key:"updateObjectPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.video.updateObjectPosition?this.video.updateObjectPosition(e,t):this.video.style.objectPosition="".concat(100*e,"% ").concat(100*t,"%")}},{key:"setState",value:function(e){XG_DEBUG.logInfo("setState","state from:".concat(STATE_ARRAY[this.state]," to:").concat(STATE_ARRAY[e])),this._state=e}},{key:"state",get:function(){return this._state}},{key:"isFullscreen",get:function(){return this.fullscreen}},{key:"isCssfullScreen",get:function(){return this.cssfullscreen}},{key:"hasStart",get:function(){return this._hasStart},set:function(e){"boolean"==typeof e&&(this._hasStart=e,!1===e&&(this._state=STATES$3.READY),this.emit("hasstart"))}},{key:"isPlaying",get:function(){return this._state===STATES$3.RUNNING||this._state===STATES$3.ENDED}},{key:"definitionList",get:function(){return this.config.definition.list||[]},set:function(e){var t=this,r=this.config.definition;r.list=e,this.emit("resourceReady",e);var n=null,i=null;e.forEach((function(e){t.curDefinition===e.definition&&(n=e),r.defaultDefinition===e.definition&&(i=e)})),!i&&e.length>0&&(i=e[0]),n?this.changeDefinition(n):i&&this.changeDefinition(i)}},{key:"lang",get:function(){return this.config.lang},set:function(e){0!==I18N.langKeys.filter((function(t){return t===e})).length||"zh"===e?(this.config.lang=e,pluginsManager.setLang(e,this)):console.error("Sorry, set lang fail, because the language [".concat(e,"] is not supported now, list of all supported languages is [").concat(I18N.langKeys.join(),"] "))}},{key:"i18n",get:function(){var e=this.config.lang;return I18N.lang[e]||I18N.lang.en}},{key:"i18nKeys",get:function(){return I18N.textKeys||{}}},{key:"version",get:function(){return version$4}},{key:"playerId",get:function(){return this._pluginInfoId}},{key:"url",get:function(){return this.__url||this.config.url},set:function(e){this.__url=e}},{key:"poster",get:function(){return this.plugins.poster?this.plugins.poster.config.poster:this.config.poster},set:function(e){this.plugins.poster&&this.plugins.poster.update(e)}},{key:"readyState",get:function(){var e=_get$1(_getPrototypeOf$7(r.prototype),"readyState",this);return this.i18n[e]||e}},{key:"error",get:function(){var e=_get$1(_getPrototypeOf$7(r.prototype),"error",this);return this.i18n[e]||e}},{key:"networkState",get:function(){var e=_get$1(_getPrototypeOf$7(r.prototype),"networkState",this);return this.i18n[e]||e}},{key:"fullscreenChanging",get:function(){return!(null===this._fullScreenOffset)}},{key:"cumulateTime",get:function(){var e=this._accPlayed;return this.updateAcc("get"),e.acc}},{key:"zoom",get:function(){return this.config.zoom},set:function(e){this.config.zoom=e}},{key:"hook",value:function(e,t){return hook.call.apply(hook,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(e,t){return useHooks.call.apply(useHooks,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"usePluginHooks",value:function(e,t,r){for(var n=arguments.length,i=new Array(n>3?n-3:0),a=3;a<n;a++)i[a-3]=arguments[a];return usePluginHooks.call.apply(usePluginHooks,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"setUserActive",value:function(e,t){"boolean"==typeof t&&t!==this.muted&&(this.addInnerOP("volumechange"),this.muted=t),pluginsManager.setCurrentUserActive(this.playerId,e)}}],[{key:"debugger",get:function(){return XG_DEBUG.config.debug},set:function(e){XG_DEBUG.config.debug=e}},{key:"getCurrentUserActivePlayerId",value:function(){return pluginsManager.getCurrentUseActiveId()}},{key:"setCurrentUserActive",value:function(e,t){pluginsManager.setCurrentUserActive(e,t)}},{key:"install",value:function(e,t){r.plugins||(r.plugins={}),r.plugins[e]||(r.plugins[e]=t)}},{key:"use",value:function(e,t){r.plugins||(r.plugins={}),r.plugins[e]=t}}]),r}(VideoProxy);function now(){return(new Date).getTime()}_defineProperty$8(Player,"defaultPreset",null),_defineProperty$8(Player,"XgVideoProxy",null);var Xglogger=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){var e;_classCallCheck$7(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$8(_assertThisInitialized$7(e=t.call.apply(t,[this].concat(i))),"_onTimeupdate",(function(){XG_DEBUG.logInfo("[xgLogger]Events._onTimeupdate"),e._state.isTimeUpdate=!0,e._sendFirstFrame()})),_defineProperty$8(_assertThisInitialized$7(e),"_onAutoplayStart",(function(){XG_DEBUG.logInfo("[xgLogger]Events._onAutoplayStart"),e._state.autoplayStart=!0,e._sendFirstFrame()})),_defineProperty$8(_assertThisInitialized$7(e),"_onReset",(function(){e.vt=0,e.pt=0,e.fvt=0,e._isSeeking=!1,e.seekingStart=0,e.waitingStart=0,e._isWaiting=!1,e._waitTimer&&util$2.clearTimeout(_assertThisInitialized$7(e),e._waitTimer),e._waittTimer&&util$2.clearTimeout(_assertThisInitialized$7(e),e._waittTimer),e._waitTimer=null,e._waittTimer=null,e._waitType=0})),_defineProperty$8(_assertThisInitialized$7(e),"_onSeeking",(function(){e.seekingStart||(e.suspendWaitingStatus("seek"),e.seekingStart=now(),e.emitLog("seekStart",{start:now()}))})),_defineProperty$8(_assertThisInitialized$7(e),"_onSeeked",(function(){e.suspendSeekingStatus("seeked")})),_defineProperty$8(_assertThisInitialized$7(e),"_onWaitingLoadStart",(function(){e._isWaiting||e.vt||(e._isWaiting=!0,e.waitingStart=now(),e._waitType=1,e.emitLog("waitingStart",{start:e.waitingStart,type:1,endType:"loadstart"}))})),_defineProperty$8(_assertThisInitialized$7(e),"_onWaiting",(function(){!e._isWaiting&&e.vt&&(e._isWaiting=!0,e._waitTimer=util$2.setTimeout(_assertThisInitialized$7(e),(function(){e._isWaiting&&(e.waitingStart=now(),util$2.clearTimeout(_assertThisInitialized$7(e),e._waitTimer),e._waitTimer=null,e.vt?e.seekingStart?e._waitType=2:e._waitType=0:e._waitType=1,e._startWaitTimeout(),e.emitLog("waitingStart",{start:e.waitingStart,type:e._waitType,endType:2===e._waitType?"seek":"playing"}))}),200))})),_defineProperty$8(_assertThisInitialized$7(e),"_onError",(function(){e.suspendSeekingStatus("error"),e.suspendWaitingStatus("error")})),_defineProperty$8(_assertThisInitialized$7(e),"_onPlaying",(function(){e._isWaiting&&e.suspendWaitingStatus("playing")})),e}return _createClass$8(r,[{key:"afterCreate",value:function(){var e=this;this._state={autoplayStart:!1,isFFLoading:!1,isTimeUpdate:!1},this._onReset(),this._waitType="firstFrame",this.on(LOAD_START,(function(){var t=e._state.autoplayStart;e._state.isTimeUpdate=!1,e._state.isFFLoading=!0,XG_DEBUG.logInfo("[xgLogger]Events.LOAD_START",t),e.pt=now(),e.vt=0,e.fvt=0,e.off(AUTOPLAY_STARTED,e._onAutoplayStart),e.off(TIME_UPDATE,e._onTimeupdate),e._onWaitingLoadStart(),t?e.once(TIME_UPDATE,e._onTimeupdate):e.once(AUTOPLAY_STARTED,e._onAutoplayStart)})),this.on(LOADED_DATA,(function(){e.vt=now(),e.fvt=e.vt-e.pt,XG_DEBUG.logInfo("[xgLogger]Events.LOADED_DATA",e.fvt,e._state.isTimeUpdate),e._state.isTimeUpdate&&e._sendFirstFrame(),e.suspendWaitingStatus("loadeddata")})),this.on(SEEKING,this._onSeeking),this.on(SEEKED,this._onSeeked),this.on(DESTROY,(function(){e.endState("destroy")})),this.on(URL_CHANGE,(function(){e.endState("urlChange"),e._onReset()})),this.on([PLAYING,CANPLAY],this._onPlaying),this.on(WAITING,this._onWaiting),this.on(ERROR$3,this._onError),this.on(EMPTIED,(function(){e.endState("emptied"),e._onReset()}))}},{key:"_sendFirstFrame",value:function(){this.s=now(),this.vt>0&&this._state.isFFLoading&&(XG_DEBUG.logInfo("[xgLogger]Events._sendFirstFrame",this.vt),this._state.isFFLoading=!1,this.emitLog("firstFrame",{fvt:this.fvt,costTime:this.fvt,vt:this.vt}))}},{key:"_startWaitTimeout",value:function(){var e=this;this._waittTimer&&util$2.clearTimeout(this,this._waittTimer),this._waittTimer=util$2.setTimeout(this,(function(){e.suspendWaitingStatus("timeout"),util$2.clearTimeout(e,e._waittTimer),e._waittTimer=null}),3e4)}},{key:"endState",value:function(e){this.suspendWaitingStatus(e),this.suspendSeekingStatus(e)}},{key:"suspendSeekingStatus",value:function(e){if(this.seekingStart){var t=now(),r=t-this.seekingStart;this.seekingStart=0,this.emitLog("seekEnd",{end:t,costTime:r,endType:e})}}},{key:"suspendWaitingStatus",value:function(e){if(this._waitTimer&&(util$2.clearTimeout(this,this._waitTimer),this._waitTimer=null),this._waittTimer&&(util$2.clearTimeout(this,this._waittTimer),this._waittTimer=null),this._isWaiting=!1,this.waitingStart){var t=now()-this.waitingStart;this._isWaiting=!1,this.waitingStart=0,this.emitLog("waitingEnd",{costTime:t,type:this._waitType,endType:2===this._waitType?"seek":e})}}},{key:"emitLog",value:function(e,t){var r=this.player;this.emit(XGLOG,_objectSpread2$6({t:now(),host:util$2.getHostFromUrl(r.currentSrc),vtype:r.vtype,eventType:e,currentTime:this.player.currentTime,readyState:r.video.readyState,networkState:r.video.networkState},t))}}],[{key:"pluginName",get:function(){return"xgLogger"}},{key:"defaultConfig",get:function(){return{}}}]),r}(Plugin);function ReplaySvg(){return(new DOMParser).parseFromString('<svg class="xgplayer-replay-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 78 78" width="78" height="78">\n  <path fill="#fff" transform="translate(20, 20)" d="M8.22708362,13.8757234 L11.2677371,12.6472196 C11.7798067,12.4403301 12.3626381,12.6877273 12.5695276,13.1997969 L12.9441342,14.1269807 C13.1510237,14.6390502 12.9036264,15.2218816 12.3915569,15.4287712 L6.8284538,17.6764107 L5.90126995,18.0510173 C5.38920044,18.2579068 4.80636901,18.0105096 4.5994795,17.49844 L1.97723335,11.0081531 C1.77034384,10.4960836 2.0177411,9.91325213 2.52981061,9.70636262 L3.45699446,9.33175602 C3.96906396,9.12486652 4.5518954,9.37226378 4.75878491,9.88433329 L5.67885163,12.1615783 C7.99551726,6.6766934 13.3983951,3 19.5,3 C27.7842712,3 34.5,9.71572875 34.5,18 C34.5,26.2842712 27.7842712,33 19.5,33 C15.4573596,33 11.6658607,31.3912946 8.87004692,28.5831991 C8.28554571,27.9961303 8.28762719,27.0463851 8.87469603,26.4618839 C9.46176488,25.8773827 10.4115101,25.8794641 10.9960113,26.466533 C13.2344327,28.7147875 16.263503,30 19.5,30 C26.127417,30 31.5,24.627417 31.5,18 C31.5,11.372583 26.127417,6 19.5,6 C14.4183772,6 9.94214483,9.18783811 8.22708362,13.8757234 Z"></path>\n</svg>\n',"image/svg+xml").firstChild}var Replay=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){return _classCallCheck$7(this,r),t.apply(this,arguments)}return _createClass$8(r,[{key:"registerIcons",value:function(){return{replay:ReplaySvg}}},{key:"afterCreate",value:function(){var e=this;Plugin.insert(this.icons.replay,this.root,0),this.__handleReplay=this.hook("replayClick",(function(){e.player.replay()}),{pre:function(e){e.preventDefault(),e.stopPropagation()}}),this.bind(".xgplayer-replay",["click","touchend"],this.__handleReplay),this.on(ENDED,(function(){if(e.playerConfig.loop||util$2.addClass(e.player.root,"replay"),!e.config.disable){e.show();var t=e.root.querySelector("path");if(t){var r=window.getComputedStyle(t).getPropertyValue("transform");if("string"==typeof r&&r.indexOf("none")>-1)return null;t.setAttribute("transform",r)}}})),this.on(PLAY,(function(){e.hide()}))}},{key:"handleReplay",value:function(e){e.preventDefault(),e.stopPropagation(),this.player.replay(),util$2.removeClass(this.player.root,"replay")}},{key:"show",value:function(){this.config.disable||(this.root.style.display="flex")}},{key:"enable",value:function(){this.config.disable=!1}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){this.unbind(".xgplayer-replay",["click","touchend"],this.__handleReplay)}},{key:"render",value:function(){return'<xg-replay class="xgplayer-replay">\n      <xg-replay-txt class="xgplayer-replay-txt" lang-key="'.concat(this.i18nKeys.REPLAY,'">').concat(this.i18n.REPLAY,"</xg-replay-txt>\n    </xg-replay>")}}],[{key:"pluginName",get:function(){return"replay"}},{key:"defaultConfig",get:function(){return{disable:!1}}}]),r}(Plugin),Poster=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){return _classCallCheck$7(this,r),t.apply(this,arguments)}return _createClass$8(r,[{key:"isEndedShow",get:function(){return this.config.isEndedShow},set:function(e){this.config.isEndedShow=e}},{key:"hide",value:function(){util$2.addClass(this.root,"hide")}},{key:"show",value:function(){util$2.removeClass(this.root,"hide")}},{key:"beforeCreate",value:function(e){"string"==typeof e.player.config.poster&&(e.config.poster=e.player.config.poster)}},{key:"afterCreate",value:function(){var e=this;this.on(ENDED,(function(){e.isEndedShow&&util$2.removeClass(e.root,"hide")})),this.config.hideCanplay?(this.once(TIME_UPDATE,(function(){e.onTimeUpdate()})),this.on(URL_CHANGE,(function(){util$2.removeClass(e.root,"hide"),util$2.addClass(e.root,"xg-showplay"),e.once(TIME_UPDATE,(function(){e.onTimeUpdate()}))}))):this.on(PLAY,(function(){util$2.addClass(e.root,"hide")}))}},{key:"onTimeUpdate",value:function(){var e=this;this.player.currentTime?util$2.removeClass(this.root,"xg-showplay"):this.once(TIME_UPDATE,(function(){e.onTimeUpdate()}))}},{key:"update",value:function(e){e&&(this.config.poster=e,this.root.style.backgroundImage="url(".concat(e,")"))}},{key:"render",value:function(){var e=this.config,t=e.poster,r=e.hideCanplay,n=t?"background-image:url(".concat(t,");"):"";return'<xg-poster class="xgplayer-poster '.concat(r?"xg-showplay":"",'" style="').concat(n,'">\n    </xg-poster>')}}],[{key:"pluginName",get:function(){return"poster"}},{key:"defaultConfig",get:function(){return{isEndedShow:!0,hideCanplay:!1,poster:""}}}]),r}(Plugin);function PlaySvg(){return(new DOMParser).parseFromString('<svg class="play" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M576,363L810,512L576,661zM342,214L576,363L576,661L342,810z"></path>\n</svg>\n',"image/svg+xml").firstChild}function PauseSvg(){return(new DOMParser).parseFromString('<svg class="pause" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598,214h170v596h-170v-596zM256 810v-596h170v596h-170z"></path>\n</svg>\n',"image/svg+xml").firstChild}var AnimateMap={};function addAnimate(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{start:null,end:null};AnimateMap[e]&&window.clearTimeout(AnimateMap[e].id),AnimateMap[e]={},r.start&&r.start(),AnimateMap[e].id=window.setTimeout((function(){r.end&&r.end(),window.clearTimeout(AnimateMap[e].id),delete AnimateMap[e]}),t)}function clearAnimation(){Object.keys(AnimateMap).map((function(e){window.clearTimeout(AnimateMap[e].id),delete AnimateMap[e]}))}var Start=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(e){var n;return _classCallCheck$7(this,r),(n=t.call(this,e)).autoPlayStart=!1,n}return _createClass$8(r,[{key:"afterCreate",value:function(){var e=this,t=this.player,r=this.playerConfig;this.initIcons(),this.once(READY,(function(){r&&(r.lang&&"en"===r.lang?util$2.addClass(t.root,"lang-is-en"):"jp"===r.lang&&util$2.addClass(t.root,"lang-is-jp"))})),this.on(AUTOPLAY_STARTED,(function(){var t="auto"===e.config.mode?"auto-hide":"hide";util$2.addClass(e.root,t),e.autoPlayStart=!0,e.onPlayPause("play")})),r.autoplay||this.show(),this.on(AUTOPLAY_PREVENTED,(function(){var t="auto"===e.config.mode?"auto-hide":"hide";e.setAttr("data-state","play"),util$2.removeClass(e.root,t),e.show()})),this.on(PLAY,(function(){e.onPlayPause("play")})),this.on(PAUSE,(function(){e.onPlayPause("pause")})),this.clickHandler=this.hook("startClick",this.switchPausePlay,{pre:function(t){t.cancelable&&t.preventDefault(),t.stopPropagation();var r=e.player.paused;e.emitUserAction(t,"switch_play_pause",{props:"paused",from:r,to:!r})}}),this.bind(["click","touchend"],this.clickHandler)}},{key:"preventDefault",value:function(e){}},{key:"registerIcons",value:function(){return{startPlay:{icon:PlaySvg,class:"xg-icon-play"},startPause:{icon:PauseSvg,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild("xg-start-inner",e.startPlay),this.appendChild("xg-start-inner",e.startPause)}},{key:"hide",value:function(){util$2.addClass(this.root,"hide")}},{key:"show",value:function(){util$2.removeClass(this.root,"hide")}},{key:"focusHide",value:function(){util$2.addClass(this.root,"focus-hide")}},{key:"recover",value:function(){util$2.removeClass(this.root,"focus-hide")}},{key:"switchStatus",value:function(e){e?this.setAttr("data-state",this.player.paused?"pause":"play"):this.setAttr("data-state",this.player.paused?"play":"pause")}},{key:"animate",value:function(e){var t=this;addAnimate("pauseplay",400,{start:function(){util$2.addClass(t.root,"interact"),t.show(),t.switchStatus(!0)},end:function(){util$2.removeClass(t.root,"interact"),!e&&t.hide()}})}},{key:"switchPausePlay",value:function(e){var t=this.player;(e.cancelable&&e.preventDefault(),e.stopPropagation(),t.state<STATES$3.READY)||(this.player.paused||t.state!==STATES$3.RUNNING?t.play():t.pause())}},{key:"onPlayPause",value:function(e){var t=this.config,r=this.player;if(!(r.state<STATES$3.RUNNING)&&this.autoPlayStart){if("show"===t.mode)return this.switchStatus(),void this.show();if("auto"!==t.mode){if(t.isShowPause&&r.paused&&!r.ended||t.isShowEnd&&r.ended)return this.switchStatus(),void this.show();if(t.disableAnimate)return this.switchStatus(),void this.hide();if("play"===e)this.autoPlayStart?this.animate():this.hide();else{if(!this.autoPlayStart||r.ended)return;this.animate()}}else this.switchStatus()}}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.clickHandler),clearAnimation()}},{key:"render",value:function(){var e=this.playerConfig.autoplay?"auto"===this.config.mode?"auto-hide":"hide":"";return'\n    <xg-start class="xgplayer-start '.concat(e,'">\n    <xg-start-inner></xg-start-inner>\n    </xg-start>')}}],[{key:"pluginName",get:function(){return"start"}},{key:"defaultConfig",get:function(){return{isShowPause:!1,isShowEnd:!1,disableAnimate:!1,mode:"hide"}}}]),r}(Plugin),Enter=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){return _classCallCheck$7(this,r),t.apply(this,arguments)}return _createClass$8(r,[{key:"render",value:function(){var e=this.config.innerHtml,t=util$2.createDom("xg-enter","",{},"xgplayer-enter");if(e&&e instanceof window.HTMLElement)t.appendChild(e);else if(e&&"string"==typeof e)t.innerHTML=e;else{for(var r="",n=1;n<=12;n++)r+='<div class="xgplayer-enter-bar'.concat(n,'"></div>');t.innerHTML='<div class="xgplayer-enter-spinner">'.concat(r,"</div>")}return t}}],[{key:"pluginName",get:function(){return"enter"}},{key:"defaultConfig",get:function(){return{innerHtml:"",logo:""}}}]),r}(Plugin),MiniScreenIcon=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){return _classCallCheck$7(this,r),t.apply(this,arguments)}return _createClass$8(r,[{key:"afterCreate",value:function(){this.getMini=this.getMini.bind(this),this.exitMini=this.exitMini.bind(this),this.bind("click",this.getMini)}},{key:"getMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"exitMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.getMini)}},{key:"render",value:function(){var e="MINISCREEN";return'\n      <xg-icon class="xgplayer-miniicon">\n      <div class="xgplayer-icon btn-text"><span class="icon-text" lang-key="'.concat(this.i18nKeys[e],'">').concat(this.i18n[e],"</span></div>\n      </xg-icon>")}}],[{key:"pluginName",get:function(){return"miniscreenIcon"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:10}}}]),r}(Plugin);function getStyleSize(e){var t=parseFloat(e);return-1===e.indexOf("%")&&!isNaN(t)&&t}var measurements=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],measurementsLength=measurements.length;function getZeroSize(){for(var e={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},t=0;t<measurementsLength;t++){e[measurements[t]]=0}return e}function getStyle(e){return window.getComputedStyle(e)}function getSize(e){if("string"==typeof e&&(e=document.querySelector(e)),e&&"object"===_typeof$6(e)&&e.nodeType){var t=getStyle(e);if("none"===t.display)return getZeroSize();var r={};r.width=e.offsetWidth,r.height=e.offsetHeight;for(var n=r.isBorderBox="border-box"===t.boxSizing,i=0;i<measurementsLength;i++){var a=measurements[i],o=t[a],s=parseFloat(o);r[a]=isNaN(s)?0:s}var u=r.paddingLeft+r.paddingRight,c=r.paddingTop+r.paddingBottom,l=r.marginLeft+r.marginRight,d=r.marginTop+r.marginBottom,h=r.borderLeftWidth+r.borderRightWidth,f=r.borderTopWidth+r.borderBottomWidth,p=n,g=getStyleSize(t.width);!1!==g&&(r.width=g+(p?0:u+h));var y=getStyleSize(t.height);return!1!==y&&(r.height=y+(p?0:c+f)),r.innerWidth=r.width-(u+h),r.innerHeight=r.height-(c+f),r.outerWidth=r.width+l,r.outerHeight=r.height+d,r}}function getTouch$1(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(n.identifier===t)return n}}var EVENTS$2={START:"dragStart",MOVE:"dragMove",ENDED:"dragEnded"},POST_START_EVENTS={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]},Draggabilly=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck$7(this,r),(n=t.call(this)).isEnabled=!0,n.isDragging=!1,n.isDown=!1,n.position={},n.downPoint={},n.dragPoint={x:0,y:0},n.startPos={x:0,y:0},n._root=e instanceof Element?e:document.querySelector(e),n._handlerDom=i.handle instanceof Element?i.handle:document.querySelector(i.handle),n._root&&n._handlerDom?(n._bindStartEvent(),n):_possibleConstructorReturn$7(n)}return _createClass$8(r,[{key:"_bindStartEvent",value:function(){var e=this;"ontouchstart"in window?this._startKey="touchstart":this._startKey="mousedown",this["on".concat(this._startKey)]=this["on".concat(this._startKey)].bind(this),this._handlerDom.addEventListener(this._startKey,this["on".concat(this._startKey)]),POST_START_EVENTS[this._startKey].map((function(t){e["on".concat(t)]=e["on".concat(t)].bind(e)}))}},{key:"_unbindStartEvent",value:function(){this._handlerDom.removeEventListener(this._startKey,this["on".concat(this._startKey)])}},{key:"_bindPostStartEvents",value:function(e){var t=this;if(e){var r=POST_START_EVENTS[this._startKey];r.map((function(e){window.addEventListener(e,t["on".concat(e)])})),this._boundPointerEvents=r}}},{key:"_unbindPostStartEvents",value:function(){var e=this;this._boundPointerEvents&&(this._boundPointerEvents.map((function(t){window.removeEventListener(t,e["on".concat(t)])})),delete this._boundPointerEvents)}},{key:"enable",value:function(){this.isEnabled=!0}},{key:"disable",value:function(){this.isEnabled=!1,this.isDragging&&this.onUp()}},{key:"onDocUp",value:function(e){this.onUp()}},{key:"animate",value:function(){var e=this;this.isDragging&&(this.positionDrag(),window.requestAnimationFrame((function(){e.animate()})))}},{key:"positionDrag",value:function(){var e="translate3d(".concat(this.dragPoint.x,"px, ").concat(this.dragPoint.y,"px, 0)");this._root.style.transform=e,this._root.style.webKitTransform=e}},{key:"setLeftTop",value:function(){this._root.style.left=this.position.x+"px",this._root.style.top=this.position.y+"px"}},{key:"onmousedown",value:function(e){this.dragStart(e,e)}},{key:"onmousemove",value:function(e){this.dragMove(e,e)}},{key:"onmouseup",value:function(e){this.dragEnd(e,e)}},{key:"ontouchstart",value:function(e){var t=e.changedTouches[0];this.dragStart(e,t),this.touchIdentifier=void 0!==t.pointerId?t.pointerId:t.identifier,e.preventDefault()}},{key:"ontouchmove",value:function(e){var t=getTouch$1(e.changedTouches,this.touchIdentifier);t&&this.dragMove(e,t)}},{key:"ontouchend",value:function(e){var t=getTouch$1(e.changedTouches,this.touchIdentifier);t&&this.dragEnd(e,t),e.preventDefault()}},{key:"ontouchcancel",value:function(e){var t=getTouch$1(e.changedTouches,this.touchIdentifier);t&&this.dragCancel(e,t)}},{key:"dragStart",value:function(e,t){if(this._root&&!this.isDown&&this.isEnabled){this.downPoint=t,this.dragPoint.x=0,this.dragPoint.y=0,this._getPosition();var r=getSize(this._root);this.startPos.x=this.position.x,this.startPos.y=this.position.y,this.startPos.maxY=window.innerHeight-r.height,this.startPos.maxX=window.innerWidth-r.width,this.setLeftTop(),this.isDown=!0,this._bindPostStartEvents(e)}}},{key:"dragRealStart",value:function(e,t){this.isDragging=!0,this.animate(),this.emit(EVENTS$2.START,this.startPos)}},{key:"dragEnd",value:function(e,t){this._root&&(this._unbindPostStartEvents(),this.isDragging&&(this._root.style.transform="",this.setLeftTop(),this.emit(EVENTS$2.ENDED)),this.presetInfo())}},{key:"_dragPointerMove",value:function(e,t){var r={x:t.pageX-this.downPoint.pageX,y:t.pageY-this.downPoint.pageY};return!this.isDragging&&this.hasDragStarted(r)&&this.dragRealStart(e,t),r}},{key:"dragMove",value:function(e,t){if(e=e||window.event,this.isDown){var r=this.startPos,n=r.x,i=r.y,a=this._dragPointerMove(e,t),o=a.x,s=a.y;o=this.checkContain("x",o,n),s=this.checkContain("y",s,i),this.position.x=n+o,this.position.y=i+s,this.dragPoint.x=o,this.dragPoint.y=s,this.emit(EVENTS$2.MOVE,this.position)}}},{key:"dragCancel",value:function(e,t){this.dragEnd(e,t)}},{key:"presetInfo",value:function(){this.isDragging=!1,this.startPos={x:0,y:0},this.dragPoint={x:0,y:0},this.isDown=!1}},{key:"destroy",value:function(){this._unbindStartEvent(),this._unbindPostStartEvents(),this.isDragging&&this.dragEnd(),this.removeAllListeners(),this._handlerDom=null}},{key:"hasDragStarted",value:function(e){return Math.abs(e.x)>3||Math.abs(e.y)>3}},{key:"checkContain",value:function(e,t,r){return t+r<0?0-r:"x"===e&&t+r>this.startPos.maxX?this.startPos.maxX-r:"y"===e&&t+r>this.startPos.maxY?this.startPos.maxY-r:t}},{key:"_getPosition",value:function(){var e=window.getComputedStyle(this._root),t=this._getPositionCoord(e.left,"width"),r=this._getPositionCoord(e.top,"height");this.position.x=isNaN(t)?0:t,this.position.y=isNaN(r)?0:r,this._addTransformPosition(e)}},{key:"_addTransformPosition",value:function(e){var t=e.transform;if(0===t.indexOf("matrix")){var r=t.split(","),n=0===t.indexOf("matrix3d")?12:4,i=parseInt(r[n],10),a=parseInt(r[n+1],10);this.position.x+=i,this.position.y+=a}}},{key:"_getPositionCoord",value:function(e,t){if(-1!==e.indexOf("%")){var r=getSize(this._root.parentNode);return r?parseFloat(e)/100*r[t]:0}return parseInt(e,10)}}]),r}(EventEmitter$1),MiniScreen=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(e){var n;_classCallCheck$7(this,r),_defineProperty$8(_assertThisInitialized$7(n=t.call(this,e)),"onCancelClick",(function(e){n.exitMini(),n.isClose=!0})),_defineProperty$8(_assertThisInitialized$7(n),"onCenterClick",(function(e){var t=_assertThisInitialized$7(n).player;t.paused?t.play():t.pause()})),_defineProperty$8(_assertThisInitialized$7(n),"onScroll",(function(e){if(!(!window.scrollY&&0!==window.scrollY||Math.abs(window.scrollY-n.pos.scrollY)<50)){var t=parseInt(util$2.getCss(n.player.root,"height"));t+=n.config.scrollTop,n.pos.scrollY=window.scrollY,window.scrollY>t+5?!n.isMini&&!n.isClose&&n.getMini():window.scrollY<=t&&(n.isMini&&n.exitMini(),n.isClose=!1)}})),n.isMini=!1,n.isClose=!1;var i=_assertThisInitialized$7(n).config;return n.pos={left:i.left<0?window.innerWidth-i.width-20:i.left,top:i.top<0?window.innerHeight-i.height-20:i.top,height:n.config.height,width:n.config.width,scrollY:window.scrollY||0},n.lastStyle=null,n}return _createClass$8(r,[{key:"beforeCreate",value:function(e){"boolean"==typeof e.player.config.mini&&(e.config.isShowIcon=e.player.config.mini)}},{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.on(PAUSE,(function(){e.setAttr("data-state","pause")})),this.on(PLAY,(function(){e.setAttr("data-state","play")}))}},{key:"onPluginsReady",value:function(){var e=this,t=this.player;if(!this.config.disable){if(this.config.isShowIcon){var r={config:{onClick:function(){e.getMini()}}};t.controls.registerPlugin(MiniScreenIcon,r,MiniScreenIcon.pluginName)}var n=util$2.checkTouchSupport()?"touchend":"click";this.bind(".mini-cancel-btn",n,this.onCancelClick),this.bind(".play-icon",n,this.onCenterClick),this.config.disableDrag||(this._draggabilly=new Draggabilly(this.player.root,{handle:this.root})),this.config.isScrollSwitch&&window.addEventListener("scroll",this.onScroll)}}},{key:"registerIcons",value:function(){return{play:{icon:PlaySvg,class:"xg-icon-play"},pause:{icon:PauseSvg,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".play-icon",e.play),this.appendChild(".play-icon",e.pause)}},{key:"getMini",value:function(){var e=this;if(!this.isMini){var t=this.player,r=this.playerConfig,n=this.config.target||this.player.root;this.lastStyle={},util$2.addClass(t.root,"xgplayer-mini"),["width","height","top","left"].map((function(t){e.lastStyle[t]=n.style[t],n.style[t]="".concat(e.pos[t],"px")})),r.fluid&&(n.style["padding-top"]=""),this.emit(MINI_STATE_CHANGE,!0),t.isMini=this.isMini=!0}}},{key:"exitMini",value:function(){var e=this;if(!this.isMini)return!1;var t=this.player,r=this.playerConfig,n=this.config.target||this.player.root;util$2.removeClass(t.root,"xgplayer-mini"),this.lastStyle&&Object.keys(this.lastStyle).map((function(t){n.style[t]=e.lastStyle[t]})),this.lastStyle=null,r.fluid&&(t.root.style.width="100%",t.root.style.height="0",t.root.style["padding-top"]="".concat(100*r.height/r.width,"%")),this.emit(MINI_STATE_CHANGE,!1),this.isMini=t.isMini=!1}},{key:"destroy",value:function(){window.removeEventListener("scroll",this.onScroll);var e=util$2.checkTouchSupport()?"touchend":"click";this.unbind(".mini-cancel-btn",e,this.onCancelClick),this.unbind(".play-icon",e,this.onCenterClick),this._draggabilly&&this._draggabilly.destroy(),this._draggabilly=null,this.exitMini()}},{key:"render",value:function(){if(!this.config.disable)return'\n      <xg-mini-layer class="xg-mini-layer">\n      <xg-mini-header class="xgplayer-mini-header">\n      <div lang-key="'.concat(this.i18nKeys.MINI_DRAG,'">').concat(this.i18n.MINI_DRAG,'</div>\n      </xg-mini-header>\n      <div class="mini-cancel-btn">\n        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">\n          <path fill="#fff" fill-rule="evenodd" d="M3.99 3.49a1 1 0 0 1 1.414 0L10 8.085l4.596-4.595a1 1 0 1 1 1.414 1.414L11.414 9.5l4.596 4.596a1 1 0 0 1 .084 1.32l-.084.094a1 1 0 0 1-1.414 0L10 10.914 5.404 15.51a1 1 0 0 1-1.414-1.414L8.585 9.5 3.99 4.904a1 1 0 0 1-.084-1.32z"></path>\n        </svg>\n      </div>\n      <div class="play-icon">\n      </div>\n      </xg-mini-layer>')}}],[{key:"pluginName",get:function(){return"miniscreen"}},{key:"defaultConfig",get:function(){return{index:10,disable:!1,width:320,height:180,left:-1,top:-1,isShowIcon:!1,isScrollSwitch:!1,scrollTop:0,disableDrag:!1}}}]),r}(Plugin),MOUSE_EVENTS={mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousemove:"onMouseMove"},HOOKS=["videoClick","videoDbClick"],PCPlugin=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){var e;_classCallCheck$7(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$8(_assertThisInitialized$7(e=t.call.apply(t,[this].concat(i))),"onMouseMove",(function(t){var r=_assertThisInitialized$7(e),n=r.player,i=r.playerConfig;n.isActive||(n.focus({autoHide:!i.closeDelayBlur}),!i.closeFocusVideoFocus&&n.video.focus())})),_defineProperty$8(_assertThisInitialized$7(e),"onMouseEnter",(function(t){var r=_assertThisInitialized$7(e),n=r.playerConfig,i=r.player;i.focus({autoHide:!n.closeDelayBlur}),!n.closeFocusVideoFocus&&i.video.focus()})),_defineProperty$8(_assertThisInitialized$7(e),"onMouseLeave",(function(t){var r=e.playerConfig,n=r.closePlayerBlur,i=r.leavePlayerTime;n||(i?e.player.focus({autoHide:!0,delay:i}):e.player.blur())})),_defineProperty$8(_assertThisInitialized$7(e),"onVideoClick",(function(t){var r=_assertThisInitialized$7(e),n=r.player,i=r.playerConfig;t.target&&i.closeVideoClick||t.target!==n.video&&t.target!==n.innerContainer&&t.target!==n.video.__canvas||(t.preventDefault(),i.closeVideoStopPropagation||t.stopPropagation(),e._clickCount++,e.clickTimer&&(clearTimeout(e.clickTimer),e.clickTimer=null),e.clickTimer=setTimeout((function(){e._clickCount&&(e._clickCount--,runHooks(_assertThisInitialized$7(e),HOOKS[0],(function(t,r){e.switchPlayPause(r.e)}),{e:t,paused:n.paused}),clearTimeout(e.clickTimer),e.clickTimer=null)}),300))})),_defineProperty$8(_assertThisInitialized$7(e),"onVideoDblClick",(function(t){var r=_assertThisInitialized$7(e),n=r.player,i=r.playerConfig;!t.target||t.target!==n.video&&t.target!==n.video.__canvas||i.closeVideoDblclick||(e._clickCount<2?e._clickCount=0:(e._clickCount=0,e.clickTimer&&(clearTimeout(e.clickTimer),e.clickTimer=null),t.preventDefault(),t.stopPropagation(),runHooks(_assertThisInitialized$7(e),HOOKS[1],(function(t,r){e.emitUserAction(r.e,"switch_fullscreen",{props:"fullscreen",from:n.fullscreen,to:!n.fullscreen}),n.fullscreen?n.exitFullscreen():n.getFullscreen()}),{e:t,fullscreen:n.fullscreen})))})),e}return _createClass$8(r,[{key:"afterCreate",value:function(){var e=this;this._clickCount=0,HOOKS.map((function(t){e.__hooks[t]=null}));var t=this.playerConfig,r=t.enableContextmenu;t.isMobileSimulateMode||"mobile"===sniffer$1.device&&!sniffer$1.os.isIpad||(this.config.disableContextmenu=!r,this.initEvents())}},{key:"initEvents",value:function(){var e=this,t=this.player,r=t.video,n=t.root;r.addEventListener("click",this.onVideoClick,!1),r.addEventListener("dblclick",this.onVideoDblClick,!1),Object.keys(MOUSE_EVENTS).map((function(t){n.addEventListener(t,e[MOUSE_EVENTS[t]],!1)})),this.config.disableContextmenu&&r.addEventListener("contextmenu",this.onContextmenu,!1)}},{key:"switchPlayPause",value:function(e){var t=this.player;this.emitUserAction(e,"switch_play_pause",{props:"paused",from:t.paused,to:!t.paused}),t.ended?t.duration!==1/0&&t.duration>0&&t.replay():t.paused?t.play():t.pause()}},{key:"onContextmenu",value:function(e){(e=e||window.event).preventDefault&&e.preventDefault(),e.stopPropagation?e.stopPropagation():(e.returnValue=!1,e.cancelBubble=!0)}},{key:"destroy",value:function(){var e=this,t=this.player,r=t.video,n=t.root;this.clickTimer&&clearTimeout(this.clickTimer),n.removeEventListener("click",this.onVideoClick,!1),r.removeEventListener("dblclick",this.onVideoDblClick,!1),r.removeEventListener("contextmenu",this.onContextmenu,!1),Object.keys(MOUSE_EVENTS).map((function(t){n.removeEventListener(t,e[MOUSE_EVENTS[t]],!1)}))}}],[{key:"pluginName",get:function(){return"pc"}},{key:"defaultConfig",get:function(){return{disableContextmenu:!0}}}]),r}(BasePlugin),toIntegerOrInfinity$9=toIntegerOrInfinity$f,toString$i=toString$v,requireObjectCoercible$6=requireObjectCoercible$e,$RangeError$6=RangeError,stringRepeat=function(e){var t=toString$i(requireObjectCoercible$6(this)),r="",n=toIntegerOrInfinity$9(e);if(n<0||n==1/0)throw $RangeError$6("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(r+=t);return r},$$10=_export,uncurryThis$A=functionUncurryThis,toIntegerOrInfinity$8=toIntegerOrInfinity$f,thisNumberValue=thisNumberValue$2,$repeat$1=stringRepeat,fails$y=fails$10,$RangeError$5=RangeError,$String=String,floor$6=Math.floor,repeat$2=uncurryThis$A($repeat$1),stringSlice$7=uncurryThis$A("".slice),nativeToFixed=uncurryThis$A(1..toFixed),pow$3=function e(t,r,n){return 0===r?n:r%2==1?e(t,r-1,n*t):e(t*t,r/2,n)},log$4=function(e){for(var t=0,r=e;r>=4096;)t+=12,r/=4096;for(;r>=2;)t+=1,r/=2;return t},multiply=function(e,t,r){for(var n=-1,i=r;++n<6;)i+=t*e[n],e[n]=i%1e7,i=floor$6(i/1e7)},divide=function(e,t){for(var r=6,n=0;--r>=0;)n+=e[r],e[r]=floor$6(n/t),n=n%t*1e7},dataToString=function(e){for(var t=6,r="";--t>=0;)if(""!==r||0===t||0!==e[t]){var n=$String(e[t]);r=""===r?n:r+repeat$2("0",7-n.length)+n}return r},FORCED$b=fails$y((function(){return"0.000"!==nativeToFixed(8e-5,3)||"1"!==nativeToFixed(.9,0)||"1.25"!==nativeToFixed(1.255,2)||"1000000000000000128"!==nativeToFixed(0xde0b6b3a7640080,0)}))||!fails$y((function(){nativeToFixed({})}));$$10({target:"Number",proto:!0,forced:FORCED$b},{toFixed:function(e){var t,r,n,i,a=thisNumberValue(this),o=toIntegerOrInfinity$8(e),s=[0,0,0,0,0,0],u="",c="0";if(o<0||o>20)throw $RangeError$5("Incorrect fraction digits");if(a!=a)return"NaN";if(a<=-1e21||a>=1e21)return $String(a);if(a<0&&(u="-",a=-a),a>1e-21)if(r=(t=log$4(a*pow$3(2,69,1))-69)<0?a*pow$3(2,-t,1):a/pow$3(2,t,1),r*=4503599627370496,(t=52-t)>0){for(multiply(s,0,r),n=o;n>=7;)multiply(s,1e7,0),n-=7;for(multiply(s,pow$3(10,n,1),0),n=t-1;n>=23;)divide(s,1<<23),n-=23;divide(s,1<<n),multiply(s,1,1),divide(s,2),c=dataToString(s)}else multiply(s,0,r),multiply(s,1<<-t,0),c=dataToString(s)+repeat$2("0",o);return c=o>0?u+((i=c.length)<=o?"0."+repeat$2("0",o-i)+c:stringSlice$7(c,0,i-o)+"."+stringSlice$7(c,i-o)):u+c}});var EVENTS$1={PRESS:"press",PRESS_END:"pressend",DOUBlE_CLICK:"doubleclick",CLICK:"click",TOUCH_MOVE:"touchmove",TOUCH_START:"touchstart",TOUCH_END:"touchend"},TOUCHS={start:"touchstart",end:"touchend",move:"touchmove",cancel:"touchcancel"},MOUSES={start:"mousedown",end:"mouseup",move:"mousemove",cancel:"mouseleave"};function getTouch(e){return e&&e.length>0?e[e.length-1]:null}function preventToucheDefault(e){var t=navigator.userAgent;/(?:iPhone|iPad)/.test(t)&&e.cancelable&&e.preventDefault()}function getDefaultConfig(){return{pressDelay:600,dbClickDelay:200,disablePress:!1,disableDbClick:!1,miniStep:2,needPreventDefault:!0}}var Touche=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{eventType:"touch"};_classCallCheck$7(this,e),this._pos={moving:!1,start:!1,x:0,y:0},this.config=getDefaultConfig(),Object.keys(n).map((function(e){r.config[e]=n[e]})),this.root=t,this.events="mouse"===n.eventType?MOUSES:TOUCHS,this.pressIntrvalId=null,this.dbIntrvalId=null,this.__handlers={},this._initEvent()}return _createClass$8(e,[{key:"_initEvent",value:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchCancel=this.onTouchCancel.bind(this),this.root.addEventListener(this.events.start,this.onTouchStart)}},{key:"__setPress",value:function(e){var t=this,r=this.config;this.pressIntrvalId&&this.__clearPress(),this.pressIntrvalId=setTimeout((function(){t.trigger(EVENTS$1.PRESS,e),t._pos.press=!0,t.__clearPress()}),r.pressDelay)}},{key:"__clearPress",value:function(){window.clearTimeout(this.pressIntrvalId),this.pressIntrvalId=null}},{key:"__setDb",value:function(e){var t=this,r=this.config;if(this.dbIntrvalId)return this.__clearDb(),void this.trigger(EVENTS$1.DOUBlE_CLICK,e);this.dbIntrvalId=setTimeout((function(){t.__clearDb(),t._pos.start||t._pos.press||t._pos.moving||t.trigger(EVENTS$1.CLICK,e)}),r.dbClickDelay)}},{key:"__clearDb",value:function(){clearTimeout(this.dbIntrvalId),this.dbIntrvalId=null}},{key:"on",value:function(e,t){this.__handlers[e]||(this.__handlers[e]=[]),this.__handlers[e].push(t)}},{key:"off",value:function(e,t){if(this.__handlers[e]){for(var r=this.__handlers[e],n=-1,i=0;i<r.length;i++)if(r[i]===t){n=i;break}n>=0&&this.__handlers[e].splice(n,1)}}},{key:"trigger",value:function(e,t){this.__handlers[e]&&this.__handlers[e].map((function(r){try{r(t)}catch(error){console.error("trigger>>:".concat(e),error)}}))}},{key:"onTouchStart",value:function(e){var t=this._pos,r=this.root;this.config.needPreventDefault&&preventToucheDefault(e);var n=getTouch(e.touches);t.x=n?parseInt(n.pageX,10):e.pageX,t.y=n?parseInt(n.pageX,10):e.pageX,t.start=!0,this.__setPress(e),r.addEventListener(this.events.end,this.onTouchEnd),r.addEventListener(this.events.cancel,this.onTouchCancel),r.addEventListener(this.events.move,this.onTouchMove),this.trigger(EVENTS$1.TOUCH_START,e)}},{key:"onTouchCancel",value:function(e){this.onTouchEnd(e)}},{key:"onTouchEnd",value:function(e){var t=this._pos,r=this.root;this.config.needPreventDefault&&preventToucheDefault(e),this.__clearPress(),r.removeEventListener(this.events.cancel,this.onTouchCancel),r.removeEventListener(this.events.end,this.onTouchEnd),r.removeEventListener(this.events.move,this.onTouchMove),e.moving=t.moving,e.press=t.press,t.press&&this.trigger(EVENTS$1.PRESS_END,e),this.trigger(EVENTS$1.TOUCH_END,e),!t.press&&!t.moving&&this.__setDb(e),t.press=!1,t.start=!1,t.moving=!1}},{key:"onTouchMove",value:function(e){var t=this._pos,r=this.config,n=getTouch(e.touches),i=n?parseInt(n.pageX,10):e.pageX,a=n?parseInt(n.pageY,10):e.pageX,o=i-t.x,s=a-t.y;Math.abs(s)<r.miniStep&&Math.abs(o)<r.miniStep||(this.__clearPress(),t.press&&this.trigger(EVENTS$1.PRESS_END,e),t.press=!1,t.moving=!0,this.trigger(EVENTS$1.TOUCH_MOVE,e))}},{key:"destroy",value:function(){var e=this,t={touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart"};Object.keys(t).map((function(r){e.root.removeEventListener("touchend",e[t[r]])}))}}]),e}();function SeekTipIcon(){return(new DOMParser).parseFromString('<svg width="20" height="9" viewBox="0 0 8 9" fill="none" xmlns="http://www.w3.org/2000/svg"\n  xmlns:xlink="http://www.w3.org/1999/xlink">\n  <path opacity="0.54"\n    d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z"\n    fill="white" />\n  <path transform="translate(5 0)" d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z" fill="white"/>\n</svg>',"image/svg+xml").firstChild}var ACTIONS={AUTO:"auto",SEEKING:"seeking",PLAYBACK:"playbackrate",LIGHT:""},MobilePlugin=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(e){var n;return _classCallCheck$7(this,r),_defineProperty$8(_assertThisInitialized$7(n=t.call(this,e)),"onTouchStart",(function(e){var t=_assertThisInitialized$7(n),r=t.player,i=t.config,a=t.pos,o=t.playerConfig,s=n.getTouche(e);if(s&&!i.disableGesture&&n.duration>0&&!r.ended){a.isStart=!0,util$2.checkIsFunction(o.disableSwipeHandler)&&o.disableSwipeHandler(),n.find(".xg-dur").innerHTML=util$2.format(n.duration);var u=n.root.getBoundingClientRect();90===r.rotateDeg?(a.top=u.left,a.left=u.top,a.width=u.height,a.height=u.width):(a.top=u.top,a.left=u.left,a.width=u.width,a.height=u.height);var c=parseInt(s.pageX-a.left,10),l=parseInt(s.pageY-a.top,10);a.x=90===r.rotateDeg?l:c,a.y=90===r.rotateDeg?c:l,a.scopeL=i.scopeL*a.width,a.scopeR=(1-i.scopeR)*a.width,a.scopeM1=a.width*(1-i.scopeM)/2,a.scopeM2=a.width-a.scopeM1}})),_defineProperty$8(_assertThisInitialized$7(n),"onTouchMove",(function(e){var t=n.getTouche(e),r=_assertThisInitialized$7(n),i=r.pos,a=r.config,o=r.player;if(t&&!a.disableGesture&&n.duration&&i.isStart){var s=a.miniMoveStep,u=a.hideControlsActive,c=parseInt(t.pageX-i.left,10),l=parseInt(t.pageY-i.top,10),d=90===o.rotateDeg?l:c,h=90===o.rotateDeg?c:l;if(Math.abs(d-i.x)>s||Math.abs(h-i.y)>s){var f=d-i.x,p=h-i.y,g=i.scope;if(-1===g&&(0===(g=n.checkScope(d,h,f,p,i))&&(u?o.blur():o.focus({autoHide:!1}),!i.time&&(i.time=parseInt(1e3*o.currentTime,10)+1e3*n.timeOffset)),i.scope=g),-1===g||g>0&&!a.gestureY||0===g&&!a.gestureX)return;e.cancelable&&e.preventDefault(),n.executeMove(f,p,g,i.width,i.height),i.x=d,i.y=h}}})),_defineProperty$8(_assertThisInitialized$7(n),"onTouchEnd",(function(e){var t=_assertThisInitialized$7(n),r=t.player,i=t.pos,a=t.playerConfig;i.isStart&&(i.scope>-1&&e.cancelable&&e.preventDefault(),n.endLastMove(i.scope),setTimeout((function(){r.getPlugin("progress")&&r.getPlugin("progress").resetSeekState()}),10),i.scope=-1,n.resetPos(),util$2.checkIsFunction(a.enableSwipeHandler)&&a.enableSwipeHandler(),n.changeAction(ACTIONS.AUTO))})),_defineProperty$8(_assertThisInitialized$7(n),"onRootTouchMove",(function(e){!n.config.disableGesture&&n.config.gestureX&&n.checkIsRootTarget(e)&&(e.stopPropagation(),n.pos.isStart?n.onTouchMove(e):n.onTouchStart(e))})),_defineProperty$8(_assertThisInitialized$7(n),"onRootTouchEnd",(function(e){n.pos.isStart&&n.checkIsRootTarget(e)&&(e.stopPropagation(),n.onTouchEnd(e))})),n.pos={isStart:!1,x:0,y:0,time:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1},n.timer=null,n}return _createClass$8(r,[{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"registerIcons",value:function(){return{seekTipIcon:{icon:SeekTipIcon,class:"xg-seek-pre"}}}},{key:"afterCreate",value:function(){var e=this,t=this.playerConfig,r=this.config,n=this.player;!0===t.closeVideoDblclick&&(r.closedbClick=!0),this.resetPos(),util$2.isUndefined(t.disableGesture)||(r.disableGesture=!!t.disableGesture),this.appendChild(".xg-seek-icon",this.icons.seekTipIcon),this.xgMask=util$2.createDom("xg-mask","",{},"xgmask"),n.root.appendChild(this.xgMask),this.initCustomStyle(),this.registerThumbnail();var i=this.domEventType;this.touch=new Touche(this.root,{eventType:i,needPreventDefault:!this.config.disableGesture}),this.root.addEventListener("contextmenu",(function(e){e.preventDefault()})),n.root.addEventListener("touchmove",this.onRootTouchMove,!0),n.root.addEventListener("touchend",this.onRootTouchEnd,!0),this.on(DURATION_CHANGE,(function(){var t=e.player,r=e.config;1e3*t.duration<r.moveDuration&&(r.moveDuration=1e3*t.duration)})),this.on([CANPLAY,ENDED],(function(){var t=e.pos,r=t.time;!t.isStart&&r>0&&(e.pos.time=0)}));var a={touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",press:"onPress",pressend:"onPressEnd",click:"onClick",doubleclick:"onDbClick"};if(Object.keys(a).map((function(t){e.touch.on(t,(function(r){e[a[t]](r)}))})),!r.disableActive){var o=n.plugins.progress;o&&(o.addCallBack("dragmove",(function(t){e.activeSeekNote(t.currentTime,t.forward)})),o.addCallBack("dragend",(function(){e.changeAction(ACTIONS.AUTO)})))}}},{key:"registerThumbnail",value:function(){var e=this.player.plugins.thumbnail;if(e&&e.usable){this.thumbnail=e.createThumbnail(null,"mobile-thumbnail");var t=this.find(".time-preview");t.insertBefore(this.thumbnail,t.children[0])}}},{key:"initCustomStyle",value:function(){var e=(this.playerConfig||{}).commonStyle,t=e.playedColor,r=e.progressColor;t&&(this.find(".xg-curbar").style.backgroundColor=t,this.find(".xg-cur").style.color=t),r&&(this.find(".xg-bar").style.backgroundColor=r,this.find(".time-preview").style.color=r),this.config.disableTimeProgress&&util$2.addClass(this.find(".xg-timebar"),"hide")}},{key:"resetPos",value:function(){var e=this;this.pos?(this.pos.isStart=!1,this.pos.scope=-1,["x","y","width","height","scopeL","scopeR","scopeM1","scopeM2"].map((function(t){e.pos[t]=0}))):this.pos={isStart:!1,x:0,y:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1,time:0}}},{key:"changeAction",value:function(e){var t=this.player;this.root.setAttribute("data-xg-action",e);var r=t.plugins.start;r&&r.recover()}},{key:"getTouche",value:function(e){this.player.rotateDeg;var t=e.touches&&e.touches.length>0?e.touches[e.touches.length-1]:e;return{pageX:t.pageX,pageY:t.pageY}}},{key:"checkScope",value:function(e,t,r,n,i){var a=i.width,o=-1;if(e<0||e>a)return o;var s=0===n?Math.abs(r):Math.abs(r/n);return Math.abs(r)>0&&s>=1.73&&e>i.scopeM1&&e<i.scopeM2?o=0:(0===Math.abs(r)||s<=.57)&&(o=e<i.scopeL?1:e>i.scopeR?2:3),o}},{key:"executeMove",value:function(e,t,r,n,i){switch(r){case 0:this.updateTime(e/n*this.config.scopeM);break;case 1:this.updateBrightness(t/i);break;case 2:sniffer$1.os.isIos||this.updateVolume(t/i)}}},{key:"endLastMove",value:function(e){var t=this,r=this.pos,n=this.player,i=this.config,a=(r.time-this.timeOffset)/1e3;if(0===e)n.seek(Number(a).toFixed(1)),i.hideControlsEnd?n.blur():n.focus(),this.timer=setTimeout((function(){t.pos.time=0}),500);this.changeAction(ACTIONS.AUTO)}},{key:"checkIsRootTarget",value:function(e){var t=this.player.plugins||{};return(!t.progress||!t.progress.root.contains(e.target))&&(t.start&&t.start.root.contains(e.target)||t.controls&&t.controls.root.contains(e.target))}},{key:"sendUseAction",value:function(e){var t=this.player.paused;this.emitUserAction(e,"switch_play_pause",{prop:"paused",from:t,to:!t})}},{key:"onClick",value:function(e){var t=this.player,r=this.config,n=this.playerConfig;t.state<STATES$3.RUNNING?n.closeVideoClick||(this.sendUseAction(new Event("click")),t.play()):!r.closedbClick||n.closeVideoClick?t.isActive?t.blur():t.focus():n.closeVideoClick||((t.isActive||r.focusVideoClick)&&(this.emitUserAction("click","switch_play_pause"),this.switchPlayPause()),t.focus())}},{key:"onDbClick",value:function(e){var t=this.config,r=this.player;!t.closedbClick&&r.state>=STATES$3.RUNNING&&(this.sendUseAction(new Event("dblclick")),this.switchPlayPause())}},{key:"onPress",value:function(e){var t=this.pos,r=this.config,n=this.player;r.disablePress||(t.rate=this.player.playbackRate,this.emitUserAction("press","change_rate",{prop:"playbackRate",from:n.playbackRate,to:r.pressRate}),n.playbackRate=r.pressRate,this.changeAction(ACTIONS.PLAYBACK))}},{key:"onPressEnd",value:function(e){var t=this.pos,r=this.config,n=this.player;r.disablePress||(this.emitUserAction("pressend","change_rate",{prop:"playbackRate",from:n.playbackRate,to:t.rate}),n.playbackRate=t.rate,t.rate=1,this.changeAction(ACTIONS.AUTO))}},{key:"updateTime",value:function(e){var t=this.player,r=this.config,n=this.player.duration;e=Number(e.toFixed(4));var i=parseInt(e*r.moveDuration,10)+this.timeOffset;i=(i+=this.pos.time)<0?0:i>1e3*n?1e3*n-200:i,t.getPlugin("time")&&t.getPlugin("time").updateTime(i/1e3),t.getPlugin("progress")&&t.getPlugin("progress").updatePercent(i/1e3/this.duration,!0),this.activeSeekNote(i/1e3,e>0),r.isTouchingSeek&&t.seek(Number((i-this.timeOffset)/1e3).toFixed(1)),this.pos.time=i}},{key:"updateVolume",value:function(e){this.player.rotateDeg&&(e=-e);var t=this.player,r=this.pos;if(e=parseInt(100*e,10),r.volume+=e,!(Math.abs(r.volume)<10)){var n=parseInt(10*t.volume,10)-parseInt(r.volume/10,10);n=n>10?10:n<1?0:n,t.volume=n/10,r.volume=0}}},{key:"updateBrightness",value:function(e){this.player.rotateDeg&&(e=-e);var t=this.pos,r=this.config,n=this.xgMask,i=t.light+.8*e;i=i>r.maxDarkness?r.maxDarkness:i<0?0:i,n&&(n.style.backgroundColor="rgba(0,0,0,".concat(i,")")),t.light=i}},{key:"activeSeekNote",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.player,n=this.config,i=!(this.duration!==1/0&&this.duration>0);if(e&&"number"==typeof e&&!i&&!n.disableActive){e<0?e=0:e>r.duration&&(e=r.duration-.2),this.changeAction(ACTIONS.SEEKING);var a=r.plugins.start;a&&a.focusHide(),this.find(".xg-dur").innerHTML=util$2.format(this.duration),this.find(".xg-cur").innerHTML=util$2.format(e),this.find(".xg-curbar").style.width="".concat(e/this.duration*100,"%"),t?util$2.removeClass(this.find(".xg-seek-show"),"xg-back"):util$2.addClass(this.find(".xg-seek-show"),"xg-back"),this.updateThumbnails(e)}}},{key:"updateThumbnails",value:function(e){var t=this.player.plugins.thumbnail;t&&t.usable&&this.thumbnail&&t.update(this.thumbnail,e,160,90)}},{key:"switchPlayPause",value:function(){var e=this.player;if(e.state<STATES$3.ATTACHED)return!1;e.ended||(e.paused?e.play():e.pause())}},{key:"disableGesture",value:function(){this.config.disableGesture=!1}},{key:"enableGesture",value:function(){this.config.disableGesture=!0}},{key:"destroy",value:function(){var e=this.player;this.timer&&clearTimeout(this.timer),this.thumbnail=null,e.root.removeChild(this.xgMask),this.xgMask=null,this.touch&&this.touch.destroy(),this.touch=null,e.root.removeEventListener("touchmove",this.onRootTouchMove,!0),e.root.removeEventListener("touchend",this.onRootTouchEnd,!0)}},{key:"render",value:function(){var e="normal"!==this.config.gradient?"gradient ".concat(this.config.gradient):"gradient";return'\n     <xg-trigger class="trigger">\n     <div class="'.concat(e,'"></div>\n        <div class="time-preview">\n            <div class="xg-seek-show ').concat(this.config.disableSeekIcon?" hide-seek-icon":"",'">\n              <i class="xg-seek-icon"></i>\n              <span class="xg-cur">00:00</span>\n              <span>/</span>\n              <span class="xg-dur">00:00</span>\n            </div>\n              <div class="xg-bar xg-timebar">\n                <div class="xg-curbar"></div>\n              </div>\n        </div>\n        <div class="xg-playbackrate xg-top-note">\n            <span><i>').concat(this.config.pressRate,"X</i>").concat(this.i18n.FORWARD,"</span>\n        </div>\n     </xg-trigger>\n    ")}}],[{key:"pluginName",get:function(){return"mobile"}},{key:"defaultConfig",get:function(){return{index:0,disableGesture:!1,gestureX:!0,gestureY:!0,gradient:"normal",isTouchingSeek:!1,miniMoveStep:5,miniYPer:5,scopeL:.25,scopeR:.25,scopeM:.9,pressRate:2,darkness:!0,maxDarkness:.8,disableActive:!1,disableTimeProgress:!1,hideControlsActive:!1,hideControlsEnd:!1,moveDuration:36e4,closedbClick:!1,disablePress:!0,disableSeekIcon:!1,focusVideoClick:!1}}}]),r}(Plugin);function preventDefault(e){e.preventDefault(),e.returnValue=!1}function isDisableTag(e){var t=e.tagName;return!("INPUT"!==t&&"TEXTAREA"!==t&&!e.isContentEditable)}var Keyboard=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){var e;_classCallCheck$7(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$8(_assertThisInitialized$7(e=t.call.apply(t,[this].concat(i))),"onBodyKeyDown",(function(t){var r=t||window.event;if(e.player&&(e.player.isUserActive||e.config.isIgnoreUserActive)&&!(e.config.disable||e.config.disableBodyTrigger||!e.checkIsVisible()||r.metaKey||r.altKey||r.ctrlKey)){var n=r.keyCode;return!(r.target!==document.body&&(!e.config.isGlobalTrigger||isDisableTag(r.target))||!e.checkCode(n,!0))&&(preventDefault(r),e.handleKeyCode(n,t),!1)}})),_defineProperty$8(_assertThisInitialized$7(e),"onKeydown",(function(t){var r=t||window.event;if(!(e.config.disable||e.config.disableRootTrigger||r.metaKey||r.altKey||r.ctrlKey)&&(e.player.isUserActive||e.config.isIgnoreUserActive)&&(e.player.isUserActive||e.config.isIgnoreUserActive)){if(!r||37!==r.keyCode&&!e.checkCode(r.keyCode)||r.target!==e.player.root&&r.target!==e.player.video&&r.target!==e.player.controls.el)return!0;preventDefault(r),e.handleKeyCode(r.keyCode,t)}})),e}return _createClass$8(r,[{key:"mergekeyCodeMap",value:function(){var e=this,t=this.config.keyCodeMap;t&&Object.keys(t).map((function(r){e.keyCodeMap[r]?["keyCode","action","disable","isBodyTarget"].map((function(n){t[r][n]&&(e.keyCodeMap[r][n]=t[r][n])})):e.keyCodeMap[r]=t[r]}))}},{key:"afterCreate",value:function(){this.config.disable=!this.playerConfig.keyShortcut;var e="function"==typeof this.config.seekStep?this.config.seekStep(this.player):this.config.seekStep;e&&"number"==typeof e&&(this.seekStep=e),this.keyCodeMap={space:{keyCode:32,action:"playPause",disable:!1,noBodyTarget:!1},up:{keyCode:38,action:"upVolume",disable:!1,noBodyTarget:!0},down:{keyCode:40,action:"downVolume",disable:!1,noBodyTarget:!0},left:{keyCode:37,action:"seekBack",disable:!1},right:{keyCode:39,action:"seek",disable:!1},esc:{keyCode:27,action:"exitFullscreen",disable:!1}},this.mergekeyCodeMap(),this.player.root.addEventListener("keydown",this.onKeydown),document.addEventListener("keydown",this.onBodyKeyDown)}},{key:"checkIsVisible",value:function(){if(!this.config.checkVisible)return!0;var e=this.player.root.getBoundingClientRect(),t=e.height,r=e.top,n=e.bottom,i=window.innerHeight;return!(r<0&&r<0-.9*t||n>0&&n-i>.9*t)}},{key:"checkCode",value:function(e,t){var r=this,n=!1;return Object.keys(this.keyCodeMap).map((function(i){r.keyCodeMap[i]&&e===r.keyCodeMap[i].keyCode&&!r.keyCodeMap[i].disable&&(n=!t||t&&!r.keyCodeMap[i].noBodyTarget)})),n}},{key:"downVolume",value:function(e){var t=this.player,r=parseFloat((t.volume-.1).toFixed(1)),n={volume:{from:t.volume,to:r}};this.emitUserAction(e,"change_volume",{props:n}),t.volume=r>=0?r:0}},{key:"upVolume",value:function(e){var t=this.player,r=parseFloat((t.volume+.1).toFixed(1)),n={volume:{from:t.volume,to:r}};this.emitUserAction(e,"change_volume",{props:n}),t.volume=r<=1?r:1}},{key:"seek",value:function(e){var t=this.player,r=t.currentTime,n=t.duration,i=r,a={currentTime:{from:r,to:i=r+this.seekStep<=n?r+this.seekStep:n-1}};this.emitUserAction(e,"seek",{props:a}),this.player.currentTime=i}},{key:"seekBack",value:function(e){var t=this.player.currentTime,r=0;t-this.seekStep>=0&&(r=t-this.seekStep);var n={currentTime:{from:t,to:r}};this.emitUserAction(e,"seek",{props:n}),this.player.currentTime=r}},{key:"playPause",value:function(e){var t=this.player;t&&(this.emitUserAction(e,"switch_play_pause"),t.paused?t.play():t.pause())}},{key:"exitFullscreen",value:function(e){var t=this.player,r=t.fullscreen,n=t.cssfullscreen;r&&(this.emitUserAction("keyup","switch_fullscreen",{prop:"fullscreen",from:r,to:!r}),t.exitFullscreen()),n&&(this.emitUserAction("keyup","switch_css_fullscreen",{prop:"cssfullscreen",from:n,to:!n}),t.exitCssFullscreen())}},{key:"handleKeyCode",value:function(e,t){var r=this;Object.keys(this.keyCodeMap).map((function(n){var i=r.keyCodeMap[n],a=i.action,o=i.keyCode,s=i.disable;o!==e||s||("function"==typeof a?a(t,r.player):"string"==typeof a&&"function"==typeof r[a]&&r[a](t,r.player),r.emit(SHORTCUT,_objectSpread2$6({key:n,target:t.target},r.keyCodeMap[n])))}))}},{key:"destroy",value:function(){this.player.root.removeEventListener("keydown",this.onKeydown),document.removeEventListener("keydown",this.onBodyKeyDown)}},{key:"disable",value:function(){this.config.disable=!0}},{key:"enable",value:function(){this.config.disable=!1}}],[{key:"pluginName",get:function(){return"keyboard"}},{key:"defaultConfig",get:function(){return{seekStep:10,checkVisible:!0,disableBodyTrigger:!1,disableRootTrigger:!1,isGlobalTrigger:!1,keyCodeMap:{},disable:!1,isIgnoreUserActive:!1}}}]),r}(BasePlugin);function loadingIcon(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="-5 -5 110 110">\n  <path d="M100,50A50,50,0,1,1,50,0" stroke-width="5" stroke="#ddd" stroke-dasharray="236" fill="none"></path>\n</svg>\n',"image/svg+xml").firstChild}var Loading=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){return _classCallCheck$7(this,r),t.apply(this,arguments)}return _createClass$8(r,[{key:"registerIcons",value:function(){return{loadingIcon:loadingIcon}}},{key:"afterCreate",value:function(){this.appendChild("xg-loading-inner",this.icons.loadingIcon)}},{key:"render",value:function(){return'\n    <xg-loading class="xgplayer-loading">\n      <xg-loading-inner></xg-loading-inner>\n    </xg-loading>'}}],[{key:"pluginName",get:function(){return"loading"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.ROOT}}}]),r}(Plugin),$$$=_export,$findIndex$1=arrayIteration.findIndex,addToUnscopables$3=addToUnscopables$6,FIND_INDEX="findIndex",SKIPS_HOLES=!0;FIND_INDEX in[]&&Array(1)[FIND_INDEX]((function(){SKIPS_HOLES=!1})),$$$({target:"Array",proto:!0,forced:SKIPS_HOLES},{findIndex:function(e){return $findIndex$1(this,e,arguments.length>1?arguments[1]:void 0)}}),addToUnscopables$3(FIND_INDEX);var TPL=[{tag:"xg-cache",className:"xgplayer-progress-cache",styleKey:"cachedColor"},{tag:"xg-played",className:"xgplayer-progress-played",styleKey:"playedColor"}],InnerList=function(){function e(t){_classCallCheck$7(this,e),this.fragments=t.fragments||[],this.focusClass="inner-focus",this.style=t.style||{playedColor:"",cachedColor:"",progressColor:""},this.duration=0,this.cachedIndex=0,this.playedIndex=0}return _createClass$8(e,[{key:"updateDuration",value:function(e){var t=this;this.duration=parseInt(1e3*e);var r=0,n=this.fragments;this.fragments=n.map((function(e){return e.start=r,e.end=r+e.percent*t.duration,e.duration=e.percent*t.duration,r+=e.percent*t.duration,e}))}},{key:"updateProgress",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"played",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{newIndex:0,curIndex:0,millisecond:0},r=this.progressList,n=this.fragments,i=t.newIndex,a=t.curIndex,o=t.millisecond;i!==a&&r.map((function(t,r){r<i?t[e].style.width="100%":r>i&&(t[e].style.width=0)}));var s=n[i],u=0===o?0:(o-s.start)/s.duration;r[i][e].style.width=u<0?0:"".concat(100*u,"%")}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cached:0,played:0},t=arguments.length>1?arguments[1]:void 0;if(!this.duration||parseInt(1e3*t,10)!==this.duration){if(!t&&0!==t)return;this.updateDuration(t)}var r=this.playedIndex,n=this.cachedIndex;if("Undefined"!==util$2.typeOf(e.played)){var i=this.findIndex(1e3*e.played,r);this.updateProgress("played",{newIndex:i,curIndex:r,millisecond:parseInt(1e3*e.played,10)}),this.playedIndex=i}if("Undefined"!==util$2.typeOf(e.cached)){var a=this.findIndex(1e3*e.cached,n);this.updateProgress("cached",{newIndex:a,curIndex:n,millisecond:parseInt(1e3*e.cached,10)}),this.cachedIndex=a}}},{key:"findIndex",value:function(e,t){var r=this.fragments;return 1===r.length?0:(e>r[t].start&&e<r[t].end||this.fragments.map((function(r,n){e>r.start&&e<=r.end&&(t=n)})),t)}},{key:"findHightLight",value:function(){for(var e=this.root.children,t=0;t<e.length;t++)if(util$2.hasClass(e[t],this.focusClass))return{dom:e[t],pos:e[t].getBoundingClientRect()}}},{key:"findFragment",value:function(e){var t=this.root.children;return e<0||e>=t.length?null:{dom:t[e],pos:t[e].getBoundingClientRect()}}},{key:"unHightLight",value:function(){for(var e=this.root.children,t=0;t<e.length;t++)util$2.removeClass(e[t],this.focusClass)}},{key:"setHightLight",value:function(e){var t=this.root.children;if(e<t.length)return util$2.addClass(t[e],this.focusClass),{dom:t[e],pos:t[e].getBoundingClientRect()}}},{key:"destroy",value:function(){this.progressList=null,this.fragments=null,this.root.innerHTML=""}},{key:"render",value:function(){var e=this,t=this.style.progressColor;return this.root=util$2.createDom("xg-inners","",{},"progress-list"),this.fragments&&(this.progressList=this.fragments.map((function(r){var n=util$2.createDom("xg-inner","",{style:t?"background:".concat(t,"; flex: ").concat(r.percent):"flex: ".concat(r.percent)},"".concat(r.isFocus?"inner-focus":""," xgplayer-progress-inner"));return e.root.appendChild(n),TPL.map((function(t){n.appendChild(util$2.createDom(t.tag,"",{style:t.styleKey?"background: ".concat(e.style[t.styleKey],"; width:0;"):"width:0;"},t.className))})),{cached:n.children[0],played:n.children[1]}}))),this.root}}]),e}(),Progress=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(e){var n;return _classCallCheck$7(this,r),_defineProperty$8(_assertThisInitialized$7(n=t.call(this,e)),"onMoveOnly",(function(e){var t=_assertThisInitialized$7(n),r=t.pos,i=t.config,a=t.player;util$2.event(e);var o=util$2.getEventPos(e,a.zoom),s=90===a.rotateDeg?o.clientY:o.clientX;if(!(r.moving&&Math.abs(r.x-s)<i.miniMoveStep)){r.moving=!0,r.x=s;var u=n.computeTime(e);n.triggerCallbacks("dragmove",u,e)}})),_defineProperty$8(_assertThisInitialized$7(n),"onBodyClick",(function(e){e.preventDefault(),e.stopPropagation()})),_defineProperty$8(_assertThisInitialized$7(n),"_mouseDownHandler",(function(e,t){n._state.time=t.currentTime,n.updateWidth(t.currentTime,t.percent,0)})),_defineProperty$8(_assertThisInitialized$7(n),"_mouseUpHandler",(function(e,t){_assertThisInitialized$7(n).pos.moving&&n.updateWidth(t.currentTime,t.percent,2)})),_defineProperty$8(_assertThisInitialized$7(n),"_mouseMoveHandler",(function(e,t){var r=_assertThisInitialized$7(n),i=r._state,a=r.pos,o=r.config,s=r.player;i.time<t.currentTime?t.forward=!0:t.forward=!1,i.time=t.currentTime,a.isDown&&!a.moving&&(a.moving=!0,o.isPauseMoving&&s.pause(),n.triggerCallbacks("dragstart",t,e)),n.updateWidth(t.currentTime,t.percent,1),n.triggerCallbacks("dragmove",t,e)})),_defineProperty$8(_assertThisInitialized$7(n),"onMouseDown",(function(e){var t=_assertThisInitialized$7(n),r=t.player,i=t.pos,a=t.config,o=t.playerConfig,s=util$2.getEventPos(e,r.zoom),u=90===r.rotateDeg?s.clientY:s.clientX;if(!(r.isMini||a.closeMoveSeek||!o.allowSeekAfterEnded&&r.ended)){e.stopPropagation(),n.focus(),util$2.checkIsFunction(o.disableSwipeHandler)&&o.disableSwipeHandler(),util$2.checkIsFunction(a.onMoveStart)&&a.onMoveStart(),util$2.event(e),i.x=u,i.isDown=!0,i.moving=!1,r.focus({autoHide:!1}),n.isProgressMoving=!0,util$2.addClass(n.progressBtn,"active");var c=n.computeTime(e);return n._mouseDownHandlerHook(e,c),"touch"===n.domEventType?(n.root.addEventListener("touchmove",n.onMouseMove),n.root.addEventListener("touchend",n.onMouseUp)):(n.unbind("mousemove",n.onMoveOnly),document.addEventListener("mousemove",n.onMouseMove,!1),document.addEventListener("mouseup",n.onMouseUp,!1),r.root.addEventListener("click",n.onBodyClick,!1)),!0}})),_defineProperty$8(_assertThisInitialized$7(n),"onMouseUp",(function(e){var t=_assertThisInitialized$7(n),r=t.player,i=t.config,a=t.pos,o=t.playerConfig,s=t._state;e.stopPropagation(),e.preventDefault(),util$2.checkIsFunction(o.enableSwipeHandler)&&o.enableSwipeHandler(),util$2.checkIsFunction(i.onMoveEnd)&&i.onMoveEnd(),util$2.event(e),util$2.removeClass(n.progressBtn,"active");var u=n.computeTime(e);a.moving?n.triggerCallbacks("dragend",u,e):n.triggerCallbacks("click",u,e),n._mouseUpHandlerHook(e,u),a.moving=!1,a.isDown=!1,a.x=0,a.y=0,s.time=0,"touch"===n.domEventType?(n.root.removeEventListener("touchmove",n.onMouseMove),n.root.removeEventListener("touchend",n.onMouseUp),n.blur()):(document.removeEventListener("mousemove",n.onMouseMove,!1),document.removeEventListener("mouseup",n.onMouseUp,!1),r.root.removeEventListener("click",n.onBodyClick,!1),a.isEnter?!o.isMobileSimulateMode&&n.bind("mousemove",n.onMoveOnly):n.onMouseLeave(e)),util$2.setTimeout(_assertThisInitialized$7(n),(function(){n.resetSeekState()}),10),r.focus()})),_defineProperty$8(_assertThisInitialized$7(n),"onMouseMove",(function(e){var t=_assertThisInitialized$7(n),r=t.pos,i=t.player,a=t.config;util$2.checkTouchSupport()&&e.preventDefault(),util$2.event(e);var o=util$2.getEventPos(e,i.zoom),s=90===i.rotateDeg?o.clientY:o.clientX,u=Math.abs(r.x-s);if(!(r.moving&&u<a.miniMoveStep||!r.moving&&u<a.miniStartStep)){r.x=s;var c=n.computeTime(e);n._mouseMoveHandlerHook(e,c)}})),_defineProperty$8(_assertThisInitialized$7(n),"onMouseOut",(function(e){n.triggerCallbacks("mouseout",null,e)})),_defineProperty$8(_assertThisInitialized$7(n),"onMouseOver",(function(e){n.triggerCallbacks("mouseover",null,e)})),_defineProperty$8(_assertThisInitialized$7(n),"onMouseEnter",(function(e){var t=_assertThisInitialized$7(n),r=t.player,i=t.pos;n.triggerCallbacks("mouseenter",null,e),i.isDown||i.isEnter||r.isMini||!r.config.allowSeekAfterEnded&&r.ended||(i.isEnter=!0,n.bind("mousemove",n.onMoveOnly),n.bind("mouseleave",n.onMouseLeave),n.focus())})),_defineProperty$8(_assertThisInitialized$7(n),"onMouseLeave",(function(e){n.triggerCallbacks("mouseleave",null,e);var t=_assertThisInitialized$7(n),r=t.player,i=t.pos;i.isEnter=!1,r.isMini||(n.unbind("mousemove",n.onMoveOnly),i.isDown?n.unbind("mouseleave",n.onMouseLeave):n.blur())})),n.useable=!1,n.isProgressMoving=!1,n.__dragCallBacks=[],n._state={now:-1,direc:0,time:0},n._disableBlur=!1,n}return _createClass$8(r,[{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"changeState",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.useable=e}},{key:"createInner",value:function(){var e=this;this.innerList=new InnerList({fragments:this.config.fragments,style:this.playerConfig.commonStyle||{}}),this.outer.insertBefore(this.innerList.render(),this.outer.children[0]),["findHightLight","unHightLight","setHightLight","findFragment"].map((function(t){e[t]=e.innerList[t].bind(e.innerList)}))}},{key:"afterCreate",value:function(){var e=this;this.config.disable||this.playerConfig.isLive||(this.pos={x:0,y:0,moving:!1,isDown:!1,isEnter:!1},this.outer=this.find("xg-outer"),this.createInner(),"mobile"===sniffer$1.device&&(this.config.isDragingSeek=!1,this.isMobile=!0),this.progressBtn=this.find(".xgplayer-progress-btn"),this.on(TIME_UPDATE,(function(){e.onTimeupdate()})),this.on(SEEKED,(function(){e.onTimeupdate(),e.onCacheUpdate()})),this.on(PROGRESS,(function(){e.onCacheUpdate()})),this.on(ENDED,(function(){e.onCacheUpdate(),e._state.now=0})),this.on(EMPTIED,(function(){e.onReset()})),this.bindDomEvents(),this.initCustomStyle())}},{key:"initCustomStyle",value:function(){var e=(this.playerConfig||{}).commonStyle.sliderBtnStyle,t=this.progressBtn;e&&("string"==typeof e?t.style.boxShadow=e:"object"===_typeof$6(e)&&Object.keys(e).map((function(r){t.style[r]=e[r]})))}},{key:"triggerCallbacks",value:function(e,t,r){this.__dragCallBacks.length>0&&this.__dragCallBacks.map((function(n){if(n&&n.handler&&n.type===e)try{n.handler(t,r)}catch(error){console.error("[XGPLAYER][triggerCallbacks] ".concat(n," error"),error)}}))}},{key:"addCallBack",value:function(e,t){t&&"function"==typeof t&&this.__dragCallBacks.push({type:e,handler:t})}},{key:"removeCallBack",value:function(e,t){var r=this.__dragCallBacks,n=-1;r.map((function(r,i){r&&r.type===e&&r.handler===t&&(n=i)})),n>-1&&r.splice(n,1)}},{key:"bindDomEvents",value:function(){var e=this.player,t=e.controls,r=e.config;this._mouseDownHandlerHook=this.hook("dragstart",this._mouseDownHandler),this._mouseUpHandlerHook=this.hook("dragend",this._mouseUpHandler),this._mouseMoveHandlerHook=this.hook("drag",this._mouseMoveHandler),"touch"===this.domEventType?(this.root.addEventListener("touchstart",this.onMouseDown),t&&(t.root&&t.root.addEventListener("touchmove",util$2.stopPropagation),t.center&&t.center.addEventListener("touchend",util$2.stopPropagation))):(this.bind("mousedown",this.onMouseDown),!r.isMobileSimulateMode&&this.bind("mouseenter",this.onMouseEnter),this.bind("mouseover",this.onMouseOver),this.bind("mouseout",this.onMouseOut))}},{key:"focus",value:function(){util$2.addClass(this.root,"active")}},{key:"blur",value:function(){this._disableBlur||(this.player.controls.recoverAutoHide(),util$2.removeClass(this.root,"active"))}},{key:"disableBlur",value:function(){this._disableBlur=!0}},{key:"enableBlur",value:function(){this._disableBlur=!1}},{key:"updateWidth",value:function(e,t,r){var n=this.config,i=this.player;if(!n.isCloseClickSeek||0!==r){var a=e>i.duration?i.duration-.2:Number(e).toFixed(1);this.updatePercent(t),this.updateTime(e),(1!==r||n.isDragingSeek&&"audio"!==i.videoConfig.mediaType)&&(this._state.now=a,this._state.direc=a>i.currentTime?0:1,i.seek(a))}}},{key:"computeTime",value:function(e){var t,r,n,i=this.player,a=this.root.getBoundingClientRect(),o=a.width,s=a.height,u=a.top,c=a.left,l=util$2.getEventPos(e,i.zoom);90===i.rotateDeg?(t=s,r=u,n=l.clientY):(t=o,r=c,n=l.clientX);var d=n-r,h=(d=d>t?t:d<0?0:d)/t;return{percent:h=h<0?0:h>1?1:h,currentTime:parseInt(h*this.duration*1e3,10)/1e3,offset:d,width:t,left:r,e:e}}},{key:"updateTime",value:function(e){var t=this.player,r=this.duration;e>r?e=r:e<0&&(e=0);var n=t.plugins.time;n&&n.updateTime(e)}},{key:"resetSeekState",value:function(){this.isProgressMoving=!1;var e=this.player.plugins.time;e&&e.resetActive()}},{key:"updatePercent",value:function(e,t){if(this.isProgressMoving=!0,!this.config.disable){e=e>1?1:e<0?0:e,this.progressBtn.style.left="".concat(100*e,"%"),this.innerList.update({played:e*this.duration},this.duration);var r=this.player.plugins.miniprogress;r&&r.update({played:e*this.duration},this.duration)}}},{key:"onTimeupdate",value:function(){var e=this.player,t=this._state,r=this.duration;if(!(e.isSeeking||this.isProgressMoving||e.state<STATES$3.RUNNING)){if(t.now>-1){var n=parseInt(1e3*t.now,10)-parseInt(1e3*e.currentTime,10);if(0===t.direc&&n>300||1===t.direc&&n>-300)return void(t.now=-1);t.now=-1}var i=this.timeOffset+e.currentTime;this.innerList.update({played:i},r),this.progressBtn.style.left="".concat(i/r*100,"%");var a=this.player.plugins.miniprogress;a&&a.update({played:i},r)}}},{key:"onCacheUpdate",value:function(){var e=this.player,t=this.duration,r=e.bufferedPoint;this.innerList.update({cached:r.end},t);var n=this.player.plugins.miniprogress;n&&n.update({cached:r.end},t)}},{key:"onReset",value:function(){this.innerList.update({played:0,cached:0},0);var e=this.player.plugins.miniprogress;e&&e.update({cached:0,played:0},0)}},{key:"destroy",value:function(){var e=this.player,t=e.controls;this.thumbnailPlugin=null,this.innerList.destroy(),this.innerList=null,"touch"===this.domEventType?(this.root.removeEventListener("touchstart",this.onMouseDown),this.root.removeEventListener("touchmove",this.onMouseMove),this.root.removeEventListener("touchend",this.onMouseUp),t&&(t.root&&t.root.removeEventListener("touchmove",util$2.stopPropagation),t.center&&t.center.removeEventListener("touchend",util$2.stopPropagation))):(this.unbind("mousedown",this.onMouseDown),this.unbind("mouseenter",this.onMouseEnter),this.unbind("mousemove",this.onMoveOnly),this.unbind("mouseleave",this.onMouseLeave),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),e.root.removeEventListener("click",this.onBodyClick,!1))}},{key:"render",value:function(){if(!this.config.disable&&!this.playerConfig.isLive){var e=this.player.controls?this.player.controls.config.mode:"";return'\n    <xg-progress class="xgplayer-progress '.concat("bottom"===e?"xgplayer-progress-bottom":"",'">\n      <xg-outer class="xgplayer-progress-outer">\n        <xg-progress-btn class="xgplayer-progress-btn"></xg-progress-btn>\n      </xg-outer>\n    </xg-progress>\n    ')}}}],[{key:"pluginName",get:function(){return"progress"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_CENTER,index:0,disable:!1,isDragingSeek:!0,closeMoveSeek:!1,isPauseMoving:!1,isCloseClickSeek:!1,fragments:[{percent:1}],miniMoveStep:5,miniStartStep:2,onMoveStart:function(){},onMoveEnd:function(){}}}}]),r}(Plugin),Play=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){return _classCallCheck$7(this,r),t.apply(this,arguments)}return _createClass$8(r,[{key:"afterCreate",value:function(){var e=this,t=this.player;this.config.disable||(this.initIcons(),this.btnClick=this.btnClick.bind(this),this.bind(["touchend","click"],this.btnClick),this.on(PAUSE,(function(){e.animate(t.paused)})),this.on(PLAY,(function(){e.animate(t.paused)})),this.animate(!0))}},{key:"registerIcons",value:function(){return{play:{icon:PlaySvg,class:"xg-icon-play"},pause:{icon:PauseSvg,class:"xg-icon-pause"}}}},{key:"btnClick",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.player;return this.emitUserAction(e,"switch_play_pause",{prop:"paused",from:t.paused,to:!t.paused}),t.ended?t.replay():t.paused?(t.play(),this.animate(!1)):(t.pause(),this.animate(!0)),!1}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.play),this.appendChild(".xgplayer-icon",e.pause)}},{key:"animate",value:function(e){var t=this.i18nKeys;e?(this.setAttr("data-state","pause"),this.changeLangTextKey(this.find(".xg-tips"),t.PLAY_TIPS)):(this.setAttr("data-state","play"),this.changeLangTextKey(this.find(".xg-tips"),t.PAUSE_TIPS))}},{key:"destroy",value:function(){this.unbind(["touchend","click"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class="xgplayer-play">\n    <div class="xgplayer-icon">\n    </div>\n    <div class="xg-tips" lang-key="'.concat(this.i18nKeys.PLAY_TIPS,'">').concat(this.i18n.PLAY_TIPS,"</div>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"play"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_LEFT,index:0,disable:!1}}}]),r}(Plugin);function BackSVG(){return(new DOMParser).parseFromString('<svg width="32px" height="40px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <path d="M11.2374369,14 L17.6187184,7.61871843 C17.9604272,7.27700968 17.9604272,6.72299032 17.6187184,6.38128157 C17.2770097,6.03957281 16.7229903,6.03957281 16.3812816,6.38128157 L9.38128157,13.3812816 C9.03957281,13.7229903 9.03957281,14.2770097 9.38128157,14.6187184 L16.3812816,21.6187184 C16.7229903,21.9604272 17.2770097,21.9604272 17.6187184,21.6187184 C17.9604272,21.2770097 17.9604272,20.7229903 17.6187184,20.3812816 L11.2374369,14 L11.2374369,14 Z" fill="#FFFFFF"></path>\n    </g>\n</svg>',"image/svg+xml").firstChild}var TopBackIcon=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){return _classCallCheck$7(this,r),t.apply(this,arguments)}return _createClass$8(r,[{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.onClick=function(t){t.preventDefault(),t.stopPropagation(),e.config.onClick(t)},this.bind(["click","touchend"],this.onClick)}},{key:"registerIcons",value:function(){return{screenBack:{icon:BackSVG,class:"xg-fullscreen-back"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(this.root,e.screenBack)}},{key:"show",value:function(){util$2.addClass(this.root,"show")}},{key:"hide",value:function(){util$2.removeClass(this.root,"show")}},{key:"render",value:function(){return'<xg-icon class="xgplayer-back">\n    </xg-icon>'}}],[{key:"pluginName",get:function(){return"topbackicon"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.ROOT_TOP,index:0}}}]),r}(Plugin);function FullScreenSvg(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598 214h212v212h-84v-128h-128v-84zM726 726v-128h84v212h-212v-84h128zM214 426v-212h212v84h-128v128h-84zM298 598v128h128v84h-212v-212h84z"></path>\n</svg>\n',"image/svg+xml").firstChild}function ExitFullScreenSvg(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M682 342h128v84h-212v-212h84v128zM598 810v-212h212v84h-128v128h-84zM342 342v-128h84v212h-212v-84h128zM214 682v-84h212v212h-84v-128h-128z"></path>\n</svg>\n',"image/svg+xml").firstChild}var Fullscreen=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){var e;_classCallCheck$7(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$8(_assertThisInitialized$7(e=t.call.apply(t,[this].concat(i))),"_onOrientationChange",(function(t){e.player.fullscreen&&e.config.rotateFullscreen&&(90===window.orientation||-90===window.orientation?e.player.setRotateDeg(0):e.player.setRotateDeg(90))})),e}return _createClass$8(r,[{key:"afterCreate",value:function(){var e=this,t=this.config,r=this.playerConfig;if(!t.disable){t.target&&(this.playerConfig.fullscreenTarget=this.config.target);var n=util$2.getFullScreenEl();r.fullscreenTarget===n&&this.player.getFullscreen(),this.initIcons(),this.handleFullscreen=this.hook("fullscreenChange",this.toggleFullScreen,{pre:function(t){var r=e.player.fullscreen;e.emitUserAction(t,"switch_fullscreen",{prop:"fullscreen",from:r,to:!r})}}),this.bind(".xgplayer-fullscreen",["touchend","click"],this.handleFullscreen),this.on(FULLSCREEN_CHANGE,(function(t){e.changeLangTextKey(e.find(".xg-tips"),t?e.i18nKeys.EXITFULLSCREEN_TIPS:e.i18nKeys.FULLSCREEN_TIPS),e.animate(t)})),this.config.needBackIcon&&(this.topBackIcon=this.player.registerPlugin({plugin:TopBackIcon,options:{config:{onClick:function(t){e.handleFullscreen(t)}}}})),"mobile"===sniffer$1.device&&window.addEventListener("orientationchange",this._onOrientationChange)}}},{key:"registerIcons",value:function(){return{fullscreen:{icon:FullScreenSvg,class:"xg-get-fullscreen"},exitFullscreen:{icon:ExitFullScreenSvg,class:"xg-exit-fullscreen"}}}},{key:"destroy",value:function(){this.unbind(".xgplayer-icon","mobile"===sniffer$1.device?"touchend":"click",this.handleFullscreen),"mobile"===sniffer$1.device&&window.removeEventListener("orientationchange",this._onOrientationChange)}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.fullscreen),this.appendChild(".xgplayer-icon",e.exitFullscreen)}},{key:"toggleFullScreen",value:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=this.player,r=this.config;!0===r.useCssFullscreen||"function"==typeof r.useCssFullscreen&&r.useCssFullscreen()?(t.fullscreen?t.exitCssFullscreen():t.getCssFullscreen(),this.animate(t.fullscreen)):r.rotateFullscreen?(t.fullscreen?t.exitRotateFullscreen():t.getRotateFullscreen(),this.animate(t.fullscreen)):r.switchCallback&&"function"==typeof r.switchCallback?r.switchCallback(t.fullscreen):t.fullscreen?t.exitFullscreen():t.getFullscreen()}},{key:"animate",value:function(e){e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.topBackIcon&&(e?(this.topBackIcon.show(),this.hide()):(this.topBackIcon.hide(),this.show()))}},{key:"show",value:function(){_get$1(_getPrototypeOf$7(r.prototype),"show",this).call(this)}},{key:"hide",value:function(){_get$1(_getPrototypeOf$7(r.prototype),"hide",this).call(this)}},{key:"render",value:function(){if(!this.config.disable){var e="FULLSCREEN_TIPS";return'<xg-icon class="xgplayer-fullscreen">\n    <div class="xgplayer-icon">\n    </div>\n    <div class="xg-tips" lang-key="'.concat(this.i18nKeys[e],'">').concat(this.i18n[e],"</div>\n    </xg-icon>")}}}],[{key:"pluginName",get:function(){return"fullscreen"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:0,useCssFullscreen:!1,rotateFullscreen:!1,switchCallback:null,target:null,disable:!1,needBackIcon:!1}}}]),r}(Plugin),Time=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(e){var n;return _classCallCheck$7(this,r),(n=t.call(this,e)).isActiving=!1,n}return _createClass$8(r,[{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"currentTime",get:function(){return this.player.currentTime||0}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"afterCreate",value:function(){var e=this,t=this.player.controls.config.mode;this.mode="flex"===t?"flex":"normal",this.config.disable||("flex"===this.mode&&(this.createCenterTime(),this.hide()),this.durationDom=this.find(".time-duration"),this.timeDom=this.find(".time-current"),this.on(DURATION_CHANGE,(function(){e.onTimeUpdate()})),this.on(TIME_UPDATE,(function(){e.onTimeUpdate()})),this.on(EMPTIED,(function(){e.onReset()})))}},{key:"show",value:function(){"flex"!==this.mode&&_get$1(_getPrototypeOf$7(r.prototype),"show",this).call(this)}},{key:"onTimeUpdate",value:function(){var e=this.player;if(!(this.config.disable||this.isActiving||e.state<STATES$3.RUNNING&&e.state!==STATES$3.ATTACHED)){var t=this.currentTime+this.timeOffset;"flex"===this.mode?(this.centerCurDom.innerHTML=util$2.format(t),this.duration!==1/0&&this.duration>0&&(this.centerDurDom.innerHTML=util$2.format(this.duration))):(this.timeDom.innerHTML=util$2.format(t),this.duration!==1/0&&this.duration>0&&(this.durationDom.innerHTML=util$2.format(this.duration)))}}},{key:"onReset",value:function(){"flex"===this.mode?(this.centerCurDom.innerHTML=util$2.format(0),this.centerDurDom.innerHTML=util$2.format(0)):(this.timeDom.innerHTML=util$2.format(0),this.durationDom.innerHTML=util$2.format(0))}},{key:"createCenterTime",value:function(){var e=this.player;if(e.controls&&e.controls.center){var t=e.controls.center;this.centerCurDom=util$2.createDom("xg-icon","00:00",{},"xgplayer-time left"),this.centerDurDom=util$2.createDom("xg-icon","00:00",{},"xgplayer-time right"),t.children.length>0?t.insertBefore(this.centerCurDom,t.children[0]):t.appendChild(this.centerCurDom),t.appendChild(this.centerDurDom)}}},{key:"afterPlayerInit",value:function(){var e=this.config;this.duration===1/0||this.playerConfig.isLive?(util$2.hide(this.durationDom),util$2.hide(this.timeDom),util$2.hide(this.find(".time-separator")),util$2.show(this.find(".time-live-tag"))):util$2.hide(this.find(".time-live-tag")),e.hide?this.hide():this.show()}},{key:"changeLiveState",value:function(e){e?(util$2.hide(this.durationDom),util$2.hide(this.timeDom),util$2.hide(this.find(".time-separator")),util$2.show(this.find(".time-live-tag"))):(util$2.hide(this.find(".time-live-tag")),util$2.show(this.find(".time-separator")),util$2.show(this.durationDom),util$2.show(this.timeDom))}},{key:"updateTime",value:function(e){this.isActiving=!0,!e&&0!==e||e>this.duration||("flex"!==this.mode?this.timeDom.innerHTML=util$2.format(e):this.centerCurDom.innerHTML=util$2.format(e))}},{key:"resetActive",value:function(){var e=this,t=this.player,r=function(){e.isActiving=!1};this.off(SEEKED,r),t.isSeeking?this.once(SEEKED,r):this.isActiving=!1}},{key:"destroy",value:function(){var e=this.player.controls.center;this.centerCurDom&&e.removeChild(this.centerCurDom),this.centerCurDom=null,this.centerDurDom&&e.removeChild(this.centerDurDom),this.centerDurDom=null}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class="xgplayer-time">\n    <span class="time-current">00:00</span>\n    <span class="time-separator">/</span>\n    <span class="time-duration">00:00</span>\n    <span class="time-live-tag">'.concat(this.i18n.LIVE_TIP,"</span>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"time"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_LEFT,index:2,disable:!1}}}]),r}(Plugin);function volumeLargeSvg(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M940.632 837.632l-72.192-72.192c65.114-64.745 105.412-154.386 105.412-253.44s-40.299-188.695-105.396-253.424l-0.016-0.016 72.192-72.192c83.639 83.197 135.401 198.37 135.401 325.632s-51.762 242.434-135.381 325.612l-0.020 0.020zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>\n</svg>\n',"image/svg+xml").firstChild}function volumeSmallSvg(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>\n</svg>\n',"image/svg+xml").firstChild}function volumeMutedSvg(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M920.4 439.808l-108.544-109.056-72.704 72.704 109.568 108.544-109.056 108.544 72.704 72.704 108.032-109.568 108.544 109.056 72.704-72.704-109.568-108.032 109.056-108.544-72.704-72.704-108.032 109.568z"></path>\n</svg>\n',"image/svg+xml").firstChild}var Volume=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){var e;_classCallCheck$7(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$8(_assertThisInitialized$7(e=t.call.apply(t,[this].concat(i))),"onBarMousedown",(function(t){var r=_assertThisInitialized$7(e).player,n=e.find(".xgplayer-slider"),i=e.find(".xgplayer-bar");n.focus(),util$2.event(t);var a=i.getBoundingClientRect(),o=util$2.getEventPos(t,r.zoom),s=a.height-(o.clientY-a.top);if(o.h=s,o.barH=a.height,e.pos=o,!(s<-2))return e.updateVolumePos(s,t),document.addEventListener("mouseup",e.onBarMouseUp),e.isStart=!0,!1})),_defineProperty$8(_assertThisInitialized$7(e),"onBarMouseMove",(function(t){if(e.isStart){var r=_assertThisInitialized$7(e),n=r.pos,i=r.player;t.preventDefault(),t.stopPropagation(),util$2.event(t);var a=util$2.getEventPos(t,i.zoom);e.isMoving=!0;var o=n.h-a.clientY+n.clientY;o>n.barH||e.updateVolumePos(o,t)}})),_defineProperty$8(_assertThisInitialized$7(e),"onBarMouseUp",(function(t){util$2.event(t),document.removeEventListener("mouseup",e.onBarMouseUp),e.isStart=!1,e.isMoving=!1})),_defineProperty$8(_assertThisInitialized$7(e),"onMouseenter",(function(t){e._timerId&&(util$2.clearTimeout(_assertThisInitialized$7(e),e._timerId),e._timerId=null),util$2.addClass(e.root,"slide-show")})),_defineProperty$8(_assertThisInitialized$7(e),"onMouseleave",(function(t){e._timerId&&(util$2.clearTimeout(_assertThisInitialized$7(e),e._timerId),e._timerId=null),e._timerId=util$2.setTimeout(_assertThisInitialized$7(e),(function(){util$2.removeClass(e.root,"slide-show"),e.isStart&&e.onBarMouseUp(t),e._timerId=null}),200)})),_defineProperty$8(_assertThisInitialized$7(e),"onVolumeChange",(function(t){if(e.player){var r=e.player,n=r.muted,i=r.volume;e.isMoving||(e.find(".xgplayer-drag").style.height=n||0===i?"4px":"".concat(100*i,"%"),e.config.showValueLabel&&e.updateVolumeValue()),e.animate(n,i)}})),e}return _createClass$8(r,[{key:"registerIcons",value:function(){return{volumeSmall:{icon:volumeSmallSvg,class:"xg-volume-small"},volumeLarge:{icon:volumeLargeSvg,class:"xg-volume"},volumeMuted:{icon:volumeMutedSvg,class:"xg-volume-mute"}}}},{key:"afterCreate",value:function(){var e=this;if(this._timerId=null,!this.config.disable){this.initIcons();var t=this.playerConfig,r=t.commonStyle,n=t.volume;r.volumeColor&&(this.find(".xgplayer-drag").style.backgroundColor=r.volumeColor),this.changeMutedHandler=this.hook("mutedChange",(function(t){e.changeMuted(t)}),{pre:function(e){e.preventDefault(),e.stopPropagation()}}),"mobile"===sniffer$1.device||this.playerConfig.isMobileSimulateMode||(this.bind("mouseenter",this.onMouseenter),this.bind(["blur","mouseleave"],this.onMouseleave),this.bind(".xgplayer-slider","mousedown",this.onBarMousedown),this.bind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.bind(".xgplayer-slider","mouseup",this.onBarMouseUp)),this.bind(".xgplayer-icon",["touchend","click"],this.changeMutedHandler),this.on(VOLUME_CHANGE,this.onVolumeChange),this.once(LOADED_DATA,this.onVolumeChange),"Number"!==util$2.typeOf(n)&&(this.player.volume=this.config.default),this.onVolumeChange()}}},{key:"updateVolumePos",value:function(e,t){var r=this.player,n=this.find(".xgplayer-drag"),i=this.find(".xgplayer-bar");if(i&&n){var a=parseInt(e/i.getBoundingClientRect().height*1e3,10);n.style.height="".concat(e,"px");var o=Math.max(Math.min(a/1e3,1),0),s={volume:{from:r.volume,to:o}};r.muted&&(s.muted={from:!0,to:!1}),this.emitUserAction(t,"change_volume",{muted:r.muted,volume:r.volume,props:s}),r.volume=Math.max(Math.min(a/1e3,1),0),r.muted&&(r.muted=!1),this.config.showValueLabel&&this.updateVolumeValue()}}},{key:"updateVolumeValue",value:function(){var e=this.player,t=e.volume,r=e.muted,n=this.find(".xgplayer-value-label"),i=Math.max(Math.min(t,1),0);n.innerText=r?0:Math.ceil(100*i)}},{key:"changeMuted",value:function(e){e&&e.stopPropagation();var t=this.player;this.isStart&&this.onBarMouseUp(e),this.emitUserAction(e,"change_muted",{muted:t.muted,volume:t.volume,props:{muted:{from:t.muted,to:!t.muted}}}),t.volume>0&&(t.muted=!t.muted),t.volume<.01&&(t.volume=this.config.miniVolume)}},{key:"animate",value:function(e,t){e||0===t?this.setAttr("data-state","mute"):t<.5&&this.icons.volumeSmall?this.setAttr("data-state","small"):this.setAttr("data-state","normal")}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.volumeSmall),this.appendChild(".xgplayer-icon",e.volumeLarge),this.appendChild(".xgplayer-icon",e.volumeMuted)}},{key:"destroy",value:function(){this.unbind("mouseenter",this.onMouseenter),this.unbind(["blur","mouseleave"],this.onMouseleave),this.unbind(".xgplayer-slider","mousedown",this.onBarMousedown),this.unbind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.unbind(".xgplayer-slider","mouseup",this.onBarMouseUp),document.removeEventListener("mouseup",this.onBarMouseUp),this.unbind(".xgplayer-icon","mobile"===sniffer$1.device?"touchend":"click",this.changeMutedHandler)}},{key:"render",value:function(){if(!this.config.disable){var e=this.config.default||this.player.volume,t=this.config.showValueLabel;return'\n    <xg-icon class="xgplayer-volume" data-state="normal">\n      <div class="xgplayer-icon">\n      </div>\n      <xg-slider class="xgplayer-slider">\n        '.concat(t?'<div class="xgplayer-value-label">'.concat(100*e,"</div>"):"",'\n        <div class="xgplayer-bar">\n          <xg-drag class="xgplayer-drag" style="height: ').concat(100*e,'%"></xg-drag>\n        </div>\n      </xg-slider>\n    </xg-icon>')}}}],[{key:"pluginName",get:function(){return"volume"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:1,disable:!1,showValueLabel:!1,default:.6,miniVolume:.2}}}]),r}(Plugin);function RotateSvg(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="-4 -6 40 40" fill="none">\n  <g clip-path="url(#clip0)">\n    <path transform="scale(1.5 1.5)" d="M11.6665 9.16663H4.1665C2.78579 9.16663 1.6665 10.2859 1.6665 11.6666V15.8333C1.6665 17.214 2.78579 18.3333 4.1665 18.3333H11.6665C13.0472 18.3333 14.1665 17.214 14.1665 15.8333V11.6666C14.1665 10.2859 13.0472 9.16663 11.6665 9.16663Z" fill="white"/>\n    <path transform="scale(1.5 1.5)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88148 4.06298C3.75371 4.21005 3.67667 4.40231 3.67749 4.61242C3.67847 4.87253 3.79852 5.10435 3.98581 5.25646L6.99111 8.05895C7.32771 8.37283 7.85502 8.35443 8.16891 8.01782C8.48279 7.68122 8.46437 7.15391 8.12778 6.84003L6.62061 5.43457L9.8198 5.4224C9.82848 5.42239 9.8372 5.42221 9.84591 5.4219C10.9714 5.38233 12.0885 5.6285 13.0931 6.13744C14.0976 6.64635 14.957 7.40148 15.5908 8.33234C16.2246 9.2632 16.6122 10.3394 16.7177 11.4606C16.823 12.5819 16.6427 13.7115 16.1934 14.7442C16.0098 15.1661 16.203 15.6571 16.6251 15.8408C17.0471 16.0243 17.5381 15.8311 17.7216 15.4091C18.2833 14.1183 18.5087 12.7063 18.3771 11.3047C18.2453 9.90318 17.7607 8.55792 16.9684 7.39433C16.1761 6.23073 15.1021 5.28683 13.8463 4.65065C12.5946 4.01651 11.203 3.70872 9.80072 3.75583L6.43415 3.76862L7.96326 2.12885C8.27715 1.79225 8.25872 1.26494 7.92213 0.951061C7.58553 0.63718 7.05822 0.655585 6.74433 0.99219L3.90268 4.0395C3.89545 4.04724 3.88841 4.05509 3.88154 4.06303L3.88148 4.06298Z" fill="white"/>\n  </g>\n  <defs>\n    <clipPath id="clip0">\n      <rect width="40" height="40" fill="white"/>\n    </clipPath>\n  </defs>\n</svg>\n',"image/svg+xml").firstChild}var Rotate=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(e){var n;return _classCallCheck$7(this,r),(n=t.call(this,e)).rotateDeg=n.config.rotateDeg||0,n}return _createClass$8(r,[{key:"afterCreate",value:function(){var e=this;this.config.disable||(this.appendChild(".xgplayer-icon",this.icons.rotate),this.onBtnClick=this.onBtnClick.bind(this),this.bind(".xgplayer-icon",["click","touchend"],this.onBtnClick),this.on(VIDEO_RESIZE,(function(){e.rotateDeg&&util$2.setTimeout(e,(function(){e.updateRotateDeg(e.rotateDeg,e.config.innerRotate)}),100)})),this.rotateDeg&&this.updateRotateDeg(this.rotateDeg,this.config.innerRotate))}},{key:"destroy",value:function(){this.unbind(".xgplayer-icon",["click","touchend"],this.onBtnClick)}},{key:"onBtnClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"rotate"),this.rotate(this.config.clockwise,this.config.innerRotate,1)}},{key:"updateRotateDeg",value:function(e,t){var r=this.player;e||(e=0);var n=this.player,i=n.root,a=n.innerContainer,o=n.video,s=i.offsetWidth,u=a&&t?a.offsetHeight:i.offsetHeight,c="100%",l="100%",d=0,h=0;.75!==e&&.25!==e||(c="".concat(u,"px"),l="".concat(s,"px"),d=-(u-s)/2,h=-(s-u)/2);var f="translate(".concat(d,"px,").concat(h,"px) rotate(").concat(e,"turn)"),p={transformOrigin:"center center",transform:f,webKitTransform:f,height:l,width:c},g=t?o:i,y=t?r.getPlugin("poster"):null;Object.keys(p).map((function(e){g.style[e]=p[e],y&&y.root&&(y.root.style[e]=p[e])}))}},{key:"rotate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=this.player;this.rotateDeg||(this.rotateDeg=0);var i=e?1:-1;this.rotateDeg=(this.rotateDeg+1+.25*i*r)%1,this.updateRotateDeg(this.rotateDeg,t),n.emit(ROTATE,360*this.rotateDeg)}},{key:"registerIcons",value:function(){return{rotate:RotateSvg}}},{key:"render",value:function(){if(!this.config.disable)return'\n    <xg-icon class="xgplayer-rotate">\n      <div class="xgplayer-icon">\n      </div>\n      <div class="xg-tips" lang-key="'.concat(this.i18nKeys.ROTATE_TIPS,'">\n      ').concat(this.i18n.ROTATE_TIPS,"\n      </div>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"rotate"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:6,innerRotate:!0,clockwise:!1,rotateDeg:0,disable:!1}}}]),r}(Plugin);function PipIcon(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"\n    fill="white" />\n</svg>',"image/svg+xml").firstChild}function PipIconExit(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"\n    fill="white" />\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M9.4998 7.7C9.77595 7.7 9.9998 7.47614 9.9998 7.2V6.5C9.9998 6.22386 9.77595 6 9.4998 6H5.5402L5.52754 6.00016H5.5C5.22386 6.00016 5 6.22401 5 6.50016V10.4598C5 10.7359 5.22386 10.9598 5.5 10.9598H6.2C6.47614 10.9598 6.7 10.7359 6.7 10.4598V8.83005L8.76983 10.9386C8.96327 11.1357 9.27984 11.1386 9.47691 10.9451L9.97645 10.4548C10.1735 10.2613 10.1764 9.94476 9.983 9.7477L7.97289 7.7H9.4998Z"\n    fill="white" />\n</svg>',"image/svg+xml").firstChild}var PresentationMode={PIP:"picture-in-picture",INLINE:"inline",FULLSCREEN:"fullscreen"},PIP=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){var e;_classCallCheck$7(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$8(_assertThisInitialized$7(e=t.call.apply(t,[this].concat(i))),"switchPIP",(function(t){if(!e.isPIPAvailable())return!1;t.stopPropagation(),e.isPip?(e.exitPIP(),e.emitUserAction(t,"change_pip",{props:"pip",from:!0,to:!1}),e.setAttr("data-state","normal")):4===e.player.video.readyState&&(e.requestPIP(),e.emitUserAction(t,"change_pip",{props:"pip",from:!1,to:!0}),e.setAttr("data-state","pip"))})),e}return _createClass$8(r,[{key:"beforeCreate",value:function(e){"boolean"==typeof e.player.config.pip&&(e.config.showIcon=e.player.config.pip)}},{key:"afterCreate",value:function(){var e=this;this.isPIPAvailable()&&(this.pMode=PresentationMode.INLINE,this.initPipEvents(),this.config.showIcon&&this.initIcons(),this.once(COMPLETE,(function(){e.config.showIcon&&(util$2.removeClass(e.find(".xgplayer-icon"),"xg-icon-disable"),e.bind("click",e.switchPIP))})))}},{key:"registerIcons",value:function(){return{pipIcon:{icon:PipIcon,class:"xg-get-pip"},pipIconExit:{icon:PipIconExit,class:"xg-exit-pip"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.pipIcon),this.appendChild(".xgplayer-icon",e.pipIconExit)}},{key:"initPipEvents",value:function(){var e=this,t=this.player;this.leavePIPCallback=function(){var r=t.paused;util$2.setTimeout(e,(function(){!r&&t.videoPlay()}),0),!r&&t.videoPlay(),e.setAttr("data-state","normal"),t.emit(PIP_CHANGE,!1)},this.enterPIPCallback=function(r){t.emit(PIP_CHANGE,!0),e.pipWindow=r.pictureInPictureWindow,e.setAttr("data-state","pip")},this.onWebkitpresentationmodechanged=function(r){var n=t.video.webkitPresentationMode;e.pMode===PresentationMode.FULLSCREEN&&n!==PresentationMode.FULLSCREEN&&t.onFullscreenChange(null,!1),e.pMode=n,n===PresentationMode.PIP?e.enterPIPCallback(r):n===PresentationMode.INLINE&&e.leavePIPCallback(r)},t.video&&(t.video.addEventListener("enterpictureinpicture",this.enterPIPCallback),t.video.addEventListener("leavepictureinpicture",this.leavePIPCallback),r.checkWebkitSetPresentationMode(t.video)&&t.video.addEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged))}},{key:"requestPIP",value:function(){var e=this.player,t=this.playerConfig;if(this.isPIPAvailable()&&!this.isPip)try{var n=t.poster;return n&&(e.video.poster="String"===util$2.typeOf(n)?n:n.poster),r.checkWebkitSetPresentationMode(e.video)?e.video.webkitSetPresentationMode("picture-in-picture"):e.video.requestPictureInPicture(),!0}catch(i){return console.error("requestPiP",i),!1}}},{key:"exitPIP",value:function(){var e=this.player;try{return this.isPIPAvailable()&&this.isPip&&(r.checkWebkitSetPresentationMode(e.video)?e.video.webkitSetPresentationMode("inline"):document.exitPictureInPicture()),!0}catch(t){return console.error("exitPIP",t),!1}}},{key:"isPip",get:function(){var e=this.player;return document.pictureInPictureElement&&document.pictureInPictureElement===e.video||e.video.webkitPresentationMode===PresentationMode.PIP}},{key:"isPIPAvailable",value:function(){var e=this.player.video;return("Boolean"!==util$2.typeOf(document.pictureInPictureEnabled)||document.pictureInPictureEnabled)&&("Boolean"===util$2.typeOf(e.disablePictureInPicture)&&!e.disablePictureInPicture||e.webkitSupportsPresentationMode&&"Function"===util$2.typeOf(e.webkitSetPresentationMode))}},{key:"destroy",value:function(){var e=this.player;e.video.removeEventListener("enterpictureinpicture",this.enterPIPCallback),e.video.removeEventListener("leavepictureinpicture",this.leavePIPCallback),r.checkWebkitSetPresentationMode(e.video)&&e.video.removeEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged),this.exitPIP(),this.unbind("click",this.btnClick)}},{key:"render",value:function(){if(this.config.showIcon&&this.isPIPAvailable())return'<xg-icon class="xgplayer-pip">\n      <div class="xgplayer-icon xg-icon-disable">\n      </div>\n      <div class="xg-tips" lang-key="'.concat(this.i18nKeys.PIP,'">').concat(this.i18n.PIP,"</div>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"pip"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:6,showIcon:!1}}},{key:"checkWebkitSetPresentationMode",value:function(e){return"function"==typeof e.webkitSetPresentationMode}}]),r}(Plugin);function Next(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="40" viewBox="10 0 24 40">\n  <path transform="scale(0.038 0.028)" d="M800 380v768h-128v-352l-320 320v-704l320 320v-352z"></path>\n</svg>\n',"image/svg+xml").firstChild}var PlayNextIcon=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(e){var n;return _classCallCheck$7(this,r),_defineProperty$8(_assertThisInitialized$7(n=t.call(this,e)),"playNext",(function(e){var t=_assertThisInitialized$7(n).player;e.preventDefault(),e.stopPropagation(),n.idx+1<n.config.urlList.length?(n.idx++,n.nextHandler(n.config.urlList[n.idx],n.idx),t.emit(PLAYNEXT,n.idx+1)):(n.nextHandler(),t.emit(PLAYNEXT))})),n.idx=-1,n}return _createClass$8(r,[{key:"afterCreate",value:function(){this.config.urlList&&0!==this.config.urlList.length&&(this.appendChild(".xgplayer-icon",this.icons.playNext),this.initEvents())}},{key:"registerIcons",value:function(){return{playNext:Next}}},{key:"initEvents",value:function(){this.nextHandler=this.hook("nextClick",this.changeSrc);var e="mobile"===sniffer$1.device?"touchend":"click";this.bind(e,this.playNext),this.show()}},{key:"changeSrc",value:function(e){var t=this.player;e&&(t.pause(),t.currentTime=0,t.switchURL?t.switchURL(e):t.src=e,t.config.url=e,t.play())}},{key:"destroy",value:function(){this.unbind(["touchend","click"],this.playNext)}},{key:"render",value:function(){if(this.config.urlList&&0!==this.config.urlList.length)return'\n     <xg-icon class="xgplayer-playnext">\n      <div class="xgplayer-icon">\n      </div>\n      <div class="xg-tips" lang-key="PLAYNEXT_TIPS">'.concat(this.i18n.PLAYNEXT_TIPS,"</div>\n     </xg-icon>\n    ")}}],[{key:"pluginName",get:function(){return"playNext"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_LEFT,index:1,url:null,urlList:[]}}}]),r}(Plugin),download={exports:{}},module2;module2=download,module2.exports=function e(t,r,n){var i,a,o=window,s="application/octet-stream",u=n||s,c=t,l=!r&&!n&&c,d=document.createElement("a"),h=function(e){return String(e)},f=o.Blob||o.MozBlob||o.WebKitBlob||h,p=r||"download";if(f=f.call?f.bind(o):Blob,"true"===String(this)&&(u=(c=[c,u])[0],c=c[1]),l&&l.length<2048&&(p=l.split("/").pop().split("?")[0],d.href=l,-1!==d.href.indexOf(l))){var g=new XMLHttpRequest;return g.open("GET",l,!0),g.responseType="blob",g.onload=function(t){e(t.target.response,p,s)},setTimeout((function(){g.send()}),0),g}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(c)){if(!(c.length>2096103.424&&f!==h))return navigator.msSaveBlob?navigator.msSaveBlob(_(c),p):b(c);u=(c=_(c)).type||s}else if(/([\x80-\xff])/.test(c)){for(var y=0,m=new Uint8Array(c.length),v=m.length;y<v;++y)m[y]=c.charCodeAt(y);c=new f([m],{type:u})}function _(e){for(var t=e.split(/[:;,]/),r=t[1],n=("base64"==t[2]?atob:decodeURIComponent)(t.pop()),i=n.length,a=0,o=new Uint8Array(i);a<i;++a)o[a]=n.charCodeAt(a);return new f([o],{type:r})}function b(e,t){if("download"in d)return d.href=e,d.setAttribute("download",p),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout((function(){d.click(),document.body.removeChild(d),!0===t&&setTimeout((function(){o.URL.revokeObjectURL(d.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var r=document.createElement("iframe");document.body.appendChild(r),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),r.src=e,setTimeout((function(){document.body.removeChild(r)}),333)}if(i=c instanceof f?c:new f([c],{type:u}),navigator.msSaveBlob)return navigator.msSaveBlob(i,p);if(o.URL)b(o.URL.createObjectURL(i),!0);else{if("string"==typeof i||i.constructor===h)try{return b("data:"+u+";base64,"+o.btoa(i))}catch(A){return b("data:"+u+","+encodeURIComponent(i))}(a=new FileReader).onload=function(e){b(this.result)},a.readAsDataURL(i)}return!0};var downloadUtil=download.exports;function DownloadSvg(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24">\n  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n    <g transform="translate(-488.000000, -340.000000)" fill="#FFFFFF">\n      <g id="Group-2">\n        <g id="volme_big-copy" transform="translate(488.000000, 340.000000)">\n          <rect id="Rectangle-18" x="11" y="4" width="2" height="12" rx="1"></rect>\n          <rect id="Rectangle-2" x="3" y="18" width="18" height="2" rx="1"></rect>\n          <rect id="Rectangle-2" transform="translate(4.000000, 17.500000) rotate(90.000000) translate(-4.000000, -17.500000) " x="1.5" y="16.5" width="5" height="2" rx="1"></rect><rect id="Rectangle-2-Copy-3" transform="translate(20.000000, 17.500000) rotate(90.000000) translate(-20.000000, -17.500000) " x="17.5" y="16.5" width="5" height="2" rx="1"></rect>\n          <path d="M9.48791171,8.26502656 L9.48791171,14.2650266 C9.48791171,14.8173113 9.04019646,15.2650266 8.48791171,15.2650266 C7.93562696,15.2650266 7.48791171,14.8173113 7.48791171,14.2650266 L7.48791171,7.26502656 C7.48791171,6.71274181 7.93562696,6.26502656 8.48791171,6.26502656 L15.4879117,6.26502656 C16.0401965,6.26502656 16.4879117,6.71274181 16.4879117,7.26502656 C16.4879117,7.81731131 16.0401965,8.26502656 15.4879117,8.26502656 L9.48791171,8.26502656 Z" id="Combined-Shape" transform="translate(11.987912, 10.765027) scale(1, -1) rotate(45.000000) translate(-11.987912, -10.765027) "></path>\n        </g>\n      </g>\n    </g>\n  </g>\n</svg>\n',"image/svg+xml").firstChild}var Download=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(e){var n;return _classCallCheck$7(this,r),_defineProperty$8(_assertThisInitialized$7(n=t.call(this,e)),"download",(function(e){if(!n.isLock){n.emitUserAction(e,"download");var t=n.getAbsoluteURL(n.player.src);downloadUtil(t),n.isLock=!0,n.timer=window.setTimeout((function(){n.isLock=!1,window.clearTimeout(n.timer),n.timer=null}),300)}})),n.timer=null,n.isLock=!1,n}return _createClass$8(r,[{key:"afterCreate",value:function(){this.config.disable||(this.appendChild(".xgplayer-icon",this.icons.download),this.bind(["click","touchend"],this.download))}},{key:"registerIcons",value:function(){return{download:DownloadSvg}}},{key:"getAbsoluteURL",value:function(e){if(!e.match(/^https?:\/\//)){var t=document.createElement("div");t.innerHTML='<a href="'.concat(e,'">x</a>'),e=t.firstChild.href}return e}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.download),window.clearTimeout(this.timer),this.timer=null}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class="xgplayer-download">\n   <div class="xgplayer-icon">\n   </div>\n   <div class="xg-tips" lang-key="'.concat(this.i18nKeys.DOWNLOAD_TIPS,'">').concat(this.i18n.DOWNLOAD_TIPS,"</div>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"download"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:3,disable:!0}}}]),r}(Plugin),ScreenShot=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){return _classCallCheck$7(this,r),t.apply(this,arguments)}return _createClass$8(r,[{key:"beforeCreate",value:function(e){"boolean"==typeof e.player.config.screenShot&&(e.config.disable=!e.player.config.screenShot)}},{key:"afterCreate",value:function(){this.appendChild(".xgplayer-icon",this.icons.screenshotIcon);var e=this.config;this.initSize=function(t){e.fitVideo&&(e.width=t.vWidth,e.height=t.vHeight)},this.once(VIDEO_RESIZE,this.initSize)}},{key:"onPluginsReady",value:function(){this.show(),this.onClickBtn=this.onClickBtn.bind(this),this.bind(["click","touchend"],this.onClickBtn)}},{key:"saveScreenShot",value:function(e,t){var r=document.createElement("a");r.href=e,r.download=t;var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(n)}},{key:"createCanvans",value:function(e,t){var r=document.createElement("canvas");this.canvasCtx=r.getContext("2d"),this.canvas=r,r.width=e||this.config.width,r.height=t||this.config.height}},{key:"onClickBtn",value:function(e){var t=this;e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"shot"),this.shot().then((function(e){t.emit(SCREEN_SHOT,e),t.saveScreenShot(e,t.config.name+t.config.format)}))}},{key:"shot",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{quality:.92,type:"image/png"},i=this.config,a=this.player,o=n.quality||i.quality,s=n.type||i.type;return new Promise((function(n,u){var c=null;a.video.canvas?c=a.video.canvas:(r.canvas?(r.canvas.width=e||i.width,r.canvas.height=t||i.height):r.createCanvans(e,t),r.canvasCtx.drawImage(a.video,0,0,e||i.width,t||i.height),c=r.canvas);var l=c.toDataURL(s,o).replace(s,"image/octet-stream");n(l=l.replace(/^data:image\/[^;]+/,"data:application/octet-stream"))}))}},{key:"registerIcons",value:function(){return{screenshotIcon:null}}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.onClickBtn),this.off(VIDEO_RESIZE,this.initSize)}},{key:"render",value:function(){if(!this.config.disable){var e=this.icons.screenshotIcon?"xgplayer-icon":"xgplayer-icon btn-text",t="SCREENSHOT";return'\n      <xg-icon class="xgplayer-shot">\n      <div class="'.concat(e,'">\n      ').concat(this.icons.screenshotIcon?"":'<span lang-key="'.concat(this.i18nKeys[t],'">').concat(this.i18n[t],"</span>")," \n      </div>\n    </xg-icon>")}}}],[{key:"pluginName",get:function(){return"screenShot"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:5,quality:.92,type:"image/png",format:".png",width:600,height:337,fitVideo:!0,disable:!1,name:"screenshot"}}}]),r}(Plugin),OptionList=function(){function e(t){_classCallCheck$7(this,e),this.config=t.config,this.parent=t.root,this.root=util$2.createDom("ul","",{},"xg-options-list ".concat(this.config.className)),t.root.appendChild(this.root),this.onItemClick=this.onItemClick.bind(this),this.renderItemList();var r="mobile"===sniffer$1.device?"touchend":"click";this._delegates=Plugin.delegate.call(this,this.root,"li",r,this.onItemClick)}return _createClass$8(e,[{key:"renderItemList",value:function(e){var t=this,r=this.config,n=this.root;e?r.data=e:e=r.data,r.style&&Object.keys(r.style).map((function(e){n.style[e]=r[e]})),e.length>0&&(this.attrKeys=Object.keys(e[0])),this.root.innerHTML="",e.map((function(e,r){var n=e.selected?"option-item selected":"option-item";e["data-index"]=r,t.root.appendChild(util$2.createDom("li","<span>".concat(e.showText,"</span>"),e,n))}))}},{key:"onItemClick",value:function(e){e.delegateTarget||(e.delegateTarget=e.target);var t=e.delegateTarget;if(t&&util$2.hasClass(t,"selected"))return!1;var r="function"==typeof this.config.onItemClick?this.config.onItemClick:null,n=this.root.querySelector(".selected");util$2.addClass(t,"selected"),n&&util$2.removeClass(n,"selected"),r(e,{from:n?this.getAttrObj(n,this.attrKeys):null,to:this.getAttrObj(t,this.attrKeys)})}},{key:"getAttrObj",value:function(e,t){if(!e||!t)return{};var r={};t.map((function(t){r[t]=e.getAttribute(t)}));var n=e.getAttribute("data-index");return n&&(r.index=Number(n)),r}},{key:"show",value:function(){util$2.removeClass(this.root,"hide"),util$2.addClass(this.root,"active")}},{key:"hide",value:function(){util$2.removeClass(this.root,"active"),util$2.addClass(this.root,"hide")}},{key:"destroy",value:function(){this._delegates&&(this._delegates.map((function(e){e.destroy&&e.destroy()})),this._delegates=null),this.root.innerHTML=null,this.parent.removeChild(this.root),this.root=null}}]),e}(),IS_MOBILE$1="mobile"===sniffer$1.device,OptionsIcon=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(e){var n;return _classCallCheck$7(this,r),(n=t.call(this,e)).isActive=!1,n.curValue=null,n.curIndex=0,n}return _createClass$8(r,[{key:"updateLang",value:function(e){this.renderItemList(this.config.list,this.curIndex)}},{key:"afterCreate",value:function(){var e=this,t=this.config;IS_MOBILE$1&&"middle"!==t.listType&&(t.listType="rightSide"),t.hidePortrait&&util$2.addClass(this.root,"portrait"),this.once(CANPLAY,(function(){t.list&&t.list.length>0&&(e.renderItemList(t.list),e.show())})),IS_MOBILE$1&&this.on(PLAYER_FOCUS,(function(){e.isActive&&(e.optionsList&&e.optionsList.hide(),e.isActive=!1)})),this.activeEvent=IS_MOBILE$1?"touchend":"mouseenter",this.onEnter=this.onEnter.bind(this),this.onLeave=this.onLeave.bind(this),this.bind(this.activeEvent,this.onEnter),this.bind("mouseleave",this.onLeave)}},{key:"show",value:function(){!this.config.list||this.config.list.length<2||util$2.addClass(this.root,"show")}},{key:"hide",value:function(){util$2.removeClass(this.root,"show")}},{key:"getTextByLang",value:function(e,t,r){if(void 0===e)return"";var n=this.config.list;return!r&&(r=this.player.lang),t=!t||util$2.isUndefined(e[t])?"text":t,"number"==typeof e&&(e=n[e]),"object"===_typeof$6(e[t])?e[t][r]||e[t].zh:e[t]||""}},{key:"onEnter",value:function(e){e.preventDefault(),e.stopPropagation(),this.onToggle(!0)}},{key:"onLeave",value:function(e){e.preventDefault(),e.stopPropagation(),this.isActive&&this.onToggle(!1)}},{key:"onToggle",value:function(e){if(this.isActive!==e){var t=this.player.controls,r=this.config.listType;e?("rightSide"===r?t.blur():t.focus(),this.optionsList&&this.optionsList.show()):("rightSide"===r?t.focus():t.focusAwhile(),this.optionsList&&this.optionsList.hide()),this.isActive=e}}},{key:"onItemClick",value:function(e,t){e.preventDefault(),e.stopPropagation();var r=this.config,n=r.listType,i=r.list;(IS_MOBILE$1||"rightSide"===n)&&this.onToggle(!1),this.curIndex=t.to.index,this.curItem=i[this.curIndex],this.changeCurrentText(),this.onToggle(!1)}},{key:"changeCurrentText",value:function(){var e=this.config.list,t=e[this.curIndex<e.length?this.curIndex:0];t&&(this.find(".icon-text").innerHTML=this.getTextByLang(t,"iconText"))}},{key:"renderItemList",value:function(e,t){var r=this,n=this.config,i=this.optionsList,a=this.player;if("number"==typeof t&&(this.curIndex=t,this.curItem=n.list[t]),i)return i.renderItemList(e),void this.changeCurrentText();var o={config:{data:e||[],className:"rightSide"===n.listType?"right-side":"",onItemClick:function(e,t){r.onItemClick(e,t)}},root:"rightSide"===n.listType?a.root:this.root};this.config.isShowIcon&&(this.optionsList=new OptionList(o),this.changeCurrentText(),this.show())}},{key:"destroy",value:function(){this.unbind(this.activeEvent,this.onToggle),this.unbind("mouseleave",this.onToggle),this.optionsList&&(this.optionsList.destroy(),this.optionsList=null)}},{key:"render",value:function(){if(this.config.isShowIcon)return'<xg-icon class="xg-options-icon '.concat(this.config.className||"",'">\n    <div class="xgplayer-icon btn-text">\n    <span class="icon-text"></span>\n    </div>\n   </xg-icon>')}}],[{key:"pluginName",get:function(){return"optionsIcon"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:100,list:[],listType:"middle",listStyle:{},hidePortrait:!0,isShowIcon:!1}}}]),r}(Plugin),DefinitionIcon=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(e){var n;return _classCallCheck$7(this,r),(n=t.call(this,e)).curTime=0,n.isPaused=!0,n}return _createClass$8(r,[{key:"beforeCreate",value:function(e){var t=e.config.list;Array.isArray(t)&&t.length>0&&(e.config.list=t.map((function(e){return!e.text&&e.name&&(e.text=e.name),e.text||(e.text=e.definition),e})))}},{key:"afterCreate",value:function(){var e=this;_get$1(_getPrototypeOf$7(r.prototype),"afterCreate",this).call(this),this.on("resourceReady",(function(t){e.changeDefinitionList(t)})),this.on(DEFINITION_CHANGE,(function(t){e.renderItemList(e.config.list,t.to)})),this.player.definitionList.length<2&&this.hide()}},{key:"initDefinition",value:function(){var e=this.config,t=e.list,r=e.defaultDefinition;if(t.length>0){var n=null;t.map((function(e){e.definition===r&&(n=e)})),n||(n=t[0]),this.changeDefinition(n)}}},{key:"renderItemList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.list||[],n=arguments.length>1?arguments[1]:void 0,i=n&&n.definition?n.definition:this.config.defaultDefinition;n&&t.forEach((function(e){e.selected=!1}));var a=0,o=t.map((function(t,r){var n={url:t.url,definition:t.definition||"",showText:e.getTextByLang(t)||t.definition,selected:!1};return(t.selected||t.definition&&t.definition===i)&&(n.selected=!0,a=r),n}));_get$1(_getPrototypeOf$7(r.prototype),"renderItemList",this).call(this,o,a)}},{key:"changeDefinitionList",value:function(e){Array.isArray(e)&&(this.config.list=e.map((function(e){return!e.text&&e.name&&(e.text=e.name),e.text||(e.text=e.definition),e})),this.renderItemList(),this.config.list.length<2?this.hide():this.show())}},{key:"changeDefinition",value:function(e,t){this.player.changeDefinition(e,t)}},{key:"onItemClick",value:function(e,t){_get$1(_getPrototypeOf$7(r.prototype),"onItemClick",this).apply(this,arguments),this.emitUserAction(e,"change_definition",{from:t.from,to:t.to}),this.player.changeDefinition(t.to,t.from)}}],[{key:"pluginName",get:function(){return"definition"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:3,list:[],defaultDefinition:"",disable:!1,hidePortrait:!1,className:"xgplayer-definition",isShowIcon:!0}}}]),r}(OptionsIcon),PlaybackRate=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(e){var n;return _classCallCheck$7(this,r),(n=t.call(this,e)).curRate=1,n}return _createClass$8(r,[{key:"beforeCreate",value:function(e){var t=e.player.config.playbackRate,r=t?Array.isArray(t)?t:e.config.list:[];Array.isArray(r)&&(e.config.list=r.map((function(e){return"number"==typeof e?e={rate:e,text:"".concat(e,"x")}:!e.text&&e.rate&&(e.text="".concat(e.rate,"x")),e})))}},{key:"afterCreate",value:function(){var e=this;_get$1(_getPrototypeOf$7(r.prototype),"afterCreate",this).call(this),this.on(RATE_CHANGE,(function(){e.curValue!==e.player.playbackRate&&e.renderItemList()})),this.renderItemList()}},{key:"show",value:function(){this.config.list&&0!==this.config.list.length&&_get$1(_getPrototypeOf$7(r.prototype),"show",this).call(this)}},{key:"onItemClick",value:function(e,t){_get$1(_getPrototypeOf$7(r.prototype),"onItemClick",this).apply(this,arguments);var n=e.delegateTarget,i=Number(n.getAttribute("rate"));if(!i||i===this.curValue)return!1;var a={playbackRate:{from:this.player.playbackRate,to:i}};this.emitUserAction(e,"change_rate",{props:a}),this.curValue=i,this.player.playbackRate=i}},{key:"renderItemList",value:function(){var e=this,t=this.player.playbackRate||1;this.curValue=t;var n=0,i=this.config.list.map((function(r,i){var a={rate:r.rate};return a.rate===t&&(a.selected=!0,n=i),a.showText=e.getTextByLang(r),a}));_get$1(_getPrototypeOf$7(r.prototype),"renderItemList",this).call(this,i,n)}},{key:"destroy",value:function(){_get$1(_getPrototypeOf$7(r.prototype),"destroy",this).call(this)}}],[{key:"pluginName",get:function(){return"playbackRate"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:4,list:[2,1.5,1,.75,.5],className:"xgplayer-playbackrate",isShowIcon:!0,hidePortrait:!1}}}]),r}(OptionsIcon);function CssFullSceenSvg(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">\n  <path fill="#fff" transform="scale(1.3, 1.3)" class=\'path_full\' d="M9,10v1a.9.9,0,0,1-1,1,.9.9,0,0,1-1-1V9A.9.9,0,0,1,8,8h2a.9.9,0,0,1,1,1,.9.9,0,0,1-1,1Zm6,4V13a1,1,0,0,1,2,0v2a.9.9,0,0,1-1,1H14a1,1,0,0,1,0-2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>\n</svg>\n',"image/svg+xml").firstChild}function ExitCssFullSceenSvg(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">\n  <path fill="#fff" transform="scale(1.3, 1.3)" d="M9,10V9a.9.9,0,0,1,1-1,.9.9,0,0,1,1,1v2a.9.9,0,0,1-1,1H8a.9.9,0,0,1-1-1,.9.9,0,0,1,1-1Zm6,4v1a1,1,0,0,1-2,0V13a.9.9,0,0,1,1-1h2a1,1,0,0,1,0,2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>\n</svg>\n',"image/svg+xml").firstChild}var CssFullScreen=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){return _classCallCheck$7(this,r),t.apply(this,arguments)}return _createClass$8(r,[{key:"afterCreate",value:function(){var e=this;this.config.disable||(this.config.target&&(this.playerConfig.fullscreenTarget=this.config.target),this.initIcons(),this.on(CSS_FULLSCREEN_CHANGE,(function(t){e.animate(t)})),this.btnClick=this.btnClick.bind(this),this.handleCssFullscreen=this.hook("cssFullscreen_change",this.btnClick,{pre:function(e){e.preventDefault(),e.stopPropagation()}}),this.bind(["click","touchend"],this.handleCssFullscreen))}},{key:"initIcons",value:function(){var e=this.icons,t=this.find(".xgplayer-icon");t.appendChild(e.cssFullscreen),t.appendChild(e.exitCssFullscreen)}},{key:"btnClick",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.player.isCssfullScreen;this.emitUserAction(e,"switch_cssfullscreen",{cssfullscreen:t}),t?this.player.exitCssFullscreen():this.player.getCssFullscreen()}},{key:"animate",value:function(e){this.root&&(e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.switchTips(e))}},{key:"switchTips",value:function(e){var t=this.i18nKeys;this.changeLangTextKey(this.find(".xg-tips"),e?t.EXITCSSFULLSCREEN_TIPS:t.CSSFULLSCREEN_TIPS)}},{key:"registerIcons",value:function(){return{cssFullscreen:{icon:CssFullSceenSvg,class:"xg-get-cssfull"},exitCssFullscreen:{icon:ExitCssFullSceenSvg,class:"xg-exit-cssfull"}}}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class=\'xgplayer-cssfullscreen\'>\n    <div class="xgplayer-icon">\n    </div>\n    <div class="xg-tips" lang-key="'.concat(this.i18nKeys.EXITCSSFULLSCREEN_TIPS,'">').concat(this.i18n.CSSFULLSCREEN_TIPS,"</div>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"cssFullscreen"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:1,disable:!1,target:null}}}]),r}(Plugin),ErrorPlugin$1=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){return _classCallCheck$7(this,r),t.apply(this,arguments)}return _createClass$8(r,[{key:"afterCreate",value:function(){var e=this;this.clickHandler=this.hook("errorRetry",this.errorRetry,{pre:function(e){e.preventDefault(),e.stopPropagation()}}),this.onError=this.hook("showError",this.handleError),this.bind(".xgplayer-error-refresh","click",this.clickHandler),this.on(CANPLAY,(function(){e.handleCanPlay()})),this.on(ERROR$3,(function(t){e.onError(t)}))}},{key:"errorRetry",value:function(e){this.emitUserAction(e,"error_retry",{}),this.player.retry()}},{key:"handleCanPlay",value:function(){util$2.removeClass(this.player.root,"xgplayer-is-error")}},{key:"handleError",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.player,r=e.errorType,n=t.errorNote?this.i18n[t.errorNote]:"";if(!n)switch(r){case"decoder":n=this.i18n.MEDIA_ERR_DECODE;break;case"network":n=this.i18n.MEDIA_ERR_NETWORK;break;default:n=this.i18n.MEDIA_ERR_SRC_NOT_SUPPORTED}this.find(".xgplayer-error-text").innerHTML=n,this.find(".xgplayer-error-tips").innerHTML="".concat(this.i18n.REFRESH_TIPS,'<span class="xgplayer-error-refresh">').concat(this.i18n.REFRESH,"</span>")}},{key:"destroy",value:function(){this.unbind(".xgplayer-error-refresh","click",this.clickHandler)}},{key:"render",value:function(){return'<xg-error class="xgplayer-error">\n      <div class="xgplayer-errornote">\n       <span class="xgplayer-error-text"></span>\n       <span class="xgplayer-error-tips"><em class="xgplayer-error-refresh"></em></span>\n      </div>\n    </xg-error>'}}],[{key:"pluginName",get:function(){return"error"}}]),r}(Plugin),Prompt=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){return _classCallCheck$7(this,r),t.apply(this,arguments)}return _createClass$8(r,[{key:"afterCreate",value:function(){var e=this;this.intervalId=0,this.customConfig=null,this.bind(".highlight",["click","touchend"],(function(t){(e.config.onClick||e.customOnClick)&&(t.preventDefault(),t.stopPropagation(),e.customOnClick?e.customOnClick(t):e.config.onClick(t))})),this.player.showPrompt=function(){e.show.apply(e,arguments)},this.player.hidePrompt=function(){e.hide()}}},{key:"setStyle",value:function(e){var t=this;Object.keys(e).map((function(r){t.root.style[r]=e[r]}))}},{key:"show",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(e){this.customOnClick=n;var i=this.config.interval;this.intervalId&&(clearTimeout(this.intervalId),this.intervalId=null),util$2.addClass(this.root,"show"),"arrow"===r.mode&&util$2.addClass(this.root,"arrow"),this.find(".xgplayer-prompt-detail").innerHTML="string"==typeof e?e:"".concat(e.text||"")+"".concat(e.highlight?'<i class="highlight">'.concat(e.highlight,"</i>"):""),r.style&&this.setStyle(r.style);var a="boolean"==typeof r.autoHide?r.autoHide:this.config.autoHide;if(a){var o=r.interval||i;this.intervalId=setTimeout((function(){t.hide()}),o)}}}},{key:"hide",value:function(){util$2.removeClass(this.root,"show"),util$2.removeClass(this.root,"arrow"),this.root.removeAttribute("style"),this.customOnClick=null}},{key:"render",value:function(){return'<xg-prompt class="xgplayer-prompt '.concat(STATE_CLASS.CONTROLS_FOLLOW,'">\n    <span class="xgplayer-prompt-detail"></span>\n    </xg-prompt>')}}],[{key:"pluginName",get:function(){return"prompt"}},{key:"defaultConfig",get:function(){return{interval:3e3,style:{},mode:"arrow",autoHide:!0,detail:{text:"",highlight:""},onClick:function(){}}}}]),r}(Plugin),ISPOT={time:0,text:"",id:1,duration:1,color:"#fff",style:{},width:6,height:6};function mergeISPOT(e){Object.keys(ISPOT).map((function(t){void 0===e[t]&&(e[t]=ISPOT[t])}))}var APIS={initDots:function(){var e=this;this._ispots.map((function(t){e.createDot(t,!1)})),this._ispotsInit=!0},createDot:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.player.plugins.progress;if(r&&(t&&(mergeISPOT(e),this._ispots.push(e)),this._ispotsInit||!t)){var n=this.calcuPosition(e.time,e.duration),i=e.style||{};i.left="".concat(n.left,"%"),i.width="".concat(n.width,"%");var a="xgspot_".concat(e.id," xgplayer-spot");n.isMini&&(a+=" mini");var o=util$2.createDom("xg-spot",e.template||"",{"data-text":e.text,"data-time":e.time,"data-id":e.id},a);Object.keys(i).map((function(e){o.style[e]=i[e]})),r.outer&&r.outer.appendChild(o)}},findDot:function(e){if(this.player.plugins.progress){var t=this._ispots.filter((function(t,r){return t.id===e}));return t.length>0?t[0]:null}},updateDot:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.player.plugins.progress;if(r){var n=this.findDot(e.id);if(n&&Object.keys(e).map((function(t){n[t]=e[t]})),this._ispotsInit){var i=r.find('xg-spot[data-id="'.concat(e.id,'"]'));if(i){var a=this.calcuPosition(e.time,e.duration),o=e.style||{};o.left="".concat(a.left,"%"),o.width="".concat(a.width,"%"),i.setAttribute("data-text",e.text),i.setAttribute("data-time",e.time),a.isMini?util$2.addClass(i,"mini"):util$2.removeClass(i,"mini"),Object.keys(o).map((function(e){i.style[e]=o[e]})),t&&this.showDot(e.id)}}}},deleteDot:function(e){var t=this._ispots,r=this.player.plugins.progress;if(r){for(var n=[],i=0;i<t.length;i++)t[i].id===e&&n.push(i);for(var a=n.length-1;a>=0;a--)if(t.splice(n[a],1),this._ispotsInit){var o=r.find('xg-spot[data-id="'.concat(e,'"]'));o&&o.parentElement.removeChild(o)}}},deleteAllDots:function(){var e=this.player.plugins.progress;if(e)if(this._ispotsInit){for(var t=e.root.getElementsByTagName("xg-spot"),r=t.length-1;r>=0;r--)e.outer.removeChild(t[r]);this._ispots=[]}else this._ispots=[]},updateAllDots:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=this.player.plugins.progress;if(r)if(this._ispotsInit){this._ispots=[];var n=r.root.getElementsByTagName("xg-spot"),i=n.length;if(i>t.length)for(var a=i-1;a>t.length-1;a--)r.outer.removeChild(n[a]);t.map((function(t,r){r<i?(n[r].setAttribute("data-id","".concat(t.id)),e._ispots.push(t),e.updateDot(t)):e.createDot(t)}))}else this._ispots=t},getAllDotsDom:function(){var e=this.player.plugins.progress;return e?e.root.getElementsByTagName("xg-spot"):[]},getDotDom:function(e){var t=this.player.plugins.progress;if(t)return t.find('xg-spot[data-id="'.concat(e,'"]'))}};function initDotsAPI(e){var t=e.config,r=e.player;Object.keys(APIS).map((function(t){e[t]=APIS[t].bind(e)}));var n=r.config.progressDot||t.ispots||[];e._ispots=n.map((function(e){return mergeISPOT(e),e})),e._ispotsInit=!1,r.once(DURATION_CHANGE,(function(){e.initDots()}))}var CALLBACK_MAP={dragmove:"onProgressMove",dragstart:"onProgressDragStart",dragend:"onProgressDragEnd",click:"onProgressClick",mouseover:"onProgressMouseOver"},ProgressPreview=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(e){var n;return _classCallCheck$7(this,r),_defineProperty$8(_assertThisInitialized$7(n=t.call(this,e)),"onMousemove",(function(e){(n._state.f||util$2.hasClass(e.target,"xg-spot-content"))&&(util$2.event(e),e.stopPropagation())})),_defineProperty$8(_assertThisInitialized$7(n),"onMousedown",(function(e){(n._state.f||util$2.hasClass(e.target,"xg-spot-content"))&&(util$2.event(e),e.stopPropagation())})),_defineProperty$8(_assertThisInitialized$7(n),"onDotMouseLeave",(function(e){n._curDot.removeEventListener("mouseleave",n.onDotMouseLeave),n.blurDot(e.target),n._curDot=null;var t=n.player.plugins.progress;t&&t.enableBlur(),n.show()})),_defineProperty$8(_assertThisInitialized$7(n),"onProgressMouseOver",(function(e,t){if(util$2.hasClass(t.target,"xgplayer-spot")&&!n._curDot){n._curDot=t.target,n.focusDot(t.target),n._curDot.children.length>0&&n.hide();var r=n.player.plugins.progress;r&&r.disableBlur(),n._curDot.addEventListener("mouseleave",n.onDotMouseLeave)}})),n._ispots=[],n.videoPreview=null,n.videothumbnail=null,n.thumbnail=null,n._state={now:0,f:!1},n}return _createClass$8(r,[{key:"beforeCreate",value:function(e){var t=e.player.plugins.progress;t&&(e.root=t.root)}},{key:"afterCreate",value:function(){var e=this;this._curDot=null,this.handlerSpotClick=this.hook("spotClick",(function(t,r){r.time&&e.player.seek(r.time)})),initDotsAPI(this)}},{key:"onPluginsReady",value:function(){this.player.plugins.progress&&(this.previewLine=this.find(".xg-spot-line"),this.timePoint=this.find(".xgplayer-progress-point"),this.timeText=this.find(".xg-spot-time"),this.tipText=this.find(".spot-inner-text"),this._hasThumnail=!1,this.registerThumbnail(),this.bindEvents())}},{key:"bindEvents",value:function(){var e=this,t=this.player.plugins.progress;if(t&&(Object.keys(CALLBACK_MAP).map((function(r){e[CALLBACK_MAP[r]]=e[CALLBACK_MAP[r]].bind(e),t.addCallBack(r,e[CALLBACK_MAP[r]])})),"mobile"!==sniffer$1.device)){this.bind(".xg-spot-info","mousemove",this.onMousemove),this.bind(".xg-spot-info","mousedown",this.onMousedown);var r=this.hook("previewClick",(function(){}));this.handlerPreviewClick=function(t){t.stopPropagation(),r(parseInt(1e3*e._state.now,10)/1e3,t)},this.bind(".xg-spot-content","mouseup",this.handlerPreviewClick)}}},{key:"onProgressMove",value:function(e,t){this.updatePosition(e.offset,e.width,e.currentTime,e.e)}},{key:"onProgressDragStart",value:function(e){console.log("onProgressDragStart"),this.isDrag=!0,this.videoPreview&&util$2.addClass(this.videoPreview,"show")}},{key:"onProgressDragEnd",value:function(e){this.isDrag=!1,this.videoPreview&&util$2.removeClass(this.videoPreview,"show")}},{key:"onProgressClick",value:function(e,t){if(util$2.hasClass(t.target,"xgplayer-spot")){t.stopPropagation(),t.preventDefault();var r={};["time","id","text"].map((function(e){r[e]=t.target.getAttribute("data-".concat(e))})),r.time&&(r.time=Number(r.time)),this.handlerSpotClick(t,r)}}},{key:"updateLinePos",value:function(e,t){var r,n,i=this.root,a=this.previewLine,o=this.timePoint,s="flex"===this.player.controls.mode,u=i.getBoundingClientRect().width,c=o.getBoundingClientRect().width,l=e-u/2;l<0&&!s?(l=0,r=e-u/2,!this.thumbnail&&(n=e-u/2-c/2)):l>t-u&&!s?(r=l-(t-u),!this.thumbnail&&(n=l-(t-u)-c/2),l=t-u):!this.thumbnail&&(n=-c/2),a.style.transform=void 0!==r?"translateX(".concat(r,"px)"):"",o.style.transform=void 0!==n?"translateX(".concat(n,"px)"):"",i.style.transform="translateX(".concat(l,"px)")}},{key:"updateTimeText",value:function(e){var t=this.timeText,r=this.timePoint;t.textContent=e,!this.thumbnail&&(r.textContent=e)}},{key:"updatePosition",value:function(e,t,r,n){var i=this.root,a=this.config,o=this._state;if(i){this.updateLinePos(e,t),o.now=r;var s=util$2.format(r);n&&n.target&&util$2.hasClass(n.target,"xgplayer-spot")?(this.showTips(n.target.getAttribute("data-text"),!1,s),this.focusDot(n.target),o.f=!0,a.isFocusDots&&o.f&&(o.now=parseInt(n.target.getAttribute("data-time"),10))):a.defaultText?(o.f=!1,this.showTips(a.defaultText,!0,s)):(o.f=!1,this.hideTips("")),this.updateTimeText(s),this.updateThumbnails(o.now)}}},{key:"updateThumbnails",value:function(e){var t=this.player,r=this.videoPreview,n=t.plugins.thumbnail;if(n&&n.usable){this.thumbnail&&n.update(this.thumbnail,e,160,90);var i=r&&r.getBoundingClientRect();this.videothumbnail&&n.update(this.videothumbnail,e,i.width,i.height)}}},{key:"changeThumbnail",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("mobile"!==sniffer$1.device){var t=this.player,r=this.config,n=t.getPlugin("thumbnail");if(n.changeConfig(e),n&&n.usable&&r.isShowThumbnail){util$2.removeClass(this.root,"short-line no-thumbnail"),this._hasThumnail=!0;var i=this.find(".xg-spot-thumbnail");this.videoPreview&&this.player.root.removeChild(this.videoPreview),this.thumbnail&&i.removeChild(this.thumbnail),this.thumbnail=n.createThumbnail(i,"progress-thumbnail"),r.isShowCoverPreview&&(this.videoPreview=util$2.createDom("xg-video-preview","",{},"xgvideo-preview"),t.root.appendChild(this.videoPreview),this.videothumbnail=n.createThumbnail(this.videoPreview,"xgvideo-thumbnail"))}else{util$2.addClass(this.root,"short-line no-thumbnail");var a=this.find(".xg-spot-thumbnail");this.videoPreview&&this.player.root.removeChild(this.videoPreview),this.thumbnail&&a.removeChild(this.thumbnail),this.videothumbnail=null,this.thumbnail=null,this._hasThumnail=!1}}}},{key:"registerThumbnail",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("mobile"!==sniffer$1.device){var t=this.player,r=this.config,n=t.getPlugin("thumbnail");if(n&&Object.keys(e).map((function(t){n.config[t]=e[t]})),n&&n.usable&&r.isShowThumbnail){util$2.removeClass(this.root,"short-line no-thumbnail"),this._hasThumnail=!0;var i=this.find(".xg-spot-thumbnail");this.thumbnail=n.createThumbnail(i,"progress-thumbnail"),r.isShowCoverPreview&&(this.videoPreview=util$2.createDom("xg-video-preview","",{},"xgvideo-preview"),t.root.appendChild(this.videoPreview),this.videothumbnail=n.createThumbnail(this.videoPreview,"xgvideo-thumbnail"))}else util$2.addClass(this.root,"short-line no-thumbnail")}}},{key:"calcuPosition",value:function(e,t){var r=this.player.plugins.progress,n=this.player,i=r.root.getBoundingClientRect().width,a=n.duration/i*6;return e+t>n.duration&&(t=n.duration-e),n.duration,n.duration,{left:e/n.duration*100,width:t/n.duration*100,isMini:t<a}}},{key:"showDot",value:function(e){var t=this.findDot(e);if(t){var r=this.root.getBoundingClientRect().width,n=t.time/this.player.duration*r;this.updatePosition(n,r,t.time)}}},{key:"focusDot",value:function(e,t){e&&(t||(t=e.getAttribute("data-id")),util$2.addClass(e,"active"),this._activeDotId=t)}},{key:"blurDot",value:function(e){if(!e){var t=this._activeDotId;e=this.getDotDom(t)}e&&(util$2.removeClass(e,"active"),this._activeDotId=null)}},{key:"showTips",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";util$2.addClass(this.root,"no-timepoint"),e&&(util$2.addClass(this.find(".xg-spot-content"),"show-text"),t&&"production"===this.config.mode?(util$2.addClass(this.root,"product"),this.tipText.textContent=e):(util$2.removeClass(this.root,"product"),this.tipText.textContent=this._hasThumnail?e:"".concat(r," ").concat(e)))}},{key:"hideTips",value:function(){util$2.removeClass(this.root,"no-timepoint"),this.tipText.textContent="",util$2.removeClass(this.find(".xg-spot-content"),"show-text"),util$2.removeClass(this.root,"product")}},{key:"hide",value:function(){util$2.addClass(this.root,"hide")}},{key:"show",value:function(){util$2.removeClass(this.root,"hide")}},{key:"destroy",value:function(){var e=this,t=this.player.plugins.progress;t&&Object.keys(CALLBACK_MAP).map((function(r){t.removeCallBack(r,e[CALLBACK_MAP[r]])})),this.videothumbnail=null,this.thumbnail=null,this.videoPreview&&this.player.root.removeChild(this.videoPreview),this.unbind(".xg-spot-info","mousemove",this.onMousemove),this.unbind(".xg-spot-info","mousedown",this.onMousedown),this.unbind(".xg-spot-content","mouseup",this.handlerPreviewClick)}},{key:"render",value:function(){return"mobile"===sniffer$1.device||this.playerConfig.isMobileSimulateMode?"":'<div class="xg-spot-info '.concat("short"===this.config.mode?"short-line":"",'">\n      <div class="xg-spot-content">\n        <div class="xg-spot-thumbnail">\n          <span class="xg-spot-time"></span>\n        </div>\n        <div class="xg-spot-text"><span class="spot-inner-text"></span></div>\n      </div>\n      <div class="xgplayer-progress-point">00:00</div>\n      <div class="xg-spot-line"></div>\n    </div>')}}],[{key:"pluginName",get:function(){return"progresspreview"}},{key:"defaultConfig",get:function(){return{index:1,miniWidth:6,ispots:[],defaultText:"",isFocusDots:!0,isShowThumbnail:!0,isShowCoverPreview:!1,mode:""}}}]),r}(Plugin),Thumbnail=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(e){var n;return _classCallCheck$7(this,r),(n=t.call(this,e)).ratio=1,n.interval=-1,n.preloadMark={},n}return _createClass$8(r,[{key:"afterCreate",value:function(){var e=this;this.usable&&this.initThumbnail(),this.on([DURATION_CHANGE],(function(){var t=e.config,r=t.pic_num,n=t.interval;e.usable&&(e.interval=n>0?n:Math.round(1e3*e.player.duration/r)/1e3)}))}},{key:"usable",get:function(){var e=this.config,t=e.urls,r=e.pic_num;return t&&t.length>0&&r>0}},{key:"initThumbnail",value:function(){var e=this.config,t=e.width,r=e.height,n=e.pic_num,i=e.interval;this.ratio=t/r*100,this.interval=i>0?i:Math.round(1e3*this.player.duration/n)/1e3,this.preload(0)}},{key:"getUrlByIndex",value:function(e){return e>=0&&e<this.config.urls.length?this.config.urls[e]:""}},{key:"preload",value:function(e){var t=this,r=this.config.urls,n=r.length;[e-1,e,e+1,e+2].map((function(e){!t.preloadMark[e]&&e>=0&&e<n&&(util$2.preloadImg(r[e]),t.preloadMark[e]=!0)}))}},{key:"getPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.config,i=n.pic_num,a=n.row,o=n.col,s=n.width,u=n.height,c=Math.ceil(e/this.interval),l=(c=c>i?i:c)<a*o?0:Math.ceil(c/(a*o))-1,d=c-l*(o*a),h=d>0?Math.ceil(d/o)-1:0,f=d>0?d-h*o-1:0,p=0,g=0;if(t&&r){var y=t/r;y<s/u?g=(p=t)/(s/u):p=(g=r)*(s/u)}else g=(p=t||s)/(s/u);var m=this.getUrlByIndex(l);return{urlIndex:l,rowIndex:h,colIndex:f,url:m,height:g,width:p,style:{backgroundImage:"url(".concat(m,")"),backgroundSize:"".concat(p*o,"px auto"),backgroundPosition:"-".concat(f*p,"px -").concat(h*g,"px"),width:"".concat(p,"px"),height:"".concat(g,"px")}}}},{key:"update",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=this.config,o=a.pic_num,s=a.urls;if(!(o<1)&&s&&0!==s.length){var u=this.getPosition(t,r,n);this.preload(u.urlIndex),Object.keys(u.style).map((function(t){e.style[t]=u.style[t]})),Object.keys(i).map((function(t){e.style[t]=i[t]}))}}},{key:"changeConfig",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.keys(t).forEach((function(r){void 0!==e.config[r]&&(e.config[r]=t[r])})),this.usable&&this.initThumbnail()}},{key:"createThumbnail",value:function(e,t){var r=util$2.createDom("xg-thumbnail","",{},"thumbnail ".concat(t));return e&&e.appendChild(r),r}}],[{key:"pluginName",get:function(){return"thumbnail"}},{key:"defaultConfig",get:function(){return{isShow:!1,urls:[],pic_num:0,col:0,row:0,width:160,height:90,scale:1,className:"",hidePortrait:!1}}}]),r}(Plugin),MiniProgress=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){return _classCallCheck$7(this,r),t.apply(this,arguments)}return _createClass$8(r,[{key:"afterCreate",value:function(){}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cached:0,played:0},t=arguments.length>1?arguments[1]:void 0;t&&this.root&&(e.cached&&(this.find("xg-mini-progress-cache").style.width="".concat(e.cached/t*100,"%")),e.played&&(this.find("xg-mini-progress-played").style.width="".concat(e.played/t*100,"%")))}},{key:"render",value:function(){if(this.playerConfig.progress&&this.playerConfig.miniprogress)return'<xg-mini-progress class="xg-mini-progress">\n    <xg-mini-progress-cache class="xg-mini-progress-cache"></xg-mini-progress-cache>\n    <xg-mini-progress-played class="xg-mini-progress-played"></xg-mini-progress-played>\n    </xg-mini-progress>'}}],[{key:"pluginName",get:function(){return"MiniProgress"}},{key:"defaultConfig",get:function(){return{}}}]),r}(Plugin),MODES={REAL_TIME:"realtime",FIRST_FRAME:"firstframe",FRAME_RATE:"framerate"};function nowTime$1(){try{return window.performance.now()}catch(e){return(new Date).getTime()}}function checkVideoIsSupport(e){return"safari"!==sniffer$1.browser||!/^blob/.test(e.currentSrc)&&!/^blob/.test(e.src)}function checkIsSupportCanvas(){try{return!!document.createElement("canvas").getContext}catch(e){return!1}}var isSupportCanvas=null,DynamicBg=function(t){_inherits$7(n,t);var r=_createSuper$t(n);function n(){var e;_classCallCheck$7(this,n);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return _defineProperty$8(_assertThisInitialized$7(e=r.call.apply(r,[this].concat(i))),"onLoadedData",(function(){if(e.player){var t=e.player.video;e.videoPI=parseInt(t.videoWidth/t.videoHeight*100,10)}})),_defineProperty$8(_assertThisInitialized$7(e),"start",(function(){var t=e.player.video,r=nowTime$1();checkVideoIsSupport(t)&&e.canvasCtx&&(e.stop(),(e.config.mode===MODES.REAL_TIME||r-e.preTime>=e.interval)&&(t&&t.videoWidth&&e.update(t,t.videoWidth,t.videoHeight),e.preTime=r),e.frameId=window.setTimeout((function(){e.start()}),e.interval))})),_defineProperty$8(_assertThisInitialized$7(e),"stop",(function(){e.frameId&&(window.clearTimeout(e.frameId),e.frameId=null)})),e}return _createClass$8(n,[{key:"afterCreate",value:function(){var e=this;!0===this.playerConfig.dynamicBg&&(this.config.disable=!1),n.isSupport||(this.config.disable=!0);var t=this.config,r=t.disable,i=t.mode;r||(this._pos={width:0,height:0,rwidth:0,rheight:0,x:0,y:0},this.isStart=!1,this.videoPI=0,this.preTime=0,this.interval=parseInt(1e3/this.config.frameRate,10),this.canvas=null,this.canvasCtx=null,this.once(COMPLETE,(function(){e.player&&(e.init(),!e.player.paused&&e.start())})),this.once(LOADED_DATA,this.onLoadedData),this.on(URL_CHANGE,(function(){e.once(LOADED_DATA,e.onLoadedData)})),i!==MODES.FIRST_FRAME&&(this.on(PLAY,(function(){e.start()})),this.on(PAUSE,(function(){e.stop()}))),i===MODES.FIRST_FRAME&&this.once(TIME_UPDATE,(function(){var t=e.player.video;t&&checkVideoIsSupport(t)&&t.videoWidth&&e.update(t,t.videoWidth,t.videoHeight)})))}},{key:"init",value:function(){var t=this.player,r=this.config;this.canvasFilter=n.supportCanvasFilter();try{var i=this.config.isInnerRender&&t.innerContainer||t.root;i.insertAdjacentHTML("afterbegin",'<div class="xgplayer-dynamic-bg"><canvas>\n        </canvas><xgmask></xgmask></div>'),this.root=i.children[0],this.canvas=this.find("canvas"),this.canvasFilter||(this.canvas.style.filter=r.filter,this.canvas.style.webkitFilter=r.filter),this.mask=this.find("xgmask"),r.addMask&&(this.mask.style.background=r.maskBg),this.canvasCtx=this.canvas.getContext("2d");var a=this.playerConfig.poster;if(a){var o="String"===util$2.typeOf(a)?a:"String"===util$2.typeOf(a.poster)?a.poster:null;this.updateImg(o)}}catch(e){XG_DEBUG.logError("plugin:DynamicBg",e)}}},{key:"updateImg",value:function(e){var t=this;if(e){var r=this.canvas.getBoundingClientRect(),n=r.width,i=r.height,a=new window.Image;a.onload=function(){t.canvas&&(t.canvas.height=i,t.canvas.width=n,a=null)},a.src=e}}},{key:"update",value:function(t,r,n){if(this.canvas&&this.canvasCtx&&this.videoPI)try{var i=this._pos,a=this.config,o=this.canvas.getBoundingClientRect(),s=o.width,u=o.height;if(this.videoPI=parseInt(r/n*100,10),s!==i.width||u!==i.height){var c=parseInt(s/u*100,10);i.width=this.canvas.width=s,i.height=this.canvas.height=u;var l=u,d=s;c<this.videoPI?d=parseInt(u*this.videoPI/100,10):c>this.videoPI&&(l=parseInt(100*s/this.videoPI,10)),c<this.videoPI?d=parseInt(u*this.videoPI/100,10):c>this.videoPI&&(l=parseInt(100*s/this.videoPI,10)),i.rwidth=1.2*d,i.rheight=1.2*l,i.x=(s-i.rwidth)/2,i.y=(u-i.rheight)/2}this.canvasFilter&&(this.canvasCtx.filter=a.filter),this.canvasCtx.drawImage(t,i.x,i.y,i.rwidth,i.rheight)}catch(e){XG_DEBUG.logError("plugin:DynamicBg",e)}}},{key:"destroy",value:function(){this.stop(),this.canvasCtx=null,this.canvas=null}},{key:"render",value:function(){return""}}],[{key:"pluginName",get:function(){return"dynamicBg"}},{key:"defaultConfig",get:function(){return{isInnerRender:!1,disable:!0,mode:"framerate",frameRate:10,filter:"blur(50px)",addMask:!0,maskBg:"rgba(0,0,0,0.7)"}}},{key:"isSupport",get:function(){return"boolean"==typeof isSupportCanvas?isSupportCanvas:isSupportCanvas=checkIsSupportCanvas()}},{key:"supportCanvasFilter",value:function(){return!("safari"===sniffer$1.browser||"firefox"===sniffer$1.browser)}}]),n}(Plugin),ZH={LANG:"zh-cn",TEXT:{ERROR_TYPES:{network:{code:1,msg:"è§†é¢‘ä¸‹è½½é”™è¯¯"},mse:{code:2,msg:"æµè¿½åŠ é”™è¯¯"},parse:{code:3,msg:"è§£æžé”™è¯¯"},format:{code:4,msg:"æ ¼å¼é”™è¯¯"},decoder:{code:5,msg:"è§£ç é”™è¯¯"},runtime:{code:6,msg:"è¯­æ³•é”™è¯¯"},timeout:{code:7,msg:"æ’­æ”¾è¶…æ—¶"},other:{code:8,msg:"å…¶ä»–é”™è¯¯"}},HAVE_NOTHING:"æ²¡æœ‰å…³äºŽéŸ³é¢‘/è§†é¢‘æ˜¯å¦å°±ç»ªçš„ä¿¡æ¯",HAVE_METADATA:"éŸ³é¢‘/è§†é¢‘çš„å…ƒæ•°æ®å·²å°±ç»ª",HAVE_CURRENT_DATA:"å…³äºŽå½“å‰æ’­æ”¾ä½ç½®çš„æ•°æ®æ˜¯å¯ç”¨çš„ï¼Œä½†æ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®æ¥æ’­æ”¾ä¸‹ä¸€å¸§/æ¯«ç§’",HAVE_FUTURE_DATA:"å½“å‰åŠè‡³å°‘ä¸‹ä¸€å¸§çš„æ•°æ®æ˜¯å¯ç”¨çš„",HAVE_ENOUGH_DATA:"å¯ç”¨æ•°æ®è¶³ä»¥å¼€å§‹æ’­æ”¾",NETWORK_EMPTY:"éŸ³é¢‘/è§†é¢‘å°šæœªåˆå§‹åŒ–",NETWORK_IDLE:"éŸ³é¢‘/è§†é¢‘æ˜¯æ´»åŠ¨çš„ä¸”å·²é€‰å–èµ„æºï¼Œä½†å¹¶æœªä½¿ç”¨ç½‘ç»œ",NETWORK_LOADING:"æµè§ˆå™¨æ­£åœ¨ä¸‹è½½æ•°æ®",NETWORK_NO_SOURCE:"æœªæ‰¾åˆ°éŸ³é¢‘/è§†é¢‘æ¥æº",MEDIA_ERR_ABORTED:"å–å›žè¿‡ç¨‹è¢«ç”¨æˆ·ä¸­æ­¢",MEDIA_ERR_NETWORK:"ç½‘ç»œé”™è¯¯",MEDIA_ERR_DECODE:"è§£ç é”™è¯¯",MEDIA_ERR_SRC_NOT_SUPPORTED:"ä¸æ”¯æŒçš„éŸ³é¢‘/è§†é¢‘æ ¼å¼",REPLAY:"é‡æ’­",ERROR:"ç½‘ç»œè¿žæŽ¥ä¼¼ä¹Žå‡ºçŽ°äº†é—®é¢˜",PLAY_TIPS:"æ’­æ”¾",PAUSE_TIPS:"æš‚åœ",PLAYNEXT_TIPS:"ä¸‹ä¸€é›†",DOWNLOAD_TIPS:"ä¸‹è½½",ROTATE_TIPS:"æ—‹è½¬",RELOAD_TIPS:"é‡æ–°è½½å…¥",FULLSCREEN_TIPS:"è¿›å…¥å…¨å±",EXITFULLSCREEN_TIPS:"é€€å‡ºå…¨å±",CSSFULLSCREEN_TIPS:"è¿›å…¥æ ·å¼å…¨å±",EXITCSSFULLSCREEN_TIPS:"é€€å‡ºæ ·å¼å…¨å±",TEXTTRACK:"å­—å¹•",PIP:"ç”»ä¸­ç”»",SCREENSHOT:"æˆªå›¾",LIVE:"æ­£åœ¨ç›´æ’­",OFF:"å…³é—­",OPEN:"å¼€å¯",MINI_DRAG:"ç‚¹å‡»æŒ‰ä½å¯æ‹–åŠ¨è§†é¢‘",MINISCREEN:"å°å±å¹•",REFRESH_TIPS:"è¯·è¯•è¯•",REFRESH:"åˆ·æ–°",FORWARD:"å¿«è¿›ä¸­",LIVE_TIP:"ç›´æ’­"}},$$_=_export,getBuiltIn$9=getBuiltIn$j,apply$5=functionApply,call$9=functionCall,uncurryThis$z=functionUncurryThis,fails$x=fails$10,isArray$3=isArray$8,isCallable$6=isCallable$v,isObject$j=isObject$y,isSymbol$2=isSymbol$6,arraySlice$7=arraySlice$c,NATIVE_SYMBOL$4=symbolConstructorDetection,$stringify=getBuiltIn$9("JSON","stringify"),exec$6=uncurryThis$z(/./.exec),charAt$7=uncurryThis$z("".charAt),charCodeAt$3=uncurryThis$z("".charCodeAt),replace$6=uncurryThis$z("".replace),numberToString$2=uncurryThis$z(1..toString),tester=/[\uD800-\uDFFF]/g,low=/^[\uD800-\uDBFF]$/,hi=/^[\uDC00-\uDFFF]$/,WRONG_SYMBOLS_CONVERSION=!NATIVE_SYMBOL$4||fails$x((function(){var e=getBuiltIn$9("Symbol")();return"[null]"!=$stringify([e])||"{}"!=$stringify({a:e})||"{}"!=$stringify(Object(e))})),ILL_FORMED_UNICODE=fails$x((function(){return'"\\udf06\\ud834"'!==$stringify("\udf06\ud834")||'"\\udead"'!==$stringify("\udead")})),stringifyWithSymbolsFix=function(e,t){var r=arraySlice$7(arguments),n=t;if((isObject$j(t)||void 0!==e)&&!isSymbol$2(e))return isArray$3(t)||(t=function(e,t){if(isCallable$6(n)&&(t=call$9(n,this,e,t)),!isSymbol$2(t))return t}),r[1]=t,apply$5($stringify,null,r)},fixIllFormed=function(e,t,r){var n=charAt$7(r,t-1),i=charAt$7(r,t+1);return exec$6(low,e)&&!exec$6(hi,i)||exec$6(hi,e)&&!exec$6(low,n)?"\\u"+numberToString$2(charCodeAt$3(e,0),16):e};$stringify&&$$_({target:"JSON",stat:!0,arity:3,forced:WRONG_SYMBOLS_CONVERSION||ILL_FORMED_UNICODE},{stringify:function(e,t,r){var n=arraySlice$7(arguments),i=apply$5(WRONG_SYMBOLS_CONVERSION?stringifyWithSymbolsFix:$stringify,null,n);return ILL_FORMED_UNICODE&&"string"==typeof i?replace$6(i,tester,fixIllFormed):i}});var fails$w=fails$10,wellKnownSymbol$7=wellKnownSymbol$u,IS_PURE=isPure,ITERATOR$4=wellKnownSymbol$7("iterator"),urlConstructorDetection=!fails$w((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),IS_PURE&&!e.toJSON||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[ITERATOR$4]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://Ñ‚ÐµÑÑ‚").host||"#%D0%B1"!==new URL("http://a#Ð±").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host})),anObject$7=anObject$p,iteratorClose=iteratorClose$2,callWithSafeIterationClosing$1=function(e,t,r,n){try{return n?t(anObject$7(r)[0],r[1]):t(r)}catch(error){iteratorClose(e,"throw",error)}},bind$8=functionBindContext,call$8=functionCall,toObject$a=toObject$k,callWithSafeIterationClosing=callWithSafeIterationClosing$1,isArrayIteratorMethod$1=isArrayIteratorMethod$3,isConstructor=isConstructor$4,lengthOfArrayLike$e=lengthOfArrayLike$n,createProperty$1=createProperty$6,getIterator$2=getIterator$4,getIteratorMethod$2=getIteratorMethod$5,$Array$2=Array,arrayFrom$1=function(e){var t=toObject$a(e),r=isConstructor(this),n=arguments.length,i=n>1?arguments[1]:void 0,a=void 0!==i;a&&(i=bind$8(i,n>2?arguments[2]:void 0));var o,s,u,c,l,d,h=getIteratorMethod$2(t),f=0;if(!h||this===$Array$2&&isArrayIteratorMethod$1(h))for(o=lengthOfArrayLike$e(t),s=r?new this(o):$Array$2(o);o>f;f++)d=a?i(t[f],f):t[f],createProperty$1(s,f,d);else for(l=(c=getIterator$2(t,h)).next,s=r?new this:[];!(u=call$8(l,c)).done;f++)d=a?callWithSafeIterationClosing(c,i,[u.value,f],!0):u.value,createProperty$1(s,f,d);return s.length=f,s},uncurryThis$y=functionUncurryThis,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexNonASCII=/[^\0-\u007E]/,regexSeparators=/[.\u3002\uFF0E\uFF61]/g,OVERFLOW_ERROR="Overflow: input needs wider integers to process",baseMinusTMin=base-tMin,$RangeError$4=RangeError,exec$5=uncurryThis$y(regexSeparators.exec),floor$5=Math.floor,fromCharCode$2=String.fromCharCode,charCodeAt$2=uncurryThis$y("".charCodeAt),join$4=uncurryThis$y([].join),push$6=uncurryThis$y([].push),replace$5=uncurryThis$y("".replace),split$2=uncurryThis$y("".split),toLowerCase$1=uncurryThis$y("".toLowerCase),ucs2decode=function(e){for(var t=[],r=0,n=e.length;r<n;){var i=charCodeAt$2(e,r++);if(i>=55296&&i<=56319&&r<n){var a=charCodeAt$2(e,r++);56320==(64512&a)?push$6(t,((1023&i)<<10)+(1023&a)+65536):(push$6(t,i),r--)}else push$6(t,i)}return t},digitToBasic=function(e){return e+22+75*(e<26)},adapt=function(e,t,r){var n=0;for(e=r?floor$5(e/damp):e>>1,e+=floor$5(e/t);e>baseMinusTMin*tMax>>1;)e=floor$5(e/baseMinusTMin),n+=base;return floor$5(n+(baseMinusTMin+1)*e/(e+skew))},encode$4=function(e){var t,r,n=[],i=(e=ucs2decode(e)).length,a=initialN,o=0,s=initialBias;for(t=0;t<e.length;t++)(r=e[t])<128&&push$6(n,fromCharCode$2(r));var u=n.length,c=u;for(u&&push$6(n,delimiter);c<i;){var l=maxInt;for(t=0;t<e.length;t++)(r=e[t])>=a&&r<l&&(l=r);var d=c+1;if(l-a>floor$5((maxInt-o)/d))throw $RangeError$4(OVERFLOW_ERROR);for(o+=(l-a)*d,a=l,t=0;t<e.length;t++){if((r=e[t])<a&&++o>maxInt)throw $RangeError$4(OVERFLOW_ERROR);if(r==a){for(var h=o,f=base;;){var p=f<=s?tMin:f>=s+tMax?tMax:f-s;if(h<p)break;var g=h-p,y=base-p;push$6(n,fromCharCode$2(digitToBasic(p+g%y))),h=floor$5(g/y),f+=base}push$6(n,fromCharCode$2(digitToBasic(h))),s=adapt(o,d,c==u),o=0,c++}}o++,a++}return join$4(n,"")},stringPunycodeToAscii=function(e){var t,r,n=[],i=split$2(replace$5(toLowerCase$1(e),regexSeparators,"."),".");for(t=0;t<i.length;t++)r=i[t],push$6(n,exec$5(regexNonASCII,r)?"xn--"+encode$4(r):r);return join$4(n,".")},defineBuiltIn$a=defineBuiltIn$l,defineBuiltIns$3=function(e,t,r){for(var n in t)defineBuiltIn$a(e,n,t[n],r);return e},$$Z=_export,global$o=global$O,call$7=functionCall,uncurryThis$x=functionUncurryThis,DESCRIPTORS$g=descriptors,USE_NATIVE_URL$1=urlConstructorDetection,defineBuiltIn$9=defineBuiltIn$l,defineBuiltIns$2=defineBuiltIns$3,setToStringTag$5=setToStringTag$9,createIteratorConstructor=iteratorCreateConstructor,InternalStateModule$7=internalState,anInstance$7=anInstance$9,isCallable$5=isCallable$v,hasOwn$d=hasOwnProperty_1,bind$7=functionBindContext,classof$6=classof$h,anObject$6=anObject$p,isObject$i=isObject$y,$toString$2=toString$v,create$6=objectCreate$1,createPropertyDescriptor$4=createPropertyDescriptor$a,getIterator$1=getIterator$4,getIteratorMethod$1=getIteratorMethod$5,validateArgumentsLength$4=validateArgumentsLength$6,wellKnownSymbol$6=wellKnownSymbol$u,arraySort=arraySort$1,ITERATOR$3=wellKnownSymbol$6("iterator"),URL_SEARCH_PARAMS="URLSearchParams",URL_SEARCH_PARAMS_ITERATOR=URL_SEARCH_PARAMS+"Iterator",setInternalState$6=InternalStateModule$7.set,getInternalParamsState=InternalStateModule$7.getterFor(URL_SEARCH_PARAMS),getInternalIteratorState=InternalStateModule$7.getterFor(URL_SEARCH_PARAMS_ITERATOR),getOwnPropertyDescriptor$1=Object.getOwnPropertyDescriptor,safeGetBuiltIn=function(e){if(!DESCRIPTORS$g)return global$o[e];var t=getOwnPropertyDescriptor$1(global$o,e);return t&&t.value},nativeFetch=safeGetBuiltIn("fetch"),NativeRequest=safeGetBuiltIn("Request"),Headers$1=safeGetBuiltIn("Headers"),RequestPrototype=NativeRequest&&NativeRequest.prototype,HeadersPrototype=Headers$1&&Headers$1.prototype,RegExp$2=global$o.RegExp,TypeError$4=global$o.TypeError,decodeURIComponent$1=global$o.decodeURIComponent,encodeURIComponent$1=global$o.encodeURIComponent,charAt$6=uncurryThis$x("".charAt),join$3=uncurryThis$x([].join),push$5=uncurryThis$x([].push),replace$4=uncurryThis$x("".replace),shift$1=uncurryThis$x([].shift),splice=uncurryThis$x([].splice),split$1=uncurryThis$x("".split),stringSlice$6=uncurryThis$x("".slice),plus=/\+/g,sequences=Array(4),percentSequence=function(e){return sequences[e-1]||(sequences[e-1]=RegExp$2("((?:%[\\da-f]{2}){"+e+"})","gi"))},percentDecode=function(e){try{return decodeURIComponent$1(e)}catch(error){return e}},deserialize=function(e){var t=replace$4(e,plus," "),r=4;try{return decodeURIComponent$1(t)}catch(error){for(;r;)t=replace$4(t,percentSequence(r--),percentDecode);return t}},find=/[!'()~]|%20/g,replacements={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},replacer=function(e){return replacements[e]},_serialize=function(e){return replace$4(encodeURIComponent$1(e),find,replacer)},URLSearchParamsIterator=createIteratorConstructor((function(e,t){setInternalState$6(this,{type:URL_SEARCH_PARAMS_ITERATOR,iterator:getIterator$1(getInternalParamsState(e).entries),kind:t})}),"Iterator",(function(){var e=getInternalIteratorState(this),t=e.kind,r=e.iterator.next(),n=r.value;return r.done||(r.value="keys"===t?n.key:"values"===t?n.value:[n.key,n.value]),r}),!0),URLSearchParamsState=function(e){this.entries=[],this.url=null,void 0!==e&&(isObject$i(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===charAt$6(e,0)?stringSlice$6(e,1):e:$toString$2(e)))};URLSearchParamsState.prototype={type:URL_SEARCH_PARAMS,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,n,i,a,o,s,u=getIteratorMethod$1(e);if(u)for(r=(t=getIterator$1(e,u)).next;!(n=call$7(r,t)).done;){if(a=(i=getIterator$1(anObject$6(n.value))).next,(o=call$7(a,i)).done||(s=call$7(a,i)).done||!call$7(a,i).done)throw TypeError$4("Expected sequence with length 2");push$5(this.entries,{key:$toString$2(o.value),value:$toString$2(s.value)})}else for(var c in e)hasOwn$d(e,c)&&push$5(this.entries,{key:c,value:$toString$2(e[c])})},parseQuery:function(e){if(e)for(var t,r,n=split$1(e,"&"),i=0;i<n.length;)(t=n[i++]).length&&(r=split$1(t,"="),push$5(this.entries,{key:deserialize(shift$1(r)),value:deserialize(join$3(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],n=0;n<t.length;)e=t[n++],push$5(r,_serialize(e.key)+"="+_serialize(e.value));return join$3(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var URLSearchParamsConstructor=function(){anInstance$7(this,URLSearchParamsPrototype);var e=arguments.length>0?arguments[0]:void 0;setInternalState$6(this,new URLSearchParamsState(e))},URLSearchParamsPrototype=URLSearchParamsConstructor.prototype;if(defineBuiltIns$2(URLSearchParamsPrototype,{append:function(e,t){validateArgumentsLength$4(arguments.length,2);var r=getInternalParamsState(this);push$5(r.entries,{key:$toString$2(e),value:$toString$2(t)}),r.updateURL()},delete:function(e){validateArgumentsLength$4(arguments.length,1);for(var t=getInternalParamsState(this),r=t.entries,n=$toString$2(e),i=0;i<r.length;)r[i].key===n?splice(r,i,1):i++;t.updateURL()},get:function(e){validateArgumentsLength$4(arguments.length,1);for(var t=getInternalParamsState(this).entries,r=$toString$2(e),n=0;n<t.length;n++)if(t[n].key===r)return t[n].value;return null},getAll:function(e){validateArgumentsLength$4(arguments.length,1);for(var t=getInternalParamsState(this).entries,r=$toString$2(e),n=[],i=0;i<t.length;i++)t[i].key===r&&push$5(n,t[i].value);return n},has:function(e){validateArgumentsLength$4(arguments.length,1);for(var t=getInternalParamsState(this).entries,r=$toString$2(e),n=0;n<t.length;)if(t[n++].key===r)return!0;return!1},set:function(e,t){validateArgumentsLength$4(arguments.length,1);for(var r,n=getInternalParamsState(this),i=n.entries,a=!1,o=$toString$2(e),s=$toString$2(t),u=0;u<i.length;u++)(r=i[u]).key===o&&(a?splice(i,u--,1):(a=!0,r.value=s));a||push$5(i,{key:o,value:s}),n.updateURL()},sort:function(){var e=getInternalParamsState(this);arraySort(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,r=getInternalParamsState(this).entries,n=bind$7(e,arguments.length>1?arguments[1]:void 0),i=0;i<r.length;)n((t=r[i++]).value,t.key,this)},keys:function(){return new URLSearchParamsIterator(this,"keys")},values:function(){return new URLSearchParamsIterator(this,"values")},entries:function(){return new URLSearchParamsIterator(this,"entries")}},{enumerable:!0}),defineBuiltIn$9(URLSearchParamsPrototype,ITERATOR$3,URLSearchParamsPrototype.entries,{name:"entries"}),defineBuiltIn$9(URLSearchParamsPrototype,"toString",(function(){return getInternalParamsState(this).serialize()}),{enumerable:!0}),setToStringTag$5(URLSearchParamsConstructor,URL_SEARCH_PARAMS),$$Z({global:!0,constructor:!0,forced:!USE_NATIVE_URL$1},{URLSearchParams:URLSearchParamsConstructor}),!USE_NATIVE_URL$1&&isCallable$5(Headers$1)){var headersHas=uncurryThis$x(HeadersPrototype.has),headersSet=uncurryThis$x(HeadersPrototype.set),wrapRequestOptions=function(e){if(isObject$i(e)){var t,r=e.body;if(classof$6(r)===URL_SEARCH_PARAMS)return t=e.headers?new Headers$1(e.headers):new Headers$1,headersHas(t,"content-type")||headersSet(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),create$6(e,{body:createPropertyDescriptor$4(0,$toString$2(r)),headers:createPropertyDescriptor$4(0,t)})}return e};if(isCallable$5(nativeFetch)&&$$Z({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return nativeFetch(e,arguments.length>1?wrapRequestOptions(arguments[1]):{})}}),isCallable$5(NativeRequest)){var RequestConstructor=function(e){return anInstance$7(this,RequestPrototype),new NativeRequest(e,arguments.length>1?wrapRequestOptions(arguments[1]):{})};RequestPrototype.constructor=RequestConstructor,RequestConstructor.prototype=RequestPrototype,$$Z({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:RequestConstructor})}}var web_urlSearchParams_constructor={URLSearchParams:URLSearchParamsConstructor,getState:getInternalParamsState},$$Y=_export,DESCRIPTORS$f=descriptors,USE_NATIVE_URL=urlConstructorDetection,global$n=global$O,bind$6=functionBindContext,uncurryThis$w=functionUncurryThis,defineBuiltIn$8=defineBuiltIn$l,defineBuiltInAccessor$2=defineBuiltInAccessor$5,anInstance$6=anInstance$9,hasOwn$c=hasOwnProperty_1,assign$3=objectAssign,arrayFrom=arrayFrom$1,arraySlice$6=arraySliceSimple,codeAt=stringMultibyte.codeAt,toASCII=stringPunycodeToAscii,$toString$1=toString$v,setToStringTag$4=setToStringTag$9,validateArgumentsLength$3=validateArgumentsLength$6,URLSearchParamsModule=web_urlSearchParams_constructor,InternalStateModule$6=internalState,setInternalState$5=InternalStateModule$6.set,getInternalURLState=InternalStateModule$6.getterFor("URL"),URLSearchParams$1=URLSearchParamsModule.URLSearchParams,getInternalSearchParamsState=URLSearchParamsModule.getState,NativeURL=global$n.URL,TypeError$3=global$n.TypeError,parseInt$1=global$n.parseInt,floor$4=Math.floor,pow$2=Math.pow,charAt$5=uncurryThis$w("".charAt),exec$4=uncurryThis$w(/./.exec),join$2=uncurryThis$w([].join),numberToString$1=uncurryThis$w(1..toString),pop=uncurryThis$w([].pop),push$4=uncurryThis$w([].push),replace$3=uncurryThis$w("".replace),shift=uncurryThis$w([].shift),split=uncurryThis$w("".split),stringSlice$5=uncurryThis$w("".slice),toLowerCase=uncurryThis$w("".toLowerCase),unshift=uncurryThis$w([].unshift),INVALID_AUTHORITY="Invalid authority",INVALID_SCHEME="Invalid scheme",INVALID_HOST="Invalid host",INVALID_PORT="Invalid port",ALPHA=/[a-z]/i,ALPHANUMERIC=/[\d+-.a-z]/i,DIGIT=/\d/,HEX_START=/^0x/i,OCT=/^[0-7]+$/,DEC=/^\d+$/,HEX=/^[\da-f]+$/i,FORBIDDEN_HOST_CODE_POINT=/[\0\t\n\r #%/:<>?@[\\\]^|]/,FORBIDDEN_HOST_CODE_POINT_EXCLUDING_PERCENT=/[\0\t\n\r #/:<>?@[\\\]^|]/,LEADING_AND_TRAILING_C0_CONTROL_OR_SPACE=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,TAB_AND_NEW_LINE=/[\t\n\r]/g,EOF,parseIPv4=function(e){var t,r,n,i,a,o,s,u=split(e,".");if(u.length&&""==u[u.length-1]&&u.length--,(t=u.length)>4)return e;for(r=[],n=0;n<t;n++){if(""==(i=u[n]))return e;if(a=10,i.length>1&&"0"==charAt$5(i,0)&&(a=exec$4(HEX_START,i)?16:8,i=stringSlice$5(i,8==a?1:2)),""===i)o=0;else{if(!exec$4(10==a?DEC:8==a?OCT:HEX,i))return e;o=parseInt$1(i,a)}push$4(r,o)}for(n=0;n<t;n++)if(o=r[n],n==t-1){if(o>=pow$2(256,5-t))return null}else if(o>255)return null;for(s=pop(r),n=0;n<r.length;n++)s+=r[n]*pow$2(256,3-n);return s},parseIPv6=function(e){var t,r,n,i,a,o,s,u=[0,0,0,0,0,0,0,0],c=0,l=null,d=0,h=function(){return charAt$5(e,d)};if(":"==h()){if(":"!=charAt$5(e,1))return;d+=2,l=++c}for(;h();){if(8==c)return;if(":"!=h()){for(t=r=0;r<4&&exec$4(HEX,h());)t=16*t+parseInt$1(h(),16),d++,r++;if("."==h()){if(0==r)return;if(d-=r,c>6)return;for(n=0;h();){if(i=null,n>0){if(!("."==h()&&n<4))return;d++}if(!exec$4(DIGIT,h()))return;for(;exec$4(DIGIT,h());){if(a=parseInt$1(h(),10),null===i)i=a;else{if(0==i)return;i=10*i+a}if(i>255)return;d++}u[c]=256*u[c]+i,2!=++n&&4!=n||c++}if(4!=n)return;break}if(":"==h()){if(d++,!h())return}else if(h())return;u[c++]=t}else{if(null!==l)return;d++,l=++c}}if(null!==l)for(o=c-l,c=7;0!=c&&o>0;)s=u[c],u[c--]=u[l+o-1],u[l+--o]=s;else if(8!=c)return;return u},findLongestZeroSequence=function(e){for(var t=null,r=1,n=null,i=0,a=0;a<8;a++)0!==e[a]?(i>r&&(t=n,r=i),n=null,i=0):(null===n&&(n=a),++i);return i>r&&(t=n,r=i),t},serializeHost=function(e){var t,r,n,i;if("number"==typeof e){for(t=[],r=0;r<4;r++)unshift(t,e%256),e=floor$4(e/256);return join$2(t,".")}if("object"==_typeof$7(e)){for(t="",n=findLongestZeroSequence(e),r=0;r<8;r++)i&&0===e[r]||(i&&(i=!1),n===r?(t+=r?":":"::",i=!0):(t+=numberToString$1(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},C0ControlPercentEncodeSet={},fragmentPercentEncodeSet=assign$3({},C0ControlPercentEncodeSet,{" ":1,'"':1,"<":1,">":1,"`":1}),pathPercentEncodeSet=assign$3({},fragmentPercentEncodeSet,{"#":1,"?":1,"{":1,"}":1}),userinfoPercentEncodeSet=assign$3({},pathPercentEncodeSet,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),percentEncode=function(e,t){var r=codeAt(e,0);return r>32&&r<127&&!hasOwn$c(t,e)?e:encodeURIComponent(e)},specialSchemes={ftp:21,file:null,http:80,https:443,ws:80,wss:443},isWindowsDriveLetter=function(e,t){var r;return 2==e.length&&exec$4(ALPHA,charAt$5(e,0))&&(":"==(r=charAt$5(e,1))||!t&&"|"==r)},startsWithWindowsDriveLetter=function(e){var t;return e.length>1&&isWindowsDriveLetter(stringSlice$5(e,0,2))&&(2==e.length||"/"===(t=charAt$5(e,2))||"\\"===t||"?"===t||"#"===t)},isSingleDot=function(e){return"."===e||"%2e"===toLowerCase(e)},isDoubleDot=function(e){return".."===(e=toLowerCase(e))||"%2e."===e||".%2e"===e||"%2e%2e"===e},SCHEME_START={},SCHEME={},NO_SCHEME={},SPECIAL_RELATIVE_OR_AUTHORITY={},PATH_OR_AUTHORITY={},RELATIVE={},RELATIVE_SLASH={},SPECIAL_AUTHORITY_SLASHES={},SPECIAL_AUTHORITY_IGNORE_SLASHES={},AUTHORITY={},HOST={},HOSTNAME={},PORT={},FILE={},FILE_SLASH={},FILE_HOST={},PATH_START={},PATH={},CANNOT_BE_A_BASE_URL_PATH={},QUERY={},FRAGMENT={},URLState=function e(t,r,n){var i,a,o,s=$toString$1(t);if(r){if(a=this.parse(s))throw TypeError$3(a);this.searchParams=null}else{if(void 0!==n&&(i=new e(n,!0)),a=this.parse(s,null,i))throw TypeError$3(a);(o=getInternalSearchParamsState(new URLSearchParams$1)).bindURL(this),this.searchParams=o}};URLState.prototype={type:"URL",parse:function(e,t,r){var n,i,a,o,s=this,u=t||SCHEME_START,c=0,l="",d=!1,h=!1,f=!1;for(e=$toString$1(e),t||(s.scheme="",s.username="",s.password="",s.host=null,s.port=null,s.path=[],s.query=null,s.fragment=null,s.cannotBeABaseURL=!1,e=replace$3(e,LEADING_AND_TRAILING_C0_CONTROL_OR_SPACE,"")),e=replace$3(e,TAB_AND_NEW_LINE,""),n=arrayFrom(e);c<=n.length;){switch(i=n[c],u){case SCHEME_START:if(!i||!exec$4(ALPHA,i)){if(t)return INVALID_SCHEME;u=NO_SCHEME;continue}l+=toLowerCase(i),u=SCHEME;break;case SCHEME:if(i&&(exec$4(ALPHANUMERIC,i)||"+"==i||"-"==i||"."==i))l+=toLowerCase(i);else{if(":"!=i){if(t)return INVALID_SCHEME;l="",u=NO_SCHEME,c=0;continue}if(t&&(s.isSpecial()!=hasOwn$c(specialSchemes,l)||"file"==l&&(s.includesCredentials()||null!==s.port)||"file"==s.scheme&&!s.host))return;if(s.scheme=l,t)return void(s.isSpecial()&&specialSchemes[s.scheme]==s.port&&(s.port=null));l="","file"==s.scheme?u=FILE:s.isSpecial()&&r&&r.scheme==s.scheme?u=SPECIAL_RELATIVE_OR_AUTHORITY:s.isSpecial()?u=SPECIAL_AUTHORITY_SLASHES:"/"==n[c+1]?(u=PATH_OR_AUTHORITY,c++):(s.cannotBeABaseURL=!0,push$4(s.path,""),u=CANNOT_BE_A_BASE_URL_PATH)}break;case NO_SCHEME:if(!r||r.cannotBeABaseURL&&"#"!=i)return INVALID_SCHEME;if(r.cannotBeABaseURL&&"#"==i){s.scheme=r.scheme,s.path=arraySlice$6(r.path),s.query=r.query,s.fragment="",s.cannotBeABaseURL=!0,u=FRAGMENT;break}u="file"==r.scheme?FILE:RELATIVE;continue;case SPECIAL_RELATIVE_OR_AUTHORITY:if("/"!=i||"/"!=n[c+1]){u=RELATIVE;continue}u=SPECIAL_AUTHORITY_IGNORE_SLASHES,c++;break;case PATH_OR_AUTHORITY:if("/"==i){u=AUTHORITY;break}u=PATH;continue;case RELATIVE:if(s.scheme=r.scheme,i==EOF)s.username=r.username,s.password=r.password,s.host=r.host,s.port=r.port,s.path=arraySlice$6(r.path),s.query=r.query;else if("/"==i||"\\"==i&&s.isSpecial())u=RELATIVE_SLASH;else if("?"==i)s.username=r.username,s.password=r.password,s.host=r.host,s.port=r.port,s.path=arraySlice$6(r.path),s.query="",u=QUERY;else{if("#"!=i){s.username=r.username,s.password=r.password,s.host=r.host,s.port=r.port,s.path=arraySlice$6(r.path),s.path.length--,u=PATH;continue}s.username=r.username,s.password=r.password,s.host=r.host,s.port=r.port,s.path=arraySlice$6(r.path),s.query=r.query,s.fragment="",u=FRAGMENT}break;case RELATIVE_SLASH:if(!s.isSpecial()||"/"!=i&&"\\"!=i){if("/"!=i){s.username=r.username,s.password=r.password,s.host=r.host,s.port=r.port,u=PATH;continue}u=AUTHORITY}else u=SPECIAL_AUTHORITY_IGNORE_SLASHES;break;case SPECIAL_AUTHORITY_SLASHES:if(u=SPECIAL_AUTHORITY_IGNORE_SLASHES,"/"!=i||"/"!=charAt$5(l,c+1))continue;c++;break;case SPECIAL_AUTHORITY_IGNORE_SLASHES:if("/"!=i&&"\\"!=i){u=AUTHORITY;continue}break;case AUTHORITY:if("@"==i){d&&(l="%40"+l),d=!0,a=arrayFrom(l);for(var p=0;p<a.length;p++){var g=a[p];if(":"!=g||f){var y=percentEncode(g,userinfoPercentEncodeSet);f?s.password+=y:s.username+=y}else f=!0}l=""}else if(i==EOF||"/"==i||"?"==i||"#"==i||"\\"==i&&s.isSpecial()){if(d&&""==l)return INVALID_AUTHORITY;c-=arrayFrom(l).length+1,l="",u=HOST}else l+=i;break;case HOST:case HOSTNAME:if(t&&"file"==s.scheme){u=FILE_HOST;continue}if(":"!=i||h){if(i==EOF||"/"==i||"?"==i||"#"==i||"\\"==i&&s.isSpecial()){if(s.isSpecial()&&""==l)return INVALID_HOST;if(t&&""==l&&(s.includesCredentials()||null!==s.port))return;if(o=s.parseHost(l))return o;if(l="",u=PATH_START,t)return;continue}"["==i?h=!0:"]"==i&&(h=!1),l+=i}else{if(""==l)return INVALID_HOST;if(o=s.parseHost(l))return o;if(l="",u=PORT,t==HOSTNAME)return}break;case PORT:if(!exec$4(DIGIT,i)){if(i==EOF||"/"==i||"?"==i||"#"==i||"\\"==i&&s.isSpecial()||t){if(""!=l){var m=parseInt$1(l,10);if(m>65535)return INVALID_PORT;s.port=s.isSpecial()&&m===specialSchemes[s.scheme]?null:m,l=""}if(t)return;u=PATH_START;continue}return INVALID_PORT}l+=i;break;case FILE:if(s.scheme="file","/"==i||"\\"==i)u=FILE_SLASH;else{if(!r||"file"!=r.scheme){u=PATH;continue}if(i==EOF)s.host=r.host,s.path=arraySlice$6(r.path),s.query=r.query;else if("?"==i)s.host=r.host,s.path=arraySlice$6(r.path),s.query="",u=QUERY;else{if("#"!=i){startsWithWindowsDriveLetter(join$2(arraySlice$6(n,c),""))||(s.host=r.host,s.path=arraySlice$6(r.path),s.shortenPath()),u=PATH;continue}s.host=r.host,s.path=arraySlice$6(r.path),s.query=r.query,s.fragment="",u=FRAGMENT}}break;case FILE_SLASH:if("/"==i||"\\"==i){u=FILE_HOST;break}r&&"file"==r.scheme&&!startsWithWindowsDriveLetter(join$2(arraySlice$6(n,c),""))&&(isWindowsDriveLetter(r.path[0],!0)?push$4(s.path,r.path[0]):s.host=r.host),u=PATH;continue;case FILE_HOST:if(i==EOF||"/"==i||"\\"==i||"?"==i||"#"==i){if(!t&&isWindowsDriveLetter(l))u=PATH;else if(""==l){if(s.host="",t)return;u=PATH_START}else{if(o=s.parseHost(l))return o;if("localhost"==s.host&&(s.host=""),t)return;l="",u=PATH_START}continue}l+=i;break;case PATH_START:if(s.isSpecial()){if(u=PATH,"/"!=i&&"\\"!=i)continue}else if(t||"?"!=i)if(t||"#"!=i){if(i!=EOF&&(u=PATH,"/"!=i))continue}else s.fragment="",u=FRAGMENT;else s.query="",u=QUERY;break;case PATH:if(i==EOF||"/"==i||"\\"==i&&s.isSpecial()||!t&&("?"==i||"#"==i)){if(isDoubleDot(l)?(s.shortenPath(),"/"==i||"\\"==i&&s.isSpecial()||push$4(s.path,"")):isSingleDot(l)?"/"==i||"\\"==i&&s.isSpecial()||push$4(s.path,""):("file"==s.scheme&&!s.path.length&&isWindowsDriveLetter(l)&&(s.host&&(s.host=""),l=charAt$5(l,0)+":"),push$4(s.path,l)),l="","file"==s.scheme&&(i==EOF||"?"==i||"#"==i))for(;s.path.length>1&&""===s.path[0];)shift(s.path);"?"==i?(s.query="",u=QUERY):"#"==i&&(s.fragment="",u=FRAGMENT)}else l+=percentEncode(i,pathPercentEncodeSet);break;case CANNOT_BE_A_BASE_URL_PATH:"?"==i?(s.query="",u=QUERY):"#"==i?(s.fragment="",u=FRAGMENT):i!=EOF&&(s.path[0]+=percentEncode(i,C0ControlPercentEncodeSet));break;case QUERY:t||"#"!=i?i!=EOF&&("'"==i&&s.isSpecial()?s.query+="%27":s.query+="#"==i?"%23":percentEncode(i,C0ControlPercentEncodeSet)):(s.fragment="",u=FRAGMENT);break;case FRAGMENT:i!=EOF&&(s.fragment+=percentEncode(i,fragmentPercentEncodeSet))}c++}},parseHost:function(e){var t,r,n;if("["==charAt$5(e,0)){if("]"!=charAt$5(e,e.length-1))return INVALID_HOST;if(!(t=parseIPv6(stringSlice$5(e,1,-1))))return INVALID_HOST;this.host=t}else if(this.isSpecial()){if(e=toASCII(e),exec$4(FORBIDDEN_HOST_CODE_POINT,e))return INVALID_HOST;if(null===(t=parseIPv4(e)))return INVALID_HOST;this.host=t}else{if(exec$4(FORBIDDEN_HOST_CODE_POINT_EXCLUDING_PERCENT,e))return INVALID_HOST;for(t="",r=arrayFrom(e),n=0;n<r.length;n++)t+=percentEncode(r[n],C0ControlPercentEncodeSet);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return hasOwn$c(specialSchemes,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&isWindowsDriveLetter(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,n=e.password,i=e.host,a=e.port,o=e.path,s=e.query,u=e.fragment,c=t+":";return null!==i?(c+="//",e.includesCredentials()&&(c+=r+(n?":"+n:"")+"@"),c+=serializeHost(i),null!==a&&(c+=":"+a)):"file"==t&&(c+="//"),c+=e.cannotBeABaseURL?o[0]:o.length?"/"+join$2(o,"/"):"",null!==s&&(c+="?"+s),null!==u&&(c+="#"+u),c},setHref:function(e){var t=this.parse(e);if(t)throw TypeError$3(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new URLConstructor(e.path[0]).origin}catch(error){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+serializeHost(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse($toString$1(e)+":",SCHEME_START)},getUsername:function(){return this.username},setUsername:function(e){var t=arrayFrom($toString$1(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=percentEncode(t[r],userinfoPercentEncodeSet)}},getPassword:function(){return this.password},setPassword:function(e){var t=arrayFrom($toString$1(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=percentEncode(t[r],userinfoPercentEncodeSet)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?serializeHost(e):serializeHost(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,HOST)},getHostname:function(){var e=this.host;return null===e?"":serializeHost(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,HOSTNAME)},getPort:function(){var e=this.port;return null===e?"":$toString$1(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=$toString$1(e))?this.port=null:this.parse(e,PORT))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+join$2(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,PATH_START))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=$toString$1(e))?this.query=null:("?"==charAt$5(e,0)&&(e=stringSlice$5(e,1)),this.query="",this.parse(e,QUERY)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=$toString$1(e))?("#"==charAt$5(e,0)&&(e=stringSlice$5(e,1)),this.fragment="",this.parse(e,FRAGMENT)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var URLConstructor=function(e){var t=anInstance$6(this,URLPrototype),r=validateArgumentsLength$3(arguments.length,1)>1?arguments[1]:void 0,n=setInternalState$5(t,new URLState(e,!1,r));DESCRIPTORS$f||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},URLPrototype=URLConstructor.prototype,accessorDescriptor=function(e,t){return{get:function(){return getInternalURLState(this)[e]()},set:t&&function(e){return getInternalURLState(this)[t](e)},configurable:!0,enumerable:!0}};if(DESCRIPTORS$f&&(defineBuiltInAccessor$2(URLPrototype,"href",accessorDescriptor("serialize","setHref")),defineBuiltInAccessor$2(URLPrototype,"origin",accessorDescriptor("getOrigin")),defineBuiltInAccessor$2(URLPrototype,"protocol",accessorDescriptor("getProtocol","setProtocol")),defineBuiltInAccessor$2(URLPrototype,"username",accessorDescriptor("getUsername","setUsername")),defineBuiltInAccessor$2(URLPrototype,"password",accessorDescriptor("getPassword","setPassword")),defineBuiltInAccessor$2(URLPrototype,"host",accessorDescriptor("getHost","setHost")),defineBuiltInAccessor$2(URLPrototype,"hostname",accessorDescriptor("getHostname","setHostname")),defineBuiltInAccessor$2(URLPrototype,"port",accessorDescriptor("getPort","setPort")),defineBuiltInAccessor$2(URLPrototype,"pathname",accessorDescriptor("getPathname","setPathname")),defineBuiltInAccessor$2(URLPrototype,"search",accessorDescriptor("getSearch","setSearch")),defineBuiltInAccessor$2(URLPrototype,"searchParams",accessorDescriptor("getSearchParams")),defineBuiltInAccessor$2(URLPrototype,"hash",accessorDescriptor("getHash","setHash"))),defineBuiltIn$8(URLPrototype,"toJSON",(function(){return getInternalURLState(this).serialize()}),{enumerable:!0}),defineBuiltIn$8(URLPrototype,"toString",(function(){return getInternalURLState(this).serialize()}),{enumerable:!0}),NativeURL){var nativeCreateObjectURL=NativeURL.createObjectURL,nativeRevokeObjectURL=NativeURL.revokeObjectURL;nativeCreateObjectURL&&defineBuiltIn$8(URLConstructor,"createObjectURL",bind$6(nativeCreateObjectURL,NativeURL)),nativeRevokeObjectURL&&defineBuiltIn$8(URLConstructor,"revokeObjectURL",bind$6(nativeRevokeObjectURL,NativeURL))}setToStringTag$4(URLConstructor,"URL"),$$Y({global:!0,constructor:!0,forced:!USE_NATIVE_URL,sham:!DESCRIPTORS$f},{URL:URLConstructor});var INFO="info",STATS_EVENTS$1=STATS_EVENTS$2,Stats$2=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){var e;_classCallCheck$7(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$8(_assertThisInitialized$7(e=t.call.apply(t,[this].concat(i))),"_recordUserActions",(function(t){var r=e._getTime(),n=Object.assign({},t,{msg:t.msg||t.action});e._stats[INFO].push(_objectSpread2$6(_objectSpread2$6({type:"userAction"},r),{},{payload:n}))})),_defineProperty$8(_assertThisInitialized$7(e),"_onReset",(function(){e.reset()})),_defineProperty$8(_assertThisInitialized$7(e),"_recordInfo",(function(t){e.info(t)})),_defineProperty$8(_assertThisInitialized$7(e),"_downloadStats",(function(){var t=e.getStats(),r=new Blob([JSON.stringify(t)],{type:"application/json"}),n=window.URL.createObjectURL(r),i=document.createElement("a");i.style.display="none",i.href=n,console.log("linkhref",n),i.download="player.txt",i.disabled=!1,i.click()})),e}return _createClass$8(r,[{key:"_getTime",value:function(){return{timestamp:Date.now(),timeFormat:(new Date).toISOString()}}},{key:"afterCreate",value:function(){this.reset(),this.on(USER_ACTION,this._recordUserActions),this.on(STATS_EVENTS$1.STATS_INFO,this._recordInfo),this.on(STATS_EVENTS$1.STATS_DOWNLOAD,this._downloadStats),this.on(STATS_EVENTS$1.STATS_RESET,this._onReset)}},{key:"destroy",value:function(){this.offAll()}},{key:"downloadStats",value:function(){this._downloadStats()}},{key:"info",value:function(e){e.profile?this._infoProfile(e):this._info(e)}},{key:"_info",value:function(e){var t=this._getTime();this._stats[INFO].push(_objectSpread2$6(_objectSpread2$6({},t),{},{payload:e}))}},{key:"_infoProfile",value:function(e){if(e&&e.startMs){var t=_objectSpread2$6({cat:"function",dur:Date.now()-e.startMs,name:e.name||e.msg,ph:"X",pid:0,tid:0,ts:e.startMs,profile:!0},e);this._info(t)}else console.warn("infoProfile need object data, include startMs")}},{key:"reset",value:function(){var e;this._stats=(_defineProperty$8(e={},INFO,[]),_defineProperty$8(e,"media",{}),e)}},{key:"getStats",value:function(){for(var e=this.player.video,t=[],r=0;r<e.buffered.length;r++)t.push({start:e.buffered.start(r),end:e.buffered.end(r)});var n={currentTime:e.currentTime,readyState:e.readyState,buffered:t,paused:e.paused,ended:e.ended};return this._stats.media=n,{raw:this._stats,timestat:this._getTimeStats(),profile:this._getProfile()}}},{key:"_getTimeStats",value:function(){return this._stats[INFO].map((function(e){var t=e.payload.data,r="";try{t instanceof Error?r=t.msg:void 0!==t&&(r=JSON.stringify(t))}catch(error){console.log("err",error)}return"[".concat(e.timeFormat,"] : ").concat(e.payload.msg," ").concat(r," ")}))}},{key:"_getProfile",value:function(){var e={traceEvents:[]};return this._stats[INFO].forEach((function(t){t.payload.profile&&e.traceEvents.push(t.payload)})),e}}],[{key:"pluginName",get:function(){return"stats"}},{key:"defaultConfig",get:function(){return{}}}]),r}(BasePlugin),DefaultPreset$3=_createClass$8((function e(t,r){var n,i,a;_classCallCheck$7(this,e);var o=r&&r.isMobileSimulateMode,s=r.isLive,u=[].concat(s?[]:[Progress,MiniProgress,ProgressPreview,Time],[Play,Fullscreen,Rotate,PlayNextIcon,DefinitionIcon,PlaybackRate,Download,ScreenShot,Volume,PIP]),c=[Replay,Poster,Start,Loading,Enter,ErrorPlugin$1,Prompt,Thumbnail,MiniScreen];this.plugins=[Stats$2,Xglogger].concat(_toConsumableArray$2(u),c);var l=o?"mobile":sniffer$1.device;switch(l){case"pc":(n=this.plugins).push.apply(n,[Keyboard,PCPlugin,CssFullScreen]);break;case"mobile":(i=this.plugins).push.apply(i,[MobilePlugin]);break;default:(a=this.plugins).push.apply(a,[Keyboard,PCPlugin,CssFullScreen])}(sniffer$1.os.isIpad||"pc"===l)&&this.plugins.push(DynamicBg),sniffer$1.os.isIpad&&this.plugins.push(PCPlugin),this.ignores=[],this.i18n=[ZH]})),PresetPlayer=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){return _classCallCheck$7(this,r),t.apply(this,arguments)}return _createClass$8(r)}(Player);_defineProperty$8(PresetPlayer,"defaultPreset",DefaultPreset$3),_defineProperty$8(PresetPlayer,"Util",util$2),_defineProperty$8(PresetPlayer,"Sniffer",sniffer$1),_defineProperty$8(PresetPlayer,"Errors",Errors$1),_defineProperty$8(PresetPlayer,"Events",Events$1),_defineProperty$8(PresetPlayer,"Plugin",Plugin),_defineProperty$8(PresetPlayer,"BasePlugin",BasePlugin),_defineProperty$8(PresetPlayer,"I18N",I18N),_defineProperty$8(PresetPlayer,"STATE_CLASS",STATE_CLASS);var DefaultPreset$2=_createClass$8((function e(t,r){var n,i,a;_classCallCheck$7(this,e);var o=r&&r.isMobileSimulateMode,s=r.isLive,u=[].concat(s?[]:[Progress,MiniProgress,ProgressPreview,Time],[Play,Fullscreen,Rotate,PlayNextIcon,DefinitionIcon,PlaybackRate,Download,ScreenShot,Volume,PIP]),c=[Replay,Poster,Start,Loading,Enter,ErrorPlugin$1,Prompt,Thumbnail,MiniScreen];this.plugins=[Stats$2,Xglogger].concat(_toConsumableArray$2(u),c);var l=o?"mobile":sniffer$1.device;switch(l){case"pc":(n=this.plugins).push.apply(n,[Keyboard,PCPlugin,CssFullScreen]);break;case"mobile":(i=this.plugins).push.apply(i,[MobilePlugin]);break;default:(a=this.plugins).push.apply(a,[Keyboard,PCPlugin,CssFullScreen])}(sniffer$1.os.isIpad||"pc"===l)&&this.plugins.push(DynamicBg),this.ignores=[],this.i18n=[]})),DefaultPreset$1=_createClass$8((function e(){var t,r;_classCallCheck$7(this,e);var n=[Play,Fullscreen,Time,Volume,Rotate,DefinitionIcon,PlaybackRate,CssFullScreen,PIP];switch(this.plugins=[Poster,Start,Loading,Enter,ErrorPlugin$1].concat(n),sniffer$1.device){case"pc":(t=this.plugins).push.apply(t,[Keyboard,PCPlugin]);break;case"mobile":this.plugins.push(MobilePlugin);break;default:(r=this.plugins).push.apply(r,[Keyboard,PCPlugin])}this.ignores=[],this.i18n=[ZH]})),DefaultPreset=_createClass$8((function e(){_classCallCheck$7(this,e);var t=[MobilePlugin,Progress,Play,Fullscreen,Time,Rotate,PlayNextIcon,DefinitionIcon,PlaybackRate,Download,ScreenShot,Volume,PIP],r=[Replay,Poster,Start,Loading,Enter,ErrorPlugin$1,Prompt,Thumbnail,MiniProgress];this.plugins=[Xglogger].concat(t,r),this.ignores=[],this.i18n=[ZH]})),zhHk={LANG:"zh-hk",TEXT:{ERROR_TYPES:{network:{code:1,msg:"è¦–é »ä¸‹è¼‰éŒ¯èª¤"},mse:{code:2,msg:"åŠ‰è¿½åŠ éŒ¯èª¤"},parse:{code:3,msg:"è§£æžéŒ¯èª¤"},format:{code:4,msg:"æ ¼å¼éŒ¯èª¤"},decoder:{code:5,msg:"è§£ç¢¼éŒ¯èª¤"},runtime:{code:6,msg:"èªžæ³•éŒ¯èª¤"},timeout:{code:7,msg:"æ’­æ”¾è¶…æ™‚"},other:{code:8,msg:"å…¶ä»–éŒ¯èª¤"}},HAVE_NOTHING:"æ²’æœ‰é—œæ–¼éŸ³é »/è¦–é »æ˜¯å¦å°±ç·’çš„ä¿¡æ¯",HAVE_METADATA:"éŸ³é »/è¦–é »çš„å…ƒæ•¸æ“šå·²å°±ç·’",HAVE_CURRENT_DATA:"é—œæ–¼ç•¶å‰æ’­æ”¾ä½ç½®çš„æ•¸æ“šæ˜¯å¯ç”¨çš„ï¼Œä½†æ²’æœ‰è¶³å¤ çš„æ•¸æ“šä¾†æ’­æ”¾ä¸‹å£¹å¹€/æ¯«ç§’",HAVE_FUTURE_DATA:"ç•¶å‰åŠè‡³å°‘ä¸‹å£¹å¹€çš„æ•¸æ“šæ˜¯å¯ç”¨çš„",HAVE_ENOUGH_DATA:"å¯ç”¨æ•¸æ“šè¶³ä»¥é–‹å§‹æ’­æ”¾",NETWORK_EMPTY:"éŸ³é »/è¦–é »å°šæœªåˆå§‹åŒ–",NETWORK_IDLE:"éŸ³é »/è¦–é »æ˜¯æ´»å‹•çš„ä¸”å·²é¸å–è³‡æºï¼Œä½†ä¸¦æœªä½¿ç”¨ç¶²çµ¡",NETWORK_LOADING:"ç€è¦½å™¨æ­£åœ¨ä¸‹è¼‰æ•¸æ“š",NETWORK_NO_SOURCE:"æœªæ‰¾åˆ°éŸ³é »/è¦–é »ä¾†æº",MEDIA_ERR_ABORTED:"å–å›žéŽç¨‹è¢«ç”¨æˆ¶ä¸­æ­¢",MEDIA_ERR_NETWORK:"ä¸‹è¼‰éŒ¯èª¤",MEDIA_ERR_DECODE:"è§£ç¢¼éŒ¯èª¤",MEDIA_ERR_SRC_NOT_SUPPORTED:"ä¸æ”¯æŒçš„éŸ³é »/è¦–é »æ ¼å¼",REPLAY:"é‡æ’­",ERROR:"ç¶²çµ¡é€£æŽ¥ä¼¼ä¹Žå‡ºç¾äº†å•é¡Œ",PLAY_TIPS:"æ’­æ”¾",PAUSE_TIPS:"æš«åœ",PLAYNEXT_TIPS:"ä¸‹å£¹é›†",DOWNLOAD_TIPS:"ä¸‹è¼‰",ROTATE_TIPS:"æ—‹è½‰",RELOAD_TIPS:"é‡æ–°è¼‰å…¥",FULLSCREEN_TIPS:"é€²å…¥å…¨å±",EXITFULLSCREEN_TIPS:"é€€å‡ºå…¨å±",CSSFULLSCREEN_TIPS:"é€²å…¥æ¨£å¼å…¨å±",EXITCSSFULLSCREEN_TIPS:"é€€å‡ºæ¨£å¼å…¨å±",TEXTTRACK:"å­—å¹•",PIP:"ç•«ä¸­ç•«",SCREENSHOT:"æˆªåœ–",LIVE:"æ­£åœ¨ç›´æ’­",OFF:"é—œé–‰",OPEN:"é–‹å•Ÿ",MINI_DRAG:"é»žæ“ŠæŒ‰ä½å¯æ‹–å‹•è¦–é »",MINISCREEN:"å°å±å¹•",REFRESH_TIPS:"è«‹è©¦è©¦",REFRESH:"åˆ·æ–°",FORWARD:"å¿«è¿›ä¸­",LIVE_TIP:"ç›´æ’­"}},jp$1={LANG:"jp",TEXT:{ERROR_TYPES:{network:{code:1,msg:"ãƒ“ãƒ‡ã‚ªãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼"},mse:{code:2,msg:"ã‚¹ãƒˆãƒªãƒ¼ãƒ è¿½åŠ ã‚¨ãƒ©ãƒ¼"},parse:{code:3,msg:"è§£æžã‚¨ãƒ©ãƒ¼"},format:{code:4,msg:"é–“é•ã£ãŸãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆ"},decoder:{code:5,msg:"ãƒ‡ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼"},runtime:{code:6,msg:"æ–‡æ³•ã‚¨ãƒ©ãƒ¼"},timeout:{code:7,msg:"å†ç”Ÿã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ"},other:{code:8,msg:"ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼"}},HAVE_NOTHING:"ã‚ªãƒ¼ãƒ‡ã‚£ã‚ª/ãƒ“ãƒ‡ã‚ªãŒæº–å‚™ã§ãã¦ã„ã‚‹ã‹æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“",HAVE_METADATA:"ã‚ªãƒ¼ãƒ‡ã‚£ã‚ª/ãƒ“ãƒ‡ã‚ªã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¯æº–å‚™ã§ãã¦ã„ã¾ã™",HAVE_CURRENT_DATA:"ç¾åœ¨ã®å†ç”Ÿä½ç½®ã«é–¢ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯åˆ©ç”¨å¯èƒ½ã§ã™ãŒã€æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ /ãƒŸãƒªç§’ã‚’å†ç”Ÿã™ã‚‹ã®ã«ååˆ†ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“",HAVE_FUTURE_DATA:"ç¾åœ¨ã€å°‘ãªãã¨ã‚‚æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã®ãƒ‡ãƒ¼ã‚¿ãŒåˆ©ç”¨å¯èƒ½ã§ã™",HAVE_ENOUGH_DATA:"åˆ©ç”¨å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã¯å†ç”Ÿã‚’é–‹å§‹ã™ã‚‹ã®ã«ååˆ†ã§ã™",NETWORK_EMPTY:"ã‚ªãƒ¼ãƒ‡ã‚£ã‚ª/ãƒ“ãƒ‡ã‚ªãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“",NETWORK_IDLE:"ã‚ªãƒ¼ãƒ‡ã‚£ã‚ª/ãƒ“ãƒ‡ã‚ªã¯ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã§ãƒªã‚½ãƒ¼ã‚¹ãŒé¸æŠžã•ã‚Œã¦ã„ã¾ã™ãŒã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã›ã‚“",NETWORK_LOADING:"ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã¯ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã¾ã™",NETWORK_NO_SOURCE:"ã‚ªãƒ¼ãƒ‡ã‚£ã‚ª/ãƒ“ãƒ‡ã‚ª ã®ã‚½ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",MEDIA_ERR_ABORTED:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦ãƒ•ã‚§ãƒƒãƒãƒ—ãƒ­ã‚»ã‚¹ãŒä¸­æ­¢ã•ã‚Œã¾ã—ãŸ",MEDIA_ERR_NETWORK:"ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ",MEDIA_ERR_DECODE:"ãƒ‡ã‚³ãƒ¼ãƒ‰ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ",MEDIA_ERR_SRC_NOT_SUPPORTED:"ã‚ªãƒ¼ãƒ‡ã‚£ã‚ª/ãƒ“ãƒ‡ã‚ª ã®å½¢å¼ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“",REPLAY:"ãƒªãƒ—ãƒ¬ã‚¤",ERROR:"ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æŽ¥ç¶šã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸ",PLAY_TIPS:"ãƒ—ãƒ¬ã‚¤",PAUSE_TIPS:"ä¸€æ™‚åœæ­¢",PLAYNEXT_TIPS:"æ¬¡ã‚’ãƒ—ãƒ¬ã‚¤",DOWNLOAD_TIPS:"ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",ROTATE_TIPS:"å›žè»¢",RELOAD_TIPS:"å†èª­ã¿è¾¼ã¿",FULLSCREEN_TIPS:"ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³",EXITFULLSCREEN_TIPS:"ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚’çµ‚äº†",CSSFULLSCREEN_TIPS:"ã‚·ã‚¢ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰",EXITCSSFULLSCREEN_TIPS:"ã‚·ã‚¢ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚’çµ‚äº†",TEXTTRACK:"å­—å¹•",PIP:"ãƒŸãƒ‹ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼",SCREENSHOT:"ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ",LIVE:"ç”Ÿæ”¾é€",OFF:"ã‚ªãƒ•",OPEN:"é–‹ã„ãŸ",MINI_DRAG:"ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦åƒç”»ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã™ã‚‹",MINISCREEN:"å°ã•ãªç”»é¢",REFRESH:"ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥",REFRESH_TIPS:"ã—ã¦ã¿ã¦ãã ã•ã„",FORWARD:"æ—©é€ã‚Š",LIVE_TIP:"ç”Ÿæ”¾é€"}},dist$3={exports:{}};!function(e,t){window,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==_typeof$7(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(e,t,r){function n(e,t){return e.classList?Array.prototype.some.call(e.classList,(function(e){return e===t})):!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function i(e,t){e.classList?t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(t){t&&e.classList.add(t)})):n(e,t)||(e.className+=" "+t)}function a(e,t){e.classList?t.split(/\s+/g).forEach((function(t){e.classList.remove(t)})):n(e,t)&&t.split(/\s+/g).forEach((function(t){var r=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(r," ")}))}function o(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]}Object.defineProperty(t,"__esModule",{value:!0}),t.createDom=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=document.createElement(e);return i.className=n,i.innerHTML=t,Object.keys(r).forEach((function(t){var n=t,a=r[t];"video"===e||"audio"===e?a&&i.setAttribute(n,a):i.setAttribute(n,a)})),i},t.hasClass=n,t.addClass=i,t.removeClass=a,t.toggleClass=function(e,t){t.split(/\s+/g).forEach((function(t){n(e,t)?a(e,t):i(e,t)}))},t.findDom=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,t=arguments[1],r=void 0;try{r=e.querySelector(t)}catch(n){t.startsWith("#")&&(r=e.getElementById(t.slice(1)))}return r},t.deepCopy=function e(t,r){if("Object"===o(r)&&"Object"===o(t))return Object.keys(r).forEach((function(n){"Object"!==o(r[n])||r[n]instanceof Node?"Array"===o(r[n])?t[n]="Array"===o(t[n])?t[n].concat(r[n]):r[n]:t[n]=r[n]:t[n]?e(t[n],r[n]):t[n]=r[n]})),t},t.typeOf=o,t.copyDom=function(e){if(e&&1===e.nodeType){var t=document.createElement(e.tagName);return Array.prototype.forEach.call(e.attributes,(function(e){t.setAttribute(e.name,e.value)})),e.innerHTML&&(t.innerHTML=e.innerHTML),t}return""},t.attachEventListener=function(e,t,r,n){var i,a,o,s;n?(e.on(t,r),a=t,o=r,s=n,(i=e).once(s,(function e(){i.off(a,o),i.off(s,e)}))):e.on(t,(function n(i){r(i),e.off(t,n)}))},t.styleUtil=function(e,t,r){var n=e.style;try{n[t]=r}catch(i){n.setProperty(t,r)}},t.isNumber=function(e){return"number"==typeof e&&!Number.isNaN(e)},t.throttle=function(e,t){var r=this,n=0;return function(){for(var i=arguments.length,a=Array(i),o=0;o<i;o++)a[o]=arguments[o];clearTimeout(n),n=setTimeout((function(){return e.apply(r,a)}),t)}},t.hasOwnProperty=Object.prototype.hasOwnProperty},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(n=r(26))&&n.__esModule?n:{default:n},o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"setLogger",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.logger=new a.default(e+".js")}}]),e}();t.default=o,e.exports=t.default},function(e,t,r){var n=r(18)();e.exports=function(e){return e!==n&&null!==e}},function(e,t,r){e.exports=function(e){return null!=e}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=r(5))&&n.__esModule?n:{default:n};r(34),t.default=i.default,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.DanmuJs=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=d(r(6)),a=r(25),o=d(r(1)),s=d(r(27)),u=d(r(32)),c=r(33),l=r(0);function d(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$7(t)&&"function"!=typeof t?e:t}var f=t.DanmuJs=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n=r;n.setLogger("danmu"),n.logger&&n.logger.info("danmu.js version: "+a.version);var o=n.config={overlap:!1,area:{start:0,end:1,lines:void 0},live:!1,comments:[],direction:"r2l",needResizeObserver:!1,dropStaleComments:!1,channelSize:void 0,maxCommentsLength:void 0,bulletOffset:void 0,interval:2e3};if((0,l.deepCopy)(o,e),(0,i.default)(n),n.hideArr=[],n.domObj=new u.default,n.freezeId=null,o.comments.forEach((function(e){e.duration=e.duration?e.duration:5e3,e.mode||(e.mode="scroll")})),n.container=o.container&&1===o.container.nodeType?o.container:null,!n.container)return n.emit("error","container id can't be empty"),h(r,!1);if(o.containerStyle){var c=o.containerStyle;Object.keys(c).forEach((function(e){n.container.style[e]=c[e]}))}return n.live=o.live,n.player=o.player,n.direction=o.direction,(0,l.addClass)(n.container,"danmu"),n.bulletBtn=new s.default(n),n.main=n.bulletBtn.main,n.isReady=!0,n.emit("ready"),r.logger&&r.logger.info("ready"),r.addResizeObserver(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$7(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"addResizeObserver",value:function(){var e=this;this.config.needResizeObserver&&(0,c.addObserver)(this.container,(function(){e.logger&&e.logger.info("needResizeObserver"),e.resize()}))}},{key:"start",value:function(){this.logger&&this.logger.info("start"),this.main.start()}},{key:"pause",value:function(){this.logger&&this.logger.info("pause"),this.main.pause()}},{key:"play",value:function(){this.logger&&this.logger.info("play"),this.main.play()}},{key:"stop",value:function(){this.logger&&this.logger.info("stop"),this.main.stop()}},{key:"clear",value:function(){this.logger&&this.logger.info("clear"),this.main.clear()}},{key:"destroy",value:function(){for(var e in(0,c.unObserver)(this.container),this.logger&&this.logger.info("destroy"),this.stop(),this.bulletBtn.destroy(),this.domObj.destroy(),this)delete this[e];this.emit("destroy")}},{key:"sendComment",value:function(e){this.logger&&this.logger.info("sendComment: "+(e.txt||"[DOM Element]")),e.duration||(e.duration=15e3),e&&e.id&&e.duration&&(e.el||e.txt)&&(e.duration=e.duration?e.duration:5e3,e.style||(e.style={opacity:void 0,fontSize:void 0}),e.style&&(this.opacity&&this.opacity!==e.style.opacity&&(e.style.opacity=this.opacity),this.fontSize&&this.fontSize!==e.style.fontSize&&(e.style.fontSize=this.fontSize)),e.prior||e.realTime?(this.main.data.unshift(e),e.realTime&&(this.main.readData(),this.main.dataHandle())):this.main.data.push(e))}},{key:"setCommentID",value:function(e,t){var r=this;this.logger&&this.logger.info("setCommentID: oldID "+e+" newID "+t),e&&t&&(this.main.data.some((function(r){return r.id===e&&(r.id=t,!0)})),this.main.queue.some((function(n){return n.id===e&&(n.id=t,n.pauseMove(),"paused"!==r.main.status&&n.startMove(),!0)})))}},{key:"setCommentDuration",value:function(e,t){var r=this;this.logger&&this.logger.info("setCommentDuration: id "+e+" duration "+t),e&&t&&(t=t||5e3,this.main.data.some((function(r){return r.id===e&&(r.duration=t,!0)})),this.main.queue.some((function(n){return n.id===e&&(n.duration=t,n.pauseMove(),"paused"!==r.main.status&&n.startMove(),!0)})))}},{key:"setCommentLike",value:function(e,t){this.logger&&this.logger.info("setCommentLike: id "+e+" like "+t),e&&t&&(this.main.data.some((function(r){return r.id===e&&(r.like=t,!0)})),this.main.queue.some((function(r){return r.id===e&&(r.pauseMove(),r.setLikeDom(t.el,t.style),"paused"!==r.danmu.main.status&&r.startMove(),!0)})))}},{key:"restartComment",value:function(e){if(this.logger&&this.logger.info("restartComment: id "+e),e){var t=this.main;if(this._releaseCtrl(e),"closed"===t.status)return;t.queue.some((function(r){return r.id===e&&("paused"!==t.status?r.startMove(!0):r.status="paused",!0)}))}}},{key:"_releaseCtrl",value:function(e){this.freezeId&&e===this.freezeId&&(this.mouseControl=!1,this.freezeId=null)}},{key:"_freezeCtrl",value:function(e){this.mouseControl=!0,this.freezeId=e}},{key:"freezeComment",value:function(e){this.logger&&this.logger.info("freezeComment: id "+e),e&&(this._freezeCtrl(e),this.main.queue.some((function(t){return t.id===e&&(t.status="forcedPause",t.pauseMove(),t.el&&t.el.style&&(0,l.styleUtil)(t.el,"zIndex",10),!0)})))}},{key:"removeComment",value:function(e){this.logger&&this.logger.info("removeComment: id "+e),e&&(this._releaseCtrl(e),this.main.queue.some((function(t){return t.id===e&&(t.remove(),!0)})),this.main.data=this.main.data.filter((function(t){return t.id!==e})))}},{key:"updateComments",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.config,n=this.main,i=this.player,a=[],o=0;if(this.logger&&this.logger.info("updateComments: "+e.length+", isClear "+t),"boolean"==typeof t&&t&&(n.data=[]),n.data=n.data.concat(e),n.sortData(),"number"==typeof r.maxCommentsLength&&n.data.length>r.maxCommentsLength){o=n.data.length-r.maxCommentsLength;for(var s,u=0;u<o;u++)(s=n.data[u]).prior&&!s.attached_&&a.push(n.data[u])}else if(r.dropStaleComments&&i&&i.currentTime){var c=Math.floor(1e3*i.currentTime)-r.interval;if(c>0)for(var l,d=0;d<n.data.length;d++)if((l=n.data[d]).prior&&!l.attached_&&a.push(n.data[d]),l.start>c){o=d;break}o>0&&(n.data.splice(0,o),n.data=a.concat(n.data))}}},{key:"willChange",value:function(){var e=this.container,t=this.main;e.style.willChange="opacity",t.willChanges.push("contents"),t.queue.forEach((function(e){e.willChange()}))}},{key:"stopWillChange",value:function(){this.container.style.willChange="",this.main.willChanges.splice(0),this.main.queue.forEach((function(e){e.willChange()}))}},{key:"setAllDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",t=this,r=arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.logger&&this.logger.info("setAllDuration: mode "+e+" duration "+r+" force "+n),r&&(r=r||5e3,n&&(this.main.forceDuration=r),this.main.data.forEach((function(t){e===t.mode&&(t.duration=r)})),this.main.queue.forEach((function(n){e===n.mode&&(n.duration=r,n.pauseMove(),"paused"!==t.main.status&&n.startMove())})))}},{key:"setPlayRate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",r=arguments[1];this.logger&&this.logger.info("setPlayRate: "+r),(0,l.isNumber)(r)&&r>0&&(this.main.playRate=r,this.main.queue.forEach((function(r){t===r.mode&&(r.pauseMove(),"paused"!==e.main.status&&r.startMove())})))}},{key:"setOpacity",value:function(e){this.logger&&this.logger.info("setOpacity: opacity "+e),this.container.style.opacity=e}},{key:"setFontSize",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{reflow:!0};this.logger&&this.logger.info("setFontSize: size "+e+" channelSize "+t),this.fontSize=e+"px",e&&(this.main.data.forEach((function(e){e.style&&(e.style.fontSize=r.fontSize)})),this.main.queue.forEach((function(e){e.options.style||(e.options.style={}),e.options.style.fontSize=r.fontSize,e.setFontSize(r.fontSize),t&&(e.top=e.channel_id[0]*t,e.topInit())}))),t&&(this.config.channelSize=t,n.reflow&&this.main.channel.resizeSync())}},{key:"setArea",value:function(e){this.logger&&this.logger.info("setArea: area "+e),this.config.area=e,!1!==e.reflow&&this.main.channel.resizeSync()}},{key:"hide",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";this.logger&&this.logger.info("hide: mode "+e),this.hideArr.indexOf(e)<0&&this.hideArr.push(e),this.main.queue.filter((function(t){return e===t.mode||"color"===e&&t.color})).forEach((function(e){return e.remove()}))}},{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";this.logger&&this.logger.info("show: mode "+e);var t=this.hideArr.indexOf(e);t>-1&&this.hideArr.splice(t,1)}},{key:"setDirection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"r2l";this.logger&&this.logger.info("setDirection: direction "+e),this.emit("changeDirection",e)}},{key:"resize",value:function(){this.logger&&this.logger.info("resize"),this.emit("channel_resize")}},{key:"status",get:function(){return this.main.status}},{key:"state",get:function(){var e=this.main;return{status:e.status,comments:e.data,bullets:e.queue}}},{key:"containerPos",get:function(){return this.main.channel.containerPos}}]),t}(o.default);t.default=f},function(e,t,r){var n,i,a,o,s,u,c,l=r(7),d=r(24),h=Function.prototype.apply,f=Function.prototype.call,p=Object.create,g=Object.defineProperty,y=Object.defineProperties,m=Object.prototype.hasOwnProperty,v={configurable:!0,enumerable:!1,writable:!0};i=function(e,t){var r,i;return d(t),i=this,n.call(this,e,r=function(){a.call(i,e,r),h.call(t,this,arguments)}),r.__eeOnceListener__=t,this},s={on:n=function(e,t){var r;return d(t),m.call(this,"__ee__")?r=this.__ee__:(r=v.value=p(null),g(this,"__ee__",v),v.value=null),r[e]?"object"==_typeof$7(r[e])?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},once:i,off:a=function(e,t){var r,n,i,a;if(d(t),!m.call(this,"__ee__"))return this;if(!(r=this.__ee__)[e])return this;if("object"==_typeof$7(n=r[e]))for(a=0;i=n[a];++a)i!==t&&i.__eeOnceListener__!==t||(2===n.length?r[e]=n[a?0:1]:n.splice(a,1));else n!==t&&n.__eeOnceListener__!==t||delete r[e];return this},emit:o=function(e){var t,r,n,i,a;if(m.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==_typeof$7(i)){for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];for(i=i.slice(),t=0;n=i[t];++t)h.call(n,this,a)}else switch(arguments.length){case 1:f.call(i,this);break;case 2:f.call(i,this,arguments[1]);break;case 3:f.call(i,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];h.call(i,this,a)}}},u={on:l(n),once:l(i),off:l(a),emit:l(o)},c=y({},u),e.exports=t=function(e){return null==e?p(c):y(Object(e),u)},t.methods=s},function(e,t,r){var n=r(3),i=r(8),a=r(12),o=r(20),s=r(21);(e.exports=function(e,t){var r,i,u,c,l;return arguments.length<2||"string"!=typeof e?(c=t,t=e,e=null):c=arguments[2],n(e)?(r=s.call(e,"c"),i=s.call(e,"e"),u=s.call(e,"w")):(r=u=!0,i=!1),l={value:t,configurable:r,enumerable:i,writable:u},c?a(o(c),l):l}).gs=function(e,t,r){var u,c,l,d;return"string"!=typeof e?(l=r,r=t,t=e,e=null):l=arguments[3],n(t)?i(t)?n(r)?i(r)||(l=r,r=void 0):r=void 0:(l=t,t=r=void 0):t=void 0,n(e)?(u=s.call(e,"c"),c=s.call(e,"e")):(u=!0,c=!1),d={get:t,set:r,configurable:u,enumerable:c},l?a(o(l),d):d}},function(e,t,r){var n=r(9),i=/^\s*class[\s{/}]/,a=Function.prototype.toString;e.exports=function(e){return!!n(e)&&!i.test(a.call(e))}},function(e,t,r){var n=r(10);e.exports=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(t){return!1}return!n(e)}},function(e,t,r){var n=r(11);e.exports=function(e){if(!n(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(t){return!1}}},function(e,t,r){var n=r(3),i={object:!0,function:!0,undefined:!0};e.exports=function(e){return!!n(e)&&hasOwnProperty.call(i,_typeof$7(e))}},function(e,t,r){e.exports=r(13)()?Object.assign:r(14)},function(e,t,r){e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,r){var n=r(15),i=r(19),a=Math.max;e.exports=function(e,t){var r,o,s,u=a(arguments.length,2);for(e=Object(i(e)),s=function(n){try{e[n]=t[n]}catch(i){r||(r=i)}},o=1;o<u;++o)n(t=arguments[o]).forEach(s);if(void 0!==r)throw r;return e}},function(e,t,r){e.exports=r(16)()?Object.keys:r(17)},function(e,t,r){e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t,r){var n=r(2),i=Object.keys;e.exports=function(e){return i(n(e)?Object(e):e)}},function(e,t,r){e.exports=function(){}},function(e,t,r){var n=r(2);e.exports=function(e){if(!n(e))throw new TypeError("Cannot use null or undefined");return e}},function(e,t,r){var n=r(2),i=Array.prototype.forEach,a=Object.create,o=function(e,t){var r;for(r in e)t[r]=e[r]};e.exports=function(e){var t=a(null);return i.call(arguments,(function(e){n(e)&&o(Object(e),t)})),t}},function(e,t,r){e.exports=r(22)()?String.prototype.contains:r(23)},function(e,t,r){var n="razdwatrzy";e.exports=function(){return"function"==typeof n.contains&&!0===n.contains("dwa")&&!1===n.contains("foo")}},function(e,t,r){var n=String.prototype.indexOf;e.exports=function(e){return n.call(this,e,arguments[1])>-1}},function(e,t,r){e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},function(e){e.exports=JSON.parse('{"version":"1.1.2"}')},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i="undefined"!=typeof window&&window.location.href.indexOf("danmu-debug")>-1,a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.constructorName=t||""}return n(e,[{key:"info",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];i&&(t=console).log.apply(t,["[Danmu Log]["+this.constructorName+"]",e].concat(n))}}]),e}();t.default=a,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=s(r(1)),a=s(r(28)),o=r(0);function s(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$7(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.setLogger("control"),r.danmu=e,r.main=new a.default(e),e.config.defaultOff||r.main.start(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$7(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"createSwitch",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.logger&&this.logger.info("createSwitch"),this.switchBtn=(0,o.createDom)("dk-switch",'<span class="txt">å¼¹</span>',{},"danmu-switch "+(e?"danmu-switch-active":"")),this.switchBtn}},{key:"destroy",value:function(){for(var e in this.logger&&this.logger.info("destroy"),this.main.destroy(),this)o.hasOwnProperty.call(this,e)&&delete this[e]}}]),t}(i.default);t.default=u,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=u(r(1)),a=u(r(29)),o=u(r(30)),s=r(0);function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$7(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.setLogger("main"),r.danmu=e,r.container=e.container,r.channel=new o.default(e),r.data=[].concat(e.config.comments),r.playedData=[],r.queue=[],r.timer=null,r.playRate=1,r.retryStatus="normal",r.interval=e.config.interval,r.willChanges=[],r._status="idle",(0,s.attachEventListener)(e,"bullet_remove",r.updateQueue.bind(r),"destroy"),(0,s.attachEventListener)(e,"changeDirection",(function(e){r.danmu.direction=e}),"destroy"),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$7(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_cancelDataHandleTimer",value:function(){this.handleId&&(clearTimeout(this.handleId),this.handleId=null),this.handleTimer&&(clearTimeout(this.handleTimer),this.handleTimer=null)}},{key:"destroy",value:function(){for(var e in this.logger&&this.logger.info("destroy"),this._cancelDataHandleTimer(),this.channel.destroy(),this.data=[],this)delete this[e]}},{key:"updateQueue",value:function(e){this.logger&&this.logger.info("updateQueue");var t=this;t.queue.some((function(r,n){return r.id===e.bullet.id&&(t.queue.splice(n,1),!0)})),t.data.some((function(t){return t.id===e.bullet.id&&(t.attached_=!1,!0)}))}},{key:"init",value:function(){var e=this;e.logger&&e.logger.info("init"),e.retryStatus="normal",e.sortData(),function t(){"closed"!==e._status||"stop"!==e.retryStatus?("playing"===e._status&&(e.readData(),e.dataHandle()),"stop"===e.retryStatus&&"paused"!==e._status||(e.handleTimer=setTimeout((function(){e.handleId=requestAnimationFrame((function(){t()}))}),250))):e._cancelDataHandleTimer()}()}},{key:"start",value:function(){this.logger&&this.logger.info("start"),this._status="playing",this.queue=[],this.container.innerHTML="",this.channel.reset(),this.init()}},{key:"stop",value:function(){this.logger&&this.logger.info("stop"),this._status="closed",this.retryStatus="stop",this.queue=[],this.container.innerHTML="",this.channel.reset()}},{key:"clear",value:function(){this.logger&&this.logger.info("clear"),this.channel.reset(),this.data=[],this.queue=[],this.container.innerHTML=""}},{key:"play",value:function(){var e=this;if("closed"!==this._status){this.logger&&this.logger.info("play"),this._status="playing";var t=this.channel.channels;t&&t.length>0&&["scroll","top","bottom"].forEach((function(r){e.queue.forEach((function(e){e.startMove(),e.resized=!0}));for(var n=0;n<t.length;n++)t[n].queue[r].forEach((function(e){e.resized=!1}))}))}else this.logger&&this.logger.info("play ignored")}},{key:"pause",value:function(){if("closed"!==this._status){this.logger&&this.logger.info("pause"),this._status="paused";var e=this.channel.channels;e&&e.length>0&&this.queue.forEach((function(e){e.pauseMove()}))}else this.logger&&this.logger.info("pause ignored")}},{key:"dataHandle",value:function(){"paused"!==this._status&&"closed"!==this._status&&this.queue.length&&this.queue.forEach((function(e){"waiting"===e.status&&e.startMove()}))}},{key:"readData",value:function(){if(this.danmu.isReady){var e=this,t=this.danmu,r=t.player,n=e.interval,i=e.channel,o=void 0,u=void 0;if(r){var c=r.currentTime?Math.floor(1e3*r.currentTime):0;u=e.data.filter((function(t){return!t.start&&e.danmu.hideArr.indexOf(t.mode)<0&&(!t.color||e.danmu.hideArr.indexOf("color")<0)&&(t.start=c),!t.attached_&&e.danmu.hideArr.indexOf(t.mode)<0&&(!t.color||e.danmu.hideArr.indexOf("color")<0)&&t.start-n<=c&&c<=t.start+n})),t.live&&(e.data=[])}else 0===(u=e.data.splice(0,1)).length&&(u=e.playedData.splice(0,1));if(u.length>0){i.updatePos();var l=2;e:for(var d,h=0;h<u.length;h++)if(d=u[h],e.forceDuration&&e.forceDuration!==d.duration&&(d.duration=e.forceDuration),(o=new a.default(t,d))&&!o.bulletCreateFail)if(o.attach(),d.attached_=!0,i.addBullet(o).result)e.queue.push(o),o.topInit(),l=2;else{for(var f in o.detach(),o)s.hasOwnProperty.call(o,f)&&delete o[f];if(o=null,d.attached_=!1,d.noDiscard&&(d.prior?e.data.unshift(d):e.data.push(d)),0===l)break e;l--}else{if(0===l)break e;l--}}}}},{key:"sortData",value:function(){this.data.sort((function(e,t){return(e.start||-1)-(t.start||-1)}))}},{key:"status",get:function(){return this._status}}]),t}(i.default);t.default=c,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Bullet=void 0;var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(n=r(1))&&n.__esModule?n:{default:n},o=r(0);function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$7(t)&&"function"!=typeof t?e:t}var u=t.Bullet=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i=n,a=void 0;if(n.setLogger("bullet"),n.danmu=e,n.options=r,n.duration=r.duration,n.id=r.id,n.container=e.container,n.start=r.start,n.prior=r.prior,n.realTime=r.realTime,n.color=r.color,n.bookChannelId=r.bookChannelId,n.direction=e.direction,n.reuseDOM=!0,n.willChanges=[],n.domObj=e.domObj,r.el&&1===r.el.nodeType){if(r.el.parentNode)return s(n,{bulletCreateFail:!0});if(e.config.disableCopyDOM)a=r.el,n.reuseDOM=!1;else{a=n.domObj.use();var u=(0,o.copyDom)(r.el);r.eventListeners&&r.eventListeners.length>0&&r.eventListeners.forEach((function(e){u.addEventListener(e.event,e.listener,e.useCapture||!1)})),a.appendChild(u)}}else(a=n.domObj.use()).textContent=r.txt;if(n.onChangeDirection=function(e){i.direction=e},n.danmu.on("changeDirection",n.onChangeDirection),r.style){var c=r.style;Object.keys(c).forEach((function(e){(0,o.styleUtil)(a,e,c[e])}))}"top"===r.mode||"bottom"===r.mode?n.mode=r.mode:n.mode="scroll",n.el=a,r.like&&r.like.el&&n.setLikeDom(r.like.el,r.like.style),n.status="waiting";var l=void 0;if((0,o.isNumber)(e.config.bulletOffset)&&e.config.bulletOffset>=0)l=e.config.bulletOffset;else{var d=e.containerPos;l=d.width/10>100?100:d.width/10}var h=r.realTime?0:Math.floor(Math.random()*l);return n.updateOffset(h),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$7(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"updateOffset",value:function(e){this.random=e,(0,o.styleUtil)(this.el,"left",this.danmu.containerPos.width+e+"px")}},{key:"attach",value:function(){var e=this.el;this.container.appendChild(e),this.elPos=e.getBoundingClientRect(),"b2t"===this.direction?(this.width=this.elPos.height,this.height=this.elPos.width):(this.width=this.elPos.width,this.height=this.elPos.height),this.moveV&&(this.duration=(this.danmu.containerPos.width+this.random+this.width)/this.moveV*1e3),this.danmu.config&&(this.danmu.config.mouseControl&&(this.mouseoverFunWrapper=this.mouseoverFun.bind(this),e.addEventListener("mouseover",this.mouseoverFunWrapper,!1)),this.danmu.config.mouseEnterControl&&(this.mouseEnterFunWrapper=this.mouseoverFun.bind(this),e.addEventListener("mouseenter",this.mouseEnterFunWrapper,!1))),e.addEventListener("transitionend",this._onTransitionEnd,!1)}},{key:"detach",value:function(){var e=this.el;if(e){var t=this.danmu.config;t&&(t.mouseControl&&e.removeEventListener("mouseover",this.mouseoverFunWrapper,!1),t.mouseEnterControl&&e.removeEventListener("mouseenter",this.mouseEnterFunWrapper,!1)),e.removeEventListener("transitionend",this._onTransitionEnd,!1),e.parentNode&&e.parentNode.removeChild(e),this.reuseDOM&&this.domObj.unused(e),this.el=null}this.elPos=void 0,this.danmu.off("changeDirection",this.onChangeDirection)}},{key:"willChange",value:function(){var e=this.danmu.main.willChanges.concat(this.willChanges).join();(0,o.styleUtil)(this.el,"willChange",e)}},{key:"mouseoverFun",value:function(e){this.danmu&&this.danmu.mouseControl&&this.danmu.config.mouseControlPause||"waiting"===this.status||"end"===this.status||this.danmu&&this.danmu.emit("bullet_hover",{bullet:this,event:e})}},{key:"_onTransitionEnd",value:function(){this.status="end",this.remove()}},{key:"topInit",value:function(){this.logger&&this.logger.info("topInit #"+(this.options.txt||"[DOM Element]")+"#"),"b2t"===this.direction?((0,o.styleUtil)(this.el,"transformOrigin","left top"),(0,o.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY("+this.danmu.containerPos.height+"px) translateZ(0px) rotate(90deg)"),(0,o.styleUtil)(this.el,"transition","transform 0s linear 0s")):(0,o.styleUtil)(this.el,"top",this.top+"px")}},{key:"pauseMove",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this;if("paused"!==t.status&&("forcedPause"!==t.status&&(this.status="paused"),t._moveV=void 0,this.el))if(this.willChange(),"scroll"===this.mode){var r=t.danmu.containerPos;if(e){var n=((new Date).getTime()-t.moveTime)/1e3*this.moveV,i=0;i=t.moveMoreS-n>=0?"b2t"===this.direction?(t.moveMoreS-n)/t.moveContainerHeight*r.height:(t.moveMoreS-n)/t.moveContainerWidth*r.width:t.moveMoreS-n,"b2t"===this.direction?(0,o.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY("+i+"px) translateZ(0px) rotate(90deg)"):(0,o.styleUtil)(this.el,"left",i+"px")}else"b2t"===this.direction?(0,o.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY("+(this.el.getBoundingClientRect().top-r.top)+"px) translateZ(0px) rotate(90deg)"):(0,o.styleUtil)(this.el,"left",this.el.getBoundingClientRect().left-r.left+"px");"b2t"===this.direction||(0,o.styleUtil)(this.el,"transform","translateX(0px) translateY(0px) translateZ(0px)"),(0,o.styleUtil)(this.el,"transition","transform 0s linear 0s")}else this.pastDuration&&this.startTime?this.pastDuration=this.pastDuration+(new Date).getTime()-this.startTime:this.pastDuration=1}},{key:"startMove",value:function(e){if(this.hasMove||(this.danmu.emit("bullet_start",this),this.hasMove=!0),("forcedPause"!==this.status||e)&&this.el&&"start"!==this.status)if(this.status="start",this.willChanges=["transform","transition"],this.willChange(),(0,o.styleUtil)(this.el,"backface-visibility","hidden"),(0,o.styleUtil)(this.el,"perspective","500em"),"scroll"===this.mode){var t=this.danmu.containerPos;if("b2t"===this.direction){var r=(this.el.getBoundingClientRect().bottom-t.top)/this.moveV;(0,o.styleUtil)(this.el,"transition","transform "+r+"s linear 0s"),(0,o.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY(-"+this.height+"px) translateZ(0px) rotate(90deg)"),this.moveTime=(new Date).getTime(),this.moveMoreS=this.el.getBoundingClientRect().top-t.top,this.moveContainerHeight=t.height}else{if(!this.el)return;var n=this.el.getBoundingClientRect(),i=n.right-t.left,a=i/this.moveV;n.right>t.left?((0,o.styleUtil)(this.el,"transition","transform "+a+"s linear 0s"),(0,o.styleUtil)(this.el,"transform","translateX(-"+i+"px) translateY(0px) translateZ(0px)"),this.moveTime=(new Date).getTime(),this.moveMoreS=n.left-t.left,this.moveContainerWidth=t.width):(this.status="end",this.remove())}}else{var s=(new Date).getTime(),u=(this.startTime&&s-this.startTime>this.duration?s-this.startTime:this.duration)/1e3;(0,o.styleUtil)(this.el,"left","50%"),(0,o.styleUtil)(this.el,"margin","0 0 0 -"+this.width/2+"px"),(0,o.styleUtil)(this.el,"visibility","hidden"),(0,o.styleUtil)(this.el,"transition","visibility "+u+"s 0s"),this.pastDuration||(this.pastDuration=1),this.startTime=s}}},{key:"remove",value:function(){this.logger&&this.logger.info("remove #"+(this.options.txt||"[DOM Element]")+"#"),this.pauseMove(),this.el&&this.el.parentNode&&(this.willChanges=[],this.willChange(),this.detach(),this.options.el&&1===this.options.el.nodeType&&this.danmu.config.disableCopyDOM&&(0,o.styleUtil)(this.options.el,"transform","none"),this.danmu.emit("bullet_remove",{bullet:this}))}},{key:"setFontSize",value:function(e){this.el&&(this.el.style.fontSize=e)}},{key:"setLikeDom",value:function(e,t){if(e&&(Object.keys(t).forEach((function(r){e.style[r]=t[r]})),e.className="danmu-like",this.el)){var r=this.el.querySelector(".danmu-like");r&&this.el.removeChild(r),this.el.innerHTML=""+this.el.innerHTML+e.outerHTML}return e}},{key:"moveV",get:function(){var e=this._moveV;if(!e){if(this.options.moveV)e=this.options.moveV;else if(this.elPos){var t=this.danmu.containerPos;e=("b2t"===this.direction?t.height+this.height:t.width+this.width)/this.duration*1e3}e&&(e*=this.danmu.main.playRate,this._moveV=e)}return e}}]),t}(a.default);t.default=u},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(n=r(1))&&n.__esModule?n:{default:n},o=r(0),s=r(31),u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$7(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n=r;return n.setLogger("channel"),n.danmu=e,n.reset(!0),n.direction=e.direction,n.channels=[],n.updatePos(),(0,o.attachEventListener)(r.danmu,"bullet_remove",(function(e){n.removeBullet(e.bullet)}),"destroy"),(0,o.attachEventListener)(r.danmu,"changeDirection",(function(e){n.direction=e}),"destroy"),(0,o.attachEventListener)(r.danmu,"channel_resize",(function(){n.resize()}),"destroy"),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$7(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"updatePos",value:function(){var e=this.container.getBoundingClientRect();this.containerPos=e,this.containerWidth=e.width,this.containerHeight=e.height,this.containerTop=e.top,this.containerBottom=e.bottom,this.containerLeft=e.left,this.containerRight=e.right}},{key:"destroy",value:function(){for(var e in this.logger&&this.logger.info("destroy"),this.channels.splice(0,this.channels.length),this._cancelResizeTimer(),this)o.hasOwnProperty.call(this,e)&&delete this[e]}},{key:"addBullet",value:function(e){var t=this,r=this.danmu,n=this.channels,i=void 0,a=void 0,o=void 0;if("b2t"===t.direction?(a=this.channelWidth,o=Math.ceil(e.width/a)):(i=this.channelHeight,o=Math.ceil(e.height/i)),o>n.length)return{result:!1,message:"exceed channels.length, occupy="+o+",channelsSize="+n.length};for(var s=!0,u=void 0,c=-1,l=0,d=n.length;l<d;l++)if(n[l].queue[e.mode].some((function(t){return t.id===e.id})))return{result:!1,message:"exited, channelOrder="+l+",danmu_id="+e.id};if("scroll"===e.mode)for(var h=0,f=n.length-o;h<=f;h++){s=!0;for(var p=h;p<h+o;p++){if((u=n[p]).operating.scroll){s=!1;break}if(u.bookId.scroll&&u.bookId.scroll!==e.id){s=!1;break}u.operating.scroll=!0;var g=u.queue.scroll[0];if(g){var y=g.el.getBoundingClientRect();if("b2t"===t.direction){if(y.bottom>=t.containerPos.bottom){s=!1,u.operating.scroll=!1;break}}else if(y.right>=t.containerPos.right){s=!1,u.operating.scroll=!1;break}var m=void 0,v=g.moveV,_=void 0,b=e.moveV,A=void 0;if("b2t"===t.direction?(_=(m=y.bottom-t.containerTop)/v,A=t.containerHeight+e.random-m):(_=(m=y.right-t.containerLeft)/v,A=t.containerWidth+e.random-m),b>v){var E=A/(b-v);if(r.config.bOffset||(r.config.bOffset=0),_+r.config.bOffset>=E){var S=_*b-t.containerPos.width;S>0&&e.updateOffset(S+(1+Math.ceil(5*Math.random())))}}}u.operating.scroll=!1}if(s){c=h;break}}else if("top"===e.mode)for(var T=0,w=n.length-o;T<=w;T++){s=!0;for(var C=T;C<T+o;C++){if(C>Math.floor(n.length/2)){s=!1;break}if((u=n[C]).operating[e.mode]){s=!1;break}if((u.bookId[e.mode]||e.prior)&&u.bookId[e.mode]!==e.id){s=!1;break}if(u.operating[e.mode]=!0,u.queue[e.mode].length>0){s=!1,u.operating[e.mode]=!1;break}u.operating[e.mode]=!1}if(s){c=T;break}}else if("bottom"===e.mode)for(var k=n.length-o;k>=0;k--){s=!0;for(var I=k;I<k+o;I++){if(I<=Math.floor(n.length/2)){s=!1;break}if((u=n[I]).operating[e.mode]){s=!1;break}if((u.bookId[e.mode]||e.prior)&&u.bookId[e.mode]!==e.id){s=!1;break}if(u.operating[e.mode]=!0,u.queue[e.mode].length>0){s=!1,u.operating[e.mode]=!1;break}u.operating[e.mode]=!1}if(s){c=k;break}}if(-1!==c){for(var $=c,P=c+o;$<P;$++)(u=n[$]).operating[e.mode]=!0,u.queue[e.mode].unshift(e),e.prior&&(delete u.bookId[e.mode],t.logger&&t.logger.info($+"å·è½¨é“æ¢å¤æ­£å¸¸ä½¿ç”¨")),u.operating[e.mode]=!1;return e.prior&&(t.logger&&t.logger.info(e.id+"å·ä¼˜å…ˆå¼¹å¹•è¿è¡Œå®Œæ¯•"),delete e.bookChannelId,r.player&&r.bulletBtn.main.data.some((function(t){return t.id===e.id&&(delete t.bookChannelId,!0)}))),e.channel_id=[c,o],"b2t"===t.direction?(e.top=c*a,t.danmu.config.area&&t.danmu.config.area.start&&(e.top+=t.containerWidth*t.danmu.config.area.start)):(e.top=c*i,t.danmu.config.area&&t.danmu.config.area.start&&(e.top+=t.containerHeight*t.danmu.config.area.start)),{result:e,message:"success"}}if(e.options.realTime){var x=0,R=-1,O=null;if(t.danmu.bulletBtn.main.queue.forEach((function(e,r){!e.prior&&!e.options.realTime&&e.el&&e.el.getBoundingClientRect().left>t.containerPos.right&&e.start>=x&&(x=e.start,R=r,O=e)})),O){O.remove(),t.removeBullet(O),t.danmu.bulletBtn.main.queue.splice(R,1),e.channel_id=O.channel_id;for(var D=O.channel_id[0],L=O.channel_id[0]+O.channel_id[1];D<L;D++)(u=n[D]).operating[e.mode]=!0,u.queue[e.mode].unshift(e),e.prior&&delete u.bookId[e.mode],u.operating[e.mode]=!1;return e.top=O.top,t.danmu.config.area&&t.danmu.config.area.start&&(e.top+=t.containerHeight*t.danmu.config.area.start),{result:e,message:"success"}}}if(e.prior)if(e.bookChannelId||t.danmu.live)r.player&&r.bulletBtn.main.data.some((function(r){return r.id===e.id&&(t.logger&&t.logger.info(e.id+"å·ä¼˜å…ˆå¼¹å¹•å°†äºŽ2ç§’åŽå†æ¬¡è¯·æ±‚æ³¨å†Œ"),r.start+=2e3,!0)}));else{c=-1;for(var M=0,N=n.length-o;M<=N;M++){s=!0;for(var B=M;B<M+o;B++)if(n[B].bookId[e.mode]){s=!1;break}if(s){c=M;break}}if(-1!==c){for(var U=c;U<c+o;U++)n[U].bookId[e.mode]=e.id,t.logger&&t.logger.info(U+"å·è½¨é“è¢«"+e.id+"å·ä¼˜å…ˆå¼¹å¹•é¢„å®š");r.player&&r.bulletBtn.main.data.some((function(r){return r.id===e.id&&(t.logger&&t.logger.info(e.id+"å·ä¼˜å…ˆå¼¹å¹•å°†äºŽ2ç§’åŽå†æ¬¡è¯·æ±‚æ³¨å†Œ"),r.start+=2e3,r.bookChannelId=[c,o],t.logger&&t.logger.info(e.id+"å·ä¼˜å…ˆå¼¹å¹•é¢„å®šäº†"+c+"~"+(c+o-1)+"å·è½¨é“"),!0)}))}}return{result:!1,message:"no surplus will right"}}},{key:"removeBullet",value:function(e){this.logger&&this.logger.info("removeBullet "+(e.options.txt||"[DOM Element]"));for(var t=this.channels,r=e.channel_id,n=void 0,i=r[0],a=r[0]+r[1];i<a;i++)if(n=t[i]){n.operating[e.mode]=!0;var o=-1;n.queue[e.mode].some((function(t,r){return t.id===e.id&&(o=r,!0)})),o>-1&&n.queue[e.mode].splice(o,1),n.operating[e.mode]=!1}e.options.loop&&this.danmu.bulletBtn.main.playedData.push(e.options)}},{key:"resizeSync",value:function(){this.resize(!0)}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.logger&&this.logger.info("resize");var t=this;function r(){var e=t.danmu,r=e.container,n=e.config,i=e.bulletBtn,a=void 0;if(t.updatePos(),t._cancelResizeTimer(),i.main.data&&i.main.data.forEach((function(e){e.bookChannelId&&(delete e.bookChannelId,t.logger&&t.logger.info("resizeå¯¼è‡´"+e.id+"å·ä¼˜å…ˆå¼¹å¹•é¢„å®šå–æ¶ˆ"))})),t.logger&&t.logger.info("resizeå¯¼è‡´æ‰€æœ‰è½¨é“æ¢å¤æ­£å¸¸ä½¿ç”¨"),t.width=t.containerWidth,t.height=t.containerHeight,n.area){var u=n.area,c=u.lines,l=u.start,d=u.end;(0,s.validAreaLineRule)(c)?a=c:l>=0&&d>=l&&("b2t"===t.direction?t.width=t.width*(d-l):t.height=t.height*(d-l))}t.container=r;var h=n.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12);(0,o.isNumber)(a)||(a="b2t"===t.direction?Math.floor(t.width/h):Math.floor(t.height/h));for(var f=[],p=0;p<a;p++)f[p]={id:p,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};if(t.channels&&t.channels.length<=f.length){for(var g=function(e){f[e]={id:e,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}},["scroll","top"].forEach((function(r){t.channels[e].queue[r].forEach((function(t){t.el&&f[e].queue[r].push(t)}))})),t.channels[e].queue.bottom.forEach((function(r){if(r.el&&(f[e+f.length-t.channels.length].queue.bottom.push(r),r.channel_id[0]+r.channel_id[1]-1===e)){var n=[].concat(r.channel_id);r.channel_id=[n[0]-t.channels.length+f.length,n[1]],r.top=r.channel_id[0]*h,t.danmu.config.area&&t.danmu.config.area.start&&(r.top+=t.containerHeight*t.danmu.config.area.start),r.topInit()}}))},y=0;y<t.channels.length;y++)g(y);for(var m=function(e){["scroll","top","bottom"].forEach((function(t){f[e].queue[t].forEach((function(e){e.resized=!1}))}))},v=0;v<f.length;v++)m(v);t.channels=f,"b2t"===t.direction?t.channelWidth=h:t.channelHeight=h}else if(t.channels&&t.channels.length>f.length){for(var _=function(e){f[e]={id:e,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}},["scroll","top","bottom"].forEach((function(r){if("top"===r&&e>Math.floor(f.length/2));else if("bottom"===r&&e<=Math.floor(f.length/2));else{var n="bottom"===r?e-f.length+t.channels.length:e;t.channels[n].queue[r].forEach((function(i,a){if(i.el&&(f[e].queue[r].push(i),"bottom"===r&&i.channel_id[0]+i.channel_id[1]-1===n)){var o=[].concat(i.channel_id);i.channel_id=[o[0]-t.channels.length+f.length,o[1]],i.top=i.channel_id[0]*h,t.danmu.config.area&&t.danmu.config.area.start&&(i.top+=t.containerHeight*t.danmu.config.area.start),i.topInit()}t.channels[n].queue[r].splice(a,1)}))}}))},b=0;b<f.length;b++)_(b);for(var A=function(e){["scroll","top","bottom"].forEach((function(t){f[e].queue[t].forEach((function(e){e.resized=!1}))}))},E=0;E<f.length;E++)A(E);t.channels=f,"b2t"===t.direction?t.channelWidth=h:t.channelHeight=h}t.resizing=!1}t.resizing||(t.resizing=!0,e?r():(this._cancelResizeTimer(),this.resizeId=requestAnimationFrame(r)))}},{key:"_cancelResizeTimer",value:function(){this.resizeId&&(cancelAnimationFrame(this.resizeId),this.resizeId=null)}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.logger&&this.logger.info("reset");var t=this,r=t.danmu,n=r.container,i=r.bulletBtn,a=r.config;function u(){var e=void 0,r=n.getBoundingClientRect();if(t.width=r.width,t.height=r.height,t.resetId&&(cancelAnimationFrame(t.resetId),t.resetId=null),a.area){var i=a.area,u=i.lines,c=i.start,l=i.end;(0,s.validAreaLineRule)(u)?e=u:c>=0&&l>=c&&("b2t"===t.direction?t.width=t.width*(l-c):t.height=t.height*(l-c))}var d=a.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12);(0,o.isNumber)(e)||(e="b2t"===t.direction?Math.floor(t.width/d):Math.floor(t.height/d));for(var h=[],f=0;f<e;f++)h[f]={id:f,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};t.channels=h,"b2t"===t.direction?t.channelWidth=d:t.channelHeight=d}t.container=n,i&&i.main&&i.main.queue.forEach((function(e){e.remove()})),t.channels&&t.channels.length>0&&["scroll","top","bottom"].forEach((function(e){for(var r=0;r<t.channels.length;r++)t.channels[r].queue[e].forEach((function(e){e.remove()}))})),i&&i.main&&i.main.data&&i.main.data.forEach((function(e){e.attached_=!1})),e?this.resetId=requestAnimationFrame(u):u()}}]),t}(a.default);t.default=u,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.validAreaLineRule=function(e){return"number"==typeof e&&e>=0&&Number.isInteger(e)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t={initDOM:function(){return document.createElement("div")},initSize:10},this.init(t)}return n(e,[{key:"init",value:function(e){this.idleList=[],this.usingList=[],this._id=0,this.options=e,this._expand(e.initSize)}},{key:"use",value:function(){this.idleList.length||this._expand(1);var e=this.idleList.shift();return this.usingList.push(e),e}},{key:"unused",value:function(e){var t=this.usingList.indexOf(e);t<0||(this.usingList.splice(t,1),e.innerHTML="",e.textcontent="",this.clearElementStyle(e),this.idleList.push(e))}},{key:"_expand",value:function(e){for(var t=0;t<e;t++)this.idleList.push(this.options.initDOM(this._id++))}},{key:"destroy",value:function(){for(var e=0;e<this.idleList.length;e++)this.idleList[e].innerHTML="",this.idleList[e].textcontent="",this.clearElementStyle(this.idleList[e]);for(var t=0;t<this.usingList.length;t++)this.usingList[t].innerHTML="",this.usingList[t].textcontent="",this.clearElementStyle(this.usingList[t]);for(var r in this)i.hasOwnProperty.call(this,r)&&delete this[r]}},{key:"clearElementStyle",value:function(e){var t="undefined"!=typeof window?window.navigator.userAgent:null;t&&(t.indexOf("MSIE ")>-1||t.indexOf("Trident/")>-1?(0,i.styleUtil)(e,"transform","none"):e.setAttribute("style",""))}}]),e}();t.default=a,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.destroyObserver=t.unObserver=t.addObserver=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=new(function(){function e(){var t=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.__handlers=[],window.ResizeObserver)try{this.observer=new window.ResizeObserver((0,i.throttle)((function(e){t.__trigger(e)}),100))}catch(r){}}return n(e,[{key:"addObserver",value:function(e,t){if(this.observer){this.observer&&this.observer.observe(e);for(var r=this.__handlers,n=-1,i=0;i<r.length;i++)r[i]&&e===r[i].target&&(n=i);n>-1?this.__handlers[n].handler.push(t):this.__handlers.push({target:e,handler:[t]})}}},{key:"unObserver",value:function(e){var t=-1;this.__handlers.map((function(r,n){e===r.target&&(t=n)})),this.observer&&this.observer.unobserve(e),t>-1&&this.__handlers.splice(t,1)}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(e){for(var t=this.__handlers,r=0;r<t.length;r++)if(t[r]&&e===t[r].target){t[r].handler&&t[r].handler.map((function(e){try{e()}catch(t){console.error(t)}}));break}}},{key:"__trigger",value:function(e){var t=this;e.map((function(e){t.__runHandler(e.target)}))}}]),e}());t.addObserver=function(e,t){a.addObserver(e,t)},t.unObserver=function(e,t){a.unObserver(e,t)},t.destroyObserver=function(e,t){a.destroyObserver(e,t)}},function(e,t,r){var n=r(35);"string"==typeof n&&(n=[[e.i,n,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};r(37)(n,i),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(36)(!1)).push([e.i,".danmu{overflow:hidden;-webkit-user-select:none;-moz-user-select:none;user-select:none;-ms-user-select:none}.danmu>*{position:absolute;white-space:nowrap}.danmu-switch{width:32px;height:20px;border-radius:100px;background-color:#ccc;-webkit-box-sizing:border-box;box-sizing:border-box;outline:none;cursor:pointer;position:relative;text-align:center;margin:10px auto}.danmu-switch.danmu-switch-active{padding-left:12px;background-color:#f85959}.danmu-switch span.txt{width:20px;height:20px;line-height:20px;text-align:center;display:block;border-radius:100px;background-color:#fff;-webkit-box-shadow:-2px 0 0 0 rgba(0, 0, 0, .04);box-shadow:-2px 0 0 0 rgba(0, 0, 0, .04);font-family:PingFangSC;font-size:10px;font-weight:500;color:#f44336}",""])},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r=function(e,t){var r,n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var a=(r=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),o=i.sources.map((function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"}));return[n].concat(o).concat([a]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+r+"}":r})).join("")},t.i=function(e,r){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},i=0;i<this.length;i++){var a=this[i][0];"number"==typeof a&&(n[a]=!0)}for(i=0;i<e.length;i++){var o=e[i];"number"==typeof o[0]&&n[o[0]]||(r&&!o[2]?o[2]=r:r&&(o[2]="("+o[2]+") and ("+r+")"),t.push(o))}},t}},function(e,t,r){var n,i,a,o={},s=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===i&&(i=n.apply(this,arguments)),i}),u=function(e){return document.querySelector(e)},c=(a={},function(e){if("function"==typeof e)return e();if(void 0===a[e]){var t=u.call(this,e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(r){t=null}a[e]=t}return a[e]}),l=null,d=0,h=[],f=r(38);function p(e,t){for(var r=0;r<e.length;r++){var n=e[r],i=o[n.id];if(i){i.refs++;for(var a=0;a<i.parts.length;a++)i.parts[a](n.parts[a]);for(;a<n.parts.length;a++)i.parts.push(b(n.parts[a],t))}else{var s=[];for(a=0;a<n.parts.length;a++)s.push(b(n.parts[a],t));o[n.id]={id:n.id,refs:1,parts:s}}}}function g(e,t){for(var r=[],n={},i=0;i<e.length;i++){var a=e[i],o=t.base?a[0]+t.base:a[0],s={css:a[1],media:a[2],sourceMap:a[3]};n[o]?n[o].parts.push(s):r.push(n[o]={id:o,parts:[s]})}return r}function y(e,t){var r=c(e.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=h[h.length-1];if("top"===e.insertAt)n?n.nextSibling?r.insertBefore(t,n.nextSibling):r.appendChild(t):r.insertBefore(t,r.firstChild),h.push(t);else if("bottom"===e.insertAt)r.appendChild(t);else{if("object"!=_typeof$7(e.insertAt)||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=c(e.insertInto+" "+e.insertAt.before);r.insertBefore(t,i)}}function m(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=h.indexOf(e);t>=0&&h.splice(t,1)}function v(e){var t=document.createElement("style");return void 0===e.attrs.type&&(e.attrs.type="text/css"),_(t,e.attrs),y(e,t),t}function _(e,t){Object.keys(t).forEach((function(r){e.setAttribute(r,t[r])}))}function b(e,t){var r,n,i,a,o,s;if(t.transform&&e.css){if(!(a=t.transform(e.css)))return function(){};e.css=a}if(t.singleton){var u=d++;r=l||(l=v(t)),n=S.bind(null,r,u,!1),i=S.bind(null,r,u,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(o=t,s=document.createElement("link"),void 0===o.attrs.type&&(o.attrs.type="text/css"),o.attrs.rel="stylesheet",_(s,o.attrs),y(o,s),r=s,n=w.bind(null,r,t),i=function(){m(r),r.href&&URL.revokeObjectURL(r.href)}):(r=v(t),n=T.bind(null,r),i=function(){m(r)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else i()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=("undefined"==typeof document?"undefined":_typeof$7(document)))throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==_typeof$7(t.attrs)?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=s()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var r=g(e,t);return p(r,t),function(e){for(var n=[],i=0;i<r.length;i++){var a=r[i];(s=o[a.id]).refs--,n.push(s)}for(e&&p(g(e,t),t),i=0;i<n.length;i++){var s;if(0===(s=n[i]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete o[s.id]}}}};var A,E=(A=[],function(e,t){return A[e]=t,A.filter(Boolean).join("\n")});function S(e,t,r,n){var i=r?"":n.css;if(e.styleSheet)e.styleSheet.cssText=E(t,i);else{var a=document.createTextNode(i),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(a,o[t]):e.appendChild(a)}}function T(e,t){var r=t.css,n=t.media;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}function w(e,t,r){var n=r.css,i=r.sourceMap,a=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||a)&&(n=f(n)),i&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var o=new Blob([n],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(o),s&&URL.revokeObjectURL(s)}},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var r=t.protocol+"//"+t.host,n=r+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var i,a=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(a)?e:(i=0===a.indexOf("//")?a:0===a.indexOf("/")?r+a:n+a.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")}))}}])}(dist$3);var DanmuJs$1=getDefaultExportFromCjs(dist$3.exports);function PanelIcon(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" viewBox="-5 -11 40 40" width="40" height="40">\n  <path fill="#f85959" transform="scale(0.8 0.8)" d="M36.5,18.73a1.19,1.19,0,0,0,1-1.14V16.33a1.2,1.2,0,0,0-1-1.13l-.61-.08a1.75,1.75,0,0,1-1.3-.86l-.21-.36-.2-.36A1.72,1.72,0,0,1,34,12l.23-.58a1.18,1.18,0,0,0-.5-1.42l-1.1-.62a1.18,1.18,0,0,0-1.47.3l-.39.51a1.82,1.82,0,0,1-1.41.72c-.44,0-1.88-.27-2.22-.7l-.39-.49a1.18,1.18,0,0,0-1.48-.28l-1.09.64a1.19,1.19,0,0,0-.47,1.43l.25.59a1.87,1.87,0,0,1-.08,1.58c-.26.37-1.17,1.5-1.71,1.58l-.63.09a1.19,1.19,0,0,0-1,1.14l0,1.27a1.17,1.17,0,0,0,1,1.12l.61.08a1.74,1.74,0,0,1,1.3.87l.21.36.2.35A1.69,1.69,0,0,1,24,22.08l-.23.59a1.19,1.19,0,0,0,.5,1.42l1.1.62a1.19,1.19,0,0,0,1.48-.31l.38-.5a1.83,1.83,0,0,1,1.41-.72c.44,0,1.88.25,2.22.69l.39.49a1.18,1.18,0,0,0,1.48.28L33.86,24a1.19,1.19,0,0,0,.47-1.43L34.09,22a1.84,1.84,0,0,1,.07-1.58c.26-.37,1.17-1.5,1.72-1.58ZM31,18.94a2.76,2.76,0,0,1-4.65-1.2A2.71,2.71,0,0,1,27,15.13a2.76,2.76,0,0,1,4.64,1.2A2.7,2.7,0,0,1,31,18.94Z"/>\n  <path fill="#f85959" transform="scale(0.8 0.8)" d="M32,0H3.59A3.59,3.59,0,0,0,0,3.59v17A3.59,3.59,0,0,0,3.59,24.2H19.72a12.59,12.59,0,0,1-.81-1.2A11.73,11.73,0,0,1,35.54,7.28V3.59A3.59,3.59,0,0,0,32,0ZM13,14.18H4.29a1.52,1.52,0,0,1,0-3H13a1.52,1.52,0,0,1,0,3ZM16.45,8H4.29a1.51,1.51,0,0,1,0-3H16.45a1.51,1.51,0,1,1,0,3Z"/>\n</svg>\n',"image/svg+xml").firstChild}var DanmuPanel=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(e){var n;return _classCallCheck$7(this,r),(n=t.call(this,e)).set={speed:1,area:{},opacity:1,fonSize:"middle"},n}return _createClass$8(r,[{key:"afterCreate",value:function(){"mobile"===sniffer$1.device?this.activeEvent="click":this.activeEvent="mouseenter",this.onStateChange=this.onStateChange.bind(this),this.onToggle=this.onToggle.bind(this),this.bind(this.activeEvent,this.onToggle),this.bind("mouseleave",this.onToggle),this.appendChild(".xgplayer-panel-icon",PanelIcon())}},{key:"onStateChange",value:function(e){this.config.onChangeSet&&this.config.onChangeSet(this.set)}},{key:"onToggle",value:function(e){e.preventDefault(),e.stopPropagation(),util$2.hasClass(this.root,"slider-show")?util$2.removeClass(this.root,"slider-show"):util$2.addClass(this.root,"slider-show")}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.onStateChange)}},{key:"render",value:function(){return'\n      <xg-icon class="xgplayer-panel">\n          <xg-panel-icon class="xgplayer-panel-icon">\n          </xg-panel-icon>\n          <xg-panel-slider class="xgplayer-panel-slider">\n            <xg-hidemode class="xgplayer-hidemode">\n              <p class="xgplayer-hidemode-font">å±è”½ç±»åž‹</p>\n              <ul class="xgplayer-hidemode-radio">\n                <li class="xgplayer-hidemode-scroll" id="false">æ»šåŠ¨</li><li class="xgplayer-hidemode-top" id="false">é¡¶éƒ¨</li><li class="xgplayer-hidemode-bottom" id="false">åº•éƒ¨</li><li class="xgplayer-hidemode-color" id="false">è‰²å½©</li>\n              </ul>\n            </xg-hidemode>\n            <xg-transparency class="xgplayer-transparency">\n              <span>ä¸é€æ˜Žåº¦</span>\n              <input class="xgplayer-transparency-line xgplayer-transparency-color xgplayer-transparency-bar xgplayer-transparency-gradient" type="range" min="0" max="100" step="0.1" value="50"></input>\n            </xg-transparency>\n            <xg-showarea class="xgplayer-showarea">\n              <div class="xgplayer-showarea-name">æ˜¾ç¤ºåŒºåŸŸ</div>\n              <div class="xgplayer-showarea-control">\n                <div class="xgplayer-showarea-control-up">\n                  <span class="xgplayer-showarea-control-up-item xgplayer-showarea-onequarters">1/4</span>\n                  <span class="xgplayer-showarea-control-up-item xgplayer-showarea-twoquarters selected-color">1/2</span>\n                  <span class="xgplayer-showarea-control-up-item xgplayer-showarea-threequarters">3/4</span>\n                  <span class="xgplayer-showarea-control-up-item xgplayer-showarea-full">1</span>\n                </div>\n                <div class="xgplayer-showarea-control-down">\n                  <div class="xgplayer-showarea-control-down-dots">\n                    <span class="xgplayer-showarea-onequarters-dot"></span>\n                    <span class="xgplayer-showarea-twoquarters-dot"></span>\n                    <span class="xgplayer-showarea-threequarters-dot"></span>\n                    <span class="xgplayer-showarea-full-dot"></span>\n                  </div>\n                  <input class="xgplayer-showarea-line xgplayer-showarea-color xgplayer-showarea-bar xgplayer-gradient" type="range" min="1" max="4" step="1" value="1">\n                </div>\n              </div>\n            </xg-showarea>\n            <xg-danmuspeed class="xgplayer-danmuspeed">\n              <div class="xgplayer-danmuspeed-name">å¼¹å¹•é€Ÿåº¦</div>\n              <div class="xgplayer-danmuspeed-control">\n                <div class="xgplayer-danmuspeed-control-up">\n                  <span class="xgplayer-danmuspeed-control-up-item xgplayer-danmuspeed-small">æ…¢</span>\n                  <span class="xgplayer-danmuspeed-control-up-item xgplayer-danmuspeed-middle selected-color">ä¸­</span>\n                  <span class="xgplayer-danmuspeed-control-up-item xgplayer-danmuspeed-large">å¿«</span>\n                </div>\n                <div class="xgplayer-danmuspeed-control-down">\n                  <div class="xgplayer-danmuspeed-control-down-dots">\n                    <span class="xgplayer-danmuspeed-small-dot"></span>\n                    <span class="xgplayer-danmuspeed-middle-dot"></span>\n                    <span class="xgplayer-danmuspeed-large-dot"></span>\n                  </div>\n                  <input class="xgplayer-danmuspeed-line xgplayer-danmuspeed-color xgplayer-danmuspeed-bar xgplayer-gradient" type="range" min="50" max="150" step="50" value="100">\n                </div>\n              </div>\n            </xg-danmuspeed>\n            <xg-danmufont class="xgplayer-danmufont">\n              <div class="xgplayer-danmufont-name">å­—ä½“å¤§å°</div>\n              <div class="xgplayer-danmufont-control">\n                <div class="xgplayer-danmufont-control-up">\n                  <span class="xgplayer-danmufont-control-up-item xgplayer-danmufont-small">å°</span>\n                  <span class="xgplayer-danmufont-control-up-item xgplayer-danmufont-middle">ä¸­</span>\n                  <span class="xgplayer-danmufont-control-up-item xgplayer-danmufont-large selected-color">å¤§</span>\n                </div>\n                <div class="xgplayer-danmufont-control-down">\n                  <div class="xgplayer-danmufont-control-down-dots">\n                    <span class="xgplayer-danmufont-small-dot"></span>\n                    <span class="xgplayer-danmufont-middle-dot"></span>\n                    <span class="xgplayer-danmufont-large-dot"></span>\n                  </div>\n                  <input class="xgplayer-danmufont-line xgplayer-danmufont-color xgplayer-danmufont-bar xgplayer-gradient" type="range" min="20" max="30" step="5" value="25">\n                </div>\n              </div>\n            </xg-danmufont>\n          </xg-panel-slider>\n      </xg-icon>'}}],[{key:"pluginName",get:function(){return"danmuPanel"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:11,onChangeSet:function(e){console.log("DanmuPanel:".concat(e))},speed:1,area:{},opacity:1,fonSize:"middle"}}}]),r}(Plugin),DANMU_OPEN='<dk-switch class="danmu-switch">\n<span class="txt">å¼¹</span>\n</dk-switch>',DanmuIcon=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){return _classCallCheck$7(this,r),t.apply(this,arguments)}return _createClass$8(r,[{key:"afterCreate",value:function(){this.initIcons(),this.onStateChange=this.onStateChange.bind(this),this.bind(["click","touchend"],this.onStateChange)}},{key:"registerIcons",value:function(){return{openDanmu:{icon:DANMU_OPEN,class:"danmu-switch-open"},closeDanmu:{icon:DANMU_OPEN,class:"danmu-switch-closed"}}}},{key:"switchState",value:function(e){e?this.setAttr("data-state","active"):this.setAttr("data-state","normal"),this.switchTips(e)}},{key:"initIcons",value:function(){var e=this.icons,t=this.find(".xgplayer-icon");t.appendChild(e.openDanmu),t.appendChild(e.closeDanmu)}},{key:"switchTips",value:function(e){this.changeLangTextKey(this.find(".xg-tips"),e?"OFF":"OPEN")}},{key:"onStateChange",value:function(e){e.preventDefault(),e.stopPropagation();var t="active"===this.root.getAttribute("data-state");this.switchState(!t),this.config.onSwitch&&this.config.onSwitch(e,!t)}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.getMini)}},{key:"render",value:function(){return'\n    <xg-icon class="danmu-icon">\n      <div class="xgplayer-icon">\n      </div>\n      <div class="xg-tips" lang-key="'.concat(this.i18nKeys.OPEN,'">').concat(this.i18n.OPEN,"</div>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"danmuIcon"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:11,onSwitch:function(e,t){}}}}]),r}(Plugin),MIN_INTERVAL$1=300,Danmu=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(e){var n;return _classCallCheck$7(this,r),(n=t.call(this,e)).danmujs=null,n.danmuPanel=null,n.isOpen=!1,n.seekCost=0,n.intervalId=0,n.isUseClose=!1,n}return _createClass$8(r,[{key:"afterCreate",value:function(){var e=this;this.playerConfig.isLive&&(this.config.isLive=!0),this.initDanmu(),this.registerExtIcons(),this.once(TIME_UPDATE,(function(){e.config.defaultOpen&&!e.isUseClose&&e.start()})),this.on(PAUSE,(function(){e.isOpen&&e.danmujs&&e.danmujs.pause()})),this.on(PLAY,(function(){e.isOpen&&e.danmujs&&e.danmujs.play()})),this.on(SEEKING,(function(){e.seekCost=window.performance.now(),!e.config.isLive&&e.danmujs&&e.danmujs.stop()})),this.on(VIDEO_RESIZE,(function(){e.resize()})),this.on(SEEKED,(function(){e.danmujs&&e.isOpen&&(e.intervalId&&(util$2.clearTimeout(e,e.intervalId),e.intervalId=null),window.performance.now()-e.seekCost>MIN_INTERVAL$1?e.danmujs.start():e.intervalId=util$2.setTimeout(e,(function(){e.danmujs.start(),e.intervalId=null}),MIN_INTERVAL$1))}))}},{key:"onPluginsReady",value:function(){var e=this.player.plugins.pc;e&&(e.onVideoDblClick&&this.bind("dblclick",e.onVideoDblClick),e.onVideoClick&&this.bind("click",e.onVideoClick))}},{key:"initDanmu",value:function(){var e=this.player,t=this.config,r=this.config,n=r.channelSize,i=r.fontSize,a=r.opacity,o=r.mouseControl,s=r.mouseControlPause,u=r.area,c=r.defaultOff,l={container:this.root,player:e.video,comments:this.config.comments,live:t.isLive,defaultOff:c,area:u,mouseControl:o,mouseControlPause:s};t.ext&&Object.keys(t.ext).map((function(e){l[e]=t.ext[e]}));var d=new DanmuJs$1(l);this.danmujs=d,e.danmu=d,this.setFontSize(i,n),this.setArea(u),this.resize(),1!==a&&this.setOpacity(a)}},{key:"registerExtIcons",value:function(){var e=this,t=this.player,r=this.config;if(r.panel){var n={config:{onChangeset:function(t){e.changeSet(t)}}};this.danmuPanel=t.controls.registerPlugin(DanmuPanel,n,DanmuPanel.pluginName)}var i=r.switchConfig;if(!r.closeDefaultBtn){var a={config:{onSwitch:function(t,r){e.onSwitch(t,r)}}};Object.keys(i).map((function(e){a.config[e]=i[e]})),this.danmuButton=t.controls.registerPlugin(DanmuIcon,a,DanmuIcon.pluginName),this.config.defaultOpen&&this.danmuButton.switchState(!0)}}},{key:"changeSet",value:function(e){}},{key:"onSwitch",value:function(e,t){this.emitUserAction(e,"switch_danmu",{prop:"isOpen",from:!t,to:t}),t?this.start():this.stop()}},{key:"start",value:function(){var e=this;!this.isOpen&&this.danmujs&&(this.isUseClose=!1,this.show(),this.resize(),util$2.setTimeout(this,(function(){e.danmujs.start(),e.player.paused&&e.danmujs.pause(),e.isOpen=!0}),0))}},{key:"stop",value:function(){this.isUseClose=!0,this.isOpen&&this.danmujs&&(this.danmujs.stop(),this.config.isLive&&this.clear(),this.isOpen=!1,this.hide())}},{key:"clear",value:function(){this.danmujs&&this.danmujs.clear()}},{key:"setCommentLike",value:function(e,t){this.danmujs&&this.danmujs.setCommentLike(e,t)}},{key:"setCommentDuration",value:function(e,t){this.danmujs&&this.danmujs.setCommentDuration(e,t)}},{key:"setAllDuration",value:function(e,t){this.danmujs&&this.danmujs.setAllDuration(e,t)}},{key:"setCommentID",value:function(e,t){this.danmujs&&this.danmujs.setCommentID(e,t)}},{key:"hideMode",value:function(e){this.danmujs&&this.danmujs.hide(e)}},{key:"showMode",value:function(e){this.danmujs&&this.danmujs.show(e)}},{key:"setArea",value:function(e){this.danmujs&&this.danmujs.setArea(e)}},{key:"setOpacity",value:function(e){this.danmujs&&this.danmujs.setOpacity(e)}},{key:"setFontSize",value:function(e,t){this.danmujs&&this.danmujs.setFontSize(e,t)}},{key:"resize",value:function(){this.danmujs&&this.danmujs.resize()}},{key:"sendComment",value:function(e){this.danmujs&&this.danmujs.sendComment(e)}},{key:"hideIcon",value:function(){this.danmuButton&&this.danmuButton.hide()}},{key:"showIcon",value:function(){this.danmuButton&&this.danmuButton.show()}},{key:"destroy",value:function(){this.danmujs.stop(),this.danmujs.destroy(),this.danmujs=null,this.player.danmu=null;var e=this.danmuButton,t=this.danmuPanel;this.danmuButton&&this.danmuButton.root&&e.__destroy&&e.__destroy(),this.danmuPanel&&this.danmuPanel.root&&t.__destroy&&t.__destroy(),this.danmuButton=null,this.danmuPanel=null}},{key:"render",value:function(){return'<xg-danmu class="xgplayer-danmu">\n    </xg-danmu>'}}],[{key:"pluginName",get:function(){return"danmu"}},{key:"defaultConfig",get:function(){return{comments:[],area:{start:0,end:1},closeDefaultBtn:!1,defaultOff:!1,panel:!1,panelConfig:{},switchConfig:{},defaultOpen:!0,isLive:!1,channelSize:24,fontSize:14,opacity:1,mouseControl:!1,mouseControlPause:!1,ext:{},style:{}}}}]),r}(Plugin),index_min$2={exports:{}};!function(e,t){e.exports=function(){function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t(e,t){return e(t={exports:{}},t.exports),t.exports}function r(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=N(t),this.reject=N(r)}function n(e){var t=e.length;return 3===t?(60*(60*Number(e[0])+Number(e[1]))*1e3+1e3*Number(e[2]))/1e3:2===t?(60*Number(e[0])*1e3+1e3*Number(e[1]))/1e3:Number(e[0])}function i(e){return/^(\-|\+)?\d+(\.\d+)?$/.test(e)}function a(e){return e}function o(e,t){return e>=0&&e<t.length?t[e]:""}function s(e,t){if(!e)return!1;if(e.classList)return Array.prototype.some.call(e.classList,(function(e){return e===t}));var r=e.className&&"object"===Yt(e.className)?e.getAttribute("class"):e.className;return r&&!!r.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function u(e,t){e&&(e.classList?t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(t){t&&e.classList.add(t)})):s(e,t)||(e.className&&"object"===Yt(e.className)?e.setAttribute("class",e.getAttribute("class")+" "+t):e.className+=" "+t))}function c(e,t){e&&(e.classList?t.split(/\s+/g).forEach((function(t){e.classList.remove(t)})):s(e,t)&&t.split(/\s+/g).forEach((function(t){var r=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className&&"object"===Yt(e.className)?e.setAttribute("class",e.getAttribute("class").replace(r," ")):e.className=e.className.replace(r," ")})))}function l(e,t,r){var n=t.length;if(n<1)return-1;if(t[r=r<0?0:r>=n?n-1:r].start<=e&&e<t[r].end)return r;for(var i=t[r].end<=e?r+1:0;i<n;i++){if(t[i].start<=e&&e<t[i].end)return i;if(e>t[i].end&&i+1<n&&e<t[i+1].start)return-1;if(e>t[i].end&&i+1>=n)return-1}return-1}function d(e,t,r){var n=t.length;if(n<1)return[];var i=[];if((r=r<0?0:r>=n?n-1:r)<n)for(var a=t[r].end<=e?r:0;a<n&&(t[a].start<=e&&e<t[a].end&&i.push(a),!(e<t[a].start));a++);return i}function h(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=document.createElement(e);return i.className=n,i.innerHTML=t,Sn(r).forEach((function(t){var n=t,a=r[t];"video"===e||"audio"===e||"live-video"===e?a&&i.setAttribute(n,a):i.setAttribute(n,a)})),i}function p(){var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),r=/(?:SymbianOS)/.test(e)||t,n=/(?:Android)/.test(e),i=/(?:Firefox)/.test(e),a=/(?:iPad|PlayBook)/.test(e)||n&&!/(?:Mobile)/.test(e)||i&&/(?:Tablet)/.test(e);return/(?:iPhone)/.test(e)&&!a||n||r||a}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r="";e.map((function(e){r+=" "+t+" "+e.key+" {"+e.style+"}"}));var n=document.createElement("style"),i=document.head||document.getElementsByTagName("head")[0];if(n.type="text/css",n.id="ssss",n.styleSheet){var a=function(){try{n.styleSheet.cssText=r}catch(e){}};n.styleSheet.disabled?setTimeout(a,10):a()}else{var o=document.createTextNode(r);n.appendChild(o)}i.appendChild(n)}function y(e,t){Nn||(Nn=new Mn),Nn.addObserver(e,t)}function m(e,t){Nn&&Nn.unObserver(e,t)}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={code:Bn[e].code,msg:Bn[e].msg};return Sn(t).map((function(e){r[e]=t[e]})),r}function _(e,t,r,n,i){i?r(v(2,i),{format:n.format}):n.format?(e.list=n.list,e.format=n.format,e.styles=n.styles,t(e)):r(v(3))}function b(e){return new An((function(t,r){if(e.list)t(e);else{if(e.json){var n=Ln.parseJson(e.json);return e.list=n,e.format="json",void t(e)}if(e.stringContent&&!e.url)Ln.parse(e.stringContent,(function(n,i){_(e,t,r,n,i)}));else if(e.url)new wn({url:e.url,type:"text"}).then((function(n){Ln.parse(n.res.response,(function(n,i){_(e,t,r,n,i)}))})).catch((function(t){var n=v(1,{statusText:t.statusText,status:t.status,type:t.type,message:"http load error",url:e.url});r(n)}));else{var i=v(8);r(i)}}}))}function A(e,t){return!!(e.id&&e.id===t.id||e.language&&e.language===t.language)}var E=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e},S=function(e){return Object(E(e))},T={}.hasOwnProperty,w=function(e,t){return T.call(e,t)},C=t((function(e){var t=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=t)})),k=(C.version,t((function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)}))),I=t((function(e){var t=k["__core-js_shared__"]||(k["__core-js_shared__"]={});(e.exports=function(e,r){return t[e]||(t[e]=void 0!==r?r:{})})("versions",[]).push({version:C.version,mode:"pure",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})})),$=0,P=Math.random(),x=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++$+P).toString(36))},R=I("keys"),O=function(e){return R[e]||(R[e]=x(e))},D=O("IE_PROTO"),L=Object.prototype,M=Object.getPrototypeOf||function(e){return e=S(e),w(e,D)?e[D]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?L:null},N=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},B=function(e,t,r){if(N(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}},U=function(e){return"object"==_typeof$7(e)?null!==e:"function"==typeof e},G=function(e){if(!U(e))throw TypeError(e+" is not an object!");return e},V=function(e){try{return!!e()}catch(t){return!0}},F=!V((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),j=k.document,H=U(j)&&U(j.createElement),Z=function(e){return H?j.createElement(e):{}},W=!F&&!V((function(){return 7!=Object.defineProperty(Z("div"),"a",{get:function(){return 7}}).a})),K=function(e,t){if(!U(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!U(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!U(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!U(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")},X=Object.defineProperty,Y={f:F?Object.defineProperty:function(e,t,r){if(G(e),t=K(t,!0),G(r),W)try{return X(e,t,r)}catch(n){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},z=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},J=F?function(e,t,r){return Y.f(e,t,z(1,r))}:function(e,t,r){return e[t]=r,e},Q=function e(t,r,n){var i,a,o,s=t&e.F,u=t&e.G,c=t&e.S,l=t&e.P,d=t&e.B,h=t&e.W,f=u?C:C[r]||(C[r]={}),p=f.prototype,g=u?k:c?k[r]:(k[r]||{}).prototype;for(i in u&&(n=r),n)(a=!s&&g&&void 0!==g[i])&&w(f,i)||(o=a?g[i]:n[i],f[i]=u&&"function"!=typeof g[i]?n[i]:d&&a?B(o,k):h&&g[i]==o?function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(o):l&&"function"==typeof o?B(Function.call,o):o,l&&((f.virtual||(f.virtual={}))[i]=o,t&e.R&&p&&!p[i]&&J(p,i,o)))};Q.F=1,Q.G=2,Q.S=4,Q.P=8,Q.B=16,Q.W=32,Q.U=64,Q.R=128;var q=Q,ee=function(e,t){var r=(C.Object||{})[e]||Object[e],n={};n[e]=t(r),q(q.S+q.F*V((function(){r(1)})),"Object",n)};ee("getPrototypeOf",(function(){return function(e){return M(S(e))}}));var te,re=C.Object.getPrototypeOf,ne=e(t((function(e){e.exports={default:re,__esModule:!0}}))),ie=e(t((function(e,t){t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}}))),ae=Math.ceil,oe=Math.floor,se=function(e){return isNaN(e=+e)?0:(e>0?oe:ae)(e)},ue=J,ce={},le={}.toString,de=function(e){return le.call(e).slice(8,-1)},he=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==de(e)?e.split(""):Object(e)},fe=function(e){return he(E(e))},pe=Math.min,ge=function(e){return e>0?pe(se(e),9007199254740991):0},ye=Math.max,me=Math.min,ve=function(e,t){return(e=se(e))<0?ye(e+t,0):me(e,t)},_e=(te=!1,function(e,t,r){var n,i=fe(e),a=ge(i.length),o=ve(r,a);if(te&&t!=t){for(;a>o;)if((n=i[o++])!=n)return!0}else for(;a>o;o++)if((te||o in i)&&i[o]===t)return te||o||0;return!te&&-1}),be=O("IE_PROTO"),Ae=function(e,t){var r,n=fe(e),i=0,a=[];for(r in n)r!=be&&w(n,r)&&a.push(r);for(;t.length>i;)w(n,r=t[i++])&&(~_e(a,r)||a.push(r));return a},Ee="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),Se=Object.keys||function(e){return Ae(e,Ee)},Te=F?Object.defineProperties:function(e,t){G(e);for(var r,n=Se(t),i=n.length,a=0;i>a;)Y.f(e,r=n[a++],t[r]);return e},we=k.document,Ce=we&&we.documentElement,ke=O("IE_PROTO"),Ie=function(){},$e=function(){var e,t=Z("iframe"),r=Ee.length;for(t.style.display="none",Ce.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),$e=e.F;r--;)delete $e.prototype[Ee[r]];return $e()},Pe=Object.create||function(e,t){var r;return null!==e?(Ie.prototype=G(e),r=new Ie,Ie.prototype=null,r[ke]=e):r=$e(),void 0===t?r:Te(r,t)},xe=t((function(e){var t=I("wks"),r=k.Symbol,n="function"==typeof r;(e.exports=function(e){return t[e]||(t[e]=n&&r[e]||(n?r:x)("Symbol."+e))}).store=t})),Re=Y.f,Oe=xe("toStringTag"),De=function(e,t,r){e&&!w(e=r?e:e.prototype,Oe)&&Re(e,Oe,{configurable:!0,value:t})},Le={};J(Le,xe("iterator"),(function(){return this}));var Me=function(e,t,r){e.prototype=Pe(Le,{next:z(1,r)}),De(e,t+" Iterator")},Ne=xe("iterator"),Be=!([].keys&&"next"in[].keys()),Ue=function(){return this},Ge=function(e,t,r,n,i,a,o){Me(r,t,n);var s,u,c,l=function(e){if(!Be&&e in p)return p[e];switch(e){case"keys":case"values":return function(){return new r(this,e)}}return function(){return new r(this,e)}},d=t+" Iterator",h="values"==i,f=!1,p=e.prototype,g=p[Ne]||p["@@iterator"]||i&&p[i],y=g||l(i),m=i?h?l("entries"):y:void 0,v="Array"==t&&p.entries||g;if(v&&(c=M(v.call(new e)))!==Object.prototype&&c.next&&De(c,d,!0),h&&g&&"values"!==g.name&&(f=!0,y=function(){return g.call(this)}),o&&(Be||f||!p[Ne])&&J(p,Ne,y),ce[t]=y,ce[d]=Ue,i)if(s={values:h?y:l("values"),keys:a?y:l("keys"),entries:m},o)for(u in s)u in p||ue(p,u,s[u]);else q(q.P+q.F*(Be||f),t,s);return s},Ve=function(e){return function(t,r){var n,i,a=String(E(t)),o=se(r),s=a.length;return o<0||o>=s?e?"":void 0:(n=a.charCodeAt(o))<55296||n>56319||o+1===s||(i=a.charCodeAt(o+1))<56320||i>57343?e?a.charAt(o):n:e?a.slice(o,o+2):i-56320+(n-55296<<10)+65536}}(!0);Ge(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=Ve(t,r),this._i+=e.length,{value:e,done:!1})}));var Fe=function(e,t){return{value:t,done:!!e}};Ge(Array,"Array",(function(e,t){this._t=fe(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,Fe(1)):Fe(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])}),"values"),ce.Arguments=ce.Array;for(var je=xe("toStringTag"),He="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),Ze=0;Ze<He.length;Ze++){var We=He[Ze],Ke=k[We],Xe=Ke&&Ke.prototype;Xe&&!Xe[je]&&J(Xe,je,We),ce[We]=ce.Array}var Ye={f:xe},ze=Ye.f("iterator"),Je=t((function(e){e.exports={default:ze,__esModule:!0}}));e(Je);var Qe=t((function(e){var t=x("meta"),r=Y.f,n=0,i=Object.isExtensible||function(){return!0},a=!V((function(){return i(Object.preventExtensions({}))})),o=function(e){r(e,t,{value:{i:"O"+ ++n,w:{}}})},s=function(e,r){if(!U(e))return"symbol"==_typeof$7(e)?e:("string"==typeof e?"S":"P")+e;if(!w(e,t)){if(!i(e))return"F";if(!r)return"E";o(e)}return e[t].i},u=function(e,r){if(!w(e,t)){if(!i(e))return!0;if(!r)return!1;o(e)}return e[t].w},c=function(e){return a&&l.NEED&&i(e)&&!w(e,t)&&o(e),e},l=e.exports={KEY:t,NEED:!1,fastKey:s,getWeak:u,onFreeze:c}})),qe=(Qe.KEY,Qe.NEED,Qe.fastKey,Qe.getWeak,Qe.onFreeze,Y.f),et=function(e){var t=C.Symbol||(C.Symbol={});"_"==e.charAt(0)||e in t||qe(t,e,{value:Ye.f(e)})},tt={f:Object.getOwnPropertySymbols},rt={f:{}.propertyIsEnumerable},nt=function(e){var t=Se(e),r=tt.f;if(r)for(var n,i=r(e),a=rt.f,o=0;i.length>o;)a.call(e,n=i[o++])&&t.push(n);return t},it=Array.isArray||function(e){return"Array"==de(e)},at=Ee.concat("length","prototype"),ot={f:Object.getOwnPropertyNames||function(e){return Ae(e,at)}},st=ot.f,ut={}.toString,ct="object"==("undefined"==typeof window?"undefined":_typeof$7(window))&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],lt=function(e){try{return st(e)}catch(t){return ct.slice()}},dt={f:function(e){return ct&&"[object Window]"==ut.call(e)?lt(e):st(fe(e))}},ht=Object.getOwnPropertyDescriptor,ft={f:F?ht:function(e,t){if(e=fe(e),t=K(t,!0),W)try{return ht(e,t)}catch(r){}if(w(e,t))return z(!rt.f.call(e,t),e[t])}},pt=Qe.KEY,gt=ft.f,yt=Y.f,mt=dt.f,vt=k.Symbol,_t=k.JSON,bt=_t&&_t.stringify,At=xe("_hidden"),Et=xe("toPrimitive"),St={}.propertyIsEnumerable,Tt=I("symbol-registry"),wt=I("symbols"),Ct=I("op-symbols"),kt=Object.prototype,It="function"==typeof vt&&!!tt.f,$t=k.QObject,Pt=!$t||!$t.prototype||!$t.prototype.findChild,xt=F&&V((function(){return 7!=Pe(yt({},"a",{get:function(){return yt(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=gt(kt,t);n&&delete kt[t],yt(e,t,r),n&&e!==kt&&yt(kt,t,n)}:yt,Rt=function(e){var t=wt[e]=Pe(vt.prototype);return t._k=e,t},Ot=It&&"symbol"==_typeof$7(vt.iterator)?function(e){return"symbol"==_typeof$7(e)}:function(e){return e instanceof vt},Dt=function e(t,r,n){return t===kt&&e(Ct,r,n),G(t),r=K(r,!0),G(n),w(wt,r)?(n.enumerable?(w(t,At)&&t[At][r]&&(t[At][r]=!1),n=Pe(n,{enumerable:z(0,!1)})):(w(t,At)||yt(t,At,z(1,{})),t[At][r]=!0),xt(t,r,n)):yt(t,r,n)},Lt=function(e,t){G(e);for(var r,n=nt(t=fe(t)),i=0,a=n.length;a>i;)Dt(e,r=n[i++],t[r]);return e},Mt=function(e,t){return void 0===t?Pe(e):Lt(Pe(e),t)},Nt=function(e){var t=St.call(this,e=K(e,!0));return!(this===kt&&w(wt,e)&&!w(Ct,e))&&(!(t||!w(this,e)||!w(wt,e)||w(this,At)&&this[At][e])||t)},Bt=function(e,t){if(e=fe(e),t=K(t,!0),e!==kt||!w(wt,t)||w(Ct,t)){var r=gt(e,t);return!r||!w(wt,t)||w(e,At)&&e[At][t]||(r.enumerable=!0),r}},Ut=function(e){for(var t,r=mt(fe(e)),n=[],i=0;r.length>i;)w(wt,t=r[i++])||t==At||t==pt||n.push(t);return n},Gt=function(e){for(var t,r=e===kt,n=mt(r?Ct:fe(e)),i=[],a=0;n.length>a;)!w(wt,t=n[a++])||r&&!w(kt,t)||i.push(wt[t]);return i};It||(ue((vt=function(){if(this instanceof vt)throw TypeError("Symbol is not a constructor!");var e=x(arguments.length>0?arguments[0]:void 0),t=function t(r){this===kt&&t.call(Ct,r),w(this,At)&&w(this[At],e)&&(this[At][e]=!1),xt(this,e,z(1,r))};return F&&Pt&&xt(kt,e,{configurable:!0,set:t}),Rt(e)}).prototype,"toString",(function(){return this._k})),ft.f=Bt,Y.f=Dt,ot.f=dt.f=Ut,rt.f=Nt,tt.f=Gt,Ye.f=function(e){return Rt(xe(e))}),q(q.G+q.W+q.F*!It,{Symbol:vt});for(var Vt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Ft=0;Vt.length>Ft;)xe(Vt[Ft++]);for(var jt=Se(xe.store),Ht=0;jt.length>Ht;)et(jt[Ht++]);q(q.S+q.F*!It,"Symbol",{for:function(e){return w(Tt,e+="")?Tt[e]:Tt[e]=vt(e)},keyFor:function(e){if(!Ot(e))throw TypeError(e+" is not a symbol!");for(var t in Tt)if(Tt[t]===e)return t},useSetter:function(){Pt=!0},useSimple:function(){Pt=!1}}),q(q.S+q.F*!It,"Object",{create:Mt,defineProperty:Dt,defineProperties:Lt,getOwnPropertyDescriptor:Bt,getOwnPropertyNames:Ut,getOwnPropertySymbols:Gt});var Zt=V((function(){tt.f(1)}));q(q.S+q.F*Zt,"Object",{getOwnPropertySymbols:function(e){return tt.f(S(e))}}),_t&&q(q.S+q.F*(!It||V((function(){var e=vt();return"[null]"!=bt([e])||"{}"!=bt({a:e})||"{}"!=bt(Object(e))}))),"JSON",{stringify:function(e){for(var t,r,n=[e],i=1;arguments.length>i;)n.push(arguments[i++]);if(r=t=n[1],(U(t)||void 0!==e)&&!Ot(e))return it(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Ot(t))return t}),n[1]=t,bt.apply(_t,n)}}),vt.prototype[Et]||J(vt.prototype,Et,vt.prototype.valueOf),De(vt,"Symbol"),De(Math,"Math",!0),De(k.JSON,"JSON",!0),et("asyncIterator"),et("observable");var Wt=C.Symbol,Kt=t((function(e){e.exports={default:Wt,__esModule:!0}}));e(Kt);var Xt=t((function(e,t){function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var n=r(Je),i=r(Kt),a="function"==typeof i.default&&"symbol"==_typeof$7(n.default)?function(e){return _typeof$7(e)}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":_typeof$7(e)};t.default="function"==typeof i.default&&"symbol"===a(n.default)?function(e){return void 0===e?"undefined":a(e)}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":void 0===e?"undefined":a(e)}})),Yt=e(Xt),zt=e(t((function(e,t){t.__esModule=!0;var r,n=(r=Xt)&&r.__esModule?r:{default:r};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,n.default)(t))&&"function"!=typeof t?e:t}})));q(q.S+q.F*!F,"Object",{defineProperty:Y.f});var Jt=C.Object,Qt=function(e,t,r){return Jt.defineProperty(e,t,r)},qt=t((function(e){e.exports={default:Qt,__esModule:!0}}));e(qt);var er=e(t((function(e,t){t.__esModule=!0;var r,n=(r=qt)&&r.__esModule?r:{default:r};t.default=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,n.default)(e,i.key,i)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}()}))),tr=function(e,t){if(G(e),!U(t)&&null!==t)throw TypeError(t+": can't set as prototype!")},rr={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=B(Function.call,ft.f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(n){t=!0}return function(e,n){return tr(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:tr};q(q.S,"Object",{setPrototypeOf:rr.set});var nr=C.Object.setPrototypeOf,ir=t((function(e){e.exports={default:nr,__esModule:!0}}));e(ir),q(q.S,"Object",{create:Pe});var ar=C.Object,or=function(e,t){return ar.create(e,t)},sr=t((function(e){e.exports={default:or,__esModule:!0}}));e(sr);var ur,cr,lr,dr=e(t((function(e,t){function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var n=r(ir),i=r(sr),a=r(Xt);t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,a.default)(t)));e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(n.default?(0,n.default)(e,t):e.__proto__=t)}}))),hr=xe("toStringTag"),fr="Arguments"==de(function(){return arguments}()),pr=function(e,t){try{return e[t]}catch(r){}},gr=function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=pr(t=Object(e),hr))?r:fr?de(t):"Object"==(n=de(t))&&"function"==typeof t.callee?"Arguments":n},yr=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e},mr=function(e,t,r,n){try{return n?t(G(r)[0],r[1]):t(r)}catch(a){var i=e.return;throw void 0!==i&&G(i.call(e)),a}},vr=xe("iterator"),_r=Array.prototype,br=function(e){return void 0!==e&&(ce.Array===e||_r[vr]===e)},Ar=xe("iterator"),Er=C.getIteratorMethod=function(e){if(null!=e)return e[Ar]||e["@@iterator"]||ce[gr(e)]},Sr=t((function(e){var t={},r={},n=e.exports=function(e,n,i,a,o){var s,u,c,l,d=o?function(){return e}:Er(e),h=B(i,a,n?2:1),f=0;if("function"!=typeof d)throw TypeError(e+" is not iterable!");if(br(d)){for(s=ge(e.length);s>f;f++)if((l=n?h(G(u=e[f])[0],u[1]):h(e[f]))===t||l===r)return l}else for(c=d.call(e);!(u=c.next()).done;)if((l=mr(c,h,u.value,n))===t||l===r)return l};n.BREAK=t,n.RETURN=r})),Tr=xe("species"),wr=function(e,t){var r,n=G(e).constructor;return void 0===n||null==(r=G(n)[Tr])?t:N(r)},Cr=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)},kr=k.process,Ir=k.setImmediate,$r=k.clearImmediate,Pr=k.MessageChannel,xr=k.Dispatch,Rr=0,Or={},Dr=function(){var e=+this;if(Or.hasOwnProperty(e)){var t=Or[e];delete Or[e],t()}},Lr=function(e){Dr.call(e.data)};Ir&&$r||(Ir=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return Or[++Rr]=function(){Cr("function"==typeof e?e:Function(e),t)},ur(Rr),Rr},$r=function(e){delete Or[e]},"process"==de(kr)?ur=function(e){kr.nextTick(B(Dr,e,1))}:xr&&xr.now?ur=function(e){xr.now(B(Dr,e,1))}:Pr?(lr=(cr=new Pr).port2,cr.port1.onmessage=Lr,ur=B(lr.postMessage,lr,1)):k.addEventListener&&"function"==typeof postMessage&&!k.importScripts?(ur=function(e){k.postMessage(e+"","*")},k.addEventListener("message",Lr,!1)):ur="onreadystatechange"in Z("script")?function(e){Ce.appendChild(Z("script")).onreadystatechange=function(){Ce.removeChild(this),Dr.call(e)}}:function(e){setTimeout(B(Dr,e,1),0)});var Mr={set:Ir,clear:$r},Nr=Mr.set,Br=k.MutationObserver||k.WebKitMutationObserver,Ur=k.process,Gr=k.Promise,Vr="process"==de(Ur),Fr={f:function(e){return new r(e)}},jr=function(e){try{return{e:!1,v:e()}}catch(t){return{e:!0,v:t}}},Hr=k.navigator,Zr=Hr&&Hr.userAgent||"",Wr=function(e,t){if(G(e),U(t)&&t.constructor===e)return t;var r=Fr.f(e);return(0,r.resolve)(t),r.promise},Kr=xe("species"),Xr=xe("iterator"),Yr=!1;try{var zr=[7][Xr]();zr.return=function(){Yr=!0},Array.from(zr,(function(){throw 2}))}catch(te){}var Jr,Qr,qr,en,tn=Mr.set,rn=function(){var e,t,r,n=function(){var n,i;for(Vr&&(n=Ur.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(a){throw e?r():t=void 0,a}}t=void 0,n&&n.enter()};if(Vr)r=function(){Ur.nextTick(n)};else if(!Br||k.navigator&&k.navigator.standalone)if(Gr&&Gr.resolve){var i=Gr.resolve(void 0);r=function(){i.then(n)}}else r=function(){Nr.call(k,n)};else{var a=!0,o=document.createTextNode("");new Br(n).observe(o,{characterData:!0}),r=function(){o.data=a=!a}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}(),nn=k.TypeError,an=k.process,on=an&&an.versions,sn=on&&on.v8||"",un=k.Promise,cn="process"==gr(an),ln=function(){},dn=Qr=Fr.f,hn=!!function(){try{var e=un.resolve(1),t=(e.constructor={})[xe("species")]=function(e){e(ln,ln)};return(cn||"function"==typeof PromiseRejectionEvent)&&e.then(ln)instanceof t&&0!==sn.indexOf("6.6")&&-1===Zr.indexOf("Chrome/66")}catch(r){}}(),fn=function(e){var t;return!(!U(e)||"function"!=typeof(t=e.then))&&t},pn=function(e,t){if(!e._n){e._n=!0;var r=e._c;rn((function(){for(var n=e._v,i=1==e._s,a=0;r.length>a;)!function(t){var r,a,o,s=i?t.ok:t.fail,u=t.resolve,c=t.reject,l=t.domain;try{s?(i||(2==e._h&&mn(e),e._h=1),!0===s?r=n:(l&&l.enter(),r=s(n),l&&(l.exit(),o=!0)),r===t.promise?c(nn("Promise-chain cycle")):(a=fn(r))?a.call(r,u,c):u(r)):c(n)}catch(d){l&&!o&&l.exit(),c(d)}}(r[a++]);e._c=[],e._n=!1,t&&!e._h&&gn(e)}))}},gn=function(e){tn.call(k,(function(){var t,r,n,i=e._v,a=yn(e);if(a&&(t=jr((function(){cn?an.emit("unhandledRejection",i,e):(r=k.onunhandledrejection)?r({promise:e,reason:i}):(n=k.console)&&n.error&&n.error("Unhandled promise rejection",i)})),e._h=cn||yn(e)?2:1),e._a=void 0,a&&t.e)throw t.v}))},yn=function(e){return 1!==e._h&&0===(e._a||e._c).length},mn=function(e){tn.call(k,(function(){var t;cn?an.emit("rejectionHandled",e):(t=k.onrejectionhandled)&&t({promise:e,reason:e._v})}))},vn=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),pn(t,!0))},_n=function e(t){var r,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw nn("Promise can't be resolved itself");(r=fn(t))?rn((function(){var i={_w:n,_d:!1};try{r.call(t,B(e,i,1),B(vn,i,1))}catch(a){vn.call(i,a)}})):(n._v=t,n._s=1,pn(n,!1))}catch(i){vn.call({_w:n,_d:!1},i)}}};hn||(un=function(e){yr(this,un,"Promise","_h"),N(e),Jr.call(this);try{e(B(_n,this,1),B(vn,this,1))}catch(t){vn.call(this,t)}},(Jr=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=function(e,t,r){for(var n in t)r&&e[n]?e[n]=t[n]:J(e,n,t[n]);return e}(un.prototype,{then:function(e,t){var r=dn(wr(this,un));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=cn?an.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&pn(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),qr=function(){var e=new Jr;this.promise=e,this.resolve=B(_n,e,1),this.reject=B(vn,e,1)},Fr.f=dn=function(e){return e===un||e===en?new qr(e):Qr(e)}),q(q.G+q.W+q.F*!hn,{Promise:un}),De(un,"Promise"),function(e){var t="function"==typeof C[e]?C[e]:k[e];F&&t&&!t[Kr]&&Y.f(t,Kr,{configurable:!0,get:function(){return this}})}("Promise"),en=C.Promise,q(q.S+q.F*!hn,"Promise",{reject:function(e){var t=dn(this);return(0,t.reject)(e),t.promise}}),q(q.S+!0*q.F,"Promise",{resolve:function(e){return Wr(this===en?un:this,e)}}),q(q.S+q.F*!(hn&&function(e,t){if(!Yr)return!1;var r=!1;try{var n=[7],i=n[Xr]();i.next=function(){return{done:r=!0}},n[Xr]=function(){return i},e(n)}catch(a){}return r}((function(e){un.all(e).catch(ln)}))),"Promise",{all:function(e){var t=this,r=dn(t),n=r.resolve,i=r.reject,a=jr((function(){var r=[],a=0,o=1;Sr(e,!1,(function(e){var s=a++,u=!1;r.push(void 0),o++,t.resolve(e).then((function(e){u||(u=!0,r[s]=e,--o||n(r))}),i)})),--o||n(r)}));return a.e&&i(a.v),r.promise},race:function(e){var t=this,r=dn(t),n=r.reject,i=jr((function(){Sr(e,!1,(function(e){t.resolve(e).then(r.resolve,n)}))}));return i.e&&n(i.v),r.promise}}),q(q.P+q.R,"Promise",{finally:function(e){var t=wr(this,C.Promise||k.Promise),r="function"==typeof e;return this.then(r?function(r){return Wr(t,e()).then((function(){return r}))}:e,r?function(r){return Wr(t,e()).then((function(){throw r}))}:e)}}),q(q.S,"Promise",{try:function(e){var t=Fr.f(this),r=jr(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}});var bn=C.Promise,An=e(t((function(e){e.exports={default:bn,__esModule:!0}})));ee("keys",(function(){return function(e){return Se(S(e))}}));var En=C.Object.keys,Sn=e(t((function(e){e.exports={default:En,__esModule:!0}}))),Tn=t((function(e){function t(){}function r(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function n(e,t,n,i,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new r(n,i||e,a),u=s?s+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],o]:e._events[u].push(o):(e._events[u]=o,e._eventsCount++),e}function i(e,r){0==--e._eventsCount?e._events=new t:delete e._events[r]}function a(){this._events=new t,this._eventsCount=0}var o=Object.prototype.hasOwnProperty,s="~";Object.create&&(t.prototype=Object.create(null),(new t).__proto__||(s=!1)),a.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)o.call(e,t)&&r.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},a.prototype.listeners=function(e){var t=s?s+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,i=r.length,a=new Array(i);n<i;n++)a[n]=r[n].fn;return a},a.prototype.listenerCount=function(e){var t=s?s+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,n,i,a){var o=s?s+e:e;if(!this._events[o])return!1;var u,c,l=this._events[o],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,n),!0;case 5:return l.fn.call(l.context,t,r,n,i),!0;case 6:return l.fn.call(l.context,t,r,n,i,a),!0}for(c=1,u=new Array(d-1);c<d;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var h,f=l.length;for(c=0;c<f;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),d){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,r);break;case 4:l[c].fn.call(l[c].context,t,r,n);break;default:if(!u)for(h=1,u=new Array(d-1);h<d;h++)u[h-1]=arguments[h];l[c].fn.apply(l[c].context,u)}}return!0},a.prototype.on=function(e,t,r){return n(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return n(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,r,n){var a=s?s+e:e;if(!this._events[a])return this;if(!t)return i(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||n&&!o.once||r&&o.context!==r||i(this,a);else{for(var u=0,c=[],l=o.length;u<l;u++)(o[u].fn!==t||n&&!o[u].once||r&&o[u].context!==r)&&c.push(o[u]);c.length?this._events[a]=1===c.length?c[0]:c:i(this,a)}return this},a.prototype.removeAllListeners=function(e){var r;return e?(r=s?s+e:e,this._events[r]&&i(this,r)):(this._events=new t,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=s,a.EventEmitter=a,e.exports=a})),wn=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.url,n=t.method,i=void 0===n?"GET":n,a=t.type,o=void 0===a?"arraybuffer":a,s=t.timeout,u=void 0===s?1e4:s,c=t.data,l=void 0===c?{}:c,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ie(this,e),new An((function(e,t){var n=new window.XMLHttpRequest,a=i.toUpperCase(),s=[];for(var c in o&&(n.responseType=o),u&&(n.timeout=u),l)s.push("k="+l[c]);if(n.onload=function(){200===n.status||206===n.status?e({context:d,res:n}):t(new Error({context:d,res:n,type:"error"}))},n.onerror=function(e){t(new Error({context:d,res:n,type:"error"}))},n.ontimeout=function(e){t(new Error({context:d,res:n,type:"error"}))},n.onabort=function(){t(new Error({context:d,res:n,type:"error"}))},"GET"===a)n.open(a,""+r),n.send();else{if("post"!==a)throw new Error("xhr "+a+" is not supported");n.open(a,r),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(s.join("&"))}}))},Cn=/^WEBVTT/,kn=/^STYLE+$/,In=/^\:\:cue/,$n=/^}+$/,Pn=/^\[Script Info\].*/,xn=[/[0-9]{1,3}:[0-9]{2}:[0-9]{2}\.[0-9]{1,3}-->[0-9]{1,3}:[0-9]{2}:[0-9]{2}\.[0-9]{1,3}/,/[0-9]{1,2}:[0-9]{2}\.[0-9]{1,3}-->[0-9]{1,2}:[0-9]{2}\.[0-9]{1,3}/,/[0-9]{1,2}\.[0-9]{1,3}-->[0-9]{1,2}\.[0-9]{1,3}/],Rn=/^Format:\s/,On=/^Style:\s/,Dn=/^Dialogue:\s/,Ln=function(){function e(){ie(this,e)}return er(e,null,[{key:"parseJson",value:function(e){for(var t=[],r=0,n=0;n<e.length;n++){if(r>=50&&(r=0),0===r){var i={start:e[n].start,list:[e[n]],end:e[n].end};t.push(i)}else t[t.length-1].list.push(e[n]),t[t.length-1].end=e[n].end;r++}return t}},{key:"parse",value:function(t,r){var n=e.checkFormat(t);n||r({format:n});try{var i=[];"ass"===n?i=e.parseASS(t):"vtt"===n&&(i=e.parseVTT(t)),r({format:n,list:i.list,styles:i.styles})}catch(a){console.error(a),r({format:n},a)}}},{key:"parseASSItem",value:function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split(","),r={},i="";try{var o=t.length-e.length;return i=a(i=(i=o>0?t.splice(e.length-1,o+1).join(",")+"":t[t.length-1]+"").replace(/\\n+/g,"")),t[e.length-1]=i,e.map((function(e,i){"end"===e||"start"===e?r[e]=n(t[i].split(":")):"text"===e?r[e]=[t[i]]:"layer"===e?(r[e]=[t[i]],r.textTag=[t[i]]):r[e]="style"===e?[t[i]]:Number(t[i])?Number(t[i]):t[i]})),r}catch(s){return console.error(s),{}}}},{key:"parseASS",value:function(t){for(var r=t.split("\n"),n=[],i=0,a=0,o=[],s=[],u=null;i<r.length;){if(Rn.test(r[i]))s=(s=r[i].replace(Rn,"").replace(/\s+/g,"").split(",")).map((function(e){return e.toLocaleLowerCase()}));else if(On.test(r[i]))o.push(r[i].replace(On,"").replace(/\s+/g,""));else if(Dn.test(r[i])){var c=e.parseASSItem(r[i].replace(Dn,""),s);if(u&&c.start===u.start&&c.end===u.end)try{var l=u,d=l.text,h=l.textTag,f=l.style;d.push(c.text[0]),h.push(c.textTag[0]),f.push(c.style[0])}catch(g){console.error(g)}else{u=c;var p=null;a%50==0?((p={start:u.start,end:u.end,list:[]}).list.push(u),n.push(p)):((p=n[n.length-1]).end=u.end,p.list.push(u)),a++}}i++}return{list:n,style:{}}}},{key:"parseVTTStyle",value:function(e,t){var r=e.split(":");if(r.length>1){var n=r[0].trim().split("-"),i="";n.length>1?n.map((function(e,t){i+=0===t?e:e.charAt(0).toUpperCase()+e.slice(1)})):i=n[0],t[i]=r[1].trim().replace(/;$/,"")}return t}},{key:"parseVTT",value:function(e){for(var t=(e=e.replace(Cn,"")).split("\n"),r=[],n=0,a=0,s=null,u=!1,c=!1,l=null,d=null,h=[];n<t.length;){var f=o(n,t).trim();if(!f||u&&i(f))u=!f;else if(In.test(f)&&kn.test(o(n-1,t).trim())){c=!0;var p=/\((.+?)\)/g.exec(f);d=p?p[1]:"",l=""}else if(c)$n.test(f)?(h.push({key:d,style:l}),l=null,d=null,c=!1):l+=f;else if(f){u=!1;var g=this.checkIsTime(t[n]);if(g){var y=this.parseVttTime(g);if(!s||y.start!==s.start||y.end!==s.end){(s=y).text=[],s.textTag=[];var m=null;a%50==0?((m={start:s.start,end:s.end,list:[]}).list.push(s),r.push(m)):((m=r[r.length-1]).end=s.end,m.list.push(s)),a++}}else if(s){var v=s,_=v.text,b=v.textTag,A=this.parseVttText(t[n]);_.push(A.text),b.push(A.tag)}u=!1}n++}return{list:r,styles:h}}},{key:"checkIsTime",value:function(e){e=e.replace(/\s+/g,"");for(var t=0,r=null;t<xn.length&&!(r=xn[t].exec(e));)t++;return r?r[0]:null}},{key:"parseVttText",value:function(e){var t=/^(<?.+?>)/g.exec(e),r="",n="default";if(t){n=t[0].replace(/\<|\>|\&/g,"");var i=RegExp("^<"+n+">(([\\s\\S])*?)</"+n+">$").exec(e);i?r=i[1]:(r=e,n="")}else r=e;for(var o=/<(\w+).(\w+)>/g,s=o.exec(r);s&&s.length>2;)r=r.replace(s[0],"<"+s[1]+' class="'+s[2]+'">'),s=o.exec(r);return{tag:n,text:a(r.replace(/\\n+/g,"<br/>"))}}},{key:"parseVttTime",value:function(e){var t=e.split("--\x3e"),r=void 0,i=0;if(2===t.length){var a=t[0].split(":"),o=t[1].split(":");r=n(a),i=n(o)}return{start:r,end:i,time:e}}},{key:"isVTT",value:function(e){return Cn.test(e)}},{key:"isASS",value:function(e){return Pn.test(e)}},{key:"checkFormat",value:function(e){return e?Cn.test(e)?"vtt":Pn.test(e)?"ass":null:null}}]),e}(),Mn=function(){function e(){var t=this;ie(this,e),this.__handlers=[],window.ResizeObserver&&(this.observer=new window.ResizeObserver((function(e){t.__trigger(e)})))}return er(e,[{key:"addObserver",value:function(e,t){if(this.observer){this.observer&&this.observer.observe(e);for(var r=this.__handlers,n=-1,i=0;i<r.length;i++)r[i]&&e===r[i].target&&(n=i);n>-1?this.__handlers[n].handler.push(t):this.__handlers.push({target:e,handler:[t]})}}},{key:"unObserver",value:function(e){var t=-1;this.__handlers.map((function(r,n){e===r.target&&(t=n)})),this.observer&&this.observer.unobserve(e),t>-1&&this.__handlers.splice(t,1)}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(e,t){for(var r=this.__handlers,n=0;n<r.length;n++)if(r[n]&&e===r[n].target){r[n].handler&&r[n].handler.map((function(r){try{r(e,t)}catch(n){console.error(n)}}));break}}},{key:"__trigger",value:function(e){var t=this;e.map((function(e){var r=e.contentRect;t.__runHandler(e.target,r)}))}}]),e}(),Nn=null;!function(e,t){void 0===t&&(t={});var r=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===r&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}('xg-text-track.xg-text-track {\n  font-family: "PingFang SC","SF Pro SC","SF Pro Text","SF Pro Icons","Helvetica Neue","Helvetica","Arial",sans-serif;\n  -webkit-font-smoothing: antialiased;\n  position: absolute;\n  bottom: 0;\n  color: #fff;\n  left: 0;\n  right: 0;\n  pointer-events: none;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center; }\n  xg-text-track.xg-text-track.text-track-no-fitvideo {\n    margin-bottom: 2%; }\n  xg-text-track.xg-text-track.text-track-hide {\n    opacity: 0;\n    visibility: hidden; }\n  xg-text-track.xg-text-track.text-track-show {\n    opacity: 1;\n    visibility: visible; }\n  xg-text-track.xg-text-track xg-text-track-inner {\n    display: block;\n    max-width: 92%; }\n  xg-text-track.xg-text-track xg-text-track-span {\n    display: -webkit-box;\n    text-align: center;\n    text-overflow: ellipsis;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    padding: 1px 4px;\n    -webkit-line-clamp: 1;\n    line-height: 120%;\n    word-break: break-word; }\n    xg-text-track.xg-text-track xg-text-track-span.text-track-deputy {\n      font-size: 75%; }\n    xg-text-track.xg-text-track xg-text-track-span.text-track-single {\n      -webkit-line-clamp: 1; }\n    xg-text-track.xg-text-track xg-text-track-span.text-track-double {\n      -webkit-line-clamp: 2; }\n    xg-text-track.xg-text-track xg-text-track-span.text-track-three {\n      -webkit-line-clamp: 3; }\n  xg-text-track.xg-text-track.text-track-bg xg-text-track-inner {\n    background-color: rgba(0, 0, 0, .54);\n    border-radius: 2px; }\n  xg-text-track.xg-text-track.text-track-stroke xg-text-track-inner {\n    background-color: none;\n    border-radius: 0;\n    text-shadow: -1px 1px 0 rgba(0, 0, 0, .7), 1px 1px 0 rgba(0, 0, 0, .7), 1px -1px 0 rgba(0, 0, 0, .7), -1px -1px 0 rgba(0, 0, 0, .7); }\n');var Bn=[{code:0,msg:"SUCCESS"},{code:1,msg:"LOAD_ERROR"},{code:2,msg:"PARSER_ERROR"},{code:3,msg:"FORMAT_NOT_SUPPORTED"},{code:4,msg:"ID_OR_LANGUAGE_NOT_EXIST"},{code:5,msg:"PARAMETERS_ERROR"},{code:6,msg:"ABORT"},{code:7,msg:"UNKNOWN"},{code:8,msg:"DATA_ERROR:subtitle.url is null"}],Un={RESIZE:"resize"},Gn=!1;return function(e){function t(e){ie(this,t);var r=zt(this,(t.__proto__||ne(t)).call(this));return Gn=p(),r.currentText=null,r.textTrack=[],r._cid=-1,r._gid=-1,r._cids=[],r._iId=null,r._iC=0,r.player=null,r.root=null,r.config={line:"double",bottom:0,mode:"stroke",defaultOpen:!1,baseSizeX:49,baseSizeY:28,minSize:16,minMobileSize:13,fitVideo:!0,offsetBottom:2,fontColor:"#fff"},r._ctime=0,r._loadingTrack={},Sn(r.config).map((function(t){void 0!==e[t]&&null!==e[t]&&(r.config[t]=e[t])})),r._isOpen=!1,r._videoMeta={scale:0,videoHeight:0,videoWidth:0,lwidth:0,lheight:0,vWidth:0,vHeight:0,vBottom:0,vLeft:0,marginBottom:0},e.subTitles&&"Array"===h(e.subTitles)?(e.player&&r.attachPlayer(e.player),r.setSubTitles(e.subTitles,r.config.defaultOpen),r):zt(r)}return dr(t,e),er(t,[{key:"version",get:function(){return"1.0.12"}}]),er(t,[{key:"setSubTitles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this._isOpen||r;n&&this.innerRoot&&this.switchOff(),this.currentText=null,this.textTrack=[],e.map((function(e){var r={};Sn(e).map((function(t){r[t]=e[t]})),r.isDefault&&(t.currentText=r),t.textTrack.push(r)})),this.currentText&&b(this.currentText).then((function(e){t.addStyles(e),i&&t.switch()}))}},{key:"addStyles",value:function(e){var t=e.styles,r=e.format;t&&"vtt"===r&&(t.map((function(e){e.key||(e.key="xg-text-track-span")})),g(t,"xg-text-track"))}},{key:"attachPlayer",value:function(e){var t=this;if(e){this.player&&this.detachPlayer();var r=this.config,n=r.fontColor,i=r.mode,a=r.fitVideo;this.player=e,this.root=document.createElement("xg-text-track"),this.root.className="xg-text-track",!this._isOpen&&u(this.root,"text-track-hide"),!a&&u(this.root,"text-track-no-fitvideo"),i&&u(this.root,"text-track-"+i),this.innerRoot=document.createElement("xg-text-track-inner"),this.root.appendChild(this.innerRoot),n&&(this.root.style.color=n),this.currentText&&["language","id","label"].map((function(e){t.root.setAttribute("data-"+e,t.currentText[e]||"")})),this.player.root.appendChild(this.root),["destroy","__onTimeupdate","_onResize"].map((function(e){t[e]=t[e].bind(t)})),this.player.on("destroy",this.destroy),this.player.on("timeupdate",this.__onTimeupdate),this._isOpen&&this.switch(),y(e.root,this._onResize)}}},{key:"detachPlayer",value:function(){var e=this.player;e&&(e.off("destroy",this.destroy),e.off("timeupdate",this.__onTimeupdate),e.root&&(m(e.root,this._onResize),e.root.removeChild(this.root)),this.innerRoot=null,this.root=null,this.player=null)}},{key:"switch",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:"",language:""};return this._loadingTrack=t,new An((function(r,n){if(t.id||t.language)if(e.currentText&&A(t,e.currentText))e._loadingTrack={},e._updateCurrent(e.currentText),e._isOpen=!0,e.show(),r(v(0));else{for(var i=null,a=0;a<e.textTrack.length;a++)if(A(t,e.textTrack[a])){i=e.textTrack[a];break}if(i)i.list?(e._loadingTrack={},e._updateCurrent(i),e._isOpen=!0,e.show(),r(v(0))):b(i).then((function(t){if(e.addStyles(t),e._loadingTrack.id===i.id||e._loadingTrack.language===t.language)e._loadingTrack={},e._updateCurrent(t),e._isOpen=!0,e.show(),r(v(0));else{var a=v(6,{message:"check _loadingTrack fail id: "+e._loadingTrack.id+"  nextSubtitle:"+t.id});console.trace(a),n(a)}})).catch((function(e){n(e)}));else{var o=v(4,new Error("The is no subtitle with id:[{"+t.id+"}] or language:["+t.language+"]"));console.trace(o),n(o)}}else{if(e.currentText){e._loadingTrack={},e._updateCurrent(e.currentText),e._isOpen=!0,e.show();var s=v(0,{message:"switch default subtitle success"});return void r(s)}var u=v(5,{message:"no default subtitle"});n(u)}}))}},{key:"switchOff",value:function(){this._isOpen=!1,this.hide()}},{key:"_updateCurrent",value:function(e){var t=this;if(this.root){this.currentText=e,["language","id","label"].map((function(e){t.root.setAttribute("data-"+e,t.currentText[e]||"")})),this.__remove(this._cids);var r=this.player.currentTime;this._cids=[],this._gid=-1,this._cid=-1,this._update(r)}}},{key:"__loadAll",value:function(){this.textTrack.map((function(e){b(e)}))}},{key:"getDelCid",value:function(e,t){for(var r=[],n=0;n<e.length;n++)t.includes(e[n])||r.push(e[n]);return r}},{key:"getNewCid",value:function(e,t){for(var r=[],n=0;n<t.length;n++)e.includes(t[n])||r.push(t[n]);return r}},{key:"_update",value:function(e){var t=this,r=l(e,this.currentText.list,this._gid),n=[];if(r>-1&&(n=d(e,this.currentText.list[r].list,this._cid)),n.length<1)return this._cids.length>0&&this.__remove(this._cids),void(this._cids=[]);if(this._cids!==n||r!==this._gid){this._gid=r,this._cid=n[0];var i=this.getDelCid(this._cids,n),a=this.getNewCid(this._cids,n);this._cids=n,this.__remove(i);var o=[];a.map((function(e){var n=t.currentText.list[r].list[e];n.index=e,o.push(n)})),this.__render(o,e)}}},{key:"__onTimeupdate",value:function(){if(this._isOpen){var e=this.player.video,t=e.videoWidth,r=e.videoHeight;!this._videoMeta.scale&&t&&r&&this._onResize(this.player.root);var n=this.player.currentTime;Math.round(Math.abs(1e3*n-this._ctime))<200||(this._ctime=1e3*n,this.currentText&&this.currentText.list&&this._update(n))}}},{key:"_onResize",value:function(e){var t=this._videoMeta;if(e&&e instanceof window.Element||(e=this.player.root),this._iId&&(clearTimeout(this._iId),this._iId=null),!t.scale){if(!this.player.video)return;var r=this.player.video,n=r.videoWidth,i=r.videoHeight;if(!n||!i)return;t.videoWidth=n,t.videoHeight=i,t.scale=parseInt(i/n*100,10)}this.__startResize(e)}},{key:"resize",value:function(e,t){var r=this,n=this.config,i=n.baseSizeX,a=n.baseSizeY,o=n.minMobileSize,s=n.minSize,u=n.fitVideo,c=n.offsetBottom,l=this._videoMeta.scale;this._videoMeta.lwidth=e,this._videoMeta.lheight=t;var d=void 0,h=0;t/e*100>=l?(h=parseInt(l*e,10)/100,d=e):(h=t,d=parseInt(t/l*100,10)),this._videoMeta.vWidth=d,this._videoMeta.vHeight=h;var f=0,p=0;l>120?(f=a,p=parseInt(f*h/1080,10)):(f=i,p=parseInt(f*d/1920,10));var g=Gn?o:s,y={fontSize:p=p<g?g:p>f?f:p},m=parseInt((t-h)/2,10),v=parseInt((e-d)/2,10),_=parseInt(h*c,10)/100;this._videoMeta.vBottom=m,this._videoMeta.vLeft=v,this._videoMeta.marginBottom=_,u&&(y.bottom=m+_,y.left=y.right=v),Sn(y).map((function(e){r.root.style[e]=y[e]+"px"})),this.emit(Un.RESIZE,{vLeft:v,vBottom:m,marginBottom:_,vWidth:d,vHeight:h,fontSize:p,scale:l})}},{key:"__startResize",value:function(e){var t=this,r=e.getBoundingClientRect(),n=this._videoMeta,i=r.width,a=r.height;if(this._iId&&(clearTimeout(this._iId),this._iId=null),i>0&&a>0&&(i!==n.lwidth||a!==n.lheight))this._iC=0,this.resize(i,a);else{if(this._iC>=5)return void(this._iC=0);this._iC++,this._iId=setTimeout((function(){t.__startResize(e)}),50)}}},{key:"__remove",value:function(e){var t=this;if(e&&!(e.length<1)){for(var r=this.innerRoot.children,n=[],i=0;i<r.length;i++){var a=Number(r[i].getAttribute("data-index"));e.includes(a)&&n.push(r[i])}n.map((function(e){t.innerRoot.removeChild(e)}))}}},{key:"__render",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length>0&&t.map((function(t){var r="text-track-"+e.config.line;t.text.map((function(n,i){i>0&&(r+=" text-track-deputy");var a={"data-start":t.start,"data-end":t.end,"data-index":t.index};e.innerRoot.appendChild(f("xg-text-track-span",n,a,r))}))}))}},{key:"show",value:function(){c(this.root,"text-track-hide")}},{key:"hide",value:function(){u(this.root,"text-track-hide"),this.innerRoot.innerHTML=""}},{key:"destroy",value:function(){this.detachPlayer(),this.removeAllListeners(),this.player=null,this.textTrack=null}},{key:"marginBottom",get:function(){var e=this._videoMeta,t=e.bottom,r=e.marginBottom;return this.config.fitVideo?t+r:r}}]),t}(Tn)}()}(index_min$2);var SubTitles=getDefaultExportFromCjs(index_min$2.exports),DEFAULT_CLOSE_TYPE$1="text-close";function formatList$1(e){var t=-1;return e.map((function(e,r){e.id||e.language||(e.id=r),!e.url&&(e.url=e.src),!e.text&&(e.text=e.label),!e.language&&(e.language=e.srclang),void 0===e.isDefault&&(e.isDefault=e.default),(e.isDefault||e.default)&&(t<0?t=r:e.isDefault=e.default=!1)})),t}var TextTrack=function(e){_inherits$7(r,e);var t=_createSuper$t(r);function r(){var e;_classCallCheck$7(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$8(_assertThisInitialized$7(e=t.call.apply(t,[this].concat(i))),"clickSwitch",(function(t,r){e.subTitles&&(r.type===DEFAULT_CLOSE_TYPE$1?e.switchOffSubtile():e.switchSubTitle({language:r.language,id:r.id}))})),_defineProperty$8(_assertThisInitialized$7(e),"onPlayerFocus",(function(t){e.subTitles&&e.config.style.follow&&e.rePosition()})),_defineProperty$8(_assertThisInitialized$7(e),"onPlayerBlur",(function(t){e.subTitles&&e.config.style.follow&&!e.playerConfig.marginControls&&e.subTitles.root&&(e.subTitles.root.style.transform="translate(0, 0)")})),e}return _createClass$8(r,[{key:"beforeCreate",value:function(e){var t=e.player.config.texttrack||e.player.config.textTrack;"Array"===util$2.typeOf(t)&&(e.config.list=t)}},{key:"afterCreate",value:function(){var e=this.config,t=e.list,n=e.style,i=e.isDefaultOpen;this.curIndex=-1,this.curItem=null;var a=formatList$1(t);_get$1(_getPrototypeOf$7(r.prototype),"afterCreate",this).call(this);var o={subTitles:t,defaultOpen:i};this.handlerClickSwitch=this.hook("subtitle_change",this.clickSwitch),Object.keys(n).map((function(e){o[e]=n[e]})),!this.playerConfig.marginControls&&this.player.controls.root&&(this.on(PLAYER_FOCUS,this.onPlayerFocus),this.on(PLAYER_BLUR,this.onPlayerBlur)),this.subTitles=new SubTitles(o),this.subTitles.attachPlayer(this.player),n.follow&&this.subTitles.root&&util$2.addClass(this.subTitles.root,"follow-control"),t&&0!==t.length&&(i&&a<0?(t[0].isDefault=!0,this.curIndex=0,this.curItem=t[0]):(this.curIndex=a,this.curItem=t[a]))}},{key:"show",value:function(){this.config.list&&0!==this.config.list.length&&_get$1(_getPrototypeOf$7(r.prototype),"show",this).call(this)}},{key:"updateSubtitles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e){var r=[];e.map((function(e){r.push(e)}));var n=formatList$1(r);this.curIndex=n,this.curItem=n>-1?r[n]:null;var i=n>-1;this.config.list=r,this.subTitles&&this.subTitles.setSubTitles(r,i,t),r.length>0?this.show():(this.switchOffSubtile(),this.hide()),this.renderItemList()}}},{key:"switchSubTitle",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:"",language:""},r=-1;t&&(t.id||t.language)&&(this.config.list.map((function(e,n){e.id!==t.id&&e.language!==t.language||(r=n)})),r===this.curIndex||r<0||this.subTitles.switch(t).then((function(n){0===n.code&&(t.off=!1,t.isListUpdate=!1,t.list=[],e.curIndex=r,e.curItem=e.config.list[r-1],e.renderItemList(),e.emit("subtitle_change",t))})))}},{key:"switchOffSubtile",value:function(){this.subTitles.switchOff(),this.emit("subtitle_change",{off:!0,isListUpdate:!1,list:[]}),this.curIndex=0,this.curItem=null,this.renderItemList()}},{key:"onItemClick",value:function(e,t){_get$1(_getPrototypeOf$7(r.prototype),"onItemClick",this).apply(this,arguments);var n=e.delegateTarget,i=n.getAttribute("language"),a=n.getAttribute("data-id"),o=n.getAttribute("data-type");this.handlerClickSwitch(e,{language:i,id:a,type:o})}},{key:"changeCurrentText",value:function(){var e=this.config,t=e.list,r=e.closeText,n=this.curIndex;if(n-1<0)this.find(".icon-text").innerHTML=this.getTextByLang(r,"iconText");else if(n-1<t.length){var i=t[n-1];if(!i)return;this.find(".icon-text").innerHTML=this.getTextByLang(i,"iconText")}}},{key:"renderItemList",value:function(){var e=this,t=this.config,n=t.list,i=t.closeText,a=[];a.push({showText:this.getTextByLang(i),"data-type":DEFAULT_CLOSE_TYPE$1,selected:-1===this.curIndex}),n.map((function(t,r){var n={language:t.language||t.srclang,"data-id":t.id};n.selected=e.curIndex===r,n.showText=e.getTextByLang(t),a.push(n)})),_get$1(_getPrototypeOf$7(r.prototype),"renderItemList",this).call(this,a,this.curIndex+1)}},{key:"rePosition",value:function(){var e=this.config.style.fitVideo,t=0-this.player.controls.root.getBoundingClientRect().height;if(e){var r=this.player,n=r.video,i=r.root.getBoundingClientRect(),a=i.height,o=i.width,s=n.videoHeight,u=n.videoWidth,c=parseInt(s/u*100,10)*o/100;c>a&&(c=a);var l=(a-c)/2-t;l<0&&(this.subTitles.root.style.transform="translate(0, ".concat(l,"px)"))}else this.subTitles.root.style.transform="translate(0, ".concat(t,"px)")}},{key:"destroy",value:function(){this.subTitles&&(this.subTitles.destroy(),this.subTitles=null),_get$1(_getPrototypeOf$7(r.prototype),"destroy",this).call(this)}}],[{key:"pluginName",get:function(){return"texttrack"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:6,list:[],isDefaultOpen:!0,style:{follow:!0,mode:"stroke",followBottom:50,fitVideo:!0,offsetBottom:2,baseSizeX:49,baseSizeY:28,minSize:16,minMobileSize:13,line:"double",fontColor:"#fff"},closeText:{text:"ä¸å¼€å¯",iconText:"å­—å¹•"},className:"xgplayer-texttrack",hidePortrait:!1,isShowIcon:!0}}}]),r}(OptionsIcon),es=Object.freeze(Object.defineProperty({__proto__:null,Events:Events$1,SimplePlayer:Player,Plugin:Plugin,BasePlugin:BasePlugin,STATE_CLASS:STATE_CLASS,I18N:I18N,Errors:Errors$1,Sniffer:sniffer$1,Util:util$2,default:PresetPlayer,STATES:STATES$3,DefaultPresetEn:DefaultPreset$2,DefaultPreset:DefaultPreset$3,LivePreset:DefaultPreset$1,MobilePreset:DefaultPreset,langZhHk:zhHk,langJp:jp$1,langZhCn:ZH,Danmu:Danmu,TextTrack:TextTrack,DanmuIcon:DanmuIcon,DanmuPanel:DanmuPanel},Symbol.toStringTag,{value:"Module"})),DefinitionLinked={origin:{index:1,next:"uhd",prev:null},uhd:{index:2,next:"hd",prev:"origin"},hd:{index:3,next:"sd",prev:"uhd"},sd:{index:4,next:"ld",prev:"hd"},ld:{index:5,next:"ao",prev:"sd"},ao:{index:6,next:null,prev:"ld"}},PLAYER_LANGS=["zh","en","jp","zh-hk"],PLAYER_MODE={NORMAL:0,INNER:1,FULLSCREEN:2},VIDEO_STATUS_TYPE=function(e){return e[e.VALID=10]="VALID",e[e.TRANSCODING=30]="TRANSCODING",e[e.NO_SET_AUDIT=1e3]="NO_SET_AUDIT",e[e.OFFLINE=1002]="OFFLINE",e[e.NO_AUTH=2001]="NO_AUTH",e[e.UN_AUTH=2002]="UN_AUTH",e}(VIDEO_STATUS_TYPE||{}),safeJSONDecode=function(t){try{return JSON.parse(t)}catch(e){return console.warn("[utils/json] decode fail: ".concat(t),e),null}},parseToken=function(e){if(e){var t={},r=safeJSONDecode(window.atob(e));if(r&&"string"==typeof r.GetPlayInfoToken)r.GetPlayInfoToken.split("&").map((function(e){var r=e.split("=");r[0]&&r[1]&&(t[r[0]]=r[1])}));return t}},isEncryptPlay=function(e){var t,r;if(null==e||!e.playAuthToken)return!1;var n=parseToken(null==e?void 0:e.playAuthToken),i=null!==(t=null==n||null===(r=n.FileType)||void 0===r?void 0:r.toLocaleString())&&void 0!==t?t:"video";return!!n&&("evideo"===i||"eaudio"===i)},VideoFileTypes=["video","evideo"],getFormat=function(e){var t,r,n;if(null==e||!e.playAuthToken)return"";var i=parseToken(null==e?void 0:e.playAuthToken),a=null!==(t=null==i||null===(r=i.FileType)||void 0===r?void 0:r.toLocaleString())&&void 0!==t?t:"video",o=null==i||null===(n=i.Format)||void 0===n?void 0:n.toLocaleString();return o||(VideoFileTypes.includes(a)?"mp4":"m4a")},isHls=function(e){return e&&0<e.toLowerCase().indexOf(".m3u8")},isMp4=function(e){return e&&0<e.toLowerCase().indexOf(".mp4")},isFlv=function(e){return e&&0<e.toLowerCase().indexOf(".flv")},isRtm=function(e){return e&&0<e.toLowerCase().indexOf(".sdp")},isDash=function(e){return e&&0<e.toLowerCase().indexOf(".mpd")},getStreamType=function(e){return isHls(e)?"hls":isFlv(e)?"flv":isRtm(e)?"rtm":isMp4(e)?"mp4":isDash(e)?"dash":"mp4"},getDefinitionInfo=function(e,t){if(!e||!e.Definition)return{definition:""};if(t){var r=t[e.Definition];return r?"string"==typeof r?{definition:r}:_objectSpread2$7({},r||{}):{definition:e.Definition}}return{definition:e.Definition}},retPromise$1=function(e){return e&&e.then?e:new Promise((function(e){e(null)}))},addUrlParam=function(e,t){if(!t)return e;var r=Object.entries(t).map((function(e){var t=_slicedToArray$2(e,2),r=t[0],n=t[1];return"".concat(r,"=").concat(null!=n?n:"")})).join("&");return e+=(-1===e.indexOf("?")?"?":"&")+r},getPluginConfig=function(e,t){var r;if(t&&e)return Object.keys(e).map((function(n){n.toLowerCase()===t.toLowerCase()&&(r=e[n])})),r},setPluginConfig=function(e,t,r,n){if(t&&r&&e)return Object.keys(e).map((function(i){i.toLowerCase()===t.toLowerCase()&&(e[i][r]=n)})),e},formatDemotePriority=function(e){var t=(null==e?void 0:e.length)&&e.reduce((function(t,r,n){return t[r]={next:n+1>=e.length?null:e[n+1],pre:0===n?null:e[n-1]},t}),{});return console.log(t),t},matchHtmlRegExp=/["'&<>]/;function escapeHtml(e){var t,r=""+e,n=matchHtmlRegExp.exec(r);if(!n)return r;var i,a="",o=0;for(i=n.index;i<r.length;i++){switch(r.charCodeAt(i)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#x27;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}o!==i&&(a+=r.substring(o,i)),o=i+1,a+=t}return o!==i?a+r.substring(o,i):a}var _excluded$6=["options","type","isLive","id","root","plugins","defaultConfig","languages","url","encodeType","playList","streamType","isMobile","useSoftDecoding"],PlayerData=function(){function e(t){_classCallCheck$8(this,e),this.id="",this.type="",this.isLive=!1,this.options=null,this.isMobile=!1,this.playList=[],this.plugins=[],this.openSoftDecoding=!1,this.current={lineId:0,language:"",definition:"",streamType:""};var r=t.options,n=t.type,i=t.isLive,a=t.id,o=t.root,s=t.plugins,u=void 0===s?[]:s,c=t.defaultConfig,l=t.languages;t.url;var d=t.encodeType;t.playList,t.streamType;var h=t.isMobile,f=void 0!==h&&h,p=t.useSoftDecoding,g=void 0!==p&&p,y=_objectWithoutProperties$3(t,_excluded$6);this.configs=t,this.options=Object.assign({},r,y),this.options.poster=escapeHtml(this.options.poster),this.id=a,this.root=o,this.type=n,this.isLive=!!(null!=i?i:"live"===n),this.defaultConfig=c,this.languageData=this.initI18nData(l),this.isMobile=f||"mobile"===sniffer$1.device,this.openSoftDecoding=g,this.encodeType=d,this.initPlayData(t),this.current=MyProxy$1.observe(this.current),this.playList=MyProxy$1.observe(this.playList),this.plugins=_toConsumableArray$3(u)}return _createClass$9(e,[{key:"initPlayData",value:function(e){var t=this.initPlaylistAndGetCurrent(e);this.initCurrent(t)}},{key:"initPlaylistAndGetCurrent",value:function(e){var t,r=e.url,n=e.playList,i=e.streamType,a=void 0===i?"":i,o=null;if(n&&(this.playList=_toConsumableArray$3(n)),r)if(0===this.playList.length)this.playList=[_objectSpread2$7(_objectSpread2$7({},this.current),{},{url:r,streamType:a})];else{var s=this.getUrlList({url:r});s.length>0?o=s[0]:console.log("é»˜è®¤urlä¸åœ¨Playlistä¸­")}var u=this.getCurrentByDefaultConfig();return u&&(o=u),null!==(t=o)&&void 0!==t?t:this.playList[0]}},{key:"getCurrentByDefaultConfig",value:function(){if(this.defaultConfig){var e=this.defaultConfig,t=e.type,r=e.isLive,n=e.lineId,i=void 0===n?"":n,a=e.definition,o=void 0===a?"":a;if((null!=r?r:"live"===t)===this.isLive){if(!i&&!o)return console.log("é»˜è®¤é…ç½®æœªè®¾ç½®é»˜è®¤çº¿è·¯æˆ–é»˜è®¤æ¸…æ™°åº¦"),void(this.isHitDefault=!1);var s=this.getUrlList({lineId:i,definition:o});return s.length>0?(this.isHitDefault=!0,s[0]):(console.log("playlistä¸­æ²¡æœ‰æ»¡è¶³é»˜è®¤é…ç½®çš„æµ"),void(this.isHitDefault=!1))}}}},{key:"initCurrent",value:function(e){var t=this;Object.keys(this.current).forEach((function(r){t.current[r]=null==e?void 0:e[r]}))}},{key:"initI18nData",value:function(e){var t=[jp$1,zhHk],r=e&&Object.entries(e).reduce((function(e,r){var n=_slicedToArray$2(r,2),i=n[0],a=n[1];return PLAYER_LANGS.includes(i)?e.push({LANG:"zh"===i?"zh-cn":i,TEXT:a}):t.push({LANG:i,TEXT:a}),e}),[]);return{extraLangList:t,extendLangList:r}}},{key:"getCurrentUrl",value:function(){var e;return null===(e=this.getCurrentStreams()[0])||void 0===e?void 0:e.url}},{key:"getCurrentStreamType",value:function(){var e=this.getCurrentStreams();if(e.length){var t=e[0],r=t.url;return t.streamType||getStreamType(r)}return this.configs.streamType}},{key:"getCurrentStreams",value:function(){var e=this.current;return this.getUrlList(e)}},{key:"getLineList",value:function(){return cloneDeep(uniqBy(this.playList,"lineId"))}},{key:"getLineListByLineId",value:function(e){return this.playList.filter((function(t){var r;return(null==e?void 0:e.toString())===(null===(r=t.lineId)||void 0===r?void 0:r.toString())}))}},{key:"getDefinitionListByLineId",value:function(e){return cloneDeep(uniqBy(this.getLineListByLineId(e),"definition"))}},{key:"getUrlList",value:function(e){return this.playList.filter((function(t){return Object.keys(e).every((function(r){var n,i,a=(null===(n=e[r])||void 0===n?void 0:n.toString())===(null===(i=t[r])||void 0===i?void 0:i.toString()),o=!e[r];return a||o}))}))}},{key:"getNextDefinition",value:function(){var e,t,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1?arguments[1]:void 0,i=r?"next":"prev",a=this.current,o=a.definition,s=a.lineId;if(o){var u=null===(e=this.getCurrentStreams())||void 0===e?void 0:e[0],c="auto"===o?u.mapDefinition:o,l=formatDemotePriority(n)||DefinitionLinked,d=Object.keys(l);if(d.includes(c)){for(var h=null===(t=l[c])||void 0===t?void 0:t[i],f=this.getDefinitionListByLineId(s);0===f.filter((function(e){return e.definition===h})).length&&h;){var p;h=null===(p=l[h])||void 0===p?void 0:p[i]}if(h)return"auto"===o&&h&&(u.mapDefinition=h),this.getUrlList({lineId:s,definition:h});console.log("å·²ç»é™è‡³æœ€ä½Žçº§")}}}}]),e}();function ownKeys$h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$5(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$h(Object(r),!0).forEach((function(t){_defineProperty$7(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _regeneratorRuntime$4(){_regeneratorRuntime$4=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(C){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i,a,o,s,u=t&&t.prototype instanceof d?t:d,h=Object.create(u.prototype),f=new S(n||[]);return h._invoke=(i=e,a=r,o=f,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return{value:void 0,done:!0}}for(o.method=e,o.arg=t;;){var r=o.delegate;if(r){var n=b(r,o);if(n){if(n===l)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===s)throw s="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s="executing";var u=c(i,a,o);if("normal"===u.type){if(s=o.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:o.done}}"throw"===u.type&&(s="completed",o.method="throw",o.arg=u.arg)}}),h}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(C){return{type:"throw",arg:C}}}e.wrap=u;var l={};function d(){}function h(){}function f(){}var p={};s(p,i,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(T([])));y&&y!==t&&r.call(y,i)&&(p=y);var m=f.prototype=d.prototype=Object.create(p);function v(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function n(i,a,o,s){var u=c(e[i],e,a);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==_typeof$7(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(d).then((function(e){l.value=e,o(l)}),(function(e){return n("throw",e,o,s)}))}s(u.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function b(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function T(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:w}}function w(){return{value:void 0,done:!0}}return h.prototype=f,s(m,"constructor",f),s(f,"constructor",h),h.displayName=s(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},v(_.prototype),s(_.prototype,a,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new _(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},v(m),s(m,o,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=T,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;E(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function asyncGeneratorStep$6(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(error){return void r(error)}s.done?t(u):Promise.resolve(u).then(n,i)}function _asyncToGenerator$6(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$6(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$6(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck$6(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$7(e,t,r){return t&&_defineProperties$7(e.prototype,t),r&&_defineProperties$7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$7(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$6(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$6(e,t)}function _getPrototypeOf$6(e){return(_getPrototypeOf$6=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$6(e,t){return(_setPrototypeOf$6=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$t(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _assertThisInitialized$6(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$6(e,t){if(t&&("object"===_typeof$7(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$6(e)}function _createSuper$s(e){var t=_isNativeReflectConstruct$t();return function(){var r,n=_getPrototypeOf$6(e);if(t){var i=_getPrototypeOf$6(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$6(this,r)}}function ownKeys$g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$4(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$g(Object(r),!0).forEach((function(t){_defineProperty$6(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _regeneratorRuntime$3(){_regeneratorRuntime$3=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(C){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i,a,o,s,u=t&&t.prototype instanceof d?t:d,h=Object.create(u.prototype),f=new S(n||[]);return h._invoke=(i=e,a=r,o=f,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return{value:void 0,done:!0}}for(o.method=e,o.arg=t;;){var r=o.delegate;if(r){var n=b(r,o);if(n){if(n===l)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===s)throw s="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s="executing";var u=c(i,a,o);if("normal"===u.type){if(s=o.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:o.done}}"throw"===u.type&&(s="completed",o.method="throw",o.arg=u.arg)}}),h}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(C){return{type:"throw",arg:C}}}e.wrap=u;var l={};function d(){}function h(){}function f(){}var p={};s(p,i,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(T([])));y&&y!==t&&r.call(y,i)&&(p=y);var m=f.prototype=d.prototype=Object.create(p);function v(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function n(i,a,o,s){var u=c(e[i],e,a);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==_typeof$7(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(d).then((function(e){l.value=e,o(l)}),(function(e){return n("throw",e,o,s)}))}s(u.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function b(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function T(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:w}}function w(){return{value:void 0,done:!0}}return h.prototype=f,s(m,"constructor",f),s(f,"constructor",h),h.displayName=s(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},v(_.prototype),s(_.prototype,a,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new _(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},v(m),s(m,o,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=T,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;E(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function _typeof$5(e){return(_typeof$5="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep$5(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(error){return void r(error)}s.done?t(u):Promise.resolve(u).then(n,i)}function _asyncToGenerator$5(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$5(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$5(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck$5(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$6(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$6(e,t,r){return t&&_defineProperties$6(e.prototype,t),r&&_defineProperties$6(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$6(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$5(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$5(e,t)}function _getPrototypeOf$5(e){return(_getPrototypeOf$5=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$5(e,t){return(_setPrototypeOf$5=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _construct$3(e,t,r){return(_construct$3=_isNativeReflectConstruct$s()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&_setPrototypeOf$5(i,r.prototype),i}).apply(null,arguments)}function _isNativeFunction$3(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _wrapNativeSuper$3(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper$3=function(e){if(null===e||!_isNativeFunction$3(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct$3(e,arguments,_getPrototypeOf$5(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf$5(r,e)},_wrapNativeSuper$3(e)}function _objectWithoutPropertiesLoose$2(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function _objectWithoutProperties$2(e,t){if(null==e)return{};var r,n,i=_objectWithoutPropertiesLoose$2(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function _assertThisInitialized$5(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$5(e,t){if(t&&("object"===_typeof$7(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$5(e)}function _createSuper$r(e){var t=_isNativeReflectConstruct$s();return function(){var r,n=_getPrototypeOf$5(e);if(t){var i=_getPrototypeOf$5(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$5(this,r)}}function _unsupportedIterableToArray$6(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$6(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$6(e,t):void 0}}function _arrayLikeToArray$6(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _createForOfIteratorHelper$4(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$6(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function createPublicPromise$3(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return r.used=!1,r.resolve=function(){return r.used=!0,e.apply(void 0,arguments)},r.reject=function(){return r.used=!0,t.apply(void 0,arguments)},r}var Buffer$2=function(){function e(){_classCallCheck$5(this,e)}return _createClass$6(e,null,[{key:"start",value:function(e){return e&&e.length?1===e.length&&e.end(0)-e.start(0)<1e-6||1===e.length&&e.start(0)<0?0:e.start(0):0}},{key:"end",value:function(e){return e&&e.length?1===e.length&&e.end(0)-e.start(0)<1e-6?0:e.end(e.length-1):0}},{key:"get",value:function(e){if(e)try{return e.buffered}catch(error){}}},{key:"buffers",value:function(e,t){if(!e||!e.length)return[];for(var r=[],n=0,i=e.length;n<i;n++){var a=r.length;if(a&&t){var o=r[a-1],s=o[1];if(e.start(n)-s<=t){var u=e.end(n);u>s&&(o[1]=u)}else r.push([e.start(n),e.end(n)])}else r.push([e.start(n),e.end(n)])}return r}},{key:"length",value:function(e){return e&&e.length?e.reduce((function(e,t){return e+(t[1]-t[0])}),0):0}},{key:"info",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!t||!t.length)return{start:0,end:0,buffers:[]};for(var i=0,a=0,o=0,s=0,u=0,c=0,l=0,d=e.buffers(t,n),h=0,f=d.length;h<f;h++){var p=d[h];if(r+n>=p[0]&&r<p[1])i=p[0],a=p[1],o=h;else{if(r+n<p[0]){s=p[0],u=p[1];break}r+n>p[1]&&(c=p[0],l=p[1])}}return{start:i,end:a,index:o,buffers:d,nextStart:s,nextEnd:u,prevStart:c,prevEnd:l,currentTime:r,behind:r-i,remaining:a?a-r:0,length:e.length&&e.length(d)}}}]),e}(),_ERR_CODE$1,ERR$1={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",SUB_TYPES:{FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",OPTION:"OPTION"}},ERR_CODE$1=(_ERR_CODE$1={},_defineProperty$6(_ERR_CODE$1,ERR$1.MANIFEST,{HLS:1100}),_defineProperty$6(_ERR_CODE$1,ERR$1.NETWORK,2100),_defineProperty$6(_ERR_CODE$1,ERR$1.NETWORK_TIMEOUT,2101),_defineProperty$6(_ERR_CODE$1,ERR$1.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400}),_defineProperty$6(_ERR_CODE$1,ERR$1.REMUX,{FMP4:4100,MP4:4200}),_defineProperty$6(_ERR_CODE$1,ERR$1.MEDIA,{MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202}),_defineProperty$6(_ERR_CODE$1,ERR$1.OTHER,8e3),_ERR_CODE$1),StreamingError$1=function(e){_inherits$5(r,e);var t=_createSuper$r(r);function r(e,n,i,a,o){var s;return _classCallCheck$5(this,r),(s=t.call(this,o||(null==i?void 0:i.message))).errorType=e===ERR$1.NETWORK_TIMEOUT?ERR$1.NETWORK:e,s.originError=i,s.ext=a,s.errorCode=ERR_CODE$1[e][n]||ERR_CODE$1[e],s.errorMessage=s.message,s.errorCode||(s.errorType=ERR$1.OTHER,s.errorCode=ERR_CODE$1[s.errorType]),s}return _createClass$6(r,null,[{key:"create",value:function(e,t,n,i,a){return e instanceof r?e:(e instanceof Error&&(n=e,e=""),e||(e=ERR$1.OTHER),new r(e,t,n,i,a))}},{key:"network",value:function(e){var t;return new r(null!=e&&e.isTimeout?ERR$1.NETWORK_TIMEOUT:ERR$1.NETWORK,e,null,{url:null==e?void 0:e.url,response:null==e?void 0:e.response,httpCode:null==e||null===(t=e.response)||void 0===t?void 0:t.status})}}]),r}(_wrapNativeSuper$3(Error)),isBrowser$3="undefined"!=typeof window;function getMediaSource(){try{return isBrowser$3?window.MediaSource:null}catch(e){}}var MediaSource$1=getMediaSource(),MSE$3=function(){function e(t){var r=this;_classCallCheck$5(this,e),_defineProperty$6(this,"media",null),_defineProperty$6(this,"mediaSource",null),_defineProperty$6(this,"_openPromise",createPublicPromise$3()),_defineProperty$6(this,"_queue",Object.create(null)),_defineProperty$6(this,"_sourceBuffer",Object.create(null)),_defineProperty$6(this,"_onSBUpdateEnd",(function(e){var t=r._queue[e];if(t){var n=t.shift();n&&(n.promise.resolve(),r._startQueue(e))}})),_defineProperty$6(this,"_onSBUpdateError",(function(e,t){var n=r._queue[e];if(n){var i=n[0];i&&i.promise.reject(new StreamingError$1(ERR$1.MEDIA,ERR$1.SUB_TYPES.MSE_APPEND_BUFFER,t))}})),t&&this.bindMedia(t)}var t,r,n;return _createClass$6(e,[{key:"isOpened",get:function(){var e;return"open"===(null===(e=this.mediaSource)||void 0===e?void 0:e.readyState)}},{key:"duration",get:function(){var e;return(null===(e=this.mediaSource)||void 0===e?void 0:e.duration)||-1}},{key:"updateDuration",value:function(e){var t=this;return this._enqueueBlockingOp((function(){t.mediaSource&&(t.mediaSource.duration=e)}))}},{key:"open",value:function(){var e=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var t=this.mediaSource;t.addEventListener("sourceopen",(function r(){t.removeEventListener("sourceopen",r),e._openPromise.resolve()})),this._openPromise=createPublicPromise$3()}return this._openPromise}},{key:"bindMedia",value:(n=_asyncToGenerator$5(_regeneratorRuntime$3().mark((function e(t){var r,n,i=this;return _regeneratorRuntime$3().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mediaSource&&!this.media){e.next=3;break}return e.next=3,this.unbindMedia();case 3:if(t&&MediaSource$1){e.next=5;break}throw new Error("Param media or MediaSource does not exist");case 5:return this.media=t,r=this.mediaSource=new MediaSource$1,t.src=URL.createObjectURL(r),n=function e(){r.removeEventListener("sourceopen",e),URL.revokeObjectURL(t.src),i._openPromise.resolve()},r.addEventListener("sourceopen",n),e.abrupt("return",this._openPromise);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"unbindMedia",value:(r=_asyncToGenerator$5(_regeneratorRuntime$3().mark((function e(){var t,r,n,i=this;return _regeneratorRuntime$3().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._openPromise.used||this._openPromise.resolve(),t=this.mediaSource){if(Object.keys(this._queue).forEach((function(e){var t=i._queue[e];t&&t.forEach((function(e){return e.promise.resolve}))})),r=!!this.media&&this.media.readyState>=1,n="open"===t.readyState,r&&n)try{t.endOfStream()}catch(error){}Object.keys(this._sourceBuffer).forEach((function(e){try{t.removeSourceBuffer(i._sourceBuffer[e])}catch(error){}}))}if(this.media){this.media.removeAttribute("src");try{this.media.load()}catch(error){}this.media=null}this.mediaSource=null,this._openPromise=createPublicPromise$3(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"createSource",value:function(e,t){if(!this._sourceBuffer[e]&&this.mediaSource){var r;try{r=this._sourceBuffer[e]=this.mediaSource.addSourceBuffer(t)}catch(error){throw new StreamingError$1(ERR$1.MEDIA,ERR$1.SUB_TYPES.MSE_ADD_SB,error)}r.mimeType=t,r.addEventListener("updateend",this._onSBUpdateEnd.bind(this,e)),r.addEventListener("error",this._onSBUpdateError.bind(this,e))}}},{key:"changeType",value:function(e,t){var r=this._sourceBuffer[e];return this.mediaSource&&r&&r.mimeType!==t&&"function"==typeof r.changeType?this._enqueueOp((function(){r.changeType(t)})):Promise.resolve()}},{key:"createOrChangeSource",value:function(e,t){return this.createSource(e,t),this.changeType(e,t)}},{key:"append",value:function(e,t){var r=this;return t&&t.byteLength&&this._sourceBuffer[e]?this._enqueueOp(e,(function(){var n;r.mediaSource&&(null===(n=r._sourceBuffer[e])||void 0===n||n.appendBuffer(t))})):Promise.resolve()}},{key:"remove",value:function(e,t,r){var n=this;return 1===Object.keys(this._sourceBuffer).length?Promise.resolve():this._enqueueOp(e,(function(){if(n.mediaSource){var i=n._sourceBuffer[e];t>=r||!i?n._onSBUpdateEnd(e):i.remove(t,r)}}))}},{key:"clearBuffer",value:function(e,t){var r,n=this;return Object.keys(this._sourceBuffer).forEach((function(i){r=n._enqueueOp(i,(function(){n.mediaSource&&n._sourceBuffer[i].remove(e,t)}))})),r}},{key:"clearAllBuffer",value:function(){var e,t=this;return Object.keys(this._sourceBuffer).forEach((function(r){e=t._enqueueOp(r,(function(){if(t.mediaSource){var e=t._sourceBuffer[r];e.remove(0,Buffer$2.end(Buffer$2.get(e)))}}))})),e}},{key:"endOfStream",value:function(e){var t=this;return this.mediaSource&&"open"===this.mediaSource.readyState?this._enqueueBlockingOp((function(){var r=t.mediaSource;r&&"open"===r.readyState&&(e?r.endOfStream(e):r.endOfStream())})):Promise.resolve()}},{key:"setLiveSeekableRange",value:function(e,t){var r=this.mediaSource;e<0||t<e||null==r||!r.setLiveSeekableRange||"open"!==r.readyState||r.setLiveSeekableRange(e,t)}},{key:"buffered",value:function(e){return Buffer$2.get(this._sourceBuffer[e])}},{key:"bufferStart",value:function(e){return Buffer$2.start(this.buffered(e))}},{key:"bufferEnd",value:function(e){return Buffer$2.end(this.buffered(e))}},{key:"_enqueueOp",value:function(e,t){if(!this.mediaSource)return Promise.resolve();var r=this._queue[e]=this._queue[e]||[],n={exec:t,promise:createPublicPromise$3()};return r.push(n),1===r.length&&this._startQueue(e),n.promise}},{key:"_enqueueBlockingOp",value:(t=_asyncToGenerator$5(_regeneratorRuntime$3().mark((function e(t){var r,n,i=this;return _regeneratorRuntime$3().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mediaSource){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if((r=Object.keys(this._sourceBuffer)).length){e.next=5;break}return e.abrupt("return",t());case 5:return n=[],r.forEach((function(e){var t=i._queue[e],r=createPublicPromise$3();n.push(r),t.push({exec:function(){return r.resolve()},promise:r}),1===t.length&&i._startQueue(e)})),e.abrupt("return",Promise.all(n).then((function(){try{return t()}finally{r.forEach((function(e){var t=i._queue[e],r=i._sourceBuffer[e];null==t||t.shift(),r&&r.updating||i._startQueue(e)}))}})));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_startQueue",value:function(e){var t=this._queue[e];if(t){var r=t[0];if(r)try{r.exec()}catch(error){r.promise.reject(new StreamingError$1(ERR$1.MEDIA,ERR$1.SUB_TYPES.MSE_OTHER,error)),t.shift(),this._startQueue(e)}}}}],[{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if(!MediaSource$1)return!1;try{return MediaSource$1.isTypeSupported(e)}catch(error){return!1}}}]),e}();_defineProperty$6(MSE$3,"VIDEO","video"),_defineProperty$6(MSE$3,"AUDIO","audio");var $$X=_export,NativePromiseConstructor=promiseNativeConstructor,fails$v=fails$10,getBuiltIn$8=getBuiltIn$j,isCallable$4=isCallable$v,speciesConstructor$2=speciesConstructor$5,promiseResolve=promiseResolve$2,defineBuiltIn$7=defineBuiltIn$l,NativePromisePrototype=NativePromiseConstructor&&NativePromiseConstructor.prototype,NON_GENERIC=!!NativePromiseConstructor&&fails$v((function(){NativePromisePrototype.finally.call({then:function(){}},(function(){}))}));if($$X({target:"Promise",proto:!0,real:!0,forced:NON_GENERIC},{finally:function(e){var t=speciesConstructor$2(this,getBuiltIn$8("Promise")),r=isCallable$4(e);return this.then(r?function(r){return promiseResolve(t,e()).then((function(){return r}))}:e,r?function(r){return promiseResolve(t,e()).then((function(){throw r}))}:e)}}),isCallable$4(NativePromiseConstructor)){var method=getBuiltIn$8("Promise").prototype.finally;NativePromisePrototype.finally!==method&&defineBuiltIn$7(NativePromisePrototype,"finally",method,{unsafe:!0})}var typedArrayConstructor={exports:{}},arrayBufferBasicDetection="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,NATIVE_ARRAY_BUFFER$2=arrayBufferBasicDetection,DESCRIPTORS$e=descriptors,global$m=global$O,isCallable$3=isCallable$v,isObject$h=isObject$y,hasOwn$b=hasOwnProperty_1,classof$5=classof$h,tryToString$1=tryToString$7,createNonEnumerableProperty$2=createNonEnumerableProperty$c,defineBuiltIn$6=defineBuiltIn$l,defineProperty$8=objectDefineProperty.f,isPrototypeOf$3=objectIsPrototypeOf,getPrototypeOf$1=objectGetPrototypeOf,setPrototypeOf$2=objectSetPrototypeOf,wellKnownSymbol$5=wellKnownSymbol$u,uid$2=uid$5,InternalStateModule$5=internalState,enforceInternalState$1=InternalStateModule$5.enforce,getInternalState$4=InternalStateModule$5.get,Int8Array$4=global$m.Int8Array,Int8ArrayPrototype$1=Int8Array$4&&Int8Array$4.prototype,Uint8ClampedArray$1=global$m.Uint8ClampedArray,Uint8ClampedArrayPrototype=Uint8ClampedArray$1&&Uint8ClampedArray$1.prototype,TypedArray$1=Int8Array$4&&getPrototypeOf$1(Int8Array$4),TypedArrayPrototype$2=Int8ArrayPrototype$1&&getPrototypeOf$1(Int8ArrayPrototype$1),ObjectPrototype$3=Object.prototype,TypeError$2=global$m.TypeError,TO_STRING_TAG=wellKnownSymbol$5("toStringTag"),TYPED_ARRAY_TAG$1=uid$2("TYPED_ARRAY_TAG"),TYPED_ARRAY_CONSTRUCTOR="TypedArrayConstructor",NATIVE_ARRAY_BUFFER_VIEWS$3=NATIVE_ARRAY_BUFFER$2&&!!setPrototypeOf$2&&"Opera"!==classof$5(global$m.opera),TYPED_ARRAY_TAG_REQUIRED=!1,NAME,Constructor,Prototype,TypedArrayConstructorsList={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},BigIntArrayConstructorsList={BigInt64Array:8,BigUint64Array:8},isView=function(e){if(!isObject$h(e))return!1;var t=classof$5(e);return"DataView"===t||hasOwn$b(TypedArrayConstructorsList,t)||hasOwn$b(BigIntArrayConstructorsList,t)},getTypedArrayConstructor$4=function e(t){var r=getPrototypeOf$1(t);if(isObject$h(r)){var n=getInternalState$4(r);return n&&hasOwn$b(n,TYPED_ARRAY_CONSTRUCTOR)?n[TYPED_ARRAY_CONSTRUCTOR]:e(r)}},isTypedArray$1=function(e){if(!isObject$h(e))return!1;var t=classof$5(e);return hasOwn$b(TypedArrayConstructorsList,t)||hasOwn$b(BigIntArrayConstructorsList,t)},aTypedArray$s=function(e){if(isTypedArray$1(e))return e;throw TypeError$2("Target is not a typed array")},aTypedArrayConstructor$4=function(e){if(isCallable$3(e)&&(!setPrototypeOf$2||isPrototypeOf$3(TypedArray$1,e)))return e;throw TypeError$2(tryToString$1(e)+" is not a typed array constructor")},exportTypedArrayMethod$t=function(e,t,r,n){if(DESCRIPTORS$e){if(r)for(var i in TypedArrayConstructorsList){var a=global$m[i];if(a&&hasOwn$b(a.prototype,e))try{delete a.prototype[e]}catch(error){try{a.prototype[e]=t}catch(o){}}}TypedArrayPrototype$2[e]&&!r||defineBuiltIn$6(TypedArrayPrototype$2,e,r?t:NATIVE_ARRAY_BUFFER_VIEWS$3&&Int8ArrayPrototype$1[e]||t,n)}},exportTypedArrayStaticMethod$1=function(e,t,r){var n,i;if(DESCRIPTORS$e){if(setPrototypeOf$2){if(r)for(n in TypedArrayConstructorsList)if((i=global$m[n])&&hasOwn$b(i,e))try{delete i[e]}catch(error){}if(TypedArray$1[e]&&!r)return;try{return defineBuiltIn$6(TypedArray$1,e,r?t:NATIVE_ARRAY_BUFFER_VIEWS$3&&TypedArray$1[e]||t)}catch(error){}}for(n in TypedArrayConstructorsList)!(i=global$m[n])||i[e]&&!r||defineBuiltIn$6(i,e,t)}};for(NAME in TypedArrayConstructorsList)Constructor=global$m[NAME],Prototype=Constructor&&Constructor.prototype,Prototype?enforceInternalState$1(Prototype)[TYPED_ARRAY_CONSTRUCTOR]=Constructor:NATIVE_ARRAY_BUFFER_VIEWS$3=!1;for(NAME in BigIntArrayConstructorsList)Constructor=global$m[NAME],Prototype=Constructor&&Constructor.prototype,Prototype&&(enforceInternalState$1(Prototype)[TYPED_ARRAY_CONSTRUCTOR]=Constructor);if((!NATIVE_ARRAY_BUFFER_VIEWS$3||!isCallable$3(TypedArray$1)||TypedArray$1===Function.prototype)&&(TypedArray$1=function(){throw TypeError$2("Incorrect invocation")},NATIVE_ARRAY_BUFFER_VIEWS$3))for(NAME in TypedArrayConstructorsList)global$m[NAME]&&setPrototypeOf$2(global$m[NAME],TypedArray$1);if((!NATIVE_ARRAY_BUFFER_VIEWS$3||!TypedArrayPrototype$2||TypedArrayPrototype$2===ObjectPrototype$3)&&(TypedArrayPrototype$2=TypedArray$1.prototype,NATIVE_ARRAY_BUFFER_VIEWS$3))for(NAME in TypedArrayConstructorsList)global$m[NAME]&&setPrototypeOf$2(global$m[NAME].prototype,TypedArrayPrototype$2);if(NATIVE_ARRAY_BUFFER_VIEWS$3&&getPrototypeOf$1(Uint8ClampedArrayPrototype)!==TypedArrayPrototype$2&&setPrototypeOf$2(Uint8ClampedArrayPrototype,TypedArrayPrototype$2),DESCRIPTORS$e&&!hasOwn$b(TypedArrayPrototype$2,TO_STRING_TAG))for(NAME in TYPED_ARRAY_TAG_REQUIRED=!0,defineProperty$8(TypedArrayPrototype$2,TO_STRING_TAG,{get:function(){return isObject$h(this)?this[TYPED_ARRAY_TAG$1]:void 0}}),TypedArrayConstructorsList)global$m[NAME]&&createNonEnumerableProperty$2(global$m[NAME],TYPED_ARRAY_TAG$1,NAME);var arrayBufferViewCore={NATIVE_ARRAY_BUFFER_VIEWS:NATIVE_ARRAY_BUFFER_VIEWS$3,TYPED_ARRAY_TAG:TYPED_ARRAY_TAG_REQUIRED&&TYPED_ARRAY_TAG$1,aTypedArray:aTypedArray$s,aTypedArrayConstructor:aTypedArrayConstructor$4,exportTypedArrayMethod:exportTypedArrayMethod$t,exportTypedArrayStaticMethod:exportTypedArrayStaticMethod$1,getTypedArrayConstructor:getTypedArrayConstructor$4,isView:isView,isTypedArray:isTypedArray$1,TypedArray:TypedArray$1,TypedArrayPrototype:TypedArrayPrototype$2},global$l=global$O,fails$u=fails$10,checkCorrectnessOfIteration$2=checkCorrectnessOfIteration$4,NATIVE_ARRAY_BUFFER_VIEWS$2=arrayBufferViewCore.NATIVE_ARRAY_BUFFER_VIEWS,ArrayBuffer$4=global$l.ArrayBuffer,Int8Array$3=global$l.Int8Array,typedArrayConstructorsRequireWrappers=!NATIVE_ARRAY_BUFFER_VIEWS$2||!fails$u((function(){Int8Array$3(1)}))||!fails$u((function(){new Int8Array$3(-1)}))||!checkCorrectnessOfIteration$2((function(e){new Int8Array$3,new Int8Array$3(null),new Int8Array$3(1.5),new Int8Array$3(e)}),!0)||fails$u((function(){return 1!==new Int8Array$3(new ArrayBuffer$4(2),1,void 0).length})),toIntegerOrInfinity$7=toIntegerOrInfinity$f,toLength$6=toLength$b,$RangeError$3=RangeError,toIndex$2=function(e){if(void 0===e)return 0;var t=toIntegerOrInfinity$7(e),r=toLength$6(t);if(t!==r)throw $RangeError$3("Wrong length or index");return r},$Array$1=Array,abs$1=Math.abs,pow$1=Math.pow,floor$3=Math.floor,log$3=Math.log,LN2=Math.LN2,pack=function(e,t,r){var n,i,a,o=$Array$1(r),s=8*r-t-1,u=(1<<s)-1,c=u>>1,l=23===t?pow$1(2,-24)-pow$1(2,-77):0,d=e<0||0===e&&1/e<0?1:0,h=0;for((e=abs$1(e))!=e||e===1/0?(i=e!=e?1:0,n=u):(n=floor$3(log$3(e)/LN2),e*(a=pow$1(2,-n))<1&&(n--,a*=2),(e+=n+c>=1?l/a:l*pow$1(2,1-c))*a>=2&&(n++,a/=2),n+c>=u?(i=0,n=u):n+c>=1?(i=(e*a-1)*pow$1(2,t),n+=c):(i=e*pow$1(2,c-1)*pow$1(2,t),n=0));t>=8;)o[h++]=255&i,i/=256,t-=8;for(n=n<<t|i,s+=t;s>0;)o[h++]=255&n,n/=256,s-=8;return o[--h]|=128*d,o},unpack=function(e,t){var r,n=e.length,i=8*n-t-1,a=(1<<i)-1,o=a>>1,s=i-7,u=n-1,c=e[u--],l=127&c;for(c>>=7;s>0;)l=256*l+e[u--],s-=8;for(r=l&(1<<-s)-1,l>>=-s,s+=t;s>0;)r=256*r+e[u--],s-=8;if(0===l)l=1-o;else{if(l===a)return r?NaN:c?-1/0:1/0;r+=pow$1(2,t),l-=o}return(c?-1:1)*r*pow$1(2,l-t)},ieee754={pack:pack,unpack:unpack},toObject$9=toObject$k,toAbsoluteIndex$3=toAbsoluteIndex$8,lengthOfArrayLike$d=lengthOfArrayLike$n,arrayFill$1=function(e){for(var t=toObject$9(this),r=lengthOfArrayLike$d(t),n=arguments.length,i=toAbsoluteIndex$3(n>1?arguments[1]:void 0,r),a=n>2?arguments[2]:void 0,o=void 0===a?r:toAbsoluteIndex$3(a,r);o>i;)t[i++]=e;return t},global$k=global$O,uncurryThis$v=functionUncurryThis,DESCRIPTORS$d=descriptors,NATIVE_ARRAY_BUFFER$1=arrayBufferBasicDetection,FunctionName=functionName,createNonEnumerableProperty$1=createNonEnumerableProperty$c,defineBuiltIns$1=defineBuiltIns$3,fails$t=fails$10,anInstance$5=anInstance$9,toIntegerOrInfinity$6=toIntegerOrInfinity$f,toLength$5=toLength$b,toIndex$1=toIndex$2,IEEE754=ieee754,getPrototypeOf=objectGetPrototypeOf,setPrototypeOf$1=objectSetPrototypeOf,getOwnPropertyNames$2=objectGetOwnPropertyNames.f,defineProperty$7=objectDefineProperty.f,arrayFill=arrayFill$1,arraySlice$5=arraySliceSimple,setToStringTag$3=setToStringTag$9,InternalStateModule$4=internalState,PROPER_FUNCTION_NAME=FunctionName.PROPER,CONFIGURABLE_FUNCTION_NAME=FunctionName.CONFIGURABLE,getInternalState$3=InternalStateModule$4.get,setInternalState$4=InternalStateModule$4.set,ARRAY_BUFFER$1="ArrayBuffer",DATA_VIEW="DataView",PROTOTYPE$1="prototype",WRONG_LENGTH$1="Wrong length",WRONG_INDEX="Wrong index",NativeArrayBuffer$1=global$k[ARRAY_BUFFER$1],$ArrayBuffer=NativeArrayBuffer$1,ArrayBufferPrototype$1=$ArrayBuffer&&$ArrayBuffer[PROTOTYPE$1],$DataView=global$k[DATA_VIEW],DataViewPrototype$1=$DataView&&$DataView[PROTOTYPE$1],ObjectPrototype$2=Object.prototype,Array$1=global$k.Array,RangeError$3=global$k.RangeError,fill=uncurryThis$v(arrayFill),reverse=uncurryThis$v([].reverse),packIEEE754=IEEE754.pack,unpackIEEE754=IEEE754.unpack,packInt8=function(e){return[255&e]},packInt16=function(e){return[255&e,e>>8&255]},packInt32=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},unpackInt32=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},packFloat32=function(e){return packIEEE754(e,23,4)},packFloat64=function(e){return packIEEE754(e,52,8)},addGetter$1=function(e,t){defineProperty$7(e[PROTOTYPE$1],t,{get:function(){return getInternalState$3(this)[t]}})},get=function(e,t,r,n){var i=toIndex$1(r),a=getInternalState$3(e);if(i+t>a.byteLength)throw RangeError$3(WRONG_INDEX);var o=getInternalState$3(a.buffer).bytes,s=i+a.byteOffset,u=arraySlice$5(o,s,s+t);return n?u:reverse(u)},set=function(e,t,r,n,i,a){var o=toIndex$1(r),s=getInternalState$3(e);if(o+t>s.byteLength)throw RangeError$3(WRONG_INDEX);for(var u=getInternalState$3(s.buffer).bytes,c=o+s.byteOffset,l=n(+i),d=0;d<t;d++)u[c+d]=l[a?d:t-d-1]};if(NATIVE_ARRAY_BUFFER$1){var INCORRECT_ARRAY_BUFFER_NAME=PROPER_FUNCTION_NAME&&NativeArrayBuffer$1.name!==ARRAY_BUFFER$1;if(fails$t((function(){NativeArrayBuffer$1(1)}))&&fails$t((function(){new NativeArrayBuffer$1(-1)}))&&!fails$t((function(){return new NativeArrayBuffer$1,new NativeArrayBuffer$1(1.5),new NativeArrayBuffer$1(NaN),1!=NativeArrayBuffer$1.length||INCORRECT_ARRAY_BUFFER_NAME&&!CONFIGURABLE_FUNCTION_NAME})))INCORRECT_ARRAY_BUFFER_NAME&&CONFIGURABLE_FUNCTION_NAME&&createNonEnumerableProperty$1(NativeArrayBuffer$1,"name",ARRAY_BUFFER$1);else{$ArrayBuffer=function(e){return anInstance$5(this,ArrayBufferPrototype$1),new NativeArrayBuffer$1(toIndex$1(e))},$ArrayBuffer[PROTOTYPE$1]=ArrayBufferPrototype$1;for(var keys$4=getOwnPropertyNames$2(NativeArrayBuffer$1),j=0,key$2;keys$4.length>j;)(key$2=keys$4[j++])in $ArrayBuffer||createNonEnumerableProperty$1($ArrayBuffer,key$2,NativeArrayBuffer$1[key$2]);ArrayBufferPrototype$1.constructor=$ArrayBuffer}setPrototypeOf$1&&getPrototypeOf(DataViewPrototype$1)!==ObjectPrototype$2&&setPrototypeOf$1(DataViewPrototype$1,ObjectPrototype$2);var testView=new $DataView(new $ArrayBuffer(2)),$setInt8=uncurryThis$v(DataViewPrototype$1.setInt8);testView.setInt8(0,2147483648),testView.setInt8(1,2147483649),!testView.getInt8(0)&&testView.getInt8(1)||defineBuiltIns$1(DataViewPrototype$1,{setInt8:function(e,t){$setInt8(this,e,t<<24>>24)},setUint8:function(e,t){$setInt8(this,e,t<<24>>24)}},{unsafe:!0})}else $ArrayBuffer=function(e){anInstance$5(this,ArrayBufferPrototype$1);var t=toIndex$1(e);setInternalState$4(this,{bytes:fill(Array$1(t),0),byteLength:t}),DESCRIPTORS$d||(this.byteLength=t)},ArrayBufferPrototype$1=$ArrayBuffer[PROTOTYPE$1],$DataView=function(e,t,r){anInstance$5(this,DataViewPrototype$1),anInstance$5(e,ArrayBufferPrototype$1);var n=getInternalState$3(e).byteLength,i=toIntegerOrInfinity$6(t);if(i<0||i>n)throw RangeError$3("Wrong offset");if(i+(r=void 0===r?n-i:toLength$5(r))>n)throw RangeError$3(WRONG_LENGTH$1);setInternalState$4(this,{buffer:e,byteLength:r,byteOffset:i}),DESCRIPTORS$d||(this.buffer=e,this.byteLength=r,this.byteOffset=i)},DataViewPrototype$1=$DataView[PROTOTYPE$1],DESCRIPTORS$d&&(addGetter$1($ArrayBuffer,"byteLength"),addGetter$1($DataView,"buffer"),addGetter$1($DataView,"byteLength"),addGetter$1($DataView,"byteOffset")),defineBuiltIns$1(DataViewPrototype$1,{getInt8:function(e){return get(this,1,e)[0]<<24>>24},getUint8:function(e){return get(this,1,e)[0]},getInt16:function(e){var t=get(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=get(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return unpackInt32(get(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return unpackInt32(get(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return unpackIEEE754(get(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return unpackIEEE754(get(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){set(this,1,e,packInt8,t)},setUint8:function(e,t){set(this,1,e,packInt8,t)},setInt16:function(e,t){set(this,2,e,packInt16,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){set(this,2,e,packInt16,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){set(this,4,e,packInt32,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){set(this,4,e,packInt32,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){set(this,4,e,packFloat32,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){set(this,8,e,packFloat64,t,arguments.length>2?arguments[2]:void 0)}});setToStringTag$3($ArrayBuffer,ARRAY_BUFFER$1),setToStringTag$3($DataView,DATA_VIEW);var arrayBuffer={ArrayBuffer:$ArrayBuffer,DataView:$DataView},isObject$g=isObject$y,floor$2=Math.floor,isIntegralNumber$1=Number.isInteger||function(e){return!isObject$g(e)&&isFinite(e)&&floor$2(e)===e},toIntegerOrInfinity$5=toIntegerOrInfinity$f,$RangeError$2=RangeError,toPositiveInteger$1=function(e){var t=toIntegerOrInfinity$5(e);if(t<0)throw $RangeError$2("The argument can't be less than 0");return t},toPositiveInteger=toPositiveInteger$1,$RangeError$1=RangeError,toOffset$2=function(e,t){var r=toPositiveInteger(e);if(r%t)throw $RangeError$1("Wrong offset");return r},classof$4=classof$h,uncurryThis$u=functionUncurryThis,slice$1=uncurryThis$u("".slice),isBigIntArray$2=function(e){return"Big"===slice$1(classof$4(e),0,3)},toPrimitive=toPrimitive$3,$TypeError$2=TypeError,toBigInt$3=function(e){var t=toPrimitive(e,"number");if("number"==typeof t)throw $TypeError$2("Can't convert number to bigint");return BigInt(t)},bind$5=functionBindContext,call$6=functionCall,aConstructor$1=aConstructor$3,toObject$8=toObject$k,lengthOfArrayLike$c=lengthOfArrayLike$n,getIterator=getIterator$4,getIteratorMethod=getIteratorMethod$5,isArrayIteratorMethod=isArrayIteratorMethod$3,isBigIntArray$1=isBigIntArray$2,aTypedArrayConstructor$3=arrayBufferViewCore.aTypedArrayConstructor,toBigInt$2=toBigInt$3,typedArrayFrom$1=function(e){var t,r,n,i,a,o,s,u,c=aConstructor$1(this),l=toObject$8(e),d=arguments.length,h=d>1?arguments[1]:void 0,f=void 0!==h,p=getIteratorMethod(l);if(p&&!isArrayIteratorMethod(p))for(u=(s=getIterator(l,p)).next,l=[];!(o=call$6(u,s)).done;)l.push(o.value);for(f&&d>2&&(h=bind$5(h,arguments[2])),r=lengthOfArrayLike$c(l),n=new(aTypedArrayConstructor$3(c))(r),i=isBigIntArray$1(n),t=0;r>t;t++)a=f?h(l[t],t):l[t],n[t]=i?toBigInt$2(a):+a;return n},$$W=_export,global$j=global$O,call$5=functionCall,DESCRIPTORS$c=descriptors,TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS$1=typedArrayConstructorsRequireWrappers,ArrayBufferViewCore$v=arrayBufferViewCore,ArrayBufferModule$2=arrayBuffer,anInstance$4=anInstance$9,createPropertyDescriptor$3=createPropertyDescriptor$a,createNonEnumerableProperty=createNonEnumerableProperty$c,isIntegralNumber=isIntegralNumber$1,toLength$4=toLength$b,toIndex=toIndex$2,toOffset$1=toOffset$2,toPropertyKey$2=toPropertyKey$6,hasOwn$a=hasOwnProperty_1,classof$3=classof$h,isObject$f=isObject$y,isSymbol$1=isSymbol$6,create$5=objectCreate$1,isPrototypeOf$2=objectIsPrototypeOf,setPrototypeOf=objectSetPrototypeOf,getOwnPropertyNames$1=objectGetOwnPropertyNames.f,typedArrayFrom=typedArrayFrom$1,forEach$2=arrayIteration.forEach,setSpecies$2=setSpecies$5,definePropertyModule$1=objectDefineProperty,getOwnPropertyDescriptorModule$2=objectGetOwnPropertyDescriptor,InternalStateModule$3=internalState,inheritIfRequired$2=inheritIfRequired$6,getInternalState$2=InternalStateModule$3.get,setInternalState$3=InternalStateModule$3.set,enforceInternalState=InternalStateModule$3.enforce,nativeDefineProperty$1=definePropertyModule$1.f,nativeGetOwnPropertyDescriptor$2=getOwnPropertyDescriptorModule$2.f,round=Math.round,RangeError$2=global$j.RangeError,ArrayBuffer$3=ArrayBufferModule$2.ArrayBuffer,ArrayBufferPrototype=ArrayBuffer$3.prototype,DataView$2=ArrayBufferModule$2.DataView,NATIVE_ARRAY_BUFFER_VIEWS$1=ArrayBufferViewCore$v.NATIVE_ARRAY_BUFFER_VIEWS,TYPED_ARRAY_TAG=ArrayBufferViewCore$v.TYPED_ARRAY_TAG,TypedArray=ArrayBufferViewCore$v.TypedArray,TypedArrayPrototype$1=ArrayBufferViewCore$v.TypedArrayPrototype,aTypedArrayConstructor$2=ArrayBufferViewCore$v.aTypedArrayConstructor,isTypedArray=ArrayBufferViewCore$v.isTypedArray,BYTES_PER_ELEMENT="BYTES_PER_ELEMENT",WRONG_LENGTH="Wrong length",fromList=function(e,t){aTypedArrayConstructor$2(e);for(var r=0,n=t.length,i=new e(n);n>r;)i[r]=t[r++];return i},addGetter=function(e,t){nativeDefineProperty$1(e,t,{get:function(){return getInternalState$2(this)[t]}})},isArrayBuffer=function(e){var t;return isPrototypeOf$2(ArrayBufferPrototype,e)||"ArrayBuffer"==(t=classof$3(e))||"SharedArrayBuffer"==t},isTypedArrayIndex=function(e,t){return isTypedArray(e)&&!isSymbol$1(t)&&t in e&&isIntegralNumber(+t)&&t>=0},wrappedGetOwnPropertyDescriptor=function(e,t){return t=toPropertyKey$2(t),isTypedArrayIndex(e,t)?createPropertyDescriptor$3(2,e[t]):nativeGetOwnPropertyDescriptor$2(e,t)},wrappedDefineProperty=function(e,t,r){return t=toPropertyKey$2(t),!(isTypedArrayIndex(e,t)&&isObject$f(r)&&hasOwn$a(r,"value"))||hasOwn$a(r,"get")||hasOwn$a(r,"set")||r.configurable||hasOwn$a(r,"writable")&&!r.writable||hasOwn$a(r,"enumerable")&&!r.enumerable?nativeDefineProperty$1(e,t,r):(e[t]=r.value,e)};DESCRIPTORS$c?(NATIVE_ARRAY_BUFFER_VIEWS$1||(getOwnPropertyDescriptorModule$2.f=wrappedGetOwnPropertyDescriptor,definePropertyModule$1.f=wrappedDefineProperty,addGetter(TypedArrayPrototype$1,"buffer"),addGetter(TypedArrayPrototype$1,"byteOffset"),addGetter(TypedArrayPrototype$1,"byteLength"),addGetter(TypedArrayPrototype$1,"length")),$$W({target:"Object",stat:!0,forced:!NATIVE_ARRAY_BUFFER_VIEWS$1},{getOwnPropertyDescriptor:wrappedGetOwnPropertyDescriptor,defineProperty:wrappedDefineProperty}),typedArrayConstructor.exports=function(e,t,r){var n=e.match(/\d+$/)[0]/8,i=e+(r?"Clamped":"")+"Array",a="get"+e,o="set"+e,s=global$j[i],u=s,c=u&&u.prototype,l={},d=function(e,t){nativeDefineProperty$1(e,t,{get:function(){return function(e,t){var r=getInternalState$2(e);return r.view[a](t*n+r.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,i){var a=getInternalState$2(e);r&&(i=(i=round(i))<0?0:i>255?255:255&i),a.view[o](t*n+a.byteOffset,i,!0)}(this,t,e)},enumerable:!0})};NATIVE_ARRAY_BUFFER_VIEWS$1?TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS$1&&(u=t((function(e,t,r,i){return anInstance$4(e,c),inheritIfRequired$2(isObject$f(t)?isArrayBuffer(t)?void 0!==i?new s(t,toOffset$1(r,n),i):void 0!==r?new s(t,toOffset$1(r,n)):new s(t):isTypedArray(t)?fromList(u,t):call$5(typedArrayFrom,u,t):new s(toIndex(t)),e,u)})),setPrototypeOf&&setPrototypeOf(u,TypedArray),forEach$2(getOwnPropertyNames$1(s),(function(e){e in u||createNonEnumerableProperty(u,e,s[e])})),u.prototype=c):(u=t((function(e,t,r,i){anInstance$4(e,c);var a,o,s,l=0,h=0;if(isObject$f(t)){if(!isArrayBuffer(t))return isTypedArray(t)?fromList(u,t):call$5(typedArrayFrom,u,t);a=t,h=toOffset$1(r,n);var f=t.byteLength;if(void 0===i){if(f%n)throw RangeError$2(WRONG_LENGTH);if((o=f-h)<0)throw RangeError$2(WRONG_LENGTH)}else if((o=toLength$4(i)*n)+h>f)throw RangeError$2(WRONG_LENGTH);s=o/n}else s=toIndex(t),a=new ArrayBuffer$3(o=s*n);for(setInternalState$3(e,{buffer:a,byteOffset:h,byteLength:o,length:s,view:new DataView$2(a)});l<s;)d(e,l++)})),setPrototypeOf&&setPrototypeOf(u,TypedArray),c=u.prototype=create$5(TypedArrayPrototype$1)),c.constructor!==u&&createNonEnumerableProperty(c,"constructor",u),enforceInternalState(c).TypedArrayConstructor=u,TYPED_ARRAY_TAG&&createNonEnumerableProperty(c,TYPED_ARRAY_TAG,i);var h=u!=s;l[i]=u,$$W({global:!0,constructor:!0,forced:h,sham:!NATIVE_ARRAY_BUFFER_VIEWS$1},l),BYTES_PER_ELEMENT in u||createNonEnumerableProperty(u,BYTES_PER_ELEMENT,n),BYTES_PER_ELEMENT in c||createNonEnumerableProperty(c,BYTES_PER_ELEMENT,n),setSpecies$2(i)}):typedArrayConstructor.exports=function(){};var createTypedArrayConstructor$7=typedArrayConstructor.exports;createTypedArrayConstructor$7("Uint8",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var ArrayBufferViewCore$u=arrayBufferViewCore,lengthOfArrayLike$b=lengthOfArrayLike$n,toIntegerOrInfinity$4=toIntegerOrInfinity$f,aTypedArray$r=ArrayBufferViewCore$u.aTypedArray,exportTypedArrayMethod$s=ArrayBufferViewCore$u.exportTypedArrayMethod;exportTypedArrayMethod$s("at",(function(e){var t=aTypedArray$r(this),r=lengthOfArrayLike$b(t),n=toIntegerOrInfinity$4(e),i=n>=0?n:r+n;return i<0||i>=r?void 0:t[i]}));var toObject$7=toObject$k,toAbsoluteIndex$2=toAbsoluteIndex$8,lengthOfArrayLike$a=lengthOfArrayLike$n,deletePropertyOrThrow$1=deletePropertyOrThrow$4,min$3=Math.min,arrayCopyWithin=[].copyWithin||function(e,t){var r=toObject$7(this),n=lengthOfArrayLike$a(r),i=toAbsoluteIndex$2(e,n),a=toAbsoluteIndex$2(t,n),o=arguments.length>2?arguments[2]:void 0,s=min$3((void 0===o?n:toAbsoluteIndex$2(o,n))-a,n-i),u=1;for(a<i&&i<a+s&&(u=-1,a+=s-1,i+=s-1);s-- >0;)a in r?r[i]=r[a]:deletePropertyOrThrow$1(r,i),i+=u,a+=u;return r},uncurryThis$t=functionUncurryThis,ArrayBufferViewCore$t=arrayBufferViewCore,$ArrayCopyWithin=arrayCopyWithin,u$ArrayCopyWithin=uncurryThis$t($ArrayCopyWithin),aTypedArray$q=ArrayBufferViewCore$t.aTypedArray,exportTypedArrayMethod$r=ArrayBufferViewCore$t.exportTypedArrayMethod;exportTypedArrayMethod$r("copyWithin",(function(e,t){return u$ArrayCopyWithin(aTypedArray$q(this),e,t,arguments.length>2?arguments[2]:void 0)}));var ArrayBufferViewCore$s=arrayBufferViewCore,$every$1=arrayIteration.every,aTypedArray$p=ArrayBufferViewCore$s.aTypedArray,exportTypedArrayMethod$q=ArrayBufferViewCore$s.exportTypedArrayMethod;exportTypedArrayMethod$q("every",(function(e){return $every$1(aTypedArray$p(this),e,arguments.length>1?arguments[1]:void 0)}));var ArrayBufferViewCore$r=arrayBufferViewCore,$fill=arrayFill$1,toBigInt$1=toBigInt$3,classof$2=classof$h,call$4=functionCall,uncurryThis$s=functionUncurryThis,fails$s=fails$10,aTypedArray$o=ArrayBufferViewCore$r.aTypedArray,exportTypedArrayMethod$p=ArrayBufferViewCore$r.exportTypedArrayMethod,slice=uncurryThis$s("".slice),CONVERSION_BUG=fails$s((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e}));exportTypedArrayMethod$p("fill",(function(e){var t=arguments.length;aTypedArray$o(this);var r="Big"===slice(classof$2(this),0,3)?toBigInt$1(e):+e;return call$4($fill,this,r,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),CONVERSION_BUG);var lengthOfArrayLike$9=lengthOfArrayLike$n,arrayFromConstructorAndList$3=function(e,t){for(var r=0,n=lengthOfArrayLike$9(t),i=new e(n);n>r;)i[r]=t[r++];return i},ArrayBufferViewCore$q=arrayBufferViewCore,speciesConstructor$1=speciesConstructor$5,aTypedArrayConstructor$1=ArrayBufferViewCore$q.aTypedArrayConstructor,getTypedArrayConstructor$3=ArrayBufferViewCore$q.getTypedArrayConstructor,typedArraySpeciesConstructor$4=function(e){return aTypedArrayConstructor$1(speciesConstructor$1(e,getTypedArrayConstructor$3(e)))},arrayFromConstructorAndList$2=arrayFromConstructorAndList$3,typedArraySpeciesConstructor$3=typedArraySpeciesConstructor$4,typedArrayFromSpeciesAndList=function(e,t){return arrayFromConstructorAndList$2(typedArraySpeciesConstructor$3(e),t)},ArrayBufferViewCore$p=arrayBufferViewCore,$filter=arrayIteration.filter,fromSpeciesAndList=typedArrayFromSpeciesAndList,aTypedArray$n=ArrayBufferViewCore$p.aTypedArray,exportTypedArrayMethod$o=ArrayBufferViewCore$p.exportTypedArrayMethod;exportTypedArrayMethod$o("filter",(function(e){var t=$filter(aTypedArray$n(this),e,arguments.length>1?arguments[1]:void 0);return fromSpeciesAndList(this,t)}));var ArrayBufferViewCore$o=arrayBufferViewCore,$find=arrayIteration.find,aTypedArray$m=ArrayBufferViewCore$o.aTypedArray,exportTypedArrayMethod$n=ArrayBufferViewCore$o.exportTypedArrayMethod;exportTypedArrayMethod$n("find",(function(e){return $find(aTypedArray$m(this),e,arguments.length>1?arguments[1]:void 0)}));var ArrayBufferViewCore$n=arrayBufferViewCore,$findIndex=arrayIteration.findIndex,aTypedArray$l=ArrayBufferViewCore$n.aTypedArray,exportTypedArrayMethod$m=ArrayBufferViewCore$n.exportTypedArrayMethod;exportTypedArrayMethod$m("findIndex",(function(e){return $findIndex(aTypedArray$l(this),e,arguments.length>1?arguments[1]:void 0)}));var ArrayBufferViewCore$m=arrayBufferViewCore,$forEach$1=arrayIteration.forEach,aTypedArray$k=ArrayBufferViewCore$m.aTypedArray,exportTypedArrayMethod$l=ArrayBufferViewCore$m.exportTypedArrayMethod;exportTypedArrayMethod$l("forEach",(function(e){$forEach$1(aTypedArray$k(this),e,arguments.length>1?arguments[1]:void 0)}));var ArrayBufferViewCore$l=arrayBufferViewCore,$includes$1=arrayIncludes.includes,aTypedArray$j=ArrayBufferViewCore$l.aTypedArray,exportTypedArrayMethod$k=ArrayBufferViewCore$l.exportTypedArrayMethod;exportTypedArrayMethod$k("includes",(function(e){return $includes$1(aTypedArray$j(this),e,arguments.length>1?arguments[1]:void 0)}));var ArrayBufferViewCore$k=arrayBufferViewCore,$indexOf$1=arrayIncludes.indexOf,aTypedArray$i=ArrayBufferViewCore$k.aTypedArray,exportTypedArrayMethod$j=ArrayBufferViewCore$k.exportTypedArrayMethod;exportTypedArrayMethod$j("indexOf",(function(e){return $indexOf$1(aTypedArray$i(this),e,arguments.length>1?arguments[1]:void 0)}));var global$i=global$O,fails$r=fails$10,uncurryThis$r=functionUncurryThis,ArrayBufferViewCore$j=arrayBufferViewCore,ArrayIterators=es_array_iterator,wellKnownSymbol$4=wellKnownSymbol$u,ITERATOR$2=wellKnownSymbol$4("iterator"),Uint8Array$2=global$i.Uint8Array,arrayValues=uncurryThis$r(ArrayIterators.values),arrayKeys=uncurryThis$r(ArrayIterators.keys),arrayEntries=uncurryThis$r(ArrayIterators.entries),aTypedArray$h=ArrayBufferViewCore$j.aTypedArray,exportTypedArrayMethod$i=ArrayBufferViewCore$j.exportTypedArrayMethod,TypedArrayPrototype=Uint8Array$2&&Uint8Array$2.prototype,GENERIC=!fails$r((function(){TypedArrayPrototype[ITERATOR$2].call([1])})),ITERATOR_IS_VALUES=!!TypedArrayPrototype&&TypedArrayPrototype.values&&TypedArrayPrototype[ITERATOR$2]===TypedArrayPrototype.values&&"values"===TypedArrayPrototype.values.name,typedArrayValues=function(){return arrayValues(aTypedArray$h(this))};exportTypedArrayMethod$i("entries",(function(){return arrayEntries(aTypedArray$h(this))}),GENERIC),exportTypedArrayMethod$i("keys",(function(){return arrayKeys(aTypedArray$h(this))}),GENERIC),exportTypedArrayMethod$i("values",typedArrayValues,GENERIC||!ITERATOR_IS_VALUES,{name:"values"}),exportTypedArrayMethod$i(ITERATOR$2,typedArrayValues,GENERIC||!ITERATOR_IS_VALUES,{name:"values"});var ArrayBufferViewCore$i=arrayBufferViewCore,uncurryThis$q=functionUncurryThis,aTypedArray$g=ArrayBufferViewCore$i.aTypedArray,exportTypedArrayMethod$h=ArrayBufferViewCore$i.exportTypedArrayMethod,$join=uncurryThis$q([].join);exportTypedArrayMethod$h("join",(function(e){return $join(aTypedArray$g(this),e)}));var apply$4=functionApply,toIndexedObject$6=toIndexedObject$e,toIntegerOrInfinity$3=toIntegerOrInfinity$f,lengthOfArrayLike$8=lengthOfArrayLike$n,arrayMethodIsStrict$4=arrayMethodIsStrict$8,min$2=Math.min,$lastIndexOf$1=[].lastIndexOf,NEGATIVE_ZERO$1=!!$lastIndexOf$1&&1/[1].lastIndexOf(1,-0)<0,STRICT_METHOD$4=arrayMethodIsStrict$4("lastIndexOf"),FORCED$a=NEGATIVE_ZERO$1||!STRICT_METHOD$4,arrayLastIndexOf=FORCED$a?function(e){if(NEGATIVE_ZERO$1)return apply$4($lastIndexOf$1,this,arguments)||0;var t=toIndexedObject$6(this),r=lengthOfArrayLike$8(t),n=r-1;for(arguments.length>1&&(n=min$2(n,toIntegerOrInfinity$3(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in t&&t[n]===e)return n||0;return-1}:$lastIndexOf$1,ArrayBufferViewCore$h=arrayBufferViewCore,apply$3=functionApply,$lastIndexOf=arrayLastIndexOf,aTypedArray$f=ArrayBufferViewCore$h.aTypedArray,exportTypedArrayMethod$g=ArrayBufferViewCore$h.exportTypedArrayMethod;exportTypedArrayMethod$g("lastIndexOf",(function(e){var t=arguments.length;return apply$3($lastIndexOf,aTypedArray$f(this),t>1?[e,arguments[1]]:[e])}));var ArrayBufferViewCore$g=arrayBufferViewCore,$map=arrayIteration.map,typedArraySpeciesConstructor$2=typedArraySpeciesConstructor$4,aTypedArray$e=ArrayBufferViewCore$g.aTypedArray,exportTypedArrayMethod$f=ArrayBufferViewCore$g.exportTypedArrayMethod;exportTypedArrayMethod$f("map",(function(e){return $map(aTypedArray$e(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(typedArraySpeciesConstructor$2(e))(t)}))}));var aCallable$3=aCallable$c,toObject$6=toObject$k,IndexedObject$2=indexedObject,lengthOfArrayLike$7=lengthOfArrayLike$n,$TypeError$1=TypeError,createMethod$3=function(e){return function(t,r,n,i){aCallable$3(r);var a=toObject$6(t),o=IndexedObject$2(a),s=lengthOfArrayLike$7(a),u=e?s-1:0,c=e?-1:1;if(n<2)for(;;){if(u in o){i=o[u],u+=c;break}if(u+=c,e?u<0:s<=u)throw $TypeError$1("Reduce of empty array with no initial value")}for(;e?u>=0:s>u;u+=c)u in o&&(i=r(i,o[u],u,a));return i}},arrayReduce={left:createMethod$3(!1),right:createMethod$3(!0)},ArrayBufferViewCore$f=arrayBufferViewCore,$reduce$1=arrayReduce.left,aTypedArray$d=ArrayBufferViewCore$f.aTypedArray,exportTypedArrayMethod$e=ArrayBufferViewCore$f.exportTypedArrayMethod;exportTypedArrayMethod$e("reduce",(function(e){var t=arguments.length;return $reduce$1(aTypedArray$d(this),e,t,t>1?arguments[1]:void 0)}));var ArrayBufferViewCore$e=arrayBufferViewCore,$reduceRight=arrayReduce.right,aTypedArray$c=ArrayBufferViewCore$e.aTypedArray,exportTypedArrayMethod$d=ArrayBufferViewCore$e.exportTypedArrayMethod;exportTypedArrayMethod$d("reduceRight",(function(e){var t=arguments.length;return $reduceRight(aTypedArray$c(this),e,t,t>1?arguments[1]:void 0)}));var ArrayBufferViewCore$d=arrayBufferViewCore,aTypedArray$b=ArrayBufferViewCore$d.aTypedArray,exportTypedArrayMethod$c=ArrayBufferViewCore$d.exportTypedArrayMethod,floor$1=Math.floor;exportTypedArrayMethod$c("reverse",(function(){for(var e,t=this,r=aTypedArray$b(t).length,n=floor$1(r/2),i=0;i<n;)e=t[i],t[i++]=t[--r],t[r]=e;return t}));var global$h=global$O,call$3=functionCall,ArrayBufferViewCore$c=arrayBufferViewCore,lengthOfArrayLike$6=lengthOfArrayLike$n,toOffset=toOffset$2,toIndexedObject$5=toObject$k,fails$q=fails$10,RangeError$1=global$h.RangeError,Int8Array$2=global$h.Int8Array,Int8ArrayPrototype=Int8Array$2&&Int8Array$2.prototype,$set=Int8ArrayPrototype&&Int8ArrayPrototype.set,aTypedArray$a=ArrayBufferViewCore$c.aTypedArray,exportTypedArrayMethod$b=ArrayBufferViewCore$c.exportTypedArrayMethod,WORKS_WITH_OBJECTS_AND_GEERIC_ON_TYPED_ARRAYS=!fails$q((function(){var e=new Uint8ClampedArray(2);return call$3($set,e,{length:1,0:3},1),3!==e[1]})),TO_OBJECT_BUG=WORKS_WITH_OBJECTS_AND_GEERIC_ON_TYPED_ARRAYS&&ArrayBufferViewCore$c.NATIVE_ARRAY_BUFFER_VIEWS&&fails$q((function(){var e=new Int8Array$2(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));exportTypedArrayMethod$b("set",(function(e){aTypedArray$a(this);var t=toOffset(arguments.length>1?arguments[1]:void 0,1),r=toIndexedObject$5(e);if(WORKS_WITH_OBJECTS_AND_GEERIC_ON_TYPED_ARRAYS)return call$3($set,this,r,t);var n=this.length,i=lengthOfArrayLike$6(r),a=0;if(i+t>n)throw RangeError$1("Wrong length");for(;a<i;)this[t+a]=r[a++]}),!WORKS_WITH_OBJECTS_AND_GEERIC_ON_TYPED_ARRAYS||TO_OBJECT_BUG);var ArrayBufferViewCore$b=arrayBufferViewCore,typedArraySpeciesConstructor$1=typedArraySpeciesConstructor$4,fails$p=fails$10,arraySlice$4=arraySlice$c,aTypedArray$9=ArrayBufferViewCore$b.aTypedArray,exportTypedArrayMethod$a=ArrayBufferViewCore$b.exportTypedArrayMethod,FORCED$9=fails$p((function(){new Int8Array(1).slice()}));exportTypedArrayMethod$a("slice",(function(e,t){for(var r=arraySlice$4(aTypedArray$9(this),e,t),n=typedArraySpeciesConstructor$1(this),i=0,a=r.length,o=new n(a);a>i;)o[i]=r[i++];return o}),FORCED$9);var ArrayBufferViewCore$a=arrayBufferViewCore,$some$1=arrayIteration.some,aTypedArray$8=ArrayBufferViewCore$a.aTypedArray,exportTypedArrayMethod$9=ArrayBufferViewCore$a.exportTypedArrayMethod;exportTypedArrayMethod$9("some",(function(e){return $some$1(aTypedArray$8(this),e,arguments.length>1?arguments[1]:void 0)}));var global$g=global$O,uncurryThis$p=functionUncurryThis,fails$o=fails$10,aCallable$2=aCallable$c,internalSort=arraySort$1,ArrayBufferViewCore$9=arrayBufferViewCore,FF$1=engineFfVersion,IE_OR_EDGE=engineIsIeOrEdge,V8=engineV8Version,WEBKIT=engineWebkitVersion,aTypedArray$7=ArrayBufferViewCore$9.aTypedArray,exportTypedArrayMethod$8=ArrayBufferViewCore$9.exportTypedArrayMethod,Uint16Array$1=global$g.Uint16Array,nativeSort=Uint16Array$1&&uncurryThis$p(Uint16Array$1.prototype.sort),ACCEPT_INCORRECT_ARGUMENTS=!(!nativeSort||fails$o((function(){nativeSort(new Uint16Array$1(2),null)}))&&fails$o((function(){nativeSort(new Uint16Array$1(2),{})}))),STABLE_SORT=!!nativeSort&&!fails$o((function(){if(V8)return V8<74;if(FF$1)return FF$1<67;if(IE_OR_EDGE)return!0;if(WEBKIT)return WEBKIT<602;var e,t,r=new Uint16Array$1(516),n=Array(516);for(e=0;e<516;e++)t=e%4,r[e]=515-e,n[e]=e-2*t+3;for(nativeSort(r,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(r[e]!==n[e])return!0})),getSortCompare=function(e){return function(t,r){return void 0!==e?+e(t,r)||0:r!=r?-1:t!=t?1:0===t&&0===r?1/t>0&&1/r<0?1:-1:t>r}};exportTypedArrayMethod$8("sort",(function(e){return void 0!==e&&aCallable$2(e),STABLE_SORT?nativeSort(this,e):internalSort(aTypedArray$7(this),getSortCompare(e))}),!STABLE_SORT||ACCEPT_INCORRECT_ARGUMENTS);var ArrayBufferViewCore$8=arrayBufferViewCore,toLength$3=toLength$b,toAbsoluteIndex$1=toAbsoluteIndex$8,typedArraySpeciesConstructor=typedArraySpeciesConstructor$4,aTypedArray$6=ArrayBufferViewCore$8.aTypedArray,exportTypedArrayMethod$7=ArrayBufferViewCore$8.exportTypedArrayMethod;exportTypedArrayMethod$7("subarray",(function(e,t){var r=aTypedArray$6(this),n=r.length,i=toAbsoluteIndex$1(e,n);return new(typedArraySpeciesConstructor(r))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,toLength$3((void 0===t?n:toAbsoluteIndex$1(t,n))-i))}));var global$f=global$O,apply$2=functionApply,ArrayBufferViewCore$7=arrayBufferViewCore,fails$n=fails$10,arraySlice$3=arraySlice$c,Int8Array$1=global$f.Int8Array,aTypedArray$5=ArrayBufferViewCore$7.aTypedArray,exportTypedArrayMethod$6=ArrayBufferViewCore$7.exportTypedArrayMethod,$toLocaleString=[].toLocaleString,TO_LOCALE_STRING_BUG=!!Int8Array$1&&fails$n((function(){$toLocaleString.call(new Int8Array$1(1))})),FORCED$8=fails$n((function(){return[1,2].toLocaleString()!=new Int8Array$1([1,2]).toLocaleString()}))||!fails$n((function(){Int8Array$1.prototype.toLocaleString.call([1,2])}));exportTypedArrayMethod$6("toLocaleString",(function(){return apply$2($toLocaleString,TO_LOCALE_STRING_BUG?arraySlice$3(aTypedArray$5(this)):aTypedArray$5(this),arraySlice$3(arguments))}),FORCED$8);var exportTypedArrayMethod$5=arrayBufferViewCore.exportTypedArrayMethod,fails$m=fails$10,global$e=global$O,uncurryThis$o=functionUncurryThis,Uint8Array$1=global$e.Uint8Array,Uint8ArrayPrototype=Uint8Array$1&&Uint8Array$1.prototype||{},arrayToString=[].toString,join$1=uncurryThis$o([].join);fails$m((function(){arrayToString.call({})}))&&(arrayToString=function(){return join$1(this)});var IS_NOT_ARRAY_METHOD=Uint8ArrayPrototype.toString!=arrayToString;exportTypedArrayMethod$5("toString",arrayToString,IS_NOT_ARRAY_METHOD);var bind$4=functionBindContext,IndexedObject$1=indexedObject,toObject$5=toObject$k,lengthOfArrayLike$5=lengthOfArrayLike$n,createMethod$2=function(e){var t=1==e;return function(r,n,i){for(var a,o=toObject$5(r),s=IndexedObject$1(o),u=bind$4(n,i),c=lengthOfArrayLike$5(s);c-- >0;)if(u(a=s[c],c,o))switch(e){case 0:return a;case 1:return c}return t?-1:void 0}},arrayIterationFromLast={findLast:createMethod$2(0),findLastIndex:createMethod$2(1)},ArrayBufferViewCore$6=arrayBufferViewCore,$findLast=arrayIterationFromLast.findLast,aTypedArray$4=ArrayBufferViewCore$6.aTypedArray,exportTypedArrayMethod$4=ArrayBufferViewCore$6.exportTypedArrayMethod;exportTypedArrayMethod$4("findLast",(function(e){return $findLast(aTypedArray$4(this),e,arguments.length>1?arguments[1]:void 0)}));var ArrayBufferViewCore$5=arrayBufferViewCore,$findLastIndex=arrayIterationFromLast.findLastIndex,aTypedArray$3=ArrayBufferViewCore$5.aTypedArray,exportTypedArrayMethod$3=ArrayBufferViewCore$5.exportTypedArrayMethod;exportTypedArrayMethod$3("findLastIndex",(function(e){return $findLastIndex(aTypedArray$3(this),e,arguments.length>1?arguments[1]:void 0)}));var LoaderType$3={FETCH:"fetch",XHR:"xhr"},ResponseType$3={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"},NetError$3=function(e){_inherits$5(r,e);var t=_createSuper$r(r);function r(e,n,i,a){var o;return _classCallCheck$5(this,r),_defineProperty$6(_assertThisInitialized$5(o=t.call(this,a)),"retryCount",0),_defineProperty$6(_assertThisInitialized$5(o),"isTimeout",!1),_defineProperty$6(_assertThisInitialized$5(o),"loaderType",LoaderType$3.FETCH),_defineProperty$6(_assertThisInitialized$5(o),"startTime",0),_defineProperty$6(_assertThisInitialized$5(o),"endTime",0),o.url=e,o.request=n,o.response=i,o}return _createClass$6(r)}(_wrapNativeSuper$3(Error)),$$V=_export,fails$l=fails$10,toObject$4=toObject$k,nativeGetPrototypeOf=objectGetPrototypeOf,CORRECT_PROTOTYPE_GETTER=correctPrototypeGetter,FAILS_ON_PRIMITIVES$3=fails$l((function(){nativeGetPrototypeOf(1)}));$$V({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES$3,sham:!CORRECT_PROTOTYPE_GETTER},{getPrototypeOf:function(e){return nativeGetPrototypeOf(toObject$4(e))}});var toString$h=Object.prototype.toString;function isObject$e(e){return null!==e&&"object"===_typeof$5(e)}function isPlainObject$3(e){if("[object Object]"!==toString$h.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function isDate$3(e){return"[object Date]"===toString$h.call(e)}function getRangeValue$3(e){if(e&&null!=e[0]&&(0!==e[0]||null!=e[1])){var t="bytes="+e[0]+"-";return e[1]&&(t+=e[1]),t}}function encode$3(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function setUrlParams$3(e,t){if(e){if(!t)return e;var r,n=Object.keys(t).map((function(e){if(null!=(r=t[e]))return Array.isArray(r)?e+="[]":r=[r],r.map((function(t){return isDate$3(t)?t=t.toISOString():isObject$e(t)&&(t=JSON.stringify(t)),"".concat(encode$3(e),"=").concat(encode$3(t))})).join("&")})).filter(Boolean).join("&");if(n){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}}function createResponse$3(e,t,r,n,i,a){return n=null!=n?parseFloat(n):null,r=parseInt(r||"0",10),isNaN(r)&&(r=0),{data:e,response:t,contentLength:r,age:n,startTime:i,firstByteTime:a,endTime:Date.now()}}var FetchLoader$3=function(){function e(){_classCallCheck$5(this,e),_defineProperty$6(this,"_abortController",null),_defineProperty$6(this,"_timeoutTimer",null),_defineProperty$6(this,"_reader",null),_defineProperty$6(this,"_response",null),_defineProperty$6(this,"_aborted",!1)}var t;return _createClass$6(e,[{key:"load",value:function(e){var t,r=this,n=e.url,i=e.timeout,a=e.responseType,o=e.onProgress,s=e.onTimeout,u=e.range,c=e.transformResponse,l=e.request,d=e.params,h=e.method,f=e.headers,p=e.body,g=e.mode,y=e.credentials,m=e.cache,v=e.redirect,_=e.referrer,b=e.referrerPolicy;this._aborted=!1,this._abortController="undefined"!=typeof AbortController&&new AbortController;var A={method:h,headers:f,body:p,mode:g,credentials:y,cache:m,redirect:v,referrer:_,referrerPolicy:b,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal},E=!1;clearTimeout(this._timeoutTimer),n=setUrlParams$3(n,d);var S=getRangeValue$3(u);S&&((f=l?l.headers:A.headers=A.headers||new Headers)instanceof Headers?f.append("Range",S):f.Range=S),i&&(this._timeoutTimer=setTimeout((function(){if(E=!0,r.cancel(),s){var e=new NetError$3(n,A);e.isTimeout=!0,s(e)}}),i));var T=Date.now();return fetch(l||n,l?void 0:A).then(function(){var e=_asyncToGenerator$5(_regeneratorRuntime$3().mark((function e(t){var i,s;return _regeneratorRuntime$3().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(clearTimeout(r._timeoutTimer),r._response=t,!r._aborted){e.next=4;break}return e.abrupt("return");case 4:if(c&&(t=c(t,n)||t),t.ok){e.next=7;break}throw new NetError$3(n,A,t,"bad network response");case 7:if(i=Date.now(),a!==ResponseType$3.TEXT){e.next=14;break}return e.next=11,t.text();case 11:s=e.sent,e.next=28;break;case 14:if(a!==ResponseType$3.JSON){e.next=20;break}return e.next=17,t.json();case 17:s=e.sent,e.next=28;break;case 20:if(!o){e.next=24;break}r._loadChunk(t,o),e.next=28;break;case 24:return e.next=26,t.arrayBuffer();case 26:s=e.sent,s=new Uint8Array(s);case 28:return e.abrupt("return",createResponse$3(s,t,t.headers.get("Content-Length"),t.headers.get("age"),T,i));case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){if(clearTimeout(r._timeoutTimer),!r._aborted||E)throw(e=e instanceof NetError$3?e:new NetError$3(n,A)).startTime=T,e.endTime=Date.now(),e.isTimeout=E,e}))}},{key:"cancel",value:(t=_asyncToGenerator$5(_regeneratorRuntime$3().mark((function e(){return _regeneratorRuntime$3().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,!this._response){e.next=13;break}if(e.prev=4,!this._reader){e.next=8;break}return e.next=8,this._reader.cancel();case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(4);case 12:this._response=this._reader=null;case 13:if(this._abortController){try{this._abortController.abort()}catch(error){}this._abortController=null}case 14:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(){return t.apply(this,arguments)})},{key:"_loadChunk",value:function(e,t){var r,n,i,a=this,o=this._reader=e.body.getReader(),s=function(){var u=_asyncToGenerator$5(_regeneratorRuntime$3().mark((function u(){return _regeneratorRuntime$3().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return n=Date.now(),u.prev=1,u.next=4,o.read();case 4:r=u.sent,i=Date.now(),u.next=13;break;case 8:return u.prev=8,u.t0=u.catch(1),i=Date.now(),t(void 0,!0,{startTime:n,endTime:i},e),u.abrupt("return");case 13:if(!a._aborted){u.next=16;break}return t(void 0,!0,{startTime:n,endTime:i},e),u.abrupt("return");case 16:t(r.value,r.done,{startTime:n,endTime:i},e),r.done||s();case 18:case"end":return u.stop()}}),u,null,[[1,8]])})));return function(){return u.apply(this,arguments)}}();s()}}],[{key:"isSupported",value:function(){return!("undefined"==typeof fetch)}}]),e}();function getConfig$5(e){return _objectSpread2$4({loaderType:LoaderType$3.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:ResponseType$3.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0},e)}var XhrLoader$3=function(){function e(){_classCallCheck$5(this,e),_defineProperty$6(this,"_xhr",null),_defineProperty$6(this,"_aborted",!1),_defineProperty$6(this,"_timeoutTimer",null)}return _createClass$6(e,[{key:"load",value:function(e){var t=this;clearTimeout(this._timeoutTimer);var r=e.url,n=e.params,i=e.timeout,a=e.responseType,o=e.onTimeout,s=e.transformResponse,u=e.onProgress,c=e.method,l=e.credentials,d=e.body,h=e.headers,f=e.range,p=e.request,g=!1;r=setUrlParams$3(r,n);var y=Date.now();return new Promise((function(e,n){var m=t._xhr=new XMLHttpRequest;m.open(c||"GET",r,!0),m.responseType=a,m.withCredentials="include"===l||"same-origin"===l;var v=getRangeValue$3(f);v&&((h=h||{}).Range=v),h&&Object.keys(h).forEach((function(e){m.setRequestHeader(e,h[e])})),i&&(t._timeoutTimer=setTimeout((function(){if(g=!0,t.cancel(),o){var e=new NetError$3(r,p);e.isTimeout=!0,o(e)}}),i)),m.onerror=function(e){return n(e)},m.onreadystatechange=function(){if(m.readyState>=2){clearTimeout(t._timeoutTimer);var i=Date.now();if(4===m.readyState){if(m.onreadystatechange=null,t._aborted)return;var a=m.status,o={ok:a>=200&&a<300,status:a,statusText:m.statusText,url:m.responseURL,headers:t._getHeaders(m),body:m.response};if(s&&(o=s(o,r)||o),!o.ok)return n(new NetError$3(r,p,o,"bad network response"));var c=m.responseType===ResponseType$3.ARRAY_BUFFER,l=c?new Uint8Array(m.response):m.response;u&&u(c?l:void 0,!0,{startTime:y,endTime:Date.now()},o),e(createResponse$3(l,o,o.headers["content-length"],o.headers.age,y,i))}}},m.send(d)})).catch((function(e){if(clearTimeout(t._timeoutTimer),!t._aborted||g)throw(e=e instanceof NetError$3?e:new NetError$3(r,p)).startTime=y,e.endTime=Date.now(),e.isTimeout=g,e}))}},{key:"cancel",value:function(){if(!this._aborted)return this._aborted=!0,this._xhr?this._xhr.cancel():void 0}},{key:"_getHeaders",value:function(e){var t,r={},n=_createForOfIteratorHelper$4(e.getAllResponseHeaders().trim().split("\r\n"));try{for(n.s();!(t=n.n()).done;){var i=t.value.split(": ");r[i[0].toLowerCase()]=i.slice(1).join(": ")}}catch(a){n.e(a)}finally{n.f()}return r}}],[{key:"isSupported",value:function(){return"undefined"!=typeof XMLHttpRequest}}]),e}(),_excluded$5=["retry","retryDelay","onRetryError","transformError"],Task$3=function(){function e(t,r){_classCallCheck$5(this,e),this.promise=createPublicPromise$3(),this.alive=!!r.onProgress,this._loaderType=t,this._loader=t===LoaderType$3.FETCH?new FetchLoader$3:new XhrLoader$3,this._config=r,this._retryCount=0,this._retryTimer=null,this._canceled=!1}var t;return _createClass$6(e,[{key:"exec",value:function(){var e=this,t=this._config,r=t.retry,n=t.retryDelay,i=t.onRetryError,a=t.transformError,o=_objectWithoutProperties$2(t,_excluded$5),s=function(){var t=_asyncToGenerator$5(_regeneratorRuntime$3().mark((function t(){var u,c;return _regeneratorRuntime$3().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e._loader.load(o);case 3:u=t.sent,e.promise.resolve(u),t.next=22;break;case 7:if(t.prev=7,t.t0=t.catch(0),!e._canceled){t.next=11;break}return t.abrupt("return");case 11:if(t.t0.loaderType=e._loaderType,t.t0.retryCount=e._retryCount,c=t.t0,a&&(c=a(c)||c),i&&e._retryCount>0&&i(c,e._retryCount,r),e._retryCount++,!(e._retryCount<=r)){t.next=21;break}return clearTimeout(e._retryTimer),e._retryTimer=setTimeout(s,n),t.abrupt("return");case 21:e.promise.reject(c);case 22:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();return s(),this.promise}},{key:"cancel",value:(t=_asyncToGenerator$5(_regeneratorRuntime$3().mark((function e(){return _regeneratorRuntime$3().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,e.abrupt("return",this._loader.cancel());case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function isMediaPlaying(e){return e&&!e.paused&&!e.ended&&0!==e.playbackRate&&0!==e.readyState}function getVideoPlaybackQuality(e){if(!e)return{};if("function"==typeof e.getVideoPlaybackQuality){var t=e.getVideoPlaybackQuality();return{droppedVideoFrames:t.droppedVideoFrames||t.corruptedVideoFrames,totalVideoFrames:t.totalVideoFrames,creationTime:t.creationTime}}return{droppedVideoFrames:e.webkitDroppedFrameCount,totalVideoFrames:e.webkitDecodedFrameCount,creationTime:performance.now()}}function concatUint8Array$5(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if((t=t.filter(Boolean)).length<2)return t[0];var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){n.set(e,i),i+=e.byteLength})),n}function sleep$2(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))}var NetLoader$3=function(){function e(t){_classCallCheck$5(this,e),_defineProperty$6(this,"type",LoaderType$3.FETCH),_defineProperty$6(this,"_queue",[]),_defineProperty$6(this,"_alive",[]),_defineProperty$6(this,"_currentTask",null),this._config=getConfig$5(t),this._config.loaderType!==LoaderType$3.XHR&&FetchLoader$3.isSupported()||(this.type=LoaderType$3.XHR)}var t;return _createClass$6(e,[{key:"isFetch",value:function(){return this.type===LoaderType$3.FETCH}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"!=typeof e&&e?t=e:t.url=e||t.url||this._config.url,(t=Object.assign({},this._config,t)).params&&(t.params=Object.assign({},t.params)),t.headers&&isPlainObject$3(t.headers)&&(t.headers=Object.assign({},t.headers)),t.body&&isPlainObject$3(t.body)&&(t.body=Object.assign({},t.body)),t.transformRequest&&(t=t.transformRequest(t)||t);var r=new Task$3(this.type,t);return this._queue.push(r),1===this._queue.length&&this._processTask(),r.promise}},{key:"cancel",value:(t=_asyncToGenerator$5(_regeneratorRuntime$3().mark((function e(){var t;return _regeneratorRuntime$3().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._queue.map((function(e){return e.cancel()})).concat(this._alive.map((function(e){return e.cancel()}))),this._currentTask&&t.push(this._currentTask.cancel()),this._queue=[],this._alive=[],e.next=6,Promise.all(t);case 6:return e.next=8,sleep$2();case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_processTask",value:function(){var e=this;this._currentTask=this._queue.shift(),this._currentTask&&(this._currentTask.alive&&this._alive.push(this._currentTask),this._currentTask.exec().catch((function(){})).finally((function(){e._processTask()})))}}],[{key:"isFetchSupport",value:function(){return FetchLoader$3.isSupported()}}]),e}(),EVENT$1={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT"},GapService=function(){function e(){_classCallCheck$5(this,e),_defineProperty$6(this,"_prevCurrentTime",0)}return _createClass$6(e,[{key:"do",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(e){var i=e.currentTime,a=0;if(this._prevCurrentTime===i){var o=Buffer$2.info(Buffer$2.get(e),i);if(!o.buffers.length)return;r&&o.nextStart||o.nextStart&&o.nextStart-i<t?a=o.nextStart+.1:o.end&&o.end-i>n&&!e.seeking&&(a=i+.1)}this._prevCurrentTime=i,a&&i!==a&&(e.currentTime=a)}}}]),e}(),internalMetadata={exports:{}},objectGetOwnPropertyNamesExternal={},classof$1=classofRaw$2,toIndexedObject$4=toIndexedObject$e,$getOwnPropertyNames$1=objectGetOwnPropertyNames.f,arraySlice$2=arraySliceSimple,windowNames="object"==("undefined"==typeof window?"undefined":_typeof$7(window))&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],getWindowNames=function(e){try{return $getOwnPropertyNames$1(e)}catch(error){return arraySlice$2(windowNames)}};objectGetOwnPropertyNamesExternal.f=function(e){return windowNames&&"Window"==classof$1(e)?getWindowNames(e):$getOwnPropertyNames$1(toIndexedObject$4(e))};var fails$k=fails$10,arrayBufferNonExtensible=fails$k((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),fails$j=fails$10,isObject$d=isObject$y,classof=classofRaw$2,ARRAY_BUFFER_NON_EXTENSIBLE=arrayBufferNonExtensible,$isExtensible=Object.isExtensible,FAILS_ON_PRIMITIVES$2=fails$j((function(){$isExtensible(1)})),objectIsExtensible=FAILS_ON_PRIMITIVES$2||ARRAY_BUFFER_NON_EXTENSIBLE?function(e){return!!isObject$d(e)&&((!ARRAY_BUFFER_NON_EXTENSIBLE||"ArrayBuffer"!=classof(e))&&(!$isExtensible||$isExtensible(e)))}:$isExtensible,fails$i=fails$10,freezing=!fails$i((function(){return Object.isExtensible(Object.preventExtensions({}))})),$$U=_export,uncurryThis$n=functionUncurryThis,hiddenKeys$1=hiddenKeys$6,isObject$c=isObject$y,hasOwn$9=hasOwnProperty_1,defineProperty$6=objectDefineProperty.f,getOwnPropertyNamesModule$1=objectGetOwnPropertyNames,getOwnPropertyNamesExternalModule=objectGetOwnPropertyNamesExternal,isExtensible=objectIsExtensible,uid$1=uid$5,FREEZING=freezing,REQUIRED=!1,METADATA=uid$1("meta"),id=0,setMetadata=function(e){defineProperty$6(e,METADATA,{value:{objectID:"O"+id++,weakData:{}}})},fastKey$1=function(e,t){if(!isObject$c(e))return"symbol"==_typeof$7(e)?e:("string"==typeof e?"S":"P")+e;if(!hasOwn$9(e,METADATA)){if(!isExtensible(e))return"F";if(!t)return"E";setMetadata(e)}return e[METADATA].objectID},getWeakData=function(e,t){if(!hasOwn$9(e,METADATA)){if(!isExtensible(e))return!0;if(!t)return!1;setMetadata(e)}return e[METADATA].weakData},onFreeze=function(e){return FREEZING&&REQUIRED&&isExtensible(e)&&!hasOwn$9(e,METADATA)&&setMetadata(e),e},enable=function(){meta$1.enable=function(){},REQUIRED=!0;var e=getOwnPropertyNamesModule$1.f,t=uncurryThis$n([].splice),r={};r[METADATA]=1,e(r).length&&(getOwnPropertyNamesModule$1.f=function(r){for(var n=e(r),i=0,a=n.length;i<a;i++)if(n[i]===METADATA){t(n,i,1);break}return n},$$U({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:getOwnPropertyNamesExternalModule.f}))},meta$1=internalMetadata.exports={enable:enable,fastKey:fastKey$1,getWeakData:getWeakData,onFreeze:onFreeze};hiddenKeys$1[METADATA]=!0;var $$T=_export,global$d=global$O,uncurryThis$m=functionUncurryThis,isForced=isForced_1,defineBuiltIn$5=defineBuiltIn$l,InternalMetadataModule=internalMetadata.exports,iterate$1=iterate$4,anInstance$3=anInstance$9,isCallable$2=isCallable$v,isNullOrUndefined$2=isNullOrUndefined$a,isObject$b=isObject$y,fails$h=fails$10,checkCorrectnessOfIteration$1=checkCorrectnessOfIteration$4,setToStringTag$2=setToStringTag$9,inheritIfRequired$1=inheritIfRequired$6,collection$2=function(e,t,r){var n=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),a=n?"set":"add",o=global$d[e],s=o&&o.prototype,u=o,c={},l=function(e){var t=uncurryThis$m(s[e]);defineBuiltIn$5(s,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!isObject$b(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return i&&!isObject$b(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!isObject$b(e))&&t(this,0===e?0:e)}:function(e,r){return t(this,0===e?0:e,r),this})};if(isForced(e,!isCallable$2(o)||!(i||s.forEach&&!fails$h((function(){(new o).entries().next()})))))u=r.getConstructor(t,e,n,a),InternalMetadataModule.enable();else if(isForced(e,!0)){var d=new u,h=d[a](i?{}:-0,1)!=d,f=fails$h((function(){d.has(1)})),p=checkCorrectnessOfIteration$1((function(e){new o(e)})),g=!i&&fails$h((function(){for(var e=new o,t=5;t--;)e[a](t,t);return!e.has(-0)}));p||((u=t((function(e,t){anInstance$3(e,s);var r=inheritIfRequired$1(new o,e,u);return isNullOrUndefined$2(t)||iterate$1(t,r[a],{that:r,AS_ENTRIES:n}),r}))).prototype=s,s.constructor=u),(f||g)&&(l("delete"),l("has"),n&&l("get")),(g||h)&&l(a),i&&s.clear&&delete s.clear}return c[e]=u,$$T({global:!0,constructor:!0,forced:u!=o},c),setToStringTag$2(u,e),i||r.setStrong(u,e,n),u},defineProperty$5=objectDefineProperty.f,create$4=objectCreate$1,defineBuiltIns=defineBuiltIns$3,bind$3=functionBindContext,anInstance$2=anInstance$9,isNullOrUndefined$1=isNullOrUndefined$a,iterate=iterate$4,defineIterator=iteratorDefine,createIterResultObject=createIterResultObject$3,setSpecies$1=setSpecies$5,DESCRIPTORS$b=descriptors,fastKey=internalMetadata.exports.fastKey,InternalStateModule$2=internalState,setInternalState$2=InternalStateModule$2.set,internalStateGetterFor=InternalStateModule$2.getterFor,collectionStrong$2={getConstructor:function(e,t,r,n){var i=e((function(e,i){anInstance$2(e,a),setInternalState$2(e,{type:t,index:create$4(null),first:void 0,last:void 0,size:0}),DESCRIPTORS$b||(e.size=0),isNullOrUndefined$1(i)||iterate(i,e[n],{that:e,AS_ENTRIES:r})})),a=i.prototype,o=internalStateGetterFor(t),s=function(e,t,r){var n,i,a=o(e),s=u(e,t);return s?s.value=r:(a.last=s={index:i=fastKey(t,!0),key:t,value:r,previous:n=a.last,next:void 0,removed:!1},a.first||(a.first=s),n&&(n.next=s),DESCRIPTORS$b?a.size++:e.size++,"F"!==i&&(a.index[i]=s)),e},u=function(e,t){var r,n=o(e),i=fastKey(t);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key==t)return r};return defineBuiltIns(a,{clear:function(){for(var e=o(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,DESCRIPTORS$b?e.size=0:this.size=0},delete:function(e){var t=this,r=o(t),n=u(t,e);if(n){var i=n.next,a=n.previous;delete r.index[n.index],n.removed=!0,a&&(a.next=i),i&&(i.previous=a),r.first==n&&(r.first=i),r.last==n&&(r.last=a),DESCRIPTORS$b?r.size--:t.size--}return!!n},forEach:function(e){for(var t,r=o(this),n=bind$3(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!u(this,e)}}),defineBuiltIns(a,r?{get:function(e){var t=u(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),DESCRIPTORS$b&&defineProperty$5(a,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,r){var n=t+" Iterator",i=internalStateGetterFor(t),a=internalStateGetterFor(n);defineIterator(e,t,(function(e,t){setInternalState$2(this,{type:n,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=a(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?createIterResultObject("keys"==t?r.key:"values"==t?r.value:[r.key,r.value],!1):(e.target=void 0,createIterResultObject(void 0,!0))}),r?"entries":"values",!r,!0),setSpecies$1(t)}},collection$1=collection$2,collectionStrong$1=collectionStrong$2;collection$1("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),collectionStrong$1);var SeiService=function(){function e(t){var r=this;_classCallCheck$5(this,e),_defineProperty$6(this,"_seiSet",new Set),this.emitter=t,t.on(EVENT$1.SEI,(function(e){e&&r._seiSet.add(e)}))}return _createClass$6(e,[{key:"throw",value:function(e){var t=this;if(null!=e&&this._seiSet.size){var r=e-.2,n=e+.2,i=[];this._seiSet.forEach((function(e){e.time>=r&&e.time<=n&&i.push(e)})),i.forEach((function(e){t._seiSet.delete(e),t.emitter.emit(EVENT$1.SEI_IN_TIME,e)}))}}},{key:"reset",value:function(){this._seiSet.clear()}}]),e}(),BandwidthService=function(){function e(){_classCallCheck$5(this,e),_defineProperty$6(this,"_chunkSpeeds",[]),_defineProperty$6(this,"_speeds",[])}return _createClass$6(e,[{key:"addRecord",value:function(e,t){e&&t&&(this._speeds.push(8e3*e/t),this._speeds=this._speeds.slice(-3))}},{key:"addChunkRecord",value:function(e,t){e&&t&&(this._chunkSpeeds.push(8e3*e/t),this._chunkSpeeds=this._chunkSpeeds.slice(-10))}},{key:"getAvgSpeed",value:function(){return this._chunkSpeeds.length||this._speeds.length?this._speeds.length?this._speeds.reduce((function(e,t){return e+t}))/this._speeds.length:this._chunkSpeeds.reduce((function(e,t){return e+t}))/this._chunkSpeeds.length:0}},{key:"getLatestSpeed",value:function(){return this._chunkSpeeds.length||this._speeds.length?this._speeds.length?this._speeds[this._speeds.length-1]:this._chunkSpeeds[this._chunkSpeeds.length-1]:0}},{key:"reset",value:function(){this._chunkSpeeds=[],this._speeds=[]}}]),e}(),Logger$8=function(){function e(t){_classCallCheck$5(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return _createClass$6(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).debug.apply(t,[this._prefix].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,[this._prefix].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).error.apply(t,[this._prefix].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();function _classCallCheck$4(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$5(e,t,r){return t&&_defineProperties$5(e.prototype,t),r&&_defineProperties$5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$5(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}_defineProperty$6(Logger$8,"disabled",!0);var $$S=_export,$includes=arrayIncludes.includes,fails$g=fails$10,addToUnscopables$2=addToUnscopables$6,BROKEN_ON_SPARSE=fails$g((function(){return!Array(1).includes()}));$$S({target:"Array",proto:!0,forced:BROKEN_ON_SPARSE},{includes:function(e){return $includes(this,e,arguments.length>1?arguments[1]:void 0)}}),addToUnscopables$2("includes");var isRegExp=isRegexp,$TypeError=TypeError,notARegexp=function(e){if(isRegExp(e))throw $TypeError("The method doesn't accept regular expressions");return e},wellKnownSymbol$3=wellKnownSymbol$u,MATCH=wellKnownSymbol$3("match"),correctIsRegexpLogic=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[MATCH]=!1,"/./"[e](t)}catch(n){}}return!1},$$R=_export,uncurryThis$l=functionUncurryThis,notARegExp$1=notARegexp,requireObjectCoercible$5=requireObjectCoercible$e,toString$g=toString$v,correctIsRegExpLogic$1=correctIsRegexpLogic,stringIndexOf=uncurryThis$l("".indexOf);$$R({target:"String",proto:!0,forced:!correctIsRegExpLogic$1("includes")},{includes:function(e){return!!~stringIndexOf(toString$g(requireObjectCoercible$5(this)),toString$g(notARegExp$1(e)),arguments.length>1?arguments[1]:void 0)}});var global$c=global$O,globalIsFinite=global$c.isFinite,numberIsFinite$1=Number.isFinite||function(e){return"number"==typeof e&&globalIsFinite(e)},$$Q=_export,numberIsFinite=numberIsFinite$1;$$Q({target:"Number",stat:!0},{isFinite:numberIsFinite});var TrackType$3={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},VideoCodecType$3={AVC:"avc",HEVC:"hevc"},AudioCodecType$2={AAC:"aac",G711PCMA:"g7110a",G711PCMU:"g7110m"},WarningType$1={LARGE_AV_SHIFT:"LARGE_AV_SHIFT",LARGE_VIDEO_GAP:"LARGE_VIDEO_GAP",LARGE_VIDEO_GAP_BETWEEN_CHUNK:"LARGE_VIDEO_GAP_BETWEEN_CHUNK",LARGE_AUDIO_GAP:"LARGE_AUDIO_GAP",AUDIO_FILLED:"AUDIO_FILLED",AUDIO_DROPPED:"AUDIO_DROPPED"},isBrowser$2="undefined"!=typeof window,ua$2=isBrowser$2&&navigator.userAgent.toLocaleLowerCase(),isSafari$2=isBrowser$2&&/^((?!chrome|android).)*safari/.test(ua$2),isFirefox$2=isBrowser$2&&ua$2.includes("firefox"),isAndroid$2=isBrowser$2&&ua$2.includes("android"),AAC$2=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"getRateIndexByRate",value:function(t){return e.FREQ.indexOf(t)}},{key:"parseADTS",value:function(t,r){for(var n=t.length,i=0;i+2<n&&(255!==t[i]||240!=(246&t[i+1]));)i++;if(!(i>=n)){var a=i,o=[],s=(60&t[i+2])>>>2,u=e.FREQ[s];if(!u)throw new Error("Invalid sampling index: ".concat(s));for(var c,l,d=1+((192&t[i+2])>>>6),h=(1&t[i+2])<<2|(192&t[i+3])>>>6,f=e._getConfig(s,h,d),p=f.config,g=f.codec,y=0,m=e.getFrameDuration(u);i+7<n;)if(255===t[i]&&240==(246&t[i+1])){if(n-i<(l=(3&t[i+3])<<11|t[i+4]<<3|(224&t[i+5])>>5))break;c=2*(1&~t[i+1]),o.push({pts:r+y*m,data:t.subarray(i+7+c,i+l)}),y++,i+=l}else i++;return{skip:a,remaining:i>=n?void 0:t.subarray(i),frames:o,samplingFrequencyIndex:s,sampleRate:u,objectType:d,channelCount:h,codec:g,config:p,originCodec:"mp4a.40.".concat(d)}}}},{key:"parseAudioSpecificConfig",value:function(t){if(t.length){var r=t[0]>>>3,n=(7&t[0])<<1|t[1]>>>7,i=(120&t[1])>>>3,a=e.FREQ[n];if(!a)throw new Error("Invalid sampling index: ".concat(n));var o=e._getConfig(n,i,r);return{samplingFrequencyIndex:n,sampleRate:a,objectType:r,channelCount:i,config:o.config,codec:o.codec,originCodec:"mp4a.40.".concat(r)}}}},{key:"getFrameDuration",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return 1024*t/e}},{key:"_getConfig",value:function(e,t,r){var n,i,a=[];return isFirefox$2?e>=6?(n=5,i=e-3):(n=2,i=e):isAndroid$2?(n=2,i=e):(n=2===r||5===r?r:5,i=e,e>=6?i=e-3:1===t&&(n=2,i=e)),a[0]=n<<3,a[0]|=(14&e)>>1,a[1]=(1&e)<<7,a[1]|=t<<3,5===n&&(a[1]|=(14&i)>>1,a[2]=(1&i)<<7,a[2]|=8,a[3]=0),{config:a,codec:"mp4a.40.".concat(n)}}},{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}]),e}();_defineProperty$5(AAC$2,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var AudioSample$2=_createClass$5((function e(t,r,n){_classCallCheck$4(this,e),_defineProperty$5(this,"duration",1024),_defineProperty$5(this,"flag",{dependsOn:2,isNonSyncSample:0}),this.originPts=this.pts=this.dts=t,this.data=r,this.size=r.byteLength,n&&(this.duration=n)})),LARGE_AV_FIRST_FRAME_GAP$1=500,AUDIO_GAP_OVERLAP_THRESHOLD_COUNT$1=3,MAX_SILENT_FRAME_DURATION$1=1e3,AUDIO_EXCETION_LOG_EMIT_DURATION$1=5e3,MAX_VIDEO_FRAME_DURATION$1=1e3,MAX_DTS_DELTA_WITH_NEXT_CHUNK$1=200,VIDEO_EXCETION_LOG_EMIT_DURATION=5e3,TRACK_BREACKED_CHECK_TIME=5,FlvFixer=function(){function e(t,r,n){_classCallCheck$4(this,e),this.videoTrack=t,this.audioTrack=r,this.metadataTrack=n,this._baseDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=0,this._videoTimestampBreak=0,this._lastAudioExceptionGapDot=-1/0,this._lastAudioExceptionOverlapDot=-1/0,this._lastAudioExceptionLargeGapDot=-1/0,this._lastVideoExceptionLargeGapDot=-1/0,this._lastVideoExceptionChunkFirstDtsDot=-1/0}return _createClass$5(e,[{key:"fix",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t=Math.round(1e3*t);var i=this.videoTrack,a=this.audioTrack;if(!r&&n||(this._videoLastSample=null,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=0,this._videoTimestampBreak=0,this._lastAudioExceptionGapDot=-1/0,this._lastAudioExceptionOverlapDot=-1/0,this._lastAudioExceptionLargeGapDot=-1/0,this._lastVideoExceptionLargeGapDot=-1/0,this._lastVideoExceptionChunkFirstDtsDot=-1/0),r&&!n&&(this._baseDtsInited=!1),this._baseDtsInited||this._calculateBaseDts(a,i),this._baseDtsInited){if(!n&&t&&(this._audioNextPts=this._videoNextDts=t),this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(a),this._fixVideo(i),this.metadataTrack.exist()){var o=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach((function(t){t.pts=t.originPts-e._baseDts,t.time=Math.max(0,t.pts)/o})),this.metadataTrack.flvScriptSamples.forEach((function(t){t.pts=t.originPts-e._baseDts,t.time=Math.max(0,t.pts)/o}))}i.samples.length&&(i.baseMediaDecodeTime=i.samples[0].dts),a.samples.length&&(a.baseMediaDecodeTime=a.samples[0].pts*a.timescale/1e3)}}},{key:"_fixVideo",value:function(e){var t=this,r=e.samples;if(r.length){var n;if(r.forEach((function(e){e.dts-=t._baseDts,e.pts-=t._baseDts})),e.fpsNum&&e.fpsDen)n=e.timescale*(e.fpsDen/e.fpsNum);else{var i=e.samples[0],a=e.samples[r.length-1];n=Math.floor((a.dts-i.dts)/(r.length-1))}var o=r.pop();if(this._videoLastSample&&r.unshift(this._videoLastSample),this._videoLastSample=o,r.length){if(void 0===this._videoNextDts){var s=r[0];this._videoNextDts=s.dts}var u=r.length,c=0,l=r[0],d=this._videoNextDts-l.dts;if(Math.abs(d)>MAX_DTS_DELTA_WITH_NEXT_CHUNK$1){var h;if(Math.abs(l.dts-this._lastVideoExceptionChunkFirstDtsDot)>VIDEO_EXCETION_LOG_EMIT_DURATION)this._lastVideoExceptionChunkFirstDtsDot=l.dts,e.warnings.push({type:WarningType$1.LARGE_VIDEO_GAP_BETWEEN_CHUNK,nextDts:this._videoNextDts,firstSampleDts:l.dts,nextSampleDts:null===(h=r[1])||void 0===h?void 0:h.dts,sampleDuration:d});this._videoTimestampBreak>=TRACK_BREACKED_CHECK_TIME?(this._videoNextDts=l.dts,this._videoTimestampBreak=0):(l.dts+=d,l.pts+=d)}for(var f=0;f<u;f++){var p=r[f].dts,g=r[f+1];((c=f<u-1?g.dts-p:o?o.dts-p:n)>MAX_VIDEO_FRAME_DURATION$1||c<0)&&(this._videoTimestampBreak++,Math.abs(p-this._lastVideoExceptionLargeGapDot)>VIDEO_EXCETION_LOG_EMIT_DURATION&&(this._lastVideoExceptionLargeGapDot=p,e.warnings.push({type:WarningType$1.LARGE_VIDEO_GAP,time:p/e.timescale,dts:p,originDts:r[f].originDts,nextDts:this._videoNextDts,sampleDuration:c,refSampleDuration:n})),c=n),r[f].duration=c,this._videoNextDts+=c}}}}},{key:"_fixAudio",value:function(e){var t=this,r=e.samples;r.length&&(r.forEach((function(e){e.dts=e.pts-=t._baseDts})),this._doFixAudioInternal(e,r,1e3))}},{key:"_calculateBaseDts",value:function(e,t){var r=e.samples,n=t.samples;if(!r.length&&!n.length)return!1;var i=1/0,a=1/0;r.length&&(e.baseDts=i=r[0].pts),n.length&&(t.baseDts=a=n[0].dts),this._baseDts=Math.min(i,a);var o=a-i;return Number.isFinite(o)&&Math.abs(o)>LARGE_AV_FIRST_FRAME_GAP$1&&t.warnings.push({type:WarningType$1.LARGE_AV_SHIFT,videoBaseDts:a,audioBasePts:i,baseDts:this._baseDts,delta:o}),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){if(this._baseDtsInited&&this._videoTimestampBreak&&this._audioTimestampBreak){if(!this._calculateBaseDts(this.audioTrack,this.videoTrack))return;this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts),this._videoLastSample=null,this._videoTimestampBreak=0,this._audioTimestampBreak=0}}},{key:"_doFixAudioInternal",value:function(e,t,r){e.sampleDuration||(e.sampleDuration=e.codecType===AudioCodecType$2.AAC?AAC$2.getFrameDuration(e.timescale,r):this._getG711Duration(e));var n=e.sampleDuration,i=e.codecType===AudioCodecType$2.AAC?1024:n*e.timescale/1e3;if(void 0===this._audioNextPts){var a=t[0];this._audioNextPts=a.pts}for(var o=0;o<t.length;o++){var s=this._audioNextPts,u=t[o],c=u.pts-s;if(0===o&&this._audioTimestampBreak>=TRACK_BREACKED_CHECK_TIME&&(s=this._audioNextPts=u.dts,c=0,this._audioTimestampBreak=0),!this._audioTimestampBreak&&c>=AUDIO_GAP_OVERLAP_THRESHOLD_COUNT$1*n&&c<=MAX_SILENT_FRAME_DURATION$1&&!isSafari$2){var l=this._getSilentFrame(e)||t[0].data.subarray(),d=Math.floor(c/n);Math.abs(u.pts-this._lastAudioExceptionGapDot)>AUDIO_EXCETION_LOG_EMIT_DURATION$1&&(this._lastAudioExceptionGapDot=u.pts,e.warnings.push({type:WarningType$1.AUDIO_FILLED,pts:u.pts,originPts:u.originPts,count:d,nextPts:s,refSampleDuration:n}));for(var h=0;h<d;h++){var f=new AudioSample$2(Math.floor(this._audioNextPts+n)-Math.floor(this._audioNextPts),l,i);f.originPts=Math.floor(this._baseDts+s),t.splice(o,0,f),this._audioNextPts+=n,o++}o--}else c<=-AUDIO_GAP_OVERLAP_THRESHOLD_COUNT$1*n&&c>=-1*MAX_SILENT_FRAME_DURATION$1?(Math.abs(u.pts-this._lastAudioExceptionOverlapDot)>AUDIO_EXCETION_LOG_EMIT_DURATION$1&&(this._lastAudioExceptionOverlapDot=u.pts,e.warnings.push({type:WarningType$1.AUDIO_DROPPED,pts:u.pts,originPts:u.originPts,nextPts:s,refSampleDuration:n})),t.splice(o,1),o--):(Math.abs(c)>MAX_SILENT_FRAME_DURATION$1&&(this._audioTimestampBreak++,Math.abs(u.pts-this._lastAudioExceptionLargeGapDot)>AUDIO_EXCETION_LOG_EMIT_DURATION$1&&(this._lastAudioExceptionLargeGapDot=u.pts,e.warnings.push({type:WarningType$1.LARGE_AUDIO_GAP,time:u.pts/1e3,pts:u.pts,originPts:u.originPts,nextPts:s,sampleDuration:c,refSampleDuration:n}))),u.dts=u.pts=s,u.duration=i,this._audioNextPts+=n)}}},{key:"_getG711Duration",value:function(e){var t=e.sampleSize,r=e.channelCount,n=e.sampleRate,i=e.samples[0];if(i)return 2*i.data.byteLength/r/(t/8)/n*1e3}},{key:"_getSilentFrame",value:function(e){return e.codecType===AudioCodecType$2.AAC?AAC$2.getSilentFrame(e.codec,e.channelCount):new Uint8Array(8*e.sampleDuration*e.channelCount)}}]),e}();function concatUint8Array$4(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=t.filter(Boolean);var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){n.set(e,i),i+=e.byteLength})),n}function readBig32$2(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<24>>>0)+(e[t+1]<<16)+(e[t+2]<<8)+(e[t+3]||0)}function getAvcCodec$2(e){for(var t,r="avc1.",n=0;n<3;n++)(t=e[n].toString(16)).length<2&&(t="0".concat(t)),r+=t;return r}var UTF8=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"decode",value:function(t){for(var r=[],n=t,i=0,a=t.length;i<a;)if(n[i]<128)r.push(String.fromCharCode(n[i])),++i;else{if(n[i]<192);else if(n[i]<224){if(e._checkContinuation(n,i,1)){var o=(31&n[i])<<6|63&n[i+1];if(o>=128){r.push(String.fromCharCode(65535&o)),i+=2;continue}}}else if(n[i]<240){if(e._checkContinuation(n,i,2)){var s=(15&n[i])<<12|(63&n[i+1])<<6|63&n[i+2];if(s>=2048&&55296!=(63488&s)){r.push(String.fromCharCode(65535&s)),i+=3;continue}}}else if(n[i]<248&&e._checkContinuation(n,i,3)){var u=(7&n[i])<<18|(63&n[i+1])<<12|(63&n[i+2])<<6|63&n[i+3];if(u>65536&&u<1114112){u-=65536,r.push(String.fromCharCode(u>>>10|55296)),r.push(String.fromCharCode(1023&u|56320)),i+=4;continue}}r.push(String.fromCharCode(65533)),++i}return r.join("")}},{key:"_checkContinuation",value:function(e,t,r){var n=e;if(t+r<n.length){for(;r--;)if(128!=(192&n[++t]))return!1;return!0}return!1}}]),e}(),AMF=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"parse",value:function(t){if(!(t.length<3)){var r={},n=e._parseValue(new DataView(t.buffer,t.byteOffset,t.byteLength)),i=e._parseValue(new DataView(t.buffer,t.byteOffset+n.size,t.byteLength-n.size));return r[n.data]=i.data,r}}},{key:"_parseValue",value:function(t){var r,n=t.byteLength,i=1,a=!1;switch(t.getUint8(0)){case 0:r=t.getFloat64(1),i+=8;break;case 1:r=!!t.getUint8(1),i+=1;break;case 2:var o=e._parseString(new DataView(t.buffer,t.byteOffset+i,t.byteLength-i));r=o.data,i+=o.size;break;case 3:r={};var s=0;for(9==(16777215&t.getUint32(n-4))&&(s=3);i<n-4;){var u=e._parseObject(new DataView(t.buffer,t.byteOffset+i,t.byteLength-i-s)),c=u.size,l=u.data;if(u.isEnd)break;r[l.name]=l.value,i+=c}if(i<=n-3)9===(16777215&t.getUint32(i-1))&&(i+=3);break;case 8:r={},i+=4;var d=0;for(9==(16777215&t.getUint32(n-4))&&(d=3);i<n-8;){var h=e._parseObject(new DataView(t.buffer,t.byteOffset+i,t.byteLength-i-d)),f=h.size,p=h.data;if(h.isEnd)break;r[p.name]=p.value,i+=f}if(i<=n-3)9===(16777215&t.getUint32(i-1))&&(i+=3);break;case 9:r=void 0,i=1,a=!0;break;case 10:r=[];var g=t.getUint32(1);i+=4;for(var y=0;y<g;y++){var m=e._parseValue(new DataView(t.buffer,t.byteOffset+i,t.byteLength-i)),v=m.data,_=m.size;r.push(v),i+=_}break;case 11:var b=t.getFloat64(i)+6e4*t.getInt16(i+8);r=new Date(b),i+=10;break;case 12:var A=t.getUint32(1);i+=4,r="",A>0&&(r=UTF8.decode(new Uint8Array(t.buffer,t.byteOffset+i,A))),i+=A;break;default:i=n}return{data:r,size:i,isEnd:a}}},{key:"_parseString",value:function(e){var t=e.getUint16(0),r="";return t>0&&(r=UTF8.decode(new Uint8Array(e.buffer,e.byteOffset+2,t))),{data:r,size:2+t}}},{key:"_parseObject",value:function(t){if(!(t.byteLength<3)){var r=e._parseString(t),n=e._parseValue(new DataView(t.buffer,t.byteOffset+r.size,t.byteLength-r.size));return{data:{name:r.data,value:n.data},size:r.size+n.size,isEnd:n.isEnd}}}}]),e}(),Logger$7=function(){function e(t){_classCallCheck$4(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return _createClass$5(e,[{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();_defineProperty$5(Logger$7,"disabled",!0);var NALu$1=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"parseAnnexB",value:function(e){for(var t=e.length,r=2,n=0;null!=e[r]&&1!==e[r];)r++;if((n=++r+2)>=t)return[];for(var i=[];n<t;)switch(e[n]){case 0:if(0!==e[n-1]){n+=2;break}if(0!==e[n-2]){n++;break}r!==n-2&&i.push(e.subarray(r,n-2));do{n++}while(1!==e[n]&&n<t);n=(r=n+1)+2;break;case 1:if(0!==e[n-1]||0!==e[n-2]){n+=3;break}r!==n-2&&i.push(e.subarray(r,n-2)),n=(r=n+1)+2;break;default:n+=3}return r<t&&i.push(e.subarray(r)),i}},{key:"parseAvcC",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(!(e.length<4)){for(var r,n=e.length,i=[],a=0;a+t<n;)if(r=readBig32$2(e,a),3===t&&(r>>>=8),a+=t,r){if(a+r>n)break;i.push(e.subarray(a,a+r)),a+=r}return i}}},{key:"parseSEI",value:function(e){for(var t=e.length,r=1,n=0,i=0,a="";255===e[r];)n+=255,r++;for(n+=e[r++];255===e[r];)i+=255,r++;if(i+=e[r++],5===n&&t>r+16)for(var o=0;o<16;o++)a+=e[r].toString(16),r++;return{payload:e.subarray(r),type:n,size:i,uuid:a}}},{key:"removeEPB",value:function(e){for(var t=e.byteLength,r=[],n=1;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(!r.length)return e;var i=t-r.length,a=new Uint8Array(i),o=0;for(n=0;n<i;o++,n++)o===r[0]&&(o++,r.shift()),a[n]=e[o];return a}}]),e}(),ExpGolomb$1=function(){function e(t){if(_classCallCheck$4(this,e),_defineProperty$5(this,"_bytesAvailable",void 0),_defineProperty$5(this,"_bitsAvailable",0),_defineProperty$5(this,"_word",0),!t)throw new Error("ExpGolomb data params is required");this._data=t,this._bytesAvailable=t.byteLength,this._bytesAvailable&&this._loadWord()}return _createClass$5(e,[{key:"_loadWord",value:function(){var e=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(0===t)throw new Error("No bytes available");var r=new Uint8Array(4);r.set(this._data.subarray(e,e+t)),this._word=new DataView(r.buffer).getUint32(0),this._bitsAvailable=8*t,this._bytesAvailable-=t}},{key:"skipBits",value:function(e){if(this._bitsAvailable>e)this._word<<=e,this._bitsAvailable-=e;else{e-=this._bitsAvailable;var t=Math.floor(e/8);e-=8*t,this._bytesAvailable-=t,this._loadWord(),this._word<<=e,this._bitsAvailable-=e}}},{key:"readBits",value:function(e){if(e>32)throw new Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,e),r=this._word>>>32-t;return this._bitsAvailable-=t,this._bitsAvailable>0?this._word<<=t:this._bytesAvailable>0&&this._loadWord(),(t=e-t)>0&&this._bitsAvailable?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this._bitsAvailable;++e)if(0!=(this._word&2147483648>>>e))return this._word<<=e,this._bitsAvailable-=e,e;return this._loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(e){for(var t=8,r=8,n=0;n<e;n++)0!==r&&(r=(t+this.readEG()+256)%256),t=0===r?t:r}}]),e}(),HEVC$1=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(t.length<23)){r=r||{};for(var n,i,a,o,s,u=1+(3&t[21]),c=[],l=[],d=[],h=23,f=t[22],p=0;p<f;p++){a=63&t[h],o=t[h+1]<<8|t[h+2],h+=3;for(var g=0;g<o;g++)if(s=t[h]<<8|t[h+1],h+=2,s){switch(a){case 32:var y=t.subarray(h,h+s);n||(n=e.parseVPS(NALu$1.removeEPB(y),r)),d.push(y);break;case 33:var m=t.subarray(h,h+s);i||(i=e.parseSPS(NALu$1.removeEPB(m),r)),c.push(m);break;case 34:l.push(t.subarray(h,h+s))}h+=s}}return{hvcC:r,sps:i,spsArr:c,ppsArr:l,vpsArr:d,nalUnitSize:u}}}},{key:"parseVPS",value:function(t,r){r=r||{};var n=new ExpGolomb$1(t);n.readUByte(),n.readUByte(),n.readBits(12);var i=n.readBits(3);return r.numTemporalLayers=Math.max(r.numTemporalLayers||0,i+1),n.readBits(17),e._parseProfileTierLevel(n,i,r),r}},{key:"parseSPS",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r=r||{};var n=new ExpGolomb$1(t);n.readUByte(),n.readUByte(),n.readBits(4);var i=n.readBits(3);r.numTemporalLayers=Math.max(i+1,r.numTemporalLayers||0),r.temporalIdNested=n.readBits(1),e._parseProfileTierLevel(n,i,r),n.readUEG();var a=r.chromaFormatIdc=n.readUEG(),o=420;a<=3&&(o=[0,420,422,444][a]);var s=0;3===a&&(s=n.readBits(1));var u,c,l,d,h=n.readUEG(),f=n.readUEG(),p=n.readBits(1);if(1===p&&(u=n.readUEG(),c=n.readUEG(),l=n.readUEG(),d=n.readUEG()),r.bitDepthLumaMinus8=n.readUEG(),r.bitDepthChromaMinus8=n.readUEG(),1===p){var g=1!==a&&2!==a||0!==s?1:2,y=1===a&&0===s?2:1;h-=g*(c+u),f-=y*(d+l)}return{codec:"hev1.1.6.L93.B0",width:h,height:f,chromaFormat:o,hvcC:r}}},{key:"_parseProfileTierLevel",value:function(e,t,r){var n=r.generalTierFlag||0;r.generalProfileSpace=e.readBits(2),r.generalTierFlag=Math.max(e.readBits(1),n),r.generalProfileIdc=Math.max(e.readBits(5),r.generalProfileIdc||0),r.generalProfileCompatibilityFlags=e.readBits(32),r.generalConstraintIndicatorFlags=[e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8)];var i=e.readBits(8);n<r.generalTierFlag?r.generalLevelIdc=i:r.generalLevelIdc=Math.max(i,r.generalLevelIdc||0);for(var a=[],o=[],s=0;s<t;s++)a[s]=e.readBits(1),o[s]=e.readBits(1);t>0&&e.readBits(2*(8-t));for(var u=0;u<t;u++)0!==a[u]&&(e.readBits(2),e.readBits(1),e.readBits(5),e.readBits(16),e.readBits(16),e.readBits(4),e.readBits(16),e.readBits(16),e.readBits(12)),0!==o[u]&&e.readBits(8)}}]),e}(),AVC$1=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"parseAVCDecoderConfigurationRecord",value:function(t){if(!(t.length<7)){for(var r,n,i=1+(3&t[4]),a=[],o=[],s=6,u=31&t[5],c=0;c<u;c++)if(n=t[s]<<8|t[s+1],s+=2,n){var l=t.subarray(s,s+n);s+=n,a.push(l),r||(r=e.parseSPS(NALu$1.removeEPB(l)))}var d,h=t[s];s++;for(var f=0;f<h;f++)d=t[s]<<8|t[s+1],s+=2,d&&(o.push(t.subarray(s,s+d)),s+=d);return{sps:r,spsArr:a,ppsArr:o,nalUnitSize:i}}}},{key:"parseSPS",value:function(e){var t=new ExpGolomb$1(e);t.readUByte();var r=t.readUByte(),n=t.readUByte(),i=t.readUByte();t.skipUEG();var a=420;if(100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r){var o=t.readUEG();if(o<=3&&(a=[0,420,422,444][o]),3===o&&t.skipBits(1),t.skipUEG(),t.skipUEG(),t.skipBits(1),t.readBool())for(var s=3!==o?8:12,u=0;u<s;u++)t.readBool()&&(u<6?t.skipScalingList(16):t.skipScalingList(64))}t.skipUEG();var c=t.readUEG();if(0===c)t.readUEG();else if(1===c){t.skipBits(1),t.skipUEG(),t.skipUEG();for(var l=t.readUEG(),d=0;d<l;d++)t.skipUEG()}t.skipUEG(),t.skipBits(1);var h=t.readUEG(),f=t.readUEG(),p=t.readBits(1);0===p&&t.skipBits(1),t.skipBits(1);var g,y,m,v,_,b=0,A=0,E=0,S=0;if(t.readBool()&&(b=t.readUEG(),A=t.readUEG(),E=t.readUEG(),S=t.readUEG()),t.readBool()){if(t.readBool())switch(t.readUByte()){case 1:g=[1,1];break;case 2:g=[12,11];break;case 3:g=[10,11];break;case 4:g=[16,11];break;case 5:g=[40,33];break;case 6:g=[24,11];break;case 7:g=[20,11];break;case 8:g=[32,11];break;case 9:g=[80,33];break;case 10:g=[18,11];break;case 11:g=[15,11];break;case 12:g=[64,33];break;case 13:g=[160,99];break;case 14:g=[4,3];break;case 15:g=[3,2];break;case 16:g=[2,1];break;case 255:g=[t.readUByte()<<8|t.readUByte(),t.readUByte()<<8|t.readUByte()]}if(t.readBool()&&t.readBool(),t.readBool()&&(t.readBits(4),t.readBool()&&t.readBits(24)),t.readBool()&&(t.readUEG(),t.readUEG()),t.readBool()){var T=t.readBits(32),w=t.readBits(32);y=t.readBool(),_=(m=w)/(v=2*T)}}return{codec:getAvcCodec$2(e.subarray(1,4)),profileIdc:r,profileCompatibility:n,levelIdc:i,chromaFormat:a,width:Math.ceil(16*(h+1)-2*(b+A)),height:(2-p)*(f+1)*16-(p?2:4)*(E+S),sarRatio:g,fpsNum:m,fpsDen:v,fps:_,fixedFrame:y}}}]),e}(),VideoSample$2=function(){function e(t,r,n){_classCallCheck$4(this,e),_defineProperty$5(this,"flag",{}),_defineProperty$5(this,"keyframe",!1),_defineProperty$5(this,"gopId",0),_defineProperty$5(this,"duration",0),_defineProperty$5(this,"size",0),_defineProperty$5(this,"units",[]),_defineProperty$5(this,"chromaFormat",420),this.originPts=this.pts=t,this.originDts=this.dts=r,n&&(this.units=n)}return _createClass$5(e,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),e}(),uncurryThis$k=functionUncurryThis,aCallable$1=aCallable$c,isObject$a=isObject$y,hasOwn$8=hasOwnProperty_1,arraySlice$1=arraySlice$c,NATIVE_BIND=functionBindNative,$Function=Function,concat$1=uncurryThis$k([].concat),join=uncurryThis$k([].join),factories={},construct=function(e,t,r){if(!hasOwn$8(factories,t)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";factories[t]=$Function("C,a","return new C("+join(n,",")+")")}return factories[t](e,r)},functionBind=NATIVE_BIND?$Function.bind:function(e){var t=aCallable$1(this),r=t.prototype,n=arraySlice$1(arguments,1),i=function(){var r=concat$1(n,arraySlice$1(arguments));return this instanceof i?construct(t,r.length,r):t.apply(e,r)};return isObject$a(r)&&(i.prototype=r),i},$$P=_export,getBuiltIn$7=getBuiltIn$j,apply$1=functionApply,bind$2=functionBind,aConstructor=aConstructor$3,anObject$5=anObject$p,isObject$9=isObject$y,create$3=objectCreate$1,fails$f=fails$10,nativeConstruct=getBuiltIn$7("Reflect","construct"),ObjectPrototype$1=Object.prototype,push$3=[].push,NEW_TARGET_BUG=fails$f((function(){function e(){}return!(nativeConstruct((function(){}),[],e)instanceof e)})),ARGS_BUG=!fails$f((function(){nativeConstruct((function(){}))})),FORCED$7=NEW_TARGET_BUG||ARGS_BUG;function _setPrototypeOf$4(e,t){return(_setPrototypeOf$4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _inherits$4(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$4(e,t)}function _typeof$4(e){return(_typeof$4="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _assertThisInitialized$4(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$4(e,t){if(t&&("object"===_typeof$4(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$4(e)}function _getPrototypeOf$4(e){return(_getPrototypeOf$4=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _createSuper$q(e){var t=_isNativeReflectConstruct$r();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$r(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}$$P({target:"Reflect",stat:!0,forced:FORCED$7,sham:FORCED$7},{construct:function(e,t){aConstructor(e),anObject$5(t);var r=arguments.length<3?e:aConstructor(arguments[2]);if(ARGS_BUG&&!NEW_TARGET_BUG)return nativeConstruct(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return apply$1(push$3,n,t),new(apply$1(bind$2,e,n))}var i=r.prototype,a=create$3(isObject$9(i)?i:ObjectPrototype$1),o=apply$1(e,a,t);return isObject$9(o)?o:a}});var Sample$1=_createClass$5((function e(t,r){_classCallCheck$4(this,e),_defineProperty$5(this,"time",0),this.data=t,this.originPts=this.pts=r})),FlvScriptSample=function(e){_inherits$4(r,e);var t=_createSuper$q(r);function r(){return _classCallCheck$4(this,r),t.apply(this,arguments)}return _createClass$5(r)}(Sample$1),SeiSample$1=function(e){_inherits$4(r,e);var t=_createSuper$q(r);function r(){return _classCallCheck$4(this,r),t.apply(this,arguments)}return _createClass$5(r)}(Sample$1),MetadataTrack$2=function(){function e(){_classCallCheck$4(this,e),_defineProperty$5(this,"id",3),_defineProperty$5(this,"type",TrackType$3.METADATA),_defineProperty$5(this,"timescale",0),_defineProperty$5(this,"flvScriptSamples",[]),_defineProperty$5(this,"seiSamples",[])}return _createClass$5(e,[{key:"exist",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length||!this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length)}}]),e}(),VideoTrack$2=function(){function e(){_classCallCheck$4(this,e),_defineProperty$5(this,"id",1),_defineProperty$5(this,"type",TrackType$3.VIDEO),_defineProperty$5(this,"codecType",VideoCodecType$3.AVC),_defineProperty$5(this,"pid",-1),_defineProperty$5(this,"hvcC",void 0),_defineProperty$5(this,"codec",""),_defineProperty$5(this,"timescale",0),_defineProperty$5(this,"formatTimescale",0),_defineProperty$5(this,"sequenceNumber",0),_defineProperty$5(this,"baseMediaDecodeTime",0),_defineProperty$5(this,"baseDts",0),_defineProperty$5(this,"duration",0),_defineProperty$5(this,"warnings",[]),_defineProperty$5(this,"samples",[]),_defineProperty$5(this,"pps",[]),_defineProperty$5(this,"sps",[]),_defineProperty$5(this,"vps",[]),_defineProperty$5(this,"fpsNum",0),_defineProperty$5(this,"fpsDen",0),_defineProperty$5(this,"sarRatio",[]),_defineProperty$5(this,"width",0),_defineProperty$5(this,"height",0),_defineProperty$5(this,"nalUnitSize",4),_defineProperty$5(this,"present",!1),_defineProperty$5(this,"ext",void 0)}return _createClass$5(e,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"exist",value:function(){return!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}}]),e}(),AudioTrack$2=function(){function e(){_classCallCheck$4(this,e),_defineProperty$5(this,"id",2),_defineProperty$5(this,"type",TrackType$3.AUDIO),_defineProperty$5(this,"codecType",AudioCodecType$2.AAC),_defineProperty$5(this,"pid",-1),_defineProperty$5(this,"codec",""),_defineProperty$5(this,"sequenceNumber",0),_defineProperty$5(this,"sampleDuration",0),_defineProperty$5(this,"timescale",0),_defineProperty$5(this,"formatTimescale",0),_defineProperty$5(this,"baseMediaDecodeTime",0),_defineProperty$5(this,"duration",0),_defineProperty$5(this,"warnings",[]),_defineProperty$5(this,"samples",[]),_defineProperty$5(this,"baseDts",0),_defineProperty$5(this,"sampleSize",16),_defineProperty$5(this,"sampleRate",0),_defineProperty$5(this,"channelCount",0),_defineProperty$5(this,"objectType",0),_defineProperty$5(this,"sampleRateIndex",0),_defineProperty$5(this,"config",[]),_defineProperty$5(this,"present",!1),_defineProperty$5(this,"ext",void 0)}return _createClass$5(e,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec&&this.codecType===AudioCodecType$2.AAC)}},{key:"hasSample",value:function(){return!!this.samples.length}}]),e}(),logger$8=new Logger$7("FlvDemuxer"),FlvDemuxer=function(){function e(t,r,n){_classCallCheck$4(this,e),_defineProperty$5(this,"_headerParsed",!1),_defineProperty$5(this,"_remainingData",null),_defineProperty$5(this,"_gopId",0),_defineProperty$5(this,"_needAddMetaBeforeKeyFrameNal",!0),this.videoTrack=t||new VideoTrack$2,this.audioTrack=r||new AudioTrack$2,this.metadataTrack=n||new MetadataTrack$2,this._fixer=new FlvFixer(this.videoTrack,this.audioTrack,this.metadataTrack)}return _createClass$5(e,[{key:"demux",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this.audioTrack,a=this.videoTrack,o=this.metadataTrack;if(!r&&n||(this._remainingData=null,this._headerParsed=!1),r?(a.reset(),i.reset(),o.reset()):(a.samples=[],i.samples=[],o.seiSamples=[],o.flvScriptSamples=[],a.warnings=[],i.warnings=[],this._remainingData&&(t=concatUint8Array$4(this._remainingData,t),this._remainingData=null)),!t.length)return{videoTrack:a,audioTrack:i,metadataTrack:o};var s=0;if(!this._headerParsed){if(!e.probe(t))throw new Error("Invalid flv file");i.present=(4&t[4])>>>2!=0,a.present=0!=(1&t[4]),this._headerParsed=!0,s=readBig32$2(t,5)+4}for(var u,c,l,d,h,f=t.length;s+15<f&&(u=t[s],!(s+15+(c=t[s+1]<<16|t[s+2]<<8|t[s+3])>f));)l=(t[s+7]<<24>>>0)+(t[s+4]<<16)+(t[s+5]<<8)+t[s+6],s+=11,d=t.subarray(s,s+c),8===u?this._parseAudio(d,l):9===u?this._parseVideo(d,l):18===u?this._parseScript(d,l):logger$8.warn("Invalid tag type: ".concat(u)),(h=readBig32$2(t,s+=c))!==11+c&&logger$8.warn("Invalid PrevTagSize ".concat(h," (").concat(11+c,")")),s+=4;return s<f&&(this._remainingData=t.subarray(s)),i.formatTimescale=a.formatTimescale=a.timescale=o.timescale=1e3,i.timescale=i.sampleRate||0,!i.exist()&&i.hasSample()&&i.reset(),!a.exist()&&a.hasSample()&&a.reset(),{videoTrack:a,audioTrack:i,metadataTrack:o}}},{key:"fix",value:function(e,t,r){return this._fixer.fix(e,t,r),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(e,t,r,n){return this.demux(e,t,r),this.fix(n,t,r)}},{key:"_parseAudio",value:function(t,r){if(t.length){var n=(240&t[0])>>>4,i=this.audioTrack;if(10!==n&&7!==n&&8!==n)return logger$8.warn("Unsupported sound format: ".concat(n)),void i.reset();if(10!==n){var a=(12&t[0])>>2,o=(2&t[0])>>1,s=1&t[0];i.sampleRate=e.AUDIO_RATE[a],i.sampleSize=o?16:8,i.channelCount=s+1}10===n?this._parseAac(t,r):this._parseG711(t,r,n)}}},{key:"_parseG711",value:function(e,t,r){var n=this.audioTrack;n.codecType=7===r?AudioCodecType$2.G711PCMA:AudioCodecType$2.G711PCMU,n.sampleRate=8e3,n.codec=n.codecType,n.samples.push(new AudioSample$2(t,e.subarray(1)))}},{key:"_parseAac",value:function(e,t){var r=this.audioTrack;if(r.codecType=AudioCodecType$2.AAC,0===e[1]){var n=AAC$2.parseAudioSpecificConfig(e.subarray(2));n?(r.codec=n.codec,r.channelCount=n.channelCount,r.sampleRate=n.sampleRate,r.config=n.config,r.objectType=n.objectType,r.sampleRateIndex=n.samplingFrequencyIndex):(r.reset(),logger$8.warn("Cannot parse AudioSpecificConfig",e))}else if(1===e[1]){if(null==t)return;r.samples.push(new AudioSample$2(t,e.subarray(2)))}else logger$8.warn("Unknown AACPacketType: ".concat(e[1]))}},{key:"_parseVideo",value:function(e,t){var r=this;if(!(e.length<6)){var n=(240&e[0])>>>4,i=15&e[0],a=this.videoTrack;if(7!==i&&12!==i)return a.reset(),void logger$8.warn("Unsupported codecId: ".concat(i));var o=12===i;a.codecType=o?VideoCodecType$3.HEVC:VideoCodecType$3.AVC;var s=e[1],u=(e[2]<<16|e[3]<<8|e[4])<<8>>8;if(0===s){var c=e.subarray(5),l=o?HEVC$1.parseHEVCDecoderConfigurationRecord(c):AVC$1.parseAVCDecoderConfigurationRecord(c);if(l){var d=l.hvcC,h=l.sps,f=l.ppsArr,p=l.spsArr,g=l.vpsArr,y=l.nalUnitSize;d&&(a.hvcC=a.hvcC||d),h&&(a.codec=h.codec,a.width=h.width,a.height=h.height,a.sarRatio=h.sarRatio,a.fpsNum=h.fpsNum,a.fpsDen=h.fpsDen),p.length&&(a.sps=p),f.length&&(a.pps=f),g&&g.length&&(a.vps=g),y&&(a.nalUnitSize=y)}else logger$8.warn("Cannot parse ".concat(o?"HEVC":"AVC","DecoderConfigurationRecord"),e)}else if(1===s){var m=NALu$1.parseAvcC(e.subarray(5),a.nalUnitSize);if((m=this._checkAddMetaNalToUnits(o,m,a))&&m.length){var v=new VideoSample$2(t+u,t,m);1===n&&v.setToKeyframe(),a.samples.push(v),m.forEach((function(e){var n=o?e[0]>>>1&63:31&e[0];switch(n){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!o&&5!==n||o&&5===n)break;v.setToKeyframe();break;case 6:case 39:case 40:if(!o&&6!==n||o&&6===n)break;r.metadataTrack.seiSamples.push(new SeiSample$1(NALu$1.parseSEI(NALu$1.removeEPB(e)),t+u))}})),v.keyframe&&this._gopId++,v.gopId=this._gopId}else logger$8.warn("Cannot parse NALUs",e)}else 2===s||logger$8.warn("Unknown AVCPacketType: ".concat(s))}}},{key:"_checkAddMetaNalToUnits",value:function(e,t,r){return e&&this._needAddMetaBeforeKeyFrameNal?t.map((function(e){return e[0]>>>1&63})).includes(32)?(this._needAddMetaBeforeKeyFrameNal=!1,t):(t.unshift(r.pps[0]),t.unshift(r.sps[0]),t.unshift(r.vps[0]),t.filter(Boolean)):(this._needAddMetaBeforeKeyFrameNal=!1,t)}},{key:"_parseScript",value:function(e,t){this.metadataTrack.flvScriptSamples.push(new FlvScriptSample(AMF.parse(e),t))}}],[{key:"probe",value:function(e){return 70===e[0]&&76===e[1]&&86===e[2]&&1===e[3]&&readBig32$2(e,5)>=9}}]),e}();function _arrayLikeToArray$5(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _arrayWithoutHoles$1(e){if(Array.isArray(e))return _arrayLikeToArray$5(e)}function _iterableToArray$1(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _unsupportedIterableToArray$5(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$5(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$5(e,t):void 0}}function _nonIterableSpread$1(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _toConsumableArray$1(e){return _arrayWithoutHoles$1(e)||_iterableToArray$1(e)||_unsupportedIterableToArray$5(e)||_nonIterableSpread$1()}_defineProperty$5(FlvDemuxer,"AUDIO_RATE",[5500,11e3,22e3,44e3]);var uncurryThis$j=functionUncurryThis,toLength$2=toLength$b,toString$f=toString$v,$repeat=stringRepeat,requireObjectCoercible$4=requireObjectCoercible$e,repeat$1=uncurryThis$j($repeat),stringSlice$4=uncurryThis$j("".slice),ceil=Math.ceil,createMethod$1=function(e){return function(t,r,n){var i,a,o=toString$f(requireObjectCoercible$4(t)),s=toLength$2(r),u=o.length,c=void 0===n?" ":toString$f(n);return s<=u||""==c?o:((a=repeat$1(c,ceil((i=s-u)/c.length))).length>i&&(a=stringSlice$4(a,0,i)),e?o+a:a+o)}},stringPad={start:createMethod$1(!1),end:createMethod$1(!0)},userAgent$1=engineUserAgent,stringPadWebkitBug=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(userAgent$1),$$O=_export,$padStart=stringPad.start,WEBKIT_BUG=stringPadWebkitBug;$$O({target:"String",proto:!0,forced:WEBKIT_BUG},{padStart:function(e){return $padStart(this,e,arguments.length>1?arguments[1]:void 0)}});var global$b=global$O,DESCRIPTORS$a=descriptors,defineBuiltInAccessor$1=defineBuiltInAccessor$5,regExpFlags=regexpFlags$1,fails$e=fails$10,RegExp$1=global$b.RegExp,RegExpPrototype=RegExp$1.prototype,FORCED$6=DESCRIPTORS$a&&fails$e((function(){var e=!0;try{RegExp$1(".","d")}catch(error){e=!1}var t={},r="",n=e?"dgimsy":"gimsy",i=function(e,n){Object.defineProperty(t,e,{get:function(){return r+=n,!0}})},a={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var o in e&&(a.hasIndices="d"),a)i(o,a[o]);return Object.getOwnPropertyDescriptor(RegExpPrototype,"flags").get.call(t)!==n||r!==n}));FORCED$6&&defineBuiltInAccessor$1(RegExpPrototype,"flags",{configurable:!0,get:regExpFlags});var $$N=_export,from=arrayFrom$1,checkCorrectnessOfIteration=checkCorrectnessOfIteration$4,INCORRECT_ITERATION=!checkCorrectnessOfIteration((function(e){Array.from(e)}));function _arrayWithHoles$1(e){if(Array.isArray(e))return e}function _iterableToArrayLimit$1(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(u){s=!0,i=u}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}function _nonIterableRest$1(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _slicedToArray$1(e,t){return _arrayWithHoles$1(e)||_iterableToArrayLimit$1(e,t)||_unsupportedIterableToArray$5(e,t)||_nonIterableRest$1()}$$N({target:"Array",stat:!0,forced:INCORRECT_ITERATION},{from:from});var $$M=_export,global$a=global$O,arrayBufferModule=arrayBuffer,setSpecies=setSpecies$5,ARRAY_BUFFER="ArrayBuffer",ArrayBuffer$2=arrayBufferModule[ARRAY_BUFFER],NativeArrayBuffer=global$a[ARRAY_BUFFER];$$M({global:!0,constructor:!0,forced:NativeArrayBuffer!==ArrayBuffer$2},{ArrayBuffer:ArrayBuffer$2}),setSpecies(ARRAY_BUFFER);var UINT32_MAX$3=Math.pow(2,32)-1,MP4$4=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"box",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=8+(r=r.filter(Boolean)).reduce((function(e,t){return e+t.byteLength}),0),a=new Uint8Array(i);a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(e,4);var o=8;return r.forEach((function(e){a.set(e,o),o+=e.byteLength})),a}},{key:"ftyp",value:function(t){return t.find((function(e){return e.type===TrackType$3.VIDEO&&e.codecType===VideoCodecType$3.HEVC}))?e.FTYPHEV1:e.FTYPAVC1}},{key:"initSegment",value:function(t){return concatUint8Array$4(e.ftyp(t),e.moov(t))}},{key:"moov",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat(_toConsumableArray$1(t.map((function(t){return e.trak(t)}))),[e.mvex(t)]))}},{key:"mvhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdia(t))}},{key:"tkhd",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minf(t))}},{key:"mdhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,85,196,0,0]))}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"minf",value:function(t){return e.box(e.types.minf,t.type===TrackType$3.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stbl(t))}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.STTS,e.STSC,e.STSZ,e.STCO)}},{key:"stsd",value:function(t){return e.box(e.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),t.type===TrackType$3.VIDEO?e.avc1hev1(t):e.mp4a(t))}},{key:"avc1hev1",value:function(t){var r=t.codecType===VideoCodecType$3.HEVC,n=r?e.types.hvc1:e.types.avc1,i=r?e.hvcC(t):e.avcC(t),a=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i];return t.sarRatio&&t.sarRatio.length>1&&a.push(e.pasp(t.sarRatio)),e.box.apply(e,[n].concat(a))}},{key:"avcC",value:function(t){var r,n=[],i=[];return t.sps.forEach((function(e){r=e.byteLength,n.push(r>>>8&255),n.push(255&r),n.push.apply(n,_toConsumableArray$1(e))})),t.pps.forEach((function(e){r=e.byteLength,i.push(r>>>8&255),i.push(255&r),i.push.apply(i,_toConsumableArray$1(e))})),e.box(e.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|t.sps.length].concat(n).concat([t.pps.length]).concat(i)))}},{key:"hvcC",value:function(t){var r=t.hvcC;if(r instanceof ArrayBuffer)return r;var n,i=t.vps,a=t.sps,o=t.pps;if(r){var s=r.generalProfileCompatibilityFlags,u=r.generalConstraintIndicatorFlags,c=(i.length&&1)+(a.length&&1)+(o.length&&1);n=[1,r.generalProfileSpace<<6|r.generalTierFlag<<5|r.generalProfileIdc,s>>>24,s>>>16,s>>>8,s,u[0],u[1],u[2],u[3],u[4],u[5],r.generalLevelIdc,240,0,252,252|r.chromaFormatIdc,248|r.bitDepthLumaMinus8,248|r.bitDepthChromaMinus8,0,0,r.numTemporalLayers<<3|r.temporalIdNested<<2|3,c];var l=function(e){var t;n.push(e.length>>8,e.length),(t=n).push.apply(t,_toConsumableArray$1(e))};i.length&&(n.push(160,0,i.length),i.forEach(l)),a.length&&(n.push(161,0,a.length),a.forEach(l)),o.length&&(n.push(162,0,o.length),o.forEach(l))}else n=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return e.box(e.types.hvcC,new Uint8Array(n))}},{key:"pasp",value:function(t){var r=_slicedToArray$1(t,2),n=r[0],i=r[1];return e.box(e.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i]))}},{key:"mp4a",value:function(t){return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,255&t.sampleRate,0,0]),t.config.length?e.esds(t.config):void 0)}},{key:"esds",value:function(t){var r=t.length;return e.box(e.types.esds,new Uint8Array([0,0,0,0,3,23+r,0,0,0,4,15+r,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([r]).concat(t).concat([6,1,2])))}},{key:"mvex",value:function(t){return e.box.apply(e,[e.types.mvex].concat(_toConsumableArray$1(t.map((function(t){return e.trex(t.id)})))))}},{key:"trex",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"moof",value:function(t,r){return e.box.apply(e,[e.types.moof,e.mfhd(t)].concat(_toConsumableArray$1(r.map((function(t){return e.traf(t)})))))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"traf",value:function(t){return e.box(e.types.traf,e.tfhd(t.id),e.tfdt(t.baseMediaDecodeTime),e.trun(t.samples,76))}},{key:"tfhd",value:function(t){return e.box(e.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"tfdt",value:function(t){var r=Math.floor(t/(UINT32_MAX$3+1)),n=Math.floor(t%(UINT32_MAX$3+1));return e.box(e.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n]))}},{key:"trun",value:function(t,r){var n=t.length,i=12+16*n;r+=8+i;var a=new Uint8Array(i);a.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0);for(var o=0;o<n;o++){var s=t[o],u=s.duration,c=s.size,l=s.flag,d=void 0===l?{}:l,h=s.cts,f=void 0===h?0:h;a.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,c>>>24&255,c>>>16&255,c>>>8&255,255&c,d.isLeading<<2|(null==d.dependsOn?1:d.dependsOn),d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|(null==d.isNonSyncSample?1:d.isNonSyncSample),61440&d.degradationPriority,15&d.degradationPriority,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*o)}return e.box(e.types.trun,a)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"moovMP4",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat(_toConsumableArray$1(t.map((function(t){return e.trackMP4(t)})))))}},{key:"trackMP4",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdiaMP4(t))}},{key:"mdiaMP4",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minfMP4(t))}},{key:"minfMP4",value:function(t){return e.box(e.types.minf,t.type===TrackType$3.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stblMP4(t))}},{key:"stblMP4",value:function(t){var r=t.ext,n=[e.stsd(t),e.stts(r.stts),e.stsc(r.stsc),e.stsz(r.stsz),e.stco(r.stco)];return r.stss.length&&n.push(e.stss(r.stss)),r.ctts.length&&n.push(e.ctts(r.ctts)),e.box.apply(e,[e.types.stbl].concat(n))}},{key:"stts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.stts,concatUint8Array$4(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsc",value:function(t){var r=t.length,n=new Uint8Array(12*r),i=0;return t.forEach((function(e){var t=e.firstChunk,r=e.samplesPerChunk,a=e.sampleDescIndex;n.set([t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a],i),i+=12})),e.box(e.types.stsc,concatUint8Array$4(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsz",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stsz,concatUint8Array$4(new Uint8Array([0,0,0,0,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stco",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stco,concatUint8Array$4(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stss",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stss,concatUint8Array$4(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"ctts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.ctts,concatUint8Array$4(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}}]),e}();_defineProperty$5(MP4$4,"types",["avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trun","trex","tkhd","vmhd","smhd","ctts","stss"].reduce((function(e,t){return e[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)],e}),Object.create(null))),_defineProperty$5(MP4$4,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])}),_defineProperty$5(MP4$4,"FTYPAVC1",MP4$4.box(MP4$4.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))),_defineProperty$5(MP4$4,"FTYPHEV1",MP4$4.box(MP4$4.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49]))),_defineProperty$5(MP4$4,"DINF",MP4$4.box(MP4$4.types.dinf,MP4$4.box(MP4$4.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])))),_defineProperty$5(MP4$4,"VMHD",MP4$4.box(MP4$4.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))),_defineProperty$5(MP4$4,"SMHD",MP4$4.box(MP4$4.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0]))),_defineProperty$5(MP4$4,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0])),_defineProperty$5(MP4$4,"STTS",MP4$4.box(MP4$4.types.stts,MP4$4.StblTable)),_defineProperty$5(MP4$4,"STSC",MP4$4.box(MP4$4.types.stsc,MP4$4.StblTable)),_defineProperty$5(MP4$4,"STSZ",MP4$4.box(MP4$4.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]))),_defineProperty$5(MP4$4,"STCO",MP4$4.box(MP4$4.types.stco,MP4$4.StblTable));var browserVersions=/Chrome\/([^.]+)/.exec(navigator.userAgent),ForceFirstIDR=browserVersions&&Number(browserVersions[1])<50,FMP4Remuxer$2=function(){function e(t,r){_classCallCheck$4(this,e),this.videoTrack=t,this.audioTrack=r}return _createClass$5(e,[{key:"remux",value:function(){var e,t,r,n,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=this.videoTrack,o=this.audioTrack,s=a.exist(),u=o.exist();return i&&(s&&(e=MP4$4.initSegment([this.videoTrack])),u&&(t=MP4$4.initSegment([this.audioTrack]))),s&&a.hasSample()&&(r=this._remuxVideo()),u&&o.hasSample()&&(n=this._remuxAudio()),a.samples=[],o.samples=[],{videoInitSegment:e,audioInitSegment:t,videoSegment:r,audioSegment:n}}},{key:"_remuxVideo",value:function(){var e=this.videoTrack,t=e.samples;ForceFirstIDR&&(t[0].flag={dependsOn:2,isNonSyncSample:0});var r=0;t.forEach((function(e){r+=e.units.reduce((function(e,t){return e+t.byteLength}),0),r+=4*e.units.length}));for(var n,i=new Uint8Array(r),a=new DataView(i.buffer),o=function(e,r,o,s){s=t[e];var u=0;s.units.forEach((function(e){a.setUint32(o,e.byteLength),o+=4,i.set(e,o),o+=e.byteLength,u+=4+e.byteLength})),s.size=u,c=o,n=s},s=0,u=t.length,c=0;s<u;s++)o(s,0,c,n);return concatUint8Array$4(MP4$4.moof(this.videoTrack.sequenceNumber++,[e]),MP4$4.mdat(i))}},{key:"_remuxAudio",value:function(){var e=this.audioTrack,t=MP4$4.moof(this.audioTrack.sequenceNumber++,[e]),r=new Uint8Array(e.samples.reduce((function(e,t){return e+t.size}),0));return e.samples.reduce((function(e,t){return r.set(t.data,e),e+t.size}),0),concatUint8Array$4(t,MP4$4.mdat(r))}}]),e}(),InnerEvent={DEMUXED_TRACK:"demuxedtrack"},logger$7=new Logger$8("BufferService"),BufferService$1=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2e4;_classCallCheck$6(this,e),_defineProperty$7(this,"flv",null),_defineProperty$7(this,"_demuxer",new FlvDemuxer),_defineProperty$7(this,"_remuxer",null),_defineProperty$7(this,"_mse",null),_defineProperty$7(this,"_softVideo",null),_defineProperty$7(this,"_sourceCreated",!1),_defineProperty$7(this,"_needInitSegment",!0),_defineProperty$7(this,"_discontinuity",!0),_defineProperty$7(this,"_contiguous",!1),_defineProperty$7(this,"_initSegmentId",""),_defineProperty$7(this,"_cachedBuffer",null),_defineProperty$7(this,"_demuxStartTime",0),_defineProperty$7(this,"_analyzeDuration",0),this.flv=t,this._analyzeDuration=n,r?this._softVideo=r:(this._remuxer=new FMP4Remuxer$2(this._demuxer.videoTrack,this._demuxer.audioTrack),this._mse=new MSE$3,this._mse.bindMedia(t.media))}var t,r,n,i,a,o;return _createClass$7(e,[{key:"baseDts",get:function(){var e,t;return null===(e=this._demuxer)||void 0===e||null===(t=e._fixer)||void 0===t?void 0:t._baseDts}},{key:"seamlessSwitch",value:function(){this._needInitSegment=!0,this._discontinuity=!0,this._contiguous=!0,this._initSegmentId=""}},{key:"unContiguous",value:function(e){this._contiguous=!1,this._demuxStartTime=e}},{key:"reset",value:(o=_asyncToGenerator$6(_regeneratorRuntime$4().mark((function e(t){return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse||t){e.next=5;break}return e.next=3,this._mse.unbindMedia();case 3:return e.next=5,this._mse.bindMedia(this.flv.media);case 5:this._needInitSegment=!0,this._discontinuity=!0,this._contiguous=!1,this._sourceCreated=!1,this._initSegmentId="";case 10:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"endOfStream",value:(a=_asyncToGenerator$6(_regeneratorRuntime$4().mark((function e(){return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=7;break}if(!this._sourceCreated){e.next=5;break}return e.next=4,this._mse.endOfStream();case 4:this.flv.emit(EVENT$1.BUFFEREOS);case 5:e.next=8;break;case 7:this._softVideo&&this._softVideo.endOfStream();case 8:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"updateDuration",value:(i=_asyncToGenerator$6(_regeneratorRuntime$4().mark((function e(t){return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=7;break}if(this._mse.isOpened){e.next=4;break}return e.next=4,this._mse.open();case 4:return logger$7.debug("update duration",t),e.next=7,this._mse.updateDuration(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"destroy",value:(n=_asyncToGenerator$6(_regeneratorRuntime$4().mark((function e(){return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=3;break}return e.next=3,this._mse.unbindMedia();case 3:this._mse=null,this._softVideo=null,this._demuxer=null,this._remuxer=null;case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"appendBuffer",value:(r=_asyncToGenerator$6(_regeneratorRuntime$4().mark((function e(t){var r,n,i,a,o,s,u,c,l,d,h,f,p,g;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._cachedBuffer&&(t=concatUint8Array$5(this._cachedBuffer,t),this._cachedBuffer=null),r=this._demuxer,t&&t.length&&r){e.next=4;break}return e.abrupt("return");case 4:e.prev=4,r.demuxAndFix(t,this._discontinuity,this._contiguous,this._demuxStartTime),e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(4),new StreamingError$1(ERR$1.DEMUX,ERR$1.SUB_TYPES.FLV,e.t0);case 11:if(n=r.videoTrack,i=r.audioTrack,a=r.metadataTrack,o=n.exist(),s=i.exist(),!(!o&&n.present||!s&&i.present)){e.next=27;break}if(u=0,(c=o?n:s?i:void 0)&&c.samples.length&&(u=(c.samples[c.samples.length-1].originPts-c.samples[0].originPts)/c.timescale*1e3),!(u>this._analyzeDuration)){e.next=25;break}logger$7.warn("analyze duration exceeded, ".concat(u,"ms"),c),n.present=o,i.present=s,this.flv.emit(EVENT$1.ANALYZE_DURATION_EXCEEDED,{duration:u}),e.next=27;break;case 25:return this._cachedBuffer=t,e.abrupt("return");case 27:if(l=n.type,d=i.type,this._fireEvents(n,i,a),this._discontinuity=!1,this._contiguous=!0,this._demuxStartTime=0,h=this._mse,this.flv.emit(InnerEvent.DEMUXED_TRACK,n),(f="".concat(n.codec,"/").concat(n.width,"/").concat(n.height,"/").concat(i.codec))!==this._initSegmentId&&(this._needInitSegment=!0,this._initSegmentId=f,this._emitMetaParsedEvent(n,i)),!h){e.next=63;break}if(this._sourceCreated){e.next=45;break}return e.next=41,h.open();case 41:o&&h.createSource(l,"video/mp4;codecs=".concat(n.codec)),s&&h.createSource(d,"audio/mp4;codecs=".concat(i.codec)),this._sourceCreated=!0,this.flv.emit(EVENT$1.SOURCEBUFFER_CREATED);case 45:e.prev=45,p=this._remuxer.remux(this._needInitSegment),e.next=52;break;case 49:throw e.prev=49,e.t1=e.catch(45),new StreamingError$1(ERR$1.REMUX,ERR$1.SUB_TYPES.FMP4,e.t1);case 52:if(!this._needInitSegment||p.videoInitSegment||p.audioInitSegment){e.next=54;break}return e.abrupt("return");case 54:return this._needInitSegment=!1,g=[],p.videoInitSegment&&g.push(h.append(l,p.videoInitSegment)),p.audioInitSegment&&g.push(h.append(d,p.audioInitSegment)),p.videoSegment&&g.push(h.append(l,p.videoSegment)),p.audioSegment&&g.push(h.append(d,p.audioSegment)),e.abrupt("return",Promise.all(g));case 63:this._softVideo&&this._softVideo.appendBuffer(n,i);case 64:case"end":return e.stop()}}),e,this,[[4,8],[45,49]])}))),function(e){return r.apply(this,arguments)})},{key:"evictBuffer",value:(t=_asyncToGenerator$6(_regeneratorRuntime$4().mark((function e(t){var r,n,i,a=this;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.flv.media,this._mse&&this._demuxer&&r&&t&&!(t<0)){e.next=3;break}return e.abrupt("return");case 3:if(n=r.currentTime,!((i=n-t)<=0)){e.next=7;break}return e.abrupt("return");case 7:if(!(Buffer$2.start(Buffer$2.get(r))+1>=i)){e.next=10;break}return e.abrupt("return");case 10:return e.abrupt("return",this._mse.clearBuffer(0,i).then((function(){return a.flv.emit(EVENT$1.REMOVE_BUFFER,{removeEnd:i})})));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_emitMetaParsedEvent",value:function(e,t){e.exist()&&this.flv.emit(EVENT$1.METADATA_PARSED,{type:"video",track:e,meta:{codec:e.codec,timescale:e.timescale,width:e.width,height:e.height,sarRatio:e.sarRatio,baseDts:e.baseDts}}),t.exist()&&this.flv.emit(EVENT$1.METADATA_PARSED,{type:"audio",track:t,meta:{codec:t.codec,channelCount:t.channelCount,sampleRate:t.sampleRate,timescale:t.timescale,baseDts:t.baseDts}}),logger$7.debug("track parsed",e,t)}},{key:"_fireEvents",value:function(e,t,r){var n=this;logger$7.debug(e.samples,t.samples),r.flvScriptSamples.forEach((function(e){n.flv.emit(EVENT$1.FLV_SCRIPT_DATA,e),logger$7.debug("flvScriptData",e)})),e.samples.forEach((function(e){e.keyframe&&n.flv.emit(EVENT$1.KEYFRAME,{pts:e.pts})})),e.warnings.forEach((function(e){var t;switch(e.type){case WarningType$1.LARGE_AV_SHIFT:t=EVENT$1.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case WarningType$1.LARGE_VIDEO_GAP:t=EVENT$1.LARGE_VIDEO_DTS_GAP_DETECT;break;case WarningType$1.LARGE_VIDEO_GAP_BETWEEN_CHUNK:t=EVENT$1.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT}t&&n.flv.emit(EVENT$1.STREAM_EXCEPTION,_objectSpread2$5(_objectSpread2$5({},e),{},{type:t})),logger$7.warn("video exception",e)})),t.warnings.forEach((function(e){var t;switch(e.type){case WarningType$1.LARGE_AUDIO_GAP:t=EVENT$1.LARGE_AUDIO_DTS_GAP_DETECT;break;case WarningType$1.AUDIO_FILLED:t=EVENT$1.AUDIO_GAP_DETECT;break;case WarningType$1.AUDIO_DROPPED:t=EVENT$1.AUDIO_OVERLAP_DETECT}t&&n.flv.emit(EVENT$1.STREAM_EXCEPTION,_objectSpread2$5(_objectSpread2$5({},e),{},{type:t})),logger$7.warn("audio exception",e)})),r.seiSamples.forEach((function(e){n.flv.emit(EVENT$1.SEI,_objectSpread2$5(_objectSpread2$5({},e),{},{sei:{code:e.data.type,content:e.data.payload,dts:e.pts}}))}))}}]),e}();function getOption$1(e){var t=_objectSpread2$5({retryCount:3,retryDelay:1e3,loadTimeout:1e4,maxReaderInterval:5e3,preloadTime:5,isLive:!1,softDecode:!1,bufferBehind:10,maxJumpDistance:3,analyzeDuration:2e4,seamlesslyReload:!1},e);return t.isLive&&t.preloadTime&&(t.maxLatency||(t.maxLatency=2*t.preloadTime),t.targetLatency||(t.targetLatency=t.preloadTime),null==t.disconnectTime&&(t.disconnectTime=t.maxLatency)),t}function searchKeyframeIndex(e,t){var r=0,n=e.length-1,i=0,a=0,o=n;for(t<e[0]&&(r=0,a=o+1);a<=o;){if((i=a+Math.floor((o-a)/2))===n||t>=e[i]&&t<e[i+1]){r=i;break}e[i]<t?a=i+1:o=i-1}return r}var logger$6=new Logger$8("flv"),Flv=function(e){_inherits$6(c,e);var t,r,n,i,a,o,s,u=_createSuper$s(c);function c(e){var t;return _classCallCheck$6(this,c),_defineProperty$7(_assertThisInitialized$6(t=u.call(this)),"media",null),_defineProperty$7(_assertThisInitialized$6(t),"_loading",!1),_defineProperty$7(_assertThisInitialized$6(t),"_opts",null),_defineProperty$7(_assertThisInitialized$6(t),"_bufferService",null),_defineProperty$7(_assertThisInitialized$6(t),"_gapService",null),_defineProperty$7(_assertThisInitialized$6(t),"_mediaLoader",null),_defineProperty$7(_assertThisInitialized$6(t),"_maxChunkWaitTimer",null),_defineProperty$7(_assertThisInitialized$6(t),"_tickTimer",null),_defineProperty$7(_assertThisInitialized$6(t),"_tickInterval",500),_defineProperty$7(_assertThisInitialized$6(t),"_noEndOfStreamOnDone",!1),_defineProperty$7(_assertThisInitialized$6(t),"_urlSwitching",!1),_defineProperty$7(_assertThisInitialized$6(t),"_seamlessSwitching",!1),_defineProperty$7(_assertThisInitialized$6(t),"_keyframes",null),_defineProperty$7(_assertThisInitialized$6(t),"_acceptRanges",!0),_defineProperty$7(_assertThisInitialized$6(t),"_onProgress",function(){var e=_asyncToGenerator$6(_regeneratorRuntime$4().mark((function e(r,n,i){var a,o,s,u;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=i.startTime,o=i.endTime,t._loading=!n,t._bufferService){e.next=4;break}return e.abrupt("return");case 4:return clearTimeout(t._maxChunkWaitTimer),t._bandwidthService.addChunkRecord(null==r?void 0:r.byteLength,o-a),e.prev=6,e.next=9,t._bufferService.appendBuffer(r);case 9:t.isLive&&(null===(s=t._bufferService)||void 0===s||s.evictBuffer(t._opts.bufferBehind)),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(6),e.abrupt("return",t._emitError(StreamingError$1.create(e.t0)));case 15:if(t._urlSwitching&&(t._urlSwitching=!1,t.emit(EVENT$1.SWITCH_URL_SUCCESS,{url:t._opts.url})),t._seamlessSwitching&&(t._seamlessSwitching=!1,t.media.play(),t._tick()),!n||t.media.seeking){e.next=27;break}if(t.emit(EVENT$1.LOAD_COMPLETE),logger$6.debug("load done",t._noEndOfStreamOnDone),!t._noEndOfStreamOnDone){e.next=24;break}t._noEndOfStreamOnDone=!1,e.next=25;break;case 24:return e.abrupt("return",t._end());case 25:e.next=29;break;case 27:(u=t._opts.maxReaderInterval)&&(clearTimeout(t._maxChunkWaitTimer),t._maxChunkWaitTimer=setTimeout((function(){logger$6.debug("onMaxChunkWait",u),t._end()}),u));case 29:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t,r,n){return e.apply(this,arguments)}}()),_defineProperty$7(_assertThisInitialized$6(t),"_onRetryError",(function(e,r){logger$6.debug("load retry",e,r),t.emit(EVENT$1.LOAD_RETRY,{error:StreamingError$1.network(e),retryTime:r})})),_defineProperty$7(_assertThisInitialized$6(t),"_end",(function(){t._clear(),t._bufferService&&t._bufferService.endOfStream(),logger$6.debug("end stream")})),_defineProperty$7(_assertThisInitialized$6(t),"_tick",(function(){clearTimeout(t._tickTimer);var e=_assertThisInitialized$6(t).media;if(e){t._tickTimer=setTimeout(t._tick,t._tickInterval);var r=Buffer$2.end(Buffer$2.get(e));if(!(r<.1)&&e.readyState){var n=t._opts;if(isMediaPlaying(e))t._gapService&&t._gapService.do(e,n.maxJumpDistance,t.isLive,3);else{if(!e.currentTime&&t._gapService)return void t._gapService.do(e,n.maxJumpDistance,t.isLive,3);n.isLive&&r>n.disconnectTime&&t.disconnect()}}}})),_defineProperty$7(_assertThisInitialized$6(t),"_onPlay",(function(){var e,r,n=t._opts.softDecode||(null===(e=t.media)||void 0===e||null===(r=e.buffered)||void 0===r?void 0:r.length);t.isLive&&!t._loading&&n&&t.replay(void 0,!0)})),_defineProperty$7(_assertThisInitialized$6(t),"_onSeeking",_asyncToGenerator$6(_regeneratorRuntime$4().mark((function e(){var r,n,i,a,o;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isLive||!t.seekable){e.next=14;break}if(r=t._keyframes.times,n=t._keyframes.filepositions,null!=r&&r.length&&null!=n&&n.length){e.next=5;break}return e.abrupt("return");case 5:if(i=t.media.currentTime,a=searchKeyframeIndex(t._keyframes.times,i),null!=(o=n[a])){e.next=10;break}return e.abrupt("return");case 10:return e.next=12,t._mediaLoader.cancel();case 12:t._loadData(null,[o]),t._bufferService.unContiguous(r[a]);case 14:case"end":return e.stop()}}),e)})))),_defineProperty$7(_assertThisInitialized$6(t),"_onTimeupdate",(function(){if(t.media){var e=t._opts,r=t.media.currentTime;if(e.isLive&&e.maxLatency&&e.targetLatency){var n=Buffer$2.end(Buffer$2.get(t.media));n-r>=e.maxLatency&&(t.media.currentTime=n-e.targetLatency)}t._seiService.throw(r)}})),_defineProperty$7(_assertThisInitialized$6(t),"_onFlvScriptData",(function(e){var r,n,i,a,o=null===(r=e.data)||void 0===r||null===(n=r.onMetaData)||void 0===n?void 0:n.keyframes,s=null===(i=e.data)||void 0===i||null===(a=i.onMetaData)||void 0===a?void 0:a.duration;o&&(t._keyframes=o),!t._opts.isLive&&s&&t._bufferService.updateDuration(s)})),t._opts=getOption$1(e),t.media=t._opts.media||document.createElement("video"),t._opts.media=null,t._mediaLoader=new NetLoader$3(_objectSpread2$5(_objectSpread2$5({},t._opts.fetchOptions),{},{retry:t._opts.retryCount,retryDelay:t._opts.retryDelay,timeout:t._opts.loadTimeout,onRetryError:t._onRetryError,onProgress:t._onProgress,responseType:"arraybuffer"})),t._bufferService=new BufferService$1(_assertThisInitialized$6(t),t._opts.softDecode?t.media:void 0,t._opts.analyzeDuration),t._seiService=new SeiService(_assertThisInitialized$6(t)),t._bandwidthService=new BandwidthService,t._opts.softDecode||(t._gapService=new GapService),t.media.addEventListener("play",t._onPlay),t.media.addEventListener("seeking",t._onSeeking),t.media.addEventListener("timeupdate",t._onTimeupdate),t.on(EVENT$1.FLV_SCRIPT_DATA,t._onFlvScriptData),t}return _createClass$7(c,[{key:"version",get:function(){return"3.0.0-next.9-3"}},{key:"isLive",get:function(){return this._opts.isLive}},{key:"baseDts",get:function(){var e;return null===(e=this._bufferService)||void 0===e?void 0:e.baseDts}},{key:"seekable",get:function(){return!!this._keyframes&&this._acceptRanges}},{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed()}}},{key:"bufferInfo",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1;return Buffer$2.info(Buffer$2.get(this.media),null===(e=this.media)||void 0===e?void 0:e.currentTime,t)}},{key:"playbackQuality",value:function(){return getVideoPlaybackQuality(this.media)}},{key:"load",value:(s=_asyncToGenerator$6(_regeneratorRuntime$4().mark((function e(t,r){return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._bufferService){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._reset(r);case 4:this._loadData(t),clearTimeout(this._tickTimer),this._tickTimer=setTimeout(this._tick,this._tickInterval);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"replay",value:(o=_asyncToGenerator$6(_regeneratorRuntime$4().mark((function e(){var t,r,n=this,i=arguments;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:this._opts.seamlesslyReload,r=i.length>1?i[1]:void 0,this.media){e.next=4;break}return e.abrupt("return");case 4:if(!t){e.next=11;break}return this._noEndOfStreamOnDone=!0,e.next=8,this._clear();case 8:setTimeout((function(){n._loadData(n._opts.url),n._bufferService.seamlessSwitch(),n._seamlessSwitching=!0})),e.next=13;break;case 11:return e.next=13,this.load();case 13:return e.abrupt("return",this.media.play(!r));case 14:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"disconnect",value:function(){return logger$6.debug("disconnect!"),this._clear()}},{key:"switchURL",value:(a=_asyncToGenerator$6(_regeneratorRuntime$4().mark((function e(t,r){var n=this;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._bufferService){e.next=2;break}return e.abrupt("return");case 2:if(r&&this._opts.isLive){e.next=7;break}return e.next=5,this.load(t);case 5:return this._urlSwitching=!0,e.abrupt("return",this.media.play(!0));case 7:return this._noEndOfStreamOnDone=!0,e.next=10,this._clear();case 10:setTimeout((function(){n._loadData(t),n._bufferService.seamlessSwitch(),n._urlSwitching=!0,n._seamlessSwitching=!0}));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"destroy",value:(i=_asyncToGenerator$6(_regeneratorRuntime$4().mark((function e(){return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.media){e.next=2;break}return e.abrupt("return");case 2:return this.removeAllListeners(),this._seiService.reset(),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),e.next=9,Promise.all([this._clear(),this._bufferService.destroy()]);case 9:this.media=null,this._bufferService=null;case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_emitError",value:function(e){var t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];logger$6.table(e),logger$6.error(e),logger$6.error(null===(t=this.media)||void 0===t?void 0:t.error),this._urlSwitching&&(this._urlSwitching=!1,this._seamlessSwitching=!1,this.emit(EVENT$1.SWITCH_URL_FAILED,e)),this.emit(EVENT$1.ERROR,e),r&&(this._seiService.reset(),this._end())}},{key:"_reset",value:(n=_asyncToGenerator$6(_regeneratorRuntime$4().mark((function e(t){return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._seiService.reset(),this._bandwidthService.reset(),e.next=4,this._clear();case 4:return e.next=6,this._bufferService.reset(t);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_loadData",value:(r=_asyncToGenerator$6(_regeneratorRuntime$4().mark((function e(t,r){var n,i,a,o,s;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&(this._opts.url=t),t=this._opts.url){e.next=4;break}throw new Error("Source url is missing");case 4:if(this.emit(EVENT$1.LOAD_START,{url:t}),logger$6.debug("load data",t),!this._loading){e.next=9;break}return e.next=9,this._mediaLoader.cancel();case 9:return this._loading=!0,e.prev=10,e.next=13,this._mediaLoader.load({url:t,range:r});case 13:if(n=e.sent){e.next=16;break}return e.abrupt("return");case 16:i=n.response,a=n.firstByteTime,o=n.startTime,s=i.headers,this.emit(EVENT$1.TTFB,{url:t,responseUrl:i.url,elapsed:a-o}),this.emit(EVENT$1.LOAD_RESPONSE_HEADERS,{headers:s}),this._acceptRanges=!(null==s||!s.get("Accept-Ranges"))||!(null==s||!s.get("Content-Range")),e.next=26;break;case 23:return e.prev=23,e.t0=e.catch(10),e.abrupt("return",this._emitError(StreamingError$1.network(e.t0)));case 26:case"end":return e.stop()}}),e,this,[[10,23]])}))),function(e,t){return r.apply(this,arguments)})},{key:"_clear",value:(t=_asyncToGenerator$6(_regeneratorRuntime$4().mark((function e(){return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(clearTimeout(this._maxChunkWaitTimer),clearTimeout(this._tickTimer),!this._mediaLoader){e.next=5;break}return e.next=5,this._mediaLoader.cancel();case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"isSupported",value:function(){return MSE$3.isSupported()||!!WebAssembly}},{key:"enableLogger",value:function(){Logger$8.enable(),Logger$7.enable()}},{key:"disableLogger",value:function(){Logger$8.disable(),Logger$7.disable()}}]),c}(EventEmitter$1);try{localStorage.getItem("xgd")?Flv.enableLogger():Flv.disableLogger()}catch(error){}var PluginExtension$1=function(){function e(t,r){var n=this;_classCallCheck$6(this,e),_defineProperty$7(this,"_onLowDecode",(function(){var e,t,r,i,a=n._opts,o=a.media,s=a.innerDegrade,u=a.backupURL;null===(e=n._plugin)||void 0===e||null===(t=e.player)||void 0===t||t.emit("lowdecode",o.degradeInfo),null===(r=n._plugin)||void 0===r||null===(i=r.player)||void 0===i||i.emit("core_event",_objectSpread2$5(_objectSpread2$5({},o.degradeInfo),{},{eventName:EVENT$1.LOWDECODE})),1!==s&&3!==s||!u||n._degrade(u)})),_defineProperty$7(this,"_degrade",(function(e){var t=n._plugin.player,r=t.video;if("MVideo"===(null==r?void 0:r.TAG)){var i=t.video.degradeVideo;t.video=i,r.degrade(e),e&&(t.config.url=e);var a=t.root.firstChild;"MVideo"===a.TAG&&t.root.replaceChild(i,a);var o=n._plugin.constructor.pluginName.toLowerCase();t.unRegisterPlugin(o),t.once("canplay",(function(){t.play()}))}})),_defineProperty$7(this,"forceDegradeToVideo",(function(e){var t=n._opts.innerDegrade;1!==t&&3!==t||n._degrade(e)})),this._opts=t,this._plugin=r,this._init()}return _createClass$7(e,[{key:"_init",value:function(){var e=this._opts,t=e.media,r=e.preloadTime,n=e.innerDegrade,i=e.decodeMode;t&&(n&&t.setAttribute("innerdegrade",n),r&&t.setAttribute("preloadtime",r),t.setDecodeMode&&t.setDecodeMode(i),this._bindEvents())}},{key:"_bindEvents",value:function(){this._opts.media.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var e,t;null===(e=this._opts)||void 0===e||null===(t=e.media)||void 0===t||t.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),e}(),Stats$1=function(){function e(){_classCallCheck$6(this,e),_defineProperty$7(this,"encodeType",""),_defineProperty$7(this,"audioCodec",""),_defineProperty$7(this,"videoCodec",""),_defineProperty$7(this,"domain",""),_defineProperty$7(this,"fps",0),_defineProperty$7(this,"bitrate",0),_defineProperty$7(this,"width",0),_defineProperty$7(this,"height",0),_defineProperty$7(this,"samplerate",0),_defineProperty$7(this,"channelCount",0),_defineProperty$7(this,"gop",0),_defineProperty$7(this,"_bitsAccumulateSize",0),_defineProperty$7(this,"_bitsAccumulateDuration",0)}return _createClass$7(e,[{key:"getStats",value:function(){return{encodeType:this.encodeType,audioCodec:this.audioCodec,videoCodec:this.videoCodec,domain:this.domain,fps:this.fps,bitrate:this.bitrate,width:this.width,height:this.height,samplerate:this.samplerate,channelCount:this.channelCount,gop:this.gop}}},{key:"setEncodeType",value:function(e){this.encodeType=e}},{key:"setVideoMeta",value:function(e){this.width=e.width,this.height=e.height,this.videoCodec=e.codec,this.encodeType=e.codecType,e.fpsNum&&e.fpsDen&&(this.fps=e.fpsNum/e.fpsDen)}},{key:"setAudioMeta",value:function(e){this.audioCodec=e.codec,this.samplerate=e.sampleRate,this.channelCount=e.channelCount}},{key:"setDomain",value:function(e){this.domain=e.split("/").slice(2,3)[0]}},{key:"updateBitrate",value:function(e){var t=this;if(!this.fps||this.fps>=100){var r=e[0];null!=r&&r.duration&&(this.fps=Math.round(1e3/r.duration))}e.forEach((function(e){1===e.gopId&&t.gop++,t._bitsAccumulateDuration+=e.duration,t._bitsAccumulateSize+=e.units.reduce((function(e,t){return e+t.length}),0),t._bitsAccumulateDuration>=1e3&&(t.bitrate=8*t._bitsAccumulateSize,t._bitsAccumulateDuration=0,t._bitsAccumulateSize=0)}))}}]),e}(),MediaStats$1=function(){function e(t){_classCallCheck$6(this,e),_defineProperty$7(this,"_plugin",void 0),_defineProperty$7(this,"_samples",[]),_defineProperty$7(this,"_bitrateCalcDuration",0),_defineProperty$7(this,"_stats",new Stats$1),this._plugin=t,this._bindEvents()}return _createClass$7(e,[{key:"getStats",value:function(){var e,t,r,n,i,a,o=(null===(e=this._plugin.player)||void 0===e?void 0:e.video)||{},s=o.currentTime,u=void 0===s?0:s,c=o.decodeFps,l=void 0===c?0:c;return _objectSpread2$5(_objectSpread2$5({},this._stats.getStats()),{},{downloadSpeed:null===(t=this._plugin.core)||void 0===t||null===(r=t.speedInfo)||void 0===r?void 0:r.call(t).speed,avgSpeed:null===(n=this._plugin.core)||void 0===n||null===(i=n.speedInfo)||void 0===i?void 0:i.call(n).avgSpeed,currentTime:u,bufferEnd:(null===(a=this._plugin.player)||void 0===a?void 0:a.getBufferedRange()[1])-u,decodeFps:l})}},{key:"_bindEvents",value:function(){var e,t=this;this._onceLoadStart(),null===(e=this._plugin.player)||void 0===e||e.on("core_event",(function(e){e.eventName===EVENT$1.METADATA_PARSED&&("video"===e.type?t._stats.setVideoMeta(e.track):t._stats.setAudioMeta(e.track)),e.eventName===EVENT$1.TTFB&&t._stats.setDomain(e.responseUrl)}))}},{key:"_onceLoadStart",value:function(){var e,t=this;null===(e=this._plugin.player)||void 0===e||e.on("core_event",(function e(r){r.eventName===EVENT$1.LOAD_START&&(t._plugin.player.off("core_event",e),t._plugin.core.on(InnerEvent.DEMUXED_TRACK,(function(e){return t._stats.updateBitrate(e.samples)})))}))}}]),e}(),FlvPlugin=function(e){_inherits$6(r,e);var t=_createSuper$s(r);function r(){var e;_classCallCheck$6(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$7(_assertThisInitialized$6(e=t.call.apply(t,[this].concat(i))),"flv",null),_defineProperty$7(_assertThisInitialized$6(e),"pluginExtension",null),_defineProperty$7(_assertThisInitialized$6(e),"_stats",new MediaStats$1(_assertThisInitialized$6(e))),_defineProperty$7(_assertThisInitialized$6(e),"getStats",(function(){return e._stats.getStats()})),_defineProperty$7(_assertThisInitialized$6(e),"destroy",(function(){var t;e.flv&&(e.flv.destroy(),e.flv=null),null===(t=e.pluginExtension)||void 0===t||t.destroy(),e.pluginExtension=null})),_defineProperty$7(_assertThisInitialized$6(e),"_onSwitchURL",(function(t,r){e.flv&&(e.player.config.url=t,e.flv.switchURL(t,r))})),_defineProperty$7(_assertThisInitialized$6(e),"_onDefinitionChange",(function(t){var r=t.to;e.flv&&e.flv.switchURL(r)})),e}return _createClass$7(r,[{key:"core",get:function(){return this.flv}},{key:"version",get:function(){var e;return null===(e=this.flv)||void 0===e?void 0:e.version}},{key:"softDecode",get:function(){var e,t,r=null===(e=this.player)||void 0===e||null===(t=e.config)||void 0===t?void 0:t.mediaType;return!!r&&"video"!==r}},{key:"beforePlayerInit",value:function(){var e=this,t=this.player.config;this.flv&&this.flv.destroy(),this.player.switchURL=this._onSwitchURL;var r,n=t.flv||{};(null==n.disconnectTime&&(n.disconnectTime=0),this.flv=new Flv(_objectSpread2$5({softDecode:this.softDecode,isLive:t.isLive,media:this.player.video},n)),this.softDecode||BasePlugin.defineGetterOrSetter(this.player,{url:{get:function(){var t,r;return null===(t=e.flv)||void 0===t||null===(r=t.media)||void 0===r?void 0:r.src},configurable:!0}}),this.softDecode&&(this.pluginExtension=new PluginExtension$1(_objectSpread2$5({media:this.player.video},t.flv),this),this.player.forceDegradeToVideo=function(){for(var t,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return null===(t=e.pluginExtension)||void 0===t?void 0:t.forceDegradeToVideo.apply(t,n)}),t.isLive)&&(null===(r=this.player)||void 0===r||r.useHooks("replay",(function(){var t;return null===(t=e.flv)||void 0===t?void 0:t.replay()})));this.on(URL_CHANGE,this._onSwitchURL),this.on(DESTROY,this.destroy),this._transError(),this._transCoreEvent(EVENT$1.TTFB),this._transCoreEvent(EVENT$1.LOAD_START),this._transCoreEvent(EVENT$1.LOAD_RESPONSE_HEADERS),this._transCoreEvent(EVENT$1.LOAD_COMPLETE),this._transCoreEvent(EVENT$1.LOAD_RETRY),this._transCoreEvent(EVENT$1.SOURCEBUFFER_CREATED),this._transCoreEvent(EVENT$1.ANALYZE_DURATION_EXCEEDED),this._transCoreEvent(EVENT$1.REMOVE_BUFFER),this._transCoreEvent(EVENT$1.BUFFEREOS),this._transCoreEvent(EVENT$1.KEYFRAME),this._transCoreEvent(EVENT$1.METADATA_PARSED),this._transCoreEvent(EVENT$1.SEI),this._transCoreEvent(EVENT$1.SEI_IN_TIME),this._transCoreEvent(EVENT$1.FLV_SCRIPT_DATA),this._transCoreEvent(EVENT$1.STREAM_EXCEPTION),this._transCoreEvent(EVENT$1.SWITCH_URL_SUCCESS),this._transCoreEvent(EVENT$1.SWITCH_URL_FAILED),this.flv.load(t.url,!0)}},{key:"_transError",value:function(){var e=this;this.flv.on(EVENT$1.ERROR,(function(t){e.player&&e.player.emit(ERROR$3,new Errors$1(e.player,t))}))}},{key:"_transCoreEvent",value:function(e){var t=this;this.flv.on(e,(function(r){t.player&&t.player.emit("core_event",_objectSpread2$5(_objectSpread2$5({},r),{},{eventName:e}))}))}}],[{key:"pluginName",get:function(){return"flv"}},{key:"isSupported",value:function(e){return Flv.isSupported(e)}}]),r}(BasePlugin);function ownKeys$f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$3(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$f(Object(r),!0).forEach((function(t){_defineProperty$4(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _regeneratorRuntime$2(){_regeneratorRuntime$2=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(C){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i,a,o,s,u=t&&t.prototype instanceof d?t:d,h=Object.create(u.prototype),f=new S(n||[]);return h._invoke=(i=e,a=r,o=f,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return{value:void 0,done:!0}}for(o.method=e,o.arg=t;;){var r=o.delegate;if(r){var n=b(r,o);if(n){if(n===l)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===s)throw s="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s="executing";var u=c(i,a,o);if("normal"===u.type){if(s=o.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:o.done}}"throw"===u.type&&(s="completed",o.method="throw",o.arg=u.arg)}}),h}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(C){return{type:"throw",arg:C}}}e.wrap=u;var l={};function d(){}function h(){}function f(){}var p={};s(p,i,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(T([])));y&&y!==t&&r.call(y,i)&&(p=y);var m=f.prototype=d.prototype=Object.create(p);function v(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function n(i,a,o,s){var u=c(e[i],e,a);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==_typeof$7(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(d).then((function(e){l.value=e,o(l)}),(function(e){return n("throw",e,o,s)}))}s(u.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function b(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function T(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:w}}function w(){return{value:void 0,done:!0}}return h.prototype=f,s(m,"constructor",f),s(f,"constructor",h),h.displayName=s(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},v(_.prototype),s(_.prototype,a,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new _(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},v(m),s(m,o,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=T,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;E(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function asyncGeneratorStep$4(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(error){return void r(error)}s.done?t(u):Promise.resolve(u).then(n,i)}function _asyncToGenerator$4(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$4(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$4(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck$3(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$4(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$4(e,t,r){return t&&_defineProperties$4(e.prototype,t),r&&_defineProperties$4(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$4(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$3(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$3(e,t)}function _getPrototypeOf$3(e){return(_getPrototypeOf$3=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$3(e,t){return(_setPrototypeOf$3=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$q(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _assertThisInitialized$3(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$3(e,t){if(t&&("object"===_typeof$7(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$3(e)}function _createSuper$p(e){var t=_isNativeReflectConstruct$q();return function(){var r,n=_getPrototypeOf$3(e);if(t){var i=_getPrototypeOf$3(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$3(this,r)}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray$4(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray$4(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray$4(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(u){s=!0,i=u}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}function _unsupportedIterableToArray$4(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$4(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$4(e,t):void 0}}function _arrayLikeToArray$4(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}_defineProperty$7(FlvPlugin,"Flv",Flv);var TrackType$2={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},VideoCodecType$2={AVC:"avc",HEVC:"hevc"},AudioCodecType$1={AAC:"aac",G711PCMA:"g7110a",G711PCMU:"g7110m"},WarningType={LARGE_AV_SHIFT:"LARGE_AV_SHIFT",LARGE_VIDEO_GAP:"LARGE_VIDEO_GAP",LARGE_VIDEO_GAP_BETWEEN_CHUNK:"LARGE_VIDEO_GAP_BETWEEN_CHUNK",LARGE_AUDIO_GAP:"LARGE_AUDIO_GAP",AUDIO_FILLED:"AUDIO_FILLED",AUDIO_DROPPED:"AUDIO_DROPPED"},isBrowser$1="undefined"!=typeof window,ua$1=isBrowser$1&&navigator.userAgent.toLocaleLowerCase(),isSafari$1=isBrowser$1&&/^((?!chrome|android).)*safari/.test(ua$1),isFirefox$1=isBrowser$1&&ua$1.includes("firefox"),isAndroid$1=isBrowser$1&&ua$1.includes("android"),AAC$1=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"getRateIndexByRate",value:function(t){return e.FREQ.indexOf(t)}},{key:"parseADTS",value:function(t,r){for(var n=t.length,i=0;i+2<n&&(255!==t[i]||240!=(246&t[i+1]));)i++;if(!(i>=n)){var a=i,o=[],s=(60&t[i+2])>>>2,u=e.FREQ[s];if(!u)throw new Error("Invalid sampling index: ".concat(s));for(var c,l,d=1+((192&t[i+2])>>>6),h=(1&t[i+2])<<2|(192&t[i+3])>>>6,f=e._getConfig(s,h,d),p=f.config,g=f.codec,y=0,m=e.getFrameDuration(u);i+7<n;)if(255===t[i]&&240==(246&t[i+1])){if(n-i<(l=(3&t[i+3])<<11|t[i+4]<<3|(224&t[i+5])>>5))break;c=2*(1&~t[i+1]),o.push({pts:r+y*m,data:t.subarray(i+7+c,i+l)}),y++,i+=l}else i++;return{skip:a,remaining:i>=n?void 0:t.subarray(i),frames:o,samplingFrequencyIndex:s,sampleRate:u,objectType:d,channelCount:h,codec:g,config:p,originCodec:"mp4a.40.".concat(d)}}}},{key:"parseAudioSpecificConfig",value:function(t){if(t.length){var r=t[0]>>>3,n=(7&t[0])<<1|t[1]>>>7,i=(120&t[1])>>>3,a=e.FREQ[n];if(!a)throw new Error("Invalid sampling index: ".concat(n));var o=e._getConfig(n,i,r);return{samplingFrequencyIndex:n,sampleRate:a,objectType:r,channelCount:i,config:o.config,codec:o.codec,originCodec:"mp4a.40.".concat(r)}}}},{key:"getFrameDuration",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return 1024*t/e}},{key:"_getConfig",value:function(e,t,r){var n,i,a=[];return isFirefox$1?e>=6?(n=5,i=e-3):(n=2,i=e):isAndroid$1?(n=2,i=e):(n=2===r||5===r?r:5,i=e,e>=6?i=e-3:1===t&&(n=2,i=e)),a[0]=n<<3,a[0]|=(14&e)>>1,a[1]=(1&e)<<7,a[1]|=t<<3,5===n&&(a[1]|=(14&i)>>1,a[2]=(1&i)<<7,a[2]|=8,a[3]=0),{config:a,codec:"mp4a.40.".concat(n)}}},{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}]),e}();_defineProperty$5(AAC$1,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var AudioSample$1=_createClass$5((function e(t,r,n){_classCallCheck$4(this,e),_defineProperty$5(this,"duration",1024),_defineProperty$5(this,"flag",{dependsOn:2,isNonSyncSample:0}),this.originPts=this.pts=this.dts=t,this.data=r,this.size=r.byteLength,n&&(this.duration=n)}));function concatUint8Array$3(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=t.filter(Boolean);var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){n.set(e,i),i+=e.byteLength})),n}var MAX_SIZE$1=Math.pow(2,32);function readBig16$1(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<8)+(e[t+1]||0)}function readBig24$1(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<16)+(e[t+1]<<8)+(e[t+2]||0)}function readBig32$1(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<24>>>0)+(e[t+1]<<16)+(e[t+2]<<8)+(e[t+3]||0)}function readBig64$1(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return readBig32$1(e,t)*MAX_SIZE$1+readBig32$1(e,t+4)}function getAvcCodec$1(e){for(var t,r="avc1.",n=0;n<3;n++)(t=e[n].toString(16)).length<2&&(t="0".concat(t)),r+=t;return r}var Logger$6=function(){function e(t){_classCallCheck$4(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return _createClass$5(e,[{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();_defineProperty$5(Logger$6,"disabled",!0);var NALu=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"parseAnnexB",value:function(e){for(var t=e.length,r=2,n=0;null!=e[r]&&1!==e[r];)r++;if((n=++r+2)>=t)return[];for(var i=[];n<t;)switch(e[n]){case 0:if(0!==e[n-1]){n+=2;break}if(0!==e[n-2]){n++;break}r!==n-2&&i.push(e.subarray(r,n-2));do{n++}while(1!==e[n]&&n<t);n=(r=n+1)+2;break;case 1:if(0!==e[n-1]||0!==e[n-2]){n+=3;break}r!==n-2&&i.push(e.subarray(r,n-2)),n=(r=n+1)+2;break;default:n+=3}return r<t&&i.push(e.subarray(r)),i}},{key:"parseAvcC",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(!(e.length<4)){for(var r,n=e.length,i=[],a=0;a+t<n;)if(r=readBig32$1(e,a),3===t&&(r>>>=8),a+=t,r){if(a+r>n)break;i.push(e.subarray(a,a+r)),a+=r}return i}}},{key:"parseSEI",value:function(e){for(var t=e.length,r=1,n=0,i=0,a="";255===e[r];)n+=255,r++;for(n+=e[r++];255===e[r];)i+=255,r++;if(i+=e[r++],5===n&&t>r+16)for(var o=0;o<16;o++)a+=e[r].toString(16),r++;return{payload:e.subarray(r),type:n,size:i,uuid:a}}},{key:"removeEPB",value:function(e){for(var t=e.byteLength,r=[],n=1;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(!r.length)return e;var i=t-r.length,a=new Uint8Array(i),o=0;for(n=0;n<i;o++,n++)o===r[0]&&(o++,r.shift()),a[n]=e[o];return a}}]),e}(),ExpGolomb=function(){function e(t){if(_classCallCheck$4(this,e),_defineProperty$5(this,"_bytesAvailable",void 0),_defineProperty$5(this,"_bitsAvailable",0),_defineProperty$5(this,"_word",0),!t)throw new Error("ExpGolomb data params is required");this._data=t,this._bytesAvailable=t.byteLength,this._bytesAvailable&&this._loadWord()}return _createClass$5(e,[{key:"_loadWord",value:function(){var e=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(0===t)throw new Error("No bytes available");var r=new Uint8Array(4);r.set(this._data.subarray(e,e+t)),this._word=new DataView(r.buffer).getUint32(0),this._bitsAvailable=8*t,this._bytesAvailable-=t}},{key:"skipBits",value:function(e){if(this._bitsAvailable>e)this._word<<=e,this._bitsAvailable-=e;else{e-=this._bitsAvailable;var t=Math.floor(e/8);e-=8*t,this._bytesAvailable-=t,this._loadWord(),this._word<<=e,this._bitsAvailable-=e}}},{key:"readBits",value:function(e){if(e>32)throw new Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,e),r=this._word>>>32-t;return this._bitsAvailable-=t,this._bitsAvailable>0?this._word<<=t:this._bytesAvailable>0&&this._loadWord(),(t=e-t)>0&&this._bitsAvailable?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this._bitsAvailable;++e)if(0!=(this._word&2147483648>>>e))return this._word<<=e,this._bitsAvailable-=e,e;return this._loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(e){for(var t=8,r=8,n=0;n<e;n++)0!==r&&(r=(t+this.readEG()+256)%256),t=0===r?t:r}}]),e}(),HEVC=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(t.length<23)){r=r||{};for(var n,i,a,o,s,u=1+(3&t[21]),c=[],l=[],d=[],h=23,f=t[22],p=0;p<f;p++){a=63&t[h],o=t[h+1]<<8|t[h+2],h+=3;for(var g=0;g<o;g++)if(s=t[h]<<8|t[h+1],h+=2,s){switch(a){case 32:var y=t.subarray(h,h+s);n||(n=e.parseVPS(NALu.removeEPB(y),r)),d.push(y);break;case 33:var m=t.subarray(h,h+s);i||(i=e.parseSPS(NALu.removeEPB(m),r)),c.push(m);break;case 34:l.push(t.subarray(h,h+s))}h+=s}}return{hvcC:r,sps:i,spsArr:c,ppsArr:l,vpsArr:d,nalUnitSize:u}}}},{key:"parseVPS",value:function(t,r){r=r||{};var n=new ExpGolomb(t);n.readUByte(),n.readUByte(),n.readBits(12);var i=n.readBits(3);return r.numTemporalLayers=Math.max(r.numTemporalLayers||0,i+1),n.readBits(17),e._parseProfileTierLevel(n,i,r),r}},{key:"parseSPS",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r=r||{};var n=new ExpGolomb(t);n.readUByte(),n.readUByte(),n.readBits(4);var i=n.readBits(3);r.numTemporalLayers=Math.max(i+1,r.numTemporalLayers||0),r.temporalIdNested=n.readBits(1),e._parseProfileTierLevel(n,i,r),n.readUEG();var a=r.chromaFormatIdc=n.readUEG(),o=420;a<=3&&(o=[0,420,422,444][a]);var s=0;3===a&&(s=n.readBits(1));var u,c,l,d,h=n.readUEG(),f=n.readUEG(),p=n.readBits(1);if(1===p&&(u=n.readUEG(),c=n.readUEG(),l=n.readUEG(),d=n.readUEG()),r.bitDepthLumaMinus8=n.readUEG(),r.bitDepthChromaMinus8=n.readUEG(),1===p){var g=1!==a&&2!==a||0!==s?1:2,y=1===a&&0===s?2:1;h-=g*(c+u),f-=y*(d+l)}return{codec:"hev1.1.6.L93.B0",width:h,height:f,chromaFormat:o,hvcC:r}}},{key:"_parseProfileTierLevel",value:function(e,t,r){var n=r.generalTierFlag||0;r.generalProfileSpace=e.readBits(2),r.generalTierFlag=Math.max(e.readBits(1),n),r.generalProfileIdc=Math.max(e.readBits(5),r.generalProfileIdc||0),r.generalProfileCompatibilityFlags=e.readBits(32),r.generalConstraintIndicatorFlags=[e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8)];var i=e.readBits(8);n<r.generalTierFlag?r.generalLevelIdc=i:r.generalLevelIdc=Math.max(i,r.generalLevelIdc||0);for(var a=[],o=[],s=0;s<t;s++)a[s]=e.readBits(1),o[s]=e.readBits(1);t>0&&e.readBits(2*(8-t));for(var u=0;u<t;u++)0!==a[u]&&(e.readBits(2),e.readBits(1),e.readBits(5),e.readBits(16),e.readBits(16),e.readBits(4),e.readBits(16),e.readBits(16),e.readBits(12)),0!==o[u]&&e.readBits(8)}}]),e}(),AVC=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"parseAVCDecoderConfigurationRecord",value:function(t){if(!(t.length<7)){for(var r,n,i=1+(3&t[4]),a=[],o=[],s=6,u=31&t[5],c=0;c<u;c++)if(n=t[s]<<8|t[s+1],s+=2,n){var l=t.subarray(s,s+n);s+=n,a.push(l),r||(r=e.parseSPS(NALu.removeEPB(l)))}var d,h=t[s];s++;for(var f=0;f<h;f++)d=t[s]<<8|t[s+1],s+=2,d&&(o.push(t.subarray(s,s+d)),s+=d);return{sps:r,spsArr:a,ppsArr:o,nalUnitSize:i}}}},{key:"parseSPS",value:function(e){var t=new ExpGolomb(e);t.readUByte();var r=t.readUByte(),n=t.readUByte(),i=t.readUByte();t.skipUEG();var a=420;if(100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r){var o=t.readUEG();if(o<=3&&(a=[0,420,422,444][o]),3===o&&t.skipBits(1),t.skipUEG(),t.skipUEG(),t.skipBits(1),t.readBool())for(var s=3!==o?8:12,u=0;u<s;u++)t.readBool()&&(u<6?t.skipScalingList(16):t.skipScalingList(64))}t.skipUEG();var c=t.readUEG();if(0===c)t.readUEG();else if(1===c){t.skipBits(1),t.skipUEG(),t.skipUEG();for(var l=t.readUEG(),d=0;d<l;d++)t.skipUEG()}t.skipUEG(),t.skipBits(1);var h=t.readUEG(),f=t.readUEG(),p=t.readBits(1);0===p&&t.skipBits(1),t.skipBits(1);var g,y,m,v,_,b=0,A=0,E=0,S=0;if(t.readBool()&&(b=t.readUEG(),A=t.readUEG(),E=t.readUEG(),S=t.readUEG()),t.readBool()){if(t.readBool())switch(t.readUByte()){case 1:g=[1,1];break;case 2:g=[12,11];break;case 3:g=[10,11];break;case 4:g=[16,11];break;case 5:g=[40,33];break;case 6:g=[24,11];break;case 7:g=[20,11];break;case 8:g=[32,11];break;case 9:g=[80,33];break;case 10:g=[18,11];break;case 11:g=[15,11];break;case 12:g=[64,33];break;case 13:g=[160,99];break;case 14:g=[4,3];break;case 15:g=[3,2];break;case 16:g=[2,1];break;case 255:g=[t.readUByte()<<8|t.readUByte(),t.readUByte()<<8|t.readUByte()]}if(t.readBool()&&t.readBool(),t.readBool()&&(t.readBits(4),t.readBool()&&t.readBits(24)),t.readBool()&&(t.readUEG(),t.readUEG()),t.readBool()){var T=t.readBits(32),w=t.readBits(32);y=t.readBool(),_=(m=w)/(v=2*T)}}return{codec:getAvcCodec$1(e.subarray(1,4)),profileIdc:r,profileCompatibility:n,levelIdc:i,chromaFormat:a,width:Math.ceil(16*(h+1)-2*(b+A)),height:(2-p)*(f+1)*16-(p?2:4)*(E+S),sarRatio:g,fpsNum:m,fpsDen:v,fps:_,fixedFrame:y}}}]),e}(),VideoSample$1=function(){function e(t,r,n){_classCallCheck$4(this,e),_defineProperty$5(this,"flag",{}),_defineProperty$5(this,"keyframe",!1),_defineProperty$5(this,"gopId",0),_defineProperty$5(this,"duration",0),_defineProperty$5(this,"size",0),_defineProperty$5(this,"units",[]),_defineProperty$5(this,"chromaFormat",420),this.originPts=this.pts=t,this.originDts=this.dts=r,n&&(this.units=n)}return _createClass$5(e,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),e}();function _createSuper$o(e){var t=_isNativeReflectConstruct$p();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$p(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Sample=_createClass$5((function e(t,r){_classCallCheck$4(this,e),_defineProperty$5(this,"time",0),this.data=t,this.originPts=this.pts=r})),SeiSample=function(e){_inherits$4(r,e);var t=_createSuper$o(r);function r(){return _classCallCheck$4(this,r),t.apply(this,arguments)}return _createClass$5(r)}(Sample),MetadataTrack$1=function(){function e(){_classCallCheck$4(this,e),_defineProperty$5(this,"id",3),_defineProperty$5(this,"type",TrackType$2.METADATA),_defineProperty$5(this,"timescale",0),_defineProperty$5(this,"flvScriptSamples",[]),_defineProperty$5(this,"seiSamples",[])}return _createClass$5(e,[{key:"exist",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length||!this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length)}}]),e}(),VideoTrack$1=function(){function e(){_classCallCheck$4(this,e),_defineProperty$5(this,"id",1),_defineProperty$5(this,"type",TrackType$2.VIDEO),_defineProperty$5(this,"codecType",VideoCodecType$2.AVC),_defineProperty$5(this,"pid",-1),_defineProperty$5(this,"hvcC",void 0),_defineProperty$5(this,"codec",""),_defineProperty$5(this,"timescale",0),_defineProperty$5(this,"formatTimescale",0),_defineProperty$5(this,"sequenceNumber",0),_defineProperty$5(this,"baseMediaDecodeTime",0),_defineProperty$5(this,"baseDts",0),_defineProperty$5(this,"duration",0),_defineProperty$5(this,"warnings",[]),_defineProperty$5(this,"samples",[]),_defineProperty$5(this,"pps",[]),_defineProperty$5(this,"sps",[]),_defineProperty$5(this,"vps",[]),_defineProperty$5(this,"fpsNum",0),_defineProperty$5(this,"fpsDen",0),_defineProperty$5(this,"sarRatio",[]),_defineProperty$5(this,"width",0),_defineProperty$5(this,"height",0),_defineProperty$5(this,"nalUnitSize",4),_defineProperty$5(this,"present",!1),_defineProperty$5(this,"ext",void 0)}return _createClass$5(e,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"exist",value:function(){return!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}}]),e}(),AudioTrack$1=function(){function e(){_classCallCheck$4(this,e),_defineProperty$5(this,"id",2),_defineProperty$5(this,"type",TrackType$2.AUDIO),_defineProperty$5(this,"codecType",AudioCodecType$1.AAC),_defineProperty$5(this,"pid",-1),_defineProperty$5(this,"codec",""),_defineProperty$5(this,"sequenceNumber",0),_defineProperty$5(this,"sampleDuration",0),_defineProperty$5(this,"timescale",0),_defineProperty$5(this,"formatTimescale",0),_defineProperty$5(this,"baseMediaDecodeTime",0),_defineProperty$5(this,"duration",0),_defineProperty$5(this,"warnings",[]),_defineProperty$5(this,"samples",[]),_defineProperty$5(this,"baseDts",0),_defineProperty$5(this,"sampleSize",16),_defineProperty$5(this,"sampleRate",0),_defineProperty$5(this,"channelCount",0),_defineProperty$5(this,"objectType",0),_defineProperty$5(this,"sampleRateIndex",0),_defineProperty$5(this,"config",[]),_defineProperty$5(this,"present",!1),_defineProperty$5(this,"ext",void 0)}return _createClass$5(e,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec&&this.codecType===AudioCodecType$1.AAC)}},{key:"hasSample",value:function(){return!!this.samples.length}}]),e}(),LARGE_AV_FIRST_FRAME_GAP=45e3,AUDIO_GAP_OVERLAP_THRESHOLD_COUNT=3,MAX_SILENT_FRAME_DURATION=9e4,AUDIO_EXCETION_LOG_EMIT_DURATION=45e4,MAX_VIDEO_FRAME_DURATION=9e4,MAX_DTS_DELTA_WITH_NEXT_CHUNK=45e3,TsFixer=function(){function e(t,r,n){_classCallCheck$4(this,e),this.videoTrack=t,this.audioTrack=r,this.metadataTrack=n,this._baseDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=!1,this._videoTimestampBreak=!1,this._lastAudioExceptionGapDot=0,this._lastAudioExceptionOverlapDot=0,this._lastAudioExceptionLargeGapDot=0}return _createClass$5(e,[{key:"fix",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t=Math.round(9e4*t);var i=this.videoTrack,a=this.audioTrack,o=i.samples,s=a.samples;if(o.length||s.length){var u=o[0],c=s[0],l=0;if(o.length&&s.length&&(l=u.dts-c.pts),this._baseDtsInited||this._calculateBaseDts(this.audioTrack,this.videoTrack),r&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=t),!n){this._videoNextDts=l>0?t+l:t,this._audioNextPts=l>0?t:t-l;var d=u?u.dts-this._baseDts-this._videoNextDts:0,h=c?c.pts-this._baseDts-this._audioNextPts:0;Math.abs(d||h)>MAX_VIDEO_FRAME_DURATION&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=t)}if(this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(a),this._fixVideo(i),this.metadataTrack.exist()){var f=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach((function(t){t.pts=t.originPts-e._baseDts,t.time=Math.max(0,t.pts)/f}))}i.samples.length&&(i.baseMediaDecodeTime=i.samples[0].dts),a.samples.length&&(a.baseMediaDecodeTime=a.samples[0].pts*a.timescale/9e4)}}},{key:"_fixVideo",value:function(e){var t=this,r=e.samples;if(r.length){if(r.forEach((function(e){e.dts-=t._baseDts,e.pts-=t._baseDts})),void 0===this._videoNextDts){var n=r[0];this._videoNextDts=n.dts}var i,a,o=r.length,s=0,u=r[0],c=r[1],l=this._videoNextDts-u.dts;if(Math.abs(l)>MAX_DTS_DELTA_WITH_NEXT_CHUNK)u.dts+=l,u.pts+=l,this._videoNextDts-=l,e.warnings.push({type:WarningType.LARGE_VIDEO_GAP_BETWEEN_CHUNK,nextDts:this._videoNextDts,firstSampleDts:u.dts,nextSampleDts:null===(i=r[1])||void 0===i?void 0:i.dts,sampleDuration:l}),c&&Math.abs(c.dts-u.dts)>MAX_VIDEO_FRAME_DURATION&&(this._videoTimestampBreak=!0,r.forEach((function(e,t){0!==t&&(e.dts+=l,e.pts+=l)})));if(e.fpsNum&&e.fpsDen)a=e.timescale*(e.fpsDen/e.fpsNum);else{var d=e.samples[0],h=e.samples[o-1];a=1===o?9e3:Math.floor((h.dts-d.dts)/(o-1))}for(var f=0;f<o;f++){var p=r[f].dts,g=r[f+1];if((s=f<o-1?g.dts-p:r[f-1]?p-r[f-1].dts:a)>MAX_VIDEO_FRAME_DURATION||s<0){this._videoTimestampBreak=!0,s=this._audioTimestampBreak?a:s;var y=this._audioNextPts||0;g&&g.dts>y&&(s=a),e.warnings.push({type:WarningType.LARGE_VIDEO_GAP,time:p/e.timescale,dts:p,originDts:r[f].originDts,nextDts:this._videoNextDts,sampleDuration:s,refSampleDuration:a})}r[f].duration=s,this._videoNextDts+=s}}}},{key:"_fixAudio",value:function(e){var t=this,r=e.samples;r.length&&(r.forEach((function(e){e.pts-=t._baseDts,e.dts=e.pts})),this._doFixAudioInternal(e,r,9e4))}},{key:"_calculateBaseDts",value:function(e,t){var r=e.samples,n=t.samples;if(!r.length&&!n.length)return!1;var i=1/0,a=1/0;r.length&&(e.baseDts=i=r[0].pts),n.length&&(t.baseDts=a=n[0].dts),this._baseDts=Math.min(i,a);var o=a-i;return Number.isFinite(o)&&Math.abs(o)>LARGE_AV_FIRST_FRAME_GAP&&t.warnings.push({type:WarningType.LARGE_AV_SHIFT,videoBaseDts:a,audioBasePts:i,baseDts:this._baseDts,delta:o}),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){if(this._baseDtsInited&&this._videoTimestampBreak&&this._audioTimestampBreak){if(!this._calculateBaseDts(this.audioTrack,this.videoTrack))return;this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts),this._audioLastSample=null,this._videoLastSample=null,this._videoTimestampBreak=!1,this._audioTimestampBreak=!1}}},{key:"_doFixAudioInternal",value:function(e,t,r){e.sampleDuration||(e.sampleDuration=AAC$1.getFrameDuration(e.timescale,r));var n=e.sampleDuration;if(void 0===this._audioNextPts){var i=t[0];this._audioNextPts=i.pts}for(var a=0;a<t.length;a++){var o=this._audioNextPts,s=t[a],u=s.pts-o;if(!this._audioTimestampBreak&&u>=AUDIO_GAP_OVERLAP_THRESHOLD_COUNT*n&&u<=MAX_SILENT_FRAME_DURATION&&!isSafari$1){var c=AAC$1.getSilentFrame(e.codec,e.channelCount)||t[0].data.subarray(),l=Math.floor(u/n);Math.abs(s.pts-this._lastAudioExceptionGapDot)>AUDIO_EXCETION_LOG_EMIT_DURATION&&(this._lastAudioExceptionGapDot=s.pts),e.warnings.push({type:WarningType.AUDIO_FILLED,pts:s.pts,originPts:s.originPts,count:l,nextPts:o,refSampleDuration:n});for(var d=0;d<l;d++){var h=new AudioSample$1(Math.floor(o),c);h.originPts=Math.floor(this._baseDts+o),t.splice(a,0,h),this._audioNextPts+=n,a++}a--}else u<=-AUDIO_GAP_OVERLAP_THRESHOLD_COUNT*n&&u>=-1*MAX_SILENT_FRAME_DURATION?(Math.abs(s.pts-this._lastAudioExceptionOverlapDot)>AUDIO_EXCETION_LOG_EMIT_DURATION&&(this._lastAudioExceptionOverlapDot=s.pts,e.warnings.push({type:WarningType.AUDIO_DROPPED,pts:s.pts,originPts:s.originPts,nextPts:o,refSampleDuration:n})),t.splice(a,1),a--):(Math.abs(u)>=MAX_SILENT_FRAME_DURATION&&(this._audioTimestampBreak=!0,Math.abs(s.pts-this._lastAudioExceptionLargeGapDot)>AUDIO_EXCETION_LOG_EMIT_DURATION&&(this._lastAudioExceptionLargeGapDot=s.pts,e.warnings.push({type:WarningType.LARGE_AUDIO_GAP,time:s.pts/1e3,pts:s.pts,originPts:s.originPts,nextPts:o,sampleDuration:u,refSampleDuration:n}))),s.dts=s.pts=o,this._audioNextPts+=n)}}}]),e}(),logger$5=new Logger$6("TsDemuxer"),TsDemuxer=function(){function e(t,r,n){_classCallCheck$4(this,e),_defineProperty$5(this,"_pmtId",-1),_defineProperty$5(this,"_remainingPacketData",null),_defineProperty$5(this,"_videoPesData",[]),_defineProperty$5(this,"_audioPesData",[]),_defineProperty$5(this,"_gopId",0),this.videoTrack=t||new VideoTrack$1,this.audioTrack=r||new AudioTrack$1,this.metadataTrack=n||new MetadataTrack$1,this._fixer=new TsFixer(this.videoTrack,this.audioTrack,this.metadataTrack)}return _createClass$5(e,[{key:"demux",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.audioTrack,i=this.videoTrack,a=this.metadataTrack;t&&(this._pmtId=-1,i.reset(),n.reset(),a.reset()),!r||t?(this._remainingPacketData=null,this._videoPesData=[],this._audioPesData=[]):(i.samples=[],n.samples=[],a.seiSamples=[],i.warnings=[],n.warnings=[],this._remainingPacketData&&(e=concatUint8Array$3(this._remainingPacketData,e),this._remainingPacketData=null));var o=e.length,s=o%188;s&&(this._remainingPacketData=e.subarray(o-s),o-=s);for(var u=i.pid,c=n.pid,l=0;l<o;l+=188){if(71!==e[l])throw new Error("TS packet did not start with 0x47");var d=!!(64&e[l+1]),h=((31&e[l+1])<<8)+e[l+2],f=(48&e[l+3])>>4,p=void 0;if(f>1){if((p=l+5+e[l+4])===l+188)continue}else p=l+4;switch(h){case 0:d&&(p+=e[p]+1),this._pmtId=(31&e[p+10])<<8|e[p+11];break;case this._pmtId:d&&(p+=e[p]+1);var g=p+3+((15&e[p+1])<<8|e[p+2])-4,y=(15&e[p+10])<<8|e[p+11];for(p+=12+y;p<g;){var m=(31&e[p+1])<<8|e[p+2];switch(e[p]){case 15:n.pid=c=m;break;case 27:if(-1!==u)break;i.codecType=VideoCodecType$2.AVC,i.pid=u=m;break;case 36:if(-1!==u)break;i.codecType=VideoCodecType$2.HEVC,i.pid=u=m;break;default:logger$5.warn("Unsupported stream. type: ".concat(e[p],", pid: ").concat(m))}p+=5+((15&e[p+3])<<8|e[p+4])}break;case u:d&&this._videoPesData.length&&this._parseVideoData(),this._videoPesData.push(e.subarray(p,l+188));break;case c:d&&this._audioPesData.length&&this._parseAudioData(),this._audioPesData.push(e.subarray(p,l+188));break;case 17:case 8191:break;default:logger$5.warn("Unknown pid: ".concat(h))}}return this._parseVideoData(),this._parseAudioData(),n.formatTimescale=i.formatTimescale=i.timescale=a.timescale=9e4,n.timescale=n.sampleRate||0,{videoTrack:i,audioTrack:n,metadataTrack:a}}},{key:"fix",value:function(e,t,r){return this._fixer.fix(e,t,r),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(e,t,r,n){return this.demux(e,t,r),this.fix(n,t,r)}},{key:"_parseVideoData",value:function(){if(this._videoPesData.length){var t=e._parsePES(concatUint8Array$3.apply(void 0,_toConsumableArray$1(this._videoPesData)));if(t){var r=NALu.parseAnnexB(t.data);r?this._createVideoSample(r,t.pts,t.dts):logger$5.warn("Cannot parse avc units",t),this._videoPesData=[]}else logger$5.warn("Cannot parse video pes",this._videoPesData)}}},{key:"_createVideoSample",value:function(e,t,r){var n=this;if(e.length){var i=this.videoTrack,a=i.codecType===VideoCodecType$2.HEVC,o=new VideoSample$1(t,r);e.forEach((function(e){var s=a?e[0]>>>1&63:31&e[0];switch(s){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!a&&5!==s||a&&5===s)break;o.setToKeyframe(),n._gopId++;break;case 6:case 39:case 40:if(!a&&6!==s||a&&6===s)break;return void n.metadataTrack.seiSamples.push(new SeiSample(NALu.parseSEI(NALu.removeEPB(e)),t));case 32:if(!a)break;if(!i.vps.length){var u=HEVC.parseVPS(NALu.removeEPB(e),i.hvcC);i.hvcC=i.hvcC||u,i.vps=[e]}break;case 7:case 33:if(!a&&7!==s||a&&7===s)break;if(!i.sps.length){var c=NALu.removeEPB(e),l=a?HEVC.parseSPS(c,i.hvcC):AVC.parseSPS(c);i.sps=[e],i.hvcC=i.hvcC||l.hvcC,i.codec=l.codec,i.width=l.width,i.height=l.height,i.sarRatio=l.sarRatio,i.fpsNum=l.fpsNum,i.fpsDen=l.fpsDen}break;case 8:case 34:if(!a&&8!==s||a&&8===s)break;i.pps.length||(i.pps=[e]);break;case 9:case 35:if(!a&&9!==s||a&&9===s)break;o.gopId=n._gopId,o.units.length&&(n._pushVideoSample(i,o),o=n.prevAvcSample=new VideoSample$1(t,r))}o.units.push(e)})),o.gopId=this._gopId,this._pushVideoSample(i,o)}}},{key:"_pushVideoSample",value:function(e,t){if(t.units.length){if(null==t.pts){logger$5.warn("Video sample no pts",t);var r=e.samples[e.samples.length-1];r?(t.pts=r.pts,t.dts=r.dts):logger$5.warn("Drop video sample",t)}null!=t.pts&&e.samples.push(t)}}},{key:"_parseAudioData",value:function(){if(this._audioPesData.length){var t=e._parsePES(concatUint8Array$3.apply(void 0,_toConsumableArray$1(this._audioPesData)));t?(this._parseAacData(t),this._audioPesData=[]):logger$5.warn("Cannot parse audio pes",this._audioPesData)}}},{key:"_parseAacData",value:function(e){var t=this.audioTrack,r=e.pts;if(null==r){if(logger$5.warn("AAC pes not pts",t),!t.samples.length||!t.sampleRate)return;r=t.samples[t.samples.length-1].pts+AAC$1.getFrameDuration(t.sampleRate)}var n,i=AAC$1.parseADTS(e.data,r);i?(t.codec=i.codec,t.channelCount=i.channelCount,t.sampleRate=i.sampleRate,t.objectType=i.objectType,t.sampleRateIndex=i.samplingFrequencyIndex,t.config=i.config,(n=t.samples).push.apply(n,_toConsumableArray$1(i.frames.map((function(e){return new AudioSample$1(e.pts,e.data)})))),i.skip&&logger$5.warn("Skip aac adts ".concat(i.skip," bits")),i.remaining&&logger$5.warn("Remaining aac adts ".concat(i.remaining," bits"))):logger$5.warn("Cannot parse aac adts",e)}}],[{key:"probe",value:function(e){return!!e.length&&(71===e[0]&&71===e[188]&&71===e[376])}},{key:"_parsePES",value:function(e){var t=e[8];if(!(null==t||e.length<t+9)&&1===(e[0]<<16|e[1]<<8|e[2])){var r=(e[4]<<8)+e[5];if(!(r&&r>e.length-6)){var n,i,a=e[7];return 192&a&&(n=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&a?n-(i=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)>54e5&&(n=i):i=n),{data:e.subarray(9+t),pts:n,dts:i}}}}}]),e}(),MP4Parser$1=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"findBox",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=[];if(!t)return i;for(var a=0,o="",s=0;t.length>7;){if(a=readBig32$1(t),o=String.fromCharCode.apply(null,t.subarray(4,8)),s=8,1===a?(a=readBig64$1(t,8),s+=8):a||(a=t.length),!r[0]||o===r[0]){var u=t.subarray(0,a);if(!(r.length<2))return e.findBox(u.subarray(s),r.slice(1),n+s);i.push({start:n,size:a,headerSize:s,type:o,data:u})}n+=a,t=t.subarray(a)}return i}},{key:"moov",value:function(t){return parseBox$1(t,!1,(function(t,r,n){t.mvhd=e.mvhd(e.findBox(r,["mvhd"],n)[0]),t.trak=e.findBox(r,["trak"],n).map((function(t){return e.trak(t)}))}))}},{key:"mvhd",value:function(e){return parseBox$1(e,!0,(function(e,t){var r=0;1===e.version?(e.timescale=readBig32$1(t,16),e.duration=readBig64$1(t,20),r+=28):(e.timescale=readBig32$1(t,8),e.duration=readBig32$1(t,12),r+=16),e.nextTrackId=readBig32$1(t,r+76)}))}},{key:"trak",value:function(t){return parseBox$1(t,!1,(function(t,r,n){t.tkhd=e.tkhd(e.findBox(r,["tkhd"],n)[0]),t.mdia=e.mdia(e.findBox(r,["mdia"],n)[0])}))}},{key:"tkhd",value:function(e){return parseBox$1(e,!0,(function(e,t){var r=0;1===e.version?(e.trackId=readBig32$1(t,16),e.duration=readBig64$1(t,24),r+=32):(e.trackId=readBig32$1(t,8),e.duration=readBig32$1(t,16),r+=20),e.width=readBig32$1(t,r+52),e.height=readBig32$1(t,r+56)}))}},{key:"mdia",value:function(t){return parseBox$1(t,!1,(function(t,r,n){t.mdhd=e.mdhd(e.findBox(r,["mdhd"],n)[0]),t.hdlr=e.hdlr(e.findBox(r,["hdlr"],n)[0]),t.minf=e.minf(e.findBox(r,["minf"],n)[0])}))}},{key:"mdhd",value:function(e){return parseBox$1(e,!0,(function(e,t){var r=0;1===e.version?(e.timescale=readBig32$1(t,16),e.duration=readBig64$1(t,20),r+=28):(e.timescale=readBig32$1(t,8),e.duration=readBig32$1(t,12),r+=16);var n=readBig16$1(t,r);e.language=String.fromCharCode(96+(n>>10&31),96+(n>>5&31),96+(31&n))}))}},{key:"hdlr",value:function(e){return parseBox$1(e,!0,(function(e,t){0===e.version&&(e.handlerType=String.fromCharCode.apply(null,t.subarray(4,8)))}))}},{key:"minf",value:function(t){return parseBox$1(t,!1,(function(t,r,n){t.vmhd=e.vmhd(e.findBox(r,["vmhd"],n)[0]),t.smhd=e.smhd(e.findBox(r,["smhd"],n)[0]),t.stbl=e.stbl(e.findBox(r,["stbl"],n)[0])}))}},{key:"vmhd",value:function(e){return parseBox$1(e,!0,(function(e,t){e.graphicsmode=readBig16$1(t),e.opcolor=[readBig16$1(t,2),readBig16$1(t,4),readBig16$1(t,6)]}))}},{key:"smhd",value:function(e){return parseBox$1(e,!0,(function(e,t){e.balance=readBig16$1(t)}))}},{key:"stbl",value:function(t){return parseBox$1(t,!1,(function(t,r,n){t.stsd=e.stsd(e.findBox(r,["stsd"],n)[0]),t.stts=e.stts(e.findBox(r,["stts"],n)[0]),t.ctts=e.ctts(e.findBox(r,["ctts"],n)[0]),t.stsc=e.stsc(e.findBox(r,["stsc"],n)[0]),t.stsz=e.stsz(e.findBox(r,["stsz"],n)[0]),t.stco=e.stco(e.findBox(r,["stco"],n)[0]),t.stss=e.stss(e.findBox(r,["stss"],n)[0])}))}},{key:"stsd",value:function(t){return parseBox$1(t,!0,(function(t,r,n){t.entryCount=readBig32$1(r),t.entries=e.findBox(r.subarray(4),[],n+4).map((function(t){switch(t.type){case"avc1":case"avc2":case"avc3":case"avc4":return e.avc1(t);case"hvc1":case"hev1":return e.hvc1(t);case"mp4a":return e.mp4a(t);case"alaw":case"ulaw":return e.alaw(t)}})).filter(Boolean)}))}},{key:"avc1",value:function(t){return parseBox$1(t,!1,(function(t,r,n){var i=parseVisualSampleEntry$1(t,r),a=r.subarray(i);n+=i,t.avcC=e.avcC(e.findBox(a,["avcC"],n)[0]),t.pasp=e.pasp(e.findBox(a,["pasp"],n)[0])}))}},{key:"avcC",value:function(e){return parseBox$1(e,!1,(function(e,t){e.configurationVersion=t[0],e.AVCProfileIndication=t[1],e.profileCompatibility=t[2],e.AVCLevelIndication=t[3],e.codec=getAvcCodec$1([t[1],t[2],t[3]]),e.lengthSizeMinusOne=3&t[4],e.spsLength=31&t[5],e.sps=[];for(var r=6,n=0;n<e.spsLength;n++){var i=readBig16$1(t,r);r+=2,e.sps.push(t.subarray(r,r+i)),r+=i}e.ppsLength=t[r],r+=1,e.pps=[];for(var a=0;a<e.ppsLength;a++){var o=readBig16$1(t,r);r+=2,e.pps.push(t.subarray(r,r+=o)),r+=o}}))}},{key:"hvc1",value:function(t){return parseBox$1(t,!1,(function(t,r,n){var i=parseVisualSampleEntry$1(t,r),a=r.subarray(i);n+=i,t.hvcC=e.hvcC(e.findBox(a,["hvcC"],n)[0]),t.pasp=e.pasp(e.findBox(a,["pasp"],n)[0])}))}},{key:"hvcC",value:function(e){return parseBox$1(e,!1,(function(t,r){t.data=e.data,t.codec="hev1.1.6.L93.B0",t.configurationVersion=r[0];var n=r[1];t.generalProfileSpace=n>>6,t.generalTierFlag=(32&n)>>5,t.generalProfileIdc=31&n,t.generalProfileCompatibility=readBig32$1(r,2),t.generalConstraintIndicatorFlags=r.subarray(6,12),t.generalLevelIdc=r[12],t.avgFrameRate=readBig16$1(r,19),t.numOfArrays=r[22],t.vps=[],t.sps=[],t.pps=[];for(var i=23,a=0,o=0,s=0,u=0;u<t.numOfArrays;u++){a=63&r[i],o=readBig16$1(r,i+1),i+=3;for(var c,l=[],d=0;d<o;d++)s=readBig16$1(r,i),i+=2,l.push(r.subarray(i,i+s)),i+=s;if(32===a)(c=t.vps).push.apply(c,l);else if(33===a){var h;(h=t.sps).push.apply(h,l)}else if(34===a){var f;(f=t.pps).push.apply(f,l)}}}))}},{key:"pasp",value:function(e){return parseBox$1(e,!1,(function(e,t){e.hSpacing=readBig32$1(t),e.vSpacing=readBig32$1(t,4)}))}},{key:"mp4a",value:function(t){return parseBox$1(t,!1,(function(t,r,n){var i=parseAudioSampleEntry$1(t,r);t.esds=e.esds(e.findBox(r.subarray(i),["esds"],n+i)[0])}))}},{key:"esds",value:function(e){return parseBox$1(e,!0,(function(e,t){e.codec="mp4a.";for(var r=0,n=0,i=0,a=0;t.length;){for(a=t[r=0],n=t[r+1],r+=2;128&n;)i=(127&n)<<7,n=t[r],r+=1;if(i+=127&n,3===a)t=t.subarray(r+3);else{if(4!==a){if(5===a){var o=e.config=t.subarray(r,r+i),s=(248&o[0])>>3;return 31===s&&o.length>=2&&(s=32+((7&o[0])<<3)+((224&o[1])>>5)),e.objectType=s,void(e.codec+=s.toString(16))}return}e.codec+=(t[r].toString(16)+".").padStart(3,"0"),t=t.subarray(r+13)}}}))}},{key:"alaw",value:function(e){return parseBox$1(e,!1,(function(e,t){parseAudioSampleEntry$1(e,t)}))}},{key:"stts",value:function(e){return parseBox$1(e,!0,(function(e,t){for(var r=readBig32$1(t),n=[],i=4,a=0;a<r;a++)n.push({count:readBig32$1(t,i),delta:readBig32$1(t,i+4)}),i+=8;e.entryCount=r,e.entries=n}))}},{key:"ctts",value:function(e){return parseBox$1(e,!0,(function(e,t){var r=readBig32$1(t),n=[],i=4;if(1===e.version)for(var a=0;a<r;a++)n.push({count:readBig32$1(t,i),offset:readBig32$1(t,i+4)}),i+=8;else for(var o=0;o<r;o++)n.push({count:readBig32$1(t,i),offset:-(1+~readBig32$1(t,i+4))}),i+=8;e.entryCount=r,e.entries=n}))}},{key:"stsc",value:function(e){return parseBox$1(e,!0,(function(e,t){for(var r=readBig32$1(t),n=[],i=4,a=0;a<r;a++)n.push({firstChunk:readBig32$1(t,i),samplesPerChunk:readBig32$1(t,i+4),sampleDescriptionIndex:readBig32$1(t,i+8)}),i+=12;e.entryCount=r,e.entries=n}))}},{key:"stsz",value:function(e){return parseBox$1(e,!0,(function(e,t){var r=readBig32$1(t),n=readBig32$1(t,4),i=[];if(!r)for(var a=8,o=0;o<n;o++)i.push(readBig32$1(t,a)),a+=4;e.sampleSize=r,e.sampleCount=n,e.entrySizes=i}))}},{key:"stco",value:function(e){return parseBox$1(e,!0,(function(e,t){for(var r=readBig32$1(t),n=[],i=4,a=0;a<r;a++)n.push(readBig32$1(t,i)),i+=4;e.entryCount=r,e.entries=n}))}},{key:"stss",value:function(e){return parseBox$1(e,!0,(function(e,t){for(var r=readBig32$1(t),n=[],i=4,a=0;a<r;a++)n.push(readBig32$1(t,i)),i+=4;e.entryCount=r,e.entries=n}))}},{key:"moof",value:function(t){return parseBox$1(t,!1,(function(t,r,n){t.mfhd=e.mfhd(e.findBox(r,["mfhd"],n)[0]),t.traf=e.findBox(r,["traf"],n).map((function(t){return e.traf(t)}))}))}},{key:"mfhd",value:function(e){return parseBox$1(e,!0,(function(e,t){e.sequenceNumber=readBig32$1(t)}))}},{key:"traf",value:function(t){return parseBox$1(t,!1,(function(t,r,n){t.tfhd=e.tfhd(e.findBox(r,["tfhd"],n)[0]),t.tfdt=e.tfdt(e.findBox(r,["tfdt"],n)[0]),t.trun=e.trun(e.findBox(r,["trun"],n)[0])}))}},{key:"tfhd",value:function(e){return parseBox$1(e,!0,(function(e,t){var r=e.flags,n=t.length;e.trackId=readBig32$1(t);var i=4;n>i&&1&r&&(e.baseDataOffset=readBig64$1(t,i),i+=8),n>i&&2&r&&(e.sampleDescriptionIndex=readBig32$1(t,i),i+=4),n>i&&8&r&&(e.defaultSampleDuration=readBig32$1(t,i),i+=4),n>i&&10&r&&(e.defaultSampleSize=readBig32$1(t,i),i+=4),n>i&&32&r&&(e.defaultSampleFlags=readBig32$1(t,i),i+=4)}))}},{key:"trun",value:function(e){return parseBox$1(e,!0,(function(e,t){var r=e.version,n=e.flags,i=t.length,a=e.sampleCount=readBig32$1(t),o=4;if(i>o&&1&n&&(e.dataOffset=-(1+~readBig32$1(t,o)),o+=4),i>o&&4&n&&(e.firstSampleFlags=readBig32$1(t,o),o+=4),e.samples=[],i>o)for(var s,u=0;u<a;u++)s={},256&n&&(s.duration=readBig32$1(t,o),o+=4),512&n&&(s.size=readBig32$1(t,o),o+=4),1024&n&&(s.flags=readBig32$1(t,o),o+=4),2048&n&&(s.cts=r?-(1+~readBig32$1(t,o+4)):readBig32$1(t,o),o+=4),e.samples.push(s)}))}},{key:"tfdt",value:function(e){return parseBox$1(e,!0,(function(e,t){1===e.version?e.baseMediaDecodeTime=readBig64$1(t):e.baseMediaDecodeTime=readBig32$1(t)}))}},{key:"probe",value:function(t){return!!e.findBox(t,["ftyp"])}},{key:"moovToTrack",value:function(e,t,r){var n,i,a=e.trak;if(a&&a.length){var o=a.find((function(e){var t,r;return"vide"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),s=a.find((function(e){var t,r;return"soun"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)}));if(o&&t){var u,c=t;null!=(null===(u=o.tkhd)||void 0===u?void 0:u.trackId)&&(c.id=o.tkhd.trackId),c.timescale=c.formatTimescale=o.mdia.mdhd.timescale,c.duration=o.mdia.mdhd.duration;var l=o.mdia.minf.stbl.stsd.entries[0];if(c.width=l.width,c.height=l.height,l.pasp&&(c.sarRatio=[l.pasp.hSpacing,l.pasp.vSpacing]),l.hvcC)c.codecType=VideoCodecType$2.HEVC,c.codec=l.hvcC.codec,c.vps=l.hvcC.vps,c.sps=l.hvcC.sps,c.pps=l.hvcC.pps,c.hvcC=l.hvcC.data;else{if(!l.avcC)throw new Error("unknown video stsd entry");c.codec=l.avcC.codec,c.sps=l.avcC.sps,c.pps=l.avcC.pps}c.present=!0}if(s&&r){var d,h=r;null!=(null===(d=s.tkhd)||void 0===d?void 0:d.trackId)&&(h.id=s.tkhd.trackId),h.timescale=h.formatTimescale=s.mdia.mdhd.timescale,h.duration=s.mdia.mdhd.duration;var f=s.mdia.minf.stbl.stsd.entries[0];switch(h.sampleSize=f.sampleSize,h.sampleRate=f.sampleRate,h.channelCount=f.channelCount,h.present=!0,f.type){case"alaw":h.codecType=h.codec=AudioCodecType$1.G711PCMA,h.sampleRate=8e3;break;case"ulaw":h.codecType=h.codec=AudioCodecType$1.G711PCMU,h.sampleRate=8e3;break;default:h.sampleDuration=AAC$1.getFrameDuration(h.sampleRate,h.timescale),h.sampleRateIndex=AAC$1.getRateIndexByRate(h.sampleRate),h.objectType=(null===(n=f.esds)||void 0===n?void 0:n.objectType)||2,f.esds&&(h.config=Array.from(f.esds.config)),h.codec=(null===(i=f.esds)||void 0===i?void 0:i.codec)||"mp4a.40.2"}}return{videoTrack:t,audioTrack:r}}}},{key:"evaluateDefaultDuration",value:function(e,t,r){var n,i=null==t||null===(n=t.samples)||void 0===n?void 0:n.length;return i?1024*i/t.timescale*e.timescale/r:1024}},{key:"moofToSamples",value:function(t,r,n){var i={};return t.mfhd&&(r&&(r.sequenceNumber=t.mfhd.sequenceNumber),n&&(n.sequenceNumber=t.mfhd.sequenceNumber)),t.traf.forEach((function(t){var a=t.tfhd,o=t.tfdt,s=t.trun;if(a&&s){o&&(r&&r.id===a.trackId&&(r.baseMediaDecodeTime=o.baseMediaDecodeTime),n&&n.id===a.trackId&&(n.baseMediaDecodeTime=o.baseMediaDecodeTime));var u=a.defaultSampleSize||0,c=a.defaultSampleDuration||e.evaluateDefaultDuration(r,n,s.samples.length||s.sampleCount),l=s.dataOffset||0,d=0,h=-1;if(!s.samples.length&&s.sampleCount){i[a.trackId]=[];for(var f=0;f<s.sampleCount;f++)i[a.trackId].push({offset:l,dts:d,duration:c,size:u}),d+=c,l+=u}else i[a.trackId]=s.samples.map((function(e,t){return(e={offset:l,dts:d,pts:d+(e.cts||0),duration:e.duration||c,size:e.size||u,gopId:h,keyframe:0===t||null!=e.flags&&(65536&e.flags)>>>0!=65536}).keyframe&&(h++,e.gopId=h),d+=e.duration,l+=e.size,e}))}})),i}},{key:"moovToSamples",value:function(e){var t=e.trak;if(t&&t.length){var r=t.find((function(e){var t,r;return"vide"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),n=t.find((function(e){var t,r;return"soun"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)}));if(r||n){var i,a;if(r){var o,s,u=null===(o=r.mdia)||void 0===o||null===(s=o.minf)||void 0===s?void 0:s.stbl;if(!u)return;var c=u.stts,l=u.stsc,d=u.stsz,h=u.stco,f=u.stss,p=u.ctts;if(!(c&&l&&d&&h&&f))return;i=getSamples$1(c,l,d,h,p,f)}if(n){var g,y,m,v=null===(g=n.mdia)||void 0===g||null===(y=g.minf)||void 0===y?void 0:y.stbl;if(!v)return;var _=null===(m=n.mdia.mdhd)||void 0===m?void 0:m.timescale,b=v.stts,A=v.stsc,E=v.stsz,S=v.stco;if(!(_&&b&&A&&E&&S))return;a=getSamples$1(b,A,E,S)}return{videoSamples:i,audioSamples:a}}}}}]),e}();function getSamples$1(e,t,r,n,i,a){var o,s,u,c=[],l=null==i?void 0:i.entries,d=t.entries,h=n.entries,f=r.entrySizes,p=null==a?void 0:a.entries;p&&(o={},p.forEach((function(e){o[e-1]=!0}))),l&&(s=[],l.forEach((function(e){for(var t=e.count,r=e.offset,n=0;n<t;n++)s.push(r)})));var g=-1,y=0,m=0,v=0,_=0,b=0,A=d[0].samplesPerChunk,E=d[1]?d[1].firstChunk-1:1/0;return e.entries.forEach((function(e){for(var t=e.count,n=e.delta,i=0;i<t;i++)u={dts:y,duration:n,size:f[m]||r.sampleSize,offset:h[v]+b,index:m},p&&(u.keyframe=o[m],u.keyframe&&g++,u.gopId=g),s&&s[m]&&(u.pts=u.dts+s[m]),c.push(u),y+=n,++m<A?b+=u.size:(v++,b=0,v>=E&&(_++,E=d[_+1]?d[_+1].firstChunk-1:1/0),A+=d[_].samplesPerChunk)})),c}function parseVisualSampleEntry$1(e,t){return e.dataReferenceIndex=readBig16$1(t,6),e.width=readBig16$1(t,24),e.height=readBig16$1(t,26),e.horizresolution=readBig32$1(t,28),e.vertresolution=readBig32$1(t,32),e.frameCount=readBig16$1(t,40),e.depth=readBig16$1(t,74),78}function parseAudioSampleEntry$1(e,t){return e.dataReferenceIndex=readBig16$1(t,6),e.channelCount=readBig16$1(t,16),e.sampleSize=readBig16$1(t,18),e.sampleRate=readBig32$1(t,24)/65536,28}function parseBox$1(e,t,r){if(e){if(e.size!==e.data.length)throw new Error("box ".concat(e.type," size !== data.length"));var n={start:e.start,size:e.size,headerSize:e.headerSize,type:e.type};return t&&(n.version=e.data[e.headerSize],n.flags=readBig24$1(e.data,e.headerSize+1),n.headerSize+=4),r(n,e.data.subarray(n.headerSize),n.start+n.headerSize),n}}var FMP4Demuxer=function(){function e(t,r,n){_classCallCheck$4(this,e),this.videoTrack=t||new VideoTrack$1,this.audioTrack=r||new AudioTrack$1,this.metadataTrack=n||new MetadataTrack$1}return _createClass$5(e,[{key:"demux",value:function(e,t){var r=this.videoTrack,n=this.audioTrack,i=r.exist(),a=n.exist();if(r.samples=[],n.samples=[],t){if(!a){var o=MP4Parser$1.findBox(t,["moov"])[0];if(!o)throw new Error("cannot found moov box");MP4Parser$1.moovToTrack(MP4Parser$1.moov(o),null,n)}var s=MP4Parser$1.findBox(t,["moof"])[0];if(s){var u=MP4Parser$1.moofToSamples(MP4Parser$1.moof(s),null,n)[n.id],c=n.baseMediaDecodeTime;if(u){var l=s.start;u.map((function(e){e.offset+=l;var r=t.subarray(e.offset,e.offset+e.size);n.samples.push(new AudioSample$1(e.dts+c,r,e.duration))}))}}}if(e){if(!i&&!a){var d=MP4Parser$1.findBox(e,["moov"])[0];if(!d)throw new Error("cannot found moov box");MP4Parser$1.moovToTrack(MP4Parser$1.moov(d),r,n)}var h=MP4Parser$1.findBox(e,["moof"])[0];if(h){var f,p=MP4Parser$1.moofToSamples(MP4Parser$1.moof(h),r,n),g=r.baseMediaDecodeTime,y=n.baseMediaDecodeTime,m=h.start;Object.keys(p).forEach((function(t){r.id==t?p[t].map((function(t){t.offset+=m;var n=new VideoSample$1((t.pts||t.dts)+g,t.dts+g);n.duration=t.duration,n.gopId=t.gopId,t.keyframe&&n.setToKeyframe();for(var i=e.subarray(t.offset,t.offset+t.size),a=0,o=i.length-1;a<o;)f=readBig32$1(i,a),a+=4,n.units.push(i.subarray(a,a+f)),a+=f;r.samples.push(n)})):n.id==t&&p[t].map((function(t){t.offset+=m;var r=e.subarray(t.offset,t.offset+t.size);n.samples.push(new AudioSample$1(t.dts+y,r,t.duration))}))}))}}return{videoTrack:r,audioTrack:n,metadataTrack:this.metadataTrack}}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}}],[{key:"probe",value:function(e){return MP4Parser$1.probe(e)}}]),e}(),UINT32_MAX$2=Math.pow(2,32)-1,MP4$3=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"box",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=8+(r=r.filter(Boolean)).reduce((function(e,t){return e+t.byteLength}),0),a=new Uint8Array(i);a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(e,4);var o=8;return r.forEach((function(e){a.set(e,o),o+=e.byteLength})),a}},{key:"ftyp",value:function(t){return t.find((function(e){return e.type===TrackType$2.VIDEO&&e.codecType===VideoCodecType$2.HEVC}))?e.FTYPHEV1:e.FTYPAVC1}},{key:"initSegment",value:function(t){return concatUint8Array$3(e.ftyp(t),e.moov(t))}},{key:"moov",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat(_toConsumableArray$1(t.map((function(t){return e.trak(t)}))),[e.mvex(t)]))}},{key:"mvhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdia(t))}},{key:"tkhd",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minf(t))}},{key:"mdhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,85,196,0,0]))}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"minf",value:function(t){return e.box(e.types.minf,t.type===TrackType$2.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stbl(t))}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.STTS,e.STSC,e.STSZ,e.STCO)}},{key:"stsd",value:function(t){return e.box(e.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),t.type===TrackType$2.VIDEO?e.avc1hev1(t):e.mp4a(t))}},{key:"avc1hev1",value:function(t){var r=t.codecType===VideoCodecType$2.HEVC,n=r?e.types.hvc1:e.types.avc1,i=r?e.hvcC(t):e.avcC(t),a=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i];return t.sarRatio&&t.sarRatio.length>1&&a.push(e.pasp(t.sarRatio)),e.box.apply(e,[n].concat(a))}},{key:"avcC",value:function(t){var r,n=[],i=[];return t.sps.forEach((function(e){r=e.byteLength,n.push(r>>>8&255),n.push(255&r),n.push.apply(n,_toConsumableArray$1(e))})),t.pps.forEach((function(e){r=e.byteLength,i.push(r>>>8&255),i.push(255&r),i.push.apply(i,_toConsumableArray$1(e))})),e.box(e.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|t.sps.length].concat(n).concat([t.pps.length]).concat(i)))}},{key:"hvcC",value:function(t){var r=t.hvcC;if(r instanceof ArrayBuffer)return r;var n,i=t.vps,a=t.sps,o=t.pps;if(r){var s=r.generalProfileCompatibilityFlags,u=r.generalConstraintIndicatorFlags,c=(i.length&&1)+(a.length&&1)+(o.length&&1);n=[1,r.generalProfileSpace<<6|r.generalTierFlag<<5|r.generalProfileIdc,s>>>24,s>>>16,s>>>8,s,u[0],u[1],u[2],u[3],u[4],u[5],r.generalLevelIdc,240,0,252,252|r.chromaFormatIdc,248|r.bitDepthLumaMinus8,248|r.bitDepthChromaMinus8,0,0,r.numTemporalLayers<<3|r.temporalIdNested<<2|3,c];var l=function(e){var t;n.push(e.length>>8,e.length),(t=n).push.apply(t,_toConsumableArray$1(e))};i.length&&(n.push(160,0,i.length),i.forEach(l)),a.length&&(n.push(161,0,a.length),a.forEach(l)),o.length&&(n.push(162,0,o.length),o.forEach(l))}else n=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return e.box(e.types.hvcC,new Uint8Array(n))}},{key:"pasp",value:function(t){var r=_slicedToArray$1(t,2),n=r[0],i=r[1];return e.box(e.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i]))}},{key:"mp4a",value:function(t){return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,255&t.sampleRate,0,0]),t.config.length?e.esds(t.config):void 0)}},{key:"esds",value:function(t){var r=t.length;return e.box(e.types.esds,new Uint8Array([0,0,0,0,3,23+r,0,0,0,4,15+r,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([r]).concat(t).concat([6,1,2])))}},{key:"mvex",value:function(t){return e.box.apply(e,[e.types.mvex].concat(_toConsumableArray$1(t.map((function(t){return e.trex(t.id)})))))}},{key:"trex",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"moof",value:function(t,r){return e.box.apply(e,[e.types.moof,e.mfhd(t)].concat(_toConsumableArray$1(r.map((function(t){return e.traf(t)})))))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"traf",value:function(t){return e.box(e.types.traf,e.tfhd(t.id),e.tfdt(t.baseMediaDecodeTime),e.trun(t.samples,76))}},{key:"tfhd",value:function(t){return e.box(e.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"tfdt",value:function(t){var r=Math.floor(t/(UINT32_MAX$2+1)),n=Math.floor(t%(UINT32_MAX$2+1));return e.box(e.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n]))}},{key:"trun",value:function(t,r){var n=t.length,i=12+16*n;r+=8+i;var a=new Uint8Array(i);a.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0);for(var o=0;o<n;o++){var s=t[o],u=s.duration,c=s.size,l=s.flag,d=void 0===l?{}:l,h=s.cts,f=void 0===h?0:h;a.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,c>>>24&255,c>>>16&255,c>>>8&255,255&c,d.isLeading<<2|(null==d.dependsOn?1:d.dependsOn),d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|(null==d.isNonSyncSample?1:d.isNonSyncSample),61440&d.degradationPriority,15&d.degradationPriority,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*o)}return e.box(e.types.trun,a)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"moovMP4",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat(_toConsumableArray$1(t.map((function(t){return e.trackMP4(t)})))))}},{key:"trackMP4",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdiaMP4(t))}},{key:"mdiaMP4",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minfMP4(t))}},{key:"minfMP4",value:function(t){return e.box(e.types.minf,t.type===TrackType$2.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stblMP4(t))}},{key:"stblMP4",value:function(t){var r=t.ext,n=[e.stsd(t),e.stts(r.stts),e.stsc(r.stsc),e.stsz(r.stsz),e.stco(r.stco)];return r.stss.length&&n.push(e.stss(r.stss)),r.ctts.length&&n.push(e.ctts(r.ctts)),e.box.apply(e,[e.types.stbl].concat(n))}},{key:"stts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.stts,concatUint8Array$3(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsc",value:function(t){var r=t.length,n=new Uint8Array(12*r),i=0;return t.forEach((function(e){var t=e.firstChunk,r=e.samplesPerChunk,a=e.sampleDescIndex;n.set([t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a],i),i+=12})),e.box(e.types.stsc,concatUint8Array$3(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsz",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stsz,concatUint8Array$3(new Uint8Array([0,0,0,0,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stco",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stco,concatUint8Array$3(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stss",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stss,concatUint8Array$3(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"ctts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.ctts,concatUint8Array$3(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}}]),e}();_defineProperty$5(MP4$3,"types",["avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trun","trex","tkhd","vmhd","smhd","ctts","stss"].reduce((function(e,t){return e[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)],e}),Object.create(null))),_defineProperty$5(MP4$3,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])}),_defineProperty$5(MP4$3,"FTYPAVC1",MP4$3.box(MP4$3.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))),_defineProperty$5(MP4$3,"FTYPHEV1",MP4$3.box(MP4$3.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49]))),_defineProperty$5(MP4$3,"DINF",MP4$3.box(MP4$3.types.dinf,MP4$3.box(MP4$3.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])))),_defineProperty$5(MP4$3,"VMHD",MP4$3.box(MP4$3.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))),_defineProperty$5(MP4$3,"SMHD",MP4$3.box(MP4$3.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0]))),_defineProperty$5(MP4$3,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0])),_defineProperty$5(MP4$3,"STTS",MP4$3.box(MP4$3.types.stts,MP4$3.StblTable)),_defineProperty$5(MP4$3,"STSC",MP4$3.box(MP4$3.types.stsc,MP4$3.StblTable)),_defineProperty$5(MP4$3,"STSZ",MP4$3.box(MP4$3.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]))),_defineProperty$5(MP4$3,"STCO",MP4$3.box(MP4$3.types.stco,MP4$3.StblTable));var FMP4Remuxer$1=function(){function e(t,r){_classCallCheck$4(this,e),this.videoTrack=t,this.audioTrack=r;var n=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=n&&Number(n[1])<50}return _createClass$5(e,[{key:"remux",value:function(){var e,t,r,n,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=this.videoTrack,o=this.audioTrack,s=a.exist(),u=o.exist();return i&&(s&&(e=MP4$3.initSegment([this.videoTrack])),u&&(t=MP4$3.initSegment([this.audioTrack]))),s&&a.hasSample()&&(r=this._remuxVideo()),u&&o.hasSample()&&(n=this._remuxAudio()),a.samples=[],o.samples=[],{videoInitSegment:e,audioInitSegment:t,videoSegment:r,audioSegment:n}}},{key:"_remuxVideo",value:function(){var e=this.videoTrack,t=e.samples;this.forceFirstIDR&&(t[0].flag={dependsOn:2,isNonSyncSample:0});var r=0;t.forEach((function(e){r+=e.units.reduce((function(e,t){return e+t.byteLength}),0),r+=4*e.units.length}));for(var n,i=new Uint8Array(r),a=new DataView(i.buffer),o=function(e,r,o,s){s=t[e];var u=0;s.units.forEach((function(e){a.setUint32(o,e.byteLength),o+=4,i.set(e,o),o+=e.byteLength,u+=4+e.byteLength})),s.size=u,c=o,n=s},s=0,u=t.length,c=0;s<u;s++)o(s,0,c,n);return concatUint8Array$3(MP4$3.moof(this.videoTrack.sequenceNumber++,[e]),MP4$3.mdat(i))}},{key:"_remuxAudio",value:function(){var e=this.audioTrack,t=MP4$3.moof(this.audioTrack.sequenceNumber++,[e]),r=new Uint8Array(e.samples.reduce((function(e,t){return e+t.size}),0));return e.samples.reduce((function(e,t){return r.set(t.data,e),e+t.size}),0),concatUint8Array$3(t,MP4$3.mdat(r))}}]),e}(),Event$4=_objectSpread2$3(_objectSpread2$3({},EVENT$1),{},{STREAM_PARSED:"core.streamparsed",NO_AUDIO_TRACK:"core.noaudiotrack",DEMUXED_TRACK:"demuxedtrack"});function getConfig$4(e){var t=(null==e?void 0:e.media)||document.createElement("video");return _objectSpread2$3(_objectSpread2$3({maxPlaylistSize:50,retryCount:3,retryDelay:1e3,loadTimeout:1e4,preloadTime:30,softDecode:!1,bufferBehind:10,maxJumpDistance:3,startTime:0},e),{},{media:t})}function clamp(e,t,r){return Math.min(Math.max(e,t),r)}var Stream$1=function(){function e(t,r){_classCallCheck$3(this,e),_defineProperty$4(this,"live",void 0),_defineProperty$4(this,"id",0),_defineProperty$4(this,"bitrate",0),_defineProperty$4(this,"width",0),_defineProperty$4(this,"height",0),_defineProperty$4(this,"name",""),_defineProperty$4(this,"url",""),_defineProperty$4(this,"audioCodec",""),_defineProperty$4(this,"videoCodec",""),_defineProperty$4(this,"textCodec",""),_defineProperty$4(this,"startCC",0),_defineProperty$4(this,"endCC",0),_defineProperty$4(this,"startSN",0),_defineProperty$4(this,"endSN",-1),_defineProperty$4(this,"totalDuration",0),_defineProperty$4(this,"targetDuration",0),_defineProperty$4(this,"snDiff",null),_defineProperty$4(this,"segments",[]),_defineProperty$4(this,"audioStreams",[]),_defineProperty$4(this,"currentAudioStream",null),this.update(t,r)}return _createClass$4(e,[{key:"lastSegment",get:function(){if(this.segments.length)return this.segments[this.segments.length-1]}},{key:"segmentDuration",get:function(){var e;return this.targetDuration||(null===(e=this.segments[0])||void 0===e?void 0:e.duration)||0}},{key:"liveEdge",get:function(){return this.endTime}},{key:"endTime",get:function(){var e;return(null===(e=this.lastSegment)||void 0===e?void 0:e.end)||0}},{key:"clearOldSegment",value:function(e,t){return this.currentAudioStream&&this._clearSegments(this.currentAudioStream,e,t),this._clearSegments(this,e,t)}},{key:"getAudioSegment",value:function(e){if(e&&this.currentAudioStream){var t=e.sn-this.snDiff;return this.currentAudioStream.segments.find((function(e){return e.sn===t}))}}},{key:"update",value:function(e,t){this.url=e.url,Array.isArray(e.segments)?(null==this.live&&(this.live=e.live),this._updateSegments(e,this),this.startCC=e.startCC,this.endCC=e.endCC,this.startSN=e.startSN,this.endSN=e.endSN||-1,this.totalDuration=e.totalDuration,this.targetDuration=e.targetDuration,this.live=e.live,t&&this.currentAudioStream&&Array.isArray(t.segments)&&(this._updateSegments(t,this.currentAudioStream),null==this.snDiff&&e.segments.length&&t.segments.length&&(this.snDiff=e.segments[0].sn-t.segments[0].sn))):(this.id=e.id,this.bitrate=e.bitrate,this.width=e.width,this.height=e.height,this.name=e.name,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.textCodec=e.textCodec,this.audioStreams=e.audioStreams,!this.currentAudioStream&&this.audioStreams.length&&(this.currentAudioStream=this.audioStreams.find((function(e){return e.default}))||this.audioStreams[0]))}},{key:"_clearSegments",value:function(e,t){for(var r=0,n=this.segments,i=0,a=n.length;i<a;i++)if(n[i].end>=e){r=i;break}return r>t&&(r=t),r&&(this.segments=this.segments.slice(r),this.currentAudioStream&&(this.currentAudioStream.segments=this.currentAudioStream.segments.slice(r))),t-r}},{key:"_updateSegments",value:function(e,t){var r=t.segments;if(this.live){var n=r[r.length-1],i=(null==n?void 0:n.sn)||-1;if(i<e.endSN&&e.segments.length){var a=e.segments.findIndex((function(e){return e.sn===i})),o=a<0?e.segments:e.segments.slice(a+1);if(r.length&&o.length){var s=n.end;o.forEach((function(e){e.start=s,s=e.end}));var u=(null==n?void 0:n.cc)||-1;u>o[0].cc&&o.forEach((function(e){return e.cc+=u}))}t.segments=r.concat(o)}}else t.segments=e.segments}}]),e}(),Playlist=function(){function e(t){_classCallCheck$3(this,e),_defineProperty$4(this,"streams",[]),_defineProperty$4(this,"currentStream",null),_defineProperty$4(this,"dvrWindow",0),_defineProperty$4(this,"_segmentPointer",-1),this.hls=t}return _createClass$4(e,[{key:"lastSegment",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.lastSegment}},{key:"currentSegment",get:function(){var e;return null===(e=this.currentSegments)||void 0===e?void 0:e[this._segmentPointer]}},{key:"nextSegment",get:function(){var e;return null===(e=this.currentSegments)||void 0===e?void 0:e[this._segmentPointer+1]}},{key:"currentSegments",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.segments}},{key:"liveEdge",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.liveEdge}},{key:"seekRange",get:function(){var e=this.currentSegments;if(e&&e.length)return[e[0].start,e[e.length-1].end]}},{key:"isEmpty",get:function(){var e;return!(null!==(e=this.currentSegments)&&void 0!==e&&e.length)}},{key:"isLive",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.live}},{key:"getAudioSegment",value:function(e){var t;return null===(t=this.currentStream)||void 0===t?void 0:t.getAudioSegment(e)}},{key:"moveSegmentPointer",value:function(e){var t;null==e&&(e=this._segmentPointer+1),this._segmentPointer=clamp(e,-1,null===(t=this.currentSegments)||void 0===t?void 0:t.length)}},{key:"reset",value:function(){this.streams=[],this.currentStream=null,this.dvrWindow=0,this._segmentPointer=-1}},{key:"getSegmentByIndex",value:function(e){var t;return null===(t=this.currentSegments)||void 0===t?void 0:t[e]}},{key:"setNextSegmentByIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._segmentPointer=e-1}},{key:"findSegmentIndexByTime",value:function(e){var t=this.currentSegments;if(t){for(var r,n=0,i=t.length;n<i;n++)if(e>=(r=t[n]).start&&e<r.end)return n;var a=t[t.length-1];if(Math.abs(e-a.end)<.2)return t.length-1}}},{key:"upsertPlaylist",value:function(e,t){var r=this;if(e){if(e.isMaster)this.streams.length=e.streams.length,e.streams.filter((function(e){return e.url})).forEach((function(e,t){r.streams[t]?r.streams[t].update(e):r.streams[t]=new Stream$1(e)})),this.currentStream=this.streams[0];else if(Array.isArray(e.segments)){var n=this.currentStream;n?n.update(e,t):(this.reset(),this.currentStream=this.streams[0]=new Stream$1(e,t))}this.currentStream&&this.hls.isLive&&!this.dvrWindow&&(this.dvrWindow=this.currentSegments.reduce((function(e,t){return e+=t.duration}),0))}}},{key:"clearOldSegment",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=this.currentStream;if(this.dvrWindow&&t){var r=t.endTime-this.dvrWindow;if(!(r<=0)){var n=t.segments;n.length<=e||(this._segmentPointer=t.clearOldSegment(r,this._segmentPointer))}}}}]),e}(),Decryptor=function(){function e(){_classCallCheck$3(this,e);var t=window.crypto||window.msCrypto;this.subtle=t&&(t.subtle||t.webkitSubtle),this.externalDecryptor=null}var t,r;return _createClass$4(e,[{key:"decrypt",value:function(e,t){if(e||t){var r=[];return e&&(r[0]=this._decryptSegment(e)),t&&(r[1]=this._decryptSegment(t)),Promise.all(r)}}},{key:"_decryptSegment",value:(r=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(t){var r;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.data,!t.key){e.next=5;break}return e.next=4,this._decryptData(t.data,t.key,t.keyIv);case 4:r=e.sent;case 5:if(t.map){e.next=7;break}return e.abrupt("return",r);case 7:return e.abrupt("return",concatUint8Array$5(t.map,r));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_decryptData",value:(t=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(t,r,n){var i;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.externalDecryptor){e.next=6;break}return e.next=3,this.externalDecryptor.decrypt(t,r,n);case 3:return e.abrupt("return",e.sent);case 6:if(this.subtle){e.next=8;break}throw new Error("crypto is not defined");case 8:return e.next=10,this.subtle.importKey("raw",r,{name:"AES-CBC"},!1,["encrypt","decrypt"]);case 10:return i=e.sent,e.t0=Uint8Array,e.next=14,this.subtle.decrypt({name:"AES-CBC",iv:n},i,t);case 14:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 16:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})}]),e}(),logger$4=new Logger$8("Transmuxer"),Transmuxer=function(){function e(t,r,n){_classCallCheck$3(this,e),this.hls=t,this._demuxer=r?new FMP4Demuxer:new TsDemuxer,this._isMP4=r,n&&(this._remuxer=new FMP4Remuxer$1(this._demuxer.videoTrack,this._demuxer.audioTrack))}return _createClass$4(e,[{key:"transmux",value:function(e,t,r,n,i,a){var o=this._demuxer;try{this._isMP4?o.demux(e,t):o.demuxAndFix(concatUint8Array$5(e,t),r,n,i)}catch(error){throw new StreamingError$1(ERR$1.DEMUX,ERR$1.SUB_TYPES.HLS,error)}var s=o.videoTrack,u=o.audioTrack,c=o.metadataTrack;if(this._fireEvents(s,u,c,r),this.hls.emit(Event$4.DEMUXED_TRACK,s),!this._remuxer)return[s,u];try{var l=this._remuxer.remux(a),d=l.videoInitSegment,h=l.videoSegment,f=l.audioInitSegment,p=l.audioSegment,g=concatUint8Array$5(d,h),y=concatUint8Array$5(f,p);return[g?{codec:s.codec,data:g}:void 0,y?{codec:u.codec,data:y}:void 0]}catch(error){throw new StreamingError$1(ERR$1.REMUX,ERR$1.SUB_TYPES.FMP4,error)}}},{key:"_fireEvents",value:function(e,t,r,n){var i=this;logger$4.debug(e.samples,t.samples),n&&(e.exist()&&this.hls.emit(Event$4.METADATA_PARSED,{type:"video",track:e,meta:{codec:e.codec,timescale:e.timescale,width:e.width,height:e.height,sarRatio:e.sarRatio,baseDts:e.baseDts}}),t.exist()&&this.hls.emit(Event$4.METADATA_PARSED,{type:"audio",track:t,meta:{codec:t.codec,channelCount:t.channelCount,sampleRate:t.sampleRate,timescale:t.timescale,baseDts:t.baseDts}}),logger$4.debug("discontinuity",e,t)),e.warnings.forEach((function(e){var t;switch(e.type){case WarningType.LARGE_AV_SHIFT:t=Event$4.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case WarningType.LARGE_VIDEO_GAP:t=Event$4.LARGE_VIDEO_DTS_GAP_DETECT;break;case WarningType.LARGE_VIDEO_GAP_BETWEEN_CHUNK:t=Event$4.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT}t&&i.hls.emit(Event$4.STREAM_EXCEPTION,_objectSpread2$3(_objectSpread2$3({},e),{},{type:t})),logger$4.warn("video exception",e)})),t.warnings.forEach((function(e){var t;switch(e.type){case WarningType.LARGE_AUDIO_GAP:t=Event$4.LARGE_AUDIO_DTS_GAP_DETECT;break;case WarningType.AUDIO_FILLED:t=Event$4.AUDIO_GAP_DETECT;break;case WarningType.AUDIO_DROPPED:t=Event$4.AUDIO_OVERLAP_DETECT}t&&i.hls.emit(Event$4.STREAM_EXCEPTION,_objectSpread2$3(_objectSpread2$3({},e),{},{type:t})),logger$4.warn("audio exception",e)})),e.samples.forEach((function(e){e.keyframe&&i.hls.emit(Event$4.KEYFRAME,{pts:e.pts})})),r.seiSamples.forEach((function(e){i.hls.emit(Event$4.SEI,_objectSpread2$3(_objectSpread2$3({},e),{},{originPts:e.originPts/90,sei:{code:e.data.type,content:e.data.payload,dts:e.pts}}))}))}}]),e}(),logger$3=new Logger$8("BufferService"),BufferService=function(){function e(t){if(_classCallCheck$3(this,e),_defineProperty$4(this,"_decryptor",new Decryptor),_defineProperty$4(this,"_transmuxer",null),_defineProperty$4(this,"_mse",null),_defineProperty$4(this,"_softVideo",null),_defineProperty$4(this,"_sourceCreated",!1),_defineProperty$4(this,"_needInitSegment",!0),_defineProperty$4(this,"_directAppend",!1),this.hls=t,t.config.softDecode)this._softVideo=t.media;else{this._mse=new MSE$3;var r=this._mse.bindMedia(t.media);r&&r.then&&r.then((function(){t&&t.emit("sourceAttached")}))}t.config.decryptor&&(this._decryptor.externalDecryptor=t.config.decryptor)}var t,r,n,i,a,o,s,u;return _createClass$4(e,[{key:"baseDts",get:function(){var e,t,r;return null===(e=this._transmuxer)||void 0===e||null===(t=e._demuxer)||void 0===t||null===(r=t._fixer)||void 0===r?void 0:r._baseDts}},{key:"updateDuration",value:(u=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(t){return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(logger$3.debug("update duration",t),!this._mse){e.next=9;break}if(this._mse.isOpened){e.next=5;break}return e.next=5,this._mse.open();case 5:return e.next=7,this._mse.updateDuration(t);case 7:e.next=10;break;case 9:this._softVideo&&(this._softVideo.duration=t);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"createSource",value:function(e,t,r,n){if(!this._sourceCreated){var i=e||t;if(i){if(TsDemuxer.probe(i))this._transmuxer||(this._transmuxer=new Transmuxer(this.hls,!1,!this._softVideo));else{if(!MP4Parser$1.probe(i))throw new StreamingError$1(ERR$1.OTHER,null,null,null,"unsupported stream");if(this._softVideo)this._transmuxer||(this._transmuxer=new Transmuxer(this.hls,!0));else{this._directAppend=!0;var a=!1;e&&!r&&MP4Parser$1.findBox(e,["moov","trak"]).forEach((function(e){var t=MP4Parser$1.findBox(e.data,["trak","mdia","minf","stbl","stsd"])[0];if(t){var i=MP4Parser$1.stsd(t).entries[0];if(i)if(i.hvcC)r=i.hvcC.codec||"hev1.1.6.L93.B0";else if(i.avcC)r=i.avcC.codec;else if(i.sampleRate||i.esds){var o;n=(null===(o=i.esds)||void 0===o?void 0:o.codec)||"mp4a.40.2",a=!0}}})),t&&!n&&MP4Parser$1.findBox(t,["moov","trak","mdia","minf","stbl","stsd"]).forEach((function(e){var t=MP4Parser$1.stsd(e).entries[0];t&&t.esds&&(n=t.esds.codec)})),e&&!r&&(r="avc1.42e01e"),t&&!n&&(n="mp4a.40.2"),a&&(r+=", ".concat(n),n=""),this._createMseSource(r,n)}}this._softVideo&&(this._sourceCreated=!0)}}}},{key:"appendBuffer",value:(s=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(t,r,n,i,a){var o,s,u,c,l,d;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.length||null!=r&&r.length){e.next=2;break}return e.abrupt("return");case 2:if(!this._directAppend){e.next=7;break}return o=[],t&&o.push(this._mse.append(MSE$3.VIDEO,t)),r&&o.push(this._mse.append(MSE$3.AUDIO,r)),e.abrupt("return",Promise.all(o));case 7:if(s=this._transmuxer.transmux(t,r,n,i,a,this._needInitSegment||n),u=_slicedToArray(s,2),c=u[0],l=u[1],c&&!l&&this.hls.emit(Event$4.NO_AUDIO_TRACK),!this._softVideo){e.next=13;break}this._softVideo.appendBuffer(c,l),e.next=21;break;case 13:if(!this._mse){e.next=21;break}return this._sourceCreated||this._createMseSource(null==c?void 0:c.codec,null==l?void 0:l.codec),this._needInitSegment=!1,d=this._mse,o=[],c&&o.push(d.append(MSE$3.VIDEO,c.data)),l&&o.push(d.append(MSE$3.AUDIO,l.data)),e.abrupt("return",Promise.all(o));case 21:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n,i){return s.apply(this,arguments)})},{key:"evictBuffer",value:(o=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(t){var r,n,i,a=this;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.hls.media,this._mse&&r&&t&&!(t<0)){e.next=3;break}return e.abrupt("return");case 3:if(n=r.currentTime,!((i=n-t)<=0)){e.next=7;break}return e.abrupt("return");case 7:if(!(Buffer$2.start(Buffer$2.get(r))+1>=i)){e.next=10;break}return e.abrupt("return");case 10:return e.abrupt("return",this._mse.clearBuffer(0,i).then((function(){return a.hls.emit(EVENT$1.REMOVE_BUFFER,{removeEnd:i})})));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"clearAllBuffer",value:(a=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(){return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=2;break}return e.abrupt("return",this._mse.clearAllBuffer());case 2:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"decryptBuffer",value:function(e,t){return this._decryptor.decrypt(e,t)}},{key:"reset",value:(i=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(){return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=5;break}return e.next=3,this._mse.unbindMedia();case 3:return e.next=5,this._mse.bindMedia(this.hls.media);case 5:this._transmuxer=null,this._sourceCreated=!1,this._needInitSegment=!0,this._directAppend=!1;case 9:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"endOfStream",value:(n=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(){return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=5;break}if(!this._sourceCreated){e.next=5;break}return e.next=4,this._mse.endOfStream();case 4:this.hls.emit(EVENT$1.BUFFEREOS);case 5:this._softVideo&&this._softVideo.endOfStream();case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setLiveSeekableRange",value:(r=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(t,r){return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._mse&&this._mse.setLiveSeekableRange(t,r);case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"destroy",value:(t=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(){var t;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._mse,this._mse=null,this._softVideo=null,!t){e.next=6;break}return e.next=6,t.unbindMedia();case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_createMseSource",value:function(e,t){logger$3.debug("create mse source, videoCodec=".concat(e,", audioCodec=").concat(t));var r=this._mse;r&&(e&&(r.createSource(MSE$3.VIDEO,"video/mp4;codecs=".concat(e)),this._sourceCreated=!0),t&&(r.createSource(MSE$3.AUDIO,"audio/mp4;codecs=".concat(t)),this._sourceCreated=!0),this.hls.emit(EVENT$1.SOURCEBUFFER_CREATED))}}]),e}(),MasterPlaylist=_createClass$4((function e(){_classCallCheck$3(this,e),_defineProperty$4(this,"version",0),_defineProperty$4(this,"streams",[]),_defineProperty$4(this,"isMaster",!0)})),AudioStream=_createClass$4((function e(){_classCallCheck$3(this,e),_defineProperty$4(this,"id",0),_defineProperty$4(this,"url",""),_defineProperty$4(this,"default",!1),_defineProperty$4(this,"group",""),_defineProperty$4(this,"name",""),_defineProperty$4(this,"lang",""),_defineProperty$4(this,"channels",0),_defineProperty$4(this,"segments",[])})),MasterStream=_createClass$4((function e(){_classCallCheck$3(this,e),_defineProperty$4(this,"id",0),_defineProperty$4(this,"bitrate",0),_defineProperty$4(this,"width",0),_defineProperty$4(this,"height",0),_defineProperty$4(this,"name",""),_defineProperty$4(this,"url",""),_defineProperty$4(this,"audioCodec",""),_defineProperty$4(this,"videoCodec",""),_defineProperty$4(this,"textCodec",""),_defineProperty$4(this,"audioGroup",""),_defineProperty$4(this,"audioStreams",[])})),MediaPlaylist=_createClass$4((function e(){_classCallCheck$3(this,e),_defineProperty$4(this,"version",0),_defineProperty$4(this,"url",""),_defineProperty$4(this,"type",""),_defineProperty$4(this,"startCC",0),_defineProperty$4(this,"endCC",0),_defineProperty$4(this,"startSN",0),_defineProperty$4(this,"endSN",0),_defineProperty$4(this,"totalDuration",0),_defineProperty$4(this,"targetDuration",0),_defineProperty$4(this,"live",!0),_defineProperty$4(this,"segments",[])})),MediaSegment=function(){function e(){_classCallCheck$3(this,e),_defineProperty$4(this,"sn",0),_defineProperty$4(this,"cc",0),_defineProperty$4(this,"url",""),_defineProperty$4(this,"title",""),_defineProperty$4(this,"start",0),_defineProperty$4(this,"duration",0),_defineProperty$4(this,"key",null),_defineProperty$4(this,"byteRange",null),_defineProperty$4(this,"isInitSegment",!1),_defineProperty$4(this,"initSegment",null),_defineProperty$4(this,"isLast",!1)}return _createClass$4(e,[{key:"end",get:function(){return this.start+this.duration}},{key:"setByteRange",value:function(e,t){this.byteRange=[0];var r=e.split("@");1===r.length&&t&&t.byteRange?(this.byteRange[0]=t.byteRange[1]||0,this.byteRange[0]&&(this.byteRange[0]+=1)):this.byteRange[0]=parseInt(r[1]),this.byteRange[1]=this.byteRange[0]+parseInt(r[0])-1}}]),e}(),MediaSegmentKey=function(){function e(t){_classCallCheck$3(this,e),_defineProperty$4(this,"method",""),_defineProperty$4(this,"url",""),_defineProperty$4(this,"iv",null),_defineProperty$4(this,"keyFormat",""),_defineProperty$4(this,"keyFormatVersions",""),t instanceof e&&(this.method=t.method,this.url=t.url,this.keyFormat=t.keyFormat,this.keyFormatVersions=t.keyFormatVersions,t.iv&&(this.iv=new Uint8Array(t.iv)))}return _createClass$4(e,[{key:"clone",value:function(t){var r=new e(this);return null!=t&&r.setIVFromSN(t),r}},{key:"setIVFromSN",value:function(e){if(!this.iv&&"AES-128"===this.method&&"number"==typeof e&&this.url){this.iv=new Uint8Array(16);for(var t=12;t<16;t++)this.iv[t]=e>>8*(15-t)&255}}}]),e}(),REGEXP_TAG=/^#(EXT[^:]*)(?::(.*))?$/,REGEXP_ATTR=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g,REGEXP_ABSOLUTE_URL=/^(?:[a-zA-Z0-9+\-.]+:)?\/\//,REGEXP_URL_PAIR=/^((?:[a-zA-Z0-9+\-.]+:)?\/\/[^/?#]*)?([^?#]*\/)?/;function getLines(e){return e.split(/[\r\n]/).map((function(e){return e.trim()})).filter(Boolean)}function parseTag(e){var t=e.match(REGEXP_TAG);if(t&&t[1])return[t[1].replace("EXT-X-",""),t[2]]}function parseAttr(e){for(var t={},r=REGEXP_ATTR.exec(e);r;)t[r[1]]=r[2]||r[3],r=REGEXP_ATTR.exec(e);return t}function getAbsoluteUrl(e,t){if(!t||!e||REGEXP_ABSOLUTE_URL.test(e))return e;var r=REGEXP_URL_PAIR.exec(t);return r?"/"===e[0]?r[1]+e:r[1]+r[2]+e:e}var CODECS_REGEXP={audio:[/^mp4a/,/^vorbis$/,/^opus$/,/^flac$/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]};function getCodecs(e,t){var r=CODECS_REGEXP[e];if(r&&t&&t.length)for(var n=0;n<r.length;n++)for(var i=0;i<t.length;i++)if(r[n].test(t[i]))return t[i]}function parseMasterPlaylist(e,t){for(var r,n=new MasterPlaylist,i=0,a=[];r=e[i++];){var o=parseTag(r);if(o){var s=_slicedToArray(o,2),u=s[0],c=s[1];if("VERSION"===u)n.version=parseInt(c);else if("MEDIA"===u&&c){var l=parseAttr(c);if("AUDIO"===l.TYPE&&l.URI){var d=new AudioStream;d.url=getAbsoluteUrl(l.URI,t),d.default="YES"===l.DEFAULT,d.group=l["GROUP-ID"],d.name=l.NAME,d.lang=l.LANGUAGE,l.CHANNELS&&(d.channels=Number(l.CHANNELS.split("/")[0]),isNaN(d.channels)&&(d.channels=0)),a.push(d)}}else if("STREAM-INF"===u&&c){var h=new MasterStream,f=parseAttr(c);if(h.bitrate=parseInt(f["AVERAGE-BANDWIDTH"]||f.BANDWIDTH),h.name=f.NAME,h.url=getAbsoluteUrl(e[i++],t),f.RESOLUTION){var p=_slicedToArray(f.RESOLUTION.split("x"),2),g=p[0],y=p[1];h.width=parseInt(g),h.height=parseInt(y)}if(f.CODECS){var m=f.CODECS.split(/[ ,]+/).filter(Boolean);h.videoCodec=getCodecs("video",m),h.audioCodec=getCodecs("audio",m),h.textCodec=getCodecs("text",m)}h.audioGroup=f.AUDIO,n.streams.push(h)}}}return n.streams.forEach((function(e,t){e.id=t})),a.length&&(a.forEach((function(e,t){e.id=t})),n.streams.forEach((function(e){e.audioGroup&&(e.audioStreams=a.filter((function(t){return t.group===e.audioGroup})))}))),n}function parseMediaPlaylist(e,t){var r=new MediaPlaylist;r.url=t;for(var n,i=new MediaSegment,a=null,o=null,s=0,u=0,c=0,l=0;n=e[l++];)if("#"===n[0]){var d=parseTag(n);if(d){var h=_slicedToArray(d,2),f=h[0],p=h[1];switch(f){case"VERSION":r.version=parseInt(p);break;case"PLAYLIST-TYPE":r.type=null==p?void 0:p.toUpperCase();break;case"TARGETDURATION":r.targetDuration=parseFloat(p);break;case"ENDLIST":var g=r.segments[r.segments.length-1];g&&(g.isLast=!0),r.live=!1;break;case"MEDIA-SEQUENCE":u=r.startSN=parseInt(p);break;case"DISCONTINUITY-SEQUENCE":c=r.startCC=parseInt(p);break;case"DISCONTINUITY":c++;break;case"BYTERANGE":i.setByteRange(p,r.segments[r.segments.length-1]);break;case"EXTINF":var y=_slicedToArray(p.split(","),2),m=y[0],v=y[1];i.start=s,i.duration=parseFloat(m),s+=i.duration,i.title=v;break;case"KEY":var _=parseAttr(p);if("NONE"===_.METHOD){o=null;break}if("AES-128"!==_.METHOD)throw new Error("encrypt ".concat(_.METHOD,"/").concat(_.KEYFORMAT," is not supported"));if((o=new MediaSegmentKey).method=_.METHOD,o.url=/^blob:/.test(_.URI)?_.URI:getAbsoluteUrl(_.URI,t),o.keyFormat=_.KEYFORMAT||"identity",o.keyFormatVersions=_.KEYFORMATVERSIONS,_.IV){var b=_.IV.slice(2);b=(1&b.length?"0":"")+b,o.iv=new Uint8Array(b.length/2);for(var A=0,E=b.length/2;A<E;A++)o.iv[A]=parseInt(b.slice(2*A,2*A+2),16)}break;case"MAP":var S=parseAttr(p);i.url=getAbsoluteUrl(S.URI,t),S.BYTERANGE&&i.setByteRange(S.BYTERANGE),i.isInitSegment=!0,i.sn=0,o&&(i.key=o.clone(0)),a=i,i=new MediaSegment}}}else i.sn=u,i.cc=c,i.url=getAbsoluteUrl(n,t),o&&(i.key=o.clone(u)),a&&(i.initSegment=a),r.segments.push(i),i=new MediaSegment,u++;var T=r.segments[r.segments.length-1];return T&&(r.endSN=T.sn),r.totalDuration=s,r.endCC=c,r}var M3U8Parser=function(){function e(){_classCallCheck$3(this,e)}return _createClass$4(e,null,[{key:"parse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1?arguments[1]:void 0;if(!t.includes("#EXTM3U"))throw new Error("Invalid m3u8 file");var n=getLines(t);return e.isMediaPlaylist(t)?parseMediaPlaylist(n,r):parseMasterPlaylist(n,r)}},{key:"isMediaPlaylist",value:function(e){return e.includes("#EXTINF:")||e.includes("#EXT-X-TARGETDURATION:")}}]),e}(),ManifestLoader=function(){function e(t){var r=this;_classCallCheck$3(this,e),_defineProperty$4(this,"_onLoaderRetry",(function(e,t){r.hls.emit(Event$4.LOAD_RETRY,{error:StreamingError$1.network(e),retryTime:t})})),this.hls=t,this._timer=null;var n=this.hls.config,i=n.retryCount,a=n.retryDelay,o=n.loadTimeout,s=n.fetchOptions;this._loader=new NetLoader$3(_objectSpread2$3(_objectSpread2$3({},s),{},{responseType:"text",retry:i,retryDelay:a,timeout:o,onRetryError:this._onLoaderRetry})),this._audioLoader=new NetLoader$3(_objectSpread2$3(_objectSpread2$3({},s),{},{responseType:"text",retry:i,retryDelay:a,timeout:o,onRetryError:this._onLoaderRetry}))}var t;return _createClass$4(e,[{key:"load",value:(t=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(t,r){var n,i,a,o,s,u,c,l,d,h;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[this._loader.load(t)],r&&n.push(this._audioLoader.load(r)),e.prev=2,e.next=5,Promise.all(n);case 5:if(o=e.sent,s=_slicedToArray(o,2),u=s[0],c=s[1],u){e.next=11;break}return e.abrupt("return",[]);case 11:i=u.data,a=null==c?void 0:c.data,e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(2),StreamingError$1.network(e.t0);case 18:l=this.hls.config.onPreM3U8Parse,e.prev=19,l&&(i=l(i)||i,a&&(a=l(a,!0)||a)),d=M3U8Parser.parse(i,t),a&&(h=M3U8Parser.parse(a,r)),e.next=28;break;case 25:throw e.prev=25,e.t1=e.catch(19),new StreamingError$1(ERR$1.MANIFEST,ERR$1.SUB_TYPES.HLS);case 28:return d&&(d.isMaster?this.hls.emit(Event$4.HLS_MANIFEST_LOADED,{playlist:d}):this.hls.emit(Event$4.HLS_LEVEL_LOADED,{playlist:d})),e.abrupt("return",[d,h]);case 30:case"end":return e.stop()}}),e,this,[[2,15],[19,25]])}))),function(e,r){return t.apply(this,arguments)})},{key:"poll",value:function(e,t,r,n,i){var a=this;clearTimeout(this._timer),i=i||3e3;var o=function(){var s=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function s(){var u;return _regeneratorRuntime$2().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return clearTimeout(a._timer),s.prev=1,s.next=4,a.load(e,t);case 4:if((u=s.sent)[0]){s.next=7;break}return s.abrupt("return");case 7:r(u[0],u[1]),s.next=13;break;case 10:s.prev=10,s.t0=s.catch(1),n(s.t0);case 13:a._timer=setTimeout(o,i);case 14:case"end":return s.stop()}}),s,null,[[1,10]])})));return function(){return s.apply(this,arguments)}}();this._timer=setTimeout(o,i)}},{key:"stopPoll",value:function(){return clearTimeout(this._timer),this.cancel()}},{key:"cancel",value:function(){return Promise.all([this._loader.cancel(),this._audioLoader.cancel()])}}]),e}(),SegmentLoader=function(){function e(t){var r=this;_classCallCheck$3(this,e),_defineProperty$4(this,"_emitOnLoaded",(function(e,t){var n=e.endTime-e.startTime;r._bandwidthService.addRecord(e.contentLength||e.data.byteLength,n),r.hls.emit(EVENT$1.SPEED,{time:n,byteLength:e.contentLength,url:t}),r.hls.emit(EVENT$1.LOAD_COMPLETE,{url:t,elapsed:n||0});var i=e.response,a=e.firstByteTime,o=e.startTime;r.hls.emit(EVENT$1.TTFB,{url:t,responseUrl:i.url,elapsed:a-o}),r.hls.emit(EVENT$1.LOAD_RESPONSE_HEADERS,{headers:i.headers})})),_defineProperty$4(this,"_onLoaderRetry",(function(e,t){r.hls.emit(EVENT$1.LOAD_RETRY,{error:StreamingError$1.network(e),retryTime:t})})),this.hls=t,this._bandwidthService=new BandwidthService,this._mapCache={},this._keyCache={};var n=this.hls.config,i=n.retryCount,a=n.retryDelay,o=n.loadTimeout,s=n.fetchOptions;this._segmentLoader=new NetLoader$3(_objectSpread2$3(_objectSpread2$3({},s),{},{responseType:"arraybuffer",retry:i,retryDelay:a,timeout:o,onRetryError:this._onLoaderRetry})),this._audioSegmentLoader=new NetLoader$3(_objectSpread2$3(_objectSpread2$3({},s),{},{responseType:"arraybuffer",retry:i,retryDelay:a,timeout:o,onRetryError:this._onLoaderRetry})),this._keyLoader=new NetLoader$3(_objectSpread2$3(_objectSpread2$3({},s),{},{responseType:"arraybuffer",retry:i,retryDelay:a,timeout:o,onRetryError:this._onLoaderRetry}))}var t,r;return _createClass$4(e,[{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed()}}},{key:"load",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r,i=[];return e&&(i[0]=this.loadVideoSegment(e,r)),t&&(i[1]=this.loadAudioSegment(t,n)),Promise.all(i)}},{key:"loadVideoSegment",value:function(e,t){return this._loadSegment(this._segmentLoader,e,t)}},{key:"loadAudioSegment",value:function(e,t){return this._loadSegment(this._audioSegmentLoader,e,t)}},{key:"_loadSegment",value:(r=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(t,r,n){var i,a,o,s,u,c,l,d,h,f,p,g,y,m,v,_=this;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=[],this.hls.emit(EVENT$1.LOAD_START,{url:r.url}),d[0]=t.load(r.url),n&&r.initSegment&&(f=r.initSegment.url,(o=this._mapCache[f])||(this.hls.emit(EVENT$1.LOAD_START,{url:f}),d[1]=t.load(f).then((function(e){e&&(Object.keys(_._mapCache)>30&&(_._mapCache={}),o=_._mapCache[f]=e.data,_._emitOnLoaded(e,f))}))),(p=null===(h=r.initSegment.key)||void 0===h?void 0:h.url)&&(l=r.initSegment.key.iv,(c=this._keyCache[p])||(this.hls.emit(EVENT$1.LOAD_START,{url:p}),d[2]=this._keyLoader.load(p).then((function(e){e&&(c=_._keyCache[p]=e.data,_._emitOnLoaded(e,p))}))))),(g=null===(i=r.key)||void 0===i?void 0:i.url)&&(u=r.key.iv,(s=this._keyCache[g])||(this.hls.emit(EVENT$1.LOAD_START,{url:g}),d[3]=this._keyLoader.load(g).then((function(e){e&&(s=_._keyCache[g]=e.data,_._emitOnLoaded(e,g))})))),e.next=8,Promise.all(d);case 8:if(y=e.sent,m=_slicedToArray(y,1),v=m[0]){e.next=13;break}return e.abrupt("return");case 13:return a=v.data,this._emitOnLoaded(v,r.url),e.abrupt("return",{data:a,map:o,key:s,mapKey:c,keyIv:u,mapKeyIv:l});case 16:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"reset",value:function(){this._mapCache={},this._keyCache={},this._bandwidthService.reset()}},{key:"cancel",value:(t=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(){return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this._keyLoader.cancel(),this._segmentLoader.cancel(),this._audioSegmentLoader.cancel()]);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),logger$2=new Logger$8("hls"),Hls=function(e){_inherits$3(h,e);var t,r,n,i,a,o,s,u,c,l,d=_createSuper$p(h);function h(e){var t;return _classCallCheck$3(this,h),_defineProperty$4(_assertThisInitialized$3(t=d.call(this)),"version",h.version),_defineProperty$4(_assertThisInitialized$3(t),"media",null),_defineProperty$4(_assertThisInitialized$3(t),"config",null),_defineProperty$4(_assertThisInitialized$3(t),"_manifestLoader",null),_defineProperty$4(_assertThisInitialized$3(t),"_segmentLoader",null),_defineProperty$4(_assertThisInitialized$3(t),"_playlist",null),_defineProperty$4(_assertThisInitialized$3(t),"_bufferService",null),_defineProperty$4(_assertThisInitialized$3(t),"_gapService",null),_defineProperty$4(_assertThisInitialized$3(t),"_seiService",null),_defineProperty$4(_assertThisInitialized$3(t),"_prevSegSn",null),_defineProperty$4(_assertThisInitialized$3(t),"_prevSegCc",null),_defineProperty$4(_assertThisInitialized$3(t),"_tickTimer",null),_defineProperty$4(_assertThisInitialized$3(t),"_tickInterval",500),_defineProperty$4(_assertThisInitialized$3(t),"_segmentProcessing",!1),_defineProperty$4(_assertThisInitialized$3(t),"_reloadOnPlay",!1),_defineProperty$4(_assertThisInitialized$3(t),"_loadM3U8",function(){var e=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(r){var n,i,a,o;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=4,t._manifestLoader.load(r);case 4:i=e.sent,a=_slicedToArray(i,1),n=a[0],e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),t._emitError(StreamingError$1.create(e.t0));case 12:if(n){e.next=14;break}return e.abrupt("return");case 14:if(t._playlist.upsertPlaylist(n),!n.isMaster){e.next=18;break}return e.next=18,t._refreshM3U8();case 18:if(t.emit(Event$4.STREAM_PARSED),!t.isLive){e.next=24;break}t._bufferService.setLiveSeekableRange(0,4294967295),n.isMaster||t._pollM3U8(r),e.next=28;break;case 24:return e.next=26,t._bufferService.updateDuration(t._playlist.currentStream.totalDuration);case 26:(o=t.config.startTime)&&(t.media.currentTime=o,t._playlist.setNextSegmentByIndex(t._playlist.findSegmentIndexByTime(o)||0));case 28:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()),_defineProperty$4(_assertThisInitialized$3(t),"_loadSegment",_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(){var r,n;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t._segmentProcessing&&t.media){e.next=2;break}return e.abrupt("return");case 2:if(r=t.media.currentTime,n=t._playlist.currentSegment,t._playlist.nextSegment&&!(n&&n.end-r>=t.config.preloadTime)){e.next=7;break}return e.abrupt("return");case 7:return e.abrupt("return",t._loadSegmentDirect());case 8:case"end":return e.stop()}}),e)})))),_defineProperty$4(_assertThisInitialized$3(t),"_onPlay",_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(){return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(clearTimeout(t._disconnectTimer),!t._reloadOnPlay){e.next=6;break}t._reloadOnPlay=!1,t.replay(!0),e.next=9;break;case 6:return e.next=8,t._loadSegment();case 8:t._startTick();case 9:case"end":return e.stop()}}),e)})))),_defineProperty$4(_assertThisInitialized$3(t),"_onPause",(function(){if(t.isLive){if(!t._reloadOnPlay){var e=t.config.disconnectTime;if(null==e&&(e=t._playlist.dvrWindow),!isFinite(e))return;clearTimeout(t._disconnectTimer),t._disconnectTimer=setTimeout((function(){t._reloadOnPlay=!0,t._clear()}),e||0)}}else t._stopTick()})),_defineProperty$4(_assertThisInitialized$3(t),"_onSeeking",_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(){var r,n,i,a,o,s,u;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.media){e.next=2;break}return e.abrupt("return");case 2:if(r=t.media.currentTime,!(n=t._playlist.seekRange)){e.next=9;break}if(i=clamp(r,n[0]+.1,n[1]-.1),!(Math.abs(r-i)>=.1)){e.next=9;break}return t.media.currentTime=i,e.abrupt("return");case 9:if(!(a=t._playlist.currentSegment)){e.next=14;break}if(!((o=Buffer$2.info(Buffer$2.get(t.media),r,.1)).end&&o.end>=a.end)){e.next=14;break}return e.abrupt("return");case 14:if(s=t._playlist.findSegmentIndexByTime(r),u=t._playlist.getSegmentByIndex(s),null!=s&&u&&(!t._segmentProcessing||u!==t._playlist.nextSegment)){e.next=18;break}return e.abrupt("return");case 18:return logger$2.debug("seek to",r,u),t._playlist.setNextSegmentByIndex(s),t._stopTick(),e.next=23,t._segmentLoader.cancel();case 23:return e.next=25,t._loadSegmentDirect();case 25:t._startTick();case 26:case"end":return e.stop()}}),e)})))),_defineProperty$4(_assertThisInitialized$3(t),"_onTimeupdate",(function(){if(t.media){var e=t.config;if(e.isLive&&e.maxLatency&&e.targetLatency&&t.media){var r=t._playlist.liveEdge;if(!r)return;var n=r-t.media.currentTime;n>=e.maxLatency&&(logger$2.debug("latency jump",n),t.media.currentTime=r-e.targetLatency)}t._seiService.throw(t.media.currentTime)}})),_defineProperty$4(_assertThisInitialized$3(t),"_tick",(function(){if(t.media){t._startTick();var e=t.media;Buffer$2.end(Buffer$2.get(e))<.1||!e.readyState||(isMediaPlaying(e)?(t._loadSegment(),t._gapService&&t._gapService.do(e,t.config.maxJumpDistance,t.isLive)):e.readyState<2&&t._gapService&&t._gapService.do(e,t.config.maxJumpDistance,t.isLive))}})),t.config=e=getConfig$4(e),t.media=t.config.media,t._manifestLoader=new ManifestLoader(_assertThisInitialized$3(t)),t._segmentLoader=new SegmentLoader(_assertThisInitialized$3(t)),t._playlist=new Playlist(_assertThisInitialized$3(t)),t._bufferService=new BufferService(_assertThisInitialized$3(t)),t._seiService=new SeiService(_assertThisInitialized$3(t)),e.softDecode||(t._gapService=new GapService),t.media.addEventListener("play",t._onPlay),t.media.addEventListener("pause",t._onPause),t.media.addEventListener("seeking",t._onSeeking),t.media.addEventListener("timeupdate",t._onTimeupdate),t}return _createClass$4(h,[{key:"isLive",get:function(){return this._playlist.isLive}},{key:"streams",get:function(){return this._playlist.streams}},{key:"currentStream",get:function(){return this._playlist.currentStream}},{key:"baseDts",get:function(){var e;return null===(e=this._bufferService)||void 0===e?void 0:e.baseDts}},{key:"speedInfo",value:function(){return this._segmentLoader.speedInfo()}},{key:"bufferInfo",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1;return Buffer$2.info(Buffer$2.get(this.media),null===(e=this.media)||void 0===e?void 0:e.currentTime,t)}},{key:"playbackQuality",value:function(){return getVideoPlaybackQuality(this.media)}},{key:"load",value:(l=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(t){return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&(this.config.url=t),t=this.config.url,e.next=4,this._reset();case 4:if(t&&(t=t.trim()),t){e.next=7;break}throw this._emitError(new StreamingError$1(ERR$1.OTHER,ERR$1.SUB_TYPES.OPTION,null,null,"m3u8 url is missing"));case 7:return e.next=9,this._loadM3U8(t);case 9:return e.next=11,this._loadSegment();case 11:this._startTick();case 12:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"replay",value:(c=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(t){return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config.startTime=0,!this.config.softDecode){e.next=5;break}this.load(),e.next=7;break;case 5:return e.next=7,this.load();case 7:return this._reloadOnPlay=!1,e.abrupt("return",this.media.play(!t));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"switchURL",value:(u=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(t){var r,n,i=arguments;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:0,this.config.startTime=r,this.config.url=t,e.prev=3,!this.config.softDecode){e.next=8;break}e.t0=this.load(t),e.next=11;break;case 8:return e.next=10,this.load(t);case 10:e.t0=e.sent;case 11:n=e.t0,e.next=18;break;case 14:throw e.prev=14,e.t1=e.catch(3),this.emit(Event$4.SWITCH_URL_FAILED,e.t1),e.t1;case 18:return this._reloadOnPlay=!1,n&&this.emit(Event$4.SWITCH_URL_SUCCESS,{url:t}),e.abrupt("return",this.media.play(!0));case 21:case"end":return e.stop()}}),e,this,[[3,14]])}))),function(e){return u.apply(this,arguments)})},{key:"switchStream",value:(s=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(t){var r,n,i,a,o,s=arguments;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(s.length>1&&void 0!==s[1])||s[1],n=this.currentStream,i=this.streams,n&&n.id!==t&&i&&!(i.length<2)){e.next=5;break}return e.abrupt("return");case 5:if(a=i.find((function(e){return e.id===t}))){e.next=8;break}return e.abrupt("return");case 8:return e.prev=8,e.next=11,this._clear();case 11:if(!r){e.next=14;break}return e.next=14,this._bufferService.clearAllBuffer();case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(8),this._emitError(StreamingError$1.create(e.t0));case 19:if(n.currentAudioStream&&a.audioStreams.length>2&&(o=n.currentAudioStream.id,a.currentAudioStream=a.audioStreams.find((function(e){return e.id===o}))||a.currentAudioStream),this._playlist.currentStream=a,e.prev=21,!this.isLive&&a.segments.length){e.next=25;break}return e.next=25,this._refreshM3U8();case 25:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,e.next=29,this._loadSegmentDirect();case 29:e.next=35;break;case 31:throw e.prev=31,e.t1=e.catch(21),this._playlist.currentStream=n,e.t1;case 35:return this._startTick(),e.abrupt("return",a);case 37:case"end":return e.stop()}}),e,this,[[8,16],[21,31]])}))),function(e){return s.apply(this,arguments)})},{key:"switchAudioStream",value:(o=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(t){var r,n,i,a,o=arguments;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(o.length>1&&void 0!==o[1])||o[1],n=this.currentStream){e.next=4;break}return e.abrupt("return");case 4:if((i=n.currentAudioStream)&&i.id!==t&&!(n.audioStreams.length<2)){e.next=7;break}return e.abrupt("return");case 7:if(a=n.audioStreams.find((function(e){return e.id===t}))){e.next=10;break}return e.abrupt("return");case 10:return e.prev=10,e.next=13,this._clear();case 13:if(!r){e.next=16;break}return e.next=16,this._bufferService.clearAllBuffer();case 16:e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(10),this._emitError(StreamingError$1.create(e.t0));case 21:if(n.currentAudioStream=a,e.prev=22,!this.isLive&&a.segments.length){e.next=26;break}return e.next=26,this._refreshM3U8();case 26:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,e.next=30,this._loadSegmentDirect();case 30:e.next=36;break;case 32:throw e.prev=32,e.t1=e.catch(22),n.currentAudioStream=i,e.t1;case 36:return this._startTick(),e.abrupt("return",a);case 38:case"end":return e.stop()}}),e,this,[[10,18],[22,32]])}))),function(e){return o.apply(this,arguments)})},{key:"destroy",value:(a=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(){return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.media){e.next=2;break}return e.abrupt("return");case 2:return this.removeAllListeners(),this._playlist.reset(),this._segmentLoader.reset(),this._seiService.reset(),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("pause",this._onPause),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),e.next=12,Promise.all([this._clear(),this._bufferService.destroy()]);case 12:this.media=null;case 13:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"_refreshM3U8",value:function(){var e,t=this,r=this._playlist.currentStream;if(!r||!r.url)throw this._emitError(StreamingError$1.create(null,null,new Error("m3u8 url is not defined")));var n=r.url,i=null===(e=r.currentAudioStream)||void 0===e?void 0:e.url;return this._manifestLoader.load(n,i).then((function(e){var r=_slicedToArray(e,2),a=r[0],o=r[1];a&&(t._playlist.upsertPlaylist(a,o),t.isLive&&t._pollM3U8(n,i))})).catch((function(e){throw t._emitError(StreamingError$1.create(e))}))}},{key:"_pollM3U8",value:function(e,t){var r,n=this,i=this._playlist.isEmpty;this._manifestLoader.poll(e,t,(function(e,t){n._playlist.upsertPlaylist(e,t),e&&i&&!n._playlist.isEmpty&&n._loadSegment(),i&&(i=n._playlist.isEmpty)}),(function(e){n._emitError(StreamingError$1.create(e))}),1e3*((null===(r=this._playlist.lastSegment)||void 0===r?void 0:r.duration)||0))}},{key:"_loadSegmentDirect",value:(i=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(){var t,r;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._playlist.nextSegment){e.next=3;break}return e.abrupt("return");case 3:return r=!1,this._segmentProcessing=!0,e.prev=5,e.next=8,this._reqAndBufferSegment(t,this._playlist.getAudioSegment(t));case 8:r=e.sent,e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(5),this._emitError(StreamingError$1.create(e.t0));case 14:return e.prev=14,this._segmentProcessing=!1,e.finish(14);case 17:return r&&(this._playlist.moveSegmentPointer(),t.isLast?this._end():this._loadSegment()),e.abrupt("return",r);case 19:case"end":return e.stop()}}),e,this,[[5,11,14,17]])}))),function(){return i.apply(this,arguments)})},{key:"_reqAndBufferSegment",value:(n=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(t,r){var n,i,a,o,s,u,c,l;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t?t.cc:r.cc,a=this._prevSegCc!==i,e.next=4,this._segmentLoader.load(t,r,a);case 4:if((o=e.sent)[0]){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,(n=this._bufferService).decryptBuffer.apply(n,_toConsumableArray(o));case 9:if(s=e.sent){e.next=12;break}return e.abrupt("return");case 12:return u=t?t.sn:r.sn,c=t?t.start:r.start,l=this._playlist.currentStream,this._bufferService.createSource(s[0],s[1],null==l?void 0:l.videoCodec,null==l?void 0:l.audioCodec),e.next=18,this._bufferService.appendBuffer(s[0],s[1],a,this._prevSegSn===u-1,c);case 18:return e.next=20,this._bufferService.evictBuffer(this.config.bufferBehind);case 20:return this._prevSegCc=i,this._prevSegSn=u,e.abrupt("return",!0);case 23:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"_clear",value:(r=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(){return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._disconnectTimer),this._stopTick(),e.next=4,Promise.all([this._segmentLoader.cancel(),this._manifestLoader.stopPoll()]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_reset",value:(t=_asyncToGenerator$4(_regeneratorRuntime$2().mark((function e(){return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._reloadOnPlay=!1,this._prevSegSn=null,this._prevSegCc=null,this._playlist.reset(),this._segmentLoader.reset(),this._seiService.reset(),e.next=8,this._clear();case 8:return e.abrupt("return",this._bufferService.reset());case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_end",value:function(){this._clear(),this._bufferService.endOfStream()}},{key:"_stopTick",value:function(){clearTimeout(this._tickTimer)}},{key:"_startTick",value:function(){this._stopTick(),this._tickTimer=setTimeout(this._tick,this._tickInterval)}},{key:"_emitError",value:function(e){var t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return logger$2.table(e),logger$2.error(e),logger$2.error(null===(t=this.media)||void 0===t?void 0:t.error),this.emit(Event$4.ERROR,e),r&&this._end(),this._seiService.reset(),e}}],[{key:"isSupported",value:function(){return MSE$3.isSupported()||!!WebAssembly}},{key:"enableLogger",value:function(){Logger$8.enable(),Logger$6.enable()}},{key:"disableLogger",value:function(){Logger$8.disable(),Logger$6.disable()}}]),h}(EventEmitter$1);_defineProperty$4(Hls,"version","3.0.0-next.12-1");try{localStorage.getItem("xgd")?Hls.enableLogger():Hls.disableLogger()}catch(error){}var PluginExtension=function(){function e(t,r){var n=this;_classCallCheck$3(this,e),_defineProperty$4(this,"_opts",null),_defineProperty$4(this,"_plugin",null),_defineProperty$4(this,"_onLowDecode",(function(){var e,t,r,i,a=n._opts,o=a.media,s=a.innerDegrade;null===(e=n._plugin)||void 0===e||null===(t=e.player)||void 0===t||t.emit("lowdecode",o.degradeInfo),null===(r=n._plugin)||void 0===r||null===(i=r.player)||void 0===i||i.emit("core_event",_objectSpread2$3(_objectSpread2$3({},o.degradeInfo),{},{eventName:Event$4.LOWDECODE})),1===s&&n._degrade(o.src)})),_defineProperty$4(this,"_degrade",(function(e){var t=n._plugin.player,r=t.video;if(!r||"MVideo"===r.TAG){var i=t.video.degradeVideo;t.video=i,r.degrade(e),e&&(t.config.url=e);var a=t.root.firstChild;"MVideo"===a.TAG&&t.root.replaceChild(i,a);var o=n._plugin.constructor.pluginName.toLowerCase();t.unRegisterPlugin(o),t.once("canplay",(function(){t.play()}))}})),_defineProperty$4(this,"forceDegradeToVideo",(function(e){1===n._opts.innerDegrade&&n._degrade(e)})),this._opts=t,this._plugin=r,this._init()}return _createClass$4(e,[{key:"_init",value:function(){var e=this._opts,t=e.media,r=e.preloadTime,n=e.innerDegrade,i=e.isLive;t&&(i||!t.setPlayMode?(n&&t.setAttribute("innerdegrade",n),r&&t.setAttribute("preloadtime",r),this._bindEvents()):t.setPlayMode("VOD"))}},{key:"_bindEvents",value:function(){this._opts.media.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var e,t;null===(e=this._opts)||void 0===e||null===(t=e.media)||void 0===t||t.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),e}(),Stats=function(){function e(){_classCallCheck$3(this,e),_defineProperty$4(this,"encodeType",""),_defineProperty$4(this,"audioCodec",""),_defineProperty$4(this,"videoCodec",""),_defineProperty$4(this,"domain",""),_defineProperty$4(this,"fps",0),_defineProperty$4(this,"bitrate",0),_defineProperty$4(this,"width",0),_defineProperty$4(this,"height",0),_defineProperty$4(this,"samplerate",0),_defineProperty$4(this,"channelCount",0),_defineProperty$4(this,"gop",0),_defineProperty$4(this,"_bitsAccumulateSize",0),_defineProperty$4(this,"_bitsAccumulateDuration",0)}return _createClass$4(e,[{key:"getStats",value:function(){return{encodeType:this.encodeType,audioCodec:this.audioCodec,videoCodec:this.videoCodec,domain:this.domain,fps:this.fps,bitrate:this.bitrate,width:this.width,height:this.height,samplerate:this.samplerate,channelCount:this.channelCount,gop:this.gop}}},{key:"setEncodeType",value:function(e){this.encodeType=e}},{key:"setVideoMeta",value:function(e){this.width=e.width,this.height=e.height,this.videoCodec=e.codec,this.encodeType=e.codecType,e.fpsNum&&e.fpsDen&&(this.fps=e.fpsNum/e.fpsDen)}},{key:"setAudioMeta",value:function(e){this.audioCodec=e.codec,this.samplerate=e.sampleRate,this.channelCount=e.channelCount}},{key:"setDomain",value:function(e){this.domain=e.split("/").slice(2,3)[0]}},{key:"updateBitrate",value:function(e){var t=this;if(!this.fps||this.fps>=100){var r=e[0];null!=r&&r.duration&&(this.fps=Math.round(9e4/r.duration))}e.forEach((function(e){1===e.gopId&&t.gop++,t._bitsAccumulateDuration+=e.duration/90,t._bitsAccumulateSize+=e.units.reduce((function(e,t){return e+t.length}),0),t._bitsAccumulateDuration>=1e3&&(t.bitrate=8*t._bitsAccumulateSize,t._bitsAccumulateDuration=0,t._bitsAccumulateSize=0)}))}}]),e}(),MediaStats=function(){function e(t){_classCallCheck$3(this,e),_defineProperty$4(this,"_plugin",void 0),_defineProperty$4(this,"_samples",[]),_defineProperty$4(this,"_bitrateCalcDuration",0),_defineProperty$4(this,"_stats",new Stats),this._plugin=t,this._bindEvents()}return _createClass$4(e,[{key:"getStats",value:function(){var e,t,r,n,i,a,o=(null===(e=this._plugin.player)||void 0===e?void 0:e.video)||{},s=o.currentTime,u=void 0===s?0:s,c=o.decodeFps,l=void 0===c?0:c;return _objectSpread2$3(_objectSpread2$3({},this._stats.getStats()),{},{downloadSpeed:null===(t=this._plugin.core)||void 0===t||null===(r=t.speedInfo)||void 0===r?void 0:r.call(t).speed,avgSpeed:null===(n=this._plugin.core)||void 0===n||null===(i=n.speedInfo)||void 0===i?void 0:i.call(n).avgSpeed,currentTime:u,bufferEnd:(null===(a=this._plugin.player)||void 0===a?void 0:a.getBufferedRange()[1])-u,decodeFps:l})}},{key:"_bindEvents",value:function(){var e,t=this;this._onceLoadStart(),null===(e=this._plugin.player)||void 0===e||e.on("core_event",(function(e){e.eventName===EVENT$1.METADATA_PARSED&&("video"===e.type?t._stats.setVideoMeta(e.track):t._stats.setAudioMeta(e.track)),e.eventName===EVENT$1.TTFB&&t._stats.setDomain(e.responseUrl)}))}},{key:"_onceLoadStart",value:function(){var e,t=this;null===(e=this._plugin.player)||void 0===e||e.on("core_event",(function e(r){r.eventName===EVENT$1.LOAD_START&&(t._plugin.player.off("core_event",e),t._plugin.core.on(Event$4.DEMUXED_TRACK,(function(e){return t._stats.updateBitrate(e.samples)})))}))}}]),e}(),HlsPlugin=function(e){_inherits$3(r,e);var t=_createSuper$p(r);function r(){var e;_classCallCheck$3(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$4(_assertThisInitialized$3(e=t.call.apply(t,[this].concat(i))),"hls",null),_defineProperty$4(_assertThisInitialized$3(e),"pluginExtension",null),_defineProperty$4(_assertThisInitialized$3(e),"_stats",new MediaStats(_assertThisInitialized$3(e))),_defineProperty$4(_assertThisInitialized$3(e),"getStats",(function(){return e._stats.getStats()})),_defineProperty$4(_assertThisInitialized$3(e),"destroy",(function(){var t;e.hls&&(e.hls.destroy(),e.hls=null),null===(t=e.pluginExtension)||void 0===t||t.destroy(),e.pluginExtension=null})),_defineProperty$4(_assertThisInitialized$3(e),"_onSwitchURL",(function(t){e.hls&&(e.player.config.url=t,e.hls.switchURL(t).catch((function(e){})))})),_defineProperty$4(_assertThisInitialized$3(e),"_onDefinitionChange",(function(t){var r=t.to;e.hls&&e.hls.switchURL(r).catch((function(e){}))})),e}return _createClass$4(r,[{key:"core",get:function(){return this.hls}},{key:"version",get:function(){var e;return null===(e=this.hls)||void 0===e?void 0:e.version}},{key:"softDecode",get:function(){var e,t,r=null===(e=this.player)||void 0===e||null===(t=e.config)||void 0===t?void 0:t.mediaType;return!!r&&"video"!==r}},{key:"beforePlayerInit",value:function(){var e,t=this,r=new Promise((function(t,r){e=t})),n=this.player.config;this.hls&&this.hls.destroy(),this.player.switchURL=this._onSwitchURL;var i,a=n.hls||{};(a.innerDegrade=a.innerDegrade||n.innerDegrade,null==a.disconnectTime&&(a.disconnectTime=0),this.hls=new Hls(_objectSpread2$3({softDecode:this.softDecode,isLive:n.isLive,media:this.player.video,startTime:n.startTime,url:n.url},a)),this.softDecode?e(!0):(BasePlugin.defineGetterOrSetter(this.player,{url:{get:function(){var e,r;return null===(e=t.hls)||void 0===e||null===(r=e.media)||void 0===r?void 0:r.src},configurable:!0}}),this.hls.on("sourceAttached",(function(){e(!0)}))),this.softDecode&&(this.pluginExtension=new PluginExtension(_objectSpread2$3({isLive:n.isLive,media:this.player.video},a),this),this.player.forceDegradeToVideo=function(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return null===(e=t.pluginExtension)||void 0===e?void 0:e.forceDegradeToVideo.apply(e,n)}),n.isLive)&&(null===(i=this.player)||void 0===i||i.useHooks("replay",(function(){var e;return null===(e=t.hls)||void 0===e?void 0:e.replay()})));return this.on(URL_CHANGE,this._onSwitchURL),this.on(DESTROY,this.destroy),this._transError(),this._transCoreEvent(EVENT$1.TTFB),this._transCoreEvent(EVENT$1.LOAD_START),this._transCoreEvent(EVENT$1.LOAD_RESPONSE_HEADERS),this._transCoreEvent(EVENT$1.LOAD_COMPLETE),this._transCoreEvent(EVENT$1.LOAD_RETRY),this._transCoreEvent(EVENT$1.SOURCEBUFFER_CREATED),this._transCoreEvent(EVENT$1.REMOVE_BUFFER),this._transCoreEvent(EVENT$1.BUFFEREOS),this._transCoreEvent(EVENT$1.KEYFRAME),this._transCoreEvent(EVENT$1.METADATA_PARSED),this._transCoreEvent(EVENT$1.SEI),this._transCoreEvent(EVENT$1.SEI_IN_TIME),this._transCoreEvent(EVENT$1.SPEED),this._transCoreEvent(EVENT$1.HLS_MANIFEST_LOADED),this._transCoreEvent(Event$4.STREAM_PARSED),this._transCoreEvent(Event$4.NO_AUDIO_TRACK),this._transCoreEvent(EVENT$1.HLS_LEVEL_LOADED),this._transCoreEvent(EVENT$1.STREAM_EXCEPTION),this._transCoreEvent(EVENT$1.SWITCH_URL_SUCCESS),this._transCoreEvent(EVENT$1.SWITCH_URL_FAILED),n.url&&this.hls.load(n.url).catch((function(e){})),r}},{key:"_transError",value:function(){var e=this;this.hls.on(Event$4.ERROR,(function(t){e.player&&e.player.emit(ERROR$3,new Errors$1(e.player,t))}))}},{key:"_transCoreEvent",value:function(e){var t=this;this.hls.on(e,(function(r){t.player&&t.player.emit("core_event",_objectSpread2$3(_objectSpread2$3({},r),{},{eventName:e}))}))}}],[{key:"pluginName",get:function(){return"hls"}},{key:"isSupported",value:function(e){return Hls.isSupported(e)}}]),r}(BasePlugin);_defineProperty$4(HlsPlugin,"Hls",Hls),_defineProperty$4(HlsPlugin,"EVENT",Event$4);var shakaPlayer_compiled={},exports2;exports2=shakaPlayer_compiled,function(){var t="undefined"!=typeof window?window:commonjsGlobal,r={};for(var n in function(t,r,n){var i,a="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){e!=Array.prototype&&e!=Object.prototype&&(e[t]=r.value)},o=void 0!==t&&t===this?this:void 0!==r&&null!=r?r:this;function s(){s=function(){},o.Symbol||(o.Symbol=c)}var u,c=(u=0,function(e){return"jscomp_symbol_"+(e||"")+u++});function l(){s();var e=o.Symbol.iterator;e||(e=o.Symbol.iterator=o.Symbol("iterator")),"function"!=typeof Array.prototype[e]&&a(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return d(this)}}),l=function(){}}function d(e){var t=0;return h((function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}))}function h(e){return l(),(e={next:e})[o.Symbol.iterator]=function(){return this},e}function f(e){l();var t=e[Symbol.iterator];return t?t.call(e):d(e)}function p(e,t){if(t){for(var r=o,n=e.split("."),i=0;i<n.length-1;i++){var s=n[i];s in r||(r[s]={}),r=r[s]}(s=t(i=r[n=n[n.length-1]]))!=i&&null!=s&&a(r,n,{configurable:!0,writable:!0,value:s})}}function g(e){return function(e){function t(t){return e.next(t)}function r(t){return e.throw(t)}return new Promise((function(n,i){!function e(a){a.done?n(a.value):Promise.resolve(a.value).then(t,r).then(e,i)}(e.next())}))}(e())}p("Promise",(function(e){function t(e){this.h=0,this.l=void 0,this.g=[];var t=this.i();try{e(t.resolve,t.reject)}catch(r){t.reject(r)}}function r(){this.g=null}function n(e){return e instanceof t?e:new t((function(t){t(e)}))}if(e)return e;r.prototype.h=function(e){null==this.g&&(this.g=[],this.j()),this.g.push(e)},r.prototype.j=function(){var e=this;this.i((function(){e.m()}))};var i=o.setTimeout;r.prototype.i=function(e){i(e,0)},r.prototype.m=function(){for(;this.g&&this.g.length;){var e=this.g;this.g=[];for(var t=0;t<e.length;++t){var r=e[t];e[t]=null;try{r()}catch(n){this.l(n)}}}this.g=null},r.prototype.l=function(e){this.i((function(){throw e}))},t.prototype.i=function(){function e(e){return function(n){r||(r=!0,e.call(t,n))}}var t=this,r=!1;return{resolve:e(this.C),reject:e(this.j)}},t.prototype.C=function(e){if(e===this)this.j(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof t)this.F(e);else{e:switch(_typeof$7(e)){case"object":var r=null!=e;break e;case"function":r=!0;break e;default:r=!1}r?this.A(e):this.m(e)}},t.prototype.A=function(e){var t=void 0;try{t=e.then}catch(r){return void this.j(r)}"function"==typeof t?this.J(t,e):this.m(e)},t.prototype.j=function(e){this.o(2,e)},t.prototype.m=function(e){this.o(1,e)},t.prototype.o=function(e,t){if(0!=this.h)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.h);this.h=e,this.l=t,this.u()},t.prototype.u=function(){if(null!=this.g){for(var e=0;e<this.g.length;++e)a.h(this.g[e]);this.g=null}};var a=new r;return t.prototype.F=function(e){var t=this.i();e.nc(t.resolve,t.reject)},t.prototype.J=function(e,t){var r=this.i();try{e.call(t,r.resolve,r.reject)}catch(n){r.reject(n)}},t.prototype.then=function(e,r){function n(e,t){return"function"==typeof e?function(t){try{i(e(t))}catch(r){a(r)}}:t}var i,a,o=new t((function(e,t){i=e,a=t}));return this.nc(n(e,i),n(r,a)),o},t.prototype.catch=function(e){return this.then(void 0,e)},t.prototype.nc=function(e,t){function r(){switch(n.h){case 1:e(n.l);break;case 2:t(n.l);break;default:throw Error("Unexpected state: "+n.h)}}var n=this;null==this.g?a.h(r):this.g.push(r)},t.resolve=n,t.reject=function(e){return new t((function(t,r){r(e)}))},t.race=function(e){return new t((function(t,r){for(var i=f(e),a=i.next();!a.done;a=i.next())n(a.value).nc(t,r)}))},t.all=function(e){var r=f(e),i=r.next();return i.done?n([]):new t((function(e,t){function a(t){return function(r){o[t]=r,0==--s&&e(o)}}var o=[],s=0;do{o.push(void 0),s++,n(i.value).nc(a(o.length-1),t),i=r.next()}while(!i.done)}))},t})),p("Promise.prototype.finally",(function(e){return e||function(e){return this.then((function(t){return Promise.resolve(e()).then((function(){return t}))}),(function(t){return Promise.resolve(e()).then((function(){throw t}))}))}}));var y,m="function"==typeof Object.create?Object.create:function(e){function t(){}return t.prototype=e,new t};if("function"==typeof Object.setPrototypeOf)y=Object.setPrototypeOf;else{var v;e:{var _={};try{_.__proto__={a:!0},v=_.a;break e}catch(u){}v=!1}y=v?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var b=y;function A(e,t){if(e.prototype=m(t.prototype),e.prototype.constructor=e,b)b(e,t);else for(var r in t)if("prototype"!=r)if(Object.defineProperties){var n=Object.getOwnPropertyDescriptor(t,r);n&&Object.defineProperty(e,r,n)}else e[r]=t[r];e.Lg=t.prototype}function E(){this.l=!1,this.i=null,this.B=void 0,this.s=1,this.h=this.j=0,this.o=this.g=null}function S(e){if(e.l)throw new TypeError("Generator is already running");e.l=!0}function T(e,t){e.g={ce:t,ne:!0},e.s=e.j||e.h}function w(e,t,r){return e.s=r,{value:t}}function C(e){e.s=0}function k(e,t,r){e.j=t,null!=r&&(e.h=r)}function I(e,t){e.j=0,e.h=t||0}function $(e,t){e.s=t,e.j=0}function P(e){e.j=0;var t=e.g.ce;return e.g=null,t}function x(e){e.o=[e.g],e.j=0,e.h=0}function R(e,t){var r=e.o.splice(0)[0];(r=e.g=e.g||r)?r.ne?e.s=e.j||e.h:null!=r.I&&e.h<r.I?(e.s=r.I,e.g=null):e.s=e.h:e.s=t}function O(e){this.g=new E,this.h=e}function D(e,t,r,n){try{var i=t.call(e.g.i,r);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.l=!1,i;var a=i.value}catch(o){return e.g.i=null,T(e.g,o),L(e)}return e.g.i=null,n.call(e.g,a),L(e)}function L(e){for(;e.g.s;)try{var t=e.h(e.g);if(t)return e.g.l=!1,{value:t.value,done:!1}}catch(r){e.g.B=void 0,T(e.g,r)}if(e.g.l=!1,e.g.g){if(t=e.g.g,e.g.g=null,t.ne)throw t.ce;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function M(e){this.next=function(t){return S(e.g),e.g.i?t=D(e,e.g.i.next,t,e.g.m):(e.g.m(t),t=L(e)),t},this.throw=function(t){return S(e.g),e.g.i?t=D(e,e.g.i.throw,t,e.g.m):(T(e.g,t),t=L(e)),t},this.return=function(t){return function(e,t){S(e.g);var r=e.g.i;return r?D(e,"return"in r?r.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),L(e))}(e,t)},l(),this[Symbol.iterator]=function(){return this}}function N(e,t){return M.prototype=e.prototype,new M(new O(t))}function B(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function U(e,t,r){e instanceof String&&(e=String(e));for(var n=e.length,i=0;i<n;i++){var a=e[i];if(t.call(r,a,i,e))return{le:i,Qe:a}}return{le:-1,Qe:void 0}}function G(e,t,r){if(null==e)throw new TypeError("The 'this' value for String.prototype."+r+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+r+" must not be a regular expression");return e+""}E.prototype.m=function(e){this.B=e},E.prototype.return=function(e){this.g={return:e},this.s=this.h},E.prototype.I=function(e){this.s=e},p("Array.prototype.keys",(function(e){return e||function(){return function(e,t){l(),e instanceof String&&(e+="");var r=0,n={next:function(){if(r<e.length){var i=r++;return{value:t(i,e[i]),done:!1}}return n.next=function(){return{done:!0,value:void 0}},n.next()}};return n[Symbol.iterator]=function(){return n},n}(this,(function(e){return e}))}})),p("WeakMap",(function(e){function t(e){if(this.g=(o+=Math.random()+1).toString(),e){s(),l(),e=f(e);for(var t;!(t=e.next()).done;)t=t.value,this.set(t[0],t[1])}}function r(e){B(e,i)||a(e,i,{value:{}})}function n(e){var t=Object[e];t&&(Object[e]=function(e){return r(e),t(e)})}if(function(){if(!e||!Object.seal)return!1;try{var t=Object.seal({}),r=Object.seal({}),n=new e([[t,2],[r,3]]);return 2==n.get(t)&&3==n.get(r)&&(n.delete(t),n.set(r,4),!n.has(t)&&4==n.get(r))}catch(i){return!1}}())return e;var i="$jscomp_hidden_"+Math.random();n("freeze"),n("preventExtensions"),n("seal");var o=0;return t.prototype.set=function(e,t){if(r(e),!B(e,i))throw Error("WeakMap key fail: "+e);return e[i][this.g]=t,this},t.prototype.get=function(e){return B(e,i)?e[i][this.g]:void 0},t.prototype.has=function(e){return B(e,i)&&B(e[i],this.g)},t.prototype.delete=function(e){return!(!B(e,i)||!B(e[i],this.g))&&delete e[i][this.g]},t})),p("Map",(function(e){function t(){var e={};return e.Na=e.next=e.head=e}function r(e,t){var r=e.g;return h((function(){if(r){for(;r.head!=e.g;)r=r.Na;for(;r.next!=r.head;)return r=r.next,{done:!1,value:t(r)};r=null}return{done:!0,value:void 0}}))}function n(e,t){var r=t&&_typeof$7(t);"object"==r||"function"==r?a.has(t)?r=a.get(t):(r=""+ ++o,a.set(t,r)):r="p_"+t;var n=e.h[r];if(n&&B(e.h,r))for(var i=0;i<n.length;i++){var s=n[i];if(t!=t&&s.key!=s.key||t===s.key)return{id:r,list:n,index:i,ga:s}}return{id:r,list:n,index:-1,ga:void 0}}function i(e){if(this.h={},this.g=t(),this.size=0,e){e=f(e);for(var r;!(r=e.next()).done;)r=r.value,this.set(r[0],r[1])}}if(function(){if(!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),r=new e(f([[t,"s"]]));if("s"!=r.get(t)||1!=r.size||r.get({x:4})||r.set({x:4},"t")!=r||2!=r.size)return!1;var n=r.entries(),i=n.next();return!i.done&&i.value[0]==t&&"s"==i.value[1]&&!((i=n.next()).done||4!=i.value[0].x||"t"!=i.value[1]||!n.next().done)}catch(a){return!1}}())return e;s(),l();var a=new WeakMap;i.prototype.set=function(e,t){var r=n(this,e);return r.list||(r.list=this.h[r.id]=[]),r.ga?r.ga.value=t:(r.ga={next:this.g,Na:this.g.Na,head:this.g,key:e,value:t},r.list.push(r.ga),this.g.Na.next=r.ga,this.g.Na=r.ga,this.size++),this},i.prototype.delete=function(e){return!(!(e=n(this,e)).ga||!e.list||(e.list.splice(e.index,1),e.list.length||delete this.h[e.id],e.ga.Na.next=e.ga.next,e.ga.next.Na=e.ga.Na,e.ga.head=null,this.size--,0))},i.prototype.clear=function(){this.h={},this.g=this.g.Na=t(),this.size=0},i.prototype.has=function(e){return!!n(this,e).ga},i.prototype.get=function(e){return(e=n(this,e).ga)&&e.value},i.prototype.entries=function(){return r(this,(function(e){return[e.key,e.value]}))},i.prototype.keys=function(){return r(this,(function(e){return e.key}))},i.prototype.values=function(){return r(this,(function(e){return e.value}))},i.prototype.forEach=function(e,t){for(var r,n=this.entries();!(r=n.next()).done;)r=r.value,e.call(t,r[1],r[0],this)},i.prototype[Symbol.iterator]=i.prototype.entries;var o=0;return i})),p("Set",(function(e){function t(e){if(this.g=new Map,e){e=f(e);for(var t;!(t=e.next()).done;)this.add(t.value)}this.size=this.g.size}return function(){if(!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),r=new e(f([t]));if(!r.has(t)||1!=r.size||r.add(t)!=r||1!=r.size||r.add({x:4})!=r||2!=r.size)return!1;var n=r.entries(),i=n.next();return!i.done&&i.value[0]==t&&i.value[1]==t&&!(i=n.next()).done&&i.value[0]!=t&&4==i.value[0].x&&i.value[1]==i.value[0]&&n.next().done}catch(a){return!1}}()?e:(s(),l(),t.prototype.add=function(e){return this.g.set(e,e),this.size=this.g.size,this},t.prototype.delete=function(e){return e=this.g.delete(e),this.size=this.g.size,e},t.prototype.clear=function(){this.g.clear(),this.size=0},t.prototype.has=function(e){return this.g.has(e)},t.prototype.entries=function(){return this.g.entries()},t.prototype.values=function(){return this.g.values()},t.prototype.keys=t.prototype.values,t.prototype[Symbol.iterator]=t.prototype.values,t.prototype.forEach=function(e,t){var r=this;this.g.forEach((function(n){return e.call(t,n,n,r)}))},t)})),p("Array.prototype.findIndex",(function(e){return e||function(e,t){return U(this,e,t).le}})),p("Array.prototype.find",(function(e){return e||function(e,t){return U(this,e,t).Qe}})),p("String.prototype.startsWith",(function(e){return e||function(e,t){for(var r=G(this,e,"startsWith"),n=r.length,i=e.length,a=Math.max(0,Math.min(0|t,r.length)),o=0;o<i&&a<n;)if(r[a++]!=e[o++])return!1;return o>=i}})),p("Object.is",(function(e){return e||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}})),p("Array.prototype.includes",(function(e){return e||function(e,t){var r=this;r instanceof String&&(r=String(r));var n=r.length,i=t||0;for(0>i&&(i=Math.max(i+n,0));i<n;i++){var a=r[i];if(a===e||Object.is(a,e))return!0}return!1}})),p("String.prototype.includes",(function(e){return e||function(e,t){return-1!==G(this,e,"includes").indexOf(e,t||0)}})),p("Array.from",(function(e){return e||function(e,t,r){l(),t=null!=t?t:function(e){return e};var n=[],i=e[Symbol.iterator];if("function"==typeof i)for(e=i.call(e);!(i=e.next()).done;)n.push(t.call(r,i.value));else{i=e.length;for(var a=0;a<i;a++)n.push(t.call(r,e[a]))}return n}}));var V="function"==typeof Object.assign?Object.assign:function(e,t){for(var r=1;r<arguments.length;r++){var n=arguments[r];if(n)for(var i in n)B(n,i)&&(e[i]=n[i])}return e};p("Object.assign",(function(e){return e||V}));var F=this;function j(e,t){var r,n=e.split("."),i=F;n[0]in i||!i.execScript||i.execScript("var "+n[0]);for(;n.length&&(r=n.shift());)n.length||void 0===t?i=i[r]?i[r]:i[r]={}:i[r]=t}function H(e,t){function r(){}r.prototype=t.prototype,e.Lg=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Wg=function(e,r,n){return t.prototype[r].apply(e,Array.prototype.slice.call(arguments,2))}}function Z(e){this.i=Math.exp(Math.log(.5)/e),this.h=this.g=0}function W(e,t,r){var n=Math.pow(e.i,t);r=r*(1-n)+n*e.g,isNaN(r)||(e.g=r,e.h+=t)}function K(e){return e.g/(1-Math.pow(e.i,e.h))}function X(){this.h=new Z(2),this.i=new Z(5),this.g=0}F.g=!0,X.prototype.getBandwidthEstimate=function(e){return 128e3>this.g?e:Math.min(K(this.h),K(this.i))};var Y={sb:0,kc:function(){},ba:function(){},error:function(){},v:function(){},info:function(){},debug:function(){},K:function(){},O:function(){}};function z(e,t,r,n){for(var i=[],a=3;a<arguments.length;++a)i[a-3]=arguments[a];this.severity=e,this.category=t,this.code=r,this.data=i,this.handled=!1}t.console&&t.console.log.bind&&(Y.ba=console.warn.bind(console),Y.kc=console.error.bind(console),1<=Y.sb&&(Y.error=console.error.bind(console)),2<=Y.sb&&(Y.v=console.warn.bind(console)),3<=Y.sb&&(Y.info=console.info.bind(console)),4<=Y.sb&&(Y.debug=console.log.bind(console)),5<=Y.sb&&(Y.K=console.debug.bind(console)),6<=Y.sb&&(Y.O=console.debug.bind(console))),j("shaka.util.Error",z),z.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")},z.Severity={RECOVERABLE:1,CRITICAL:2},z.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9},z.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,UNPLAYABLE_PERIOD:4011,RESTRICTIONS_CANNOT_BE_MET:4012,NO_PERIODS:4014,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_MASTER_PLAYLIST_NOT_PROVIDED:4022,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,HLS_COULD_NOT_PARSE_SEGMENT_START_TIME:4030,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,HLS_AES_128_ENCRYPTION_NOT_SUPPORTED:4034,HLS_INTERNAL_SKIP_STREAM:4035,INVALID_STREAMS_CHOSEN:5005,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,SERVER_CERTIFICATE_REQUIRED:6015,INIT_DATA_TRANSFORM_ERROR:6016,LOAD_INTERRUPTED:7e3,OPERATION_ABORTED:7001,NO_VIDEO_ELEMENT:7002,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,STORAGE_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,STORE_ALREADY_IN_PROGRESS:9006,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013};var J=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function Q(e){var t;e instanceof Q?(q(this,e.Ba),this.pb=e.pb,this.Aa=e.Aa,ee(this,e.Ob),this.pa=e.pa,te(this,e.g.clone()),this.bb=e.bb):e&&(t=String(e).match(J))?(q(this,t[1]||"",!0),this.pb=re(t[2]||""),this.Aa=re(t[3]||"",!0),ee(this,t[4]),this.pa=re(t[5]||"",!0),te(this,t[6]||"",!0),this.bb=re(t[7]||"")):this.g=new le(null)}function q(e,t,r){e.Ba=r?re(t,!0):t,e.Ba&&(e.Ba=e.Ba.replace(/:$/,""))}function ee(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.Ob=t}else e.Ob=null}function te(e,t,r){t instanceof le?e.g=t:(r||(t=ne(t,ue)),e.g=new le(t))}function re(e,t){return e?t?decodeURI(e):decodeURIComponent(e):""}function ne(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,ie),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ie(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}(i=Q.prototype).Ba="",i.pb="",i.Aa="",i.Ob=null,i.pa="",i.bb="",i.toString=function(){var e=[],t=this.Ba;if(t&&e.push(ne(t,ae,!0),":"),t=this.Aa){e.push("//");var r=this.pb;r&&e.push(ne(r,ae,!0),"@"),e.push(encodeURIComponent(t).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.Ob)&&e.push(":",String(t))}return(t=this.pa)&&(this.Aa&&"/"!=t.charAt(0)&&e.push("/"),e.push(ne(t,"/"==t.charAt(0)?se:oe,!0))),(t=this.g.toString())&&e.push("?",t),(t=this.bb)&&e.push("#",ne(t,ce)),e.join("")},i.resolve=function(e){var t=this.clone();"data"===t.Ba&&(t=new Q);var r=!!e.Ba;r?q(t,e.Ba):r=!!e.pb,r?t.pb=e.pb:r=!!e.Aa,r?t.Aa=e.Aa:r=null!=e.Ob;var n=e.pa;if(r)ee(t,e.Ob);else if(r=!!e.pa){if("/"!=n.charAt(0))if(this.Aa&&!this.pa)n="/"+n;else{var i=t.pa.lastIndexOf("/");-1!=i&&(n=t.pa.substr(0,i+1)+n)}if(".."==n||"."==n)n="";else if(-1!=n.indexOf("./")||-1!=n.indexOf("/.")){i=0==n.lastIndexOf("/",0),n=n.split("/");for(var a=[],o=0;o<n.length;){var s=n[o++];"."==s?i&&o==n.length&&a.push(""):".."==s?((1<a.length||1==a.length&&""!=a[0])&&a.pop(),i&&o==n.length&&a.push("")):(a.push(s),i=!0)}n=a.join("/")}}return r?t.pa=n:r=""!==e.g.toString(),r?te(t,e.g.clone()):r=!!e.bb,r&&(t.bb=e.bb),t},i.clone=function(){return new Q(this)};var ae=/[#\/\?@]/g,oe=/[#\?:]/g,se=/[#\?]/g,ue=/[#\?@]/g,ce=/#/g;function le(e){this.g=e||null}(i=le.prototype).na=null,i.qc=null,i.add=function(e,t){if(!this.na&&(this.na={},this.qc=0,this.g))for(var r=this.g.split("&"),n=0;n<r.length;n++){var i=r[n].indexOf("="),a=null;if(0<=i){var o=r[n].substring(0,i);a=r[n].substring(i+1)}else o=r[n];o=decodeURIComponent(o.replace(/\+/g," ")),a=a||"",this.add(o,decodeURIComponent(a.replace(/\+/g," ")))}return this.g=null,(r=this.na.hasOwnProperty(e)&&this.na[e])||(this.na[e]=r=[]),r.push(t),this.qc++,this},i.toString=function(){if(this.g)return this.g;if(!this.na)return"";var e,t=[];for(e in this.na)for(var r=encodeURIComponent(e),n=this.na[e],i=0;i<n.length;i++){var a=r;""!==n[i]&&(a+="="+encodeURIComponent(n[i])),t.push(a)}return this.g=t.join("&")},i.clone=function(){var e=new le;if(e.g=this.g,this.na){var t,r={};for(t in this.na)r[t]=this.na[t].concat();e.na=r,e.qc=this.qc}return e};var de={df:function(e,t){return e.reduce(function(e,t,r){return t.catch(e.bind(null,r))}.bind(null,t),Promise.reject())},Rc:function(e,t){return e.concat(t)},Bc:function(){},Ra:function(e){return null!=e}};function he(e,t){if(0==t.length)return e;var r=t.map((function(e){return new Q(e)}));return e.map((function(e){return new Q(e)})).map((function(e){return r.map(e.resolve.bind(e))})).reduce(de.Rc,[]).map((function(e){return e.toString()}))}function fe(e,t){return{keySystem:e,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:t||[],keyIds:[]}}var pe={Za:"video",Sb:"audio",za:"text",Ug:"image",Sg:"application"},ge=1/15;function ye(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return r.resolve=e,r.reject=t,r}function me(e){if(!e)return"";239==(e=new Uint8Array(e))[0]&&187==e[1]&&191==e[2]&&(e=e.subarray(3)),e=Ee(e),e=escape(e);try{return decodeURIComponent(e)}catch(t){throw new z(2,2,2004)}}function ve(e,t,r){if(!e)return"";if(!r&&0!=e.byteLength%2)throw Y.error("Data has an incorrect length, must be even."),new z(2,2,2004);if(e instanceof ArrayBuffer)var n=e;else(r=new Uint8Array(e.byteLength)).set(new Uint8Array(e)),n=r.buffer;e=Math.floor(e.byteLength/2),r=new Uint16Array(e),n=new DataView(n);for(var i=0;i<e;i++)r[i]=n.getUint16(2*i,t);return Ee(r)}function _e(e){var t=new Uint8Array(e);if(239==t[0]&&187==t[1]&&191==t[2])return me(t);if(254==t[0]&&255==t[1])return ve(t.subarray(2),!1);if(255==t[0]&&254==t[1])return ve(t.subarray(2),!0);var r=function(e,t){return e.byteLength<=t||32<=e[t]&&126>=e[t]}.bind(null,t);if(Y.debug("Unable to find byte-order-mark, making an educated guess."),0==t[0]&&0==t[2])return ve(e,!1);if(0==t[1]&&0==t[3])return ve(e,!0);if(r(0)&&r(1)&&r(2)&&r(3))return me(e);throw new z(2,2,2003)}function be(e){e=encodeURIComponent(e),e=unescape(e);for(var t=new Uint8Array(e.length),r=0;r<e.length;++r)t[r]=e.charCodeAt(r);return t.buffer}function Ae(e,t){for(var r=new Uint8Array(2*e.length),n=new DataView(r.buffer),i=0;i<e.length;++i)n.setUint16(2*i,e.charCodeAt(i),t);return r.buffer}function Ee(e){if(!Se)for(var t=function(e){try{var t=new Uint8Array(e);return 0<String.fromCharCode.apply(null,t).length}catch(r){return!1}},r={size:65536};0<r.size;(r={size:r.size}).size/=2)if(t(r.size)){Se=function(e){return function(t){for(var r="",n=0;n<t.length;n+=e.size)r+=String.fromCharCode.apply(null,t.subarray(n,n+e.size));return r}}(r);break}return Se(e)}ye.prototype.resolve=function(){},ye.prototype.reject=function(){},j("shaka.util.StringUtils.fromUTF8",me),j("shaka.util.StringUtils.fromUTF16",ve),j("shaka.util.StringUtils.fromBytesAutoDetect",_e),j("shaka.util.StringUtils.toUTF8",be),j("shaka.util.StringUtils.toUTF16",Ae);var Se=null;j("shaka.util.StringUtils.resetFromCharCode",(function(){Se=null}));var Te={Mc:function(e,r){var n=Ee(e);return r=null==r||r,n=t.btoa(n).replace(/\+/g,"-").replace(/\//g,"_"),r?n:n.replace(/=*$/,"")}};function we(){this.g=new muxjs.mp4.Transmuxer({keepOriginalTimestamps:!0}),this.h=null,this.l=[],this.i=[],this.j=!1,this.g.on("data",this.o.bind(this)),this.g.on("done",this.m.bind(this))}function Ce(e,r){return!(!t.muxjs||"mp2t"!=e.toLowerCase().split(";")[0].split("/")[1])&&(r?MediaSource.isTypeSupported(ke(r,e)):MediaSource.isTypeSupported(ke("audio",e))||MediaSource.isTypeSupported(ke("video",e)))}function ke(e,t){var r=t.replace(/mp2t/i,"mp4");"audio"==e&&(r=r.replace("video","audio"));var n=/avc1\.(66|77|100)\.(\d+)/.exec(r);if(n){var i="avc1.",a=n[1],o=Number(n[2]);i=("66"==a?i+"4200":"77"==a?i+"4d00":i+"6400")+(o>>4).toString(16),i+=(15&o).toString(16),r=r.replace(n[0],i)}return r}function Ie(e){this.h=e,this.g=null}function $e(e){this.h=e,this.g=null}function Pe(e,t){var r={maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0};this.o=null==e.maxAttempts?r.maxAttempts:e.maxAttempts,this.j=null==e.baseDelay?r.baseDelay:e.baseDelay,this.m=null==e.fuzzFactor?r.fuzzFactor:e.fuzzFactor,this.l=null==e.backoffFactor?r.backoffFactor:e.backoffFactor,this.g=0,this.h=this.j,(this.i=void 0!==t&&t)&&(this.g=1)}function xe(e){return g((function t(){var r,n;return N(t,(function(t){switch(t.s){case 1:if(e.g>=e.o){if(!e.i)return t.return(Promise.reject());e.g=1,e.h=e.j}return r=e.g,e.g++,0==r?t.return():(n=e.h*(1+(2*Math.random()-1)*e.m),w(t,new Promise((function(e){new $e(e).V(n/1e3)})),2));case 2:e.h*=e.l,C(t)}}))}))}function Re(e,t){this.promise=e,this.se=t,this.g=!1}function Oe(e){return new Re(Promise.reject(e),(function(){return Promise.resolve()}))}function De(){var e=Promise.reject(new z(2,7,7001));return e.catch((function(){})),new Re(e,(function(){return Promise.resolve()}))}function Le(e){return new Re(Promise.resolve(e),(function(){return Promise.resolve()}))}function Me(e){return new Re(e,(function(){return e.catch((function(){}))}))}function Ne(e){return new Re(Promise.all(e.map((function(e){return e.promise}))),(function(){return Promise.all(e.map((function(e){return e.abort()})))}))}function Be(e,r){for(var n in r=void 0===r?{}:r)this[n]=r[n];this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=t.performance&&t.performance.now?t.performance.now():Date.now(),this.type=e,this.isTrusted=!1,this.target=this.currentTarget=null,this.g=!1}function Ue(){this.g={}}function Ge(){this.hd=new Ue,this.jc=this}function Ve(e){var t=new Set;return function e(r){switch(_typeof$7(r)){case"undefined":case"boolean":case"number":case"string":case"symbol":case"function":return r;default:if(!r||r.buffer&&r.buffer.constructor==ArrayBuffer)return r;if(t.has(r))return null;var n=r.constructor==Array;if(r.constructor!=Object&&!n)return null;t.add(r);var i,a=n?[]:{};for(i in r)a[i]=e(r[i]);return n&&(a.length=r.length),a}}(e)}function Fe(e,t){return!("number"!=typeof e||"number"!=typeof t||!isNaN(e)||!isNaN(t))||e===t}function je(e,t){var r=e.indexOf(t);-1<r&&e.splice(r,1)}function He(e,t,r){if(r||(r=Fe),e.length!=t.length)return!1;t=t.slice();for(var n={},i=(e=f(e)).next();!i.done;n={item:n.item},i=e.next()){if(n.item=i.value,-1==(i=t.findIndex(function(e){return function(t){return r(e.item,t)}}(n))))return!1;t[i]=t[t.length-1],t.pop()}return 0==t.length}function Ze(){this.g=[]}function We(e,t){e.g.push(t.finally((function(){je(e.g,t)})))}function Ke(e){Ge.call(this),this.j=!1,this.l=new Ze,this.g=new Set,this.h=new Set,this.i=e||null}j("shaka.util.Uint8ArrayUtils.toBase64",Te.Mc),Te.Ja=function(e){e=t.atob(e.replace(/-/g,"+").replace(/_/g,"/"));for(var r=new Uint8Array(e.length),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r},j("shaka.util.Uint8ArrayUtils.fromBase64",Te.Ja),Te.$c=function(e){for(var r=new Uint8Array(e.length/2),n=0;n<e.length;n+=2)r[n/2]=t.parseInt(e.substr(n,2),16);return r},j("shaka.util.Uint8ArrayUtils.fromHex",Te.$c),Te.Nc=function(e){for(var t="",r=0;r<e.length;++r){var n=e[r].toString(16);1==n.length&&(n="0"+n),t+=n}return t},j("shaka.util.Uint8ArrayUtils.toHex",Te.Nc),Te.Ha=function(e,t){if(!e&&!t)return!0;if(!e||!t||e.length!=t.length)return!1;for(var r=0;r<e.length;++r)if(e[r]!=t[r])return!1;return!0},j("shaka.util.Uint8ArrayUtils.equal",Te.Ha),Te.concat=function(e){for(var t=[],r=0;r<arguments.length;++r)t[r]=arguments[r];for(var n=r=0;n<t.length;++n)r+=t[n].length;r=new Uint8Array(r);for(var i=n=0;i<t.length;++i)r.set(t[i],n),n+=t[i].length;return r},j("shaka.util.Uint8ArrayUtils.concat",Te.concat),we.prototype.destroy=function(){return this.g.dispose(),this.g=null,Promise.resolve()},we.prototype.o=function(e){this.i=e.captions;var t=new Uint8Array(e.data.byteLength+e.initSegment.byteLength);t.set(e.initSegment,0),t.set(e.data,e.initSegment.byteLength),this.l.push(t)},we.prototype.m=function(){var e={data:Te.concat.apply(null,this.l),captions:this.i};this.h.resolve(e),this.j=!1},Ie.prototype.V=function(e){var r=this;this.stop();var n=!0,i=null;return this.g=function(){t.clearTimeout(i),n=!1},i=t.setTimeout((function(){n&&r.h()}),1e3*e),this},Ie.prototype.stop=function(){this.g&&(this.g(),this.g=null)},j("shaka.util.Timer",$e),$e.prototype.Lc=function(){return this.stop(),this.h(),this},$e.prototype.tickNow=$e.prototype.Lc,$e.prototype.V=function(e){var t=this;return this.stop(),this.g=new Ie((function(){t.h()})).V(e),this},$e.prototype.tickAfter=$e.prototype.V,$e.prototype.Oa=function(e){var t=this;return this.stop(),this.g=new Ie((function(){t.g.V(e),t.h()})).V(e),this},$e.prototype.tickEvery=$e.prototype.Oa,$e.prototype.stop=function(){this.g&&(this.g.stop(),this.g=null)},$e.prototype.stop=$e.prototype.stop,j("shaka.util.AbortableOperation",Re),Re.failed=Oe,Re.aborted=De,Re.completed=Le,Re.notAbortable=Me,Re.prototype.abort=function(){return this.g=!0,this.se()},Re.prototype.abort=Re.prototype.abort,Re.all=Ne,Re.prototype.finally=function(e){return this.promise.then((function(){return e(!0)}),(function(){return e(!1)})),this},Re.prototype.finally=Re.prototype.finally,Re.prototype.ca=function(e,t){function r(r){return function(s){if(i.g&&r)a.reject(o);else{var u=r?e:t;u?n=function(e,t,r){try{var n=e(t);return n&&n.promise&&n.abort?(r.resolve(n.promise),function(){return n.abort()}):(r.resolve(n),function(){return Promise.resolve(n).then((function(){}),(function(){}))})}catch(i){return r.reject(i),function(){return Promise.resolve()}}}(u,s,a):(r?a.resolve:a.reject)(s)}}}function n(){return a.reject(o),i.abort()}var i=this,a=new ye,o=new z(2,7,7001);return this.promise.then(r(!0),r(!1)),new Re(a,(function(){return n()}))},Re.prototype.chain=Re.prototype.ca,j("shaka.util.FakeEvent",Be),Be.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)},Be.prototype.stopImmediatePropagation=function(){this.g=!0},Be.prototype.stopPropagation=function(){},(i=Ue.prototype).push=function(e,t){this.g.hasOwnProperty(e)?this.g[e].push(t):this.g[e]=[t]},i.get=function(e){return(e=this.g[e])?e.slice():null},i.getAll=function(){var e,t=[];for(e in this.g)t.push.apply(t,this.g[e]);return t},i.remove=function(e,t){var r=this.g[e];if(r)for(var n=0;n<r.length;++n)r[n]==t&&(r.splice(n,1),--n)},i.forEach=function(e){for(var t in this.g)e(t,this.g[t])},i.size=function(){return Object.keys(this.g).length},Ge.prototype.addEventListener=function(e,t){this.hd.push(e,t)},Ge.prototype.removeEventListener=function(e,t){this.hd.remove(e,t)},Ge.prototype.dispatchEvent=function(t){for(var r=this.hd.get(t.type)||[],n=0;n<r.length;++n){t.target=this.jc,t.currentTarget=this.jc;var i=r[n];try{i.handleEvent?i.handleEvent(t):i.call(this,t)}catch(e){Y.error("Uncaught exception in event handler",e,e?e.message:null,e?e.stack:null)}if(t.g)break}return t.defaultPrevented},Ze.prototype.destroy=function(){var e=[];return this.g.forEach((function(t){t.promise.catch((function(){})),e.push(t.abort())})),this.g=[],Promise.all(e)},H(Ke,Ge),j("shaka.net.NetworkingEngine",Ke),Ke.RequestType={MANIFEST:0,SEGMENT:1,LICENSE:2,APP:3,TIMING:4},Ke.PluginPriority={FALLBACK:1,PREFERRED:2,APPLICATION:3};var Xe={};function Ye(e,t,r){r=r||3;var n=Xe[e];(!n||r>=n.priority)&&(Xe[e]={priority:r,mg:t})}function ze(e,t){return{uris:e,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:t,licenseRequestType:null,sessionId:null}}function Je(e,t,r,n,i,a,o){var s=new Q(r.uris[i]),u=s.Ba,c=!1;u||(q(s,u=(u=location.protocol).slice(0,-1)),r.uris[i]=s.toString()),u=u.toLowerCase();var l,d=(u=Xe[u])?u.mg:null;return d?Me(xe(n)).ca((function(){return e.j?De():(l=Date.now(),d(r.uris[i],r,t,(function(r,n,i){e.i&&1==t&&(e.i(r,n),c=!0,o.g=i)})))})).ca((function(e){return null==e.timeMs&&(e.timeMs=Date.now()-l),{response:e,Nf:c}}),(function(s){if(s&&7001==s.code)throw s;if(e.j)return De();if(s&&1==s.severity)return e.dispatchEvent(new Be("retry",{error:s instanceof z?s:null})),i=(i+1)%r.uris.length,Je(e,t,r,n,i,s,o);throw s||a})):Oe(new z(2,1,1e3,s))}function Qe(){this.g=0}function qe(e,t,r){Re.call(this,e,t),this.h=r}function et(){}function tt(){this.g=new Ue}function rt(t,r,n,i){this.target=t,this.type=r,this.listener=n,this.g=function(t,r){if(null==r)return!1;if("boolean"==typeof r)return r;var n=new Set(["passive","capture"]);return Object.keys(r).filter((function(e){return!n.has(e)})),function(t){var r=nt;if(null==r){r=!1;try{var n={},i={get:function(){return r=!0,!1}};Object.defineProperty(n,"passive",i),Object.defineProperty(n,"capture",i),i=function(){},t.addEventListener("test",i,n),t.removeEventListener("test",i,n)}catch(e){r=!1}nt=r}return r||!1}(t)?r:r.capture||!1}(t,i),this.target.addEventListener(r,n,this.g)}Ke.registerScheme=Ye,Ke.unregisterScheme=function(e){delete Xe[e]},Ke.prototype.og=function(e){this.g.add(e)},Ke.prototype.registerRequestFilter=Ke.prototype.og,Ke.prototype.Ng=function(e){this.g.delete(e)},Ke.prototype.unregisterRequestFilter=Ke.prototype.Ng,Ke.prototype.bf=function(){this.g.clear()},Ke.prototype.clearAllRequestFilters=Ke.prototype.bf,Ke.prototype.pg=function(e){this.h.add(e)},Ke.prototype.registerResponseFilter=Ke.prototype.pg,Ke.prototype.Og=function(e){this.h.delete(e)},Ke.prototype.unregisterResponseFilter=Ke.prototype.Og,Ke.prototype.cf=function(){this.h.clear()},Ke.prototype.clearAllResponseFilters=Ke.prototype.cf,Ke.defaultRetryParameters=function(){return{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0}},Ke.makeRequest=ze,Ke.prototype.destroy=function(){return this.j=!0,this.g.clear(),this.h.clear(),this.l.destroy()},Ke.prototype.destroy=Ke.prototype.destroy,Ke.prototype.request=function(e,t){var r=this,n=new Qe;if(this.j){var i=Promise.reject(new z(2,7,7001));return i.catch((function(){})),new qe(i,(function(){return Promise.resolve()}),n)}t.method=t.method||"GET",t.headers=t.headers||{},t.retryParameters=t.retryParameters?Ve(t.retryParameters):{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0},t.uris=Ve(t.uris),i=function(e,t,r){for(var n=Le(void 0),i={},a=(e=f(e.g)).next();!a.done;i={Gd:i.Gd},a=e.next())i.Gd=a.value,n=n.ca(function(e){return function(){return e.Gd(t,r)}}(i));return n.ca(void 0,(function(e){if(e&&7001==e.code)throw e;throw new z(2,1,1006,e)}))}(this,e,t);var a=i.ca((function(){return Je(r,e,t,new Pe(t.retryParameters,!1),0,null,n)})),o=a.ca((function(t){return function(e,t,r){for(var n=Le(void 0),i=(e=f(e.h)).next();!i.done;i=e.next())n=n.ca(i.value.bind(null,t,r.response));return n.ca((function(){return r}),(function(e){if(e&&7001==e.code)throw e;var t=2;throw e instanceof z&&(t=e.severity),new z(t,1,1007,e)}))}(r,e,t)})),s=Date.now(),u=0;i.promise.then((function(){u=Date.now()-s}),(function(){}));var c=0;return a.promise.then((function(){c=Date.now()}),(function(){})),i=new qe((i=o.ca((function(t){var n=Date.now()-c,i=t.response;return i.timeMs+=u,i.timeMs+=n,t.Nf||!r.i||i.fromCache||1!=e||r.i(i.timeMs,i.data.byteLength),i}),(function(e){throw e&&(e.severity=2),e}))).promise,i.se,n),We(this.l,i),i},Ke.prototype.request=Ke.prototype.request,Ke.NumBytesRemainingClass=Qe,A(qe,Re),Ke.PendingRequest=qe,qe.all=Ne,qe.notAbortable=Me,qe.completed=Le,qe.aborted=De,qe.failed=Oe,j("shaka.util.IReleasable",et),et.prototype.release=function(){},j("shaka.util.EventManager",tt),tt.prototype.release=function(){this.nb(),this.g=null},tt.prototype.release=tt.prototype.release,tt.prototype.H=function(e,t,r,n){this.g&&(e=new rt(e,t,r,n),this.g.push(t,e))},tt.prototype.listen=tt.prototype.H,tt.prototype.ya=function(e,t,r,n){var i=this;this.H(e,t,(function n(a){i.ta(e,t,n),r(a)}),n)},tt.prototype.listenOnce=tt.prototype.ya,tt.prototype.ta=function(e,t,r){if(this.g)for(var n=this.g.get(t)||[],i=(n=f(n)).next();!i.done;i=n.next())(i=i.value).target!=e||r!=i.listener&&r||(i.ta(),this.g.remove(t,i))},tt.prototype.unlisten=tt.prototype.ta,tt.prototype.nb=function(){if(this.g){for(var e=this.g.getAll(),t=(e=f(e)).next();!t.done;t=e.next())t.value.ta();this.g.g={}}},tt.prototype.removeAll=tt.prototype.nb,rt.prototype.ta=function(){this.target.removeEventListener(this.type,this.listener,this.g),this.listener=this.target=null,this.g=!1},rt.prototype.unlisten=rt.prototype.ta;var nt=void 0;function it(e){return new Q(e=_e(e)).Aa}function at(e,t,r){function n(e){new DataView(i.buffer).setUint32(a,e.byteLength,!0),a+=4,i.set(e,a),a+=e.byteLength}if(!r||!r.byteLength)throw new z(2,6,6015);t="string"==typeof t?new Uint8Array(Ae(t,!0)):new Uint8Array(t),e=Ae(e=_e(e),!0);var i=new Uint8Array(12+e.byteLength+t.byteLength+r.byteLength),a=0;return n(new Uint8Array(e)),n(t),n(new Uint8Array(r)),i}function ot(e,t){for(var r=[],n=f(e),i=n.next();!i.done;i=n.next())r.push(t(i.value));return r}function st(e,t){for(var r=f(e),n=r.next();!n.done;n=r.next())if(!t(n.value))return!1;return!0}function ut(e){var t=new Map;return Object.keys(e).forEach((function(r){t.set(r,e[r])})),t}function ct(e){var t={};return e.forEach((function(e,r){t[r]=e})),t}function lt(e,t){var r=e;return t&&(r+='; codecs="'+t+'"'),r}function dt(e){return(e=e.split(/ *; */)).shift(),(e=e.find((function(e){return e.startsWith("codecs=")})))?e.split("=")[1].replace(/^"|"$/g,""):""}function ht(e){var t=(e=e.split("."))[0];return e.pop(),[t,e.join(".")]}j("shaka.util.FairPlayUtils.defaultGetContentId",it),j("shaka.util.FairPlayUtils.initDataTransform",at);var ft=(new Map).set("codecs","codecs").set("frameRate","framerate").set("bandwidth","bitrate").set("width","width").set("height","height").set("channelsCount","channels");function pt(){return!(!t.MediaSource||!MediaSource.isTypeSupported)}function gt(e){return""!=bt().canPlayType(e)}function yt(){return _t("Tizen")}function mt(){return!!navigator.vendor&&navigator.vendor.includes("Apple")&&!yt()}function vt(){if(!mt())return null;var e=navigator.userAgent.match(/Version\/(\d+)/);return e||(e=navigator.userAgent.match(/OS (\d+)(?:_\d+)?/))?parseInt(e[1],10):null}function _t(e){return(navigator.userAgent||"").includes(e)}function bt(){return Et||(At||(At=new $e((function(){Et=null}))),(Et=document.getElementsByTagName("video")[0]||document.getElementsByTagName("audio")[0])||(Et=document.createElement("video")),At.V(1),Et)}var At=null,Et=null;function St(e,t){var r=this;t=void 0===t?1:t,this.J=e,this.C=new Set,this.m=this.o=null,this.Z=!1,this.P=0,this.g=null,this.u=new tt,this.h=new Map,this.F=[],this.A=new ye,this.j=null,this.l=function(t){r.A.reject(t),e.onError(t)},this.wa=new Map,this.da=new Map,this.X=new $e((function(){return function(e){var t=e.wa,r=e.da;r.clear(),t.forEach((function(e,t){return r.set(t,e)})),(t=Array.from(r.values())).length&&t.every((function(e){return"expired"==e}))&&e.l(new z(2,6,6014)),e.J.Dc(ct(r))}(r)})),this.i=!1,this.ua=new ye,this.L=!1,this.M=[],this.va=!1,this.ea=new $e((function(){!function(e){e.h.forEach((function(t,r){var n=t.xd,i=r.expiration;isNaN(i)&&(i=1/0),i!=n&&(e.J.onExpirationUpdated(r.sessionId,i),t.xd=i)}))}(r)})).Oa(t),this.A.catch((function(){}))}function Tt(e,t,r){return e.F=r,e.L=0<r.length,wt(e,t)}function wt(e,r){var n=function(e){if(0==(e=ut(e.j.clearKeys)).size)return null;var r=[],n=[];e.forEach((function(e,t){var i=Te.$c(t),a=Te.$c(e);i={kty:"oct",kid:Te.Mc(i,!1),k:Te.Mc(a,!1)},r.push(i),n.push(i.kid)})),e=JSON.stringify({keys:r});var i=JSON.stringify({kids:n});return i=[{initData:new Uint8Array(be(i)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",licenseServerUri:"data:application/json;base64,"+t.btoa(e),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:i,keyIds:[]}}(e);if(n)for(var i=f(r),a=i.next();!a.done;a=i.next())a.value.drmInfos=[n];for((n=r.some((function(e){return 0<e.drmInfos.length})))||function(e,t){var r=[];t.forEach((function(e,t){r.push({keySystem:t,licenseServerUri:e,distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:[],keyIds:[]})}));for(var n=f(e),i=n.next();!i.done;i=n.next())i.value.drmInfos=r}(r,a=ut(e.j.servers)),a=(i=f(r)).next();!a.done;a=i.next())for(var o=(a=f(a.value.drmInfos)).next();!o.done;o=a.next())Ft(o.value,ut(e.j.servers),ut(e.j.advanced||{}));return a=function(e,t){for(var r=new Set,n=f(t),i=n.next();!i.done;i=n.next()){var a=f(i.value.drmInfos);for(i=a.next();!i.done;i=a.next())r.add(i.value)}for(n=f(r),i=n.next();!i.done;i=n.next())Ft(i.value,ut(e.j.servers),ut(e.j.advanced||{}));a=e.L?"required":"optional";var o=e.L?["persistent-license"]:["temporary"];for(n=new Map,r=f(r),i=r.next();!i.done;i=r.next())i=i.value,n.set(i.keySystem,{audioCapabilities:[],videoCapabilities:[],distinctiveIdentifier:"optional",persistentState:a,sessionTypes:o,label:i.keySystem,drmInfos:[]});for(r=f(t),i=r.next();!i.done;i=r.next()){a=(i=i.value).audio,o=i.video;var s=a?Rt(a):"",u=o?Rt(o):"",c=f(i.drmInfos);for(i=c.next();!i.done;i=c.next()){i=i.value;var l=n.get(i.keySystem);l.drmInfos.push(i),i.distinctiveIdentifierRequired&&(l.distinctiveIdentifier="required"),i.persistentStateRequired&&(l.persistentState="required"),a&&(l.audioCapabilities.push({robustness:i.audioRobustness||"",contentType:s}),"ac-3"==a.codecs.toLowerCase()&&yt()&&l.audioCapabilities.push({robustness:i.audioRobustness||"",contentType:lt(a.mimeType,"ec-3")})),o&&l.videoCapabilities.push({robustness:i.videoRobustness||"",contentType:u})}}return n}(e,r),a.size?(a=Ot(e,a),n?a:a.catch((function(){}))):(e.Z=!0,Promise.resolve())}function Ct(e){return g((function t(){var r;return N(t,(function(t){switch(t.s){case 1:if(!(e.o&&e.g&&e.g.serverCertificate&&e.g.serverCertificate.length)){t.I(0);break}return k(t,3),w(t,e.o.setServerCertificate(e.g.serverCertificate),5);case 5:t.B||Y.v("Server certificates are not supported by the key system.  The server certificate has been ignored."),$(t,0);break;case 3:return r=P(t),t.return(Promise.reject(new z(2,6,6004,r.message)))}}))}))}function kt(e){var t=e.g?e.g.initData:[];return t.forEach((function(t){return It(e,t.initDataType,t.initData)})),e.F.forEach((function(t){return Dt(e,t)})),t.length||e.F.length||e.A.resolve(),e.A}function It(e,t,r){for(var n=e.h.values(),i=(n=f(n)).next();!i.done;i=n.next())if(Te.Ha(r,i.value.initData)&&!_t("Tizen 2"))return void Y.debug("Ignoring duplicate init data.");!function(e,t,r){try{if(e.L){Y.K("Creating new persistent session");var n=e.o.createSession("persistent-license")}else Y.K("Creating new temporary session"),n=e.o.createSession()}catch(i){return void e.l(new z(2,6,6005,i.message))}e.u.H(n,"message",e.ye.bind(e)),e.u.H(n,"keystatuseschange",e.we.bind(e)),e.h.set(n,{initData:r,loaded:!1,xd:1/0,Ga:null});try{r=e.j.initDataTransform(r,e.g)}catch(i){return t=i,i instanceof z||(t=new z(2,6,6016,i)),void e.l(t)}n.generateRequest(t,r).catch((function(t){if(!e.i){if(e.h.delete(n),t.errorCode&&t.errorCode.systemCode){var r=t.errorCode.systemCode;0>r&&(r+=Math.pow(2,32)),r="0x"+r.toString(16)}e.l(new z(2,6,6006,t.message,t,r))}}))}(e,t,r)}function $t(e){return e?e.keySystem:""}function Pt(e,t){if(navigator.userAgent.match(/Edge\//))return!0;if(t=t.toLowerCase(),yt()&&t.includes('codecs="ac-3"')){var r=t.replace("ac-3","ec-3");return e.C.has(t)||e.C.has(r)}return e.C.has(t)}function xt(e){return e=ot(e=e.h.keys(),(function(e){return e.sessionId})),Array.from(e)}function Rt(e){var t=lt(e.mimeType,e.codecs);return Ce(t)?ke(e.type,t):t}function Ot(e,t){if(1==t.size&&t.has(""))return Promise.reject(new z(2,6,6e3));for(var r=f(t.values()),n=r.next();!n.done;n=r.next())0==(n=n.value).audioCapabilities.length&&delete n.audioCapabilities,0==n.videoCapabilities.length&&delete n.videoCapabilities;var i=r=new ye;return[!0,!1].forEach(function(e){var r=this;t.forEach((function(t,n){t.drmInfos.some((function(e){return!!e.licenseServerUri}))==e&&(i=i.catch(function(){if(!this.i)return navigator.requestMediaKeySystemAccess(n,[t])}.bind(r)))}))}.bind(e)),i=(i=i.catch((function(){return Promise.reject(new z(2,6,6001))}))).then(function(e){if(this.i)return Promise.reject();this.C.clear();var r=e.getConfiguration(),n=r.videoCapabilities||[],i=f(r.audioCapabilities||[]);for(r=i.next();!r.done;r=i.next())this.C.add(r.value.contentType.toLowerCase());for(r=(n=f(n)).next();!r.done;r=n.next())this.C.add(r.value.contentType.toLowerCase());n=e.keySystem,i=[];var a=[],o=[],s=[];return function(e,t,r,n,i){e.forEach((function(e){if(t.includes(e.licenseServerUri)||t.push(e.licenseServerUri),e.serverCertificate&&(r.some((function(t){return Te.Ha(t,e.serverCertificate)}))||r.push(e.serverCertificate)),e.initData&&e.initData.forEach((function(e){n.some((function(t){return!(!t.keyId||t.keyId!=e.keyId)||t.initDataType==e.initDataType&&Te.Ha(t.initData,e.initData)}))||n.push(e)})),e.keyIds)for(var a=0;a<e.keyIds.length;++a)i.includes(e.keyIds[a])||i.push(e.keyIds[a])}))}((r=t.get(e.keySystem)).drmInfos,i,a,o,s),1<a.length&&Y.v("Multiple unique server certificates found! Only the first will be used."),1<i.length&&Y.v("Multiple unique license server URIs found! Only the first will be used."),this.g={keySystem:n,licenseServerUri:i[0],distinctiveIdentifierRequired:"required"==r.distinctiveIdentifier,persistentStateRequired:"required"==r.persistentState,audioRobustness:(r.audioCapabilities?r.audioCapabilities[0].robustness:"")||"",videoRobustness:(r.videoCapabilities?r.videoCapabilities[0].robustness:"")||"",serverCertificate:a[0],initData:o,keyIds:s},this.g.licenseServerUri?e.createMediaKeys():Promise.reject(new z(2,6,6012,this.g.keySystem))}.bind(e)).then(function(e){if(this.i)return Promise.reject();Y.info("Created MediaKeys object for key system",this.g.keySystem),this.o=e,this.Z=!0}.bind(e)).catch(function(e){if(!this.i)return this.g=null,this.C.clear(),e instanceof z?Promise.reject(e):Promise.reject(new z(2,6,6002,e.message))}.bind(e)),r.reject(),i}function Dt(e,t){try{Y.K("Attempting to load an offline session",t);var r=e.o.createSession("persistent-license")}catch(a){var n=new z(2,6,6005,a.message);return e.l(n),Promise.reject(n)}e.u.H(r,"message",e.ye.bind(e)),e.u.H(r,"keystatuseschange",e.we.bind(e));var i={initData:null,loaded:!1,xd:1/0,Ga:null};return e.h.set(r,i),r.load(t).then(function(e){return this.i?Promise.reject():(Y.O("Loaded offline session",t,e),e?(i.loaded=!0,Vt(this)&&this.A.resolve(),r):(this.h.delete(r),void this.l(new z(2,6,6013))))}.bind(e),function(e){this.i||(this.h.delete(r),this.l(new z(2,6,6005,e.message)))}.bind(e))}function Lt(e,t){if($t(t).startsWith("com.apple.fps")){var r=t.serverCertificate;e=at(e,it(e),r)}return e}function Mt(e,t){var r=t.target;Y.K("Sending license request for session",r.sessionId,"of type",t.messageType);var n=e.h.get(r),i=e.g.licenseServerUri,a=e.j.advanced[e.g.keySystem];"individualization-request"==t.messageType&&a&&a.individualizationServer&&(i=a.individualizationServer),(i=ze([i],e.j.retryParameters)).body=t.message,i.method="POST",i.licenseRequestType=t.messageType,i.sessionId=r.sessionId,"com.microsoft.playready"!=e.g.keySystem&&"com.chromecast.playready"!=e.g.keySystem||function(e){var t=ve(e.body,!0,!0);if(t.includes("PlayReadyKeyMessage")){Y.debug("Unwrapping PlayReady request.");for(var r=(t=(new DOMParser).parseFromString(t,"application/xml")).getElementsByTagName("HttpHeader"),n=0;n<r.length;++n)e.headers[r[n].getElementsByTagName("name")[0].textContent]=r[n].getElementsByTagName("value")[0].textContent;e.body=Te.Ja(t.getElementsByTagName("Challenge")[0].textContent).buffer}else Y.debug("PlayReady request is already unwrapped."),e.headers["Content-Type"]="text/xml; charset=utf-8"}(i),e.g.keySystem.startsWith("com.apple.fps")&&e.j.fairPlayTransform&&function(e){var t=new Uint8Array(e.body);t="spc="+Te.Mc(t),e.headers["Content-Type"]="application/x-www-form-urlencoded",e.body=be(t)}(i);var o=Date.now();e.J.Ib.request(2,i).promise.then(function(e){return this.i?Promise.reject():(this.g.keySystem.startsWith("com.apple.fps")&&this.j.fairPlayTransform&&function(e){try{var t=me(e.data)}catch(r){return}"<ckc>"===(t=t.trim()).substr(0,5)&&"</ckc>"===t.substr(-6)&&(t=t.slice(5,-6));try{t=JSON.parse(t).ckc}catch(r){}e.data=Te.Ja(t).buffer}(e),this.P+=(Date.now()-o)/1e3,Y.K("Updating session",r.sessionId),r.update(e.data).then(function(){var e=this;this.J.onEvent(new Be("drmsessionupdate")),n&&(n.Ga&&n.Ga.resolve(),new $e((function(){n.loaded=!0,Vt(e)&&e.A.resolve()})).V(Ht))}.bind(this)))}.bind(e),function(e){this.i||(e=new z(2,6,6007,e),this.l(e),n&&n.Ga&&n.Ga.reject(e))}.bind(e)).catch(function(e){this.i||(e=new z(2,6,6008,e.message),this.l(e),n&&n.Ga&&n.Ga.reject(e))}.bind(e))}function Nt(){var e=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],t=[{videoCapabilities:e,persistentState:"required",sessionTypes:["persistent-license"]},{videoCapabilities:e}],r=new Map;return e="org.w3.clearkey com.widevine.alpha com.microsoft.playready com.apple.fps.3_0 com.apple.fps.2_0 com.apple.fps.1_0 com.apple.fps com.adobe.primetime".split(" ").map((function(e){return n=e,g((function e(){var i,a,o;return N(e,(function(e){switch(e.s){case 1:return k(e,2),w(e,navigator.requestMediaKeySystemAccess(n,t),4);case 4:return i=e.B,o=!!(a=i.getConfiguration().sessionTypes)&&a.includes("persistent-license"),_t("Tizen 3")&&(o=!1),r.set(n,{persistentState:o}),w(e,i.createMediaKeys(),5);case 5:$(e,0);break;case 2:P(e),r.set(n,null),C(e)}}))}));var n})),Promise.all(e).then((function(){return ct(r)}))}function Bt(e,t){var r=t.audio,n=t.video;if(r&&r.encrypted&&!Pt(e,r=Rt(r))||n&&n.encrypted&&!Pt(e,n=Rt(n)))return!1;var i=$t(e.g);return 0==t.drmInfos.length||t.drmInfos.some((function(e){return e.keySystem==i}))}function Ut(e,t){if(!e.length)return t;if(!t.length)return e;for(var r=[],n=0;n<e.length;n++)for(var i=0;i<t.length;i++)if(e[n].keySystem==t[i].keySystem){var a=e[n];i=t[i];var o=[];o=(o=o.concat(a.initData||[])).concat(i.initData||[]);var s=[];s=(s=s.concat(a.keyIds)).concat(i.keyIds),r.push({keySystem:a.keySystem,licenseServerUri:a.licenseServerUri||i.licenseServerUri,distinctiveIdentifierRequired:a.distinctiveIdentifierRequired||i.distinctiveIdentifierRequired,persistentStateRequired:a.persistentStateRequired||i.persistentStateRequired,videoRobustness:a.videoRobustness||i.videoRobustness,audioRobustness:a.audioRobustness||i.audioRobustness,serverCertificate:a.serverCertificate||i.serverCertificate,initData:o,keyIds:s});break}return r}function Gt(e){return g((function t(){var r;return N(t,(function(t){if(1===t.s)return r=Array.from(e.h.keys()),e.h.clear(),w(t,Promise.all(r.map((function(e){return g((function t(){return N(t,(function(t){switch(t.s){case 1:return Y.K("Closing session",e.sessionId),k(t,2),w(t,function(e){return g((function t(){var r;return N(t,(function(t){switch(t.s){case 1:return r=new Promise((function(e,t){new $e(t).V(jt)})),k(t,2),w(t,Promise.race([Promise.all([e.close(),e.closed]),r]),4);case 4:$(t,0);break;case 2:P(t),Y.v("Timeout waiting for session close"),C(t)}}))}))}(e),4);case 4:$(t,0);break;case 2:P(t),C(t)}}))}))}))),0)}))}))}function Vt(e){return st(e=e.h.values(),(function(e){return e.loaded}))}function Ft(e,r,n){!e.keySystem||"org.w3.clearkey"==e.keySystem&&e.licenseServerUri||(r.size&&(r=r.get(e.keySystem)||"",e.licenseServerUri=r),e.keyIds||(e.keyIds=[]),(n=n.get(e.keySystem))&&(e.distinctiveIdentifierRequired||(e.distinctiveIdentifierRequired=n.distinctiveIdentifierRequired),e.persistentStateRequired||(e.persistentStateRequired=n.persistentStateRequired),e.videoRobustness||(e.videoRobustness=n.videoRobustness),e.audioRobustness||(e.audioRobustness=n.audioRobustness),e.serverCertificate||(e.serverCertificate=n.serverCertificate)),t.cast&&t.cast.__platform__&&"com.microsoft.playready"==e.keySystem&&(e.keySystem="com.chromecast.playready"))}(i=St.prototype).destroy=function(){var e=this;return g((function t(){return N(t,(function(t){switch(t.s){case 1:return e.i?w(t,e.ua,0):(e.i=!0,w(t,function(e){return g((function t(){return N(t,(function(t){switch(t.s){case 1:return e.u.release(),e.u=null,e.A.reject(),e.ea.stop(),e.ea=null,e.X.stop(),e.X=null,w(t,Gt(e),2);case 2:if(!e.m){t.I(3);break}return k(t,4),w(t,e.m.setMediaKeys(null),6);case 6:$(t,5);break;case 4:P(t);case 5:e.m=null;case 3:e.g=null,e.C.clear(),e.o=null,e.F=[],e.j=null,e.l=null,e.J=null,C(t)}}))}))}(e),4));case 4:e.ua.resolve(),t.I(0)}}))}))},i.configure=function(e){this.j=e},i.Ub=function(e){var t=this;if(!this.o)return this.u.ya(e,"encrypted",(function(){t.l(new z(2,6,6010))})),Promise.resolve();this.m=e,this.u.ya(this.m,"play",(function(){for(var e=0;e<t.M.length;e++)Mt(t,t.M[e]);t.va=!0,t.M=[]})),"webkitCurrentPlaybackTargetIsWireless"in this.m&&this.u.H(this.m,"webkitcurrentplaybacktargetiswirelesschanged",(function(){return Gt(t)})),e=(e=this.m.setMediaKeys(this.o)).catch((function(e){return Promise.reject(new z(2,6,6003,e.message))}));var r=Ct(this);return Promise.all([e,r]).then((function(){if(t.i)return Promise.reject();kt(t),t.g.initData.length||t.F.length||t.u.H(t.m,"encrypted",(function(e){return It(t,e.initDataType,new Uint8Array(e.initData))}))})).catch((function(e){if(!t.i)return Promise.reject(e)}))},i.Xb=function(){for(var e=1/0,t=this.h.keys(),r=(t=f(t)).next();!r.done;r=t.next())r=r.value,isNaN(r.expiration)||(e=Math.min(e,r.expiration));return e},i.ye=function(e){this.m&&this.j.delayLicenseRequestUntilPlayed&&this.m.paused&&!this.va?this.M.push(e):Mt(this,e)},i.we=function(e){e=e.target,Y.O("Key status changed for session",e.sessionId);var t=this.h.get(e),r=!1;e.keyStatuses.forEach(function(e,n){if("string"==typeof n){var i=n;n=e,e=i}if("com.microsoft.playready"==this.g.keySystem&&16==n.byteLength&&(_t("Trident/")||navigator.userAgent.match(/Edge?\//))){var a=(i=new DataView(n)).getUint32(0,!0),o=i.getUint16(4,!0),s=i.getUint16(6,!0);i.setUint32(0,a,!1),i.setUint16(4,o,!1),i.setUint16(6,s,!1)}"com.microsoft.playready"==this.g.keySystem&&"status-pending"==e&&(e="usable"),"status-pending"!=e&&(t.loaded=!0),"expired"==e&&(r=!0),i=Te.Nc(new Uint8Array(n)),this.wa.set(i,e)}.bind(this));var n=e.expiration-Date.now();(0>n||r&&1e3>n)&&t&&!t.Ga&&(Y.debug("Session has expired",e.sessionId),this.h.delete(e),e.close().catch((function(){}))),Vt(this)&&(this.A.resolve(),this.X.V(Zt))};var jt=1,Ht=5,Zt=.5;function Wt(){this.g=new muxjs.mp4.CaptionParser,this.l=[],this.j={}}function Kt(){}function Xt(e){return!e||1==e.length&&1e-6>e.end(0)-e.start(0)?null:e.length?e.end(e.length-1):null}function Yt(e,t,r){return r=void 0===r?0:r,!(!e||!e.length||1==e.length&&1e-6>e.end(0)-e.start(0)||t>e.end(e.length-1))&&t+r>=e.start(0)}function zt(e,t){if(!e||!e.length||1==e.length&&1e-6>e.end(0)-e.start(0))return 0;for(var r=0,n=e.length-1;0<=n&&e.end(n)>t;--n)r+=e.end(n)-Math.max(e.start(n),t);return r}function Jt(e){if(!e)return[];for(var t=[],r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}function Qt(e,t,r){this.startTime=e,this.direction=ir,this.endTime=t,this.payload=r,this.region=new hr,this.position=null,this.positionAlign=qt,this.size=0,this.textAlign=er,this.writingMode=ar,this.lineInterpretation=or,this.line=null,this.lineHeight="",this.lineAlign=sr,this.displayAlign=rr,this.fontSize=this.backgroundImage=this.backgroundColor=this.color="",this.fontWeight=cr,this.fontStyle=lr,this.fontFamily="",this.textDecoration=[],this.wrapLine=!0,this.id="",this.nestedCues=[],this.spacer=!1}Wt.prototype.init=function(e){var t=muxjs.mp4.probe;e=new Uint8Array(e),this.l=t.videoTrackIds(e),this.j=t.timescale(e),this.g.init()},Wt.prototype.h=function(e,t){var r=new Uint8Array(e);(r=this.g.parse(r,this.l,this.j))&&r.captions&&t(r.captions),this.g.clearParsedCaptions()},Wt.prototype.i=function(){this.g.resetCaptionStream()},Kt.prototype.init=function(){},Kt.prototype.h=function(){},Kt.prototype.i=function(){},j("shaka.text.Cue",Qt),Qt.prototype.clone=function(){var e,t=new Qt(0,0,"");for(e in this)t[e]=this[e],t[e]&&t[e].constructor==Array&&(t[e]=t[e].slice());return t};var qt="auto";Qt.positionAlign={LEFT:"line-left",RIGHT:"line-right",CENTER:"center",AUTO:qt};var er="center",tr={LEFT:"left",RIGHT:"right",CENTER:er,START:"start",END:"end"};Qt.textAlign=tr;var rr="after",nr={BEFORE:"before",CENTER:"center",AFTER:rr};Qt.displayAlign=nr;var ir="ltr";Qt.direction={HORIZONTAL_LEFT_TO_RIGHT:ir,HORIZONTAL_RIGHT_TO_LEFT:"rtl"};var ar="horizontal-tb";Qt.writingMode={HORIZONTAL_TOP_TO_BOTTOM:ar,VERTICAL_LEFT_TO_RIGHT:"vertical-lr",VERTICAL_RIGHT_TO_LEFT:"vertical-rl"};var or=0;Qt.lineInterpretation={LINE_NUMBER:or,PERCENTAGE:1};var sr="start",ur={CENTER:"center",START:sr,END:"end"};Qt.lineAlign=ur;var cr=400;Qt.fontWeight={NORMAL:cr,BOLD:700};var lr="normal",dr={NORMAL:lr,ITALIC:"italic",OBLIQUE:"oblique"};function hr(){this.id="",this.regionAnchorY=this.regionAnchorX=this.viewportAnchorY=this.viewportAnchorX=0,this.height=this.width=100,this.viewportAnchorUnits=this.widthUnits=this.heightUnits=fr,this.scroll=pr}Qt.fontStyle=dr,Qt.textDecoration={UNDERLINE:"underline",LINE_THROUGH:"lineThrough",OVERLINE:"overline"},j("shaka.text.CueRegion",hr);var fr=1;hr.units={PX:0,PERCENTAGE:fr,LINES:2};var pr="";function gr(e){this.l=null,this.i=e,this.j=this.A=0,this.m=1/0,this.h=this.g=null,this.u="",this.o=new Map}hr.scrollMode={NONE:pr,UP:"up"};var yr={};function mr(e){return!!(yr[e]||t.muxjs&&"application/cea-608"==e)}function vr(e,t){"application/cea-608"!=t&&(e.l=new yr[t])}function _r(e,t,r,n,i){for(var a=r+" "+n,o=new Map,s=(t=f(t)).next();!s.done;s=t.next()){var u=s.value;s=u.stream,o.has(s)||o.set(s,new Map),o.get(s).has(a)||o.get(s).set(a,[]),u.startTime+=i,u.endTime+=i,u.startTime>=e.j&&u.startTime<e.m&&(u=new Qt(u.startTime,u.endTime,u.text),o.get(s).get(a).push(u),s==e.u&&e.i.append([u]))}for(a=(i=f(o.keys())).next();!a.done;a=i.next())for(a=a.value,e.o.has(a)||e.o.set(a,new Map),s=(t=f(o.get(a).keys())).next();!s.done;s=t.next())s=s.value,u=o.get(a).get(s),e.o.get(a).set(s,u);e.g=null==e.g?Math.max(r,e.j):Math.min(e.g,Math.max(r,e.j)),e.h=Math.max(e.h,Math.min(n,e.m))}function br(e,t,r){this.j=e,this.l=r,this.h={},this.g=null,this.i={},this.o=new tt,this.F=!1,this.u={},this.A=t,this.C=new ye,this.m=function(e,t){var r=new MediaSource;return e.o.ya(r,"sourceopen",(function(){URL.revokeObjectURL(e.J),t.resolve()})),e.J=Ar(r),e.j.src=e.J,r}(this,this.C),this.J=""}j("shaka.text.TextEngine.registerParser",(function(e,t){yr[e]=t})),j("shaka.text.TextEngine.unregisterParser",(function(e){delete yr[e]})),gr.prototype.destroy=function(){return this.i=this.l=null,this.o.clear(),Promise.resolve()},gr.prototype.xc=function(e){try{return this.l.parseMedia(new Uint8Array(e),{periodStart:0,segmentStart:null,segmentEnd:0})[0].startTime}catch(t){throw new z(2,2,2009,t)}},gr.prototype.remove=function(e,t){return Promise.resolve().then(function(){!this.i||!this.i.remove(e,t)||null==this.g||t<=this.g||e>=this.h||(e<=this.g&&t>=this.h?this.g=this.h=null:e<=this.g&&t<this.h?this.g=t:e>this.g&&t>=this.h&&(this.h=e))}.bind(this))};var Ar=t.URL.createObjectURL;function Er(e){var t=lt(e.mimeType,e.codecs),r=function(e){var t=[e.mimeType];return ft.forEach((function(r,n){var i=e[n];i&&t.push(r+'="'+i+'"')})),t.join(";")}(e);return mr(t)||MediaSource.isTypeSupported(r)||Ce(t,e.type)}function Sr(e,t){e.g||(e.g=new gr(e.l)),vr(e.g,t)}function Tr(e){return!e.m||"ended"==e.m.readyState}function wr(e,t){if("text"==t)var r=e.g.g;else r=!(r=kr(e,t))||1==r.length&&1e-6>r.end(0)-r.start(0)?null:1==r.length&&0>r.start(0)?0:r.length?r.start(0):null;return r}function Cr(e,t){return"text"==t?e.g.h:Xt(kr(e,t))}function kr(e,t){try{return e.h[t].buffered}catch(r){return t in e.h&&Y.error("failed to get buffered range for "+t,r),null}}function Ir(e,r,n,i,a,o){return"text"==r?function(e,t,r,n){return Promise.resolve().then(function(){if(this.l&&this.i)if(null==r||null==n)this.l.parseInit(new Uint8Array(t));else{var e={periodStart:this.A,segmentStart:r,segmentEnd:n};e=this.l.parseMedia(new Uint8Array(t),e).filter(function(e){return e.startTime>=this.j&&e.startTime<this.m}.bind(this)),this.i.append(e),null==this.g&&(this.g=Math.max(r,this.j)),this.h=Math.min(n,this.m)}}.bind(e))}(e.g,n,i,a):e.u[r]?function(e,t){e.j=!0,e.h=new ye,e.l=[],e.i=[];var r=new Uint8Array(t);return e.g.push(r),e.g.flush(),e.j&&e.h.reject(new z(2,3,3018)),e.h}(e.u[r],n).then(function(e){return this.g||Sr(this,"text/vtt"),e.captions&&e.captions.length&&_r(this.g,e.captions,i,a,this.h.video.timestampOffset),xr(this,r,this.Me.bind(this,r,e.data.buffer))}.bind(e)):(o&&t.muxjs&&(e.g||Sr(e,"text/vtt"),null==i&&null==a?e.A.init(n):e.A.h(n,(function(t){t.length&&_r(e.g,t,i,a,e.h.video.timestampOffset)}))),xr(e,r,e.Me.bind(e,r,n)))}function $r(e,t){var r=Cr(e,"video")||0;!function(e,t,r){if(e.u=t,t=e.o.get(t))for(var n=f(t.keys()),i=n.next();!i.done;i=n.next())(i=t.get(i.value).filter((function(e){return e.endTime<=r})))&&e.i.append(i)}(e.g,t,r)}function Pr(e,t){return"text"==t?e.g?(e.A.i(),e.g.remove(0,1/0)):Promise.resolve():xr(e,t,e.Ne.bind(e,t,0,e.m.duration))}function xr(e,t,r){if(e.F)return Promise.reject();if(r={start:r,p:new ye},e.i[t].push(r),1==e.i[t].length)try{r.start()}catch(n){"QuotaExceededError"==n.name?r.p.reject(new z(2,3,3017,t)):r.p.reject(new z(2,3,3015,n)),Or(e,t)}return r.p}function Rr(e,t){if(e.F)return Promise.reject();var r,n=[];for(r in e.h){var i=new ye,a={start:function(e){e.resolve()}.bind(null,i),p:i};e.i[r].push(a),n.push(i),1==e.i[r].length&&a.start()}return Promise.all(n).then(function(){try{t()}catch(n){var e=Promise.reject(new z(2,3,3015,n))}for(var r in this.h)Or(this,r);return e}.bind(e),function(e){throw e}.bind(e))}function Or(e,t){e.i[t].shift();var r=e.i[t][0];if(r)try{r.start()}catch(n){r.p.reject(new z(2,3,3015,n)),Or(e,t)}}function Dr(e,t){return e=Mr(e),t=Mr(t),e.split("-")[0]==t.split("-")[0]}function Lr(e,t){e=Mr(e),t=Mr(t);var r=e.split("-"),n=t.split("-");return r[0]==n[0]&&1==r.length&&2==n.length}function Mr(e){var t=e.split("-");return e=t[0]||"",t=t[1]||"",e=e.toLowerCase(),e=Ur.get(e)||e,(t=t.toUpperCase())?e+"-"+t:e}function Nr(e){return e.language?Mr(e.language):e.audio&&e.audio.language?Mr(e.audio.language):e.video&&e.video.language?Mr(e.video.language):"und"}function Br(e,t){for(var r=Mr(e),n=new Set,i=f(t),a=i.next();!a.done;a=i.next())n.add(Mr(a.value));for(a=(i=f(n)).next();!a.done;a=i.next())if((a=a.value)==r)return a;for(a=(i=f(n)).next();!a.done;a=i.next())if(Lr(a=a.value,r))return a;for(a=(i=f(n)).next();!a.done;a=i.next()){var o=a=a.value,s=r;if(o=Mr(o),s=Mr(s),o=o.split("-"),s=s.split("-"),2==o.length&&2==s.length&&o[0]==s[0])return a}for(a=(n=f(n)).next();!a.done;a=n.next())if(Lr(r,i=a.value))return i;return null}(i=br.prototype).destroy=function(){var e=this;this.F=!0;var t,r=[];for(t in this.i){var n=this.i[t],i=n[0];for(this.i[t]=n.slice(0,1),i&&r.push(i.p.catch(de.Bc)),i=1;i<n.length;++i)n[i].p.reject()}for(var a in this.g&&r.push(this.g.destroy()),this.l&&r.push(this.l.destroy()),this.u)r.push(this.u[a].destroy());return Promise.all(r).then((function(){e.o&&(e.o.release(),e.o=null),e.j&&(e.j.removeAttribute("src"),e.j.load(),e.j=null),e.m=null,e.g=null,e.l=null,e.h={},e.u={},e.A=null,e.i={}}))},i.init=function(e,t){var r=this;return g((function n(){var i;return N(n,(function(n){switch(n.s){case 1:return i=pe,w(n,r.C,2);case 2:e.forEach((function(e,n){var a=lt(e.mimeType,e.codecs);n==i.za?Sr(r,a):(!t&&MediaSource.isTypeSupported(a)||!Ce(a,n)||(r.u[n]=new we,a=ke(n,a)),a=r.m.addSourceBuffer(a),r.o.H(a,"error",r.Dg.bind(r,n)),r.o.H(a,"updateend",r.Lb.bind(r,n)),r.h[n]=a,r.i[n]=[])})),C(n)}}))}))},i.bd=function(e){if(e.total=Jt(this.j.buffered),e.audio=Jt(kr(this,"audio")),e.video=Jt(kr(this,"video")),e.text=[],this.g){var t=this.g.g,r=this.g.h;null!=t&&null!=r&&e.text.push({start:t,end:r})}},i.remove=function(e,t,r){return"text"==e?this.g.remove(t,r):xr(this,e,this.Ne.bind(this,e,t,r))},i.flush=function(e){return"text"==e?Promise.resolve():xr(this,e,this.lf.bind(this,e))},i.endOfStream=function(e){return Rr(this,function(){Tr(this)||(e?this.m.endOfStream(e):this.m.endOfStream())}.bind(this))},i.Fa=function(e){return Rr(this,function(){this.m.duration=e}.bind(this))},i.ha=function(){return this.m.duration},i.Me=function(e,t){this.h[e].appendBuffer(t)},i.Ne=function(e,t,r){r<=t?this.Lb(e):this.h[e].remove(t,r)},i.Ve=function(e){var t=this.h[e].appendWindowStart,r=this.h[e].appendWindowEnd;this.h[e].abort(),this.h[e].appendWindowStart=t,this.h[e].appendWindowEnd=r,this.Lb(e)},i.lf=function(e){this.j.currentTime-=.001,this.Lb(e)},i.Cg=function(e,t){0>t&&(t+=.001),this.h[e].timestampOffset=t,this.Lb(e)},i.zg=function(e,t,r){this.h[e].appendWindowStart=0,this.h[e].appendWindowEnd=r,this.h[e].appendWindowStart=t,this.Lb(e)},i.Dg=function(e){this.i[e][0].p.reject(new z(2,3,3014,this.j.error?this.j.error.code:0))},i.Lb=function(e){var t=this.i[e][0];t&&(t.p.resolve(),Or(this,e))};var Ur=new Map([["aar","aa"],["abk","ab"],["afr","af"],["aka","ak"],["alb","sq"],["amh","am"],["ara","ar"],["arg","an"],["arm","hy"],["asm","as"],["ava","av"],["ave","ae"],["aym","ay"],["aze","az"],["bak","ba"],["bam","bm"],["baq","eu"],["bel","be"],["ben","bn"],["bih","bh"],["bis","bi"],["bod","bo"],["bos","bs"],["bre","br"],["bul","bg"],["bur","my"],["cat","ca"],["ces","cs"],["cha","ch"],["che","ce"],["chi","zh"],["chu","cu"],["chv","cv"],["cor","kw"],["cos","co"],["cre","cr"],["cym","cy"],["cze","cs"],["dan","da"],["deu","de"],["div","dv"],["dut","nl"],["dzo","dz"],["ell","el"],["eng","en"],["epo","eo"],["est","et"],["eus","eu"],["ewe","ee"],["fao","fo"],["fas","fa"],["fij","fj"],["fin","fi"],["fra","fr"],["fre","fr"],["fry","fy"],["ful","ff"],["geo","ka"],["ger","de"],["gla","gd"],["gle","ga"],["glg","gl"],["glv","gv"],["gre","el"],["grn","gn"],["guj","gu"],["hat","ht"],["hau","ha"],["heb","he"],["her","hz"],["hin","hi"],["hmo","ho"],["hrv","hr"],["hun","hu"],["hye","hy"],["ibo","ig"],["ice","is"],["ido","io"],["iii","ii"],["iku","iu"],["ile","ie"],["ina","ia"],["ind","id"],["ipk","ik"],["isl","is"],["ita","it"],["jav","jv"],["jpn","ja"],["kal","kl"],["kan","kn"],["kas","ks"],["kat","ka"],["kau","kr"],["kaz","kk"],["khm","km"],["kik","ki"],["kin","rw"],["kir","ky"],["kom","kv"],["kon","kg"],["kor","ko"],["kua","kj"],["kur","ku"],["lao","lo"],["lat","la"],["lav","lv"],["lim","li"],["lin","ln"],["lit","lt"],["ltz","lb"],["lub","lu"],["lug","lg"],["mac","mk"],["mah","mh"],["mal","ml"],["mao","mi"],["mar","mr"],["may","ms"],["mkd","mk"],["mlg","mg"],["mlt","mt"],["mon","mn"],["mri","mi"],["msa","ms"],["mya","my"],["nau","na"],["nav","nv"],["nbl","nr"],["nde","nd"],["ndo","ng"],["nep","ne"],["nld","nl"],["nno","nn"],["nob","nb"],["nor","no"],["nya","ny"],["oci","oc"],["oji","oj"],["ori","or"],["orm","om"],["oss","os"],["pan","pa"],["per","fa"],["pli","pi"],["pol","pl"],["por","pt"],["pus","ps"],["que","qu"],["roh","rm"],["ron","ro"],["rum","ro"],["run","rn"],["rus","ru"],["sag","sg"],["san","sa"],["sin","si"],["slk","sk"],["slo","sk"],["slv","sl"],["sme","se"],["smo","sm"],["sna","sn"],["snd","sd"],["som","so"],["sot","st"],["spa","es"],["sqi","sq"],["srd","sc"],["srp","sr"],["ssw","ss"],["sun","su"],["swa","sw"],["swe","sv"],["tah","ty"],["tam","ta"],["tat","tt"],["tel","te"],["tgk","tg"],["tgl","tl"],["tha","th"],["tib","bo"],["tir","ti"],["ton","to"],["tsn","tn"],["tso","ts"],["tuk","tk"],["tur","tr"],["twi","tw"],["uig","ug"],["ukr","uk"],["urd","ur"],["uzb","uz"],["ven","ve"],["vie","vi"],["vol","vo"],["wel","cy"],["wln","wa"],["wol","wo"],["xho","xh"],["yid","yi"],["yor","yo"],["zha","za"],["zho","zh"],["zul","zu"]]),Gr={$d:function(e,t){var r=e.periods.reduce((function(e,t){return e.concat(t.variants)}),[]);r=Gr.ee(r,t),r=Gr.Lf(r),r=Gr.jf(r);for(var n=Gr.kf(r),i=(r=f(e.periods)).next();!i.done;i=r.next())(i=i.value).variants=i.variants.filter((function(e){return Gr.he(e)==n||(Y.debug("Dropping Variant (better codec available)",e),!1)}))},Lf:function(e){for(var t=new Ue,r=(e=f(e)).next();!r.done;r=e.next()){r=r.value;var n=Gr.he(r);t.push(n,r)}return t},jf:function(e){var t=0,r=new Map,n=e.size();return e.forEach((function(e,i){for(var a=f(i),o=a.next();!o.done;o=a.next()){var s=(o=o.value).video;if(s&&s.width&&s.height){s=s.width*s.height*(s.frameRate||1),r.has(s)||r.set(s,new Ue);var u=r.get(s);u.push(e,o),u.size()===n&&(t=Math.max(t,s))}}})),t?r.get(t):e},kf:function(e){var t="",r=1/0;return e.forEach((function(e,n){for(var i=0,a=0,o=f(n),s=o.next();!s.done;s=o.next())i+=s.value.bandwidth||0,++a;i/=a,Y.debug("codecs",e,"avg bandwidth",i),i<r&&(t=e,r=i)})),t},he:function(e){var t="";e.video&&(t=ht(e.video.codecs)[0]);var r="";return e.audio&&(r=ht(e.audio.codecs)[0]),t+"-"+r},rd:function(e,t,r){function n(e,t,r){return e>=t&&e<=r}var i=e.video;return!(i&&i.width&&i.height&&(!n(i.width,t.minWidth,Math.min(t.maxWidth,r.width))||!n(i.height,t.minHeight,Math.min(t.maxHeight,r.height))||!n(i.width*i.height,t.minPixels,t.maxPixels))||e&&e.video&&e.video.frameRate&&!n(e.video.frameRate,t.minFrameRate,t.maxFrameRate)||!n(e.bandwidth,t.minBandwidth,t.maxBandwidth))},Xd:function(e,t,r){var n=!1;return e.forEach((function(e){var i=e.allowedByApplication;e.allowedByApplication=Gr.rd(e,t,r),i!=e.allowedByApplication&&(n=!0)})),n},filterNewPeriod:function(e,t,r,n){n.variants=n.variants.filter((function(n){if(e&&e.Z&&!Bt(e,n))return Y.debug("Dropping variant - not compatible with key system",n),!1;var i=n.audio;return n=n.video,i&&!Er(i)?(Y.debug("Dropping variant - audio not compatible with platform",Gr.fb(i)),!1):n&&!Er(n)||_t("Xbox One")&&n&&(n.width&&1920<n.width||n.height&&1080<n.height)&&n.codecs.includes("avc1.")?(Y.debug("Dropping variant - video not compatible with platform",Gr.fb(n)),!1):i&&t&&!Gr.Yd(i,t)?(Y.debug("Droping variant - not compatible with active audio","active audio",Gr.fb(t),"variant.audio",Gr.fb(i)),!1):!(n&&r&&!Gr.Yd(n,r)&&(Y.debug("Droping variant - not compatible with active video","active video",Gr.fb(r),"variant.video",Gr.fb(n)),1))})),n.textStreams=n.textStreams.filter((function(e){var t=mr(lt(e.mimeType,e.codecs));return t||Y.debug("Dropping text stream. Is not supported by the platform.",e),t}))},Yd:function(e,t){return e.mimeType==t.mimeType&&e.codecs.split(".")[0]==t.codecs.split(".")[0]},Oc:function(e){var t=e.audio,r=e.video,n=t?t.codecs:null,i=r?r.codecs:null,a=[];i&&a.push(i),n&&a.push(n);var o=[];r&&o.push(r.mimeType),t&&o.push(t.mimeType),o=o[0]||null;var s=[];t&&s.push(t.kind),r&&s.push(r.kind),s=s[0]||null;var u=new Set;return t&&t.roles.forEach((function(e){return u.add(e)})),r&&r.roles.forEach((function(e){return u.add(e)})),e={id:e.id,active:!1,type:"variant",bandwidth:e.bandwidth,language:e.language,label:null,kind:s,width:null,height:null,frameRate:null,pixelAspectRatio:null,mimeType:o,codecs:a.join(", "),audioCodec:n,videoCodec:i,primary:e.primary,roles:Array.from(u),audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null},r&&(e.videoId=r.id,e.originalVideoId=r.originalId,e.width=r.width||null,e.height=r.height||null,e.frameRate=r.frameRate||null,e.pixelAspectRatio=r.pixelAspectRatio||null,e.videoBandwidth=r.bandwidth||null),t&&(e.audioId=t.id,e.originalAudioId=t.originalId,e.channelsCount=t.channelsCount,e.audioSamplingRate=t.audioSamplingRate,e.audioBandwidth=t.bandwidth||null,e.label=t.label,e.audioRoles=t.roles),e},Kc:function(e){return{id:e.id,active:!1,type:"text",bandwidth:0,language:e.language,label:e.label,kind:e.kind||null,width:null,height:null,frameRate:null,pixelAspectRatio:null,mimeType:e.mimeType,codecs:e.codecs||null,audioCodec:null,videoCodec:null,primary:e.primary,roles:e.roles,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:e.originalId}},gd:function(e){return e.__shaka_id||(e.__shaka_id=Gr.Uf++),e.__shaka_id},Uf:0,Of:function(e){var t=Gr.ke(e);return t.active="disabled"!=e.mode,t.type="text",t.originalTextId=e.id,"captions"==e.kind&&(t.mimeType="application/cea-608"),e.kind&&(t.roles=[e.kind]),t},je:function(e){var t=Gr.ke(e);return t.active=e.enabled,t.type="variant",t.originalAudioId=e.id,"main"==e.kind&&(t.primary=!0),e.kind&&(t.roles=[e.kind],t.audioRoles=[e.kind]),t},ke:function(e){return{id:Gr.gd(e),active:!1,type:"",bandwidth:0,language:Mr(e.language),label:e.label,kind:e.kind,width:null,height:null,frameRate:null,pixelAspectRatio:null,mimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null}},Gb:function(e){return e.allowedByApplication&&e.allowedByKeySystem},Bf:function(e){return e.filter((function(e){return Gr.Gb(e)}))},ee:function(e,t){for(var r=e.filter((function(e){return e.audio&&e.audio.channelsCount})),n=new Map,i=(r=f(r)).next();!i.done;i=r.next()){var a=(i=i.value).audio.channelsCount;n.has(a)||n.set(a,[]),n.get(a).push(i)}return 0==(r=Array.from(n.keys())).length?e:(i=r.filter((function(e){return e<=t}))).length?n.get(Math.max.apply(null,i)):n.get(Math.min.apply(null,r))},Wb:function(e,t,r){var n=e,i=e.filter((function(e){return e.primary}));i.length&&(n=i);var a=n.length?n[0].language:"";if(n=n.filter((function(e){return e.language==a})),t){var o=Br(Mr(t),e.map((function(e){return e.language})));o&&(n=e.filter((function(e){return Mr(e.language)==o})))}if(r){if((e=Gr.de(n,r)).length)return e;Y.v("No exact match for the text role could be found.")}else if((e=n.filter((function(e){return 0==e.roles.length}))).length)return e;return(e=n.map((function(e){return e.roles})).reduce(de.Rc,[])).length?Gr.de(n,e[0]):n},de:function(e,t){return e.filter((function(e){return e.roles.includes(t)}))},ie:function(e,t,r){for(var n=0;n<r.length;n++)if(r[n].audio==e&&r[n].video==t)return r[n];return null},Pf:function(e){return"audio"==e.type},Sf:function(e){return"video"==e.type},Kf:function(e){var t=[];return e.audio&&t.push(e.audio),e.video&&t.push(e.video),t},fb:function(e){return Gr.Pf(e)?"type=audio codecs="+e.codecs+" bandwidth="+e.bandwidth+" channelsCount="+e.channelsCount+" audioSamplingRate="+e.audioSamplingRate:Gr.Sf(e)?"type=video codecs="+e.codecs+" bandwidth="+e.bandwidth+" frameRate="+e.frameRate+" width="+e.width+" height="+e.height:"unexpected stream type"}};function Vr(){this.m=null,this.i=!1,this.h=new X,this.l=[],this.o=!1,this.g=this.j=null}function Fr(e,t){return e&&(t=t.filter((function(t){return Gr.rd(t,e,{width:1/0,height:1/0})}))),t.sort((function(e,t){return e.bandwidth-t.bandwidth}))}function jr(e,t){this.g=e,this.h=t}function Hr(e,t){var r=new jr(2,6),n=Kr,i=n.g,a=r.h-i.h;(0<(r.g-i.g||a)?n.i:n.h)(n.g,r,e,t)}function Zr(e,t,r,n){Y.ba([r,"has been deprecated and will be removed in",t,". We are currently at version",e,". Additional information:",n].join(" "))}function Wr(e,t,r,n){Y.kc([r,"has been deprecated and has been removed in",t,". We are now at version",e,". Additional information:",n].join(""))}j("shaka.abr.SimpleAbrManager",Vr),Vr.prototype.stop=function(){this.m=null,this.i=!1,this.l=[],this.j=null},Vr.prototype.stop=Vr.prototype.stop,Vr.prototype.init=function(e){this.m=e},Vr.prototype.init=Vr.prototype.init,Vr.prototype.chooseVariant=function(){var e=Fr(this.g.restrictions,this.l),t=this.h.getBandwidthEstimate(this.g.defaultBandwidthEstimate);this.l.length&&!e.length&&(Y.v("No variants met the ABR restrictions. Choosing a variant by lowest bandwidth."),e=[(e=Fr(null,this.l))[0]]);for(var r=e[0]||null,n=0;n<e.length;++n){var i=e[n],a=i.bandwidth/this.g.bandwidthDowngradeTarget,o=(e[n+1]||{bandwidth:1/0}).bandwidth/this.g.bandwidthUpgradeTarget;Y.O("Bandwidth ranges:",(i.bandwidth/1e6).toFixed(3),(a/1e6).toFixed(3),(o/1e6).toFixed(3)),t>=a&&t<=o&&(r=i)}return this.j=Date.now(),r},Vr.prototype.chooseVariant=Vr.prototype.chooseVariant,Vr.prototype.enable=function(){this.i=!0},Vr.prototype.enable=Vr.prototype.enable,Vr.prototype.disable=function(){this.i=!1},Vr.prototype.disable=Vr.prototype.disable,Vr.prototype.segmentDownloaded=function(e,t){Y.O("Segment downloaded:","deltaTimeMs="+e,"numBytes="+t,"lastTimeChosenMs="+this.j,"enabled="+this.i);var r=this.h;if(!(16e3>t)){var n=8e3*t/e,i=e/1e3;r.g+=t,W(r.h,i,n),W(r.i,i,n)}if(null!=this.j&&this.i)e:{if(Y.O("Suggesting Streams..."),this.o){if(Date.now()-this.j<1e3*this.g.switchInterval){Y.O("Still within switch interval...");break e}}else{if(!(128e3<=this.h.g)){Y.O("Still waiting for a good estimate...");break e}this.o=!0}r=this.chooseVariant(),n=this.h.getBandwidthEstimate(this.g.defaultBandwidthEstimate),Y.debug("Calling switch_(), bandwidth="+Math.round(n/1e3)+" kbps"),this.m(r)}},Vr.prototype.segmentDownloaded=Vr.prototype.segmentDownloaded,Vr.prototype.getBandwidthEstimate=function(){return this.h.getBandwidthEstimate(this.g.defaultBandwidthEstimate)},Vr.prototype.getBandwidthEstimate=Vr.prototype.getBandwidthEstimate,Vr.prototype.setVariants=function(e){this.l=e},Vr.prototype.setVariants=Vr.prototype.setVariants,Vr.prototype.configure=function(e){this.g=e},Vr.prototype.configure=Vr.prototype.configure,jr.prototype.toString=function(){return"v"+this.g+"."+this.h};var Kr=null,Xr="ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "),Yr="buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "),zr=["loop","playbackRate"],Jr=["pause","play"],Qr="abrstatuschanged adaptation buffering drmsessionupdate emsg error expirationupdated largegap loading manifestparsed onstatechange onstateidle streaming textchanged texttrackvisibility timelineregionadded timelineregionenter timelineregionexit trackschanged unloading variantchanged".split(" "),qr={getAssetUri:2,getAudioLanguages:4,getAudioLanguagesAndRoles:4,getBufferedInfo:2,getConfiguration:2,getExpiration:2,getPlaybackRate:2,getTextLanguages:4,getTextLanguagesAndRoles:4,getTextTracks:2,getStats:5,getVariantTracks:2,isAudioOnly:10,isBuffering:1,isInProgress:1,isLive:10,isTextTrackVisible:1,keySystem:10,seekRange:1,usingEmbeddedTextTrack:2,getLoadMode:10},en={getPlayheadTimeAsDate:1,getPresentationStartTimeAsDate:20},tn=[["getConfiguration","configure"]],rn=[["isTextTrackVisible","setTextTrackVisibility"]],nn="addTextTrack cancelTrickPlay configure resetConfiguration retryStreaming selectAudioLanguage selectEmbeddedTextTrack selectTextLanguage selectTextTrack selectVariantTrack selectVariantsByLabel setTextTrackVisibility trickPlay".split(" "),an=["attach","detach","load","unload"];function on(e){return JSON.stringify(e,(function(e,t){if("function"!=typeof t){if(t instanceof Event||t instanceof Be){var r={};for(i in t){var n=t[i];n&&"object"==_typeof$7(n)?"detail"==i&&(r[i]=n):i in Event||(r[i]=n)}return r}if(t instanceof Error){var i=new Set(["name","message","stack"]);for(r in t)i.add(r);for(r=(n=f(Object.getOwnPropertyNames(t))).next();!r.done;r=n.next())i.add(r.value);for(n={},r=(i=f(i)).next();!r.done;r=i.next())n[r=r.value]=t[r];i={__type__:"Error",contents:n}}else if(t instanceof TimeRanges)for(i={__type__:"TimeRanges",length:t.length,start:[],end:[]},r=0;r<t.length;++r)i.start.push(t.start(r)),i.end.push(t.end(r));else i=t instanceof Uint8Array?{__type__:"Uint8Array",entries:Array.from(t)}:"number"==typeof t?isNaN(t)?"NaN":isFinite(t)?t:0>t?"-Infinity":"Infinity":t;return i}}))}function sn(e){return JSON.parse(e,(function(e,t){if("NaN"==t)var r=NaN;else if("-Infinity"==t)r=-1/0;else if("Infinity"==t)r=1/0;else if(t&&"object"==_typeof$7(t)&&"TimeRanges"==t.__type__)r=function(e){return{length:e.length,start:function(t){return e.start[t]},end:function(t){return e.end[t]}}}(t);else if(t&&"object"==_typeof$7(t)&&"Uint8Array"==t.__type__)r=new Uint8Array(t.entries);else if(t&&"object"==_typeof$7(t)&&"Error"==t.__type__){r=t.contents;var n,i=Error(r.message);for(n in r)i[n]=r[n];r=i}else r=t;return r}))}function un(e,t,r,n,i,a){this.X=e,this.j=new $e(t),this.Z=r,this.u=!1,this.F=n,this.P=i,this.L=a,this.h=this.m=!1,this.M="",this.o=null,this.A=this.yd.bind(this),this.C=this.ag.bind(this),this.g={video:{},player:{}},this.J=0,this.i={},this.l=null,mn.add(this)}var cn=!1,ln=null;function dn(e){for(var t=f(mn),r=t.next();!r.done;r=t.next())hn(r.value,e)}function hn(e,t){Y.debug("CastSender: onExistingSessionJoined");var r=e.L();e.l=new ye,e.u=!0,e.Ad(r,t)}function fn(e){for(var t=f(mn),r=t.next();!r.done;r=t.next()){r=r.value;var n=e;Y.debug("CastSender: receiver status",n),cn="available"==n,r.j.Lc()}}function pn(e){var t=ln;t.removeUpdateListener(e.A),t.removeMessageListener("urn:x-cast:com.google.shaka.v2",e.C)}function gn(e){for(var t in e.i){var r=e.i[t];delete e.i[t],r.reject(new z(1,7,7e3))}}function yn(t,r){var n=on(r),i=ln;try{i.sendMessage("urn:x-cast:com.google.shaka.v2",n,(function(){}),Y.error)}catch(e){throw Y.error("Cast session sendMessage threw",e),n=new z(2,8,8005,e),t.F("player",new Be("error",{detail:n})),t.Bb(),n}}(i=un.prototype).destroy=function(){return mn.delete(this),gn(this),ln&&pn(this),this.j&&(this.j.stop(),this.j=null),this.P=this.F=null,this.h=this.m=!1,this.C=this.A=this.l=this.i=this.g=this.o=null,Promise.resolve()},i.la=function(){return this.h},i.Dd=function(){return this.M},i.init=function(){if(this.X.length)if(t.chrome&&chrome.cast&&chrome.cast.isAvailable){this.m=!0,this.j.Lc();var e=new chrome.cast.SessionRequest(this.X);e=new chrome.cast.ApiConfig(e,dn.bind(this),fn.bind(this),"origin_scoped"),chrome.cast.initialize(e,(function(){Y.debug("CastSender: init")}),(function(e){Y.error("CastSender: init error",e)})),cn&&this.j.V(.02),(e=ln)&&e.status!=chrome.cast.SessionStatus.STOPPED?(Y.debug("CastSender: re-using existing connection"),hn(this,e)):ln=null}else t.__onGCastApiAvailable||(t.__onGCastApiAvailable=vn),t.__onGCastApiAvailable!=vn&&Y.ba("A global Cast SDK hook is already installed! Shaka Player will be unable to receive a notification when the Cast SDK is ready.")},i.Md=function(e){this.o=e,this.h&&yn(this,{type:"appData",appData:this.o})},i.cast=function(e){return this.m?cn?this.h?Promise.reject(new z(1,8,8002)):(this.l=new ye,chrome.cast.requestSession(this.Ad.bind(this,e),this.ve.bind(this)),this.l):Promise.reject(new z(1,8,8001)):Promise.reject(new z(1,8,8e3))},i.Bb=function(){if(this.h){if(gn(this),ln){pn(this);try{ln.stop((function(){}),(function(){}))}catch(u){}ln=null}this.yd()}},i.get=function(e,t){if("video"==e){if(Jr.includes(t))return this.Ee.bind(this,e,t)}else if("player"==e){if(en[t]&&!this.get("player","isLive")())return function(){};if(nn.includes(t))return this.Ee.bind(this,e,t);if(an.includes(t))return this.rg.bind(this,e,t);if(qr[t])return this.Be.bind(this,e,t)}return this.Be(e,t)},i.set=function(e,t,r){this.g[e][t]=r,yn(this,{type:"set",targetName:e,property:t,value:r})},i.Ad=function(e,t){Y.debug("CastSender: onSessionInitiated"),ln=t,t.addUpdateListener(this.A),t.addMessageListener("urn:x-cast:com.google.shaka.v2",this.C),this.yd(),yn(this,{type:"init",initState:e,appData:this.o}),this.l.resolve()},i.ve=function(e){var t=8003;switch(e.code){case"cancel":t=8004;break;case"timeout":t=8005;break;case"receiver_unavailable":t=8006}this.l.reject(new z(2,8,t,e))},i.Be=function(e,t){return this.g[e][t]},i.Ee=function(e,t,r){for(var n=[],i=2;i<arguments.length;++i)n[i-2]=arguments[i];yn(this,{type:"call",targetName:e,methodName:t,args:n})},i.rg=function(e,t,r){for(var n=[],i=2;i<arguments.length;++i)n[i-2]=arguments[i];i=new ye;var a=this.J.toString();this.J++,this.i[a]=i;try{yn(this,{type:"asyncCall",targetName:e,methodName:t,args:n,id:a})}catch(o){i.reject(o)}return i},i.yd=function(){var e=!!ln&&"connected"==ln.status;if(Y.debug("CastSender: connection status",e),this.h&&!e){for(var t in this.P(),this.g)this.g[t]={};gn(this)}this.M=(this.h=e)?ln.receiver.friendlyName:"",this.j.Lc()},i.ag=function(e,t){var r=sn(t);switch(Y.O("CastSender: message",r),r.type){case"event":var n=r.event;this.F(r.targetName,new Be(n.type,n));break;case"update":for(var i in n=r.update)for(var a in r=this.g[i]||{},n[i])r[a]=n[i][a];this.u&&(this.Z(),this.u=!1);break;case"asyncComplete":if(i=r.id,r=r.error,a=this.i[i],delete this.i[i],a)if(r){for(n in i=new z(r.severity,r.category,r.code),r)i[n]=r[n];a.reject(i)}else a.resolve()}};var mn=new Set;function vn(e){if(e)for(var t=(e=f(mn)).next();!t.done;t=e.next())t.value.init()}function _n(e,t,r){var n=this;Ge.call(this),this.i=e,this.h=t,this.o=this.l=this.j=this.u=this.m=null,this.C=r,this.A=new Map,this.g=new un(r,(function(){return En(n)}),(function(){return Sn(n)}),(function(e,t){return Cn(n,e,t)}),(function(){return Tn(n)}),(function(){return An(n)})),function(e){for(var t in e.g.init(),e.o=new tt,Xr.forEach(function(e){this.o.H(this.i,e,this.L.bind(this))}.bind(e)),Qr.forEach(function(e){this.o.H(this.h,e,this.F.bind(this))}.bind(e)),e.m={},e.i)Object.defineProperty(e.m,t,{configurable:!1,enumerable:!0,get:e.J.bind(e,t),set:e.M.bind(e,t)});e.u={},bn(e,(function(t){Object.defineProperty(e.u,t,{configurable:!1,enumerable:!0,get:function(){return wn(e,t)}})})),function(e){var t=new Map;bn(e,(function(r,n){if(t.has(n)){var i=t.get(n);r.length<i.length?e.A.set(r,i):e.A.set(i,r)}else t.set(n,r)}))}(e),e.j=new Ge,e.j.jc=e.m,e.l=new Ge,e.l.jc=e.u}(this)}function bn(e,t){function r(e){return"constructor"!=e&&"function"==typeof n[e]&&!i.has(e)}var n=e.h,i=new Set;for(a in n)r(a)&&(i.add(a),t(a,n[a]));for(var a=Object.getPrototypeOf(n),o=Object.getPrototypeOf({});a&&a!=o;){for(var s=f(Object.getOwnPropertyNames(a)),u=s.next();!u.done;u=s.next())r(u=u.value)&&(i.add(u),t(u,n[u]));a=Object.getPrototypeOf(a)}}function An(e){var t={video:{},player:{},playerAfterLoad:{},manifest:e.h.tc(),startTime:null};return e.i.pause(),zr.forEach(function(e){t.video[e]=this.i[e]}.bind(e)),e.i.ended||(t.startTime=e.i.currentTime),tn.forEach(function(e){var r=e[1];e=this.h[e[0]](),t.player[r]=e}.bind(e)),rn.forEach(function(e){var r=e[1];e=this.h[e[0]](),t.playerAfterLoad[r]=e}.bind(e)),t}function En(e){e.dispatchEvent(new Be("caststatuschanged"))}function Sn(e){e.j.dispatchEvent(new Be(e.m.paused?"pause":"play"))}function Tn(e){tn.forEach(function(e){var t=e[1];e=this.g.get("player",e[0])(),this.h[t](e)}.bind(e));var t=e.g.get("player","getAssetUri")(),r=e.g.get("video","ended"),n=Promise.resolve(),i=e.i.autoplay,a=null;r||(a=e.g.get("video","currentTime")),t&&(e.i.autoplay=!1,n=e.h.load(t,a));var o={};zr.forEach(function(e){o[e]=this.g.get("video",e)}.bind(e)),n.then((function(){e.i&&(zr.forEach(function(e){this.i[e]=o[e]}.bind(e)),rn.forEach(function(e){var t=e[1];e=this.g.get("player",e[0])(),this.h[t](e)}.bind(e)),e.i.autoplay=i,t&&e.i.play())}),(function(t){e.h.dispatchEvent(new Be("error",{detail:t}))}))}function wn(e,t){if(e.A.has(t)&&(t=e.A.get(t)),"addEventListener"==t)return e.l.addEventListener.bind(e.l);if("removeEventListener"==t)return e.l.removeEventListener.bind(e.l);if("getMediaElement"==t)return function(){return this.m}.bind(e);if("getSharedConfiguration"==t)return Y.v("Can't share configuration across a network. Returning copy."),e.g.get("player","getConfiguration");if("getNetworkingEngine"==t)return e.g.la()&&Y.v("NOTE: getNetworkingEngine() is always local!"),e.h.Yb.bind(e.h);if(e.g.la()){if("getManifest"==t||"drmInfo"==t)return function(){return Y.ba(t+"() does not work while casting!"),null};if("getManifestUri"==t)return Hr("getManifestUri",'Please use "getAssetUri" instead.'),wn(e,"getAssetUri");if("attach"==t||"detach"==t)return function(){return Y.ba(t+"() does not work while casting!"),Promise.resolve()}}return e.g.la()&&0==Object.keys(e.g.g.video).length&&qr[t]||!e.g.la()?e.h[t].bind(e.h):e.g.get("player",t)}function Cn(e,t,r){e.g.la()&&("video"==t?e.j.dispatchEvent(r):"player"==t&&e.l.dispatchEvent(r))}function kn(e,t,r,n){var i=this;Ge.call(this),this.g=e,this.h=t,this.i=new tt,this.L={video:e,player:t},this.C=r||function(){},this.M=n||function(e){return e},this.F=!1,this.m=!0,this.l=0,this.A=!1,this.u=!0,this.o=this.j=null,this.J=new $e((function(){$n(i)})),function(e){var t=cast.receiver.CastReceiverManager.getInstance();t.onSenderConnected=e.xe.bind(e),t.onSenderDisconnected=e.xe.bind(e),t.onSystemVolumeChanged=e.hf.bind(e),e.o=t.getCastMessageBus("urn:x-cast:com.google.cast.media"),e.o.onMessage=e.Wf.bind(e),e.j=t.getCastMessageBus("urn:x-cast:com.google.shaka.v2"),e.j.onMessage=e.fg.bind(e),t.start(),Xr.forEach(function(e){this.i.H(this.g,e,this.Ce.bind(this,"video"))}.bind(e)),Qr.forEach(function(e){this.i.H(this.h,e,this.Ce.bind(this,"player"))}.bind(e)),cast.__platform__&&cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160')?e.h.Nd(3840,2160):e.h.Nd(1920,1080),e.i.H(e.g,"loadeddata",function(){this.A=!0}.bind(e)),e.i.H(e.h,"loading",function(){this.m=!1,In(this)}.bind(e)),e.i.H(e.g,"playing",function(){this.m=!1,In(this)}.bind(e)),e.i.H(e.g,"pause",function(){In(this)}.bind(e)),e.i.H(e.h,"unloading",function(){this.m=!0,In(this)}.bind(e)),e.i.H(e.g,"ended",function(){var e=this;new $e((function(){e.g&&e.g.ended&&(e.m=!0,In(e))})).V(5)}.bind(e))}(this)}function In(e){Promise.resolve().then(function(){this.h&&(this.dispatchEvent(new Be("caststatuschanged")),Pn(this)||On(this))}.bind(e))}function $n(e){e.J.V(.5);var t={video:{},player:{}};if(Yr.forEach(function(e){t.video[e]=this.g[e]}.bind(e)),e.h.aa())for(var r in en)0==e.l%en[r]&&(t.player[r]=e.h[r]());for(var n in qr)0==e.l%qr[n]&&(t.player[n]=e.h[n]());(r=cast.receiver.CastReceiverManager.getInstance().getSystemVolume())&&(t.video.volume=r.level,t.video.muted=r.muted),e.A&&(e.l+=1),Rn(e,{type:"update",update:t},e.j),Pn(e)}function Pn(e){return!(!e.u||!e.g.duration&&!e.h.aa()||(xn(e),e.u=!1,0))}function xn(e,t){t=void 0===t?0:t;var r={contentId:e.h.tc(),streamType:e.h.aa()?"LIVE":"BUFFERED",contentType:""};e.h.aa()||(r.duration=e.g.duration),On(e,t,r)}function Rn(e,t,r,n){e.F&&(e=on(t),n?r.getCastChannel(n).send(e):r.broadcast(e))}function On(e,t,r){t=void 0===t?0:t,r=void 0===r?null:r;var n=e.g.playbackRate,i=Dn;n={mediaSessionId:0,playbackRate:n,playerState:i=e.m?i.IDLE:e.h.jd()?i.Re:e.g.paused?i.Te:i.Ue,currentTime:e.g.currentTime,supportedMediaCommands:63,volume:{level:e.g.volume,muted:e.g.muted}},r&&(n.media=r),Rn(e,{requestId:t,type:"MEDIA_STATUS",status:[n]},e.o)}H(_n,Ge),j("shaka.cast.CastProxy",_n),_n.prototype.destroy=function(e){return e&&this.g.Bb(),this.o&&(this.o.release(),this.o=null),e=[],this.h&&(e.push(this.h.destroy()),this.h=null),this.g&&(e.push(this.g.destroy()),this.g=null),this.u=this.m=this.i=null,Promise.all(e)},_n.prototype.destroy=_n.prototype.destroy,_n.prototype.Mf=function(){return this.m},_n.prototype.getVideo=_n.prototype.Mf,_n.prototype.Df=function(){return this.u},_n.prototype.getPlayer=_n.prototype.Df,_n.prototype.Ye=function(){return this.g.m&&cn},_n.prototype.canCast=_n.prototype.Ye,_n.prototype.la=function(){return this.g.la()},_n.prototype.isCasting=_n.prototype.la,_n.prototype.Dd=function(){return this.g.Dd()},_n.prototype.receiverName=_n.prototype.Dd,_n.prototype.cast=function(){var e=An(this);return this.g.cast(e).then(function(){if(this.h)return this.h.Ud()}.bind(this))},_n.prototype.cast=_n.prototype.cast,_n.prototype.Md=function(e){this.g.Md(e)},_n.prototype.setAppData=_n.prototype.Md,_n.prototype.Kg=function(){var e=this.g;if(e.h){var t=e.L();chrome.cast.requestSession(e.Ad.bind(e,t),e.ve.bind(e))}},_n.prototype.suggestDisconnect=_n.prototype.Kg,_n.prototype.af=function(e){var t=this;return g((function r(){return N(r,(function(r){switch(r.s){case 1:return e==t.C?r.return():(t.C=e,t.g.Bb(),w(r,t.g.destroy(),2));case 2:t.g=null,t.g=new un(e,(function(){return En(t)}),(function(){return Sn(t)}),(function(e,r){return Cn(t,e,r)}),(function(){return Tn(t)}),(function(){return An(t)})),t.g.init(),C(r)}}))}))},_n.prototype.changeReceiverId=_n.prototype.af,_n.prototype.Bb=function(){this.g.Bb()},_n.prototype.forceDisconnect=_n.prototype.Bb,_n.prototype.J=function(e){if("addEventListener"==e)return this.j.addEventListener.bind(this.j);if("removeEventListener"==e)return this.j.removeEventListener.bind(this.j);if(this.g.la()&&0==Object.keys(this.g.g.video).length){var t=this.i[e];if("function"!=typeof t)return t}return this.g.la()?this.g.get("video",e):("function"==typeof(e=this.i[e])&&(e=e.bind(this.i)),e)},_n.prototype.M=function(e,t){this.g.la()?this.g.set("video",e,t):this.i[e]=t},_n.prototype.L=function(e){this.g.la()||this.j.dispatchEvent(new Be(e.type,e))},_n.prototype.F=function(e){this.g.la()||this.l.dispatchEvent(e)},H(kn,Ge),j("shaka.cast.CastReceiver",kn),kn.prototype.isConnected=function(){return this.F},kn.prototype.isConnected=kn.prototype.isConnected,kn.prototype.Rf=function(){return this.m},kn.prototype.isIdle=kn.prototype.Rf,kn.prototype.destroy=function(){var e=this;return g((function t(){var r;return N(t,(function(t){switch(t.s){case 1:return e.i&&(e.i.release(),e.i=null),r=[],e.h&&(r.push(e.h.destroy()),e.h=null),e.J&&(e.J.stop(),e.J=null),e.g=null,e.L=null,e.C=null,e.F=!1,e.m=!0,e.j=null,e.o=null,w(t,Promise.all(r),2);case 2:cast.receiver.CastReceiverManager.getInstance().stop(),C(t)}}))}))},kn.prototype.destroy=kn.prototype.destroy,(i=kn.prototype).xe=function(){this.l=0,this.u=!0,this.F=0!=cast.receiver.CastReceiverManager.getInstance().getSenders().length,In(this)},i.Ce=function(e,t){this.h&&($n(this),Rn(this,{type:"event",targetName:e,event:t},this.j))},i.hf=function(){var e=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();e&&Rn(this,{type:"update",update:{video:{volume:e.level,muted:e.muted}}},this.j),Rn(this,{type:"event",targetName:"video",event:{type:"volumechange"}},this.j)},i.fg=function(e){var t=sn(e.data);switch(Y.debug("CastReceiver: message",t),t.type){case"init":this.l=0,this.A=!1,this.u=!0,function(e,t,r){for(var n in t.player)e.h[n](t.player[n]);e.C(r),r=Promise.resolve();var i=e.g.autoplay;t.manifest&&(e.g.autoplay=!1,r=e.h.load(t.manifest,t.startTime)),r.then((function(){if(e.h){for(var r in t.video)e.g[r]=t.video[r];for(var n in t.playerAfterLoad)e.h[n](t.playerAfterLoad[n]);e.g.autoplay=i,t.manifest&&(e.g.play(),On(e))}}),(function(t){e.h.dispatchEvent(new Be("error",{detail:t}))}))}(this,t.initState,t.appData),$n(this);break;case"appData":this.C(t.appData);break;case"set":var r=t.targetName,n=t.property;if(t=t.value,"video"==r){var i=cast.receiver.CastReceiverManager.getInstance();if("volume"==n){i.setSystemVolumeLevel(t);break}if("muted"==n){i.setSystemVolumeMuted(t);break}}this.L[r][n]=t;break;case"call":(r=this.L[t.targetName])[t.methodName].apply(r,t.args);break;case"asyncCall":r=t.targetName,n=t.methodName,"player"==r&&"load"==n&&(this.l=0,this.A=!1),i=t.id,e=e.senderId;var a=this.L[r];t=a[n].apply(a,t.args),"player"==r&&"load"==n&&(t=t.then(function(){this.u=!0}.bind(this))),t.then(this.Je.bind(this,e,i,null),this.Je.bind(this,e,i))}},i.Wf=function(e){var t=sn(e.data);switch(Y.debug("CastReceiver: message",t),t.type){case"PLAY":this.g.play(),On(this);break;case"PAUSE":this.g.pause(),On(this);break;case"SEEK":e=t.currentTime;var r=t.resumeState;null!=e&&(this.g.currentTime=Number(e)),r&&"PLAYBACK_START"==r?(this.g.play(),On(this)):r&&"PLAYBACK_PAUSE"==r&&(this.g.pause(),On(this));break;case"STOP":this.h.Ud().then(function(){this.h&&On(this)}.bind(this));break;case"GET_STATUS":xn(this,Number(t.requestId));break;case"VOLUME":e=(r=t.volume).level,r=r.muted;var n=this.g.volume,i=this.g.muted;null!=e&&(this.g.volume=Number(e)),null!=r&&(this.g.muted=r),n==this.g.volume&&i==this.g.muted||On(this);break;case"LOAD":this.l=0,this.u=this.A=!1,e=t.media,r=t.currentTime,n=this.M(e.contentId),i=t.autoplay||!0,this.C(e.customData),i&&(this.g.autoplay=!0),this.h.load(n,r).then(function(){this.h&&xn(this)}.bind(this)).catch(function(e){var r="LOAD_FAILED";7==e.category&&7e3==e.code&&(r="LOAD_CANCELLED"),Rn(this,{requestId:Number(t.requestId),type:r},this.o)}.bind(this));break;default:Y.v("Unrecognized message type from the generic Chromecast controller!",t.type),Rn(this,{requestId:Number(t.requestId),type:"INVALID_REQUEST",reason:"INVALID_COMMAND"},this.o)}},i.Je=function(e,t,r){this.h&&Rn(this,{type:"asyncComplete",id:t,error:r},this.j,e)};var Dn={IDLE:"IDLE",Ue:"PLAYING",Re:"BUFFERING",Te:"PAUSED"};function Ln(e,t){this.S=e,this.h=t==Mn,this.g=0}j("shaka.util.DataViewReader",Ln);var Mn=1;function Nn(){throw new z(2,3,3e3)}function Bn(){this.i=[],this.h=[],this.g=!1}function Un(e){for(var t=Hn(e);e.reader.Ca()&&!e.parser.g;)e.parser.Fc(e.start+t,e.reader,e.partialOkay)}function Gn(e){for(var t=Hn(e),r=e.reader.N();0<r&&!e.parser.g;--r)e.parser.Fc(e.start+t,e.reader,e.partialOkay)}function Vn(e){return function(t){e(t.reader.mb(t.reader.S.byteLength-t.reader.ka()))}}function Fn(e){for(var t=0,r=0;r<e.length;r++)t=t<<8|e.charCodeAt(r);return t}function jn(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)}function Hn(e){return 8+(e.has64BitSize?8:0)+(null!=e.flags?4:0)}function Zn(e){var t=this;this.g=[],this.h=[],this.data=[],(new Bn).box("moov",Un).ma("pssh",(function(e){if(1<e.version)Y.v("Unrecognized PSSH version found!");else{var r=e.reader.S;if(r=new Uint8Array(r.buffer,r.byteOffset-12,e.size),t.data.push(r),t.g.push(Te.Nc(e.reader.mb(16))),0<e.version){r=e.reader.N();for(var n=0;n<r;++n){var i=Te.Nc(e.reader.mb(16));t.h.push(i)}}}})).parse(e),0==this.data.length&&Y.v("No pssh box found!")}Ln.Endianness={Tg:0,Vg:Mn},Ln.prototype.Ca=function(){return this.g<this.S.byteLength},Ln.prototype.hasMoreData=Ln.prototype.Ca,Ln.prototype.ka=function(){return this.g},Ln.prototype.getPosition=Ln.prototype.ka,Ln.prototype.sf=function(){return this.S.byteLength},Ln.prototype.getLength=Ln.prototype.sf,Ln.prototype.ra=function(){try{var e=this.S.getUint8(this.g);return this.g+=1,e}catch(t){Nn()}},Ln.prototype.readUint8=Ln.prototype.ra,Ln.prototype.dc=function(){try{var e=this.S.getUint16(this.g,this.h);return this.g+=2,e}catch(t){Nn()}},Ln.prototype.readUint16=Ln.prototype.dc,Ln.prototype.N=function(){try{var e=this.S.getUint32(this.g,this.h);return this.g+=4,e}catch(t){Nn()}},Ln.prototype.readUint32=Ln.prototype.N,Ln.prototype.De=function(){try{var e=this.S.getInt32(this.g,this.h);return this.g+=4,e}catch(t){Nn()}},Ln.prototype.readInt32=Ln.prototype.De,Ln.prototype.Pb=function(){try{if(this.h)var e=this.S.getUint32(this.g,!0),t=this.S.getUint32(this.g+4,!0);else t=this.S.getUint32(this.g,!1),e=this.S.getUint32(this.g+4,!1)}catch(r){Nn()}if(2097151<t)throw new z(2,3,3001);return this.g+=8,t*Math.pow(2,32)+e},Ln.prototype.readUint64=Ln.prototype.Pb,Ln.prototype.mb=function(e){this.g+e>this.S.byteLength&&Nn();var t=new Uint8Array(this.S.buffer,this.S.byteOffset+this.g,e);return this.g+=e,t},Ln.prototype.readBytes=Ln.prototype.mb,Ln.prototype.U=function(e){this.g+e>this.S.byteLength&&Nn(),this.g+=e},Ln.prototype.skip=Ln.prototype.U,Ln.prototype.Fe=function(e){this.g<e&&Nn(),this.g-=e},Ln.prototype.rewind=Ln.prototype.Fe,Ln.prototype.seek=function(e){(0>e||e>this.S.byteLength)&&Nn(),this.g=e},Ln.prototype.seek=Ln.prototype.seek,Ln.prototype.Cd=function(){for(var e=this.g;this.Ca()&&0!=this.S.getUint8(this.g);)this.g+=1;return e=new Uint8Array(this.S.buffer,this.S.byteOffset+e,this.g-e),this.g+=1,me(e)},Ln.prototype.readTerminatedString=Ln.prototype.Cd,j("shaka.util.Mp4Parser",Bn),Bn.prototype.box=function(e,t){var r=Fn(e);return this.i[r]=0,this.h[r]=t,this},Bn.prototype.box=Bn.prototype.box,Bn.prototype.ma=function(e,t){var r=Fn(e);return this.i[r]=1,this.h[r]=t,this},Bn.prototype.fullBox=Bn.prototype.ma,Bn.prototype.stop=function(){this.g=!0},Bn.prototype.stop=Bn.prototype.stop,Bn.prototype.parse=function(e,t){var r=new Uint8Array(e);for(r=new Ln(new DataView(r.buffer,r.byteOffset,r.byteLength),0),this.g=!1;r.Ca()&&!this.g;)this.Fc(0,r,t)},Bn.prototype.parse=Bn.prototype.parse,Bn.prototype.Fc=function(e,t,r){var n=t.ka(),i=t.N(),a=t.N(),o=!1;switch(Y.O("Parsing MP4 box",jn(a)),i){case 0:i=t.S.byteLength-n;break;case 1:i=t.Pb(),o=!0}var s=this.h[a];if(s){var u=null,c=null;1==this.i[a]&&(u=(c=t.N())>>>24,c&=16777215),a=n+i,r&&a>t.S.byteLength&&(a=t.S.byteLength),a-=t.ka(),t=0<a?t.mb(a):new Uint8Array(0),s({parser:this,partialOkay:r||!1,version:u,flags:c,reader:t=new Ln(new DataView(t.buffer,t.byteOffset,t.byteLength),0),size:i,start:n+e,has64BitSize:o})}else t.U(Math.min(n+i-t.ka(),t.S.byteLength-t.ka()))},Bn.prototype.parseNext=Bn.prototype.Fc,Bn.children=Un,Bn.sampleDescription=Gn,Bn.allData=Vn,Bn.typeToString=jn,Bn.headerSize=Hn;var Wn={sc:function(e,t){var r=Wn.Y(e,t);return 1!=r.length?null:r[0]},Yc:function(e,t,r){return 1!=(e=Wn.fe(e,t,r)).length?null:e[0]},Y:function(e,t){return Array.prototype.filter.call(e.childNodes,(function(e){return e instanceof Element&&e.tagName==t}))},fe:function(e,t,r){return Array.prototype.filter.call(e.childNodes,(function(e){return e instanceof Element&&e.localName==r&&e.namespaceURI==t}))},getAttributeNS:function(e,t,r){return e.hasAttributeNS(t,r)?e.getAttributeNS(t,r):null},uc:function(e){return Array.prototype.every.call(e.childNodes,(function(e){return e.nodeType==Node.TEXT_NODE||e.nodeType==Node.CDATA_SECTION_NODE}))?e.textContent.trim():null},R:function(e,t,r,n){n=void 0===n?null:n;var i=null;return null!=(e=e.getAttribute(t))&&(i=r(e)),null==i?n:i},jg:function(e){return e?(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(e)&&(e+="Z"),e=Date.parse(e),isNaN(e)?null:Math.floor(e/1e3)):null},Ma:function(e){if(!e)return null;var t=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(e);return t?(e=31536e3*Number(t[1]||null)+2592e3*Number(t[2]||null)+86400*Number(t[3]||null)+3600*Number(t[4]||null)+60*Number(t[5]||null)+Number(t[6]||null),isFinite(e)?e:null):(Y.v("Invalid duration string:",e),null)},Hc:function(e){var t=/([0-9]+)-([0-9]+)/.exec(e);return t?(e=Number(t[1]),isFinite(e)?(t=Number(t[2]),isFinite(t)?{start:e,end:t}:null):null):null},parseInt:function(e){return 0==(e=Number(e))%1?e:null},Gc:function(e){return 0==(e=Number(e))%1&&0<e?e:null},Mb:function(e){return 0==(e=Number(e))%1&&0<=e?e:null},parseFloat:function(e){return e=Number(e),isNaN(e)?null:e},ff:function(e){var t;return e=(t=e.match(/^(\d+)\/(\d+)$/))?Number(t[1])/Number(t[2]):Number(e),isNaN(e)?null:e},Ae:function(e,t){var r=new DOMParser;try{var n=r.parseFromString(e,"text/xml")}catch(a){}if(n&&n.documentElement.tagName==t)var i=n.documentElement;return i&&0<i.getElementsByTagName("parsererror").length?null:i},ze:function(e,t){try{var r=me(e);return Wn.Ae(r,t)}catch(n){}}},Kn=(new Map).set("urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b","org.w3.clearkey").set("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine.alpha").set("urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95","com.microsoft.playready").set("urn:uuid:79f0049a-4098-8642-ab92-e65be0885f95","com.microsoft.playready").set("urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb","com.adobe.primetime");function Xn(e,t,r){var n=function(e){for(var t=[],r=(e=f(e)).next();!r.done;r=e.next())(r=Jn(r.value))&&t.push(r);return t}(e),i=null;e=[];var a=[],o=new Set(n.map((function(e){return e.keyId})));if(o.delete(null),1<o.size)throw new z(2,4,4010);if(r||(a=n.filter((function(e){return"urn:mpeg:dash:mp4protection:2011"!=e.Ge||(i=e.init||i,!1)}))).length&&(e=function(e,t,r){for(var n=[],i=(r=f(r)).next();!i.done;i=r.next()){i=i.value;var a=Kn.get(i.Ge);if(a){var o;if(o=Wn.Yc(i.node,"urn:microsoft:playready","pro")){o=Te.Ja(o.textContent);var s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),u=o.length,c=s.length+16+u,l=new ArrayBuffer(c),d=new Uint8Array(l),h=0;(l=new DataView(l)).setUint32(h,c),h+=4,l.setUint32(h,1886614376),h+=4,l.setUint32(h,0),h+=4,d.set(s,h),h+=s.length,l.setUint32(h,u),h+=4,d.set(o,h),o=[{initData:d,initDataType:"cenc",keyId:i.keyId}]}else o=null;o=fe(a,i.init||e||o),(a=zn.get(a))&&(o.licenseServerUri=a(i)),n.push(o)}else for(a=(i=f(i=t(i.node)||[])).next();!a.done;a=i.next())n.push(a.value)}return n}(i,t,a),0==e.length&&(e=[fe("",i)])),n.length&&(r||!a.length))for(e=[],r=(t=f(Kn.values())).next();!r.done;r=t.next())"org.w3.clearkey"!=(r=r.value)&&e.push(fe(r,i));if(o=Array.from(o)[0]||null)for(r=(t=f(e)).next();!r.done;r=t.next())for(n=(r=f(r.value.initData)).next();!n.done;n=r.next())n.value.keyId=o;return{be:o,Xg:i,drmInfos:e,ge:!0}}var Yn,zn=(new Map).set("com.widevine.alpha",(function(e){return(e=Wn.Yc(e.node,"urn:microsoft","laurl"))&&e.getAttribute("licenseUrl")||""})).set("com.microsoft.playready",(function(e){return(e=Wn.Yc(e.node,"urn:microsoft:playready","pro"))&&(e=function(e){var t=0,r=new DataView(e).getUint32(t,!0);if(t+=4,r!==e.byteLength)return Y.v("PlayReady Object with invalid length encountered."),[];t+=2,r=[];for(var n=new DataView(e);t<e.byteLength-1;){var i=n.getUint16(t,!0);t+=2;var a=n.getUint16(t,!0);t+=2;var o=new Uint8Array(e,t,a);r.push({type:i,value:o}),t+=a}return r}((e=Te.Ja(e.textContent)).buffer).filter((function(e){return 1===e.type}))[0])?(e=ve(e.value,!0),(e=Wn.Ae(e,"WRMHEADER"))?function(e){for(var t=(e=f(e.getElementsByTagName("DATA"))).next();!t.done;t=e.next())for(var r=(t=f(t.value.childNodes)).next();!r.done;r=t.next())if((r=r.value)instanceof Element&&"LA_URL"==r.tagName)return r.textContent;return""}(e):""):""}));function Jn(e){var t=e.getAttribute("schemeIdUri"),r=Wn.getAttributeNS(e,"urn:mpeg:cenc:2013","default_KID"),n=Wn.fe(e,"urn:mpeg:cenc:2013","pssh").map(Wn.uc);if(!t)return Y.error("Missing required schemeIdUri attribute on","ContentProtection element",e),null;if(t=t.toLowerCase(),r&&(r=r.replace(/-/g,"").toLowerCase()).includes(" "))throw new z(2,4,4009);var i=[];try{i=n.map((function(e){return{initDataType:"cenc",initData:Te.Ja(e),keyId:null}}))}catch(a){throw new z(2,4,4007)}return{node:e,Ge:t,keyId:r,init:0<i.length?i:null}}function Qn(e,r,n,i,a){var o={RepresentationID:r,Number:n,Bandwidth:i,Time:a};return e.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,(function(r,n,i,a){if("$$"==r)return"$";var s=o[n];if(null==s)return Y.v("URL template does not have an available substitution for identifier",'"'+n+'":',e),r;switch("RepresentationID"==n&&i&&(Y.v("URL template should not contain a width specifier for identifier",'"RepresentationID":',e),i=void 0),"Time"==n&&(s=Math.round(s)),a){case void 0:case"d":case"i":case"u":r=s.toString();break;case"o":r=s.toString(8);break;case"x":r=s.toString(16);break;case"X":r=s.toString(16).toUpperCase();break;default:r=s.toString()}return i=t.parseInt(i,10)||1,Array(Math.max(0,i-r.length)+1).join("0")+r}))}function qn(e,t){var r=ei(e,t,"timescale"),n=1;r&&(n=Wn.Gc(r)||1),r=ei(e,t,"duration"),(r=Wn.Gc(r||""))&&(r/=n);var i=ei(e,t,"startNumber"),a=Number(ei(e,t,"presentationTimeOffset"))||0,o=Wn.Mb(i||"");null!=i&&null!=o||(o=1);var s=ti(e,t,"SegmentTimeline");if(i=null,s){i=n;var u=e.$.duration||1/0;s=Wn.Y(s,"S");for(var c=[],l=-a,d=0;d<s.length;++d){var h=s[d],f=Wn.R(h,"t",Wn.Mb),p=Wn.R(h,"d",Wn.Mb),g=Wn.R(h,"r",Wn.parseInt);if(null!=f&&(f-=a),!p){Y.v('"S" element must have a duration:','ignoring the remaining "S" elements.',h);break}if(f=null!=f?f:l,0>(g=g||0))if(d+1<s.length){if(null==(g=Wn.R(s[d+1],"t",Wn.Mb))){Y.v('An "S" element cannot have a negative repeat','if the next "S" element does not have a valid start time:','ignoring the remaining "S" elements.',h);break}if(f>=g){Y.v('An "S" element cannot have a negative repeat','if its start time exceeds the next "S" element\'s start time:','ignoring the remaining "S" elements.',h);break}g=Math.ceil((g-f)/p)-1}else{if(1/0==u){Y.v('The last "S" element cannot have a negative repeat',"if the Period has an infinite duration:",'ignoring the last "S" element.',h);break}if(f/i>=u){Y.v('The last "S" element cannot have a negative repeat',"if its start time exceeds the Period's duration:",'igoring the last "S" element.',h);break}g=Math.ceil((u*i-f)/p)-1}for(0<c.length&&f!=l&&(Math.abs((f-l)/i)>=ge&&Y.v("SegmentTimeline contains a large gap/overlap:","the content may have errors in it.",h),c[c.length-1].end=f/i),h=0;h<=g;++h)l=f+p,c.push({start:f/i,end:l/i,Pg:f}),f=l}i=c}return{timescale:n,ia:r,ob:o,sa:a/n||0,Vd:a,W:i}}function ei(e,t,r){return[t(e.G),t(e.fa),t(e.qa)].filter(de.Ra).map((function(e){return e.getAttribute(r)})).reduce((function(e,t){return e||t}))}function ti(e,t,r){return[t(e.G),t(e.fa),t(e.qa)].filter(de.Ra).map((function(e){return Wn.sc(e,r)})).reduce((function(e,t){return e||t}))}function ri(e,t,r,n,i,a){if(a=void 0===a?0:a,Wn.getAttributeNS(e,"http://www.w3.org/1999/xlink","href")){var o=function(e,t,r,n,i,a){for(var o=Wn.getAttributeNS(e,"http://www.w3.org/1999/xlink","href"),s=Wn.getAttributeNS(e,"http://www.w3.org/1999/xlink","actuate")||"onRequest",u=0;u<e.attributes.length;u++){var c=e.attributes[u];"http://www.w3.org/1999/xlink"==c.namespaceURI&&(e.removeAttributeNS(c.namespaceURI,c.localName),--u)}if(5<=a)return Oe(new z(2,4,4028));if("onLoad"!=s)return Oe(new z(2,4,4027));var l=he([n],[o]);return i.request(0,ze(l,t)).ca((function(n){if(!(n=Wn.ze(n.data,e.tagName)))return Oe(new z(2,4,4001,o));for(;e.childNodes.length;)e.removeChild(e.childNodes[0]);for(;n.childNodes.length;){var s=n.childNodes[0];n.removeChild(s),e.appendChild(s)}for(s=0;s<n.attributes.length;s++){var u=n.attributes[s].nodeName,c=n.getAttribute(u);e.setAttribute(u,c)}return ri(e,t,r,l[0],i,a+1)}))}(e,t,r,n,i,a);return r&&(o=o.ca(void 0,(function(){return ri(e,t,r,n,i,a)}))),o}o=[];for(var s=0;s<e.childNodes.length;s++){var u=e.childNodes[s];u instanceof Element&&("urn:mpeg:dash:resolve-to-zero:2013"==Wn.getAttributeNS(u,"http://www.w3.org/1999/xlink","href")?(e.removeChild(u),--s):"SegmentTimeline"!=u.tagName&&o.push(ri(u,t,r,n,i,a)))}return Ne(o).ca((function(){return e}))}function ni(e,t,r){this.i=e,this.h=t,this.g=r}function ii(e,t,r,n,i,a){this.position=e,this.startTime=t,this.endTime=r,this.i=n,this.h=i,this.g=a}function ai(e,t,r,n){var i,a=(new Bn).ma("sidx",(function(e){i=function(e,t,r,n){var i=[];n.reader.U(4);var a=n.reader.N();if(0==a)throw Y.error("Invalid timescale."),new z(2,3,3005);if(0==n.version)var o=n.reader.N(),s=n.reader.N();else o=n.reader.Pb(),s=n.reader.Pb();n.reader.U(2);var u=n.reader.dc();for(e=e+n.size+s,s=0;s<u;s++){var c=n.reader.N(),l=(2147483648&c)>>>31;c&=2147483647;var d=n.reader.N();if(n.reader.U(4),1==l)throw Y.error("Heirarchical SIDXs are not supported."),new z(2,3,3006);i.push(new ii(i.length,o/a-t,(o+d)/a-t,(function(){return r}),e,e+c-1)),o+=d,e+=c}return n.parser.stop(),i}(t,n,r,e)}));if(e&&a.parse(e),i)return i;throw Y.error('Invalid box type, expected "sidx".'),new z(2,3,3004)}function oi(e){this.g=e}function si(e,t){for(;e.g.length&&e.g[e.g.length-1].startTime>=t;)e.g.pop();for(;e.g.length&&0>=e.g[0].endTime;)e.g.shift();if(0!=e.g.length){var r=e.g[e.g.length-1];e.g[e.g.length-1]=new ii(r.position,r.startTime,t,r.i,r.h,r.g)}}function ui(e){this.h=e,this.g=new Ln(e,0),Yn||(Yn=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}function ci(e){var t=li(e);if(7<t.length)throw new z(2,3,3002);for(var r=0,n=0;n<t.length;n++)r=256*r+t[n];t=r,r=li(e);e:{n=Te.Ha;for(var i=0;i<Yn.length;i++)if(n(r,Yn[i])){n=!0;break e}n=!1}if(n)r=e.h.byteLength-e.g.ka();else{if(8==r.length&&224&r[1])throw new z(2,3,3001);for(n=r[0]&(1<<8-r.length)-1,i=1;i<r.length;i++)n=256*n+r[i];r=n}return r=e.g.ka()+r<=e.h.byteLength?r:e.h.byteLength-e.g.ka(),n=new DataView(e.h.buffer,e.h.byteOffset+e.g.ka(),r),e.g.U(r),new di(t,n)}function li(e){var t,r=e.g.ra();for(t=1;8>=t&&!(r&1<<8-t);t++);if(8<t)throw new z(2,3,3002);var n=new Uint8Array(t);for(n[0]=r,r=1;r<t;r++)n[r]=e.g.ra();return n}function di(e,t){this.id=e,this.g=t}function hi(e){if(8<e.g.byteLength)throw new z(2,3,3002);if(8==e.g.byteLength&&224&e.g.getUint8(0))throw new z(2,3,3001);for(var t=0,r=0;r<e.g.byteLength;r++)t=256*t+e.g.getUint8(r);return t}function fi(){}function pi(e){var t=new ui(e.g);if(179!=(e=ci(t)).id)throw Y.v("Not a CueTime element."),new z(2,3,3013);if(e=hi(e),183!=(t=ci(t)).id)throw Y.v("Not a CueTrackPositions element."),new z(2,3,3012);t=new ui(t.g);for(var r=0;t.Ca();){var n=ci(t);if(241==n.id){r=hi(n);break}}return{Qg:e,qg:r}}function gi(e,t){var r=ti(e,t,"Initialization");if(!r)return null;var n=e.G.xa,i=r.getAttribute("sourceURL");i&&(n=he(e.G.xa,[i])),i=0;var a=null;return(r=Wn.R(r,"range",Wn.Hc))&&(i=r.start,a=r.end),new ni((function(){return n}),i,a)}function yi(e,t,r,n,i,a,o,s){var u=e.presentationTimeline,c=!e.zb||!e.$.ld,l=e.$.start,d=e.$.duration,h=t,f=null;return{createSegmentIndex:function(){var e=[h(n,i,a),"webm"==o?h(r.i(),r.h,r.g):null];return h=null,Promise.all(e).then((function(e){var t=e[0];e=e[1]||null,t="mp4"==o?ai(t,i,n,s):(new fi).parse(t,e,n,s),u.Jb(t,l),f=new oi(t),c&&si(f,d)}))},findSegmentPosition:function(e){return f.find(e)},getSegmentReference:function(e){return f.get(e)}}}function mi(e){return e.ec}function vi(e,t){var r=gi(e,_i),n=function(e){return[e.G.Ua,e.fa.Ua,e.qa.Ua].filter(de.Ra).map((function(e){return Wn.Y(e,"SegmentURL")})).reduce((function(e,t){return 0<e.length?e:t})).map((function(t){return t.getAttribute("indexRange")&&!e.me&&(e.me=!0,Y.v("We do not support the SegmentURL@indexRange attribute on SegmentList.  We only use the SegmentList@duration attribute or SegmentTimeline, which must be accurate.")),{Tf:t.getAttribute("media"),start:(t=Wn.R(t,"mediaRange",Wn.Hc,{start:0,end:null})).start,end:t.end}}))}(e),i=qn(e,_i),a=i.ob;0==a&&(Y.v("SegmentList@startNumber must be > 0"),a=1);var o=0;if(i.ia?o=i.ia*(a-1):i.W&&0<i.W.length&&(o=i.W[0].start),!(n={ia:i.ia,startTime:o,ob:a,sa:i.sa,W:i.W,jb:n}).ia&&!n.W&&1<n.jb.length)throw Y.v("SegmentList does not contain sufficient segment information:","the SegmentList specifies multiple segments,","but does not specify a segment duration or timeline.",e.G),new z(2,4,4002);if(!n.ia&&!e.$.duration&&!n.W&&1==n.jb.length)throw Y.v("SegmentList does not contain sufficient segment information:","the SegmentList specifies one segment,","but does not specify a segment duration, period duration,","or timeline.",e.G),new z(2,4,4002);if(n.W&&0==n.W.length)throw Y.v("SegmentList does not contain sufficient segment information:","the SegmentList has an empty timeline.",e.G),new z(2,4,4002);return a=i=null,e.qa.id&&e.G.id&&(i=t[a=e.qa.id+","+e.G.id]),o=function(e,t,r,n){var i=n.jb.length;n.W&&n.W.length!=n.jb.length&&(i=Math.min(n.W.length,n.jb.length),Y.v("The number of items in the segment timeline and the number of segment","URLs do not match, truncating",n.jb.length,"to",i));for(var a=[],o=n.startTime,s=0;s<i;s++){var u=n.jb[s],c=he(r,[u.Tf]),l=void 0;l=null!=n.ia?o+n.ia:n.W?n.W[s].end:o+e,a.push(new ii(s+t,o,l,function(e){return e}.bind(null,c),u.start,u.end)),o=l}return a}(e.$.duration,n.ob,e.G.xa,n),i?(i.sd(o),a=e.presentationTimeline.$b(),i.Vc(a-e.$.start)):(e.presentationTimeline.Jb(o,e.$.start),i=new oi(o),a&&e.zb&&(t[a]=i)),e.zb&&e.$.ld||si(i,e.$.duration),{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:i.find.bind(i),getSegmentReference:i.get.bind(i),initSegmentReference:r,sa:n.sa}}function _i(e){return e.Ua}function bi(e,t,r,n){var i=function(e){var t=ei(e,Ai,"initialization");if(!t)return null;var r=e.G.id,n=e.bandwidth||null,i=e.G.xa;return new ni((function(){var e=Qn(t,r,null,n,null);return he(i,[e])}),0,null)}(e),a=qn(e,Ai),o=ei(e,Ai,"media"),s=ei(e,Ai,"index");if(o=(a={ia:a.ia,timescale:a.timescale,ob:a.ob,sa:a.sa,Vd:a.Vd,W:a.W,qd:o,bc:s}).bc?1:0,o+=a.W?1:0,0==(o+=a.ia?1:0))throw Y.error("SegmentTemplate does not contain any segment information:","the SegmentTemplate must contain either an index URL template","a SegmentTimeline, or a segment duration.",e.G),new z(2,4,4002);if(1!=o&&(Y.v("SegmentTemplate containes multiple segment information sources:","the SegmentTemplate should only contain an index URL template,","a SegmentTimeline or a segment duration.",e.G),a.bc?(Y.info("Using the index URL template by default."),a.W=null):Y.info("Using the SegmentTimeline by default."),a.ia=null),!a.bc&&!a.qd)throw Y.error("SegmentTemplate does not contain sufficient segment information:","the SegmentTemplate's media URL template is missing.",e.G),new z(2,4,4002);if(a.bc){if("mp4"!=(r=e.G.mimeType.split("/")[1])&&"webm"!=r)throw Y.error("SegmentTemplate specifies an unsupported container type.",e.G),new z(2,4,4006);if("webm"==r&&!i)throw Y.error("SegmentTemplate does not contain sufficient segment information:","the SegmentTemplate uses a WebM container,","but does not contain an initialization URL template.",e.G),new z(2,4,4005);n=Qn(a.bc,e.G.id,null,e.bandwidth||null,null),e=yi(e,t,i,n=he(e.G.xa,[n]),0,null,r,a.sa)}else a.ia?(n||(e.presentationTimeline.ud(a.ia),e.presentationTimeline.vd(e.$.start)),e=function(e,t){var r=e.$.duration,n=t.ia,i=t.ob,a=t.timescale,o=t.qd,s=e.bandwidth||null,u=e.G.id,c=e.G.xa;return{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(e){return 0>e||r&&e>=r?null:Math.floor(e/n)},getSegmentReference:function(e){var t=e*n,l=t+n;return r&&(l=Math.min(l,r)),0>l||r&&t>=r?null:new ii(e,t,l,(function(){var r=Qn(o,u,e+i,s,t*a);return he(c,[r])}),0,null)}}}(e,a)):(o=t=null,e.qa.id&&e.G.id&&(t=r[o=e.qa.id+","+e.G.id]),s=function(e,t){for(var r=[],n=0;n<t.W.length;n++){var i=n+t.ob;r.push(new ii(i,t.W[n].start,t.W[n].end,function(e,t,r,n,i,a){return he(n,[e=Qn(e,t,i,r,a)]).map((function(e){return e.toString()}))}.bind(null,t.qd,e.G.id,e.bandwidth||null,e.G.xa,i,t.W[n].Pg+t.Vd),0,null))}return r}(e,a),n=!e.zb||!e.$.ld,t?(n&&si(new oi(s),e.$.duration),t.sd(s),r=e.presentationTimeline.$b(),t.Vc(r-e.$.start)):(e.presentationTimeline.Jb(s,e.$.start),t=new oi(s),o&&e.zb&&(r[o]=t)),n&&si(t,e.$.duration),e={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:t.find.bind(t),getSegmentReference:t.get.bind(t)});return{createSegmentIndex:e.createSegmentIndex,findSegmentPosition:e.findSegmentPosition,getSegmentReference:e.getSegmentReference,initSegmentReference:i,sa:a.sa}}function Ai(e){return e.gc}j("shaka.media.InitSegmentReference",ni),ni.prototype.Tc=function(){return this.i()},ni.prototype.createUris=ni.prototype.Tc,ni.prototype.dd=function(){return this.h},ni.prototype.getStartByte=ni.prototype.dd,ni.prototype.cd=function(){return this.g},ni.prototype.getEndByte=ni.prototype.cd,j("shaka.media.SegmentReference",ii),ii.prototype.ka=function(){return this.position},ii.prototype.getPosition=ii.prototype.ka,ii.prototype.xc=function(){return this.startTime},ii.prototype.getStartTime=ii.prototype.xc,ii.prototype.qf=function(){return this.endTime},ii.prototype.getEndTime=ii.prototype.qf,ii.prototype.Tc=function(){return this.i()},ii.prototype.createUris=ii.prototype.Tc,ii.prototype.dd=function(){return this.h},ii.prototype.getStartByte=ii.prototype.dd,ii.prototype.cd=function(){return this.g},ii.prototype.getEndByte=ii.prototype.cd,j("shaka.media.SegmentIndex",oi),oi.prototype.destroy=function(){return this.g=null,Promise.resolve()},oi.prototype.destroy=oi.prototype.destroy,oi.prototype.find=function(e){for(var t=this.g.length-1,r=t;0<=r;--r){var n=this.g[r],i=r<t?this.g[r+1].startTime:n.endTime;if(e>=n.startTime&&e<i)return n.position}return this.g.length&&e<this.g[0].startTime?this.g[0].position:null},oi.prototype.find=oi.prototype.find,oi.prototype.get=function(e){return 0==this.g.length||0>(e-=this.g[0].position)||e>=this.g.length?null:this.g[e]},oi.prototype.get=oi.prototype.get,oi.prototype.offset=function(e){for(var t=0;t<this.g.length;++t)this.g[t].startTime+=e,this.g[t].endTime+=e},oi.prototype.offset=oi.prototype.offset,oi.prototype.sd=function(e){for(var t=[],r=0,n=0;r<this.g.length&&n<e.length;){var i=this.g[r],a=e[n];i.startTime<a.startTime?(t.push(i),r++):(i.startTime>a.startTime?0==r?t.push(a):Y.v("Refusing to rewrite original references on update!"):(.1<Math.abs(i.endTime-a.endTime)?t.push(new ii(i.position,a.startTime,a.endTime,a.i,a.h,a.g)):t.push(i),r++),n++)}for(;r<this.g.length;)t.push(this.g[r++]);if(t.length)for(r=t[t.length-1].position+1;n<e.length;)i=new ii(r++,(i=e[n++]).startTime,i.endTime,i.i,i.h,i.g),t.push(i);else t=e;this.g=t},oi.prototype.merge=oi.prototype.sd,oi.prototype.Vc=function(e){for(var t=0;t<this.g.length;++t)if(this.g[t].endTime>e)return void this.g.splice(0,t);this.g=[]},oi.prototype.evict=oi.prototype.Vc,ui.prototype.Ca=function(){return this.g.Ca()},fi.prototype.parse=function(e,t,r,n){var i;if(440786851!=ci(t=new ui(new DataView(t))).id)throw Y.error("Not an EBML element."),new z(2,3,3008);var a=ci(t);if(408125543!=a.id)throw Y.error("Not a Segment element."),new z(2,3,3009);for(t=a.g.byteOffset,a=new ui(a.g),i=null;a.Ca();){var o=ci(a);if(357149030==o.id){i=o;break}}if(!i)throw Y.error("Not an Info element."),new z(2,3,3010);for(a=new ui(i.g),i=1e6,o=null;a.Ca();){var s=ci(a);if(2807729==s.id)i=hi(s);else if(17545==s.id)if(4==(o=s).g.byteLength)o=o.g.getFloat32(0);else{if(8!=o.g.byteLength)throw new z(2,3,3003);o=o.g.getFloat64(0)}}if(null==o)throw new z(2,3,3011);if(i=o*(a=i/1e9),475249515!=(e=ci(new ui(new DataView(e)))).id)throw Y.error("Not a Cues element."),new z(2,3,3007);return function(e,t,r,n,i,a){function o(){return i}var s=[];e=new ui(e.g);for(var u=null,c=null;e.Ca();){var l=ci(e);if(187==l.id){var d=pi(l);d&&(l=r*d.Qg,d=t+d.qg,null!=u&&s.push(new ii(s.length,u-a,l-a,o,c,d-1)),u=l,c=d)}}return null!=u&&s.push(new ii(s.length,u-a,n-a,o,c,null)),s}(e,t,a,i,r,n)};var Ei={Nb:{},cc:{},Fd:function(e,t){Ei.cc[e]=t}};function Si(e,t,r){this.j=e,this.Ic=t,this.m=this.l=1/0,this.g=1,this.h=this.i=null,this.u=0,this.A=!0,this.o=0,this.C=void 0===r||r}function Ti(e,t,r,n){return e=ze(e,n),0==t&&null==r||(e.headers.Range=r?"bytes="+t+"-"+r:"bytes="+t+"-"),e}function wi(){var e=this;this.h=this.g=null,this.j=[],this.i=null,this.u=[],this.m=1,this.A={},this.C=0,this.F=new Z(5),this.o=new $e((function(){!function(e){g((function t(){var r,n;return N(t,(function(t){switch(t.s){case 1:return Y.info("Updating manifest..."),r=0,k(t,2),w(t,Ci(e),4);case 4:r=t.B,$(t,3);break;case 2:n=P(t),e.h&&(n.severity=1,e.h.onError(n));case 3:if(!e.h)return t.return();Pi(e,r),C(t)}}))}))}(e)})),this.l=new Ze}function Ci(e){var t=Date.now(),r=e.h.networkingEngine.request(0,ze(e.j,e.g.retryParameters));return We(e.l,r),r.promise.then((function(t){if(e.h)return t.uri&&!e.j.includes(t.uri)&&e.j.unshift(t.uri),function(e,t,r){if(!(t=Wn.ze(t,"MPD")))throw new z(2,4,4001,r);return t=ri(t,e.g.retryParameters,e.g.dash.xlinkFailGracefully,r,e.h.networkingEngine),We(e.l,t),t.promise.then((function(t){return function(e,t,r){return g((function n(){var i,a,o,s,u,c,l,d,h,f,p,g,y,m,v,_,b,A,E,S,T,k,I,$;return N(n,(function(n){switch(n.s){case 1:s=de,c=[r],0<(l=(u=Wn).Y(t,"Location").map(u.uc).filter(s.Ra)).length&&(d=he(c,l),c=e.j=d),h=u.Y(t,"BaseURL").map(u.uc),f=he(c,h),p=e.g.dash.ignoreMinBufferTime,g=0,p||(g=u.R(t,"minBufferTime",u.Ma)),e.C=u.R(t,"minimumUpdatePeriod",u.Ma,-1),y=u.R(t,"availabilityStartTime",u.jg),m=u.R(t,"timeShiftBufferDepth",u.Ma),v=u.R(t,"maxSegmentDuration",u.Ma),_=t.getAttribute("type")||"static",b=e.g.dash.ignoreSuggestedPresentationDelay,A=null,b||(A=u.R(t,"suggestedPresentationDelay",u.Ma)),e.i?E=e.i.presentationTimeline:(S=Math.max(e.g.dash.defaultPresentationDelay,1.5*g),E=new Si(y,null!=A?A:S,e.g.dash.autoCorrectDrift));for(var P={zb:"static"!=_,presentationTimeline:E,qa:null,$:null,fa:null,G:null,bandwidth:0,me:!1},x=f,R=Wn.R(t,"mediaPresentationDuration",Wn.Ma),O=[],D=0,L=Wn.Y(t,"Period"),M=0;M<L.length;M++){var N=L[M];D=Wn.R(N,"start",Wn.Ma,D);var B=Wn.R(N,"duration",Wn.Ma),U=null;if(M!=L.length-1){var G=Wn.R(L[M+1],"start",Wn.Ma);null!=G&&(U=G-D)}else null!=R&&(U=R-D);if(G=ge,U&&B&&Math.abs(U-B)>G&&Y.v("There is a gap/overlap between Periods",N),null==U&&(U=B),N=ki(e,P,x,{start:D,duration:U,node:N,ld:null==U||M==L.length-1}),O.push(N),B=P.qa.id,e.u.includes(B)||(e.u.push(B),e.i&&(e.h.filterNewPeriod(N),e.i.periods.push(N))),null==U){M!=L.length-1&&Y.v("Skipping Period",M+1,"and any subsequent Periods:","Period",M+1,"does not have a valid start time.",O[M+1]),D=null;break}D+=U}if(null==e.i&&e.h.filterAllPeriods(O),null!=R?(D!=R&&Y.v("@mediaPresentationDuration does not match the total duration of all","Periods."),i=O,a=R,o=!1):(i=O,a=D,o=!0),T=a,k=i,E.hc("static"==_),"static"!=_&&o||E.Fa(T||1/0),E.aa()&&!isNaN(e.g.availabilityWindowOverride)&&(m=e.g.availabilityWindowOverride),null==m&&(m=1/0),E.Pd(m),E.ud(v||1),e.i){n.I(0);break}if(e.i={presentationTimeline:E,periods:k,offlineSessionIds:[],minBufferTime:g||0},!E.Pe()){n.I(0);break}return I=u.Y(t,"UTCTiming"),w(n,function(e,t,r){r=r.map((function(e){return{scheme:e.getAttribute("schemeIdUri"),value:e.getAttribute("value")}}));var n=e.g.dash.clockSyncUri;return!r.length&&n&&r.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:n}),de.df(r,function(e){var r=e.scheme;switch(e=e.value,r){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return Ri(this,t,e,"HEAD");case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return Ri(this,t,e,"GET");case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return r=Date.parse(e),isNaN(r)?0:r-Date.now();case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":return Y.ba("NTP UTCTiming scheme is not supported"),Promise.reject();default:return Y.ba("Unrecognized scheme in UTCTiming element",r),Promise.reject()}}.bind(e)).catch((function(){return Y.ba("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!"),0}))}(e,f,I),4);case 4:if($=n.B,!e.h)return n.return();E.Ke($),C(n)}}))}))}(e,t,r)}))}(e,t.data,t.uri)})).then((function(){var r=(Date.now()-t)/1e3;return W(e.F,1,r),r}))}function ki(e,t,r,n){if(t.qa=xi(n.node,null,r),t.$=n,t.qa.id||(Y.info("No Period ID given for Period with start time "+n.start+",  Assigning a default"),t.qa.id="__shaka_period_"+n.start),Wn.Y(n.node,"EventStream").forEach(e.kg.bind(e,n.start,n.duration)),r=Wn.Y(n.node,"AdaptationSet").map(e.ig.bind(e,t)).filter(de.Ra),t.zb){t=[];for(var i=f(r),a=i.next();!a.done;a=i.next())for(var o=(a=f(a.value.tg)).next();!o.done;o=a.next())t.push(o.value);if(t.length!=new Set(t).size)throw new z(2,4,4018)}var s=r.filter((function(e){return!e.Td}));if(r.filter((function(e){return e.Td})).forEach((function(e){var t=e.Td.split(" ");s.forEach((function(r){t.includes(r.id)&&r.streams.forEach((function(t){t.trickModeVideo=e.streams.find((function(e){return ht(t.codecs)[0]==ht(e.codecs)[0]}))}))}))})),t=Ii(s,"video"),i=Ii(s,"audio"),!t.length&&!i.length)throw new z(2,4,4004);for(r=e.g.disableAudio,i.length&&!r||(i=[null]),r=e.g.disableVideo,t.length&&!r||(t=[null]),r=[],a=0;a<i.length;a++)for(o=0;o<t.length;o++)$i(e,i[a],t[o],r);if(t=[],!e.g.disableText)for(e=Ii(s,"text"),i=0;i<e.length;i++)t.push.apply(t,e[i].streams);return{startTime:n.start,textStreams:t,variants:r}}function Ii(e,t){return e.filter((function(e){return e.contentType==t}))}function $i(e,t,r,n){if(t||r)if(t&&r){var i=t.drmInfos,a=r.drmInfos;if(!i.length||!a.length||0<Ut(i,a).length){a=Ut(t.drmInfos,r.drmInfos);for(var o=0;o<t.streams.length;o++)for(var s=0;s<r.streams.length;s++)i=(r.streams[s].bandwidth||0)+(t.streams[o].bandwidth||0),i={id:e.m++,language:t.language,primary:t.pd||r.pd,audio:t.streams[o],video:r.streams[s],bandwidth:i,drmInfos:a,allowedByApplication:!0,allowedByKeySystem:!0},n.push(i)}}else for(a=t||r,o=0;o<a.streams.length;o++)i=a.streams[o].bandwidth||0,i={id:e.m++,language:a.language||"und",primary:a.pd,audio:t?a.streams[o]:null,video:r?a.streams[o]:null,bandwidth:i,drmInfos:a.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0},n.push(i)}function Pi(e,t){0>e.C||e.o.V(Math.max(3,e.C-t,K(e.F)))}function xi(e,t,r){t=t||{contentType:"",mimeType:"",codecs:"",emsgSchemeIdUris:[],frameRate:void 0,wd:null,audioSamplingRate:null},r=r||t.xa;var n=Wn.Mb,i=Wn.ff,a=Wn.Y(e,"BaseURL").map(Wn.uc),o=e.getAttribute("contentType")||t.contentType,s=e.getAttribute("mimeType")||t.mimeType,u=e.getAttribute("codecs")||t.codecs;i=Wn.R(e,"frameRate",i)||t.frameRate;for(var c=e.getAttribute("sar")||t.pixelAspectRatio,l=Wn.Y(e,"InbandEventStream"),d=t.emsgSchemeIdUris.slice(),h=(l=f(l)).next();!h.done;h=l.next())h=h.value.getAttribute("schemeIdUri"),d.includes(h)||d.push(h);return l=function(e){for(var t=0;t<e.length;++t){var r=e[t],n=r.getAttribute("schemeIdUri");if(n&&(r=r.getAttribute("value")))switch(n){case"urn:mpeg:dash:outputChannelPositionList:2012":return r.trim().split(/ +/).length;case"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case"urn:dts:dash:audio_channel_configuration:2012":var i=parseInt(r,10);if(!i){Y.v("Channel parsing failure! Ignoring scheme and value",n,r);continue}return i;case"tag:dolby.com,2014:dash:audio_channel_configuration:2011":case"urn:dolby:dash:audio_channel_configuration:2011":if(!(i=parseInt(r,16))){Y.v("Channel parsing failure! Ignoring scheme and value",n,r);continue}for(e=0;i;)1&i&&++e,i>>=1;return e;default:Y.v("Unrecognized audio channel scheme:",n,r)}}return null}(l=Wn.Y(e,"AudioChannelConfiguration"))||t.wd,h=Wn.R(e,"audioSamplingRate",n)||t.audioSamplingRate,o||(o=Oi(s,u)),{xa:he(r,a),ec:Wn.sc(e,"SegmentBase")||t.ec,Ua:Wn.sc(e,"SegmentList")||t.Ua,gc:Wn.sc(e,"SegmentTemplate")||t.gc,width:Wn.R(e,"width",n)||t.width,height:Wn.R(e,"height",n)||t.height,contentType:o,mimeType:s,codecs:u,frameRate:i,pixelAspectRatio:c,emsgSchemeIdUris:d,id:e.getAttribute("id"),wd:l,audioSamplingRate:h}}function Ri(e,t,r,n){return(t=ze(t=he(t,[r]),e.g.retryParameters)).method=n,t=e.h.networkingEngine.request(4,t),We(e.l,t),t.promise.then((function(e){if("HEAD"==n){if(!e.headers||!e.headers.date)return Y.v("UTC timing response is missing","expected date header"),0;e=e.headers.date}else e=me(e.data);return e=Date.parse(e),isNaN(e)?(Y.v("Unable to parse date from UTC timing response"),0):e-Date.now()}))}function Oi(e,t){return mr(lt(e,t))?"text":e.split("/")[0]}function Di(e,t,r,n){this.h=e,this.type=t,this.g=r,this.segments=n||null}function Li(e,t,r,n){this.id=e,this.name=t,this.g=r,this.value=void 0===n?null:n}function Mi(e,t){this.name=e,this.value=t}function Ni(e,t,r){return(e=e.getAttribute(t))?e.value:r||null}function Bi(e,t){this.h=t,this.g=e}j("shaka.media.ManifestParser.registerParserByExtension",Ei.Fd),Ei.Qb=function(e,t){Ei.Nb[e]=t},j("shaka.media.ManifestParser.registerParserByMime",Ei.Qb),Ei.ng=function(){var e={};if(pt()){for(var t in Ei.Nb)e[t]=!0;for(var r in Ei.cc)e[r]=!0}t={mpd:"application/dash+xml",m3u8:"application/x-mpegurl",ism:"application/vnd.ms-sstr+xml"};for(var n=(r=f(["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"])).next();!n.done;n=r.next())e[n=n.value]=pt()?!!Ei.Nb[n]:gt(n);for(var i in t)e[i]=pt()?!!Ei.cc[i]:gt(t[i]);return e},Ei.create=function(e,t,r,n){return g((function i(){var a,o;return N(i,(function(i){switch(i.s){case 1:return k(i,2),w(i,Ei.rf(e,t,r,n),4);case 4:return a=i.B,i.return(new a);case 2:throw(o=P(i)).severity=2,o}}))}))},Ei.rf=function(e,t,r,n){return g((function i(){var a,o,s,u,c;return N(i,(function(i){switch(i.s){case 1:if(a=Ei,n){if(o=a.Nb[n.toLowerCase()])return i.return(o);Y.v("Could not determine manifest type using MIME type ",n)}if(s=a.getExtension(e)){if(u=a.cc[s])return i.return(u);Y.v("Could not determine manifest type for extension ",s)}else Y.v("Could not find extension for ",e);if(n){i.I(2);break}return w(i,a.zf(e,t,r),3);case 3:if(n=i.B){if(c=Ei.Nb[n])return i.return(c);Y.v("Could not determine manifest type using MIME type",n)}case 2:throw new z(2,4,4e3,e)}}))}))},Ei.zf=function(e,t,r){return g((function n(){var i,a,o;return N(n,(function(n){switch(n.s){case 1:return(i=ze([e],r)).method="HEAD",w(n,t.request(0,i).promise,2);case 2:return a=n.B,o=a.headers["content-type"],n.return(o?o.toLowerCase().split(";").shift():"")}}))}))},Ei.getExtension=function(e){return 1==(e=new Q(e).pa.split("/").pop().split(".")).length?"":e.pop().toLowerCase()},Ei.isSupported=function(e,t){return!!pt()&&(t in Ei.Nb||Ei.getExtension(e)in Ei.cc)},j("shaka.media.PresentationTimeline",Si),Si.prototype.ha=function(){return this.l},Si.prototype.getDuration=Si.prototype.ha,Si.prototype.xf=function(){return this.g},Si.prototype.getMaxSegmentDuration=Si.prototype.xf,Si.prototype.Fa=function(e){this.l=e},Si.prototype.setDuration=Si.prototype.Fa,Si.prototype.Ff=function(){return this.j},Si.prototype.getPresentationStartTime=Si.prototype.Ff,Si.prototype.Ke=function(e){this.u=e},Si.prototype.setClockOffset=Si.prototype.Ke,Si.prototype.hc=function(e){this.A=e},Si.prototype.setStatic=Si.prototype.hc,Si.prototype.Pd=function(e){this.m=e},Si.prototype.setSegmentAvailabilityDuration=Si.prototype.Pd,Si.prototype.Ag=function(e){this.Ic=e},Si.prototype.setDelay=Si.prototype.Ag,Si.prototype.pf=function(){return this.Ic},Si.prototype.getDelay=Si.prototype.pf,Si.prototype.Jb=function(e,t){if(0!=e.length){var r=e[e.length-1].endTime+t;this.vd(e[0].startTime+t),this.g=e.reduce((function(e,t){return Math.max(e,t.endTime-t.startTime)}),this.g),this.h=Math.max(this.h,r),null!=this.j&&this.C&&(this.j=(Date.now()+this.u)/1e3-this.h-this.g),Y.K("notifySegments:","maxSegmentDuration="+this.g)}},Si.prototype.notifySegments=Si.prototype.Jb,Si.prototype.vd=function(e){this.i=null==this.i?e:Math.min(this.i,e)},Si.prototype.notifyMinSegmentStartTime=Si.prototype.vd,Si.prototype.ud=function(e){this.g=Math.max(this.g,e),Y.K("notifyNewSegmentDuration:","maxSegmentDuration="+this.g)},Si.prototype.notifyMaxSegmentDuration=Si.prototype.ud,Si.prototype.offset=function(e){null!=this.i&&(this.i+=e),null!=this.h&&(this.h+=e)},Si.prototype.offset=Si.prototype.offset,Si.prototype.aa=function(){return 1/0==this.l&&!this.A},Si.prototype.isLive=Si.prototype.aa,Si.prototype.ib=function(){return 1/0!=this.l&&!this.A},Si.prototype.isInProgress=Si.prototype.ib,Si.prototype.$b=function(){if(1/0==this.m)return this.o;var e=this.Db()-this.m;return Math.max(this.o,e)},Si.prototype.getSegmentAvailabilityStart=Si.prototype.$b,Si.prototype.Le=function(e){this.o=e},Si.prototype.setUserSeekStart=Si.prototype.Le,Si.prototype.Db=function(){return this.aa()||this.ib()?Math.min(Math.max(0,(Date.now()+this.u)/1e3-this.g-this.j),this.l):this.l},Si.prototype.getSegmentAvailabilityEnd=Si.prototype.Db,Si.prototype.Zb=function(e){var t=Math.max(this.i,this.o);if(1/0==this.m)return Math.ceil(1e3*t)/1e3;var r=this.Db()-this.m;return e=Math.min(r+e,this.Ka()),Math.max(t,e)},Si.prototype.getSafeSeekRangeStart=Si.prototype.Zb,Si.prototype.Cb=function(){return this.Zb(0)},Si.prototype.getSeekRangeStart=Si.prototype.Cb,Si.prototype.Ka=function(){var e=this.aa()||this.ib()?this.Ic:0;return Math.max(0,this.Db()-e)},Si.prototype.getSeekRangeEnd=Si.prototype.Ka,Si.prototype.Pe=function(){return!(null==this.j||null!=this.h&&this.C)},Si.prototype.usingPresentationStartTime=Si.prototype.Pe,j("shaka.dash.DashParser",wi),(i=wi.prototype).configure=function(e){this.g=e},i.start=function(e,t){var r=this;return g((function n(){var i;return N(n,(function(n){switch(n.s){case 1:return r.j=[e],r.h=t,w(n,Ci(r),2);case 2:if(i=n.B,r.h&&Pi(r,i),!r.h)throw new z(2,7,7001);return n.return(r.i)}}))}))},i.stop=function(){return this.g=this.h=null,this.j=[],this.i=null,this.u=[],this.A={},null!=this.o&&(this.o.stop(),this.o=null),this.l.destroy()},i.update=function(){Ci(this).catch(function(e){this.h&&this.h.onError(e)}.bind(this))},i.onExpirationUpdated=function(){},i.ig=function(e,t){if(e.fa=xi(t,e.qa,null),"image"==e.fa.contentType)return Y.v("Skipping Image AdaptationSet",e.fa),null;var r=!1,n=Wn.Y(t,"Role"),i=n.map((function(e){return e.getAttribute("value")})).filter(de.Ra),a=void 0,o="text"==e.fa.contentType;o&&(a="subtitle");for(var s=0;s<n.length;s++){var u=n[s].getAttribute("schemeIdUri");if(null==u||"urn:mpeg:dash:role:2011"==u)switch(u=n[s].getAttribute("value"),u){case"main":r=!0;break;case"caption":case"subtitle":a=u}}var c=null,l=!1;Wn.Y(t,"EssentialProperty").forEach((function(e){"http://dashif.org/guidelines/trickmode"==e.getAttribute("schemeIdUri")?c=e.getAttribute("value"):l=!0})),s=Wn.Y(t,"Accessibility");var d=new Map;for(n={},u=(s=f(s)).next();!u.done;n={Vb:n.Vb},u=s.next()){var h=u.value;u=h.getAttribute("schemeIdUri"),h=h.getAttribute("value"),"urn:scte:dash:cc:cea-608:2015"==u||"urn:scte:dash:cc:cea-708:2015"==u?(n.Vb=1,null!=h?h.split(";").forEach(function(e){return function(t){if(t.includes("=")){var r=(t=t.split("="))[0].startsWith("CC")?t[0]:"CC"+t[0];t=t[1].split(",")[0].split(":").pop()}else r="CC"+e.Vb,e.Vb+=2;d.set(r,Mr(t))}}(n)):d.set("CC1","und")):"urn:mpeg:dash:role:2011"==u&&null!=h&&(i.push(h),"captions"==h&&(a="caption"))}if(l)return null;var p=Xn(n=Wn.Y(t,"ContentProtection"),this.g.dash.customScheme,this.g.dash.ignoreDrmInfo);if(n=Mr(t.getAttribute("lang")||"und"),s=t.getAttribute("label"),(u=Wn.Y(t,"Label"))&&u.length&&(u=u[0]).textContent&&(s=u.textContent),0==(i=(u=Wn.Y(t,"Representation")).map(this.lg.bind(this,e,p,a,n,s,r,i,d)).filter((function(e){return!!e}))).length){if(this.g.dash.ignoreEmptyAdaptationSet||o)return null;throw new z(2,4,4003)}return e.fa.contentType&&"application"!=e.fa.contentType||(e.fa.contentType=Oi(i[0].mimeType,i[0].codecs),i.forEach((function(t){t.type=e.fa.contentType}))),i.forEach((function(e){p.drmInfos.forEach((function(t){e.keyId&&t.keyIds.push(e.keyId)}))})),o=u.map((function(e){return e.getAttribute("id")})).filter(de.Ra),{id:e.fa.id||"__fake__"+this.m++,contentType:e.fa.contentType,language:n,pd:r,streams:i,drmInfos:p.drmInfos,Td:c,tg:o}},i.lg=function(e,t,r,n,i,a,o,s,u){if(e.G=xi(u,e.fa,null),!function(e){var t=e.ec?1:0;return t+=e.Ua?1:0,0==(t+=e.gc?1:0)?"text"==e.contentType||"application"==e.contentType||(Y.v("Representation does not contain a segment information source:","the Representation must contain one of SegmentBase, SegmentList,",'SegmentTemplate, or explicitly indicate that it is "text".',e),!1):(1!=t&&(Y.v("Representation contains multiple segment information sources:","the Representation should only contain one of SegmentBase,","SegmentList, or SegmentTemplate.",e),e.ec?(Y.info("Using SegmentBase by default."),e.Ua=null):Y.info("Using SegmentList by default."),e.gc=null),!0)}(e.G))return Y.v("Skipping Representation",e.G),null;e.bandwidth=Wn.R(u,"bandwidth",Wn.Gc)||0;var c=e.G.contentType;c="text"==c||"application"==c;try{var l=this.ug.bind(this);if(e.G.ec)var d=function(e,t){var r=Number(ei(e,mi,"presentationTimeOffset"))||0,n=ei(e,mi,"timescale"),i=1;n&&(i=Wn.Gc(n)||1),r=r/i||0,n=gi(e,mi);var a=e.G.contentType;if(i=e.G.mimeType.split("/")[1],"text"!=a&&"mp4"!=i&&"webm"!=i)throw Y.error("SegmentBase specifies an unsupported container type.",e.G),new z(2,4,4006);if("webm"==i&&!n)throw Y.error("SegmentBase does not contain sufficient segment information:","the SegmentBase uses a WebM container,","but does not contain an Initialization element.",e.G),new z(2,4,4005);a=ti(e,mi,"RepresentationIndex");var o=ei(e,mi,"indexRange"),s=e.G.xa;if(o=Wn.Hc(o||""),a){var u=a.getAttribute("sourceURL");u&&(s=he(e.G.xa,[u])),o=Wn.R(a,"range",Wn.Hc,o)}if(!o)throw Y.error("SegmentBase does not contain sufficient segment information:","the SegmentBase does not contain @indexRange","or a RepresentationIndex element.",e.G),new z(2,4,4002);return{createSegmentIndex:(i=yi(e,t,n,s,o.start,o.end,i,r)).createSegmentIndex,findSegmentPosition:i.findSegmentPosition,getSegmentReference:i.getSegmentReference,initSegmentReference:n,sa:r}}(e,l);else if(e.G.Ua)d=vi(e,this.A);else if(e.G.gc)d=bi(e,l,this.A,!!this.i);else{var h=e.G.xa,f=e.$.duration||0;d={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(e){return 0<=e&&e<f?1:null},getSegmentReference:function(e){return 1!=e?null:new ii(1,0,f,(function(){return h}),0,null)},initSegmentReference:null,sa:0}}}catch(p){if(c&&4002==p.code)return null;throw p}return u=function(e,t,r,n){var i=Xn(e,t,n);if(r.ge)e=1==r.drmInfos.length&&!r.drmInfos[0].keySystem,t=0==i.drmInfos.length,(0==r.drmInfos.length||e&&!t)&&(r.drmInfos=i.drmInfos),r.ge=!1;else if(0<i.drmInfos.length&&(r.drmInfos=r.drmInfos.filter((function(e){return i.drmInfos.some((function(t){return t.keySystem==e.keySystem}))})),0==r.drmInfos.length))throw new z(2,4,4008);return i.be||r.be}(u=Wn.Y(u,"ContentProtection"),this.g.dash.customScheme,t,this.g.dash.ignoreDrmInfo),{id:this.m++,originalId:e.G.id,createSegmentIndex:d.createSegmentIndex,findSegmentPosition:d.findSegmentPosition,getSegmentReference:d.getSegmentReference,initSegmentReference:d.initSegmentReference,presentationTimeOffset:d.sa,mimeType:e.G.mimeType,codecs:e.G.codecs,frameRate:e.G.frameRate,pixelAspectRatio:e.G.pixelAspectRatio,bandwidth:e.bandwidth,width:e.G.width,height:e.G.height,kind:r,encrypted:0<t.drmInfos.length,keyId:u,language:n,label:i,type:e.fa.contentType,primary:a,trickModeVideo:null,emsgSchemeIdUris:e.G.emsgSchemeIdUris,roles:o,channelsCount:e.G.wd,audioSamplingRate:e.G.audioSamplingRate,closedCaptions:s}},i.kg=function(e,t,r){var n=Wn.Mb,i=r.getAttribute("schemeIdUri")||"",a=r.getAttribute("value")||"",o=Wn.R(r,"timescale",n)||1;Wn.Y(r,"Event").forEach(function(r){var s=Wn.R(r,"presentationTime",n)||0,u=Wn.R(r,"duration",n)||0;u=(s=s/o+e)+u/o,null!=t&&(s=Math.min(s,e+t),u=Math.min(u,e+t)),r={schemeIdUri:i,value:a,startTime:s,endTime:u,id:r.getAttribute("id")||"",eventElement:r},this.h.onTimelineRegionAdded(r)}.bind(this))},i.ug=function(e,t,r){return e=Ti(e,t,r,this.g.retryParameters),e=this.h.networkingEngine.request(1,e),We(this.l,e),e.promise.then((function(e){return e.data}))},Ei.Fd("mpd",wi),Ei.Qb("application/dash+xml",wi),Ei.Qb("video/vnd.mpeg.dash.mpd",wi),Li.prototype.toString=function(){var e="#"+this.name,t=this.g?this.g.map((function(e){return e.name+"="+(isNaN(Number(e.value))?'"'+e.value+'"':e.value)})):[];return this.value&&t.unshift(this.value),0<t.length&&(e+=":"+t.join(",")),e},Li.prototype.getAttribute=function(e){var t=this.g.filter((function(t){return t.name==e}));return t.length?t[0]:null};var Ui={Ab:function(e,t){return e.filter((function(e){return e.name==t}))},cb:function(e,t){var r=Ui.Ab(e,t);return r.length?r[0]:null},Zc:function(e,t,r){return e.filter((function(e){var n=e.getAttribute("TYPE");return e=e.getAttribute("GROUP-ID"),n.value==t&&e.value==r}))},Sc:function(e,t){return he([e],[t])[0]},kd:function(e){return/^#(?!EXT)/m.test(e)}};function Gi(e){this.h=e,this.g=0}function Vi(e){Fi(e,/[ \t]+/gm)}function Fi(e,t){t.lastIndex=e.g;var r=t.exec(e.h);return r=null==r?null:{position:r.index,length:r[0].length,wg:r},e.g==e.h.length||null==r||r.position!=e.g?null:(e.g+=r.length,r.wg)}function ji(e){return e.g==e.h.length?null:(e=Fi(e,/[^ \t\n]*/gm))?e[0]:null}function Hi(){this.g=0}function Zi(e,t,r){var n=(t=(t=me(t)).replace(/\r\n|\r(?=[^\n]|$)/gm,"\n").trim()).split(/\n+/m);if(!/^#EXTM3U($|[ \t\n])/m.test(n[0]))throw new z(2,4,4015);t=0;for(var i=1;i<n.length;i++)if(!Ui.kd(n[i])){var a=Ki(e,n[i]);if(--e.g,Xi.includes(a.name)){t=1;break}"EXT-X-STREAM-INF"==a.name&&(i+=1)}for(i=[],a=1;a<n.length;)if(Ui.kd(n[a]))a+=1;else{var o=Ki(e,n[a]);if(Yi.includes(o.name)){if(1!=t)throw new z(2,4,4017);return new Di(r,t,i,e=Wi(e,r,n=n.splice(a,n.length-a),i))}i.push(o),a+=1,"EXT-X-STREAM-INF"==o.name&&(o.g.push(new Mi("URI",n[a])),a+=1)}return new Di(r,t,i)}function Wi(e,t,r,n){var i=[],a=[];return r.forEach((function(r){if(/^(#EXT)/.test(r))r=Ki(e,r),Xi.includes(r.name)?n.push(r):a.push(r);else{if(Ui.kd(r))return[];r=Ui.Sc(t,r.trim()),i.push(new Bi(r,a)),a=[]}})),i}function Ki(e,t){var r=e.g++,n=t.match(/^#(EXT[^:]*)(?::(.*))?$/);if(!n)throw new z(2,4,4016,t);var i,a=n[1],o=n[2];if(n=[],o){var s;(s=Fi(o=new Gi(o),/^([^,=]+)(?:,|$)/g))&&(i=s[1]);for(var u=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g;s=Fi(o,u);)n.push(new Mi(s[1],s[2]||s[3]))}return new Li(r,a,n,i)}var Xi="EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-MAP EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST".split(" "),Yi="EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE".split(" ");function zi(e){try{var t=zi.parse(e);return Le({uri:e,Bd:e,data:t.data,headers:{"content-type":t.contentType}})}catch(r){return Oe(r)}}function Ji(){var e=this;this.g=this.j=null,this.ea=1,this.L=new Map,this.Z=new Set,this.h=new Map,this.i=null,this.F="",this.C=new Hi,this.X=0,this.m=new $e((function(){!function(e){g((function t(){var r,n;return N(t,(function(t){switch(t.s){case 1:return Y.info("Updating manifest..."),e.j?(k(t,2),w(t,e.update(),4)):t.return();case 4:r=e.X,e.m.V(r),$(t,0);break;case 2:if(n=P(t),!e.j)return t.return();n.severity=1,e.j.onError(n),e.m.V(.1),C(t)}}))}))}(e)})),this.l=ma,this.A=null,this.J=0,this.M=1/0,this.o=new Ze,this.P=[],this.u=new Map,this.da=!1}function Qi(e,t){return g((function r(){var n,i,a,o,s,u,c,l,d,h;return N(r,(function(r){switch(r.s){case 1:return n=Ui,i=va,a=t.We,w(r,ga(e,ze([a],e.g.retryParameters),0),2);case 2:if(o=r.B,1!=(s=Zi(e.C,o.data,o.uri)).type)throw new z(2,4,4017);return c=(u=n.cb(s.g,"EXT-X-MEDIA-SEQUENCE"))?Number(u.value):0,l=t.stream,w(r,oa(e,t.Pc,s,c,l.mimeType,l.codecs),3);case 3:d=r.B,t.fc.g=d,h=d[d.length-1],n.cb(s.g,"EXT-X-ENDLIST")&&(pa(e,i.$a),e.i.Fa(h.endTime)),C(r)}}))}))}function qi(e){e.forEach((function(e){if(e){var t=e.stream.codecs.split(",");t=t.filter((function(e){return"mp4a.40.34"!=e})),e.stream.codecs=t.join(",")}}))}function ea(e,t,r,n,i){return{id:e.ea++,language:t?t.language:"und",primary:!!t&&t.primary||!!r&&r.primary,audio:t,video:r,bandwidth:n,drmInfos:i,allowedByApplication:!0,allowedByKeySystem:!0}}function ta(e,t,r){return g((function n(){var i,a,o,s,u,c,l,d,h,f,p;return N(n,(function(n){switch(n.s){case 1:if(i=ca(t,"URI"),e.h.has(i))return n.return(e.h.get(i));if(a=ca(t,"TYPE").toLowerCase(),o=pe,"subtitles"==a&&(a=o.za),s=Mr(Ni(t,"LANGUAGE","und")),u=Ni(t,"NAME"),c=t.getAttribute("DEFAULT"),l="YES"==c,d=Ni(t,"CHANNELS"),"audio"==a)if(d){var g=d.split("/")[0];g=parseInt(g,10)}else g=null;else g=null;return h=g,f=Ni(t,"CHARACTERISTICS"),w(n,ra(e,i,r,a,s,l,u,h,null,f),2);case 2:return p=n.B,e.h.has(i)?n.return(e.h.get(i)):null==p?n.return(null):(e.L.set(t.id,p),e.h.set(i,p),n.return(p))}}))}))}function ra(e,t,r,n,i,a,o,s,u,c){return g((function l(){var d,h,p,y,m,v,_,b,A,E,S,T,C,I,x,R,O,D,L,M,B,U,G,V,F,j,H,Z;return N(l,(function(l){switch(l.s){case 1:return h=(d=Ui).Sc(e.F,t),w(l,ga(e,ze([h],e.g.retryParameters),0),2);case 2:if(p=l.B,h=p.uri,1!=(y=Zi(e.C,p.data,h)).type)throw new z(2,4,4017);m=[],y.segments.forEach((function(e){e=d.Ab(e.h,"EXT-X-KEY"),m.push.apply(m,e)})),v=!1,_=[],b=null;for(var W=f(m),K=W.next();!K.done;K=W.next())if(A=K.value,"NONE"!=(E=ca(A,"METHOD"))){if(v=!0,"AES-128"==E)return Y.v("Unsupported HLS Encryption",E),e.da=!0,l.return(null);S=ca(A,"KEYFORMAT"),(C=(T=ya[S])?T(A):null)?(C.keyIds.length&&(b=C.keyIds[0]),_.push(C)):Y.v("Unsupported HLS KEYFORMAT",S)}if(v&&!_.length)throw new z(2,4,4026);return function(e,t){var r=va,n=Ui.cb(t.g,"EXT-X-PLAYLIST-TYPE"),i=Ui.cb(t.g,"EXT-X-ENDLIST");i=n&&"VOD"==n.value||i,n=n&&"EVENT"==n.value&&!i,n=!i&&!n,i?pa(e,r.$a):(pa(e,n?r.Wd:r.Se),r=la(t.g,"EXT-X-TARGETDURATION"),r=Number(r.value),e.J=Math.max(r,e.J),e.M=Math.min(r,e.M))}(e,y),I=function(e,t){if(1==t.length)return t[0];var r=ua(e,t);if(null!=r)return r;throw new z(2,4,4025,t)}(n,r),w(l,function(e,t,r,n){return g((function i(){var a,o,s,u,c,l,d,h,f,p;return N(i,(function(i){switch(i.s){case 1:return a=pe,o=n.segments[0].g,s=new Q(o),u=s.pa.split(".").pop(),c=fa[t],(l=c[u])?i.return(l):t==a.za?r&&"vtt"!=r&&"wvtt"!=r?i.return("application/mp4"):i.return("text/vtt"):((d=ze([o],e.g.retryParameters)).method="HEAD",w(i,ga(e,d,1),2));case 2:return h=i.B,(f=h.headers["content-type"])?i.return(f.split(";")[0]):(p=c.mp4,i.return(p))}}))}))}(e,n,I,y),3);case 3:return x=l.B,ha.includes(x)&&(I=""),O=(R=d.cb(y.g,"EXT-X-MEDIA-SEQUENCE"))?Number(R.value):0,k(l,4),w(l,oa(e,t,y,O,x,I),6);case 6:D=l.B,$(l,5);break;case 4:if(4035==(L=P(l)).code)return Y.ba("Skipping unsupported HLS stream",x,t),l.return(null);throw L;case 5:if(M=D[0].startTime,B=D[D.length-1].endTime,U=B-M,G=new oi(D),V=na(y),F=void 0,"text"==n&&(F="subtitle"),j=[],c)for(K=(W=f(c.split(","))).next();!K.done;K=W.next())H=K.value,j.push(H);return Z={id:e.ea++,originalId:o,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:G.find.bind(G),getSegmentReference:G.get.bind(G),initSegmentReference:V,presentationTimeOffset:0,mimeType:x,codecs:I,kind:F,encrypted:v,keyId:b,language:i,label:o,type:n,primary:a,trickModeVideo:null,emsgSchemeIdUris:null,frameRate:void 0,pixelAspectRatio:void 0,width:void 0,height:void 0,bandwidth:void 0,roles:j,channelsCount:s,audioSamplingRate:null,closedCaptions:u},l.return({stream:Z,fc:G,drmInfos:_,Pc:t,We:h,td:M,Yg:B,duration:U})}}))}))}function na(e){var t=Ui.Ab(e.g,"EXT-X-MAP");if(!t.length)return null;if(1<t.length)throw new z(2,4,4020);var r=ca(t=t[0],"URI"),n=Ui.Sc(e.h,r);return e=0,r=null,(t=Ni(t,"BYTERANGE"))&&(e=t.split("@"),t=Number(e[0]),r=(e=Number(e[1]))+t-1),new ni((function(){return[n]}),e,r)}function ia(e,t,r,n){var i=t.h,a=t.g;t=la(i,"EXTINF").value.split(","),t=n+Number(t[0]);var o=0,s=null;return(i=Ui.cb(i,"EXT-X-BYTERANGE"))&&(o=i.value.split("@"),i=Number(o[0]),s=(o=o[1]?Number(o[1]):e.g+1)+i-1),new ii(r,n,t,(function(){return[a]}),o,s)}function aa(e){e.i&&(e.P.forEach((function(t){e.i.Jb(t,0)})),e.P=[])}function oa(e,t,r,n,i,a){return g((function o(){var s,u,c,l,d,h,f,p,y,m;return N(o,(function(o){switch(o.s){case 1:return s=r.segments,u=[],c=s[0].g,l=ia(null,s[0],n,0),d=na(r),w(o,function(e,t,r,n,i,a){return g((function o(){var s,u,c,l,d,h,f,p,g;return N(o,(function(o){switch(o.s){case 1:if(e.A){if(s=e.h.get(t),u=s.fc,c=u.get(n.position))return Y.K("Found segment start time in previous manifest"),o.return(c.startTime);Y.debug("Unable to find segment start time in previous manifest!")}if(Y.K("Fetching segment to find start time"),i=i.toLowerCase(),ha.includes(i))throw Y.ba("Raw formats are not yet supported.  Skipping "+i),new z(1,4,4035);if("video/webm"==i)throw Y.ba("WebM in HLS is not yet supported.  Skipping."),new z(1,4,4035);if("video/mp4"!=i&&"audio/mp4"!=i){o.I(2);break}return l=[sa(e,n)],r&&l.push(sa(e,r)),w(o,Promise.all(l),3);case 3:return d=o.B,h=d[0],f=d[1]||d[0],o.return(function(e,t,r,n){var i=0;if((new Bn).box("moov",Un).box("trak",Un).box("mdia",Un).ma("mdhd",(function(e){e.reader.U(0==e.version?8:16),i=e.reader.N(),e.parser.stop()})).parse(n,!0),!i)throw Y.error("Unable to find timescale in init segment!"),new z(2,4,4030,e,t);var a=0,o=!1;if((new Bn).box("moof",Un).box("traf",Un).ma("tfdt",(function(e){a=(0==e.version?e.reader.N():e.reader.Pb())/i,o=!0,e.parser.stop()})).parse(r,!0),!o)throw new z(2,4,4030,e,t);return a}(t,h.uri,h.data,f.data));case 2:if("video/mp2t"!=i){o.I(4);break}return w(o,sa(e,n),5);case 5:return p=o.B,o.return(function(e,t,r){function n(){a.seek(o+188),71!=(s=a.ra())&&(a.seek(o+192),s=a.ra()),71!=s&&(a.seek(o+204),s=a.ra()),71!=s&&i(),a.Fe(1)}function i(){throw new z(2,4,4030,e,t)}for(var a=new Ln(new DataView(r),0),o=0,s=0;;)if(o=a.ka(),71!=(s=a.ra())&&i(),8191==(8191&(r=a.dc())))n();else if(16384&r){if(0!=(r=(48&a.ra())>>4)&&2!=r||i(),3==r&&(r=a.ra(),a.U(r)),1==a.N()>>8)return a.U(3),0!=(r=a.ra()>>6)&&1!=r||i(),0==a.ra()&&i(),(1073741824*((14&(r=a.ra()))>>1)+((65534&a.dc())<<14|(65534&a.dc())>>1))/9e4;n()}else n()}(t,p.uri,p.data));case 4:if("application/mp4"!=i&&!i.startsWith("text/")){o.I(6);break}return w(o,sa(e,n),7);case 7:return g=o.B,o.return(function(e,t,r){return mr(e=lt(e,t))?(vr(t=new gr(null),e),t.xc(r)):0}(i,a,g.data));case 6:throw new z(2,4,4030,t)}}))}))}(e,t,d,l,i,a),2);case 2:h=o.B,Y.debug("First segment",c.split("/").pop(),"starts at",h);for(var v=0;v<s.length;++v)f=s[v],p=u[u.length-1],y=0==v?h:p.endTime,m=ia(p,f,n+v,y),u.push(m);return e.P.push(u),aa(e),o.return(u)}}))}))}function sa(e,t){return g((function r(){var n,i,a,o,s,u;return N(r,(function(r){switch(r.s){case 1:return n=1,i=Ti(t.i(),t.h,t.h+2048-1,e.g.retryParameters),a=Ti(t.i(),t.h,t.g,e.g.retryParameters),e.g.hls.useFullSegmentsForStartTime?r.return(ga(e,a,n)):(k(r,2),w(r,ga(e,i,n),4));case 4:return o=r.B,r.return(o);case 2:if(7001==(s=P(r)).code)throw s;return Y.ba("Unable to fetch a partial HLS segment! Falling back to a full segment request, which is expensive!  Your server should support Range requests and CORS preflights.",i.uris[0]),w(r,ga(e,a,n),5);case 5:return u=r.B,r.return(u)}}))}))}function ua(e,t){for(var r=da[e],n=0;n<r.length;n++)for(var i=0;i<t.length;i++)if(r[n].test(t[i].trim()))return t[i].trim();return"text"==e?"":null}function ca(e,t){var r=e.getAttribute(t);if(!r)throw new z(2,4,4023,t);return r.value}function la(e,t){var r=Ui.cb(e,t);if(!r)throw new z(2,4,4024,t);return r}j("shaka.net.DataUriPlugin",zi),zi.parse=function(e){var r=e.split(":");if(2>r.length||"data"!=r[0])throw Y.error("Bad data URI, failed to parse scheme"),new z(2,1,1004,e);if(2>(r=r.slice(1).join(":").split(",")).length)throw Y.error("Bad data URI, failed to extract encoding and MIME type"),new z(2,1,1004,e);var n=r[0];e=t.decodeURIComponent(r.slice(1).join(",")),r=n.split(";"),n=r[0];var i=!1;return 1<r.length&&"base64"==r[r.length-1]&&(i=!0,r.pop()),{data:i?Te.Ja(e).buffer:be(e),contentType:n}},Ye("data",zi),j("shaka.hls.HlsParser",Ji),(i=Ji.prototype).configure=function(e){this.g=e},i.start=function(e,t){var r=this;return g((function n(){var i,a;return N(n,(function(n){switch(n.s){case 1:return r.j=t,w(n,ga(r,ze([e],r.g.retryParameters),0),2);case 2:return i=n.B,r.F=i.uri,w(n,function(e,t){return g((function r(){var n,i,a,o,s,u,c,l,d,h,p;return N(r,(function(r){switch(r.s){case 1:if(0!=(n=Zi(e.C,t,e.F)).type)throw new z(2,4,4022);return w(r,function(e,t){return g((function r(){var n,i,a,o,s,u,c,l,d,h,p,y;return N(r,(function(r){switch(r.s){case 1:return n=Ui,i=de,a=t.g,o=n.Ab(t.g,"EXT-X-MEDIA"),s=o.filter(function(e){return"SUBTITLES"==ca(e,"TYPE")}.bind(e)),u=s.map(function(e){var t=this;return g((function r(){var n;return N(r,(function(r){switch(r.s){case 1:return t.g.disableText?r.return(null):(k(r,2),w(r,function(e,t){return g((function r(){var n;return N(r,(function(r){switch(r.s){case 1:return ca(t,"TYPE"),w(r,ta(e,t,[]),2);case 2:return n=r.B,r.return(n.stream)}}))}))}(t,e),4));case 4:return r.return(r.B);case 2:if(n=P(r),t.g.hls.ignoreTextStreamFailures)return r.return(null);throw n}}))}))}.bind(e)),c=o.filter((function(e){return"CLOSED-CAPTIONS"==ca(e,"TYPE")})),function(e,t){for(var r=f(t),n=r.next();!n.done;n=r.next()){ca(n=n.value,"TYPE");var i=Ni(n,"LANGUAGE")||"und";i=Mr(i);var a=ca(n,"GROUP-ID");n=ca(n,"INSTREAM-ID"),e.u.get(a)||e.u.set(a,new Map),e.u.get(a).set(n,i)}}(e,c),w(r,Promise.all(u),2);case 2:return l=r.B,d=n.Ab(a,"EXT-X-STREAM-INF"),h=d.map(function(e){return function(e,t,r){return g((function n(){var i,a,o,s,u,c,l,d,h,p,y,m,v,_,b,A,E,S,T,C,k,I,$,P,x,R,O,D,L;return N(n,(function(n){switch(n.s){case 1:return i=pe,a=Ui,o=[],e.g.disableVideo||o.push("avc1.42E01E"),e.g.disableAudio||o.push("mp4a.40.2"),s=o.join(","),u=Ni(t,"CODECS",s),c=function(e){for(var t=new Set,r=[],n=(e=f(e)).next();!n.done;n=e.next()){var i=ht(n=n.value)[0];t.has(i)?Y.debug("Ignoring duplicate codec"):(r.push(n),t.add(i))}return r}(u.split(/\s*,\s*/)),l=t.getAttribute("RESOLUTION"),h=d=null,p=Ni(t,"FRAME-RATE"),y=Number(Ni(t,"AVERAGE-BANDWIDTH"))||Number(ca(t,"BANDWIDTH")),l&&(m=l.value.split("x"),d=m[0],h=m[1]),v=(v=a.Ab(r.g,"EXT-X-MEDIA")).filter((function(e){return"CLOSED-CAPTIONS"!=ca(e,"TYPE")})),v=v.filter((function(e){var t=Ni(e,"URI")||"";return"SUBTITLES"==(Ni(e,"TYPE")||"")||""!=t})),_=Ni(t,"AUDIO"),b=Ni(t,"VIDEO"),_?v=a.Zc(v,"AUDIO",_):b&&(v=a.Zc(v,"VIDEO",b)),(A=ua(i.za,c))&&((E=Ni(t,"SUBTITLES"))&&(S=a.Zc(v,"SUBTITLES",E)).length&&(T=e.L.get(S[0].id))&&(T.stream.codecs=A),je(c,A)),C=v.map(function(e){return ta(this,e,c)}.bind(e)),k=[],I=[],w(n,Promise.all(C),2);case 2:if(P=(P=n.B).filter((function(e){return null!=e})),_?k=P:b&&(I=P),Y.debug("Guessing stream type for",t.toString()),R=!1,k.length||I.length?k.length?(D=ca(t,"URI"),L=k[0].Pc,D==L?(Y.debug("Guessing audio-only."),x=i.Sb,R=!0):(Y.debug("Guessing video."),x=i.Za)):(Y.debug("Guessing audio."),x=i.Sb):1==c.length?(O=ua(i.Za,c),l||p||O?(Y.debug("Guessing video-only."),x=i.Za):(Y.debug("Guessing audio-only."),x=i.Sb)):(Y.debug("Guessing multiplexed audio+video."),x=i.Za,c=[c.join(",")]),R){n.I(3);break}return w(n,function(e,t,r,n){return g((function i(){var a,o,s,u,c;return N(i,(function(i){switch(i.s){case 1:return a=pe,o=ca(t,"URI"),e.h.has(o)?i.return(e.h.get(o)):(s=Ni(t,"CLOSED-CAPTIONS"),u=null,n==a.Za&&s&&"NONE"!=s&&(u=e.u.get(s)),w(i,ra(e,o,r,n,"und",!1,null,null,u,null),2));case 2:return null==(c=i.B)?i.return(null):e.h.has(o)?i.return(e.h.get(o)):(e.h.set(o,c),i.return(c))}}))}))}(e,t,c,x),4);case 4:$=n.B;case 3:if($)$.stream.type==i.Sb?k=[$]:I=[$];else if(null===$)return Y.debug("streamInfo is null"),n.return([]);return I&&qi(I),k&&qi(k),n.return(function(e,t,r,n,i,a,o){r.forEach(function(e){(e=e.stream)&&(e.width=Number(i)||void 0,e.height=Number(a)||void 0,e.frameRate=Number(o)||void 0)}.bind(e));var s=!!e.g&&e.g.disableAudio;t.length&&!s||(t=[null]),s=!!e.g&&e.g.disableVideo,(!r.length||s)&&(r=[null]),s=[];for(var u=(t=f(t)).next();!u.done;u=t.next()){u=u.value;for(var c=f(r),l=c.next();!l.done;l=c.next()){var d=l.value;l=u?u.stream:null;var h=d?d.stream:null,p=u?u.drmInfos:null,g=d?d.drmInfos:null;d=(d?d.Pc:"")+" - "+(u?u.Pc:"");var y=void 0;if(l&&h){if(p.length&&g.length&&!(0<Ut(p,g).length)){Y.v("Incompatible DRM info in HLS variant.  Skipping.");continue}y=Ut(p,g)}else l?y=p:h&&(y=g);e.Z.has(d)?Y.debug("Skipping variant which only differs in text streams."):(l=ea(e,l,h,n,y),s.push(l),e.Z.add(d))}}return s}(e,k,I,y,d,h,p))}}))}))}(this,e,t)}.bind(e)),w(r,Promise.all(h),3);case 3:return p=r.B,y=(y=p.reduce(i.Rc,[])).filter((function(e){return null!=e})),r.return({startTime:0,variants:y,textStreams:l.filter((function(e){return null!=e}))})}}))}))}(e,n),2);case 2:if(i=r.B,!e.j)throw new z(2,7,7001);if(e.da&&0==i.variants.length)throw Y.info("No stream is created, because we don't support AES-128","encryption yet"),new z(2,4,4034);e.j.filterAllPeriods([i]),a=1/0,o=0,s=1/0;for(var y=f(e.h.values()),m=y.next();!m.done;m=y.next())u=m.value,a=Math.min(a,u.td),o=Math.max(o,u.td),"text"!=u.stream.type&&(s=Math.min(s,u.duration));if(e.l!=va.$a?(e.i=new Si(0,3*e.J),e.i.hc(!1)):(e.i=new Si(null,0),e.i.hc(!0)),aa(e),e.l!=va.$a){for(e.X=e.M,c=va,e.l==c.Wd&&(l=e.i.Ic,isNaN(e.g.availabilityWindowOverride)||(l=e.g.availabilityWindowOverride),e.i.Pd(l)),d=0;95443.7176888889<=o;)d+=95443.7176888889,o-=95443.7176888889;if(d)for(Y.debug("Offsetting live streams by",d,"to compensate for rollover"),m=(y=f(e.h.values())).next();!m.done;m=y.next())95443.7176888889>(h=m.value).td?(Y.K("Offset applied to",h.stream.type),h.stream.presentationTimeOffset=-d,h.fc.offset(d)):Y.K("Offset NOT applied to",h.stream.type)}else for(e.i.Fa(s),e.i.offset(-a),m=(y=f(e.h.values())).next();!m.done;m=y.next())(p=m.value).stream.presentationTimeOffset=a,p.fc.offset(-a),si(p.fc,s);e.A={presentationTimeline:e.i,periods:[i],offlineSessionIds:[],minBufferTime:0},C(r)}}))}))}(r,i.data),3);case 3:return 0<(a=r.X)&&r.m.V(a),n.return(r.A)}}))}))},i.stop=function(){this.m&&(this.m.stop(),this.m=null);var e=[];return this.o&&(e.push(this.o.destroy()),this.o=null),this.g=this.j=null,this.L.clear(),this.Z.clear(),this.h.clear(),this.A=null,Promise.all(e)},i.update=function(){if(this.l!=va.$a){for(var e=[],t=f(this.h.values()),r=t.next();!r.done;r=t.next())e.push(Qi(this,r.value));return Promise.all(e)}},i.onExpirationUpdated=function(){};var da={audio:[/^vorbis$/,/^opus$/,/^flac$/,/^mp4a/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]},ha=["audio/aac","audio/ac3","audio/ec3","audio/mpeg"],fa={audio:{mp4:"audio/mp4",mp4a:"audio/mp4",m4s:"audio/mp4",m4i:"audio/mp4",m4a:"audio/mp4",m4f:"audio/mp4",cmfa:"audio/mp4",ts:"video/mp2t",aac:"audio/aac",ac3:"audio/ac3",ec3:"audio/ec3",mp3:"audio/mpeg"},video:{mp4:"video/mp4",mp4v:"video/mp4",m4s:"video/mp4",m4i:"video/mp4",m4v:"video/mp4",m4f:"video/mp4",cmfv:"video/mp4",ts:"video/mp2t"},text:{mp4:"application/mp4",m4s:"application/mp4",m4i:"application/mp4",m4f:"application/mp4",cmft:"application/mp4",vtt:"text/vtt",ttml:"application/ttml+xml"}};function pa(e,t){e.l=t,e.i&&e.i.hc(e.l==va.$a),e.l!=va.$a||e.m.stop()}function ga(e,t,r){if(!e.o)throw new z(2,7,7001);return t=e.j.networkingEngine.request(r,t),We(e.o,t),t.promise}var ya={"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":function(e){var t=ca(e,"METHOD");Hr("HLS SAMPLE-AES-CENC","SAMPLE-AES-CENC will no longer be supported, see Issue #1227");var r=["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"];return r.includes(t)?(t=ca(e,"URI"),t=zi.parse(t),t=fe("com.widevine.alpha",[{initDataType:"cenc",initData:t=new Uint8Array(t.data)}]),(e=Ni(e,"KEYID"))&&(t.keyIds=[e.toLowerCase().substr(2)]),t):(Y.error("Widevine in HLS is only supported with [",r.join(", "),"], not",t),null)}},ma="VOD",va={$a:ma,Se:"EVENT",Wd:"LIVE"};function _a(){this.g=new Map}function ba(e,t,r){Aa(e,t).text=r}function Aa(e,t){return e.g.has(t)||e.g.set(t,new Ea),e.g.get(t)}function Ea(){this.text=this.variant=null}function Sa(e,t){this.g=e,this.h=new Set([e]);for(var r=f(t=t||[]),n=r.next();!n.done;n=r.next())this.add(n.value)}function Ta(e,t){var r;if(!(r=!!e.audio!=!!t.audio||!!e.video!=!!t.video||e.language!=t.language)&&(r=e.audio&&t.audio)){r=e.audio;var n=t.audio;r=!(r.channelsCount==n.channelsCount&&wa(r,n)&&Ca(r.roles,n.roles))}return!r&&(r=e.video&&t.video)&&(r=!(wa(r=e.video,n=t.video)&&Ca(r.roles,n.roles))),!r}function wa(e,t){if(e.mimeType!=t.mimeType)return!1;var r=e.codecs.split(",").map((function(e){return ht(e)[0]})),n=t.codecs.split(",").map((function(e){return ht(e)[0]}));if(r.length!=n.length)return!1;r.sort(),n.sort();for(var i=0;i<r.length;i++)if(r[i]!=n[i])return!1;return!0}function Ca(e,t){var r=new Set(e),n=new Set(t);if(r.delete("main"),n.delete("main"),r.size!=n.size)return!1;for(var i=(r=f(r)).next();!i.done;i=r.next())if(!n.has(i.value))return!1;return!0}function ka(e){this.g=e,this.h=new Ia(e.language,"",e.audio&&e.audio.channelsCount?e.audio.channelsCount:0,"")}function Ia(e,t,r,n){this.i=e,this.j=t,this.g=r,this.h=void 0===n?"":n}function $a(){this.g=Ra,this.h=(new Map).set(Ra,2).set(xa,1)}function Pa(e,t,r){e.h.set(Ra,r).set(xa,t)}Ei.Fd("m3u8",Ji),Ei.Qb("application/x-mpegurl",Ji),Ei.Qb("application/vnd.apple.mpegurl",Ji),Sa.prototype.add=function(e){return Ta(this.g,e)?(this.h.add(e),!0):(Y.v("Rejecting variant - not compatible with root."),!1)},Sa.prototype.values=function(){return this.h.values()},ka.prototype.create=function(e){var t=this,r=e.filter((function(e){return Ta(t.g,e)}));return r.length?new Sa(r[0],r):this.h.create(e)},Ia.prototype.create=function(e){var t=[];t=function(e,t){var r=Br(Mr(t),e.map((function(e){return Nr(e)})));return r?e.filter((function(e){return r==Nr(e)})):[]}(e,this.i);var r=e.filter((function(e){return e.primary}));for((e=function(e,t){return e.filter((function(e){return!!e.audio&&(t?e.audio.roles.includes(t):0==e.audio.roles.length)}))}(t=t.length?t:r.length?r:e,this.j)).length?t=e:Y.v("No exact match for variant role could be found."),this.g&&((e=Gr.ee(t,this.g)).length?t=e:Y.v("No exact match for the channel count could be found.")),this.h&&(e=function(e,t){return e.filter((function(e){return!!e.audio&&e.audio.label.toLowerCase()==t.toLowerCase()}))}(t,this.h),e.length?t=e:Y.v("No exact match for variant label could be found.")),e=new Sa(t[0]),r=(t=f(t)).next();!r.done;r=t.next())r=r.value,Ta(e.g,r)&&e.add(r);return e};var xa=0,Ra=1;function Oa(e,t){this.l=e,this.m=La(e),this.g=e.g.currentTime,this.j=Date.now()/1e3,this.h=!1,this.o=t,this.i=function(){}}function Da(e){this.g=e}function La(e){if(e.g.paused||0==e.g.playbackRate||0==e.g.buffered.length)var t=!1;else e:{t=e.g.buffered,e=e.g.currentTime;for(var r=0;r<t.length;r++){var n=t.start(r),i=t.end(r);if(!(e<n-.1||e>i-.5)){t=!0;break e}}t=!1}return t}function Ma(e,t,r,n,i){var a=this;this.g=e,this.F=t,this.C=r,this.u=i,this.j=new tt,this.o=!1,this.A=e.readyState,this.i=!1,this.h=n,this.m=!1,this.j.H(e,"waiting",(function(){return Na(a)})),this.l=new $e((function(){Na(a)})).Oa(.25)}function Na(e){if(0!=e.g.readyState){if(e.g.seeking){if(!e.o)return}else e.o=!1;if(!e.g.paused||0==e.g.currentTime){var t;if(e.g.readyState!=e.A&&(e.i=!1,e.A=e.g.readyState),!(t=!e.h)){var r=(t=e.h).l,n=La(r),i=r.g.currentTime,a=Date.now()/1e3;t.g==i&&t.m==n||(t.j=a,t.g=i,t.m=n,t.h=!1),(n=(i=a-t.j)>=t.o&&n&&!t.h)&&(t.i(t.g,i),t.h=!0,t.g=r.g.currentTime),t=!n}if(t){a=e.C.smallGapLimit,t=e.g.currentTime;e:{if((r=e.g.buffered)&&r.length&&!(1==r.length&&1e-6>r.end(0)-r.start(0)))for(n=navigator.userAgent.match(/Edge\//)||_t("Trident/")||yt()||_t("CrKey")?.5:.1,i=0;i<r.length;i++)if(r.start(i)>t&&(0==i||r.end(i-1)-t<=n)){n=i;break e}n=null}if(null!=n&&(0!=n||e.m)){i=r.start(n);var o=e.F.Ka();if(!(i>=o)){a=(o=i-t)<=a;var s=!1;if(!(.001>o)){if(!a&&!e.i){e.i=!0;var u=new Be("largegap",{currentTime:t,gapSize:o});u.cancelable=!0,e.u(u),e.C.jumpLargeGaps&&!u.defaultPrevented?s=!0:Y.info("Ignoring large gap at",t,"size",o)}(a||s)&&(0==n?Y.info("Jumping forward",o,"seconds because of gap before start time of",i):Y.info("Jumping forward",o,"seconds because of gap starting at",r.end(n-1),"and ending at",i),e.g.currentTime=i)}}}}}}}function Ba(e){var t=this;this.i=e,this.g=new Set,this.h=new $e((function(){Ua(t,!1)})).Oa(.25)}function Ua(e,t){for(var r=f(e.g),n=r.next();!n.done;n=r.next())n.value.l(e.i.currentTime,t)}function Ga(e){for(var t=[],r=(e=f(e)).next();!r.done;r=e.next())for(var n=(r=f(r.value.variants)).next();!n.done;n=r.next())t.push(n.value);return t}function Va(e,t){for(var r=null,n=f(e),i=n.next();!i.done;i=n.next())t>=(i=i.value).startTime&&(r=i);return r}function Fa(e){this.i=e,this.g=null,this.h=function(){}}function ja(e){var t=this;this.g=e,this.j=!1,this.i=this.g.wc(),this.h=new $e((function(){t.g.pe(.25*t.i)}))}function Ha(e){e.h.stop();var t=e.j?0:e.i;if(0<=t)try{return void(e.g.wc()!=t&&e.g.Od(t))}catch(r){}e.h.Oa(.25),0!=e.g.wc()&&e.g.Od(0)}function Za(e,t,r,n){t==HTMLMediaElement.HAVE_NOTHING||e.readyState>=t?n():(t=Wa.get(t),r.ya(e,t,n))}Oa.prototype.release=function(){this.l=null,this.i=function(){}},Ma.prototype.release=function(){this.j&&(this.j.release(),this.j=null),null!=this.l&&(this.l.stop(),this.l=null),this.h&&(this.h.release(),this.h=null),this.g=this.F=this.u=null},Ma.prototype.zd=function(){this.m=!0,Na(this)},Ba.prototype.release=function(){this.h.stop();for(var e=f(this.g),t=e.next();!t.done;t=e.next())t.value.release();this.g.clear()},Fa.prototype.release=function(){this.g=this.i=null,this.h=function(){}},Fa.prototype.l=function(e){var t=this.g,r=this.i.periods;t!=(e=Va(r,e)||r[0])&&this.h(e),this.g=e},ja.prototype.release=function(){this.h&&(this.h.stop(),this.h=null),this.g=null},ja.prototype.set=function(e){this.i=e,Ha(this)},ja.prototype.vc=function(){return this.g.vc()};var Wa=new Map([[HTMLMediaElement.HAVE_METADATA,"loadedmetadata"],[HTMLMediaElement.HAVE_CURRENT_DATA,"loadeddata"],[HTMLMediaElement.HAVE_FUTURE_DATA,"canplay"],[HTMLMediaElement.HAVE_ENOUGH_DATA,"canplaythrough"]]);function Ka(e,t,r){var n=this;this.g=e,this.l=t,this.j=r,this.m=!1,this.h=new tt,this.i=new Qa(e),Za(this.g,HTMLMediaElement.HAVE_METADATA,this.h,(function(){za(n,n.j)}))}function Xa(e){return e.m?e.g.currentTime:e.j}function Ya(e,t){0<e.g.readyState?qa(e.i,t):Za(e.g,HTMLMediaElement.HAVE_METADATA,e.h,(function(){za(e,e.j)}))}function za(e,t){.001>Math.abs(e.g.currentTime-t)?Ja(e):(e.h.ya(e.g,"seeking",(function(){Ja(e)})),qa(e.i,0==e.g.currentTime?t:e.g.currentTime))}function Ja(e){e.m=!0,e.h.H(e.g,"seeking",(function(){return e.l()}))}function Qa(e){var t=this;this.h=e,this.m=10,this.l=this.i=this.j=0,this.g=new $e((function(){0>=t.j?(Y.v(["Failed to move playhead from",t.i,"to",t.l].join(" ")),t.g.stop()):t.h.currentTime!=t.i?t.g.stop():(t.h.currentTime=t.l,t.j--)}))}function qa(e,t){e.i=e.h.currentTime,e.l=t,e.j=e.m,e.h.currentTime=t,e.g.Oa(.1)}function eo(e){var t=this;this.g=e,this.j=!1,this.i=null,this.h=new tt,Za(this.g,HTMLMediaElement.HAVE_CURRENT_DATA,this.h,(function(){null==t.i?t.j=!0:(t.h.ya(t.g,"seeking",(function(){t.j=!0})),t.g.currentTime=Math.max(0,t.g.currentTime+t.i))}))}function to(e,t,r,n,i,a){var o=this;this.i=e,this.g=t.presentationTimeline,this.J=t.minBufferTime||0,this.m=r,this.F=i,this.u=null,this.j=new Ma(e,t.presentationTimeline,r,function(e,t){if(!t.stallEnabled)return null;var r=t.stallSkip,n=new Oa(new Da(e),t.stallThreshold);return function(e,t){e.i=t}(n,(function(t,n){Y.debug("Stall detected at "+t+" for "+n+" seconds."),r?(Y.debug("Seeking forward "+r+" seconds to break stall."),e.currentTime+=r):(Y.debug("Pausing and unpausing to break stall."),e.pause(),e.play())})),n}(e,r),a),this.h=new Ka(e,(function(){e:{var e=o.j;e.o=!0,e.m=!1,e.i=!1,e=Xa(o.h);var t=no(o,e);if(.001<Math.abs(t-e)){var r=Date.now()/1e3;if(!o.u||o.u<r-1){o.u=r,Ya(o.h,t),e=void 0;break e}}Y.K("Seek to "+e),o.F(),e=void 0}return e}),function(e,t){return null==t?t=1/0>e.g.ha()?e.g.Cb():e.g.Ka():0>t&&(t=e.g.Ka()+t),ro(e,io(e,t))}(this,n)),this.o=new $e((function(){if(0!=o.i.readyState&&!o.i.paused){var e=Xa(o.h),t=o.g.Cb(),r=o.g.Ka();3>r-t&&(t=r-3),e<t&&(t=no(o,e),Y.info("Jumping forward "+(t-e)+" seconds to catch up with the seek range."),o.i.currentTime=t)}})).Oa(.25)}function ro(e,t){var r=e.g.ha();return t>=r?r-e.m.durationBackoff:t}function no(e,t){var r=Yt.bind(null,e.i.buffered),n=Math.max(e.J,e.m.rebufferingGoal),i=e.m.safeSeekOffset,a=e.g.Cb(),o=e.g.Ka(),s=e.g.ha();3>o-a&&(a=o-3);var u=e.g.Zb(n),c=e.g.Zb(i);return n=e.g.Zb(n+i),t>=s?(Y.K("Playhead past duration."),ro(e,t)):t>o?(Y.K("Playhead past end."),o):t<a?r(c)?(Y.K("Playhead before start & start is buffered"),c):(Y.K("Playhead before start & start is unbuffered"),n):t>=u||r(t)?(Y.K("Playhead in safe region or in buffered region."),t):(Y.K("Playhead outside safe region & in unbuffered region."),n)}function io(e,t){var r=e.g.Cb();return t<r||t>(r=e.g.Ka())?r:t}function ao(e){var t=this;this.h=function(){},this.g=new Set,this.j=e,this.i=new $e((function(){for(var e=t.j(),r=f(t.g),n=r.next();!n.done;n=r.next())(n=n.value).endTime<e.start&&t.g.delete(n)})).Oa(2)}function oo(e){var t=this;this.m=e,this.j=new Map,this.g=function(){},this.h=function(){},this.i=function(){},this.o=[{rb:null,qb:uo,hb:function(e,r){return t.g(e,r)}},{rb:so,qb:uo,hb:function(e,r){return t.g(e,r)}},{rb:co,qb:uo,hb:function(e,r){return t.g(e,r)}},{rb:uo,qb:so,hb:function(e,r){return t.h(e,r)}},{rb:uo,qb:co,hb:function(e,r){return t.h(e,r)}},{rb:so,qb:co,hb:function(e,r){return t.i(e,r)}},{rb:co,qb:so,hb:function(e,r){return t.i(e,r)}}]}Ka.prototype.release=function(){this.h&&(this.h.release(),this.h=null),null!=this.i&&(this.i.release(),this.i=null),this.l=function(){},this.g=null},Qa.prototype.release=function(){this.g&&(this.g.stop(),this.g=null),this.h=null},eo.prototype.release=function(){this.h&&(this.h.release(),this.h=null),this.g=null},eo.prototype.A=function(e){this.i=this.j?this.i:e},eo.prototype.l=function(){return(this.j?this.g.currentTime:this.i)||0},eo.prototype.C=function(){},to.prototype.release=function(){this.h&&(this.h.release(),this.h=null),this.j&&(this.j.release(),this.j=null),this.o&&(this.o.stop(),this.o=null),this.i=this.h=this.g=this.m=null,this.F=function(){}},to.prototype.A=function(e){Ya(this.h,e)},to.prototype.l=function(){var e=Xa(this.h);return 0<this.i.readyState&&!this.i.paused?io(this,e):e},to.prototype.C=function(){this.j.zd()},ao.prototype.release=function(){this.h=function(){},this.g.clear(),this.i.stop()},oo.prototype.release=function(){this.m=null,this.j.clear(),this.g=function(){},this.h=function(){},this.i=function(){}},oo.prototype.l=function(e,t){for(var r=f(this.m.g),n=r.next();!n.done;n=r.next()){n=n.value;var i=this.j.get(n),a=e<n.startTime?so:e>n.endTime?co:uo;this.j.set(n,a);for(var o=f(this.o),s=o.next();!s.done;s=o.next())(s=s.value).rb==i&&s.qb==a&&s.hb(n,t)}};var so=1,uo=2,co=3;function lo(e,t){this.g=t,this.i=e,this.l=null,this.u=1,this.F=Promise.resolve(),this.m=[],this.o=new Map,this.h=new Map,this.C=!1,this.M=null,this.L=this.j=this.A=!1,this.J=0}function ho(e){return po(e,"audio")}function fo(e){return po(e,"video")}function po(e,t){var r=e.h.get(t);return r?r.Ta||r.stream:null}function go(e,t){return g((function r(){var n,i,a,o,s,u,c,l,d;return N(r,(function(r){switch(r.s){case 1:return n=pe,w(r,Pr(e.g.T,n.za),2);case 2:return e.J++,e.L=!1,i=e.J,a=e.g.T,o=new Map,s=new Set,o.set(n.za,t),s.add(t),w(r,a.init(o,!1),3);case 3:return e.j?r.return():w(r,So(e,s),4);case 4:if(e.j)return r.return();u=e.g.T.l.isTextVisible()||e.l.alwaysStreamText,e.J!=i||e.h.has(n.za)||e.L||!u||(c=e.g.eb(),l=xo(e,c),d=Ao(t,l,0),e.h.set(n.za,d),Lo(e,d,0)),C(r)}}))}))}function yo(e,t){var r=e.h.get("video");if(r){var n=r.stream;if(n)if(Y.debug("setTrickPlay",t),t){var i=n.trickModeVideo;i&&!r.Ta&&(Y.debug("Engaging trick mode stream",i),vo(e,i,!1,0,!1),r.Ta=n)}else(n=r.Ta)&&(Y.debug("Restoring non-trick-mode stream",n),r.Ta=null,vo(e,n,!0,0,!1))}}function mo(e,t,r,n){var i=!1;if(t.video){var a=vo(e,t.video,r,n,!1);i=i||a}return t.audio&&(e=vo(e,t.audio,r,n,!1),i=i||e),i}function vo(e,t,r,n,i){var a=e.h.get(t.type);if(!a&&"text"==t.type&&e.l.ignoreTextStreamFailures)return go(e,t),!0;if(!a)return!1;var o=Ro(e,t),s=Array.from(e.h.values()).every((function(e){return e.oa==a.oa}));return r&&o!=a.oa&&s?(Y.debug("switch: switching to stream in another Period; clearing buffer and changing Periods"),e.h.forEach((function(t){_o(e,t)})),!0):(a.Ta&&(Y.debug("switch during trick play mode",t),t.trickModeVideo?(a.Ta=t,t=t.trickModeVideo,Y.debug("switch found trick play stream",t)):(a.Ta=null,Y.debug("switch found no special trick play stream"))),!(!(s=e.m[o])||!s.Rb||!(s=e.o.get(t.id))||!s.Rb||(a.stream!=t||i?("text"==t.type&&Sr(e.g.T,lt(t.mimeType,t.codecs)),a.stream=t,a.Ac=!0,Y.debug("switch: switching to Stream "+Uo(a)),function(e,t,r){if(!t.lb)return!1;var n=e.g.eb(),i=Cr(e.g.T,t.type),a=Co(e,t,n,i,r);return r=a&&a.g?a.g-a.h:null,a&&!r&&(r=(a.endTime-a.xc())*t.stream.bandwidth/8),!isNaN(r)&&((a=t.stream.initSegmentReference)&&(r+=(a.g?a.g-a.h:null)||0),a=e.g.getBandwidthEstimate(),8*r/a<i-n-Math.max(e.i.minBufferTime||0,e.l.rebufferingGoal)||t.lb.h.g>r)}(e,a,o)&&(Y.info("Aborting current segment request to switch."),a.lb.abort()),r&&(a.ab?a.Qc=!0:a.Sa?(a.Wa=!0,a.oc=n,a.Qc=!0):(Mo(a),Do(e,a,!0,n).catch((function(t){e.g&&e.g.onError(t)})))),0):(Y.debug("switch: Stream "+Uo(a)+" already active"),1))))}function _o(e,t){var r=Uo(t);t.ab?Y.debug(r,"clear: already clearing the buffer"):t.Wa?Y.debug(r,"clear: already waiting"):t.Sa?(Y.debug(r,"clear: currently updating"),t.Wa=!0,t.oc=0):null==wr(e.g.T,t.type)?(Y.debug(r,"clear: nothing buffered"),null==t.Pa&&Lo(e,t,0)):(Y.debug(r,"clear: handling right now"),Mo(t),Do(e,t,!1,0).catch((function(t){e.g&&e.g.onError(t)})))}function bo(e,t,r,n,i){return g((function a(){var o,s,u,c,l,d,h;return N(a,(function(a){switch(a.s){case 1:return o=e.g.eb(),s=xo(e,o),u=pe,c=new Map,l=new Set,t&&(c.set(u.Sb,t),l.add(t)),r&&(c.set(u.Za,r),l.add(r)),n&&(c.set(u.za,n),l.add(n)),d=e.g.T,h=e.l.forceTransmuxTS,w(a,d.init(c,h),2);case 2:return e.j?a.return():(function(e){var t=e.i.presentationTimeline.ha();1/0>t?e.g.T.Fa(t):e.g.T.Fa(Math.pow(2,32))}(e),w(a,So(e,l),3));case 3:if(e.j)return a.return();c.forEach((function(t,r){if(!e.h.has(r)){var n=Ao(t,s,i);e.h.set(r,n),Lo(e,n,0)}})),C(a)}}))}))}function Ao(e,t,r){return{stream:e,type:e.type,Hb:null,La:null,Ta:null,Ac:!0,oa:t,endOfStream:!1,Sa:!1,Pa:null,Wa:!1,oc:0,Qc:!1,ab:!1,Ed:!1,ac:!1,Hd:r||0,lb:null}}function Eo(e,t){var r=e.m[t];if(r)return Y.debug("(all) Period "+t+" is being or has been set up"),r.promise;Y.debug("(all) setting up Period "+t),r={promise:new ye,Rb:!1},e.m[t]=r;for(var n=new Set,i=f(e.i.periods[t].variants),a=i.next();!a.done;a=i.next())(a=a.value).video&&n.add(a.video),a.video&&a.video.trickModeVideo&&n.add(a.video.trickModeVideo),a.audio&&n.add(a.audio);for(a=(i=f(e.i.periods[t].textStreams)).next();!a.done;a=i.next())n.add(a.value);return e.F=e.F.then(function(){if(!this.j)return So(this,n)}.bind(e)).then(function(){this.j||(this.m[t].promise.resolve(),this.m[t].Rb=!0,Y.K("(all) setup Period "+t))}.bind(e)).catch(function(e){this.j||(this.m[t].promise.catch((function(){})),this.m[t].promise.reject(),delete this.m[t],Y.v("(all) failed to setup Period "+t),this.g.onError(e))}.bind(e)),r.promise}function So(e,t){return g((function r(){var n,i,a,o,s,u,c;return N(r,(function(r){switch(r.s){case 1:n=[];for(var l=f(t),d=l.next();!d.done;d=l.next())i=d.value,(a=e.o.get(i.id))?(Y.debug("(all) Stream "+i.id+" is being or has been set up"),n.push(a.promise)):(Y.K("(all) setting up Stream "+i.id),e.o.set(i.id,{promise:new ye,Rb:!1}),n.push(i.createSegmentIndex()));return k(r,2),w(r,Promise.all(n),4);case 4:if(e.j)return r.return();$(r,3);break;case 2:if(o=P(r),e.j)return r.return();for(d=(r=f(t)).next();!d.done;d=r.next())s=d.value,e.o.get(s.id).promise.catch((function(){})),e.o.get(s.id).promise.reject(),e.o.delete(s.id);throw o;case 3:for(d=(l=f(t)).next();!d.done;d=l.next())u=d.value,(c=e.o.get(u.id)).Rb||(c.promise.resolve(),c.Rb=!0,Y.K("(all) setup Stream "+u.id));C(r)}}))}))}function To(t,r){if(!t.j){var n=Uo(r);if(!r.Sa&&null!=r.Pa&&!r.ab)if(r.Pa=null,r.Wa)Y.debug(n,"skipping update and clearing the buffer"),Do(t,r,r.Qc,r.oc);else{try{var i=function(e,t){if($o(t))return $r(e.g.T,t.stream.originalId||""),null;var r=Uo(t),n=e.g.eb(),i=wo(e,t,n);Y.O(r,"timeNeeded="+i);var a=Ro(e,t.stream),o=xo(e,i),s=function(e,t,r){return"text"==t?null==(e=e.g).h||e.h<r?0:e.h-Math.max(r,e.g):zt(e=kr(e,t),r)}(e.g.T,t.type,n);Y.O(r,"update_:","presentationTime="+n,"bufferedAhead="+s);var u=Math.max(e.i.minBufferTime||0,e.l.rebufferingGoal,e.l.bufferingGoal)*e.u;if(i>=e.i.presentationTimeline.ha())return Y.debug(r,"buffered to end of presentation"),t.endOfStream=!0,"video"==t.type&&(i=e.h.get("text"))&&"application/cea-608"==i.stream.mimeType&&(i.endOfStream=!0),null;if(t.endOfStream=!1,t.oa=o,o!=a)return Y.debug(r,"need Period "+o,"presentationTime="+n,"timeNeeded="+i,"currentPeriodIndex="+a),null;if(s>=u)return Y.O(r,"buffering goal met"),.5;if(r=Cr(e.g.T,t.type),!(r=Co(e,t,n,r,a)))return 1;var c=1/0;return Array.from(e.h.values()).forEach((function(t){$o(t)||(t=wo(e,t,n),c=Math.min(c,t))})),i>=c+e.i.presentationTimeline.g?1:(t.Hd=0,function(e,t,r,n,i){var a=Uo(t),o=e.i.periods[n];Y.K(a,"fetchAndAppend_:","presentationTime="+r,"currentPeriod.startTime="+o.startTime,"reference.position="+i.position,"reference.startTime="+i.startTime,"reference.endTime="+i.endTime);var s=t.stream,u=e.i.presentationTimeline.ha(),c=e.i.periods[n+1];n=function(e,t,r,n,i){if(!t.Ac)return Promise.resolve();var a=Uo(t);return r=e.i.periods[r].startTime-t.stream.presentationTimeOffset,Y.K(a,"setting timestamp offset to "+r),Y.K(a,"setting append window start to "+n),Y.K(a,"setting append window end to "+i),n=function(e,t,r,n,i){return"text"==t?(e.g.A=r,(e=e.g).j=n,e.m=i,Promise.resolve()):Promise.all([xr(e,t,e.Ve.bind(e,t)),xr(e,t,e.Cg.bind(e,t,r)),xr(e,t,e.zg.bind(e,t,n,i))])}(e.g.T,t.type,r,n,i),t.stream.initSegmentReference?(Y.K(a,"fetching init segment"),e=Oo(e,t,t.stream.initSegmentReference).then(function(e){if(!this.j)return Y.K(a,"appending init segment"),Ir(this.g.T,t.type,e,null,null,t.stream.closedCaptions&&0<t.stream.closedCaptions.size)}.bind(e)).catch((function(e){return t.Ac=!0,Promise.reject(e)})),Promise.all([n,e])):n}(e,t,n,Math.max(0,o.startTime-.1),c?c.startTime+.01:u),t.Sa=!0,t.Ac=!1,Y.O(a,"fetching segment"),u=Oo(e,t,i),Promise.all([n,u]).then(function(e){if(!this.j&&!this.A)return function(e,t,r,n,i,a,o){var s=Uo(t),u=i.closedCaptions&&0<i.closedCaptions.size;return null!=i.emsgSchemeIdUris&&0<i.emsgSchemeIdUris.length&&(new Bn).ma("emsg",e.P.bind(e,n,a,i.emsgSchemeIdUris)).parse(o),function(e,t,r){var n=Uo(t);Y.O(n,"checking buffer length");var i=Math.max(e.l.bufferBehind,e.i.presentationTimeline.g),a=wr(e.g.T,t.type);if(null==a)return Y.O(n,"buffer behind okay because nothing buffered:","presentationTime="+r,"bufferBehind="+i),Promise.resolve();var o=r-a,s=o-i;return.01>=s?(Y.O(n,"buffer behind okay:","presentationTime="+r,"bufferedBehind="+o,"bufferBehind="+i,"underflow="+Math.abs(s)),Promise.resolve()):(Y.K(n,"buffer behind too large:","presentationTime="+r,"bufferedBehind="+o,"bufferBehind="+i,"overflow="+s),e.g.T.remove(t.type,a,a+s).then(function(){this.j||Y.K(n,"evicted "+s+" seconds")}.bind(e)))}(e,t,r).then(function(){if(!this.j)return Y.K(s,"appending media segment"),Ir(this.g.T,t.type,o,a.startTime+n.startTime,a.endTime+n.startTime,u)}.bind(e)).then(function(){if(!this.j)return Y.O(s,"appended media segment"),t.Hb=i,t.La=a,Promise.resolve()}.bind(e))}(this,t,r,o,s,i,e[1])}.bind(e)).then(function(){this.j||this.A||(t.Sa=!1,t.Ed=!1,t.Wa||this.g.zd(),Lo(this,t,0),function(e,t,r){if(!e.C){var n=Uo(t);if(1==(t=Array.from(e.h.values())).length&&"text"==t[0].type||(e.C=t.every((function(e){return"text"==e.type||!e.Wa&&!e.ab&&e.La}))),e.C){for(Y.debug(n,"startup complete"),r=Ro(e,r),e.m[r]||Eo(e,r).then(function(){this.j||(Y.K(n,"calling onCanSwitch()..."),this.g.te())}.bind(e)).catch(de.Bc),r=0;r<e.i.periods.length;++r)Eo(e,r).catch(de.Bc);e.g.gg&&(Y.K(n,"calling onStartupComplete()..."),e.g.gg())}}}(this,t,s),Y.K(a,"finished fetch and append"))}.bind(e)).catch(function(e){this.j||this.A||(t.Sa=!1,"text"==t.type&&this.l.ignoreTextStreamFailures?(1001==e.code?Y.v(a,"Text stream failed to download. Proceeding without it."):Y.v(a,"Text stream failed to parse. Proceeding without it."),this.h.delete("text")):7001==e.code?(t.Sa=!1,t.Pa=null,Lo(this,t,0)):3017==e.code?function(e,t,r){var n=Uo(t);if(Array.from(e.h.values()).some((function(e){return e!=t&&e.Ed})))Y.debug(n,"MediaSource threw QuotaExceededError:","waiting for another stream to recover...");else{var i=Math.round(100*e.u);if(20<i)e.u-=.2;else{if(!(4<i))return Y.error(n,"MediaSource threw QuotaExceededError too many times"),t.ac=!0,e.A=!0,void e.g.onError(r);e.u-=.04}Y.v(n,"MediaSource threw QuotaExceededError:","reducing buffering goals by "+(100-Math.round(100*e.u))+"%"),t.Ed=!0}Lo(e,t,4)}(this,t,e):(Y.error(a,"failed fetch and append: code="+e.code),t.ac=!0,e.severity=2,Bo(this,e)))}.bind(e))}(e,t,n,a,r),null)}(t,r);null!=i&&(Lo(t,r,i),r.ac=!1)}catch(e){return void Bo(t,e)}i=Array.from(t.h.values()),function(e,t){var r=Uo(t),n=Ro(e,t.stream);if(t.oa!=n){var i=t.oa,a=Array.from(e.h.values());a.every((function(e){return e.oa==i||$o(e)}))?a.every(Po)?(Y.debug(r,"all need Period "+i),Eo(e,i).then(function(){if(!this.j)if(a.every(function(e){var t=Po(e),r=Ro(this,e.stream);return!!$o(e)||t&&e.oa==i&&r!=i}.bind(this))){var e=this.i.periods[i];Y.K(r,"calling onChooseStreams()...");var t=this.g.ue(e),n=new Map;t.variant&&t.variant.video&&n.set("video",t.variant.video),t.variant&&t.variant.audio&&n.set("audio",t.variant.audio),t.text&&n.set("text",t.text);for(var o=(t=f(this.h.keys())).next();!o.done;o=t.next())if(o=o.value,!n.has(o)&&"text"!=o)return Y.error(r,"invalid Streams chosen: missing "+o+" Stream"),void this.g.onError(new z(2,5,5005));for(o=(t=f(Array.from(n.keys()))).next();!o.done;o=t.next())if(o=o.value,!this.h.has(o)){if("text"!=o)return Y.error(r,"invalid Streams chosen: unusable "+o+" Stream"),void this.g.onError(new z(2,5,5005));bo(this,null,null,n.get("text"),e.startTime),n.delete(o)}for(o=(t=f(Array.from(this.h.keys()))).next();!o.done;o=t.next()){o=o.value;var s=this.h.get(o),u=n.get(o);if(u){var c=$o(s);c&&(s.oa=i,s.Hd=e.startTime),vo(this,u,!1,0,!1),c&&$o(s)||Lo(this,this.h.get(o),0)}else this.h.delete(o)}Y.K(r,"calling onCanSwitch()..."),this.g.te()}else Y.debug(r,"ignoring transition to Period",i,"since another is happening")}.bind(e)).catch(de.Bc)):Y.debug(r,"all MediaStates need Period "+i+", but not all MediaStates are idle"):Y.debug(r,"not all MediaStates need Period "+i)}}(t,r),t.C&&i.every((function(e){return e.endOfStream}))&&(Y.K(n,"calling endOfStream()..."),t.g.T.endOfStream().then(function(){if(!this.j){var e=this.g.T.ha();0!=e&&e<this.i.presentationTimeline.ha()&&this.i.presentationTimeline.Fa(e)}}.bind(t)))}}}function wo(e,t,r){return t.Hb&&t.La?(r=Ro(e,t.Hb),e.i.periods[r].startTime+t.La.endTime):Math.max(r,t.Hd)}function Co(e,t,r,n,i){var a=Uo(t);return t.La&&t.stream==t.Hb?(n=t.La.position+1,Y.O(a,"next position known:","position="+n),Io(e,t,i,n)):(t.La?(Y.K(a,"next position unknown: another Stream buffered"),a=Ro(e,t.Hb),a=ko(e,t,e.i.periods[a].startTime+t.La.endTime,i)):(Y.K(a,"next position unknown: nothing buffered"),a=ko(e,t,n||r,i)),null==a?null:(r=null,null==n&&(r=Io(e,t,i,Math.max(0,a-1))),r||Io(e,t,i,a)))}function ko(e,t,r,n){var i=Uo(t);return e=e.i.periods[n],Y.debug(i,"looking up segment:","presentationTime="+r,"currentPeriod.startTime="+e.startTime),r=Math.max(0,r-e.startTime),null==(t=t.stream.findSegmentPosition(r))&&Y.v(i,"cannot find segment:","currentPeriod.startTime="+e.startTime,"lookupTime="+r),t}function Io(e,t,r,n){var i=Uo(t);return r=e.i.periods[r],(t=t.stream.getSegmentReference(n))?(e=(n=e.i.presentationTimeline).$b(),n=n.Db(),r.startTime+t.endTime<e||r.startTime+t.startTime>n?(Y.O(i,"segment is not available:","currentPeriod.startTime="+r.startTime,"reference.startTime="+t.startTime,"reference.endTime="+t.endTime,"availabilityStart="+e,"availabilityEnd="+n),null):t):(Y.K(i,"segment does not exist:","currentPeriod.startTime="+r.startTime,"position="+n),null)}function $o(e){return e&&"text"==e.type&&"application/cea-608"==e.stream.mimeType}function Po(e){return!e.Sa&&null==e.Pa&&!e.Wa&&!e.ab}function xo(e,t){var r=Va(e.i.periods,t+ge);return r?e.i.periods.indexOf(r):0}function Ro(e,t){for(var r=e.i.periods,n=0;n<r.length;n++){for(var i=r[n],a=new Set,o=f(i.variants),s=o.next();!s.done;s=o.next())(s=s.value).audio&&a.add(s.audio),s.video&&a.add(s.video),s.video&&s.video.trickModeVideo&&a.add(s.video.trickModeVideo);for(o=(i=f(i.textStreams)).next();!o.done;o=i.next())a.add(o.value);if(a.has(t))return n}return-1}function Oo(e,t,r){var n=Ti(r.i(),r.h,r.g,e.l.retryParameters);return Y.O("fetching: reference=",r),e=e.g.Ib.request(1,n),t.lb=e,e.promise.then((function(e){return t.lb=null,e.data}))}function Do(e,t,r,n){return g((function i(){var a,o,s,u;return N(i,(function(i){switch(i.s){case 1:return a=Uo(t),t.Wa=!1,t.Qc=!1,t.oc=0,t.ab=!0,t.Hb=null,t.La=null,Y.debug(a,"clearing buffer"),n?(s=e.g.eb(),u=e.g.T.ha(),o=e.g.T.remove(t.type,s+n,u)):o=Pr(e.g.T,t.type).then(function(){if(!this.j&&r)return this.g.T.flush(t.type)}.bind(e)),w(i,o,2);case 2:if(e.j)return i.return();Y.debug(a,"cleared buffer"),t.ab=!1,t.endOfStream=!1,Lo(e,t,0),C(i)}}))}))}function Lo(e,t,r){var n=Uo(t),i=t.type;"text"!=i||e.h.has(i)?(Y.O(n,"updating in "+r+" seconds"),t.Pa=new Ie((function(){return g((function r(){var n;return N(r,(function(r){switch(r.s){case 1:return k(r,2),w(r,To(e,t),4);case 4:$(r,0);break;case 2:n=P(r),e.g&&e.g.onError(n),C(r)}}))}))})).V(r)):Y.K(n,"Text stream is unloaded. No update is needed.")}function Mo(e){null!=e.Pa&&(e.Pa.stop(),e.Pa=null)}function No(e){return g((function t(){return N(t,(function(t){if(1===t.s){if(e.lb)return w(t,e.lb.abort(),0);t.I(0)}}))}))}function Bo(e,t){xe(e.M).then(function(){this.j||(this.g.onError(t),t.handled||this.l.failureCallback(t))}.bind(e))}function Uo(e){return"("+e.type+":"+e.stream.id+")"}function Go(e,t,r,n,i,a){if(200<=r&&299>=r&&202!=r)return{uri:i||n,Bd:n,data:t,headers:e,fromCache:!!e["x-shaka-from-cache"]};i=null;try{i=_e(t)}catch(o){}throw Y.debug("HTTP error text:",i),new z(401==r||403==r?2:1,1,1001,n,r,i,e,a)}function Vo(e,t,r,n){var i=new Vo.h;ut(t.headers).forEach((function(e,t){i.append(t,e)}));var a=new Vo.g,o={Zd:!1,Oe:!1};if(e=new Re(e=Vo.u(e,r,{body:t.body||void 0,headers:i,method:t.method,signal:a.signal,credentials:t.allowCrossSiteCredentials?"include":void 0},o,n),(function(){return o.Zd=!0,a.abort(),Promise.resolve()})),t=t.retryParameters.timeout){var s=new $e((function(){o.Oe=!0,a.abort()}));s.V(t/1e3),e.finally((function(){s.stop()}))}return e}function Fo(e,t,r,n){var i=new Fo.j,a=Date.now(),o=0;return new Re(new Promise((function(s,u){for(var c in i.open(t.method,e,!0),i.responseType="arraybuffer",i.timeout=t.retryParameters.timeout,i.withCredentials=t.allowCrossSiteCredentials,i.onabort=function(){u(new z(1,1,7001,e,r))},i.onload=function(t){for(var n=(t=t.target).getAllResponseHeaders().trim().split("\r\n"),i={},a=(n=f(n)).next();!a.done;a=n.next())i[(a=a.value.split(": "))[0].toLowerCase()]=a.slice(1).join(": ");try{var o=Go(i,t.response,t.status,e,t.responseURL,r);s(o)}catch(c){u(c)}},i.onerror=function(t){u(new z(1,1,1002,e,t,r))},i.ontimeout=function(){u(new z(1,1,1003,e,r))},i.onprogress=function(e){var t=Date.now();(100<t-a||e.lengthComputable&&e.loaded==e.total)&&(n(t-a,e.loaded-o,e.total-e.loaded),o=e.loaded,a=t)},t.headers)i.setRequestHeader(c.toLowerCase(),t.headers[c]);i.send(t.body)})),(function(){return i.abort(),Promise.resolve()}))}function jo(){this.g=this.j=this.h=0,this.i=new Map,this.l=0}function Ho(e,t,r){this.m=e,this.h=new Map,this.i=!1,this.l=t,this.j=r,this.g=new jo}function Zo(e,t,r,n,i,a){var o=function(e,t){e.h+=t;var r=e.l;return e.l++,e.i.set(r,t),r}(e.g,n);n=e.h.get(t)||Promise.resolve(),e.h.set(t,n.then((function(){return g((function t(){var n,s,u,c,l,d;return N(t,(function(t){switch(t.s){case 1:return w(t,function(e,t){return g((function r(){var n;return N(r,(function(r){switch(r.s){case 1:return w(r,e.m.request(1,t).promise,2);case 2:return n=r.B,r.return(n.data)}}))}))}(e,r),2);case 2:if(n=t.B,e.i)throw new z(2,9,7001);if(i)for(var h in s=new Uint8Array(n),(u=new Zn(s)).data)c=Number(h),l=u.data[c],d=u.g[c],e.j(l,d);return e.g.close(o,n.byteLength),h=e.g,e.l(0==h.h?0:h.j/h.h,e.g.g),t.return(a(n))}}))}))})))}function Wo(e,t){var r=this;this.i=e,this.h=e.objectStore(t),this.g=new ye,e.onabort=function(e){e.preventDefault(),r.g.reject()},e.onerror=function(e){e.preventDefault(),r.g.reject()},e.oncomplete=function(){r.g.resolve()}}function Ko(e,t){return new Promise((function(r,n){var i=e.h.openCursor();i.onerror=n,i.onsuccess=function(e){if(!(e=e.target.result))return r();t(e.key,e.value,e),e.continue()}}))}function Xo(e){this.h=e,this.g=[]}function Yo(e,t){return zo(e,t,"readwrite")}function zo(e,t,r){var n=new Wo(r=e.h.transaction([t],r),t);return e.g.push(n),n.promise().then((function(){je(e.g,n)}),(function(){je(e.g,n)})),n}function Jo(e,t,r){this.h=new Xo(e),this.i=t,this.g=r}function Qo(e){return Promise.reject(new z(2,9,9011,"Cannot add new value to "+e))}function qo(e,t,r,n){t=(e=Yo(e.h,t)).store();for(var i={},a=(r=f(r)).next();!a.done;i={key:i.key},a=r.next())i.key=a.value,t.delete(i.key).onsuccess=function(e){return function(){return n(e.key)}}(i);return e.promise()}function es(e,t,r){return g((function n(){var i,a,o,s,u,c,l;return N(n,(function(n){switch(n.s){case 1:for(i=zo(e.h,t,"readonly"),a=i.store(),o={},s=[],u={},c=f(r),l=c.next();!l.done;u={request:u.request,key:u.key},l=c.next())u.key=l.value,u.request=a.get(u.key),u.request.onsuccess=function(e){return function(){null==e.request.result&&s.push(e.key),o[e.key]=e.request.result}}(u);return w(n,i.promise(),2);case 2:if(s.length)throw new z(2,9,9012,"Could not find values for "+s);return n.return(r.map((function(e){return o[e]})))}}))}))}function ts(e){this.g=new Xo(e)}function rs(){this.g=new Map}function ns(e,t,r){if(!(e=e.g.get(t)))throw new z(2,9,9013,"Could not find mechanism with name "+t);if(!(t=e.getCells().get(r)))throw new z(2,9,9013,"Could not find cell with name "+r);return t}function is(e,t){as.set(e,t)}lo.prototype.destroy=function(){var e=this;return g((function t(){var r,n;return N(t,(function(t){switch(t.s){case 1:r=[];for(var i=f(e.h.values()),a=i.next();!a.done;a=i.next())Mo(n=a.value),r.push(No(n));return w(t,Promise.all(r),2);case 2:e.h.clear(),e.o.clear(),e.g=null,e.i=null,e.F=null,e.m=null,e.l=null,e.j=!0,C(t)}}))}))},lo.prototype.configure=function(e){this.l=e,this.M=new Pe({maxAttempts:Math.max(e.retryParameters.maxAttempts,2),baseDelay:e.retryParameters.baseDelay,backoffFactor:e.retryParameters.backoffFactor,fuzzFactor:e.retryParameters.fuzzFactor,timeout:0},!0)},lo.prototype.start=function(){var e=this;return g((function t(){var r,n,i;return N(t,(function(t){switch(t.s){case 1:return r=e.g.eb(),n=xo(e,r),(i=e.g.ue(e.i.periods[n])).variant||i.text?w(t,bo(e,i.variant?i.variant.audio:null,i.variant?i.variant.video:null,i.text,r),2):(Y.error("init: no Streams chosen"),t.return(new z(2,5,5005)));case 2:if(e.j)return t.return();Y.debug("init: completed initial Stream setup"),e.g&&e.g.Yf&&(Y.K("init: calling onInitialStreamsSetup()..."),e.g.Yf()),C(t)}}))}))},lo.prototype.P=function(e,t,r,n){var i=n.reader.Cd(),a=n.reader.Cd(),o=n.reader.N(),s=n.reader.N(),u=n.reader.N(),c=n.reader.N();n=n.reader.mb(n.reader.S.byteLength-n.reader.ka()),e=e.startTime+t.startTime+s/o,r.includes(i)&&("urn:mpeg:dash:event:2012"==i?this.g.Zf():this.g.onEvent(new Be("emsg",{detail:{startTime:e,endTime:e+u/o,schemeIdUri:i,value:a,timescale:o,presentationTimeDelta:s,eventDuration:u,id:c,messageData:n}})))},j("shaka.net.HttpFetchPlugin",Vo),Vo.u=function(e,t,r,n,i){return g((function a(){var o,s,u,c,l,d,h,f,p,y,m,v;return N(a,(function(a){switch(a.s){case 1:return o=Vo.l,s=Vo.i,d=l=0,h=Date.now(),k(a,2),w(a,o(e,r),4);case 4:return u=a.B,f=u.clone().body.getReader(),y=(p=u.headers.get("Content-Length"))?parseInt(p,10):0,new s({start:function(e){!function t(){return g((function r(){var n,a,o;return N(r,(function(r){switch(r.s){case 1:return k(r,2),w(r,f.read(),4);case 4:n=r.B,$(r,3);break;case 2:return a=P(r),Y.K("error reading from stream",a.message),r.return();case 3:n.done||(l+=n.value.byteLength),(100<(o=Date.now())-h||n.done)&&(i(o-h,l-d,y-l),d=l,h=o),n.done?e.close():(e.enqueue(n.value),t()),C(r)}}))}))}()}}),w(a,u.arrayBuffer(),5);case 5:c=a.B,$(a,3);break;case 2:if(m=P(a),n.Zd)throw new z(1,1,7001,e,t);if(n.Oe)throw new z(1,1,1003,e,t);throw new z(1,1,1002,e,m,t);case 3:return v={},u.headers.forEach((function(e,t){v[t.trim()]=e})),a.return(Go(v,c,u.status,e,u.url,t))}}))}))},Vo.isSupported=function(){if(!t.ReadableStream)return!1;try{new ReadableStream({})}catch(u){return!1}return!(!t.fetch||!t.AbortController)},Vo.isSupported=Vo.isSupported,Vo.l=t.fetch,Vo.g=t.AbortController,Vo.i=t.ReadableStream,Vo.h=t.Headers,Vo.isSupported()&&(Ye("http",Vo,2),Ye("https",Vo,2)),j("shaka.net.HttpXHRPlugin",Fo),Fo.j=t.XMLHttpRequest,Ye("http",Fo,1),Ye("https",Fo,1),jo.prototype.close=function(e,t){if(this.i.has(e)){var r=this.i.get(e);this.i.delete(e),this.j+=r,this.g+=t}},Ho.prototype.destroy=function(){return this.i=!0,Promise.all(this.h.values()).then((function(){}),(function(){}))},Wo.prototype.abort=function(){try{this.i.abort()}catch(u){}return this.g.catch((function(){}))},Wo.prototype.store=function(){return this.h},Wo.prototype.promise=function(){return this.g},Xo.prototype.destroy=function(){return Promise.all(this.g.map((function(e){return e.abort()})))},(i=Jo.prototype).destroy=function(){return this.h.destroy()},i.hasFixedKeySpace=function(){return!0},i.addSegments=function(){return Qo(this.i)},i.removeSegments=function(e,t){return qo(this,this.i,e,t)},i.getSegments=function(e){var t=this;return g((function r(){var n;return N(r,(function(r){switch(r.s){case 1:return w(r,es(t,t.i,e),2);case 2:return n=r.B,r.return(n.map((function(e){return t.ae(e)})))}}))}))},i.addManifests=function(){return Qo(this.g)},i.updateManifestExpiration=function(e,t){var r=Yo(this.h,this.g),n=r.store();return n.get(e).onsuccess=function(r){(r=r.target.result)&&(r.expiration=t,n.put(r,e))},r.promise()},i.removeManifests=function(e,t){return qo(this,this.g,e,t)},i.getManifests=function(e){var t=this;return g((function r(){var n;return N(r,(function(r){switch(r.s){case 1:return w(r,es(t,t.g,e),2);case 2:return n=r.B,r.return(n.map((function(e){return t.pc(e)})))}}))}))},i.getAllManifests=function(){var e=this;return g((function t(){var r,n;return N(t,(function(t){switch(t.s){case 1:return r=zo(e.h,e.g,"readonly"),n=new Map,w(t,Ko(r,(function(t,r){n.set(t,e.pc(r))})),2);case 2:return w(t,r.promise(),3);case 3:return t.return(n)}}))}))},i.ae=function(e){return e},i.pc=function(e){return e},i.add=function(e,t){var r=this;return g((function n(){var i,a,o,s;return N(n,(function(n){switch(n.s){case 1:i=Yo(r.h,e),a=i.store(),o=[];for(var u=f(t),c=u.next();!c.done;c=u.next())s=c.value,a.add(s).onsuccess=function(e){o.push(e.target.result)};return w(n,i.promise(),2);case 2:return n.return(o)}}))}))},ts.prototype.destroy=function(){return this.g.destroy()},ts.prototype.getAll=function(){var e=this;return g((function t(){var r,n;return N(t,(function(t){switch(t.s){case 1:return r=zo(e.g,"session-ids","readonly"),n=[],w(t,Ko(r,(function(e,t){n.push(t)})),2);case 2:return w(t,r.promise(),3);case 3:return t.return(n)}}))}))},ts.prototype.add=function(e){for(var t=Yo(this.g,"session-ids"),r=t.store(),n=(e=f(e)).next();!n.done;n=e.next())r.add(n.value);return t.promise()},ts.prototype.remove=function(e){var t=this;return g((function r(){var n;return N(r,(function(r){switch(r.s){case 1:return w(r,Ko(n=Yo(t.g,"session-ids"),(function(t,r,n){0<=e.indexOf(r.sessionId)&&n.delete()})),2);case 2:return w(r,n.promise(),0)}}))}))},rs.prototype.destroy=function(){for(var e=[],t=f(this.g.values()),r=t.next();!r.done;r=t.next())e.push(r.value.destroy());return this.g.clear(),Promise.all(e)},rs.prototype.init=function(){var e=this;as.forEach((function(t,r){var n=t();n?e.g.set(r,n):Y.info("Skipping "+r+" as it is not supported on this platform")}));for(var t=[],r=f(this.g.values()),n=r.next();!n.done;n=r.next())t.push(n.value.init());return Promise.all(t)},rs.prototype.erase=function(){var e=this;return g((function t(){var r,n;return N(t,(function(t){switch(t.s){case 1:return r=Array.from(e.g.values()),(n=0<r.length)||as.forEach((function(e){(e=e())&&r.push(e)})),w(t,Promise.all(r.map((function(e){return e.erase()}))),2);case 2:if(!n)return w(t,Promise.all(r.map((function(e){return e.destroy()}))),0);t.I(0)}}))}))},j("shaka.offline.StorageMuxer.register",is),j("shaka.offline.StorageMuxer.unregister",(function(e){as.delete(e)}));var as=new Map;function os(e){Jo.apply(this,arguments)}function ss(e){return function(e){var t=e.streams.filter((function(e){return"audio"==e.contentType})),r=e.streams.filter((function(e){return"video"==e.contentType}));if(!t.every((function(e){return e.variantIds}))||!r.every((function(e){return e.variantIds}))){t.forEach((function(e){e.variantIds=[]})),r.forEach((function(e){e.variantIds=[]}));var n=0;if(r.length&&!t.length){Y.debug("Found video-only content. Creating variants for video.");var i=n++;r.forEach((function(e){e.variantIds.push(i)}))}if(!r.length&&t.length){Y.debug("Found audio-only content. Creating variants for audio.");var a=n++;t.forEach((function(e){e.variantIds.push(a)}))}r.length&&t.length&&(Y.debug("Found audio-video content. Creating variants."),t.forEach((function(e){r.forEach((function(t){var r=n++;e.variantIds.push(r),t.variantIds.push(r)}))})))}}(e),e.streams.forEach((function(){})),{startTime:e.startTime,streams:e.streams.map(us)}}function us(e){var t=e.initSegmentUri?ls(e.initSegmentUri):null;return{id:e.id,originalId:null,primary:e.primary,presentationTimeOffset:e.presentationTimeOffset,contentType:e.contentType,mimeType:e.mimeType,codecs:e.codecs,frameRate:e.frameRate,pixelAspectRatio:void 0,kind:e.kind,language:e.language,label:e.label,width:e.width,height:e.height,initSegmentKey:t,encrypted:e.encrypted,keyId:e.keyId,segments:e.segments.map(cs),variantIds:e.variantIds}}function cs(e){var t=ls(e.uri);return{startTime:e.startTime,endTime:e.endTime,dataKey:t}}function ls(e){var t;if((t=/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(e))||(t=/^offline:segment\/([0-9]+)$/.exec(e)))return Number(t[1]);throw new z(2,9,9004,"Could not parse uri "+e)}function ds(e,t,r,n){Jo.call(this,e,t,r),this.j=n}function hs(){this.l=this.i=this.h=this.g=this.j=null}function fs(e,t,r,n){this.g=e,this.l=t,this.j=r,this.i=n,this.h=["offline:",e,"/",t,"/",r,"/",n].join("")}function ps(e){if(null==(e=/^offline:([a-z]+)\/([^/]+)\/([^/]+)\/([0-9]+)$/.exec(e)))return null;var t=e[1];if("manifest"!=t&&"segment"!=t)return null;var r=e[2];if(!r)return null;var n=e[3];return n&&null!=t?new fs(t,r,n,Number(e[4])):null}function gs(e,t){this.h=e,this.g=t}function ys(e,t,r){var n=t.streams.filter((function(e){return"audio"==e.contentType})),i=t.streams.filter((function(e){return"video"==e.contentType}));return n=function(e,t,r){for(var n=new Set,i=f(t),a=i.next();!a.done;a=i.next()){var o=f(a.value.variantIds);for(a=o.next();!a.done;a=o.next())n.add(a.value)}for(i=f(r),a=i.next();!a.done;a=i.next())for(a=(o=f(a.value.variantIds)).next();!a.done;a=o.next())n.add(a.value);for(i=new Map,n=f(n),a=n.next();!a.done;a=n.next())a=a.value,i.set(a,{id:a,language:"",primary:!1,audio:null,video:null,bandwidth:0,drmInfos:[],allowedByApplication:!0,allowedByKeySystem:!0});for(t=f(t),n=t.next();!n.done;n=t.next())for(a=ms(e,n=n.value),n=(o=f(n.variantIds)).next();!n.done;n=o.next())(n=i.get(n.value)).language=a.language,n.primary=n.primary||a.primary,n.audio=a;for(r=f(r),t=r.next();!t.done;t=r.next())for(t=ms(e,n=t.value),n=(a=f(n.variantIds)).next();!n.done;n=a.next())(n=i.get(n.value)).primary=n.primary||t.primary,n.video=t;return i}(e,n,i),i=t.streams.filter((function(e){return"text"==e.contentType})).map((function(t){return ms(e,t)})),t.streams.forEach((function(n){n=n.segments.map((function(t,r){return vs(e,r,t)})),r.Jb(n,t.startTime)})),{startTime:t.startTime,variants:Array.from(n.values()),textStreams:i}}function ms(e,t){var r=t.segments.map((function(t,r){return vs(e,r,t)})),n=new oi(r);return r={id:t.id,originalId:t.originalId,createSegmentIndex:function(){return Promise.resolve()},findSegmentPosition:function(e){return n.find(e)},getSegmentReference:function(e){return n.get(e)},initSegmentReference:null,presentationTimeOffset:t.presentationTimeOffset,mimeType:t.mimeType,codecs:t.codecs,width:t.width||void 0,height:t.height||void 0,frameRate:t.frameRate||void 0,pixelAspectRatio:t.pixelAspectRatio||void 0,kind:t.kind,encrypted:t.encrypted,keyId:t.keyId,language:t.language,label:t.label||null,type:t.contentType,primary:t.primary,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null},null!=t.initSegmentKey&&(r.initSegmentReference=function(e,t){var r=new fs("segment",e.h,e.g,t);return new ni((function(){return[r.toString()]}),0,null)}(e,t.initSegmentKey)),r}function vs(e,t,r){var n=new fs("segment",e.h,e.g,r.dataKey);return new ii(t,r.startTime,r.endTime,(function(){return[n.toString()]}),0,null)}function _s(){this.g=null}function bs(e){var t=ps(e);return t&&"manifest"==t.g?bs.m(e):t&&"segment"==t.g?bs.o(t.key(),t):Oe(new z(2,1,9004,e))}function As(e,t,r){return g((function n(){var i,a,o,s,u,c;return N(n,(function(n){switch(n.s){case 1:i=[];for(var l=[],d=f(r),h=d.next();!h.done;h=d.next()){h=h.value;for(var p=!1,y=f(l),m=y.next();!m.done;m=y.next())if(Es((m=m.value).info,h)){m.sessionIds.push(h.sessionId),p=!0;break}p||l.push({info:h,sessionIds:[h.sessionId]})}a=f(l),o=a.next();case 2:if(o.done){n.I(4);break}return s=o.value,u=function(e,t,r){return g((function n(){var i,a,o,s;return N(n,(function(n){switch(n.s){case 1:return i=new St({Ib:t,onError:function(){},Dc:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),k(n,2),i.configure(e),w(n,function(e,t,r,n,i,a){var o=new Map;return o.set(t,{audioCapabilities:i,videoCapabilities:a,distinctiveIdentifier:"optional",persistentState:"required",sessionTypes:["persistent-license"],label:t,drmInfos:[{keySystem:t,licenseServerUri:r,distinctiveIdentifierRequired:!1,persistentStateRequired:!0,audioRobustness:"",videoRobustness:"",serverCertificate:n,initData:null,keyIds:null}]}),Ot(e,o)}(i,r.info.keySystem,r.info.licenseUri,r.info.serverCertificate,r.info.audioCapabilities,r.info.videoCapabilities),4);case 4:$(n,3);break;case 2:return a=P(n),Y.v("Error initializing EME",a),w(n,i.destroy(),5);case 5:case 9:return n.return([]);case 3:return k(n,6),w(n,Ct(i),8);case 8:$(n,7);break;case 6:return o=P(n),Y.v("Error setting server certificate",o),w(n,i.destroy(),9);case 7:return s=[],w(n,Promise.all(r.sessionIds.map((function(e){return g((function t(){var r;return N(t,(function(t){switch(t.s){case 1:return k(t,2),w(t,function(e,t){return g((function r(){var n,i,a;return N(r,(function(r){switch(r.s){case 1:return w(r,Dt(e,t),2);case 2:return(n=r.B)?(i=[],(a=e.h.get(n))&&(a.Ga=new ye,i.push(a.Ga)),Y.O("Attempting to remove session",t),i.push(n.remove()),w(r,Promise.all(i),0)):(Y.O("Ignoring attempt to remove missing session",t),r.return())}}))}))}(i,e),4);case 4:s.push(e),$(t,0);break;case 2:r=P(t),Y.v("Error deleting offline session",r),C(t)}}))}))}))),10);case 10:return w(n,i.destroy(),11);case 11:return n.return(s)}}))}))}(e,t,s),w(n,u,5);case 5:c=n.B,i=i.concat(c),o=a.next(),n.I(2);break;case 4:return n.return(i)}}))}))}function Es(e,t){function r(e,t){return e.robustness==t.robustness&&e.contentType==t.contentType}return e.keySystem==t.keySystem&&e.licenseUri==t.licenseUri&&He(e.audioCapabilities,t.audioCapabilities,r)&&He(e.videoCapabilities,t.videoCapabilities,r)}function Ss(e,t){var r={Ia:null,D:null,mimeType:null,startTime:null,Rd:null,uri:null},n=this;this.m=t,this.i=e,this.j=r,this.o=null,this.l=[],this.h=this.g=null,this.u=!0,this.A=Promise.resolve().then((function(){return function(e){return g((function t(){return N(t,(function(t){if(1===t.s){if(e.u){if(0==e.l.length||e.g&&!e.g.gb)var r=!1;else{e.g&&(e.g.Da.kb(),e.g=null);var n=(r=e.l.shift()).create(e.j);n?(r.Da.Kb(),e.g={node:n.node,payload:n.payload,gb:n.gb,Da:r.Da}):r.Da.Ec(),r=!0}return r?r=Promise.resolve():e.g?r=function(e){return g((function t(){var r,n;return N(t,(function(t){switch(t.s){case 1:return e.i=e.m.Af(e.i,e.j,e.g.node,e.g.payload),k(t,2),e.h=e.m.ef(e.i,e.j,e.g.payload),w(t,e.h.promise,4);case 4:e.h=null,e.i==e.g.node&&(e.g.Da.Cc(),e.g=null),$(t,0);break;case 2:return 7001==(r=P(t)).code?e.g.Da.kb():e.g.Da.onError(r),e.g=null,e.h=null,n=e,w(t,e.m.handleError(e.j,r),5);case 5:n.i=t.B,C(t)}}))}))}(e):(e.m.Xf(e.i),e.o=new ye,r=e.o),w(t,r,1)}t.I(0)}}))}))}(n)}))}function Ts(e,t){var r={Kb:function(){},Cc:function(){},kb:function(){},onError:function(){},Ec:function(){},$g:function(){}};return e.l.push({create:t,Da:r}),e.h&&e.h.abort(),ws(e),r}function ws(e){e.o&&(e.o.resolve(),e.o=null)}function Cs(e){this.g=null;for(var t=0;t<e.textTracks.length;++t){var r=e.textTracks[t];r.mode="disabled","Shaka Player TextTrack"==r.label&&(this.g=r)}this.g||(this.g=e.addTextTrack("subtitles","Shaka Player TextTrack")),this.g.mode="hidden"}function ks(e){if(e.startTime>=e.endTime)return Y.v("Invalid cue times: "+e.startTime+" - "+e.endTime),null;var t=new VTTCue(e.startTime,e.endTime,e.payload);t.lineAlign=e.lineAlign,t.positionAlign=e.positionAlign,e.size&&(t.size=e.size);try{t.align=e.textAlign}catch(r){}return"center"==e.textAlign&&"center"!=t.align&&(t.align="middle"),"vertical-lr"==e.writingMode?t.vertical="lr":"vertical-rl"==e.writingMode&&(t.vertical="rl"),1==e.lineInterpretation&&(t.snapToLines=!1),null!=e.line&&(t.line=e.line),null!=e.position&&(t.position=e.position),t}function Is(e,t){var r=e.mode;e.mode="showing"==r?"showing":"hidden";for(var n=e.cues,i=n.length-1;0<=i;i--){var a=n[i];a&&t(a)&&e.removeCue(a)}e.mode=r}function $s(e,t,r,n,i){var a,o=i in n,s=!0;for(a in t){var u=i+"."+a,c=o?n[i]:r[a];o||a in r?void 0===t[a]?void 0===c||o?delete e[a]:e[a]=Ve(c):c.constructor==Object&&t[a]&&t[a].constructor==Object?(e[a]||(e[a]=Ve(c)),u=$s(e[a],t[a],c,n,u),s=s&&u):_typeof$7(t[a])!=_typeof$7(c)||null==t[a]||"function"!=typeof t[a]&&t[a].constructor!=c.constructor?(Y.kc("Invalid config, wrong type for "+u),s=!1):("function"==typeof r[a]&&r[a].length!=t[a].length&&Y.ba("Unexpected number of arguments for "+u),e[a]=t[a]):(Y.kc("Invalid config, unrecognized key "+u),s=!1)}return s}function Ps(e,t){for(var r={},n=r,i=0,a=0;!(0>(i=e.indexOf(".",i)));)0!=i&&"\\"==e[i-1]||(n[a=e.substring(a,i).replace(/\\\./g,".")]={},n=n[a],a=i+1),i+=1;return n[e.substring(a).replace(/\\\./g,".")]=t,r}function xs(){}function Rs(){var e=5e5,t=1/0;navigator.connection&&(navigator.connection.downlink&&(e=1e6*navigator.connection.downlink),navigator.connection.saveData&&(t=360));var r={retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0},servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1,initDataTransform:Lt,fairPlayTransform:!0,updateExpirationTime:1},n={retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0},availabilityWindowOverride:NaN,disableAudio:!1,disableVideo:!1,disableText:!1,dash:{customScheme:function(e){if(e)return null},clockSyncUri:"",ignoreDrmInfo:!1,xlinkFailGracefully:!1,defaultPresentationDelay:10,ignoreMinBufferTime:!1,autoCorrectDrift:!0,ignoreSuggestedPresentationDelay:!1,ignoreEmptyAdaptationSet:!1},hls:{ignoreTextStreamFailures:!1,useFullSegmentsForStartTime:!1}},i={retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0},failureCallback:function(e){return Y.error("Unhandled streaming error",e),[e]},rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,smallGapLimit:.5,jumpLargeGaps:!1,durationBackoff:1,forceTransmuxTS:!1,safeSeekOffset:5,stallEnabled:!0,stallThreshold:1,stallSkip:.1,useNativeHlsOnSafari:!0};(_t("Web0S")||yt()||_t("CrKey"))&&(i.stallSkip=0);var a={trackSelectionCallback:function(e){return g((function t(){return N(t,(function(t){if(1===t.s)return t.return(e)}))}))},progressCallback:function(e,t){return[e,t]},usePersistentLicense:!0},o={drm:r,manifest:n,streaming:i,offline:a,abrFactory:Vr,abr:{enabled:!0,defaultBandwidthEstimate:e,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:t,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0}},preferredAudioLanguage:"",preferredTextLanguage:"",preferredVariantRole:"",preferredTextRole:"",preferredAudioChannelCount:2,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0},playRangeStart:0,playRangeEnd:1/0,textDisplayFactory:function(){return null}};return a.trackSelectionCallback=function(e){return g((function t(){return N(t,(function(t){if(1===t.s)return t.return(function(e,t){var r=e.filter((function(e){return"variant"==e.type})),n=[],i=Br(t,r.map((function(e){return e.language})));i&&(n=r.filter((function(e){return Mr(e.language)==i}))),0==n.length&&(n=r.filter((function(e){return e.primary}))),0==n.length&&(1<new Set(r.map((function(e){return e.language}))).size&&Y.v("Could not choose a good audio track based on language preferences or primary tracks.  An arbitrary language will be stored!"),n=r);var a=n.filter((function(e){return e.height&&480>=e.height}));if(a.length&&(a.sort((function(e,t){return t.height-e.height})),n=a.filter((function(e){return e.height==a[0].height}))),r=[],n.length){var o=Math.floor(n.length/2);n.sort((function(e,t){return e.bandwidth-t.bandwidth})),r.push(n[o])}for(n=f(e),o=n.next();!o.done;o=n.next())"text"==(o=o.value).type&&r.push(o);return r}(e,o.preferredAudioLanguage))}))}))},o}function Os(e,t,r){var n={".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",serverCertificate:new Uint8Array(0),individualizationServer:""}};return $s(e,t,r||Rs(),n,"")}function Ds(){this.g=null,this.h=[]}function Ls(e,t){if(null==e.g)e.g={timestamp:Date.now()/1e3,state:t,duration:0};else{var r=Date.now()/1e3;e.g.duration=r-e.g.timestamp,e.g.state!=t&&(e.h.push(e.g),e.g={timestamp:r,state:t,duration:0})}}function Ms(e,t){var r=0;e.g&&e.g.state==t&&(r+=e.g.duration);for(var n=f(e.h),i=n.next();!i.done;i=n.next())r+=(i=i.value).state==t?i.duration:0;return r}function Ns(){this.h=this.i=null,this.g=[]}function Bs(){this.j=this.C=this.m=this.h=this.o=this.u=this.A=this.l=this.F=NaN,this.g=new Ds,this.i=new Ns}function Us(e,r){var n=this;Ge.call(this),this.o=Iu,this.g=null,this.ub=!1,this.l=new tt,this.Uc=this.u=this.Tb=this.i=this.C=this.j=this.rc=this.L=this.ic=this.J=this.wb=this.A=this.M=this.m=this.X=null,this.re=1e9,this.lc=new Set,this.yb=!0,this.wa=null,this.qe=!1,this.oe=0,this.va=null,this.Z=new _a,this.h=Js(this),this.mc={width:1/0,height:1/0},this.F=null,this.tb=new Ia(this.h.preferredAudioLanguage,this.h.preferredVariantRole,this.h.preferredAudioChannelCount),this.ua=this.h.preferredTextLanguage,this.Xa=this.h.preferredTextRole,this.Wc=[],r&&r(this),this.X=function(e){return new Ke((function(t,r){e.u&&e.u.segmentDownloaded(t,r)}))}(this),this.l.H(t,"online",(function(){n.Id()})),this.P={name:"detach"},this.da={name:"attach"},this.Qa={name:"unload"},this.nd={name:"manifest-parser"},this.md={name:"manifest"},this.vb={name:"media-source"},this.ad={name:"drm-engine"},this.ea={name:"load"},this.od={name:"src-equals-drm-engine"},this.xb={name:"src-equals"};var i=new Map;i.set(this.da,(function(e,t){return Me(function(e,t,r){return null==t.D&&(t.D=r.D,e.l.H(t.D,"error",(function(){var t=pu(e);t&&e.Va(t)}))),e.g=t.D,Promise.resolve()}(n,e,t))})),i.set(this.P,(function(e){return e.D&&(n.l.ta(e.D,"error"),e.D=null),n.g=null,Me(e=Promise.resolve())})),i.set(this.Qa,(function(e){return Me(js(n,e))})),i.set(this.vb,(function(e){return e=function(e,r){return g((function n(){var i,a,o,s;return N(n,(function(n){switch(n.s){case 1:return i=t.muxjs?new Wt:new Kt,a=e.h.textDisplayFactory,o=new a,e.fd=a,w(n,(s=new br(r.D,i,o)).C,2);case 2:e.M=s,C(n)}}))}))}(n,e),Me(e)})),i.set(this.nd,(function(e,t){var r=function(e,t,r){return g((function n(){var i,a,o,s;return N(n,(function(n){switch(n.s){case 1:if(t.Ia=r.Ia,t.mimeType=r.mimeType,t.uri=r.uri,i=t.uri,a=e.X,e.Tb=i,t.Ia){e.C=t.Ia(),n.I(2);break}return o=e,w(n,Ei.create(i,a,e.h.manifest.retryParameters,t.mimeType),3);case 3:o.C=n.B;case 2:s=Ve(e.h.manifest),r.D&&"AUDIO"===r.D.nodeName&&(s.disableVideo=!0),e.C.configure(s),C(n)}}))}))}(n,e,t);return Me(r)})),i.set(this.md,(function(e){return function(e,t){var r=t.uri,n=e.X;e.rc=new ao((function(){return e.He()})),function(e,t){e.h=t}(e.rc,(function(t){fu(e,"timelineregionadded",t)}));var i={networkingEngine:n,filterNewPeriod:function(t){return e.Xc(t)},filterAllPeriods:function(t){return Qs(e,t)},onTimelineRegionAdded:function(t){var r=e.rc;e:{for(var n=f(r.g),i=n.next();!i.done;i=n.next())if((i=i.value).schemeIdUri==t.schemeIdUri&&i.id==t.id&&i.startTime==t.startTime&&i.endTime==t.endTime){n=i;break e}n=null}null==n&&(r.g.add(t),r.h(t))},onEvent:function(t){return e.dispatchEvent(t)},onError:function(t){return e.Va(t)}};return new Re(Promise.resolve().then((function(){return g((function t(){var n;return N(t,(function(t){switch(t.s){case 1:return n=e,w(t,e.C.start(r,i),2);case 2:if(n.i=t.B,e.dispatchEvent(new Be("manifestparsed")),0==e.i.periods.length)throw new z(2,4,4014);!function(e){function t(e){return e.video&&e.audio||e.video&&e.video.codecs.includes(",")}e.some((function(e){return e.variants.some(t)}))&&(Y.debug("Found variant with audio and video content, so filtering out audio-only content in all periods."),e.forEach((function(e){e.variants=e.variants.filter(t)})))}(e.i.periods),C(t)}}))}))})),(function(){return Y.info("Aborting parser step..."),e.C.stop()}))}(n,e)})),i.set(this.ad,(function(e){return e=function(e,t){return g((function r(){return N(r,(function(r){switch(r.s){case 1:return e.m=Hs(e,{Ib:e.X,onError:function(t){e.Va(t)},Dc:function(t){gu(e,t)},onExpirationUpdated:function(t,r){yu(e,t,r)},onEvent:function(t){e.dispatchEvent(t)}}),e.m.configure(e.h.drm),w(r,Tt(e.m,Ga(e.i.periods),e.i.offlineSessionIds),2);case 2:return w(r,e.m.Ub(t.D),3);case 3:Qs(e,e.i.periods),C(r)}}))}))}(n,e),Me(e)})),i.set(this.ea,(function(e,t){return Me(function(e,t,r){return g((function n(){var i,a,o,s,u,c,l,d,h,p;return N(n,(function(n){switch(n.s){case 1:return t.startTime=r.startTime,i=t.D,a=t.uri,e.Tb=a,e.J=new ja({wc:function(){return t.D.playbackRate},vc:function(){return t.D.defaultPlaybackRate},Od:function(e){t.D.playbackRate=e},pe:function(e){t.D.currentTime+=e}}),e.F=new Bs,o=function(){return nu(e)},s=function(){return ru(e)},e.l.H(i,"playing",o),e.l.H(i,"pause",o),e.l.H(i,"ended",o),e.l.H(i,"ratechange",s),u=e.h.abrFactory,e.u&&e.Uc==u||(e.Uc=u,e.u=new u,e.u.configure(e.h.abr)),function(e,t){for(var r=0;r<t.length;r++){for(var n=t[r],i=new Map,a=f(n.variants),o=a.next();!o.done;o=a.next())if((o=o.value).video&&o.video.closedCaptions)for(var s=f((o=o.video).closedCaptions.keys()),u=s.next();!u.done;u=s.next())if(u=u.value,!i.has(u)){var c={id:e.re++,originalId:u,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return null},getSegmentReference:function(){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:"application/cea-608",codecs:"",kind:"caption",encrypted:!1,keyId:null,language:o.closedCaptions.get(u),label:null,type:"text",primary:!1,frameRate:void 0,pixelAspectRatio:void 0,trickModeVideo:null,emsgSchemeIdUris:null,roles:o.roles,channelsCount:null,audioSamplingRate:null,closedCaptions:null};i.set(u,c)}for(a=(i=f(i.values())).next();!a.done;a=i.next())n.textStreams.push(a.value)}}(e,e.i.periods),e.tb=new Ia(e.h.preferredAudioLanguage,e.h.preferredVariantRole,e.h.preferredAudioChannelCount),e.ua=e.h.preferredTextLanguage,e.Xa=e.h.preferredTextRole,function(e,t,r){0<t&&(e.aa()?Y.v("|playRangeStart| has been configured for live content. Ignoring the setting."):e.Le(t)),r<e.ha()&&(e.aa()?Y.v("|playRangeEnd| has been configured for live content. Ignoring the setting."):e.Fa(r))}(e.i.presentationTimeline,e.h.playRangeStart,e.h.playRangeEnd),e.u.init((function(t,r,n){r=void 0!==r&&r,n=void 0===n?0:n,Y.debug("switch_");e:{for(var i=f(e.i.periods),a=i.next();!a.done;a=i.next())if((a=a.value).variants.includes(t)){i=a;break e}i=null}Ys(e,i,t,!0),e.j&&mo(e.j,t,r,n)&&su(e)})),e.A=function(e,t){return new to(e.g,e.i,e.h.streaming,t,(function(){e.wb&&Ua(e.wb,!0),e.j&&function(e){function t(t){var i=e.g.T;return t="text"==t?null!=(t=i.g).g&&null!=t.h&&r>=t.g&&r<t.h:Yt(t=kr(i,t),r,n)}var r=e.g.eb(),n=e.l.smallGapLimit,i=!1,a=xo(e,r);if(st(e.h.values(),(function(e){return e.oa==a})))for(var o=f(e.h.keys()),s=o.next();!s.done;s=o.next())t(s=s.value)||(_o(e,e.h.get(s)),i=!0);else st(e.h.keys(),t)||(Y.debug("(all): seeked: unbuffered seek: clearing all buffers"),e.h.forEach((function(t){_o(e,t)})),i=!0);i||Y.debug("(all): seeked: buffered seek: presentationTime="+r)}(e.j),e.L&&Ws(e)}),(function(t){return e.dispatchEvent(t)}))}(e,t.startTime),e.wb=function(e){var t=new Fa(e.i);!function(e,t){e.h=t}(t,(function(){uu(e)}));var r=new oo(e.rc);!function(e,t,r,n){e.g=t,e.h=r,e.i=n}(r,(function(t){fu(e,"timelineregionenter",t)}),(function(t){fu(e,"timelineregionexit",t)}),(function(t,r){r||(fu(e,"timelineregionenter",t),fu(e,"timelineregionexit",t))}));var n=new Ba(e.g);return n.g.add(t),n.g.add(r),n}(e),c=Math.max(e.i.minBufferTime,e.h.streaming.rebufferingGoal),Zs(e,c),e.j=function(e){return new lo(e.i,{eb:function(){return e.A.l()},getBandwidthEstimate:function(){return e.u.getBandwidthEstimate()},T:e.M,Ib:e.X,ue:e.Vf.bind(e),te:e.Ze.bind(e),onError:e.Va.bind(e),onEvent:function(t){return e.dispatchEvent(t)},Zf:e.$f.bind(e),zd:e.eg.bind(e)})}(e),e.j.configure(e.h.streaming),Gr.$d(e.i,e.h.preferredAudioChannelCount),e.o=$u,e.dispatchEvent(new Be("streaming")),w(n,e.j.start(),2);case 2:e.h.streaming.startAtSegmentBoundary&&(l=e.A.l(),d=function(e,t){function r(e,t){if(!e)return null;var r=e.findSegmentPosition(t-a.startTime);return null==r?null:(r=e.getSegmentReference(r))?r.startTime+a.startTime:null}var n=ho(e.j),i=fo(e.j),a=Eu(e);return n=r(n,t),null!=(i=r(i,t))&&null!=n?Math.max(i,n):null!=i?i:null!=n?n:t}(e,l),e.A.A(d)),e.i.periods.forEach(e.Xc.bind(e)),uu(e),su(e),h=Eu(e)||e.i.periods[0],p=h.variants.some((function(e){return e.primary})),e.h.preferredAudioLanguage||p||Y.v("No preferred audio language set.  We will choose an arbitrary language initially"),iu(e,h.variants),e.l.ya(i,"loadedmetadata",(function(){e.F.h=Date.now()/1e3-r.Rd})),C(n)}}))}))}(n,e,t))})),i.set(this.od,(function(e,t){var r=function(e,t,r){return g((function n(){var i,a;return N(n,(function(n){switch(n.s){case 1:return i=pe,e.m=Hs(e,{Ib:e.X,onError:function(t){e.Va(t)},Dc:function(t){gu(e,t)},onExpirationUpdated:function(t,r){yu(e,t,r)},onEvent:function(t){e.dispatchEvent(t)}}),e.m.configure(e.h.drm),a={id:0,language:"und",primary:!1,audio:null,video:{id:0,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return null},getSegmentReference:function(){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:r.mimeType?r.mimeType.split(";")[0]:"video/mp4",codecs:r.mimeType?dt(r.mimeType):"",encrypted:!0,keyId:null,language:"und",label:null,type:i.Za,primary:!1,frameRate:void 0,pixelAspectRatio:void 0,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null},bandwidth:100,drmInfos:[],allowedByApplication:!0,allowedByKeySystem:!0},w(n,Tt(e.m,[a],[]),2);case 2:return w(n,e.m.Ub(t.D),0)}}))}))}(n,e,t);return Me(r)})),i.set(this.xb,(function(e,t){return function(e,t,r){function n(){return nu(e)}if(t.uri=r.uri,t.startTime=r.startTime,e.Tb=t.uri,e.F=new Bs,e.A=new eo(t.D),null!=t.startTime&&e.A.A(t.startTime),e.J=new ja({wc:function(){return t.D.playbackRate},vc:function(){return t.D.defaultPlaybackRate},Od:function(e){t.D.playbackRate=e},pe:function(e){t.D.currentTime+=e}}),Zs(e,e.h.streaming.rebufferingGoal),e.l.H(t.D,"playing",n),e.l.H(t.D,"pause",n),e.l.H(t.D,"ended",n),e.l.H(t.D,"ratechange",(function(){return ru(e)})),"none"!=e.g.preload&&e.l.ya(t.D,"loadedmetadata",(function(){e.F.h=Date.now()/1e3-r.Rd})),e.g.audioTracks&&(e.l.H(e.g.audioTracks,"addtrack",(function(){return uu(e)})),e.l.H(e.g.audioTracks,"removetrack",(function(){return uu(e)})),e.l.H(e.g.audioTracks,"change",(function(){return uu(e)}))),e.g.textTracks){var i=e.g.textTracks;e.l.H(i,"addtrack",(function(){return uu(e)})),e.l.H(i,"removetrack",(function(){return uu(e)})),e.l.H(i,"change",(function(){return uu(e)}))}t.D.src=t.uri,(yt()||_t("Web0S"))&&t.D.load(),e.o=Pu,e.dispatchEvent(new Be("streaming"));var a=new ye;Za(e.g,HTMLMediaElement.HAVE_METADATA,e.l,(function(){a.resolve()}));var o=!1;return e.Wc.push((function(){o=!0})),Za(e.g,HTMLMediaElement.HAVE_CURRENT_DATA,e.l,(function(){return g((function t(){return N(t,(function(t){switch(t.s){case 1:if(o)return t.return();if(function(e){var t=e.h.preferredAudioLanguage;if(""!=t){e.Jd(t);var r=e.h.preferredVariantRole;""!=r&&e.Jd(t,r)}}(e),Xs(e).find((function(e){return"disabled"!=e.mode}))){t.I(2);break}return w(t,new Promise((function(t){e.l.ya(e.g.textTracks,"change",t),new $e(t).V(1)})),2);case 2:if(o)return t.return();!function(e){var t=e.h.preferredTextLanguage;if(""!=t){e.Kd(t);var r=e.h.preferredTextRole;""!=r&&e.Kd(t,r)}}(e),C(t)}}))}))})),e.g.error?a.reject(pu(e)):"none"==e.g.preload&&(Y.ba('With <video preload="none">, the browser will not load anything until play() is called. We are unable to measure load latency in a meaningful way, and we cannot provide track info yet. Please do not use preload="none" with Shaka Player.'),a.resolve()),e.l.ya(e.g,"error",(function(){a.reject(pu(e))})),new Re(a,(function(){return a.reject(new z(2,7,7001)),Promise.resolve()}))}(n,e,t)})),this.Ya=new Ss(this.P,{Af:function(e,t,r,i){var a=null;return e==n.P&&(a=r==n.P?n.P:n.da),e==n.da&&(a=r==n.P||t.D!=i.D?n.P:r==n.da?n.da:r==n.vb||r==n.ea?n.vb:r==n.xb?n.od:null),e==n.vb&&(a=r==n.ea&&t.D==i.D?n.nd:n.Qa),e==n.nd&&(a=wu(n.ea,n.md,n.Qa,r,t,i)),e==n.md&&(a=wu(n.ea,n.ad,n.Qa,r,t,i)),e==n.ad&&(a=wu(n.ea,n.ea,n.Qa,r,t,i)),e==n.od&&(a=r==n.xb&&t.D==i.D?n.xb:n.Qa),e!=n.ea&&e!=n.xb||(a=n.Qa),e==n.Qa&&(a=i.D&&t.D==i.D?n.da:n.P),a},ef:function(e,t,r){return n.dispatchEvent(new Be("onstatechange",{state:e.name})),i.get(e)(t,r)},handleError:function(e,t){return g((function r(){return N(r,(function(r){switch(r.s){case 1:return Y.v("The walker saw an error:"),t instanceof z?Y.v("Error Code:",t.code):(Y.v("Error Message:",t.message),Y.v("Error Stack:",t.stack)),w(r,js(n,e),2);case 2:return r.return(e.D?n.da:n.P)}}))}))},Xf:function(e){n.dispatchEvent(new Be("onstateidle",{state:e.name}))}}),e&&this.Ub(e,!0)}A(os,Jo),os.prototype.updateManifestExpiration=function(e,t){var r=Yo(this.h,this.g),n=r.store(),i=new ye;return n.get(e).onsuccess=function(r){(r=r.target.result)?(r.expiration=t,n.put(r),i.resolve()):i.reject(new z(2,9,9012,"Could not find values for "+e))},r.promise().then((function(){return i}))},os.prototype.pc=function(e){return{originalManifestUri:e.originalManifestUri,duration:e.duration,size:e.size,expiration:null==e.expiration?1/0:e.expiration,periods:e.periods.map(ss),sessionIds:e.sessionIds,drmInfo:e.drmInfo,appMetadata:e.appMetadata}},os.prototype.ae=function(e){return{data:e.data}},A(ds,Jo),ds.prototype.hasFixedKeySpace=function(){return this.j},ds.prototype.addSegments=function(e){return this.j?Qo(this.i):this.add(this.i,e)},ds.prototype.addManifests=function(e){return this.j?Qo(this.g):this.add(this.g,e)},ds.prototype.pc=function(e){return null==e.expiration&&(e.expiration=1/0),e},(i=hs.prototype).init=function(){var e=this,r=new ye,n=t.indexedDB.open("shaka_offline_db",4);return n.onsuccess=function(t){t=t.target.result,e.j=t;var n=t.objectStoreNames;n.contains("manifest")&&n.contains("segment")?(Y.debug("Mounting v1 idb storage cell"),n=new os(t,"segment","manifest")):n=null,e.g=n,(n=t.objectStoreNames).contains("manifest-v2")&&n.contains("segment-v2")?(Y.debug("Mounting v2 idb storage cell"),n=new ds(t,"segment-v2","manifest-v2",!0)):n=null,e.h=n,(n=t.objectStoreNames).contains("manifest-v3")&&n.contains("segment-v3")?(Y.debug("Mounting v3 idb storage cell"),n=new ds(t,"segment-v3","manifest-v3",!1)):n=null,e.i=n,t.objectStoreNames.contains("session-ids")?(Y.debug("Mounting session ID idb storage cell"),t=new ts(t)):t=null,e.l=t,r.resolve()},n.onupgradeneeded=function(e){e=e.target.result;for(var t=f(["segment-v3","manifest-v3","session-ids"]),r=t.next();!r.done;r=t.next())r=r.value,e.objectStoreNames.contains(r)||e.createObjectStore(r,{autoIncrement:!0})},n.onerror=function(e){r.reject(new z(2,9,9001,n.error)),e.preventDefault()},r},i.destroy=function(){var e=this;return g((function t(){return N(t,(function(t){switch(t.s){case 1:if(!e.g){t.I(2);break}return w(t,e.g.destroy(),2);case 2:if(!e.h){t.I(4);break}return w(t,e.h.destroy(),4);case 4:if(!e.i){t.I(6);break}return w(t,e.i.destroy(),6);case 6:if(!e.l){t.I(8);break}return w(t,e.l.destroy(),8);case 8:e.j&&e.j.close(),C(t)}}))}))},i.getCells=function(){var e=new Map;return this.g&&e.set("v1",this.g),this.h&&e.set("v2",this.h),this.i&&e.set("v3",this.i),e},i.getEmeSessionCell=function(){return this.l},i.erase=function(){var e=this;return g((function r(){return N(r,(function(r){switch(r.s){case 1:if(!e.g){r.I(2);break}return w(r,e.g.destroy(),2);case 2:if(!e.h){r.I(4);break}return w(r,e.h.destroy(),4);case 4:if(!e.i){r.I(6);break}return w(r,e.i.destroy(),6);case 6:return e.j&&e.j.close(),w(r,function(){var e=new ye,r=t.indexedDB.deleteDatabase("shaka_offline_db");return r.onblocked=function(){Y.v("Deleting","shaka_offline_db","is being blocked")},r.onsuccess=function(){e.resolve()},r.onerror=function(t){e.reject(new z(2,9,9001,r.error)),t.preventDefault()},e}(),8);case 8:return e.j=null,e.g=null,e.h=null,e.i=null,w(r,e.init(),0)}}))}))},is("idb",(function(){return _t("CrKey")||!t.indexedDB?null:new hs})),fs.prototype.Ea=function(){return this.l},fs.prototype.ja=function(){return this.j},fs.prototype.key=function(){return this.i},fs.prototype.toString=function(){return this.h},(i=_s.prototype).configure=function(){},i.start=function(e){var t=this;return g((function r(){var n,i,a,o,s;return N(r,(function(r){switch(r.s){case 1:return n=ps(e),t.g=n,null==n||"manifest"!=n.g?r.return(Promise.reject(new z(2,1,9004,n))):(i=new rs,I(r,2),w(r,i.init(),4));case 4:return w(r,ns(i,n.Ea(),n.ja()),5);case 5:return w(r,r.B.getManifests([n.key()]),6);case 6:return a=r.B,o=a[0],s=new gs(n.Ea(),n.ja()),r.return(function(e,t){var r=new Si(null,0);r.Fa(t.duration);var n=t.periods.map((function(t){return ys(e,t,r)})),i=t.drmInfo?[t.drmInfo]:[];return t.drmInfo&&n.forEach((function(e){e.variants.forEach((function(e){e.drmInfos=i}))})),{presentationTimeline:r,minBufferTime:2,offlineSessionIds:t.sessionIds,periods:n}}(s,o));case 2:return x(r),w(r,i.destroy(),7);case 7:R(r,0)}}))}))},i.stop=function(){return Promise.resolve()},i.update=function(){},i.onExpirationUpdated=function(e,t){var r=this;return g((function n(){var i,a,o,s,u,c,l,d;return N(n,(function(n){switch(n.s){case 1:return i=r.g,a=new rs,k(n,2,3),w(n,a.init(),5);case 5:return w(n,ns(a,i.Ea(),i.ja()),6);case 6:return w(n,(o=n.B).getManifests([i.key()]),7);case 7:if(s=n.B,u=s[0],c=u.sessionIds.includes(e),l=null==u.expiration||u.expiration>t,!c||!l){n.I(3);break}return Y.debug("Updating expiration for stored content"),w(n,o.updateManifestExpiration(i.key(),t),3);case 3:return x(n),w(n,a.destroy(),10);case 10:R(n,0);break;case 2:d=P(n),Y.error("There was an error updating",i,d),n.I(3)}}))}))},Ei.Qb("application/x-offline-manifest",_s),j("shaka.offline.OfflineScheme",bs),bs.m=function(e){return Le(e={uri:e,Bd:e,data:new ArrayBuffer(0),headers:{"content-type":"application/x-offline-manifest"}})},bs.o=function(e,t){var r=new rs;return Le(void 0).ca((function(){return r.init()})).ca((function(){return ns(r,t.Ea(),t.ja())})).ca((function(e){return e.getSegments([t.key()])})).ca((function(e){return{uri:t,Bd:t,data:e[0].data,headers:{}}})).finally((function(){return r.destroy()}))},Ye("offline",bs),Ss.prototype.destroy=function(){var e=this;return g((function t(){return N(t,(function(t){switch(t.s){case 1:return e.u=!1,e.h&&e.h.abort(),ws(e),w(t,e.A,2);case 2:e.g&&e.g.Da.kb();for(var r=f(e.l),n=r.next();!n.done;n=r.next())n.value.Da.kb();e.g=null,e.l=[],e.m=null,C(t)}}))}))},j("shaka.text.SimpleTextDisplayer",Cs),Cs.prototype.remove=function(e,t){return!!this.g&&(Is(this.g,(function(r){return r.startTime<t&&r.endTime>e})),!0)},Cs.prototype.remove=Cs.prototype.remove,Cs.prototype.append=function(e){var t=ks,r=e.map((function(e){if(e.nestedCues.length){var t=e.nestedCues.map((function(e){return e.spacer?"\n":e.payload+" "})).join("").replace(/ $/m,"");(e=e.clone()).nestedCues=[],e.payload=t}return e})),n=[];e=this.g.cues?Array.from(this.g.cues):[];for(var i={},a=(r=f(r)).next();!a.done;i={Fb:i.Fb},a=r.next())i.Fb=a.value,e.some(function(e){return function(t){return t.startTime==e.Fb.startTime&&t.endTime==e.Fb.endTime&&t.text==e.Fb.payload}}(i))||(a=t(i.Fb))&&n.push(a);n.slice().sort((function(e,t){return e.startTime!=t.startTime?e.startTime-t.startTime:e.endTime!=t.endTime?e.endTime-t.startTime:"line"in VTTCue.prototype?n.indexOf(t)-n.indexOf(e):n.indexOf(e)-n.indexOf(t)})).forEach(function(e){this.g.addCue(e)}.bind(this))},Cs.prototype.append=Cs.prototype.append,Cs.prototype.destroy=function(){return this.g&&Is(this.g,(function(){return!0})),this.g=null,Promise.resolve()},Cs.prototype.destroy=Cs.prototype.destroy,Cs.prototype.isTextVisible=function(){return"showing"==this.g.mode},Cs.prototype.isTextVisible=Cs.prototype.isTextVisible,Cs.prototype.setTextVisibility=function(e){this.g.mode=e?"showing":"hidden"},Cs.prototype.setTextVisibility=Cs.prototype.setTextVisibility,j("shaka.util.ConfigUtils.mergeConfigObjects",$s),j("shaka.util.ConfigUtils.convertToConfigObject",Ps),j("shaka.util.PlayerConfiguration",xs),xs.mergeConfigObjects=Os,H(Us,Ge),j("shaka.Player",Us),Us.prototype.destroy=function(){var e=this;return g((function t(){var r;return N(t,(function(t){switch(t.s){case 1:return e.o==ku?t.return():(e.o=ku,r=Ts(e.Ya,(function(){return{node:e.P,payload:{Ia:null,D:null,mimeType:null,startTime:null,Rd:null,uri:null},gb:!1}})),w(t,new Promise((function(t){r.Kb=function(){Y.info("Preparing to destroy walker...")},r.Cc=function(){t(),e.dispatchEvent(new Be("loaded"))},r.kb=function(){t()},r.onError=function(){t()},r.Ec=function(){t()}})),2));case 2:return w(t,e.Ya.destroy(),3);case 3:if(e.l&&(e.l.release(),e.l=null),e.Uc=null,e.u=null,e.h=null,!e.X){t.I(0);break}return w(t,e.X.destroy(),5);case 5:e.X=null,C(t)}}))}))},Us.prototype.destroy=Us.prototype.destroy,Us.version="v2.5.23";var Gs=["2","5"];Kr=new function(e){this.g=e,this.i=Zr,this.h=Wr}(new jr(Number(Gs[0]),Number(Gs[1])));var Vs=["output-restricted","internal-error"],Fs={};function js(e,t){return g((function r(){var n;return N(r,(function(r){switch(r.s){case 1:return e.o!=ku&&(e.o=Iu),n=e.Wc.map((function(e){return e()})),e.Wc=[],w(r,Promise.all(n),2);case 2:if(e.dispatchEvent(new Be("unloading")),t.Ia=null,t.mimeType=null,t.startTime=null,t.uri=null,t.D&&(e.l.ta(t.D,"loadedmetadata"),e.l.ta(t.D,"playing"),e.l.ta(t.D,"pause"),e.l.ta(t.D,"ended"),e.l.ta(t.D,"ratechange")),e.wb&&(e.wb.release(),e.wb=null),e.ic&&(e.ic.stop(),e.ic=null),!e.C){r.I(3);break}return w(r,e.C.stop(),4);case 4:e.C=null;case 3:if(!e.u){r.I(5);break}return w(r,e.u.stop(),5);case 5:if(!e.j){r.I(7);break}return w(r,e.j.destroy(),8);case 8:e.j=null;case 7:if(e.J&&(e.J.release(),e.J=null),e.A&&(e.A.release(),e.A=null),!e.M){r.I(9);break}return w(r,e.M.destroy(),10);case 10:e.M=null;case 9:if(!t.D||!t.D.src){r.I(11);break}return w(r,new Promise((function(e){return new $e(e).V(.1)})),12);case 12:t.D.removeAttribute("src"),t.D.load();case 11:if(!e.m){r.I(13);break}return w(r,e.m.destroy(),14);case 14:e.m=null;case 13:e.Z.g.clear(),e.Tb=null,e.L=null,e.lc.clear(),e.i=null,e.F=null,e.fd=null,e.yb=!0,tu(e),C(r)}}))}))}function Hs(e,t){return new St(t,e.h.drm.updateExpirationTime)}function Zs(e,t){e.L=new $a,e.L.g=xa,Pa(e.L,t,Math.min(.5,t/2)),tu(e),e.ic=new $e((function(){Ws(e)})).Oa(.25)}function Ws(e){switch(e.o){case Pu:var t=!!e.g.ended||Xt(e.g.buffered)>=e.g.duration-1;break;case $u:e:if(e.g.ended||Tr(e.M))t=!0;else{if(e.i.presentationTimeline.aa()){var r=e.i.presentationTimeline.Db();if(Xt(e.g.buffered)>=r){t=!0;break e}}t=!1}break;default:t=!1}var n=zt(e.g.buffered,e.g.currentTime),i=t,a=(r=e.L).h.get(r.g);t=r.g,n=i||n>=a?Ra:xa,r.g=n,t!=n&&tu(e)}function Ks(e){if(e.C){var t=Ve(e.h.manifest);e.g&&"AUDIO"===e.g.nodeName&&(t.disableVideo=!0),e.C.configure(t)}if(e.m&&e.m.configure(e.h.drm),e.j){e.j.configure(e.h.streaming);try{e.i.periods.forEach(e.Xc.bind(e))}catch(a){e.Va(a)}var r=ho(e.j),n=fo(e.j);t=Eu(e),r=Gr.ie(r,n,t.variants),e.u&&r&&r.allowedByApplication&&r.allowedByKeySystem?iu(e,t.variants):(Y.debug("Choosing new streams after changing configuration"),au(e,t))}if(e.M&&(t=e.h.textDisplayFactory,e.fd!=t)){r=new t;var i=(n=e.M).l;n.l=r,i&&(r.setTextVisibility(i.isTextVisible()),i.destroy()),n.g&&(n.g.i=r),e.fd=t,e.j&&(r=(t=e.j).h.get("text"))&&vo(t,r.stream,!0,0,!0)}e.u&&(e.u.configure(e.h.abr),e.h.abr.enabled&&!e.yb?e.u.enable():e.u.disable(),hu(e)),e.L&&(t=e.h.streaming.rebufferingGoal,e.i&&(t=Math.max(t,e.i.minBufferTime)),Pa(e.L,t,Math.min(.5,t/2)))}function Xs(e){return Array.from(e.g.textTracks).filter((function(e){return"metadata"!=e.kind&&"chapters"!=e.kind&&"Shaka Player TextTrack"!=e.label}))}function Ys(e,t,r,n){Aa(e.Z,t).variant=r,(e=e.F.i).i!=r&&(e.i=r,e.g.push({timestamp:Date.now()/1e3,id:r.id,type:"variant",fromAdaptation:n,bandwidth:r.bandwidth}))}function zs(e,t,r,n){ba(e.Z,t,r),(e=e.F.i).h!=r&&(e.h=r,e.g.push({timestamp:Date.now()/1e3,id:r.id,type:"text",fromAdaptation:n,bandwidth:null}))}function Js(e){var t=Rs();return t.streaming.failureCallback=function(t){e.aa()&&[1001,1002,1003].includes(t.code)&&(t.severity=1,Y.v("Live streaming error.  Retrying automatically..."),e.Id())},t.textDisplayFactory=function(){return new Cs(e.g)},t}function Qs(e,t){var r=e.j?ho(e.j):null,n=e.j?fo(e.j):null;if(t.forEach(Gr.filterNewPeriod.bind(null,e.m,r,n)),r=function(e,t){var r=0;return e.forEach((function(e){r+=t(e)?1:0})),r}(t,(function(e){return e.variants.some(Gr.Gb)})),0==r)throw new z(2,4,4032);if(r<t.length)throw new z(2,4,4011);t.forEach(function(e){Gr.Xd(e.variants,this.h.restrictions,this.mc)&&this.j&&Eu(this)==e&&uu(this),mu(this,e.variants)}.bind(e))}function qs(e,t,r,n){return r=void 0!==r&&r,n=void 0===n?0:n,e.yb?(e.wa=t,e.qe=r,e.oe=n,!0):((t=mo(e.j,t,r,n))&&cu(e),t)}function eu(e,t){if(e.yb)return e.va=t,!0;var r=vo(e.j,t,!0,0,!1);return r&&lu(e),r}function tu(e){var t=e.jd();if(e.F&&e.L&&e.A){var r=e.J;r.j=t,Ha(r),nu(e)}e.dispatchEvent(new Be("buffering",{buffering:t}))}function ru(e){var t=e.g.playbackRate;0!=t&&e.J.set(t)}function nu(e){if(e.F&&e.L){var t=e.F.g;e.L.g==xa?Ls(t,"buffering"):e.g.paused?Ls(t,"paused"):e.g.ended?Ls(t,"ended"):Ls(t,"playing")}}function iu(e,t){try{mu(e,t)}catch(n){return e.Va(n),null}var r=t.filter((function(e){return Gr.Gb(e)}));return r=e.tb.create(r),e.u.setVariants(Array.from(r.values())),e.u.chooseVariant()}function au(e,t){var r=ou(e,t,!1),n=Gr.Wb(t.textStreams,e.ua,e.Xa)[0]||null,i=!1;n&&(e.h.streaming.alwaysStreamText||e.zc())&&(zs(e,t,n,!0),i=eu(e,n)),(r||i)&&su(e)}function ou(e,t,r){r=void 0===r||r;var n=iu(e,t.variants),i=!1;return n&&(Ys(e,t,n,!0),i=qs(e,n,!0)),r&&i&&su(e),i}function su(e){vu(e,new Be("adaptation"))}function uu(e){vu(e,new Be("trackschanged"))}function cu(e){vu(e,new Be("variantchanged"))}function lu(e){vu(e,new Be("textchanged"))}function du(e){vu(e,new Be("texttrackvisibility"))}function hu(e){vu(e,new Be("abrstatuschanged",{Zg:e.h.abr.enabled}))}function fu(e,t,r){e.dispatchEvent(new Be(t,{detail:{schemeIdUri:r.schemeIdUri,value:r.value,startTime:r.startTime,endTime:r.endTime,id:r.id,eventElement:r.eventElement}}))}function pu(e){if(!e.g.error)return null;var t=e.g.error.code;if(1==t)return null;var r=e.g.error.msExtendedCode;return r&&(0>r&&(r+=Math.pow(2,32)),r=r.toString(16)),new z(2,3,3016,t,r,e.g.error.message)}function gu(e,t){if(e.j){var r=Eu(e),n=!1,i=Object.keys(t);0==i.length&&Y.v("Got a key status event without any key statuses, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");var a=1==i.length&&"00"==i[0];a&&Y.v("Got a synthetic key status event, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks."),i.length&&e.i.periods.forEach((function(e){e.variants.forEach((function(e){Gr.Kf(e).forEach((function(r){var i=e.allowedByKeySystem;r.keyId&&(r=t[a?"00":r.keyId],e.allowedByKeySystem=!!r&&!Vs.includes(r)),i!=e.allowedByKeySystem&&(n=!0)}))}))})),i=ho(e.j);var o=fo(e.j);(i=Gr.ie(i,o,r.variants))&&!i.allowedByKeySystem&&(Y.debug("Choosing new variants after key status changed"),ou(e,r)),n&&(uu(e),iu(e,r.variants))}}function yu(e,t,r){e.C&&e.C.onExpirationUpdated&&e.C.onExpirationUpdated(t,r),e.dispatchEvent(new Be("expirationupdated"))}function mu(e,t){var r=e.m?ct(e.m.da):{},n=Object.keys(r);n=n.length&&"00"==n[0];for(var i=!1,a=!1,o=[],s=[],u=f(t),c=u.next();!c.done;c=u.next()){var l=[];(c=c.value).audio&&l.push(c.audio),c.video&&l.push(c.video);for(var d=(l=f(l)).next();!d.done;d=l.next())if((d=d.value).keyId){var h=r[n?"00":d.keyId];h?Vs.includes(h)&&(s.includes(h)||s.push(h)):o.includes(d.keyId)||o.push(d.keyId)}c.allowedByApplication?c.allowedByKeySystem&&(i=!0):a=!0}if(!i)throw new z(2,4,4012,{hasAppRestrictions:a,missingKeys:o,restrictedKeyStatuses:s})}function vu(e,t){g((function r(){return N(r,(function(r){switch(r.s){case 1:return w(r,Promise.resolve(),2);case 2:e.o!=ku&&e.dispatchEvent(t),C(r)}}))}))}function _u(e){for(var t=new Set,r=(e=f(e)).next();!r.done;r=e.next())(r=r.value).language?t.add(Mr(r.language)):t.add("und");return t}function bu(e){for(var t=new Map,r=(e=f(e)).next();!r.done;r=e.next()){var n=r.value;r="und";var i=[];for(n.language&&(r=Mr(n.language)),(i="variant"==n.type?n.audioRoles:n.roles)&&i.length||(i=[""]),t.has(r)||t.set(r,new Set),i=(n=f(i)).next();!i.done;i=n.next())i=i.value,t.get(r).add(i)}var a=[];return t.forEach((function(e,t){for(var r=f(e),n=r.next();!n.done;n=r.next())a.push({language:t,role:n.value})})),a}function Au(e){return null==(e=Eu(e))?[]:e.variants.filter((function(e){return Gr.Gb(e)}))}function Eu(e){for(var t=e.A.l(),r=null,n=(e=f(e.i.periods)).next();!n.done;n=e.next())(n=n.value).startTime<=t&&(r=n);return r}function Su(e){var t=Eu(e);return Aa(e.Z,t).variant}function Tu(){return new z(2,7,7e3)}function wu(e,t,r,n,i,a){return n==e&&i.D==a.D&&i.uri==a.uri&&i.mimeType==a.mimeType&&i.Ia==a.Ia?t:r}function Cu(e){return new Promise((function(t,r){e.kb=function(){return r(Tu())},e.Cc=function(){return t()},e.onError=function(e){return r(e)},e.Ec=function(){return r(Tu())}}))}Us.registerSupportPlugin=function(e,t){Fs[e]=t},Us.isBrowserSupported=function(){if(!(t.Promise&&t.Uint8Array&&Array.prototype.forEach))return!1;var e=vt();return!(e&&12>e||!(t.MediaKeys&&t.navigator&&t.navigator.requestMediaKeySystemAccess&&t.MediaKeySystemAccess&&t.MediaKeySystemAccess.prototype.getConfiguration))&&(!!pt()||gt("application/x-mpegurl"))},Us.probeSupport=function(){return Nt().then((function(e){for(var t=Ei.ng(),r={},n=f('video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",video/mp4; codecs="av01.0.01M.08",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="opus",audio/mp4; codecs="flac",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",")),i=n.next();!i.done;i=n.next()){r[i=i.value]=pt()?!!mr(i)||MediaSource.isTypeSupported(i)||Ce(i):gt(i);var a=i.split(";")[0];r[a]=r[a]||r[i]}for(var o in e={manifest:t,media:r,drm:e},Fs)e[o]=Fs[o]();return e}))},Us.prototype.Ub=function(e,t){if(t=void 0===t||t,this.o==ku)return Promise.reject(Tu());var r={Ia:null,D:null,mimeType:null,startTime:null,Rd:null,uri:null};r.D=e,pt()||(t=!1);var n=t?this.vb:this.da,i=Ts(this.Ya,(function(){return{node:n,payload:r,gb:!1}}));return i.Kb=function(){return Y.info("Starting attach...")},Cu(i)},Us.prototype.attach=Us.prototype.Ub,Us.prototype.detach=function(){var e=this;if(this.o==ku)return Promise.reject(Tu());var t=Ts(this.Ya,(function(){return{node:e.P,payload:{Ia:null,D:null,mimeType:null,startTime:null,Rd:null,uri:null},gb:!1}}));return t.Kb=function(){return Y.info("Starting detach...")},Cu(t)},Us.prototype.detach=Us.prototype.detach,Us.prototype.Ud=function(e){var t=this;if(e=void 0===e||e,this.o==ku)return Promise.reject(Tu());pt()||(e=!1);var r={Ia:null,D:null,mimeType:null,startTime:null,Rd:null,uri:null},n=Ts(this.Ya,(function(n){var i=n.D&&e?t.vb:n.D?t.da:t.P;return r.D=n.D,{node:i,payload:r,gb:!1}}));return n.Kb=function(){return Y.info("Starting unload...")},Cu(n)},Us.prototype.unload=Us.prototype.Ud,Us.prototype.load=function(e,t,r){if(this.o==ku)return Promise.reject(Tu());this.dispatchEvent(new Be("loading"));var n={Ia:null,D:null,mimeType:null,startTime:null,Rd:null,uri:null};n.uri=e,n.Rd=Date.now()/1e3,r&&"string"!=typeof r&&(Hr("Loading with a manifest parser factory","Please register a manifest parser and for the mime-type."),n.Ia=function(){return new r}),r&&"string"==typeof r&&(n.mimeType=r),void 0!==t&&(n.startTime=t);var i=function(e,t){if(t.Ia)return!1;if(!pt())return!0;var r=t.mimeType,n=t.uri||"";return r||(r={mp4:"video/mp4",m4v:"video/mp4",m4a:"audio/mp4",webm:"video/webm",weba:"audio/webm",mkv:"video/webm",ts:"video/mp2t",ogv:"video/ogg",ogg:"audio/ogg",mpg:"video/mpeg",mpeg:"video/mpeg",m3u8:"application/x-mpegurl",mp3:"audio/mpeg",aac:"audio/aac",flac:"audio/flac",wav:"audio/wav"}[Ei.getExtension(n)]),!!r&&""!=(t.D||bt()).canPlayType(r)&&(!Ei.isSupported(n,r)||mt()&&e.h.streaming.useNativeHlsOnSafari)}(this,n)?this.xb:this.ea,a=Ts(this.Ya,(function(e){return null==e.D?null:(n.D=e.D,{node:i,payload:n,gb:!0})}));return a.Kb=function(){return Y.info("Starting load of "+e+"...")},new Promise((function(e,t){a.Ec=function(){return t(new z(2,7,7002))},a.Cc=function(){return e()},a.kb=function(){return t(Tu())},a.onError=function(e){return t(e)}}))},Us.prototype.load=Us.prototype.load,Us.prototype.configure=function(e,t){2==arguments.length&&"string"==typeof e&&(e=Ps(e,t));var r=Os(this.h,e,Js(this));return Ks(this),r},Us.prototype.configure=Us.prototype.configure,Us.prototype.getConfiguration=function(){var e=Js(this);return Os(e,this.h,Js(this)),e},Us.prototype.getConfiguration=Us.prototype.getConfiguration,Us.prototype.vg=function(){for(var e in this.h)delete this.h[e];Os(this.h,Js(this),Js(this)),Ks(this)},Us.prototype.resetConfiguration=Us.prototype.vg,Us.prototype.tf=function(){return this.o},Us.prototype.getLoadMode=Us.prototype.tf,Us.prototype.yf=function(){return this.g},Us.prototype.getMediaElement=Us.prototype.yf,Us.prototype.Yb=function(){return this.X},Us.prototype.getNetworkingEngine=Us.prototype.Yb,Us.prototype.tc=function(){return this.Tb},Us.prototype.getAssetUri=Us.prototype.tc,Us.prototype.wf=function(){return Hr("getManifestUri",'Please use "getAssetUri" instead.'),this.tc()},Us.prototype.getManifestUri=Us.prototype.wf,Us.prototype.aa=function(){return this.i?this.i.presentationTimeline.aa():!(!this.g||!this.g.src)&&1/0==this.g.duration},Us.prototype.isLive=Us.prototype.aa,Us.prototype.ib=function(){return!!this.i&&this.i.presentationTimeline.ib()},Us.prototype.isInProgress=Us.prototype.ib,Us.prototype.Qf=function(){if(this.i){if(!this.i.periods.length)return!1;var e=this.i.periods[0].variants;return!!e.length&&!e[0].video}return!(!this.g||!this.g.src)&&(this.g.videoTracks?0==this.g.videoTracks.length:0==this.g.videoHeight)},Us.prototype.isAudioOnly=Us.prototype.Qf,Us.prototype.He=function(){if(this.i){var e=this.i.presentationTimeline;return{start:e.Cb(),end:e.Ka()}}return this.g&&this.g.src&&(e=this.g.seekable).length?{start:e.start(0),end:e.end(e.length-1)}:{start:0,end:0}},Us.prototype.seekRange=Us.prototype.He,Us.prototype.keySystem=function(){return $t(this.drmInfo())},Us.prototype.keySystem=Us.prototype.keySystem,Us.prototype.drmInfo=function(){return this.m?this.m.g:null},Us.prototype.drmInfo=Us.prototype.drmInfo,Us.prototype.Xb=function(){return this.m?this.m.Xb():1/0},Us.prototype.getExpiration=Us.prototype.Xb,Us.prototype.jd=function(){return!!this.L&&this.L.g==xa},Us.prototype.isBuffering=Us.prototype.jd,Us.prototype.Cf=function(){if(this.J){var e=this.J;e=e.j?0:e.i}else e=0;return e},Us.prototype.getPlaybackRate=Us.prototype.Cf,Us.prototype.Mg=function(e){0==e?Y.ba("A trick play rate of 0 is unsupported!"):(this.g.paused&&this.g.play(),this.J&&this.J.set(e),this.o==$u&&yo(this.j,1<Math.abs(e)))},Us.prototype.trickPlay=Us.prototype.Mg,Us.prototype.$e=function(){var e=this.J.vc();this.o==Pu&&this.J.set(e),this.o==$u&&(this.J.set(e),yo(this.j,!1))},Us.prototype.cancelTrickPlay=Us.prototype.$e,Us.prototype.ed=function(){if(this.i&&this.A){for(var e=Su(this),t=[],r=f(Au(this)),n=r.next();!n.done;n=r.next()){n=n.value;var i=Gr.Oc(n);i.active=n==e,t.push(i)}return t}return this.g&&this.g.audioTracks?Array.from(this.g.audioTracks).map((function(e){return Gr.je(e)})):[]},Us.prototype.getVariantTracks=Us.prototype.ed,Us.prototype.Eb=function(){if(this.i&&this.A){for(var e=function(e){var t=Eu(e);if(null==t)return null;if(!Aa(e.Z,t).text){var r=Gr.Wb(t.textStreams,e.ua,e.Xa);r.length&&ba(e.Z,t,r[0])}return Aa(e.Z,t).text}(this),t=[],r=f(function(e){var t=Eu(e);return null==t?[]:t.textStreams.filter((function(t){return!e.lc.has(t)}))}(this)),n=r.next();!n.done;n=r.next()){n=n.value;var i=Gr.Kc(n);i.active=n==e,t.push(i)}return t}return this.g&&this.g.src&&this.g.textTracks?Xs(this).map((function(e){return Gr.Of(e)})):[]},Us.prototype.getTextTracks=Us.prototype.Eb,Us.prototype.Ld=function(e){if(this.i&&this.j){var t=Eu(this),r=t.textStreams.find((function(t){return t.id==e.id}));r?(zs(this,t,r,!1),eu(this,r),this.ua=r.language):Y.error("No stream with id",e.id)}else if(this.g&&this.g.src&&this.g.textTracks){for(r=(t=f(t=Xs(this))).next();!r.done;r=t.next())r=r.value,Gr.gd(r)==e.id?r.mode=this.ub?"showing":"hidden":r.mode="disabled";lu(this)}},Us.prototype.selectTextTrack=Us.prototype.Ld,Us.prototype.xg=function(){Hr("selectEmbeddedTextTrack","If closed captions are signaled in the manifest, a text stream will be created to represent them. Please use SelectTextTrack.");var e=this.Eb().filter((function(e){return"application/cea-608"==e.mimeType}));0<e.length?this.Ld(e[0]):Y.v("Unable to find the text track embedded in the video.")},Us.prototype.selectEmbeddedTextTrack=Us.prototype.xg,Us.prototype.Rg=function(){Hr("usingEmbeddedTextTrack","If closed captions are signaled in the manifest, a text stream will be created to represent them. There should be no reason to know if the player is playing embedded text.");var e=this.Eb().filter((function(e){return e.active}))[0];return!!e&&"application/cea-608"==e.mimeType},Us.prototype.usingEmbeddedTextTrack=Us.prototype.Rg,Us.prototype.Ie=function(e,t,r){if(r=void 0===r?0:r,this.i&&this.j){var n=Eu(this);this.h.abr.enabled&&Y.ba("Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack().");var i=n.variants.find((function(t){return t.id==e.id}));i?Gr.Gb(i)?(Ys(this,n,i,!1),qs(this,i,t,r),this.tb=new ka(i),iu(this,n.variants)):Y.error("Unable to switch to restricted track",e.id):Y.error("No variant with id",e.id)}else if(this.g&&this.g.audioTracks){for(r=(t=f(t=Array.from(this.g.audioTracks))).next();!r.done;r=t.next())r=r.value,Gr.gd(r)==e.id&&(r.enabled=!0);cu(this)}},Us.prototype.selectVariantTrack=Us.prototype.Ie,Us.prototype.nf=function(){return bu(this.ed())},Us.prototype.getAudioLanguagesAndRoles=Us.prototype.nf,Us.prototype.Jf=function(){return bu(this.Eb())},Us.prototype.getTextLanguagesAndRoles=Us.prototype.Jf,Us.prototype.mf=function(){return Array.from(_u(this.ed()))},Us.prototype.getAudioLanguages=Us.prototype.mf,Us.prototype.If=function(){return Array.from(_u(this.Eb()))},Us.prototype.getTextLanguages=Us.prototype.If,Us.prototype.Jd=function(e,t){if(this.i&&this.A){var r=Eu(this);if(this.tb=new Ia(e,t||"",0,""),!this.h.abr.enabled){var n=function(e,t){return e.video||t.video?e.video&&t.video?Math.abs((e.video.height||0)-(t.video.height||0))+Math.abs((e.video.width||0)-(t.video.width||0)):1/0:0},i=Eu(this)||this.i.periods[0],a=Aa(this.Z,i).variant,o=this.tb.create(i.variants);i=null;for(var s=(o=f(o.values())).next();!s.done;s=o.next())s=s.value,(!i||n(i,a)>n(s,a))&&(i=s);if(i)return r=Gr.Oc(i),void this.Ie(r,!0)}ou(this,r)}else if(this.g&&this.g.audioTracks){for(i=Array.from(this.g.audioTracks),r=Mr(e),a=n=null,o=(i=f(i)).next();!o.done;o=i.next())o=o.value,Mr((s=Gr.je(o)).language)==r&&(n=o,t?s.roles.includes(t)&&(a=o):0==s.roles.length&&(a=o));a?(a.enabled=!0,cu(this)):n&&(n.enabled=!0,cu(this))}},Us.prototype.selectAudioLanguage=Us.prototype.Jd,Us.prototype.Kd=function(e,t){if(this.i&&this.A){var r=Eu(this);this.ua=e,this.Xa=t||"";var n=Gr.Wb(r.textStreams,this.ua,this.Xa)[0]||null;n&&(zs(this,r,n,!1),(this.h.streaming.alwaysStreamText||this.zc())&&eu(this,n))}else{var i=Mr(e);(r=this.Eb().filter((function(e){return Mr(e.language)==i&&(!t||e.roles.includes(t))}))[0])&&this.Ld(r)}},Us.prototype.selectTextLanguage=Us.prototype.Kd,Us.prototype.yg=function(e){if(this.i&&this.A){for(var t=Eu(this),r=null,n=f(Au(this)),i=n.next();!i.done;i=n.next())if((i=i.value).audio.label==e){r=i;break}null==r?Y.v("No variants were found with label: "+e+". Ignoring the request to switch."):(this.tb=new Ia(r.language,"",0,e),ou(this,t))}},Us.prototype.selectVariantsByLabel=Us.prototype.yg,Us.prototype.zc=function(){var e=this.ub;return this.M?this.M.l.isTextVisible():this.g&&this.g.src&&this.g.textTracks?Xs(this).some((function(e){return"showing"==e.mode})):e},Us.prototype.isTextTrackVisible=Us.prototype.zc,Us.prototype.Bg=function(e){var t=this;return g((function r(){var n,i,a,o;return N(r,(function(r){switch(r.s){case 1:if(t.ub==(n=!!e))return r.return();if(t.ub=n,t.o!=$u){if(t.g&&t.g.src&&t.g.textTracks)for(var s=f(Xs(t)),u=s.next();!u.done;u=s.next())"disabled"!=(i=u.value).mode&&(i.mode=n?"showing":"hidden");r.I(2);break}if(t.M.l.setTextVisibility(n),t.h.streaming.alwaysStreamText){r.I(2);break}if(!n){!function(e){e.L=!0;var t=e.h.get("text");t&&(Mo(t),No(t).catch((function(){})),e.h.delete("text"))}(t.j),r.I(2);break}if(po(t.j,"text")){r.I(2);break}if(a=Eu(t),!(0<(o=Gr.Wb(a.textStreams,t.ua,t.Xa)).length)){r.I(2);break}return w(r,go(t.j,o[0]),2);case 2:du(t),C(r)}}))}))},Us.prototype.setTextTrackVisibility=Us.prototype.Bg,Us.prototype.Ef=function(){if(!this.aa())return Y.v("getPlayheadTimeAsDate is for live streams!"),null;var e=this.Ya.j,t=0;if(this.A)t=this.A.l();else if(e){if(null==e.startTime)return new Date;t=e.startTime}return this.i?new Date(1e3*(this.i.presentationTimeline.j+this.g.currentTime)):this.g&&this.g.getStartDate?(e=this.g.getStartDate(),isNaN(e.getTime())?(Y.v("EXT-X-PROGRAM-DATETIME required to get playhead time as Date!"),null):new Date(e.getTime()+1e3*t)):(Y.v("No way to get playhead time as Date!"),null)},Us.prototype.getPlayheadTimeAsDate=Us.prototype.Ef,Us.prototype.Gf=function(){if(!this.aa())return Y.v("getPresentationStartTimeAsDate is for live streams!"),null;if(this.i)return new Date(1e3*this.i.presentationTimeline.j);if(this.g&&this.g.getStartDate){var e=this.g.getStartDate();return isNaN(e.getTime())?(Y.v("EXT-X-PROGRAM-DATETIME required to get presentation start time as Date!"),null):e}return Y.v("No way to get presentation start time as Date!"),null},Us.prototype.getPresentationStartTimeAsDate=Us.prototype.Gf,Us.prototype.bd=function(){var e={total:[],audio:[],video:[],text:[]};return this.o==Pu&&(e.total=Jt(this.g.buffered)),this.o==$u&&this.M.bd(e),e},Us.prototype.getBufferedInfo=Us.prototype.bd,Us.prototype.getStats=function(){if(this.o!=$u&&this.o!=Pu)return{width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,corruptedFrames:NaN,estimatedBandwidth:NaN,loadLatency:NaN,playTime:NaN,pauseTime:NaN,bufferingTime:NaN,licenseTime:NaN,switchHistory:[],stateHistory:[]};nu(this);var e=this.g;if(e.getVideoPlaybackQuality){e=e.getVideoPlaybackQuality();var t=this.F,r=Number(e.totalVideoFrames);t.A=Number(e.droppedVideoFrames),t.u=r,this.F.o=Number(e.corruptedVideoFrames)}e=this.m&&(e=this.m).P?e.P:NaN,this.F.m=e,this.o==$u&&((e=Su(this))&&(this.F.C=e.bandwidth),e&&e.video&&(t=this.F,r=e.video.height||NaN,t.F=e.video.width||NaN,t.l=r),e=this.u.getBandwidthEstimate(),this.F.j=e);var n=this.F;e=n.F,t=n.l,r=n.C;for(var i=n.u,a=n.A,o=n.o,s=n.j,u=n.h,c=Ms(n.g,"playing"),l=Ms(n.g,"paused"),d=Ms(n.g,"buffering"),h=n.m,p=function(e){function t(e){return{timestamp:e.timestamp,state:e.state,duration:e.duration}}for(var r=[],n=f(e.h),i=n.next();!i.done;i=n.next())r.push(t(i.value));return e.g&&r.push(t(e.g)),r}(n.g),g=[],y=(n=f(n.i.g)).next();!y.done;y=n.next())y=y.value,g.push({timestamp:y.timestamp,id:y.id,type:y.type,fromAdaptation:y.fromAdaptation,bandwidth:y.bandwidth});return{width:e,height:t,streamBandwidth:r,decodedFrames:i,droppedFrames:a,corruptedFrames:o,estimatedBandwidth:s,loadLatency:u,playTime:c,pauseTime:l,bufferingTime:d,licenseTime:h,stateHistory:p,switchHistory:g}},Us.prototype.getStats=Us.prototype.getStats,Us.prototype.addTextTrack=function(e,t,r,n,i,a){var o=this;return g((function s(){var u,c,l,d,h,f,p,g,y;return N(s,(function(s){switch(s.s){case 1:if(o.o==Pu)throw Y.error("Cannot add text when loaded with src="),Error("State error!");if(o.o!=$u)throw Y.error("Must call load() and wait for it to resolve before adding text tracks."),Error("State error!");if(u=Eu(o),c=pe,l=o.i.periods.indexOf(u),h=(d=l+1)>=o.i.periods.length?o.i.presentationTimeline.ha():o.i.periods[d].startTime,1/0==(f=h-u.startTime))throw new z(1,4,4033);return p=new ii(1,0,f,(function(){return[e]}),0,null),g={id:o.re++,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return 1},getSegmentReference:function(e){return 1==e?p:null},initSegmentReference:null,presentationTimeOffset:0,mimeType:n,codecs:i||"",kind:r,encrypted:!1,keyId:null,language:t,label:a||null,type:c.za,primary:!1,frameRate:void 0,pixelAspectRatio:void 0,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null},o.lc.add(g),u.textStreams.push(g),w(s,go(o.j,g),2);case 2:return(y=po(o.j,"text"))&&ba(o.Z,u,y),o.lc.delete(g),Y.debug("Choosing new streams after adding a text stream"),au(o,u),uu(o),s.return(Gr.Kc(g))}}))}))},Us.prototype.addTextTrack=Us.prototype.addTextTrack,Us.prototype.Nd=function(e,t){this.mc.width=e,this.mc.height=t},Us.prototype.setMaxHardwareResolution=Us.prototype.Nd,Us.prototype.Id=function(){if(this.o==$u){var e=this.j;if(e.j)Y.error("Unable to retry after StreamingEngine is destroyed!"),e=!1;else if(e.A)Y.error("Unable to retry after StreamingEngine encountered a fatal error!"),e=!1;else{for(var t=f(e.h.values()),r=t.next();!r.done;r=t.next()){var n=Uo(r=r.value);r.ac&&(Y.info(n,"Retrying after failure..."),r.ac=!1,Lo(e,r,.1))}e=!0}}else e=!1;return e},Us.prototype.retryStreaming=Us.prototype.Id,Us.prototype.uf=function(){return this.i},Us.prototype.getManifest=Us.prototype.uf,Us.prototype.vf=function(){return this.C?this.C.constructor:null},Us.prototype.getManifestParserFactory=Us.prototype.vf,(i=Us.prototype).Xc=function(e){var t=this.j?ho(this.j):null,r=this.j?fo(this.j):null;if(Gr.filterNewPeriod(this.m,t,r,e),!(t=e.variants).some(Gr.Gb))throw new z(2,4,4011);if(mu(this,e.variants),Gr.Xd(t,this.h.restrictions,this.mc)&&this.j&&Eu(this)==e&&uu(this),(e=this.m?this.m.g:null)&&this.m.o)for(r=(t=f(t)).next();!r.done;r=t.next())for(var n=(r=f(r.value.drmInfos)).next();!n.done;n=r.next())if((n=n.value).keySystem==e.keySystem)for(var i=(n=f(n.initData||[])).next();!i.done;i=n.next())i=i.value,It(this.m,i.initDataType,i.initData)},i.Vf=function(e){Y.debug("onChooseStreams_",e);try{Y.O("onChooseStreams_, choosing variant from ",e.variants),Y.O("onChooseStreams_, choosing text from ",e.textStreams),this.yb=!0,this.u.disable(),hu(this),Y.debug("Choosing new streams after period changed");var t=iu(this,e.variants),r=Gr.Wb(e.textStreams,this.ua,this.Xa)[0]||null;this.wa&&(e.variants.includes(this.wa)&&(t=this.wa),this.wa=null),this.va&&(e.textStreams.includes(this.va)&&(r=this.va),this.va=null),t&&Ys(this,e,t,!0),r&&zs(this,e,r,!0);var n=this.j,i=n.h.get("video");if(i)var a=n.i.periods[i.oa];else{var o=n.h.get("audio");a=o?n.i.periods[o.oa]:null}var s=t?t.audio:null;if(!a&&r){var u;if(u=s){e=r;var c=Mr(this.h.preferredTextLanguage),l=Mr(s.language),d=Mr(e.language);u=Dr(d,c)&&!Dr(l,d)}u&&(this.ub=!0),this.ub&&this.M.l.setTextVisibility(!0),du(this)}var h=this.h.streaming.alwaysStreamText||this.zc()?{variant:t,text:r}:{variant:t,text:null};return Y.O("onChooseStreams_, chose variant ",h.variant),Y.O("onChooseStreams_, chose text ",h.text),h}catch(f){return this.Va(f),{variant:null,text:null}}},i.Ze=function(){Y.debug("canSwitch_"),this.yb=!1,this.h.abr.enabled&&(this.u.enable(),hu(this)),this.wa&&(mo(this.j,this.wa,this.qe,this.oe),cu(this),this.wa=null),this.va&&(vo(this.j,this.va,!0,0,!1),lu(this),this.va=null)},i.$f=function(){this.C&&this.C.update&&this.C.update()},i.eg=function(){this.A&&this.A.C()},i.Va=function(e){if(this.o!=ku){var t=new Be("error",{detail:e});this.dispatchEvent(t),t.defaultPrevented&&(e.handled=!0)}};var ku=0,Iu=1,$u=2,Pu=3;function xu(e,t){var r=ys(new gs(e.Ea(),e.ja()),t.periods[0],new Si(null,0)),n=t.appMetadata||{};return r=Ru(r),{offlineUri:e.toString(),originalManifestUri:t.originalManifestUri,duration:t.duration,size:t.size,expiration:t.expiration,tracks:r,appMetadata:n}}function Ru(e){for(var t=[],r=Gr.Bf(e.variants),n=(r=f(r)).next();!n.done;n=r.next())t.push(Gr.Oc(n.value));for(r=(e=f(e.textStreams)).next();!r.done;r=e.next())t.push(Gr.Kc(r.value));return t}function Ou(){this.g={}}function Du(e,t){var r=t.audio,n=t.video;if(r&&!n&&(e.g[r.id]=r.bandwidth||t.bandwidth),!r&&n&&(e.g[n.id]=n.bandwidth||t.bandwidth),r&&n){var i=r.bandwidth||393216,a=n.bandwidth||t.bandwidth-i;0>=a&&(Y.v("Audio bit rate consumes variants bandwidth. Setting video bandwidth to match variant's bandwidth."),a=t.bandwidth),e.g[r.id]=i,e.g[n.id]=a}}function Lu(e,t){var r=e.g[t];return null==r&&(r=0,Y.error("Asking for bitrate of stream not given to the estimator")),0==r&&Y.v("Using bitrate of 0, this stream won't affect progress"),r}function Mu(e){this.g=!1,this.h=new ye,this.i=e}function Nu(e){var t=new Uu;e.periods.forEach((function(e,r){var n=Vu(e.variants);if(0==r)for(var i=(n=f(n.g)).next();!i.done;i=n.next())t.add(i.value);else!function(e,t){e.g=e.g.filter((function(e){return Gu(t,e)}))}(t,n)}));for(var r=(e=f(e.periods)).next();!r.done;r=e.next())(r=r.value).variants=r.variants.filter((function(e){return Gu(t,new Bu(e))}))}function Bu(e){var t=e.audio;e=e.video,this.h=t?t.mimeType:null,this.g=t?t.codecs.split(".")[0]:null,this.j=e?e.mimeType:null,this.i=e?e.codecs.split(".")[0]:null}function Uu(){this.g=[]}function Gu(e,t){return e.g.some((function(e){return t.h==e.h&&t.g==e.g&&t.j==e.j&&t.i==e.i}))}function Vu(e){for(var t=new Uu,r=(e=f(e)).next();!r.done;r=e.next())t.add(new Bu(r.value));return t}function Fu(e){var t=this;if(e&&e.constructor!=Us)throw new z(2,9,9008);this.h=this.g=null,e?(this.g=e.h,this.h=e.Yb()):(this.g=Rs(),this.h=new Ke),this.j=!1,this.i=[],this.l=[];var r=!e;this.m=new Mu((function(){return g((function e(){var n;return N(e,(function(e){switch(e.s){case 1:return n=function(){},w(e,Promise.all(t.l.map((function(e){return e.then(n,n)}))),2);case 2:if(!r){e.I(3);break}return w(e,t.h.destroy(),3);case 3:t.g=null,t.h=null,C(e)}}))}))}))}function ju(){if(pt())e:{for(var e=f(as.values()),t=e.next();!t.done;t=e.next())if(t=(t=t.value)()){t.destroy(),e=!0;break e}e=!1}else e=!1;return e}function Hu(e,t){for(var r=[],n=f(e.periods),i=n.next();!i.done;i=n.next())for(var a=(i=f(i.value.streams)).next();!a.done;a=i.next())a=a.value,t&&"video"==a.contentType?r.push({contentType:lt(a.mimeType,a.codecs),robustness:e.drmInfo.videoRobustness}):t||"audio"!=a.contentType||r.push({contentType:lt(a.mimeType,a.codecs),robustness:e.drmInfo.audioRobustness});return r}function Zu(e,t,r){return g((function n(){return N(n,(function(n){if(1===n.s)return w(n,function(e,t,r,n){return g((function i(){var a,o,s;return N(i,(function(i){switch(i.s){case 1:return n.drmInfo?(a=function(e){var t=Array.from(e.g.keys());if(!t.length)throw new z(2,9,9e3,"No supported storage mechanisms found");return e.g.get(t[0]).getEmeSessionCell()}(r),o=n.sessionIds.map((function(e){return{sessionId:e,keySystem:n.drmInfo.keySystem,licenseUri:n.drmInfo.licenseServerUri,serverCertificate:n.drmInfo.serverCertificate,audioCapabilities:Hu(n,!1),videoCapabilities:Hu(n,!0)}})),w(i,As(t,e,o),2)):i.return();case 2:return s=i.B,w(i,a.remove(s),3);case 3:return w(i,a.add(o.filter((function(e){return-1==s.indexOf(e.sessionId)}))),0)}}))}))}(e.h,e.g.drm,r,t),0)}))}))}function Wu(e,t,r,n){function i(){s+=1,e.g.offline.progressCallback(u,s/o)}var a=function(e){var t=[];return e.periods.forEach((function(e){e.streams.forEach((function(e){null!=e.initSegmentKey&&t.push(e.initSegmentKey),e.segments.forEach((function(e){t.push(e.dataKey)}))}))})),t}(n),o=a.length+1,s=0,u=xu(r,n);return Promise.all([t.removeSegments(a,i),t.removeManifests([r.key()],i)])}function Ku(e,t,r,n,i,a){var o={id:a.id,originalId:a.originalId,primary:a.primary,presentationTimeOffset:a.presentationTimeOffset||0,contentType:a.type,mimeType:a.mimeType,codecs:a.codecs,frameRate:a.frameRate,pixelAspectRatio:a.pixelAspectRatio,kind:a.kind,language:a.language,label:a.label,width:a.width||null,height:a.height||null,initSegmentKey:null,encrypted:a.encrypted,keyId:a.keyId,segments:[],variantIds:[]};i=i.presentationTimeline.$b();var s=a.id,u=a.initSegmentReference;return u&&(u=Ti(u.i(),u.h,u.g,e.g.streaming.retryParameters),Zo(t,s,u,.5*Lu(n,a.id),!0,(function(t){return g((function n(){var i;return N(n,(function(n){switch(n.s){case 1:return w(n,r.addSegments([{data:t}]),2);case 2:i=n.B,e.i.push(i[0]),o.initSegmentKey=i[0],C(n)}}))}))}))),function(e,t,r){for(var n=null==(t=e.findSegmentPosition(t))?null:e.getSegmentReference(t);n;)r(n),n=e.getSegmentReference(++t)}(a,i,(function(i){var u=Ti(i.i(),i.h,i.g,e.g.streaming.retryParameters);Zo(t,s,u,function(e,t,r){return r=r.endTime-r.startTime,Lu(e,t)*r}(n,a.id,i),!1,(function(t){return g((function n(){var a;return N(n,(function(n){switch(n.s){case 1:return w(n,r.addSegments([{data:t}]),2);case 2:a=n.B,e.i.push(a[0]),o.segments.push({startTime:i.startTime,endTime:i.endTime,dataKey:a[0]}),C(n)}}))}))}))})),o}function Xu(e){if(e.m.g)throw new z(2,9,7001)}function Yu(){if(!ju())throw new z(2,9,9e3)}function zu(e,t){return g((function r(){return N(r,(function(r){switch(r.s){case 1:return e.l.push(t),I(r,2),w(r,t,4);case 4:return r.return(r.B);case 2:x(r),je(e.l,t),R(r,0)}}))}))}function Ju(e){var t=new Set(e.variants.map((function(e){return e.video}))),r=new Set(e.variants.map((function(e){return e.audio})));e=e.textStreams,1<t.size&&Y.v("Multiple video tracks selected to be stored");for(var n=(t=f(r)).next();!n.done;n=t.next()){n=n.value;for(var i=f(r),a=i.next();!a.done;a=i.next())n!=(a=a.value)&&n.language==a.language&&Y.v("Similar audio tracks were selected to be stored",n.id,a.id)}for(t=(r=f(e)).next();!t.done;t=r.next())for(t=t.value,i=(n=f(e)).next();!i.done;i=n.next())t!=(i=i.value)&&t.language==i.language&&Y.v("Similar text tracks were selected to be stored",t.id,i.id)}Us.LoadMode={DESTROYED:ku,NOT_LOADED:Iu,MEDIA_SOURCE:$u,SRC_EQUALS:Pu},Mu.prototype.destroy=function(){var e=this;return this.g?this.h:(this.g=!0,this.i().then((function(){e.h.resolve()}),(function(){e.h.resolve()})))},Uu.prototype.add=function(e){Gu(this,e)||this.g.push(e)},j("shaka.offline.Storage",Fu),Fu.support=ju,Fu.prototype.destroy=function(){return this.m.destroy()},Fu.prototype.destroy=Fu.prototype.destroy,Fu.prototype.configure=function(e,t){2==arguments.length&&"string"==typeof e&&(e=Ps(e,t));var r=e,n=!1;return null!=r.trackSelectionCallback&&(n=!0,r.offline=r.offline||{},r.offline.trackSelectionCallback=r.trackSelectionCallback,delete r.trackSelectionCallback),null!=r.progressCallback&&(n=!0,r.offline=r.offline||{},r.offline.progressCallback=r.progressCallback,delete r.progressCallback),null!=r.usePersistentLicense&&(n=!0,r.offline=r.offline||{},r.offline.usePersistentLicense=r.usePersistentLicense,delete r.usePersistentLicense),n&&Hr("Storage.configure with OfflineConfig","Please configure storage with a player configuration."),Os(this.g,e)},Fu.prototype.configure=Fu.prototype.configure,Fu.prototype.getConfiguration=function(){var e=Rs();return Os(e,this.g,Rs()),e},Fu.prototype.getConfiguration=Fu.prototype.getConfiguration,Fu.prototype.Yb=function(){return this.h},Fu.prototype.getNetworkingEngine=Fu.prototype.Yb,Fu.prototype.store=function(e,t,r){var n=this;return zu(this,function(e,t,r,n){return g((function i(){var a,o,s,u,c,l,d,h,p;return N(i,(function(i){switch(i.s){case 1:return Yu(),e.j?i.return(Promise.reject(new z(2,9,9006))):(e.j=!0,w(i,function(e,t,r){return g((function n(){var i,a,o,s,u,c;return N(n,(function(n){switch(n.s){case 1:return i=null,a=e.h,o={networkingEngine:a,filterAllPeriods:function(){},filterNewPeriod:function(){},onTimelineRegionAdded:function(){},onEvent:function(){},onError:function(e){i=e}},w(n,r(),2);case 2:return(s=n.B).configure(e.g.manifest),Xu(e),I(n,3),w(n,s.start(t,o),5);case 5:return u=n.B,Xu(e),c=function(e){for(var t=new Set,r=(e=f(e.periods)).next();!r.done;r=e.next()){for(var n=f((r=r.value).textStreams),i=n.next();!i.done;i=n.next())t.add(i.value);for(n=(r=f(r.variants)).next();!n.done;n=r.next())(n=n.value).audio&&t.add(n.audio),n.video&&t.add(n.video)}return t}(u),w(n,Promise.all(ot(c,(function(e){return e.createSegmentIndex()}))),6);case 6:if(Xu(e),i)throw i;return n.return(u);case 3:return x(n),w(n,s.stop(),7);case 7:R(n,0)}}))}))}(e,t,n),2));case 2:if(a=i.B,Xu(e),a.presentationTimeline.aa()||a.presentationTimeline.ib())throw new z(2,9,9005,t);return o=null,s=new rs,c=u=null,k(i,3,4),w(i,function(e,t,r){return g((function n(){var i,a,o;return N(n,(function(n){switch(n.s){case 1:return i=new St({Ib:e.h,onError:r,Dc:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),a=Ga(t.periods),o=e.g,i.configure(o.drm),w(n,function(e,t,r){return e.F=[],e.L=r,wt(e,t)}(i,a,o.offline.usePersistentLicense),2);case 2:return w(n,Ct(i),3);case 3:return w(n,kt(i),4);case 4:return n.return(i)}}))}))}(e,a,(function(e){c=c||e})),6);case 6:if(o=i.B,Xu(e),c)throw c;return w(i,function(e,t,r){return g((function n(){var i,a;return N(n,(function(n){switch(n.s){case 1:return i={width:1/0,height:1/0},function(e,t,r){for(var n=(e=f(e.periods)).next();!n.done;n=e.next())(n=n.value).variants=n.variants.filter((function(e){return Gr.rd(e,t,r)}))}(t,e.g.restrictions,i),function(e){for(var t=(e=f(e.periods)).next();!t.done;t=e.next())(t=t.value).variants=t.variants.filter((function(e){var t=!0;return e.audio&&(t=t&&Er(e.audio)),e.video&&(t=t&&Er(e.video)),t}))}(t),function(e,t){for(var r=f(e.periods),n=r.next();!n.done;n=r.next())(n=n.value).variants=n.variants.filter((function(e){return Bt(t,e)}))}(t,r),Nu(t),a=e.g.preferredAudioChannelCount,Gr.$d(t,a),w(n,function(e,t){return g((function r(){var n,i,a,o;return N(r,(function(r){switch(r.s){case 1:n=null,i=f(e.periods),a=i.next();case 2:if(a.done){r.I(0);break}return o=a.value,n&&(o.variants=o.variants.filter((function(e){return Gu(n,new Bu(e))}))),w(r,t(o),5);case 5:n=Vu(o.variants),a=i.next(),r.I(2)}}))}))}(t,(function(t){return g((function r(){var n,i,a,o,s,u,c,l;return N(r,(function(r){switch(r.s){case 1:n=Gr,i=[];for(var d=f(t.variants),h=d.next();!h.done;h=d.next())a=h.value,i.push(n.Oc(a));for(h=(d=f(t.textStreams)).next();!h.done;h=d.next())o=h.value,i.push(n.Kc(o));return w(r,e.g.offline.trackSelectionCallback(i),2);case 2:for(s=r.B,u=new Set,c=new Set,h=(d=f(s)).next();!h.done;h=d.next())"variant"==(l=h.value).type&&u.add(l.id),"text"==l.type&&c.add(l.id);t.variants=t.variants.filter((function(e){return u.has(e.id)})),t.textStreams=t.textStreams.filter((function(e){return c.has(e.id)})),C(r)}}))}))})),2);case 2:(function(e){if(0==e.periods.length)throw new z(2,4,4014);for(var t=(e=f(e.periods)).next();!t.done;t=e.next())Ju(t.value)})(t),C(n)}}))}))}(e,a,o),7);case 7:return w(i,s.init(),8);case 8:return Xu(e),w(i,function(e){var t=null;if(e.g.forEach((function(e,r){e.getCells().forEach((function(e,n){e.hasFixedKeySpace()||t||(t={path:{Ea:r,ja:n},ja:e})}))})),t)return t;throw new z(2,9,9013,"Could not find a cell that supports add-operations")}(s),9);case 9:return u=i.B,Xu(e),w(i,function(e,t,r,n,i,a){return g((function o(){var s,u,c,l,d,h,p,y,m,v;return N(o,(function(o){switch(o.s){case 1:return s=function(e,t,r){var n=null==t.expiration?1/0:t.expiration;return{offlineUri:null,originalManifestUri:e,duration:t.presentationTimeline.ha(),size:0,expiration:n,tracks:t=Ru(t.periods[0]),appMetadata:r}}(i,n,a),u=n.periods.some((function(e){return e.variants.some((function(e){return e.drmInfos&&e.drmInfos.length}))})),c=n.periods.some((function(e){return e.variants.some((function(e){return e.drmInfos.some((function(e){return e.initData&&e.initData.length}))}))})),d=null,(l=u&&!c)&&(h=r.g,d=Qu.get(h.keySystem)),p=new Ho(e.h,(function(t,r){s.size=r,e.g.offline.progressCallback(s,t)}),(function(t,n){l&&e.g.offline.usePersistentLicense&&d==n&&It(r,"cenc",t)})),I(o,2),m=y=function(e,t,r,n,i,a,o){var s=new Ou,u=i.periods.map((function(n){return function(e,t,r,n,i,a){for(var o=f(a.variants),s=o.next();!s.done;s=o.next())Du(n,s.value);for(o=f(a.textStreams),s=o.next();!s.done;s=o.next())n.g[s.value.id]=52;o=function(e){for(var t=new Set,r=f(e.textStreams),n=r.next();!n.done;n=r.next())t.add(n.value);for(e=f(e.variants),r=e.next();!r.done;r=e.next())(r=r.value).audio&&t.add(r.audio),r.video&&t.add(r.video);return t}(a);var u=new Map;for(o=f(o),s=o.next();!s.done;s=o.next()){var c=Ku(e,t,r,n,i,s=s.value);u.set(s.id,c)}return a.variants.forEach((function(e){e.audio&&u.get(e.audio.id).variantIds.push(e.id),e.video&&u.get(e.video.id).variantIds.push(e.id)})),{startTime:a.startTime,streams:Array.from(u.values())}}(e,t,r,s,i,n)})),c=n.g,l=e.g.offline.usePersistentLicense;return c&&l&&(c.initData=[]),{originalManifestUri:a,duration:i.presentationTimeline.ha(),size:0,expiration:n.Xb(),periods:u,sessionIds:l?xt(n):[],drmInfo:c,appMetadata:o}}(e,p,t,r,n,i,a),w(o,function(e){return g((function t(){return N(t,(function(t){switch(t.s){case 1:return w(t,Promise.all(e.h.values()),2);case 2:return t.return(e.g.g)}}))}))}(p),4);case 4:if(m.size=o.B,y.expiration=r.Xb(),v=xt(r),y.sessionIds=e.g.offline.usePersistentLicense?v:[],u&&e.g.offline.usePersistentLicense&&!v.length)throw new z(2,9,9007);return o.return(y);case 2:return x(o),w(o,p.destroy(),5);case 5:R(o,0)}}))}))}(e,u.ja,o,a,t,r),10);case 10:if(l=i.B,Xu(e),c)throw c;return w(i,u.ja.addManifests([l]),11);case 11:return d=i.B,Xu(e),h=new fs("manifest",u.path.Ea,u.path.ja,d[0]),i.return(xu(h,l));case 4:return x(i),e.j=!1,e.i=[],w(i,s.destroy(),12);case 12:if(!o){i.I(13);break}return w(i,o.destroy(),13);case 13:R(i,0);break;case 3:if(p=P(i),!u){i.I(15);break}return w(i,u.ja.removeSegments(e.i,(function(){})),15);case 15:throw c||p}}))}))}(this,e,t||{},(function(){return g((function t(){var i,a;return N(t,(function(t){switch(t.s){case 1:return r&&"string"!=typeof r?(Hr("Storing with a manifest parser factory","Please register a manifest parser and for the mime-type."),i=r,t.return(new i)):w(t,Ei.create(e,n.h,n.g.manifest.retryParameters,r),2);case 2:return a=t.B,t.return(a)}}))}))})))},Fu.prototype.store=Fu.prototype.store,Fu.prototype.Hf=function(){return this.j},Fu.prototype.getStoreInProgress=Fu.prototype.Hf,Fu.prototype.remove=function(e){return zu(this,function(e,t){return g((function r(){var n,i,a,o,s,u;return N(r,(function(r){switch(r.s){case 1:return Yu(),null==(n=ps(t))||"manifest"!=n.g?r.return(Promise.reject(new z(2,9,9004,t))):(i=n,a=new rs,I(r,2),w(r,a.init(),4));case 4:return w(r,ns(a,i.Ea(),i.ja()),5);case 5:return w(r,(o=r.B).getManifests([i.key()]),6);case 6:return s=r.B,u=s[0],w(r,Promise.all([Zu(e,u,a),Wu(e,o,i,u)]),2);case 2:return x(r),w(r,a.destroy(),8);case 8:R(r,0)}}))}))}(this,e))},Fu.prototype.remove=Fu.prototype.remove,Fu.prototype.sg=function(){return zu(this,function(e){return g((function t(){var r,n,i,a,o,s,u,c,l;return N(t,(function(t){switch(t.s){case 1:return Yu(),r=e.h,n=e.g.drm,i=new rs,a=!1,I(t,2),w(t,i.init(),4);case 4:for(o=[],function(e,t){e.g.forEach((function(e){t(e.getEmeSessionCell())}))}(i,(function(e){return o.push(e)})),s=Promise.resolve(),u={},c=f(o),l=c.next();!l.done;u={Jc:u.Jc},l=c.next())u.Jc=l.value,s=s.then(function(e){return function(){return g((function t(){var i,o;return N(t,(function(t){switch(t.s){case 1:return w(t,e.Jc.getAll(),2);case 2:return i=t.B,w(t,As(n,r,i),3);case 3:return o=t.B,w(t,e.Jc.remove(o),4);case 4:o.length!=i.length&&(a=!0),C(t)}}))}))}}(u));return w(t,s,2);case 2:return x(t),w(t,i.destroy(),6);case 6:R(t,3);break;case 3:return t.return(!a)}}))}))}(this))},Fu.prototype.removeEmeSessions=Fu.prototype.sg,Fu.prototype.list=function(){return zu(this,g((function e(){var t,r,n;return N(e,(function(e){switch(e.s){case 1:return Yu(),t=[],r=new rs,I(e,2),w(e,r.init(),4);case 4:return n=Promise.resolve(),function(e,t){e.g.forEach((function(e,r){e.getCells().forEach((function(e,n){t({Ea:r,ja:n},e)}))}))}(r,(function(e,r){n=n.then((function(){return g((function n(){return N(n,(function(n){switch(n.s){case 1:return w(n,r.getAllManifests(),2);case 2:n.B.forEach((function(r,n){var i=xu(new fs("manifest",e.Ea,e.ja,n),r);t.push(i)})),C(n)}}))}))}))})),w(e,n,2);case 2:return x(e),w(e,r.destroy(),6);case 6:R(e,3);break;case 3:return e.return(t)}}))})))},Fu.prototype.list=Fu.prototype.list,Fu.deleteAll=function(){return g((function e(){var t;return N(e,(function(e){switch(e.s){case 1:return t=new rs,I(e,2),w(e,t.erase(),2);case 2:return x(e),w(e,t.destroy(),5);case 5:R(e,0)}}))}))};var Qu=(new Map).set("org.w3.clearkey","1077efecc0b24d02ace33c1e52e2fb4b").set("com.widevine.alpha","edef8ba979d64acea3c827dcd51d21ed").set("com.microsoft.playready","9a04f07998404286ab92e65be0885f95").set("com.adobe.primetime","f239e769efa348509c16a903c6932efb");Fs.offline=ju,j("shaka.polyfill.installAll",(function(){for(var e=0;e<tc.length;++e)try{tc[e].Xe()}catch(t){Y.ba("Error installing polyfill!",t)}}));var qu,ec,tc=[];function rc(e,t){for(var r={priority:t=t||0,Xe:e},n=0;n<tc.length;n++)if(tc[n].priority<t)return void tc.splice(n,0,r);tc.push(r)}function nc(e){var t=e.type.replace(/^(webkit|moz|MS)/,"").toLowerCase();if("function"==typeof Event)var r=new Event(t,e);else(r=document.createEvent("Event")).initEvent(t,e.bubbles,e.cancelable);e.target.dispatchEvent(r)}function ic(e,t,r){"input"==e&&"range"===this.type&&(e="change"),HTMLInputElement.prototype.originalAddEventListener.call(this,e,t,r)}function ac(){var e=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(t){for(var r=[],n=0;n<arguments.length;++n)r[n]=arguments[n];return(r=e.apply(this,r)).abort=function(){},r}}function oc(e,t){Y.debug("PatchedMediaKeysApple.requestMediaKeySystemAccess");try{var r=new sc(e,t);return Promise.resolve(r)}catch(n){return Promise.reject(n)}}function sc(e,t){if(Y.debug("PatchedMediaKeysApple.MediaKeySystemAccess"),this.keySystem=e,e.startsWith("com.apple.fps"))for(var r=f(t),n=r.next();!n.done;n=r.next()){var i=n.value;if("required"==i.persistentState)n=null;else{n={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:i.initDataTypes,sessionTypes:["temporary"],label:i.label};var a=!1,o=!1;if(i.audioCapabilities)for(var s=f(i.audioCapabilities),u=s.next();!u.done;u=s.next())if((u=u.value).contentType){a=!0;var c=u.contentType.split(";")[0];WebKitMediaKeys.isTypeSupported(this.keySystem,c)&&(n.audioCapabilities.push(u),o=!0)}if(i.videoCapabilities)for(u=(i=f(i.videoCapabilities)).next();!u.done;u=i.next())(s=u.value).contentType&&(a=!0,u=s.contentType.split(";")[0],WebKitMediaKeys.isTypeSupported(this.keySystem,u)&&(n.videoCapabilities.push(s),o=!0));a||(o=WebKitMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),n=o?n:null}if(n)return void(this.g=n)}throw(r=Error("Unsupported keySystem")).name="NotSupportedError",r.code=DOMException.NOT_SUPPORTED_ERR,r}function uc(e){Y.debug("PatchedMediaKeysApple.setMediaKeys");var t=this.mediaKeys;return t&&t!=e&&lc(t,null),delete this.mediaKeys,(this.mediaKeys=e)?lc(e,this):Promise.resolve()}function cc(e){Y.debug("PatchedMediaKeysApple.MediaKeys"),this.h=new WebKitMediaKeys(e),this.g=new tt}function lc(e,t){if(e.g.nb(),!t)return Promise.resolve();e.g.H(t,"webkitneedkey",hc);try{return Za(t,HTMLMediaElement.HAVE_METADATA,e.g,(function(){t.webkitSetMediaKeys(e.h)})),Promise.resolve()}catch(r){return Promise.reject(r)}}function dc(e){Y.debug("PatchedMediaKeysApple.MediaKeySession"),Ge.call(this),this.h=null,this.l=e,this.i=this.g=null,this.j=new tt,this.sessionId="",this.expiration=NaN,this.closed=new ye,this.keyStatuses=new pc}function hc(e){if(Y.debug("PatchedMediaKeysApple.onWebkitNeedKey_",e),e=new Uint8Array(e.initData),new DataView(e.buffer,e.byteOffset,e.byteLength).getUint32(0,!0)+4!=e.byteLength)throw new RangeError("Malformed FairPlay init data");e=be(e=ve(e.subarray(4),!0));var t=new Event("encrypted");t.initDataType="skd",t.initData=e,this.dispatchEvent(t)}function fc(e,t){var r=e.keyStatuses;r.size=null==t?0:1,r.g=t,e.dispatchEvent(new Be("keystatuseschange"))}function pc(){this.size=0,this.g=void 0}function gc(e,t){Y.debug("PatchedMediaKeysMs.requestMediaKeySystemAccess");try{var r=new yc(e,t);return Promise.resolve(r)}catch(n){return Promise.reject(n)}}function yc(e,t){Y.debug("PatchedMediaKeysMs.MediaKeySystemAccess"),this.keySystem=e;for(var r=!1,n=0;n<t.length;++n){var i=t[n],a={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:i.initDataTypes,sessionTypes:["temporary"],label:i.label},o=!1;if(i.audioCapabilities)for(var s=0;s<i.audioCapabilities.length;++s){var u=i.audioCapabilities[s];if(u.contentType){o=!0;var c=u.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,c)&&(a.audioCapabilities.push(u),r=!0)}}if(i.videoCapabilities)for(s=0;s<i.videoCapabilities.length;++s)(u=i.videoCapabilities[s]).contentType&&(o=!0,c=u.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,c)&&(a.videoCapabilities.push(u),r=!0));if(o||(r=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),"required"==i.persistentState&&(r=!1),r)return void(this.g=a)}throw(r=Error("Unsupported keySystem")).name="NotSupportedError",r.code=DOMException.NOT_SUPPORTED_ERR,r}function mc(e){Y.debug("PatchedMediaKeysMs.setMediaKeys");var t=this.mediaKeys;return t&&t!=e&&_c(t,null),delete this.mediaKeys,(this.mediaKeys=e)?_c(e,this):Promise.resolve()}function vc(e){Y.debug("PatchedMediaKeysMs.MediaKeys"),this.h=new MSMediaKeys(e),this.g=new tt}function _c(e,t){if(e.g.nb(),!t)return Promise.resolve();e.g.H(t,"msneedkey",Ac);try{return Za(t,HTMLMediaElement.HAVE_METADATA,e.g,(function(){t.msSetMediaKeys(e.h)})),Promise.resolve()}catch(r){return Promise.reject(r)}}function bc(e){Y.debug("PatchedMediaKeysMs.MediaKeySession"),Ge.call(this),this.i=null,this.l=e,this.h=this.g=null,this.j=new tt,this.sessionId="",this.expiration=NaN,this.closed=new ye,this.keyStatuses=new Sc}function Ac(e){if(Y.debug("PatchedMediaKeysMs.onMsNeedKey_",e),e.initData){var t=document.createEvent("CustomEvent");t.initCustomEvent("encrypted",!1,!1,null),t.initDataType="cenc",t.initData=function(e){if(!e)return e;var t=new Zn(e);if(1>=t.data.length)return e;e=[];for(var r={},n=(t=f(t.data)).next();!n.done;r={yc:r.yc},n=t.next())r.yc=n.value,e.some(function(e){return function(t){return Te.Ha(t,e.yc)}}(r))||e.push(r.yc);return Te.concat.apply(Te,e instanceof Array?e:function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}(f(e)))}(e.initData).buffer,this.dispatchEvent(t)}}function Ec(e,t){var r=e.keyStatuses;r.size=null==t?0:1,r.g=t,e.dispatchEvent(new Be("keystatuseschange"))}function Sc(){this.size=0,this.g=void 0}function Tc(){return Y.debug("PatchedMediaKeysNop.requestMediaKeySystemAccess"),Promise.reject(Error("The key system specified is not supported."))}function wc(e){return Y.debug("PatchedMediaKeysNop.setMediaKeys"),null==e?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function Cc(){throw new TypeError("Illegal constructor.")}function kc(){throw new TypeError("Illegal constructor.")}j("shaka.polyfill.register",rc),rc((function(){Vl()}),-1),rc((function(){if(t.Document){var e=Element.prototype;e.requestFullscreen=e.requestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.webkitRequestFullscreen,(e=Document.prototype).exitFullscreen=e.exitFullscreen||e.mozCancelFullScreen||e.msExitFullscreen||e.webkitCancelFullScreen,"fullscreenElement"in document||(Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement||document.webkitFullscreenElement}}),Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled}})),document.addEventListener("webkitfullscreenchange",nc),document.addEventListener("webkitfullscreenerror",nc),document.addEventListener("mozfullscreenchange",nc),document.addEventListener("mozfullscreenerror",nc),document.addEventListener("MSFullscreenChange",nc),document.addEventListener("MSFullscreenError",nc)}})),rc((function(){Y.debug("InputEvent.install"),_t("Trident/")&&!HTMLInputElement.prototype.originalAddEventListener&&(Y.info("Patching input event support on IE."),HTMLInputElement.prototype.originalAddEventListener=HTMLInputElement.prototype.addEventListener,HTMLInputElement.prototype.addEventListener=ic)})),rc((function(){navigator.languages||Object.defineProperty(navigator,"languages",{get:function(){return navigator.language?[navigator.language]:["en"]}})})),rc((function(){Y.debug("mathRound.install")})),rc((function(){Y.debug("MediaSource.install");var e=vt();t.MediaSource?t.cast&&cast.__platform__&&cast.__platform__.canDisplayType?(Y.info("Patching Chromecast MSE bugs."),function(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(t){var r=t.split(/ *; */);return r.shift(),r.some((function(e){return e.startsWith("codecs=")}))?cast.__platform__.canDisplayType(t):e(t)}}()):e?(function(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(t){return"mp2t"!=t.split(/ *; */)[0].split("/")[1].toLowerCase()&&e(t)}}(),12>=e?(Y.info("Patching Safari 11 & 12 MSE bugs."),ac(),function(){var e=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(t,r){return e.call(this,t,r-.001)}}()):(Y.info("Patching Safari 13 MSE bugs."),ac())):_t("Tizen 2")||_t("Tizen 3")||_t("Tizen 4")?function(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(t){return"opus"!=ht(t)[0]&&e(t)}}():Y.info("Using native MSE as-is."):Y.info("No MSE implementation available.")})),sc.prototype.createMediaKeys=function(){Y.debug("PatchedMediaKeysApple.MediaKeySystemAccess.createMediaKeys");var e=new cc(this.keySystem);return Promise.resolve(e)},sc.prototype.getConfiguration=function(){return Y.debug("PatchedMediaKeysApple.MediaKeySystemAccess.getConfiguration"),this.g},cc.prototype.createSession=function(e){if(Y.debug("PatchedMediaKeysApple.MediaKeys.createSession"),"temporary"!=(e=e||"temporary"))throw new TypeError("Session type "+e+" is unsupported on this platform.");return new dc(this.h)},cc.prototype.setServerCertificate=function(e){return Y.debug("PatchedMediaKeysApple.MediaKeys.setServerCertificate"),Promise.resolve(!0)},H(dc,Ge),(i=dc.prototype).generateRequest=function(e,t){Y.debug("PatchedMediaKeysApple.MediaKeySession.generateRequest"),this.g=new ye;try{this.h=this.l.createSession("video/mp4",new Uint8Array(t)),this.sessionId=this.h.sessionId||"",this.j.H(this.h,"webkitkeymessage",this.Gg.bind(this)),this.j.H(this.h,"webkitkeyadded",this.Eg.bind(this)),this.j.H(this.h,"webkitkeyerror",this.Fg.bind(this)),fc(this,"status-pending")}catch(r){this.g.reject(r)}return this.g},i.load=function(){return Y.debug("PatchedMediaKeysApple.MediaKeySession.load"),Promise.reject(Error("MediaKeySession.load not yet supported"))},i.update=function(e){Y.debug("PatchedMediaKeysApple.MediaKeySession.update"),this.i=new ye;try{this.h.update(new Uint8Array(e))}catch(t){this.i.reject(t)}return this.i},i.close=function(){Y.debug("PatchedMediaKeysApple.MediaKeySession.close");try{this.h.close(),this.closed.resolve(),this.j.nb()}catch(u){this.closed.reject(u)}return this.closed},i.remove=function(){return Y.debug("PatchedMediaKeysApple.MediaKeySession.remove"),Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},i.Gg=function(e){Y.debug("PatchedMediaKeysApple.onWebkitKeyMessage_",e),this.g&&(this.g.resolve(),this.g=null),this.dispatchEvent(new Be("message",{messageType:null==this.keyStatuses.g?"license-request":"license-renewal",message:e.message.buffer}))},i.Eg=function(e){Y.debug("PatchedMediaKeysApple.onWebkitKeyAdded_",e),this.i&&(fc(this,"usable"),this.i.resolve(),this.i=null)},i.Fg=function(e){if(Y.debug("PatchedMediaKeysApple.onWebkitKeyError_",e),(e=Error("EME PatchedMediaKeysApple key error")).errorCode=this.h.error,null!=this.g)this.g.reject(e),this.g=null;else if(null!=this.i)this.i.reject(e),this.i=null;else switch(this.h.error.code){case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:fc(this,"output-not-allowed");break;default:fc(this,"internal-error")}},(i=pc.prototype).forEach=function(e){this.g&&e(this.g,qu)},i.get=function(e){if(this.has(e))return this.g},i.has=function(e){var t=qu;return!(!this.g||!Te.Ha(new Uint8Array(e),new Uint8Array(t)))},i.entries=function(){},i.keys=function(){},i.values=function(){},rc((function(){t.HTMLVideoElement&&t.WebKitMediaKeys&&(Y.info("Using Apple-prefixed EME"),qu=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=uc,t.MediaKeys=cc,t.MediaKeySystemAccess=sc,navigator.requestMediaKeySystemAccess=oc)})),yc.prototype.createMediaKeys=function(){Y.debug("PatchedMediaKeysMs.MediaKeySystemAccess.createMediaKeys");var e=new vc(this.keySystem);return Promise.resolve(e)},yc.prototype.getConfiguration=function(){return Y.debug("PatchedMediaKeysMs.MediaKeySystemAccess.getConfiguration"),this.g},vc.prototype.createSession=function(e){if(Y.debug("PatchedMediaKeysMs.MediaKeys.createSession"),"temporary"!=(e=e||"temporary"))throw new TypeError("Session type "+e+" is unsupported on this platform.");return new bc(this.h)},vc.prototype.setServerCertificate=function(){return Y.debug("PatchedMediaKeysMs.MediaKeys.setServerCertificate"),Promise.resolve(!1)},H(bc,Ge),(i=bc.prototype).generateRequest=function(e,t){Y.debug("PatchedMediaKeysMs.MediaKeySession.generateRequest"),this.g=new ye;try{this.i=this.l.createSession("video/mp4",new Uint8Array(t),null),this.j.H(this.i,"mskeymessage",this.dg.bind(this)),this.j.H(this.i,"mskeyadded",this.bg.bind(this)),this.j.H(this.i,"mskeyerror",this.cg.bind(this)),Ec(this,"status-pending")}catch(r){this.g.reject(r)}return this.g},i.load=function(){return Y.debug("PatchedMediaKeysMs.MediaKeySession.load"),Promise.reject(Error("MediaKeySession.load not yet supported"))},i.update=function(e){Y.debug("PatchedMediaKeysMs.MediaKeySession.update"),this.h=new ye;try{this.i.update(new Uint8Array(e))}catch(t){this.h.reject(t)}return this.h},i.close=function(){Y.debug("PatchedMediaKeysMs.MediaKeySession.close");try{this.i.close(),this.closed.resolve(),this.j.nb()}catch(u){this.closed.reject(u)}return this.closed},i.remove=function(){return Y.debug("PatchedMediaKeysMs.MediaKeySession.remove"),Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},i.dg=function(e){Y.debug("PatchedMediaKeysMs.onMsKeyMessage_",e),this.g&&(this.g.resolve(),this.g=null),this.dispatchEvent(new Be("message",{messageType:null==this.keyStatuses.g?"license-request":"license-renewal",message:e.message.buffer}))},i.bg=function(e){Y.debug("PatchedMediaKeysMs.onMsKeyAdded_",e),this.g?(Y.debug("Simulating completion for a PR persistent license."),Ec(this,"usable"),this.g.resolve(),this.g=null):this.h&&(Ec(this,"usable"),this.h.resolve(),this.h=null)},i.cg=function(e){if(Y.debug("PatchedMediaKeysMs.onMsKeyError_",e),(e=Error("EME PatchedMediaKeysMs key error")).errorCode=this.i.error,null!=this.g)this.g.reject(e),this.g=null;else if(null!=this.h)this.h.reject(e),this.h=null;else switch(this.i.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:Ec(this,"output-not-allowed");break;default:Ec(this,"internal-error")}},(i=Sc.prototype).forEach=function(e){this.g&&e(this.g,ec)},i.get=function(e){if(this.has(e))return this.g},i.has=function(e){var t=ec;return!(!this.g||!Te.Ha(new Uint8Array(e),new Uint8Array(t)))},i.entries=function(){},i.keys=function(){},i.values=function(){},rc((function(){!t.HTMLVideoElement||!t.MSMediaKeys||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(Y.info("Using ms-prefixed EME v20140218"),ec=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=mc,t.MediaKeys=vc,t.MediaKeySystemAccess=yc,navigator.requestMediaKeySystemAccess=gc)})),Cc.prototype.createSession=function(){},Cc.prototype.setServerCertificate=function(){},kc.prototype.getConfiguration=function(){},kc.prototype.createMediaKeys=function(){},rc((function(){!t.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(Y.info("EME not available."),navigator.requestMediaKeySystemAccess=Tc,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=wc,t.MediaKeys=Cc,t.MediaKeySystemAccess=kc)}),-10);var Ic,$c="";function Pc(e){return $c?$c+e.charAt(0).toUpperCase()+e.slice(1):e}function xc(e,t){Y.debug("PatchedMediaKeysWebkit.requestMediaKeySystemAccess");try{var r=new Oc(e,t);return Promise.resolve(r)}catch(n){return Promise.reject(n)}}function Rc(e){Y.debug("PatchedMediaKeysWebkit.setMediaKeys");var t=this.mediaKeys;return t&&t!=e&&Lc(t,null),delete this.mediaKeys,(this.mediaKeys=e)&&Lc(e,this),Promise.resolve()}function Oc(e,t){Y.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess"),this.g=this.keySystem=e;var r=!1;"org.w3.clearkey"==e&&(this.g="webkit-org.w3.clearkey",r=!1);var n=!1,i=document.getElementsByTagName("video");i=i.length?i[0]:document.createElement("video");for(var a=0;a<t.length;++a){var o=t[a],s={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:o.initDataTypes,sessionTypes:["temporary"],label:o.label},u=!1;if(o.audioCapabilities)for(var c=0;c<o.audioCapabilities.length;++c){var l=o.audioCapabilities[c];if(l.contentType){u=!0;var d=l.contentType.split(";")[0];i.canPlayType(d,this.g)&&(s.audioCapabilities.push(l),n=!0)}}if(o.videoCapabilities)for(c=0;c<o.videoCapabilities.length;++c)(l=o.videoCapabilities[c]).contentType&&(u=!0,i.canPlayType(l.contentType,this.g)&&(s.videoCapabilities.push(l),n=!0));if(u||(n=i.canPlayType("video/mp4",this.g)||i.canPlayType("video/webm",this.g)),"required"==o.persistentState&&(r?(s.persistentState="required",s.sessionTypes=["persistent-license"]):n=!1),n)return void(this.h=s)}throw r="Unsupported keySystem","org.w3.clearkey"!=e&&"com.widevine.alpha"!=e||(r="None of the requested configurations were supported."),(r=Error(r)).name="NotSupportedError",r.code=DOMException.NOT_SUPPORTED_ERR,r}function Dc(e){Y.debug("PatchedMediaKeysWebkit.MediaKeys"),this.l=e,this.h=null,this.g=new tt,this.i=[],this.j={}}function Lc(e,t){e.h=t,e.g.nb();var r=$c;t&&(e.g.H(t,r+"needkey",e.hg.bind(e)),e.g.H(t,r+"keymessage",e.Jg.bind(e)),e.g.H(t,r+"keyadded",e.Hg.bind(e)),e.g.H(t,r+"keyerror",e.Ig.bind(e)))}function Mc(e,t){var r=e.j[t];return r?(Y.debug("PatchedMediaKeysWebkit.MediaKeys.findSession_",r),r):(r=e.i.shift())?(r.sessionId=t,e.j[t]=r,Y.debug("PatchedMediaKeysWebkit.MediaKeys.findSession_",r),r):null}function Nc(e,t,r){Y.debug("PatchedMediaKeysWebkit.MediaKeySession"),Ge.call(this),this.j=e,this.m=!1,this.g=this.h=null,this.i=t,this.l=r,this.sessionId="",this.expiration=NaN,this.closed=new ye,this.keyStatuses=new Gc}function Bc(e,t,r){if(e.m)return Promise.reject(Error("The session is already initialized."));e.m=!0;try{if("persistent-license"==e.l)if(r)var n=new Uint8Array(be("LOAD_SESSION|"+r));else{var i=be("PERSISTENT|"),a=new Uint8Array(i.byteLength+t.byteLength);a.set(new Uint8Array(i),0),a.set(new Uint8Array(t),i.byteLength),n=a}else n=new Uint8Array(t)}catch(s){return Promise.reject(s)}e.h=new ye;var o=Pc("generateKeyRequest");try{e.j[o](e.i,n)}catch(s){if("InvalidStateError"!=s.name)return e.h=null,Promise.reject(s);new $e((function(){try{e.j[o](e.i,n)}catch(t){e.h.reject(t),e.h=null}})).V(.01)}return e.h}function Uc(e,t){var r=e.keyStatuses;r.size=null==t?0:1,r.g=t,e.dispatchEvent(new Be("keystatuseschange"))}function Gc(){this.size=0,this.g=void 0}function Vc(e){if("picture-in-picture"==(e=e.target).webkitPresentationMode){document.pictureInPictureElement=e;var t=new Event("enterpictureinpicture");e.dispatchEvent(t)}else document.pictureInPictureElement==e&&(document.pictureInPictureElement=null),t=new Event("leavepictureinpicture"),e.dispatchEvent(t)}function Fc(){return this.webkitSupportsPresentationMode("picture-in-picture")?(this.webkitSetPresentationMode("picture-in-picture"),document.pictureInPictureElement=this,Promise.resolve()):Promise.reject(Error("PiP not allowed by video element"))}function jc(){var e=document.pictureInPictureElement;return e?(e.webkitSetPresentationMode("inline"),document.pictureInPictureElement=null,Promise.resolve()):Promise.reject(Error("No picture in picture element found"))}function Hc(){return!!this.hasAttribute("disablePictureInPicture")||!this.webkitSupportsPresentationMode("picture-in-picture")}function Zc(e){e?this.setAttribute("disablePictureInPicture",""):this.removeAttribute("disablePictureInPicture")}function Wc(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}}function Kc(e,r,n){return new t.TextTrackCue(e,r,n)}function Xc(e,r,n){return new t.TextTrackCue(e+"-"+r+"-"+n,e,r,n)}function Yc(){}Oc.prototype.createMediaKeys=function(){Y.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess.createMediaKeys");var e=new Dc(this.g);return Promise.resolve(e)},Oc.prototype.getConfiguration=function(){return Y.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess.getConfiguration"),this.h},(i=Dc.prototype).createSession=function(e){if(Y.debug("PatchedMediaKeysWebkit.MediaKeys.createSession"),"temporary"!=(e=e||"temporary")&&"persistent-license"!=e)throw new TypeError("Session type "+e+" is unsupported on this platform.");var t=this.h||document.createElement("video");return t.src||(t.src="about:blank"),e=new Nc(t,this.l,e),this.i.push(e),e},i.setServerCertificate=function(){return Y.debug("PatchedMediaKeysWebkit.MediaKeys.setServerCertificate"),Promise.resolve(!1)},i.hg=function(e){Y.debug("PatchedMediaKeysWebkit.onWebkitNeedKey_",e);var t=document.createEvent("CustomEvent");t.initCustomEvent("encrypted",!1,!1,null),t.initDataType="cenc",e.initData instanceof ArrayBuffer?t.initData=e.initData:t.initData=e.initData.buffer,this.h.dispatchEvent(t)},i.Jg=function(e){Y.debug("PatchedMediaKeysWebkit.onWebkitKeyMessage_",e);var t=Mc(this,e.sessionId);t?(e=new Be("message",{messageType:null==t.keyStatuses.g?"licenserequest":"licenserenewal",message:e.message}),Y.debug("PatchedMediaKeysWebkit.MediaKeySession.generated"),t.h&&(t.h.resolve(),t.h=null),t.dispatchEvent(e)):Y.error("Session not found",e.sessionId)},i.Hg=function(e){Y.debug("PatchedMediaKeysWebkit.onWebkitKeyAdded_",e),(e=Mc(this,e.sessionId))&&(Y.debug("PatchedMediaKeysWebkit.MediaKeySession.ready"),Uc(e,"usable"),e.g&&e.g.resolve(),e.g=null)},i.Ig=function(e){Y.debug("PatchedMediaKeysWebkit.onWebkitKeyError_",e);var t=Mc(this,e.sessionId);t&&t.handleError(e)},H(Nc,Ge),(i=Nc.prototype).handleError=function(e){Y.debug("PatchedMediaKeysWebkit.MediaKeySession.handleError",e);var t=Error("EME v0.1b key error"),r=e.errorCode;r.systemCode=e.systemCode,t.errorCode=r,!e.sessionId&&this.h?(45==e.systemCode&&(t.message="Unsupported session type."),this.h.reject(t),this.h=null):e.sessionId&&this.g?(this.g.reject(t),this.g=null):(t=e.systemCode,e.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?Uc(this,"output-restricted"):Uc(this,1==t?"expired":"internal-error"))},i.Qd=function(e,t){if(this.g)this.g.then(this.Qd.bind(this,e,t)).catch(this.Qd.bind(this,e,t));else{if(this.g=e,"webkit-org.w3.clearkey"==this.i){var r=me(t),n=JSON.parse(r);"oct"!=n.keys[0].kty&&(this.g.reject(Error("Response is not a valid JSON Web Key Set.")),this.g=null),r=Te.Ja(n.keys[0].k),n=Te.Ja(n.keys[0].kid)}else r=new Uint8Array(t),n=null;var i=Pc("addKey");try{this.j[i](this.i,r,n,this.sessionId)}catch(a){this.g.reject(a),this.g=null}}},i.generateRequest=function(e,t){return Y.debug("PatchedMediaKeysWebkit.MediaKeySession.generateRequest"),Bc(this,t,null)},i.load=function(e){return Y.debug("PatchedMediaKeysWebkit.MediaKeySession.load"),"persistent-license"==this.l?Bc(this,null,e):Promise.reject(Error("Not a persistent session."))},i.update=function(e){Y.debug("PatchedMediaKeysWebkit.MediaKeySession.update",e);var t=new ye;return this.Qd(t,e),t},i.close=function(){if(Y.debug("PatchedMediaKeysWebkit.MediaKeySession.close"),"persistent-license"!=this.l){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;var e=Pc("cancelKeyRequest");try{this.j[e](this.i,this.sessionId)}catch(t){}}return this.closed.resolve(),this.closed},i.remove=function(){return Y.debug("PatchedMediaKeysWebkit.MediaKeySession.remove"),"persistent-license"!=this.l?Promise.reject(Error("Not a persistent session.")):this.close()},(i=Gc.prototype).forEach=function(e){this.g&&e(this.g,Ic)},i.get=function(e){if(this.has(e))return this.g},i.has=function(e){var t=Ic;return!(!this.g||!Te.Ha(new Uint8Array(e),new Uint8Array(t)))},i.entries=function(){},i.keys=function(){},i.values=function(){},rc((function(){if(!(!t.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)Y.info("Using webkit-prefixed EME v0.1b"),$c="webkit";else{if(!HTMLMediaElement.prototype.generateKeyRequest)return;Y.info("Using nonprefixed EME v0.1b")}Ic=new Uint8Array([0]).buffer,navigator.requestMediaKeySystemAccess=xc,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Rc,t.MediaKeys=Dc,t.MediaKeySystemAccess=Oc}})),rc((function(){if(t.HTMLVideoElement){var e=HTMLVideoElement.prototype;e.requestPictureInPicture&&document.exitPictureInPicture||!e.webkitSupportsPresentationMode||(Y.debug("PiPWebkit.install"),document.pictureInPictureEnabled=!0,document.pictureInPictureElement=null,e.requestPictureInPicture=Fc,Object.defineProperty(e,"disablePictureInPicture",{get:Hc,set:Zc,enumerable:!0,configurable:!0}),document.exitPictureInPicture=jc,document.addEventListener("webkitpresentationmodechanged",Vc,!0))}})),rc((function(){if(Y.debug("VideoPlayPromise.install"),t.HTMLMediaElement){var e=HTMLMediaElement.prototype.play;HTMLMediaElement.prototype.play=function(){var t=e.apply(this);return t&&t.catch((function(){})),t}}})),rc((function(){if(t.HTMLVideoElement){var e=HTMLVideoElement.prototype;!e.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in e&&(e.getVideoPlaybackQuality=Wc)}})),rc((function(){if(t.VTTCue)Y.info("Using native VTTCue.");else if(t.TextTrackCue){var e=TextTrackCue.length;if(3==e)Y.info("Using VTTCue polyfill from 3 argument TextTrackCue."),t.VTTCue=Kc;else if(6==e)Y.info("Using VTTCue polyfill from 6 argument TextTrackCue."),t.VTTCue=Xc;else{try{var r=!!Kc(1,2,"")}catch(n){r=!1}r&&(Y.info("Using VTTCue polyfill from 3 argument TextTrackCue."),t.VTTCue=Kc)}}else Y.error("VTTCue not available.")})),j("shaka.text.TtmlTextParser",Yc),Yc.prototype.parseInit=function(){},Yc.prototype.parseInit=Yc.prototype.parseInit,Yc.prototype.parseMedia=function(e,t){var r=me(e),n=[],i=new DOMParser,a=null;if(""==r)return n;try{a=i.parseFromString(r,"text/xml")}catch(b){throw new z(2,2,2005,"Failed to parse TTML.")}if(a){if(r=a.getElementsByTagName("parsererror")[0])throw new z(2,2,2005,r.textContent);if(!(i=a.getElementsByTagName("tt")[0]))throw new z(2,2,2005,"TTML does not contain <tt> tag.");var o=Wn.getAttributeNS(i,"http://www.w3.org/ns/ttml#parameter","frameRate"),s=Wn.getAttributeNS(i,"http://www.w3.org/ns/ttml#parameter","subFrameRate"),u=Wn.getAttributeNS(i,"http://www.w3.org/ns/ttml#parameter","frameRateMultiplier"),c=Wn.getAttributeNS(i,"http://www.w3.org/ns/ttml#parameter","tickRate");if(a=i.getAttribute("xml:space")||"default",r=Wn.getAttributeNS(i,"http://www.w3.org/ns/ttml#styling","extent"),"default"!=a&&"preserve"!=a)throw new z(2,2,2005,"Invalid xml:space value: "+a);a="default"==a,o=new Al(o,s,u,c),s=cl(i.getElementsByTagName("metadata")[0]),u=cl(i.getElementsByTagName("styling")[0]),c=cl(i.getElementsByTagName("layout")[0]);for(var l=[],d=0;d<c.length;d++){var h,p,g=c[d],y=u,m=r,v=new hr,_=g.getAttribute("xml:id");_?(v.id=_,_=null,m&&(_=Qc.exec(m)||el.exec(m)),m=_?Number(_[1]):null,_=_?Number(_[2]):null,(h=gl(g,y,"extent"))&&null!=(h=(p=Qc.exec(h))||el.exec(h))&&(v.width=null!=m?100*Number(h[1])/m:Number(h[1]),v.height=null!=_?100*Number(h[2])/_:Number(h[2]),v.widthUnits=p||null!=m?fr:0,v.heightUnits=p||null!=_?fr:0),(g=gl(g,y,"origin"))&&null!=(h=(p=Qc.exec(g))||el.exec(g))&&(v.viewportAnchorX=null!=m?100*Number(h[1])/m:Number(h[1]),v.viewportAnchorY=null!=_?100*Number(h[2])/_:Number(h[2]),v.viewportAnchorUnits=p||null!=m?fr:0)):(Y.v("TtmlTextParser parser encountered a region with no id. Region will be ignored."),v=null),v&&l.push(v)}for(r=ll(i.getElementsByTagName("body")[0]),i=(r=f(r)).next();!i.done;i=r.next())(i=hl(i.value,t.periodStart,o,s,u,c,l,a,!1))&&n.push(i)}return n},Yc.prototype.parseMedia=Yc.prototype.parseMedia;var zc,Jc,Qc=/^(\d{1,2}(?:\.\d+)?|100(?:\.0+)?)% (\d{1,2}(?:\.\d+)?|100(?:\.0+)?)%$/,qc=/^(\d+px|\d+em)$/,el=/^(\d+)px (\d+)px$/,tl=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,rl=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,nl=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,il=/^(\d*(?:\.\d*)?)f$/,al=/^(\d*(?:\.\d*)?)t$/,ol=/^(?:(\d*(?:\.\d*)?)h)?(?:(\d*(?:\.\d*)?)m)?(?:(\d*(?:\.\d*)?)s)?(?:(\d*(?:\.\d*)?)ms)?$/,sl={left:sr,center:"center",right:"end",start:sr,end:"end"},ul={left:"line-left",center:"center",right:"line-right"};function cl(e){var t=[];if(!e)return t;for(var r=f(e.childNodes),n=r.next();!n.done;n=r.next())(n=n.value).nodeType==Node.ELEMENT_NODE&&"br"!==n.nodeName&&(n=cl(n),t=t.concat(n));return t.length||t.push(e),t}function ll(e){if(!e)return[];for(var t=[],r=(e=f(e.childNodes)).next();!r.done;r=e.next())(r=r.value)instanceof Element&&(r.hasAttribute("begin")?t.push(r):t=t.concat(ll(r)));return t}function dl(e,t){for(var r="",n=f(e.childNodes),i=n.next();!i.done;i=n.next())"br"==(i=i.value).nodeName&&e.childNodes[0]!==i?r+="\n":i.childNodes&&0<i.childNodes.length?r+=dl(i,t):r+=t?i=(i=i.textContent.trim()).replace(/\s+/g," "):i.textContent;return r}function hl(e,t,r,n,i,a,o,s,u){if(u&&"br"==e.nodeName)return(e=new Qt(0,0,"")).spacer=!0,e;var c=/^[\s\n]*$/.test(e.textContent),l=e.nodeType==Node.ELEMENT_NODE&&!e.hasAttribute("begin")&&!e.hasAttribute("end");if(e.nodeType!=Node.ELEMENT_NODE||l&&c||l&&!u)return null;s="default"==(e.getAttribute("xml:space")||(s?"default":"preserve")),c=_l(e.getAttribute("begin"),r),l=_l(e.getAttribute("end"),r);var d=_l(e.getAttribute("dur"),r);if(null==l&&null!=d&&(l=c+d),!u&&(null==c||null==l))throw new z(2,2,2001);if(c=u&&null==c?0:c+t,l=u&&null==l?0:l+t,d="",u=[],Array.from(e.childNodes).find((function(e){return e.nodeType===Node.TEXT_NODE&&/\S+/.test(e.textContent)})))d=dl(e,s);else for(var h=f(e.childNodes),p=h.next();!p.done;p=h.next())(p=hl(p.value,t,r,n,i,a,o,s,!0))&&(p.startTime=p.startTime||c,p.endTime=p.endTime||l,u.push(p));if((t=new Qt(c,l,d)).nestedCues=u,(a=vl(e,"region",a,"")[0])&&a.getAttribute("xml:id")){var g=a.getAttribute("xml:id");t.region=o.filter((function(e){return e.id==g}))[0]}return function(e,t,r,n,i){"rtl"==pl(t,r,i,"direction")&&(e.direction="rtl");var a=pl(t,r,i,"writingMode");if("tb"==a||"tblr"==a?e.writingMode="vertical-lr":"tbrl"==a?e.writingMode="vertical-rl":"rltb"==a||"rl"==a?e.direction="rtl":a&&(e.direction=ir),(a=pl(t,r,i,"textAlign"))?(e.positionAlign=ul[a],e.lineAlign=sl[a],e.textAlign=tr[a.toUpperCase()]):e.textAlign="start",(a=pl(t,r,i,"displayAlign"))&&(e.displayAlign=nr[a.toUpperCase()]),(a=pl(t,r,i,"color"))&&(e.color=a),(a=pl(t,r,i,"backgroundColor"))&&(e.backgroundColor=a),(a=pl(t,r,i,"fontFamily"))&&(e.fontFamily=a),(a=pl(t,r,i,"fontWeight"))&&"bold"==a&&(e.fontWeight=700),(a=pl(t,r,i,"wrapOption"))&&"noWrap"==a&&(e.wrapLine=!1),(a=pl(t,r,i,"lineHeight"))&&a.match(qc)&&(e.lineHeight=a),(a=pl(t,r,i,"fontSize"))&&a.match(qc)&&(e.fontSize=a),(a=pl(t,r,i,"fontStyle"))&&(e.fontStyle=dr[a.toUpperCase()]),n){a=n.getAttribute("imageType")||n.getAttribute("imagetype");var o=n.getAttribute("encoding");n=n.textContent.trim(),"PNG"==a&&"Base64"==o&&n&&(e.backgroundImage="data:image/png;base64,"+n)}(r=gl(r,i,"textDecoration"))&&fl(e,r),(t=yl(t,i,"textDecoration"))&&fl(e,t)}(t,e,a,n=vl(e,"backgroundImage",n,"#","http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt")[0],i),t}function fl(e,t){for(var r=t.split(" "),n=0;n<r.length;n++)switch(r[n]){case"underline":e.textDecoration.includes("underline")||e.textDecoration.push("underline");break;case"noUnderline":e.textDecoration.includes("underline")&&je(e.textDecoration,"underline");break;case"lineThrough":e.textDecoration.includes("lineThrough")||e.textDecoration.push("lineThrough");break;case"noLineThrough":e.textDecoration.includes("lineThrough")&&je(e.textDecoration,"lineThrough");break;case"overline":e.textDecoration.includes("overline")||e.textDecoration.push("overline");break;case"noOverline":e.textDecoration.includes("overline")&&je(e.textDecoration,"overline")}}function pl(e,t,r,n){return(e=yl(e,r,n))?e:gl(t,r,n)}function gl(e,t,r){if(!e)return null;for(var n=cl(e),i=0;i<n.length;i++){var a=Wn.getAttributeNS(n[i],"http://www.w3.org/ns/ttml#styling",r);if(a)return a}return ml(e,t,r)}function yl(e,t,r){var n=Wn.getAttributeNS(e,"http://www.w3.org/ns/ttml#styling",r);return n||ml(e,t,r)}function ml(e,t,r){e=vl(e,"style",t,"");for(var n=null,i=0;i<e.length;i++){var a=Wn.getAttributeNS(e[i],"http://www.w3.org/ns/ttml#styling",r);a||(a=yl(e[i],t,r)),a&&(n=a)}return n}function vl(e,t,r,n,i){var a=[];if(!e||1>r.length)return a;var o=e;for(e=null;o&&!(e=i?Wn.getAttributeNS(o,i,t):o.getAttribute(t))&&(o=o.parentNode)instanceof Element;);if(t=e)for(i=(t=f(t=t.split(" "))).next();!i.done;i=t.next())for(i=i.value,o=(e=f(r)).next();!o.done;o=e.next())if(n+(o=o.value).getAttribute("xml:id")==i){a.push(o);break}return a}function _l(e,t){var r=null;if(tl.test(e)){r=tl.exec(e);var n=Number(r[1]),i=Number(r[2]),a=Number(r[3]),o=Number(r[4]);r=(a+=(o+=(Number(r[5])||0)/t.h)/t.frameRate)+60*i+3600*n}else rl.test(e)?r=bl(rl,e):nl.test(e)?r=bl(nl,e):il.test(e)?(r=il.exec(e),r=Number(r[1])/t.frameRate):al.test(e)?(r=al.exec(e),r=Number(r[1])/t.g):ol.test(e)&&(r=bl(ol,e));return r}function bl(e,t){var r=e.exec(t);return null==r||""==r[0]?null:(Number(r[4])||0)/1e3+(Number(r[3])||0)+60*(Number(r[2])||0)+3600*(Number(r[1])||0)}function Al(e,t,r,n){this.frameRate=Number(e)||30,this.h=Number(t)||1,this.g=Number(n),0==this.g&&(this.g=e?this.frameRate*this.h:1),r&&(e=/^(\d+) (\d+)$/g.exec(r))&&(this.frameRate*=Number(e[1])/Number(e[2]))}function El(){this.g=new Yc}function Sl(){}function Tl(e,t,r){var n;if(n=/^align:(start|middle|center|end|left|right)$/.exec(t))t=n[1],e.textAlign="middle"==t?er:tr[t.toUpperCase()];else if(n=/^vertical:(lr|rl)$/.exec(t))e.writingMode="lr"==n[1]?"vertical-lr":"vertical-rl";else if(n=/^size:([\d.]+)%$/.exec(t))e.size=Number(n[1]);else if(n=/^position:([\d.]+)%(?:,(line-left|line-right|center|start|end))?$/.exec(t))e.position=Number(n[1]),n[2]&&(t=n[2],e.positionAlign="line-left"==t||"start"==t?"line-left":"line-right"==t||"end"==t?"line-right":"center");else{if(!(n=/^region:(.*)$/.exec(t))){e:{if(r=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(t))e.lineInterpretation=1,e.line=Number(r[1]),r[2]&&(e.lineAlign=ur[r[2].toUpperCase()]);else{if(!(r=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(t))){e=!1;break e}e.lineInterpretation=or,e.line=Number(r[1]),r[2]&&(e.lineAlign=ur[r[2].toUpperCase()])}e=!0}return e}(t=function(e,t){var r=e.filter((function(e){return e.id==t}));return r.length?r[0]:(Y.v("VTT parser could not find a region with id: ",t," The region will be ignored."),null)}(r,n[1]))&&(e.region=t)}return!0}function wl(e){if(null==(e=Fi(e,/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3})/g)))return null;var t=Number(e[2]),r=Number(e[3]);return 59<t||59<r?null:Number(e[4])/1e3+r+60*t+3600*(Number(e[1])||0)}function Cl(){this.g=null}function kl(e,t,r){var n,i,a;return(new Bn).box("payl",Vn((function(e){n=me(e)}))).box("iden",Vn((function(e){i=me(e)}))).box("sttg",Vn((function(e){a=me(e)}))).parse(e),n?function(e,t,r,n,i){if(e=new Qt(n,i,e),t&&(e.id=t),r)for(t=new Gi(r),r=ji(t);r;)Tl(e,r,[])||Y.v("VTT parser encountered an invalid VTT setting: ",r," The setting will be ignored."),Vi(t),r=ji(t);return e}(n,i,a,t,r):null}function Il(){}function $l(){zc?console.debug("EmeEncryptionSchemePolyfill: Already installed."):navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration?(zc=navigator.requestMediaKeySystemAccess,console.debug("EmeEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.requestMediaKeySystemAccess=Pl):console.debug("EmeEncryptionSchemePolyfill: EME not found")}function Pl(e,t){var r=this;return g((function n(){var i;return N(n,(function(n){switch(n.s){case 1:return console.assert(r==navigator,'bad "this" for requestMediaKeySystemAccess'),w(n,zc.call(r,e,t),2);case 2:return Ul(i=n.B)?(console.debug("EmeEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.requestMediaKeySystemAccess=zc,n.return(i)):(console.debug("EmeEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.requestMediaKeySystemAccess=xl,n.return(xl.call(r,e,t)))}}))}))}function xl(e,t){var r=this;return g((function n(){var i,a,o,s,u,c,l,d;return N(n,(function(n){switch(n.s){case 1:console.assert(r==navigator,'bad "this" for requestMediaKeySystemAccess'),i=Bl(e),a=[];for(var h=f(t),p=h.next();!p.done;p=h.next())o=p.value,s=Rl(o.videoCapabilities,i),u=Rl(o.audioCapabilities,i),o.videoCapabilities&&o.videoCapabilities.length&&!s.length||o.audioCapabilities&&o.audioCapabilities.length&&!u.length||((c=Object.assign({},o)).videoCapabilities=s,c.audioCapabilities=u,a.push(c));if(!a.length)throw(l=Error("Unsupported keySystem or supportedConfigurations.")).name="NotSupportedError",l.code=DOMException.NOT_SUPPORTED_ERR,l;return w(n,zc.call(r,e,a),2);case 2:return d=n.B,n.return(new Nl(d,i))}}))}))}function Rl(e,t){return e?e.filter((function(e){return!e.encryptionScheme||e.encryptionScheme==t})):e}function Ol(){}function Dl(){Jc?console.debug("McEncryptionSchemePolyfill: Already installed."):navigator.mediaCapabilities?(Jc=navigator.mediaCapabilities.decodingInfo,console.debug("McEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=Ll):console.debug("McEncryptionSchemePolyfill: MediaCapabilities not found")}function Ll(e){var t=this;return g((function r(){var n,i;return N(r,(function(r){switch(r.s){case 1:return console.assert(t==navigator.mediaCapabilities,'bad "this" for decodingInfo'),w(r,Jc.call(t,e),2);case 2:return n=r.B,e.keySystemConfiguration?(i=n.keySystemAccess)&&Ul(i)?(console.debug("McEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.mediaCapabilities.decodingInfo=Jc,r.return(n)):(console.debug("McEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=Ml,r.return(Ml.call(t,e))):r.return(n)}}))}))}function Ml(e){var t=this;return g((function r(){var n,i,a,o,s,u,c,l,d;return N(r,(function(r){switch(r.s){case 1:return console.assert(t==navigator.mediaCapabilities,'bad "this" for decodingInfo'),n=null,e.keySystemConfiguration&&(i=e.keySystemConfiguration,a=i.keySystem,o=i.audio&&i.audio.encryptionScheme,s=i.video&&i.video.encryptionScheme,n=Bl(a),u={powerEfficient:!1,smooth:!1,supported:!1,keySystemAccess:null,configuration:e},o&&o!=n||s&&s!=n)?r.return(u):w(r,Jc.call(t,e),2);case 2:if((c=r.B).keySystemAccess){c.keySystemAccess=new Nl(c.keySystemAccess,n),r.I(3);break}if(!e.keySystemConfiguration){r.I(3);break}var h=e.keySystemConfiguration,f=[],p=[];return h.audio&&f.push({robustness:h.audio.robustness||"",contentType:e.audio.contentType}),h.video&&p.push({robustness:h.video.robustness||"",contentType:e.video.contentType}),h={initDataTypes:h.initDataType?[h.initDataType]:[],distinctiveIdentifier:h.distinctiveIdentifier,persistentState:h.persistentState,sessionTypes:h.sessionTypes},f.length&&(h.audioCapabilities=f),p.length&&(h.videoCapabilities=p),l=h,d=c,w(r,navigator.requestMediaKeySystemAccess(e.keySystemConfiguration.keySystem,[l]),5);case 5:d.keySystemAccess=r.B;case 3:return r.return(c)}}))}))}function Nl(e,t){this.h=e,this.g=t,this.keySystem=e.keySystem}function Bl(e){return e.startsWith("com.widevine")||e.startsWith("com.microsoft")||e.startsWith("com.adobe")||e.startsWith("org.w3")?"cenc":e.startsWith("com.apple")?"cbcs-1-9":(console.warn("EmeEncryptionSchemePolyfill: Unknown key system:",e,"Please contribute!"),null)}function Ul(e){var t=(e=e.getConfiguration()).audioCapabilities&&e.audioCapabilities[0];return!(!(e=e.videoCapabilities&&e.videoCapabilities[0]||t)||void 0===e.encryptionScheme)}function Gl(){}function Vl(){$l(),Dl()}yr["application/ttml+xml"]=Yc,j("shaka.text.Mp4TtmlParser",El),El.prototype.parseInit=function(e){var t=!1;if((new Bn).box("moov",Un).box("trak",Un).box("mdia",Un).box("minf",Un).box("stbl",Un).ma("stsd",Gn).box("stpp",(function(e){t=!0,e.parser.stop()})).parse(e),!t)throw new z(2,2,2007)},El.prototype.parseInit=El.prototype.parseInit,El.prototype.parseMedia=function(e,t){var r=!1,n=[];if((new Bn).box("mdat",Vn(function(e){r=!0,n=n.concat(this.g.parseMedia(e,t))}.bind(this))).parse(e),!r)throw new z(2,2,2007);return n},El.prototype.parseMedia=El.prototype.parseMedia,yr['application/mp4; codecs="stpp"']=El,yr['application/mp4; codecs="stpp.ttml.im1t"']=El,yr['application/mp4; codecs="stpp.TTML.im1t"']=El,j("shaka.text.VttTextParser",Sl),Sl.prototype.parseInit=function(){},Sl.prototype.parseInit=Sl.prototype.parseInit,Sl.prototype.parseMedia=function(e,t){var r=me(e);if(r=(r=r.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n")).split(/\n{2,}/m),!/^WEBVTT($|[ \t\n])/m.test(r[0]))throw new z(2,2,2e3);var n=t.segmentStart;if(null==n&&(n=0,r[0].includes("X-TIMESTAMP-MAP"))){var i=r[0].match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),a=r[0].match(/MPEGTS:(\d+)/m);if(i&&a){if(null==(n=wl(new Gi(i[1]))))throw new z(2,2,2e3);n=t.periodStart+(Number(a[1])/9e4-n)}}a=[];var o=r[0].split("\n");for(i=1;i<o.length;i++)if(/^Region:/.test(o[i])){var s=new Gi(o[i]),u=new hr;ji(s),Vi(s);for(var c=ji(s);c;){var l;e:{var d=u,h=c;if(l=/^id=(.*)$/.exec(h))d.id=l[1];else if(l=/^width=(\d{1,2}|100)%$/.exec(h))d.width=Number(l[1]);else if(l=/^lines=(\d+)$/.exec(h))d.height=Number(l[1]),d.heightUnits=2;else if(l=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(h))d.regionAnchorX=Number(l[1]),d.regionAnchorY=Number(l[2]);else if(l=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(h))d.viewportAnchorX=Number(l[1]),d.viewportAnchorY=Number(l[2]);else{if(!/^scroll=up$/.exec(h)){l=!1;break e}d.scroll="up"}l=!0}l||Y.v("VTT parser encountered an invalid VTTRegion setting: ",c," The setting will be ignored."),Vi(s),c=ji(s)}a.push(u)}for(i=[],s=1;s<r.length;s++){if(l=o=r[s].split("\n"),d=n,o=a,1==l.length&&!l[0]||/^NOTE($|[ \t])/.test(l[0])||"STYLE"==l[0])o=null;else{u=null,l[0].includes("--\x3e")||(u=l[0],l.splice(0,1)),h=wl(c=new Gi(l[0]));var f=Fi(c,/[ \t]+--\x3e[ \t]+/g),p=wl(c);if(null==h||null==f||null==p)throw new z(2,2,2001);for(l=new Qt(h+d,p+d,l.slice(1).join("\n").trim()),Vi(c),d=ji(c);d;)Tl(l,d,o)||Y.v("VTT parser encountered an invalid VTT setting: ",d," The setting will be ignored."),Vi(c),d=ji(c);null!=u&&(l.id=u),o=l}o&&i.push(o)}return i},Sl.prototype.parseMedia=Sl.prototype.parseMedia,yr["text/vtt"]=Sl,yr['text/vtt; codecs="vtt"']=Sl,yr['text/vtt; codecs="wvtt"']=Sl,j("shaka.text.Mp4VttParser",Cl),Cl.prototype.parseInit=function(e){var t=!1;if((new Bn).box("moov",Un).box("trak",Un).box("mdia",Un).ma("mdhd",function(e){0==e.version?(e.reader.U(4),e.reader.U(4),this.g=e.reader.N(),e.reader.U(4)):(e.reader.U(8),e.reader.U(8),this.g=e.reader.N(),e.reader.U(8)),e.reader.U(4)}.bind(this)).box("minf",Un).box("stbl",Un).ma("stsd",Gn).box("wvtt",(function(){t=!0})).parse(e),!this.g)throw new z(2,2,2008);if(!t)throw new z(2,2,2008)},Cl.prototype.parseInit=Cl.prototype.parseInit,Cl.prototype.parseMedia=function(e,t){var r=this;if(!this.g)throw Y.error("No init segment for MP4+VTT!"),new z(2,2,2008);var n,i=0,a=[],o=[],s=!1,u=!1,c=!1,l=null;if((new Bn).box("moof",Un).box("traf",Un).ma("tfdt",(function(e){s=!0,i=0==e.version?e.reader.N():e.reader.Pb()})).ma("tfhd",(function(e){var t=e.flags;(e=e.reader).U(4),1&t&&e.U(8),2&t&&e.U(4),l=8&t?e.N():null})).ma("trun",(function(e){u=!0;var t=e.version,r=e.flags,n=(e=e.reader).N();1&r&&e.U(4),4&r&&e.U(4);for(var i=[],o=0;o<n;o++){var s={duration:null,sampleSize:null,Sd:null};256&r&&(s.duration=e.N()),512&r&&(s.sampleSize=e.N()),1024&r&&e.U(4),2048&r&&(s.Sd=0==t?e.N():e.De()),i.push(s)}a=i})).box("mdat",Vn((function(e){c=!0,n=e}))).parse(e),!c&&!s&&!u)throw new z(2,2,2008);var d=i,h=new Ln(new DataView(n.buffer,n.byteOffset,n.byteLength),0);return a.forEach((function(e){var n=e.duration||l,a=e.Sd?i+e.Sd:d;d=a+(n||0);var s=0;do{var u=h.N();s+=u;var c=h.N(),f=null;"vttc"==(c=jn(c))?8<u&&(f=h.mb(u-8)):("vtte"!=c&&Y.error("Unknown box "+c+"! Skipping!"),h.U(u-8)),n?f&&o.push(kl(f,t.periodStart+a/r.g,t.periodStart+d/r.g)):Y.error("WVTT sample duration unknown, and no default found!")}while(e.sampleSize&&s<e.sampleSize)})),o.filter(de.Ra)},Cl.prototype.parseMedia=Cl.prototype.parseMedia,yr['application/mp4; codecs="wvtt"']=Cl,j("shaka.util.Dom.createHTMLElement",(function(e){return document.createElement(e)})),j("shaka.util.Dom.createVideoElement",(function(){var e=document.createElement("video");return e.muted=!0,e.width=600,e.height=400,e})),j("shaka.util.Dom.asHTMLElement",(function(e){return e})),j("shaka.util.Dom.asHTMLMediaElement",(function(e){return e})),j("shaka.util.Dom.removeAllChildren",(function(e){for(;e.firstChild;)e.removeChild(e.firstChild)})),j("EmeEncryptionSchemePolyfill",Il),Il.install=$l,j("McEncryptionSchemePolyfill",Ol),Ol.install=Dl,Nl.prototype.getConfiguration=function(){var e=this.h.getConfiguration();if(e.videoCapabilities)for(var t=f(e.videoCapabilities),r=t.next();!r.done;r=t.next())r.value.encryptionScheme=this.g;if(e.audioCapabilities)for(r=(t=f(e.audioCapabilities)).next();!r.done;r=t.next())r.value.encryptionScheme=this.g;return e},Nl.prototype.createMediaKeys=function(){return this.h.createMediaKeys()},j("EncryptionSchemePolyfills",Gl),Gl.install=Vl,void 0!==n&&n.gf&&(n.gf=Gl)}.call(r,t,t,void 0),r.shaka)exports2[n]=r.shaka[n]}();var ShakaJsPlugin=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),_defineProperty$9(_assertThisInitialized$8(n=t.call(this,e)),"onAdaptation_",(function(){n.shakaplayer.getVariantTracks().forEach((function(e){if(e.active)for(var t=0;t<this.content.length;++t){var r=this.content[t];r.value===e.id?r.selected=!0:r.selected=!1}}))})),shakaPlayer_compiled.polyfill.installAll(),n}return _createClass$9(r,[{key:"afterCreate",value:function(){var e=this;this.content=[],this.url=this.player.config.url,shakaPlayer_compiled.Player.isBrowserSupported()&&this.on(URL_CHANGE,(function(t){/^blob/.test(t)||(e.url=t,e.loadUrl(t))}))}},{key:"beforePlayerInit",value:function(){if(!shakaPlayer_compiled.Player.isBrowserSupported())throw new Error("Browser not supported!");this._initShaka()}},{key:"destroy",value:function(){this.shakaplayer&&(this.shakaplayer.destroy(),this.shakaplayer=null)}},{key:"_initShaka",value:function(){var e=this.player;this.shakaplayer=new shakaPlayer_compiled.Player(e.video),this.shakaplayer.addEventListener("error",(function(e){console.error("Error code",e.detail.code,"object",e.detail)})),this.config.shakaOpts&&this.shakaplayer.configure(this.config.shakaOpts),this.shakaplayer.getNetworkingEngine().registerRequestFilter((function(e,t){e===shakaPlayer_compiled.net.NetworkingEngine.RequestType.LICENSE&&(t.headers["CWIP-Auth-Header"]="VGhpc0lzQVRlc3QK")})),this.shakaplayer.addEventListener("adaptation",this.onAdaptation_);this.shakaplayer.configure({abr:{enabled:!1}}),this.loadUrl(this.url)}},{key:"loadUrl",value:function(e){var t=this;this.shakaplayer.load(e).then((function(){console.log(" this.onTracksChanged_"),t.onTracksChanged_()})).catch((function(e){console.trace("event",e),console.error("Error code",e.detail.code,"object",e.detail)}))}},{key:"onTracksChanged_",value:function(){this.updateVariantTracks_()}},{key:"updateVariantTracks_",value:function(){var e=this.shakaplayer.getVariantTracks();e.sort((function(e,t){return e.bandwidth-t.bandwidth})),this.updateTrackOptions_(e)}},{key:"updateTrackOptions_",value:function(e){var t=this,r={variant:function(e){var t="";return e.width&&e.height&&(t+=e.height+"P"),t}};this.content=[],e.forEach((function(e){var n={};n.textContent=r[e.type](e),n.track=e,n.value=e.id,n.selected=e.active,t.content.push(n)})),this.updateDefinition()}},{key:"updateDefinition",value:function(){"mobile"!==sniffer$1.device&&console.log("updateDefinition",this.content)}}],[{key:"pluginName",get:function(){return"ShakaPlugin"}},{key:"defaultConfig",get:function(){return{shakaOpts:{}}}},{key:"isSupported",value:function(){return shakaPlayer_compiled.Player.isBrowserSupported()}}]),r}(BasePlugin);function ownKeys$e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$e(Object(r),!0).forEach((function(t){_defineProperty$3(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _regeneratorRuntime$1(){_regeneratorRuntime$1=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(C){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i,a,o,s,u=t&&t.prototype instanceof d?t:d,h=Object.create(u.prototype),f=new S(n||[]);return h._invoke=(i=e,a=r,o=f,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return{value:void 0,done:!0}}for(o.method=e,o.arg=t;;){var r=o.delegate;if(r){var n=b(r,o);if(n){if(n===l)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===s)throw s="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s="executing";var u=c(i,a,o);if("normal"===u.type){if(s=o.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:o.done}}"throw"===u.type&&(s="completed",o.method="throw",o.arg=u.arg)}}),h}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(C){return{type:"throw",arg:C}}}e.wrap=u;var l={};function d(){}function h(){}function f(){}var p={};s(p,i,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(T([])));y&&y!==t&&r.call(y,i)&&(p=y);var m=f.prototype=d.prototype=Object.create(p);function v(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function n(i,a,o,s){var u=c(e[i],e,a);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==_typeof$7(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(d).then((function(e){l.value=e,o(l)}),(function(e){return n("throw",e,o,s)}))}s(u.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function b(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function T(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:w}}function w(){return{value:void 0,done:!0}}return h.prototype=f,s(m,"constructor",f),s(f,"constructor",h),h.displayName=s(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},v(_.prototype),s(_.prototype,a,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new _(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},v(m),s(m,o,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=T,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;E(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function _typeof$3(e){return(_typeof$3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep$3(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(error){return void r(error)}s.done?t(u):Promise.resolve(u).then(n,i)}function _asyncToGenerator$3(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$3(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$3(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck$2(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$3(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$3(e,t,r){return t&&_defineProperties$3(e.prototype,t),r&&_defineProperties$3(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$3(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$2(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$2(e,t)}function _getPrototypeOf$2(e){return(_getPrototypeOf$2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$2(e,t){return(_setPrototypeOf$2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _assertThisInitialized$2(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$2(e,t){if(t&&("object"===_typeof$7(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$2(e)}function _createSuper$n(e){var t=_isNativeReflectConstruct$o();return function(){var r,n=_getPrototypeOf$2(e);if(t){var i=_getPrototypeOf$2(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$2(this,r)}}function _unsupportedIterableToArray$3(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$3(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$3(e,t):void 0}}function _arrayLikeToArray$3(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _createForOfIteratorHelper$3(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$3(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}var $$L=_export,uncurryThis$i=functionUncurryThis,$indexOf=arrayIncludes.indexOf,arrayMethodIsStrict$3=arrayMethodIsStrict$8,nativeIndexOf=uncurryThis$i([].indexOf),NEGATIVE_ZERO=!!nativeIndexOf&&1/nativeIndexOf([1],1,-0)<0,STRICT_METHOD$3=arrayMethodIsStrict$3("indexOf");$$L({target:"Array",proto:!0,forced:NEGATIVE_ZERO||!STRICT_METHOD$3},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return NEGATIVE_ZERO?nativeIndexOf(this,e,t)||0:$indexOf(this,e,t)}});var $$K=_export,toObject$3=toObject$k,lengthOfArrayLike$4=lengthOfArrayLike$n,setArrayLength$1=arraySetLength,doesNotExceedSafeInteger$1=doesNotExceedSafeInteger$4,fails$d=fails$10,INCORRECT_TO_LENGTH=fails$d((function(){return 4294967297!==[].push.call({length:4294967296},1)})),SILENT_ON_NON_WRITABLE_LENGTH$1=!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(error){return error instanceof TypeError}}();$$K({target:"Array",proto:!0,arity:1,forced:INCORRECT_TO_LENGTH||SILENT_ON_NON_WRITABLE_LENGTH$1},{push:function(e){var t=toObject$3(this),r=lengthOfArrayLike$4(t),n=arguments.length;doesNotExceedSafeInteger$1(r+n);for(var i=0;i<n;i++)t[r]=arguments[i],r++;return setArrayLength$1(t,r),r}});var global$9=global$O,apply=functionApply,isCallable$1=isCallable$v,userAgent=engineUserAgent,arraySlice=arraySlice$c,validateArgumentsLength$2=validateArgumentsLength$6,MSIE=/MSIE .\./.test(userAgent),Function$1=global$9.Function,wrap$1=function(e){return MSIE?function(t,r){var n=validateArgumentsLength$2(arguments.length,1)>2,i=isCallable$1(t)?t:Function$1(t),a=n?arraySlice(arguments,2):void 0;return e(n?function(){apply(i,this,a)}:i,r)}:e},schedulersFix={setTimeout:wrap$1(global$9.setTimeout),setInterval:wrap$1(global$9.setInterval)},$$J=_export,global$8=global$O,setInterval$1=schedulersFix.setInterval;$$J({global:!0,bind:!0,forced:global$8.setInterval!==setInterval$1},{setInterval:setInterval$1});var $$I=_export,global$7=global$O,setTimeout$1=schedulersFix.setTimeout;$$I({global:!0,bind:!0,forced:global$7.setTimeout!==setTimeout$1},{setTimeout:setTimeout$1});var $$H=_export,bind$1=functionBind;$$H({target:"Function",proto:!0,forced:Function.bind!==bind$1},{bind:bind$1});var uncurryThis$h=functionUncurryThis,defineBuiltIn$4=defineBuiltIn$l,DatePrototype=Date.prototype,INVALID_DATE="Invalid Date",TO_STRING="toString",nativeDateToString=uncurryThis$h(DatePrototype[TO_STRING]),thisTimeValue$1=uncurryThis$h(DatePrototype.getTime);String(new Date(NaN))!=INVALID_DATE&&defineBuiltIn$4(DatePrototype,TO_STRING,(function(){var e=thisTimeValue$1(this);return e==e?nativeDateToString(this):INVALID_DATE}));var $$G=_export,forEach$1=arrayForEach;$$G({target:"Array",proto:!0,forced:[].forEach!=forEach$1},{forEach:forEach$1});var DESCRIPTORS$9=descriptors,fails$c=fails$10,anObject$4=anObject$p,create$2=objectCreate$1,normalizeStringArgument$2=normalizeStringArgument$4,nativeErrorToString=Error.prototype.toString,INCORRECT_TO_STRING$1=fails$c((function(){if(DESCRIPTORS$9){var e=create$2(Object.defineProperty({},"name",{get:function(){return this===e}}));if("true"!==nativeErrorToString.call(e))return!0}return"2: 1"!==nativeErrorToString.call({message:1,name:2})||"Error"!==nativeErrorToString.call({})})),errorToString$2=INCORRECT_TO_STRING$1?function(){var e=anObject$4(this),t=normalizeStringArgument$2(e.name,"Error"),r=normalizeStringArgument$2(e.message);return t?r?t+": "+r:t:r}:nativeErrorToString,defineBuiltIn$3=defineBuiltIn$l,errorToString$1=errorToString$2,ErrorPrototype$1=Error.prototype;ErrorPrototype$1.toString!==errorToString$1&&defineBuiltIn$3(ErrorPrototype$1,"toString",errorToString$1);var $$F=_export,uncurryThis$g=functionUncurryThis,requireObjectCoercible$3=requireObjectCoercible$e,toIntegerOrInfinity$2=toIntegerOrInfinity$f,toString$e=toString$v,stringSlice$3=uncurryThis$g("".slice),max$1=Math.max,min$1=Math.min,FORCED$5=!"".substr||"b"!=="ab".substr(-1);$$F({target:"String",proto:!0,forced:FORCED$5},{substr:function(e,t){var r,n,i=toString$e(requireObjectCoercible$3(this)),a=i.length,o=toIntegerOrInfinity$2(e);return o===1/0&&(o=0),o<0&&(o=max$1(a+o,0)),(r=void 0===t?a:toIntegerOrInfinity$2(t))<=0||r===1/0||o>=(n=min$1(o+r,a))?"":stringSlice$3(i,o,n)}});var $$E=_export,lastIndexOf=arrayLastIndexOf;$$E({target:"Array",proto:!0,forced:lastIndexOf!==[].lastIndexOf},{lastIndexOf:lastIndexOf});var $$D=_export,uncurryThis$f=functionUncurryThis,fails$b=fails$10,ArrayBufferModule$1=arrayBuffer,anObject$3=anObject$p,toAbsoluteIndex=toAbsoluteIndex$8,toLength$1=toLength$b,speciesConstructor=speciesConstructor$5,ArrayBuffer$1=ArrayBufferModule$1.ArrayBuffer,DataView$1=ArrayBufferModule$1.DataView,DataViewPrototype=DataView$1.prototype,nativeArrayBufferSlice=uncurryThis$f(ArrayBuffer$1.prototype.slice),getUint8=uncurryThis$f(DataViewPrototype.getUint8),setUint8=uncurryThis$f(DataViewPrototype.setUint8),INCORRECT_SLICE=fails$b((function(){return!new ArrayBuffer$1(2).slice(1,void 0).byteLength}));$$D({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:INCORRECT_SLICE},{slice:function(e,t){if(nativeArrayBufferSlice&&void 0===t)return nativeArrayBufferSlice(anObject$3(this),e);for(var r=anObject$3(this).byteLength,n=toAbsoluteIndex(e,r),i=toAbsoluteIndex(void 0===t?r:t,r),a=new(speciesConstructor(this,ArrayBuffer$1))(toLength$1(i-n)),o=new DataView$1(this),s=new DataView$1(a),u=0;n<i;)setUint8(s,u++,getUint8(o,n++));return a}});var lengthOfArrayLike$3=lengthOfArrayLike$n,arrayToReversed$1=function(e,t){for(var r=lengthOfArrayLike$3(e),n=new t(r),i=0;i<r;i++)n[i]=e[r-i-1];return n},arrayToReversed=arrayToReversed$1,ArrayBufferViewCore$4=arrayBufferViewCore,aTypedArray$2=ArrayBufferViewCore$4.aTypedArray,exportTypedArrayMethod$2=ArrayBufferViewCore$4.exportTypedArrayMethod,getTypedArrayConstructor$2=ArrayBufferViewCore$4.getTypedArrayConstructor;exportTypedArrayMethod$2("toReversed",(function(){return arrayToReversed(aTypedArray$2(this),getTypedArrayConstructor$2(this))}));var ArrayBufferViewCore$3=arrayBufferViewCore,uncurryThis$e=functionUncurryThis,aCallable=aCallable$c,arrayFromConstructorAndList$1=arrayFromConstructorAndList$3,aTypedArray$1=ArrayBufferViewCore$3.aTypedArray,getTypedArrayConstructor$1=ArrayBufferViewCore$3.getTypedArrayConstructor,exportTypedArrayMethod$1=ArrayBufferViewCore$3.exportTypedArrayMethod,sort=uncurryThis$e(ArrayBufferViewCore$3.TypedArrayPrototype.sort);exportTypedArrayMethod$1("toSorted",(function(e){void 0!==e&&aCallable(e);var t=aTypedArray$1(this),r=arrayFromConstructorAndList$1(getTypedArrayConstructor$1(t),t);return sort(r,e)}));var lengthOfArrayLike$2=lengthOfArrayLike$n,toIntegerOrInfinity$1=toIntegerOrInfinity$f,$RangeError=RangeError,arrayWith$1=function(e,t,r,n){var i=lengthOfArrayLike$2(e),a=toIntegerOrInfinity$1(r),o=a<0?i+a:a;if(o>=i||o<0)throw $RangeError("Incorrect index");for(var s=new t(i),u=0;u<i;u++)s[u]=u===o?n:e[u];return s},arrayWith=arrayWith$1,ArrayBufferViewCore$2=arrayBufferViewCore,isBigIntArray=isBigIntArray$2,toIntegerOrInfinity=toIntegerOrInfinity$f,toBigInt=toBigInt$3,aTypedArray=ArrayBufferViewCore$2.aTypedArray,getTypedArrayConstructor=ArrayBufferViewCore$2.getTypedArrayConstructor,exportTypedArrayMethod=ArrayBufferViewCore$2.exportTypedArrayMethod,PROPER_ORDER=!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(error){return 8===error}}();exportTypedArrayMethod("with",{with:function(e,t){var r=aTypedArray(this),n=toIntegerOrInfinity(e),i=isBigIntArray(r)?toBigInt(t):+t;return arrayWith(r,getTypedArrayConstructor(r),n,i)}}.with,!PROPER_ORDER);var $$C=_export,fails$a=fails$10,toIndexedObject$3=toIndexedObject$e,nativeGetOwnPropertyDescriptor$1=objectGetOwnPropertyDescriptor.f,DESCRIPTORS$8=descriptors,FAILS_ON_PRIMITIVES$1=fails$a((function(){nativeGetOwnPropertyDescriptor$1(1)})),FORCED$4=!DESCRIPTORS$8||FAILS_ON_PRIMITIVES$1;$$C({target:"Object",stat:!0,forced:FORCED$4,sham:!DESCRIPTORS$8},{getOwnPropertyDescriptor:function(e,t){return nativeGetOwnPropertyDescriptor$1(toIndexedObject$3(e),t)}});var $$B=_export,DESCRIPTORS$7=descriptors,defineProperty$4=objectDefineProperty.f;$$B({target:"Object",stat:!0,forced:Object.defineProperty!==defineProperty$4,sham:!DESCRIPTORS$7},{defineProperty:defineProperty$4});var createTypedArrayConstructor$6=typedArrayConstructor.exports;createTypedArrayConstructor$6("Int8",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var createTypedArrayConstructor$5=typedArrayConstructor.exports;createTypedArrayConstructor$5("Int16",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var createTypedArrayConstructor$4=typedArrayConstructor.exports;createTypedArrayConstructor$4("Int32",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var createTypedArrayConstructor$3=typedArrayConstructor.exports;createTypedArrayConstructor$3("Uint16",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var createTypedArrayConstructor$2=typedArrayConstructor.exports;createTypedArrayConstructor$2("Uint32",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var createTypedArrayConstructor$1=typedArrayConstructor.exports;createTypedArrayConstructor$1("Float32",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var createTypedArrayConstructor=typedArrayConstructor.exports;createTypedArrayConstructor("Float64",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var $$A=_export,toObject$2=toObject$k,lengthOfArrayLike$1=lengthOfArrayLike$n,setArrayLength=arraySetLength,deletePropertyOrThrow=deletePropertyOrThrow$4,doesNotExceedSafeInteger=doesNotExceedSafeInteger$4,INCORRECT_RESULT=1!==[].unshift(0),SILENT_ON_NON_WRITABLE_LENGTH=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(error){return error instanceof TypeError}}();$$A({target:"Array",proto:!0,arity:1,forced:INCORRECT_RESULT||SILENT_ON_NON_WRITABLE_LENGTH},{unshift:function(e){var t=toObject$2(this),r=lengthOfArrayLike$1(t),n=arguments.length;if(n){doesNotExceedSafeInteger(r+n);for(var i=r;i--;){var a=i+n;i in t?t[a]=t[i]:deletePropertyOrThrow(t,a)}for(var o=0;o<n;o++)t[o]=arguments[o]}return setArrayLength(t,r+n)}});var $$z=_export,fails$9=fails$10,$imul=Math.imul,FORCED$3=fails$9((function(){return-5!=$imul(4294967295,5)||2!=$imul.length}));$$z({target:"Math",stat:!0,forced:FORCED$3},{imul:function(e,t){var r=65535,n=+e,i=+t,a=r&n,o=r&i;return 0|a*o+((r&n>>>16)*o+a*(r&i>>>16)<<16>>>0)}});var mathSign=Math.sign||function(e){var t=+e;return 0==t||t!=t?t:t<0?-1:1},sign=mathSign,abs=Math.abs,pow=Math.pow,EPSILON=pow(2,-52),EPSILON32=pow(2,-23),MAX32=pow(2,127)*(2-EPSILON32),MIN32=pow(2,-126),roundTiesToEven=function(e){return e+1/EPSILON-1/EPSILON},mathFround=Math.fround||function(e){var t,r,n=+e,i=abs(n),a=sign(n);return i<MIN32?a*roundTiesToEven(i/MIN32/EPSILON32)*MIN32*EPSILON32:(r=(t=(1+EPSILON32/EPSILON)*i)-(t-i))>MAX32||r!=r?a*(1/0):a*r},$$y=_export,fround=mathFround;$$y({target:"Math",stat:!0},{fround:fround});var $$x=_export,floor=Math.floor,log$2=Math.log,LOG2E=Math.LOG2E;$$x({target:"Math",stat:!0},{clz32:function(e){var t=e>>>0;return t?31-floor(log$2(t+.5)*LOG2E):32}});var $$w=_export,trunc=mathTrunc;$$w({target:"Math",stat:!0},{trunc:trunc});var $$v=_export,uncurryThis$d=functionUncurryThis,getOwnPropertyDescriptor=objectGetOwnPropertyDescriptor.f,toLength=toLength$b,toString$d=toString$v,notARegExp=notARegexp,requireObjectCoercible$2=requireObjectCoercible$e,correctIsRegExpLogic=correctIsRegexpLogic,nativeStartsWith=uncurryThis$d("".startsWith),stringSlice$2=uncurryThis$d("".slice),min=Math.min,CORRECT_IS_REGEXP_LOGIC=correctIsRegExpLogic("startsWith"),MDN_POLYFILL_BUG=!(CORRECT_IS_REGEXP_LOGIC||(descriptor2=getOwnPropertyDescriptor(String.prototype,"startsWith"),!descriptor2||descriptor2.writable)),descriptor2;$$v({target:"String",proto:!0,forced:!MDN_POLYFILL_BUG&&!CORRECT_IS_REGEXP_LOGIC},{startsWith:function(e){var t=toString$d(requireObjectCoercible$2(this));notARegExp(e);var r=toLength(min(arguments.length>1?arguments[1]:void 0,t.length)),n=toString$d(e);return nativeStartsWith?nativeStartsWith(t,n,r):stringSlice$2(t,r,r+n.length)===n}});for(var itoc$1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ctoi$1={},index$3=0;index$3<66;index$3++)ctoi$1[itoc$1.charAt(index$3)]=index$3;var base64Map={itoc:itoc$1,ctoi:ctoi$1},$$u=_export,getBuiltIn$6=getBuiltIn$j,uncurryThis$c=functionUncurryThis,fails$8=fails$10,toString$c=toString$v,hasOwn$7=hasOwnProperty_1,validateArgumentsLength$1=validateArgumentsLength$6,ctoi=base64Map.ctoi,disallowed=/[^\d+/a-z]/i,whitespaces$2=/[\t\n\f\r ]+/g,finalEq=/[=]+$/,$atob=getBuiltIn$6("atob"),fromCharCode$1=String.fromCharCode,charAt$4=uncurryThis$c("".charAt),replace$2=uncurryThis$c("".replace),exec$3=uncurryThis$c(disallowed.exec),NO_SPACES_IGNORE=fails$8((function(){return""!==$atob(" ")})),NO_ENCODING_CHECK=!fails$8((function(){$atob("a")})),NO_ARG_RECEIVING_CHECK$1=!NO_SPACES_IGNORE&&!NO_ENCODING_CHECK&&!fails$8((function(){$atob()})),WRONG_ARITY$1=!NO_SPACES_IGNORE&&!NO_ENCODING_CHECK&&1!==$atob.length;$$u({global:!0,enumerable:!0,forced:NO_SPACES_IGNORE||NO_ENCODING_CHECK||NO_ARG_RECEIVING_CHECK$1||WRONG_ARITY$1},{atob:function(e){if(validateArgumentsLength$1(arguments.length,1),NO_ARG_RECEIVING_CHECK$1||WRONG_ARITY$1)return $atob(e);var t,r,n=replace$2(toString$c(e),whitespaces$2,""),i="",a=0,o=0;if(n.length%4==0&&(n=replace$2(n,finalEq,"")),n.length%4==1||exec$3(disallowed,n))throw new(getBuiltIn$6("DOMException"))("The string is not correctly encoded","InvalidCharacterError");for(;t=charAt$4(n,a++);)hasOwn$7(ctoi,t)&&(r=o%4?64*r+ctoi[t]:ctoi[t],o++%4&&(i+=fromCharCode$1(255&r>>(-2*o&6))));return i}});var IS_NODE$1=engineIsNode,tryNodeRequire$1=function(e){try{if(IS_NODE$1)return Function('return require("'+e+'")')()}catch(error){}},domExceptionConstants={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}},$$t=_export,tryNodeRequire=tryNodeRequire$1,getBuiltIn$5=getBuiltIn$j,fails$7=fails$10,create$1=objectCreate$1,createPropertyDescriptor$2=createPropertyDescriptor$a,defineProperty$3=objectDefineProperty.f,defineBuiltIn$2=defineBuiltIn$l,defineBuiltInAccessor=defineBuiltInAccessor$5,hasOwn$6=hasOwnProperty_1,anInstance$1=anInstance$9,anObject$2=anObject$p,errorToString=errorToString$2,normalizeStringArgument$1=normalizeStringArgument$4,DOMExceptionConstants$1=domExceptionConstants,clearErrorStack$1=errorStackClear,InternalStateModule$1=internalState,DESCRIPTORS$6=descriptors,DOM_EXCEPTION$2="DOMException",DATA_CLONE_ERR="DATA_CLONE_ERR",Error$2=getBuiltIn$5("Error"),NativeDOMException$1=getBuiltIn$5(DOM_EXCEPTION$2)||function(){try{(new(getBuiltIn$5("MessageChannel")||tryNodeRequire("worker_threads").MessageChannel)).port1.postMessage(new WeakMap)}catch(error){if(error.name==DATA_CLONE_ERR&&25==error.code)return error.constructor}}(),NativeDOMExceptionPrototype=NativeDOMException$1&&NativeDOMException$1.prototype,ErrorPrototype=Error$2.prototype,setInternalState$1=InternalStateModule$1.set,getInternalState$1=InternalStateModule$1.getterFor(DOM_EXCEPTION$2),HAS_STACK="stack"in Error$2(DOM_EXCEPTION$2),codeFor=function(e){return hasOwn$6(DOMExceptionConstants$1,e)&&DOMExceptionConstants$1[e].m?DOMExceptionConstants$1[e].c:0},$DOMException$1=function(){anInstance$1(this,DOMExceptionPrototype$1);var e=arguments.length,t=normalizeStringArgument$1(e<1?void 0:arguments[0]),r=normalizeStringArgument$1(e<2?void 0:arguments[1],"Error"),n=codeFor(r);if(setInternalState$1(this,{type:DOM_EXCEPTION$2,name:r,message:t,code:n}),DESCRIPTORS$6||(this.name=r,this.message=t,this.code=n),HAS_STACK){var i=Error$2(t);i.name=DOM_EXCEPTION$2,defineProperty$3(this,"stack",createPropertyDescriptor$2(1,clearErrorStack$1(i.stack,1)))}},DOMExceptionPrototype$1=$DOMException$1.prototype=create$1(ErrorPrototype),createGetterDescriptor=function(e){return{enumerable:!0,configurable:!0,get:e}},getterFor=function(e){return createGetterDescriptor((function(){return getInternalState$1(this)[e]}))};DESCRIPTORS$6&&(defineBuiltInAccessor(DOMExceptionPrototype$1,"code",getterFor("code")),defineBuiltInAccessor(DOMExceptionPrototype$1,"message",getterFor("message")),defineBuiltInAccessor(DOMExceptionPrototype$1,"name",getterFor("name"))),defineProperty$3(DOMExceptionPrototype$1,"constructor",createPropertyDescriptor$2(1,$DOMException$1));var INCORRECT_CONSTRUCTOR=fails$7((function(){return!(new NativeDOMException$1 instanceof Error$2)})),INCORRECT_TO_STRING=INCORRECT_CONSTRUCTOR||fails$7((function(){return ErrorPrototype.toString!==errorToString||"2: 1"!==String(new NativeDOMException$1(1,2))})),INCORRECT_CODE=INCORRECT_CONSTRUCTOR||fails$7((function(){return 25!==new NativeDOMException$1(1,"DataCloneError").code}));INCORRECT_CONSTRUCTOR||25!==NativeDOMException$1[DATA_CLONE_ERR]||NativeDOMExceptionPrototype[DATA_CLONE_ERR];var FORCED_CONSTRUCTOR$1=INCORRECT_CONSTRUCTOR;$$t({global:!0,constructor:!0,forced:FORCED_CONSTRUCTOR$1},{DOMException:FORCED_CONSTRUCTOR$1?$DOMException$1:NativeDOMException$1});var PolyfilledDOMException$1=getBuiltIn$5(DOM_EXCEPTION$2),PolyfilledDOMExceptionPrototype$1=PolyfilledDOMException$1.prototype;for(var key$1 in INCORRECT_TO_STRING&&NativeDOMException$1===PolyfilledDOMException$1&&defineBuiltIn$2(PolyfilledDOMExceptionPrototype$1,"toString",errorToString),INCORRECT_CODE&&DESCRIPTORS$6&&NativeDOMException$1===PolyfilledDOMException$1&&defineBuiltInAccessor(PolyfilledDOMExceptionPrototype$1,"code",createGetterDescriptor((function(){return codeFor(anObject$2(this).name)}))),DOMExceptionConstants$1)if(hasOwn$6(DOMExceptionConstants$1,key$1)){var constant$1=DOMExceptionConstants$1[key$1],constantName$1=constant$1.s,descriptor$1=createPropertyDescriptor$2(6,constant$1.c);hasOwn$6(PolyfilledDOMException$1,constantName$1)||defineProperty$3(PolyfilledDOMException$1,constantName$1,descriptor$1),hasOwn$6(PolyfilledDOMExceptionPrototype$1,constantName$1)||defineProperty$3(PolyfilledDOMExceptionPrototype$1,constantName$1,descriptor$1)}var $$s=_export,global$6=global$O,getBuiltIn$4=getBuiltIn$j,createPropertyDescriptor$1=createPropertyDescriptor$a,defineProperty$2=objectDefineProperty.f,hasOwn$5=hasOwnProperty_1,anInstance=anInstance$9,inheritIfRequired=inheritIfRequired$6,normalizeStringArgument=normalizeStringArgument$4,DOMExceptionConstants=domExceptionConstants,clearErrorStack=errorStackClear,DESCRIPTORS$5=descriptors,DOM_EXCEPTION$1="DOMException",Error$1=getBuiltIn$4("Error"),NativeDOMException=getBuiltIn$4(DOM_EXCEPTION$1),$DOMException=function(){anInstance(this,DOMExceptionPrototype);var e=arguments.length,t=normalizeStringArgument(e<1?void 0:arguments[0]),r=normalizeStringArgument(e<2?void 0:arguments[1],"Error"),n=new NativeDOMException(t,r),i=Error$1(t);return i.name=DOM_EXCEPTION$1,defineProperty$2(n,"stack",createPropertyDescriptor$1(1,clearErrorStack(i.stack,1))),inheritIfRequired(n,this,$DOMException),n},DOMExceptionPrototype=$DOMException.prototype=NativeDOMException.prototype,ERROR_HAS_STACK="stack"in Error$1(DOM_EXCEPTION$1),DOM_EXCEPTION_HAS_STACK="stack"in new NativeDOMException(1,2),descriptor=NativeDOMException&&DESCRIPTORS$5&&Object.getOwnPropertyDescriptor(global$6,DOM_EXCEPTION$1),BUGGY_DESCRIPTOR=!(!descriptor||descriptor.writable&&descriptor.configurable),FORCED_CONSTRUCTOR=ERROR_HAS_STACK&&!BUGGY_DESCRIPTOR&&!DOM_EXCEPTION_HAS_STACK;$$s({global:!0,constructor:!0,forced:FORCED_CONSTRUCTOR},{DOMException:FORCED_CONSTRUCTOR?$DOMException:NativeDOMException});var PolyfilledDOMException=getBuiltIn$4(DOM_EXCEPTION$1),PolyfilledDOMExceptionPrototype=PolyfilledDOMException.prototype;if(PolyfilledDOMExceptionPrototype.constructor!==PolyfilledDOMException)for(var key in defineProperty$2(PolyfilledDOMExceptionPrototype,"constructor",createPropertyDescriptor$1(1,PolyfilledDOMException)),DOMExceptionConstants)if(hasOwn$5(DOMExceptionConstants,key)){var constant=DOMExceptionConstants[key],constantName=constant.s;hasOwn$5(PolyfilledDOMException,constantName)||defineProperty$2(PolyfilledDOMException,constantName,createPropertyDescriptor$1(6,constant.c))}var getBuiltIn$3=getBuiltIn$j,setToStringTag$1=setToStringTag$9,DOM_EXCEPTION="DOMException";setToStringTag$1(getBuiltIn$3(DOM_EXCEPTION),DOM_EXCEPTION);var aw$2=(_scriptDir="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(t){var r,n=void 0!==(t=t||{})?t:{},i={};for(r in n)n.hasOwnProperty(r)&&(i[r]=n[r]);if(n.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -s ENVIRONMENT=web or -s ENVIRONMENT=node)");var a="";if(document.currentScript&&(a=document.currentScript.src),_scriptDir&&(a=_scriptDir),a=0!==a.indexOf("blob:")?a.substr(0,a.lastIndexOf("/")+1):"","object"!==("undefined"==typeof window?"undefined":_typeof$3(window))&&"function"!=typeof importScripts)throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");var o,s=n.print||console.log.bind(console),u=n.printErr||console.warn.bind(console);for(r in i)i.hasOwnProperty(r)&&(n[r]=i[r]);function c(e){c.shown||(c.shown={}),c.shown[e]||(c.shown[e]=1,u(e))}i=null,n.arguments&&n.arguments,Object.getOwnPropertyDescriptor(n,"arguments")||Object.defineProperty(n,"arguments",{configurable:!0,get:function(){G("Module.arguments has been replaced with plain arguments_")}}),n.thisProgram&&n.thisProgram,Object.getOwnPropertyDescriptor(n,"thisProgram")||Object.defineProperty(n,"thisProgram",{configurable:!0,get:function(){G("Module.thisProgram has been replaced with plain thisProgram")}}),n.quit&&n.quit,Object.getOwnPropertyDescriptor(n,"quit")||Object.defineProperty(n,"quit",{configurable:!0,get:function(){G("Module.quit has been replaced with plain quit_")}}),p(void 0===n.memoryInitializerPrefixURL,"Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),p(void 0===n.pthreadMainPrefixURL,"Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),p(void 0===n.cdInitializerPrefixURL,"Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),p(void 0===n.filePackagePrefixURL,"Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),p(void 0===n.read,"Module.read option was removed (modify read_ in JS)"),p(void 0===n.readAsync,"Module.readAsync option was removed (modify readAsync in JS)"),p(void 0===n.readBinary,"Module.readBinary option was removed (modify readBinary in JS)"),p(void 0===n.setWindowTitle,"Module.setWindowTitle option was removed (modify setWindowTitle in JS)"),Object.getOwnPropertyDescriptor(n,"read")||Object.defineProperty(n,"read",{configurable:!0,get:function(){G("Module.read has been replaced with plain read_")}}),Object.getOwnPropertyDescriptor(n,"readAsync")||Object.defineProperty(n,"readAsync",{configurable:!0,get:function(){G("Module.readAsync has been replaced with plain readAsync")}}),Object.getOwnPropertyDescriptor(n,"readBinary")||Object.defineProperty(n,"readBinary",{configurable:!0,get:function(){G("Module.readBinary has been replaced with plain readBinary")}}),ce=function(){G("cannot use the stack before compiled code is ready to run, and has provided stack access")},n.wasmBinary&&(o=n.wasmBinary),Object.getOwnPropertyDescriptor(n,"wasmBinary")||Object.defineProperty(n,"wasmBinary",{configurable:!0,get:function(){G("Module.wasmBinary has been replaced with plain wasmBinary")}}),n.noExitRuntime&&n.noExitRuntime,Object.getOwnPropertyDescriptor(n,"noExitRuntime")||Object.defineProperty(n,"noExitRuntime",{configurable:!0,get:function(){G("Module.noExitRuntime has been replaced with plain noExitRuntime")}});var l,d={Memory:function(e){return{buffer:new ArrayBuffer(65536*e.initial),grow:function(e){var t=this.buffer,r=de(e);return p(this.buffer!==t),r}}},Table:function(e){var t=new Array(e.initial);return t.grow=function(e){t.length>=1&&G("Unable to grow wasm table. Use a higher value for RESERVED_FUNCTION_POINTERS or set ALLOW_TABLE_GROWTH."),t.push(null)},t.set=function(e,r){t[e]=r},t.get=function(e){return t[e]},t},Module:function(e){return{}},Instance:function(e,t){var r;return{exports:(r=h,function(e,t,n){var i=t.memory,a=r,o=new e.Int8Array(n);new e.Int16Array(n);var s=new e.Int32Array(n),u=new e.Uint8Array(n);new e.Uint16Array(n);var c=new e.Uint32Array(n);new e.Float32Array(n),new e.Float64Array(n);var l=e.Math.imul;e.Math.fround,e.Math.abs,e.Math.clz32,e.Math.min,e.Math.max,e.Math.floor,e.Math.ceil,e.Math.sqrt,t.abort,e.NaN,e.Infinity;var d=t.emscripten_memcpy_big,h=t.emscripten_resize_heap,f=t.__unlock,p=t.__lock,g=9744;function y(e){var t,r=0;return t=E(),(e=(r=s[388])+e|0)>>>0<=t<<16>>>0||h(0|e)?(s[388]=e,r):(s[256]=48,-1)}function m(e){var t,r=0,n=0,i=0,a=0,o=0,l=0,d=0,h=0,f=0,p=0,m=0,v=0;g=t=g-16|0;e:{t:{r:{n:{i:{a:{o:{s:{u:{c:{l:{if((e|=0)>>>0<=244){if(3&(r=(o=s[261])>>>(e=(l=e>>>0<11?16:e+11&-8)>>>3))){e=(r=s[1092+(a=(n=e+(1&(-1^r))|0)<<3)>>2])+8|0,(0|(i=s[r+8>>2]))!=(0|(a=a+1084|0))?(s[i+12>>2]=a,s[a+8>>2]=i):(m=1044,v=A(n)&o,s[m>>2]=v),n<<=3,s[r+4>>2]=3|n,s[4+(r=r+n|0)>>2]=1|s[r+4>>2];break e}if(l>>>0<=(h=s[263])>>>0)break l;if(r){n=r=(e=(0-(e=(0-(n=2<<e)|n)&r<<e)&e)-1|0)>>>12&16,n|=r=(e>>>=r)>>>5&8,n|=r=(e>>>=r)>>>2&4,r=s[1092+(i=(n=((n|=r=(e>>>=r)>>>1&2)|(r=(e>>>=r)>>>1&1))+(e>>>r)|0)<<3)>>2],(0|(e=s[r+8>>2]))!=(0|(i=i+1084|0))?(s[e+12>>2]=i,s[i+8>>2]=e):(o=A(n)&o,s[261]=o),e=r+8|0,s[r+4>>2]=3|l,a=(n<<=3)-l|0,s[4+(d=r+l|0)>>2]=1|a,s[r+n>>2]=a,h&&(r=1084+((n=h>>>3)<<3)|0,i=s[266],(n=1<<n)&o?n=s[r+8>>2]:(s[261]=n|o,n=r),s[r+8>>2]=i,s[n+12>>2]=i,s[i+12>>2]=r,s[i+8>>2]=n),s[266]=d,s[263]=a;break e}if(!(p=s[262]))break l;for(n=r=(e=(p&0-p)-1|0)>>>12&16,n|=r=(e>>>=r)>>>5&8,n|=r=(e>>>=r)>>>2&4,r=s[1348+(((n|=r=(e>>>=r)>>>1&2)|(r=(e>>>=r)>>>1&1))+(e>>>r)<<2)>>2],i=(-8&s[r+4>>2])-l|0,n=r;(e=s[n+16>>2])||(e=s[n+20>>2]);)i=(n=(a=(-8&s[e+4>>2])-l|0)>>>0<i>>>0)?a:i,r=n?e:r,n=e;if(f=s[r+24>>2],(0|(a=s[r+12>>2]))!=(0|r)){e=s[r+8>>2],s[e+12>>2]=a,s[a+8>>2]=e;break t}if(!(e=s[(n=r+20|0)>>2])){if(!(e=s[r+16>>2]))break c;n=r+16|0}for(;d=n,a=e,(e=s[(n=e+20|0)>>2])||(n=a+16|0,e=s[a+16>>2]););s[d>>2]=0;break t}if(l=-1,!(e>>>0>4294967231)&&(l=-8&(r=e+11|0),h=s[262])){n=0-l|0,o=0,(r>>>=8)&&(o=31,l>>>0>16777215||(o=28+((e=((o=(r<<=i=r+1048320>>>16&8)<<(e=r+520192>>>16&4))<<(r=o+245760>>>16&2)>>>15)-(r|e|i)|0)<<1|l>>>e+21&1)|0));d:{h:{if(i=s[1348+(o<<2)>>2])for(r=l<<(31==(0|o)?0:25-(o>>>1)|0),e=0;;){if(!((d=(-8&s[i+4>>2])-l|0)>>>0>=n>>>0||(a=i,n=d))){n=0,e=i;break h}if(d=s[i+20>>2],i=s[16+((r>>>29&4)+i|0)>>2],e=d?(0|d)==(0|i)?e:d:e,r<<=0!=(0|i),!i)break}else e=0;if(!(e|a)){if(!(e=(0-(e=2<<o)|e)&h))break l;i=r=(e=(e&0-e)-1|0)>>>12&16,i|=r=(e>>>=r)>>>5&8,i|=r=(e>>>=r)>>>2&4,e=s[1348+(((i|=r=(e>>>=r)>>>1&2)|(r=(e>>>=r)>>>1&1))+(e>>>r)<<2)>>2]}if(!e)break d}for(;n=(r=(i=(-8&s[e+4>>2])-l|0)>>>0<n>>>0)?i:n,a=r?e:a,e=(r=s[e+16>>2])||s[e+20>>2];);}if(!(!a|n>>>0>=s[263]-l>>>0)){if(d=s[a+24>>2],(0|a)!=(0|(r=s[a+12>>2]))){e=s[a+8>>2],s[e+12>>2]=r,s[r+8>>2]=e;break r}if(!(e=s[(i=a+20|0)>>2])){if(!(e=s[a+16>>2]))break u;i=a+16|0}for(;o=i,r=e,(e=s[(i=e+20|0)>>2])||(i=r+16|0,e=s[r+16>>2]););s[o>>2]=0;break r}}}if((r=s[263])>>>0>=l>>>0){e=s[266],(n=r-l|0)>>>0>=16?(s[263]=n,i=e+l|0,s[266]=i,s[i+4>>2]=1|n,s[e+r>>2]=n,s[e+4>>2]=3|l):(s[266]=0,s[263]=0,s[e+4>>2]=3|r,s[4+(r=e+r|0)>>2]=1|s[r+4>>2]),e=e+8|0;break e}if((i=s[264])>>>0>l>>>0){r=i-l|0,s[264]=r,n=(e=s[267])+l|0,s[267]=n,s[n+4>>2]=1|r,s[e+4>>2]=3|l,e=e+8|0;break e}if(e=0,n=a=l+47|0,s[379]?r=s[381]:(s[382]=-1,s[383]=-1,s[380]=4096,s[381]=4096,s[379]=t+12&-16^1431655768,s[384]=0,s[372]=0,r=4096),(n=(o=n+r|0)&(d=0-r|0))>>>0<=l>>>0)break e;if((r=s[371])&&(f=(h=s[369])+n|0)>>>0<=h>>>0|f>>>0>r>>>0)break e;if(4&u[1488])break a;l:{d:{if(r=s[267])for(e=1492;;){if((h=s[e>>2])+s[e+4>>2]>>>0>r>>>0&&h>>>0<=r>>>0)break d;if(!(e=s[e+8>>2]))break}if(-1==(0|(r=y(0))))break o;if(o=n,(i=(e=s[380])+-1|0)&r&&(o=(n-r|0)+(r+i&0-e)|0),o>>>0<=l>>>0|o>>>0>2147483646)break o;if((e=s[371])&&(d=(i=s[369])+o|0)>>>0<=i>>>0|d>>>0>e>>>0)break o;if((0|r)!=(0|(e=y(o))))break l;break i}if((o=d&o-i)>>>0>2147483646)break o;if((0|(r=y(o)))==(s[e>>2]+s[e+4>>2]|0))break s;e=r}if(r=e,!(l+48>>>0<=o>>>0|o>>>0>2147483646|-1==(0|e))){if((e=(e=s[381])+(a-o|0)&0-e)>>>0>2147483646)break i;if(-1!=(0|y(e))){o=e+o|0;break i}y(0-o|0);break o}if(-1!=(0|r))break i;break o}a=0;break t}r=0;break r}if(-1!=(0|r))break i}s[372]=4|s[372]}if(n>>>0>2147483646)break n;if((r=y(n))>>>0>=(e=y(0))>>>0|-1==(0|r)|-1==(0|e))break n;if((o=e-r|0)>>>0<=l+40>>>0)break n}e=s[369]+o|0,s[369]=e,e>>>0>c[370]&&(s[370]=e);i:{a:{o:{if(n=s[267]){for(e=1492;;){if(((i=s[e>>2])+(a=s[e+4>>2])|0)==(0|r))break o;if(!(e=s[e+8>>2]))break}break a}for(r>>>0>=(e=s[265])>>>0&&e||(s[265]=r),e=0,s[374]=o,s[373]=r,s[269]=-1,s[270]=s[379],s[376]=0;i=1084+(n=e<<3)|0,s[n+1092>>2]=i,s[n+1096>>2]=i,32!=(0|(e=e+1|0)););i=(e=o+-40|0)-(n=r+8&7?-8-r&7:0)|0,s[264]=i,n=r+n|0,s[267]=n,s[n+4>>2]=1|i,s[4+(e+r|0)>>2]=40,s[268]=s[383];break i}if(!(8&u[e+12|0]|r>>>0<=n>>>0|i>>>0>n>>>0)){s[e+4>>2]=a+o,r=(e=n+8&7?-8-n&7:0)+n|0,s[267]=r,e=(i=s[264]+o|0)-e|0,s[264]=e,s[r+4>>2]=1|e,s[4+(n+i|0)>>2]=40,s[268]=s[383];break i}}r>>>0<(a=s[265])>>>0&&(s[265]=r,a=0),i=r+o|0,e=1492;a:{o:{s:{u:{c:{l:{for(;;){if((0|i)!=s[e>>2]){if(e=s[e+8>>2])continue;break l}break}if(!(8&u[e+12|0]))break c}for(e=1492;;){if((i=s[e>>2])>>>0<=n>>>0&&(a=i+s[e+4>>2]|0)>>>0>n>>>0)break u;e=s[e+8>>2]}}if(s[e>>2]=r,s[e+4>>2]=s[e+4>>2]+o,s[4+(f=(r+8&7?-8-r&7:0)+r|0)>>2]=3|l,e=((r=i+(i+8&7?-8-i&7:0)|0)-f|0)-l|0,d=l+f|0,(0|r)==(0|n)){s[267]=d,e=s[264]+e|0,s[264]=e,s[d+4>>2]=1|e;break o}if(s[266]==(0|r)){s[266]=d,e=s[263]+e|0,s[263]=e,s[d+4>>2]=1|e,s[e+d>>2]=e;break o}if(1==(3&(n=s[r+4>>2]))){p=-8&n;c:if(n>>>0<=255){if(a=n>>>3,n=s[r+8>>2],(0|(i=s[r+12>>2]))==(0|n)){m=1044,v=s[261]&A(a),s[m>>2]=v;break c}s[n+12>>2]=i,s[i+8>>2]=n}else{if(h=s[r+24>>2],(0|(o=s[r+12>>2]))==(0|r))if((l=s[(i=r+20|0)>>2])||(l=s[(i=r+16|0)>>2])){for(;n=i,o=l,(l=s[(i=l+20|0)>>2])||(i=o+16|0,l=s[o+16>>2]););s[n>>2]=0}else o=0;else n=s[r+8>>2],s[n+12>>2]=o,s[o+8>>2]=n;if(h){n=s[r+28>>2];l:{if(s[(i=1348+(n<<2)|0)>>2]==(0|r)){if(s[i>>2]=o,o)break l;m=1048,v=s[262]&A(n),s[m>>2]=v;break c}if(s[h+(s[h+16>>2]==(0|r)?16:20)>>2]=o,!o)break c}s[o+24>>2]=h,(n=s[r+16>>2])&&(s[o+16>>2]=n,s[n+24>>2]=o),(n=s[r+20>>2])&&(s[o+20>>2]=n,s[n+24>>2]=o)}}r=r+p|0,e=e+p|0}if(s[r+4>>2]=-2&s[r+4>>2],s[d+4>>2]=1|e,s[e+d>>2]=e,e>>>0<=255){e=1084+((r=e>>>3)<<3)|0,(n=s[261])&(r=1<<r)?r=s[e+8>>2]:(s[261]=r|n,r=e),s[e+8>>2]=d,s[r+12>>2]=d,s[d+12>>2]=e,s[d+8>>2]=r;break o}if(r=0,(i=e>>>8)&&(r=31,e>>>0>16777215||(r=28+((r=((l=(i<<=a=i+1048320>>>16&8)<<(r=i+520192>>>16&4))<<(i=l+245760>>>16&2)>>>15)-(i|r|a)|0)<<1|e>>>r+21&1)|0)),s[(n=d)+28>>2]=r,s[d+16>>2]=0,s[d+20>>2]=0,n=1348+(r<<2)|0,(i=s[262])&(a=1<<r)){for(i=e<<(31==(0|r)?0:25-(r>>>1)|0),r=s[n>>2];;){if(n=r,(-8&s[r+4>>2])==(0|e))break s;if(r=i>>>29,i<<=1,!(r=s[16+(a=(4&r)+n|0)>>2]))break}s[a+16>>2]=d}else s[262]=i|a,s[n>>2]=d;s[d+24>>2]=n,s[d+12>>2]=d,s[d+8>>2]=d;break o}for(d=(e=o+-40|0)-(i=r+8&7?-8-r&7:0)|0,s[264]=d,i=r+i|0,s[267]=i,s[i+4>>2]=1|d,s[4+(e+r|0)>>2]=40,s[268]=s[383],s[(i=(e=(a+(a+-39&7?39-a&7:0)|0)-47|0)>>>0<n+16>>>0?n:e)+4>>2]=27,e=s[376],s[i+16>>2]=s[375],s[i+20>>2]=e,e=s[374],s[i+8>>2]=s[373],s[i+12>>2]=e,s[375]=i+8,s[374]=o,s[373]=r,s[376]=0,e=i+24|0;s[e+4>>2]=7,r=e+8|0,e=e+4|0,r>>>0<a>>>0;);if((0|n)==(0|i))break i;if(s[i+4>>2]=-2&s[i+4>>2],a=i-n|0,s[n+4>>2]=1|a,s[i>>2]=a,a>>>0<=255){e=1084+((r=a>>>3)<<3)|0,(i=s[261])&(r=1<<r)?r=s[e+8>>2]:(s[261]=r|i,r=e),s[e+8>>2]=n,s[r+12>>2]=n,s[n+12>>2]=e,s[n+8>>2]=r;break i}if(s[n+16>>2]=0,s[n+20>>2]=0,e=0,(i=a>>>8)&&(e=31,a>>>0>16777215||(e=28+((e=((d=(i<<=o=i+1048320>>>16&8)<<(e=i+520192>>>16&4))<<(i=d+245760>>>16&2)>>>15)-(i|e|o)|0)<<1|a>>>e+21&1)|0)),s[(r=n)+28>>2]=e,r=1348+(e<<2)|0,(i=s[262])&(o=1<<e)){for(e=a<<(31==(0|e)?0:25-(e>>>1)|0),r=s[r>>2];;){if(i=r,(0|a)==(-8&s[r+4>>2]))break a;if(r=e>>>29,e<<=1,!(r=s[16+(o=i+(4&r)|0)>>2]))break}s[o+16>>2]=n,s[n+24>>2]=i}else s[262]=i|o,s[r>>2]=n,s[n+24>>2]=r;s[n+12>>2]=n,s[n+8>>2]=n;break i}e=s[n+8>>2],s[e+12>>2]=d,s[n+8>>2]=d,s[d+24>>2]=0,s[d+12>>2]=n,s[d+8>>2]=e}e=f+8|0;break e}e=s[i+8>>2],s[e+12>>2]=n,s[i+8>>2]=n,s[n+24>>2]=0,s[n+12>>2]=i,s[n+8>>2]=e}if(!((e=s[264])>>>0<=l>>>0)){r=e-l|0,s[264]=r,n=(e=s[267])+l|0,s[267]=n,s[n+4>>2]=1|r,s[e+4>>2]=3|l,e=e+8|0;break e}}s[256]=48,e=0;break e}r:if(d){e=s[a+28>>2];n:{if(s[(i=1348+(e<<2)|0)>>2]==(0|a)){if(s[i>>2]=r,r)break n;h=A(e)&h,s[262]=h;break r}if(s[d+(s[d+16>>2]==(0|a)?16:20)>>2]=r,!r)break r}s[r+24>>2]=d,(e=s[a+16>>2])&&(s[r+16>>2]=e,s[e+24>>2]=r),(e=s[a+20>>2])&&(s[r+20>>2]=e,s[e+24>>2]=r)}r:if(n>>>0<=15)e=n+l|0,s[a+4>>2]=3|e,s[4+(e=e+a|0)>>2]=1|s[e+4>>2];else if(s[a+4>>2]=3|l,s[4+(i=a+l|0)>>2]=1|n,s[n+i>>2]=n,n>>>0<=255)e=1084+((r=n>>>3)<<3)|0,(n=s[261])&(r=1<<r)?r=s[e+8>>2]:(s[261]=r|n,r=e),s[e+8>>2]=i,s[r+12>>2]=i,s[i+12>>2]=e,s[i+8>>2]=r;else{e=0,(l=n>>>8)&&(e=31,n>>>0>16777215||(e=28+((e=((d=(l<<=o=l+1048320>>>16&8)<<(e=l+520192>>>16&4))<<(l=d+245760>>>16&2)>>>15)-(l|e|o)|0)<<1|n>>>e+21&1)|0)),s[(r=i)+28>>2]=e,s[i+16>>2]=0,s[i+20>>2]=0,r=1348+(e<<2)|0;n:{if((l=1<<e)&h){for(e=n<<(31==(0|e)?0:25-(e>>>1)|0),l=s[r>>2];;){if((-8&s[(r=l)+4>>2])==(0|n))break n;if(l=e>>>29,e<<=1,!(l=s[16+(o=(4&l)+r|0)>>2]))break}s[o+16>>2]=i}else s[262]=l|h,s[r>>2]=i;s[i+24>>2]=r,s[i+12>>2]=i,s[i+8>>2]=i;break r}e=s[r+8>>2],s[e+12>>2]=i,s[r+8>>2]=i,s[i+24>>2]=0,s[i+12>>2]=r,s[i+8>>2]=e}e=a+8|0;break e}t:if(f){e=s[r+28>>2];r:{if(s[(n=1348+(e<<2)|0)>>2]==(0|r)){if(s[n>>2]=a,a)break r;m=1048,v=A(e)&p,s[m>>2]=v;break t}if(s[f+(s[f+16>>2]==(0|r)?16:20)>>2]=a,!a)break t}s[a+24>>2]=f,(e=s[r+16>>2])&&(s[a+16>>2]=e,s[e+24>>2]=a),(e=s[r+20>>2])&&(s[a+20>>2]=e,s[e+24>>2]=a)}i>>>0<=15?(e=i+l|0,s[r+4>>2]=3|e,s[4+(e=e+r|0)>>2]=1|s[e+4>>2]):(s[r+4>>2]=3|l,s[4+(l=r+l|0)>>2]=1|i,s[i+l>>2]=i,h&&(e=1084+((n=h>>>3)<<3)|0,a=s[266],(n=1<<n)&o?n=s[e+8>>2]:(s[261]=n|o,n=e),s[e+8>>2]=a,s[n+12>>2]=a,s[a+12>>2]=e,s[a+8>>2]=n),s[266]=l,s[263]=i),e=r+8|0}return g=t+16|0,0|e}function v(e){var t=0,r=0,n=0,i=0,a=0,o=0,u=0,l=0,d=0;e:if(e|=0){a=(n=e+-8|0)+(e=-8&(r=s[e+-4>>2]))|0;t:if(!(1&r)){if(!(3&r))break e;if((n=n-(r=s[n>>2])|0)>>>0<c[265])break e;if(e=e+r|0,s[266]==(0|n)){if(3==(3&(r=s[a+4>>2])))return s[263]=e,s[a+4>>2]=-2&r,s[n+4>>2]=1|e,void(s[e+n>>2]=e)}else{if(r>>>0<=255){if(i=s[n+8>>2],r>>>=3,(0|(t=s[n+12>>2]))==(0|i)){l=1044,d=s[261]&A(r),s[l>>2]=d;break t}s[i+12>>2]=t,s[t+8>>2]=i;break t}if(u=s[n+24>>2],(0|n)==(0|(r=s[n+12>>2])))if((t=s[(i=n+20|0)>>2])||(t=s[(i=n+16|0)>>2])){for(;o=i,(t=s[(i=(r=t)+20|0)>>2])||(i=r+16|0,t=s[r+16>>2]););s[o>>2]=0}else r=0;else t=s[n+8>>2],s[t+12>>2]=r,s[r+8>>2]=t;if(!u)break t;i=s[n+28>>2];r:{if(s[(t=1348+(i<<2)|0)>>2]==(0|n)){if(s[t>>2]=r,r)break r;l=1048,d=s[262]&A(i),s[l>>2]=d;break t}if(s[u+(s[u+16>>2]==(0|n)?16:20)>>2]=r,!r)break t}if(s[r+24>>2]=u,(t=s[n+16>>2])&&(s[r+16>>2]=t,s[t+24>>2]=r),!(t=s[n+20>>2]))break t;s[r+20>>2]=t,s[t+24>>2]=r}}if(!(a>>>0<=n>>>0)&&1&(r=s[a+4>>2])){t:{if(!(2&r)){if(s[267]==(0|a)){if(s[267]=n,e=s[264]+e|0,s[264]=e,s[n+4>>2]=1|e,s[266]!=(0|n))break e;return s[263]=0,void(s[266]=0)}if(s[266]==(0|a))return s[266]=n,e=s[263]+e|0,s[263]=e,s[n+4>>2]=1|e,void(s[e+n>>2]=e);e=(-8&r)+e|0;r:if(r>>>0<=255){if(r>>>=3,(0|(t=s[a+8>>2]))==(0|(i=s[a+12>>2]))){l=1044,d=s[261]&A(r),s[l>>2]=d;break r}s[t+12>>2]=i,s[i+8>>2]=t}else{if(u=s[a+24>>2],(0|a)==(0|(r=s[a+12>>2])))if((t=s[(i=a+20|0)>>2])||(t=s[(i=a+16|0)>>2])){for(;o=i,(t=s[(i=(r=t)+20|0)>>2])||(i=r+16|0,t=s[r+16>>2]););s[o>>2]=0}else r=0;else t=s[a+8>>2],s[t+12>>2]=r,s[r+8>>2]=t;if(u){i=s[a+28>>2];n:{if(s[(t=1348+(i<<2)|0)>>2]==(0|a)){if(s[t>>2]=r,r)break n;l=1048,d=s[262]&A(i),s[l>>2]=d;break r}if(s[u+(s[u+16>>2]==(0|a)?16:20)>>2]=r,!r)break r}s[r+24>>2]=u,(t=s[a+16>>2])&&(s[r+16>>2]=t,s[t+24>>2]=r),(t=s[a+20>>2])&&(s[r+20>>2]=t,s[t+24>>2]=r)}}if(s[n+4>>2]=1|e,s[e+n>>2]=e,s[266]!=(0|n))break t;return void(s[263]=e)}s[a+4>>2]=-2&r,s[n+4>>2]=1|e,s[e+n>>2]=e}if(e>>>0<=255)return r=1084+((e>>>=3)<<3)|0,(t=s[261])&(e=1<<e)?e=s[r+8>>2]:(s[261]=e|t,e=r),s[r+8>>2]=n,s[e+12>>2]=n,s[n+12>>2]=r,void(s[n+8>>2]=e);s[n+16>>2]=0,s[n+20>>2]=0,t=0,(i=e>>>8)&&(t=31,e>>>0>16777215||(t=i,t<<=i=i+1048320>>>16&8,t=28+((t=((t<<=u=t+520192>>>16&4)<<(o=t+245760>>>16&2)>>>15)-(o|i|u)|0)<<1|e>>>t+21&1)|0)),s[(r=n)+28>>2]=t,o=1348+(t<<2)|0;t:if((i=s[262])&(r=1<<t)){i=e<<(31==(0|t)?0:25-(t>>>1)|0),r=s[o>>2];r:{for(;;){if(t=r,(-8&s[r+4>>2])==(0|e))break r;if(r=i>>>29,i<<=1,!(r=s[16+(o=t+(4&r)|0)>>2]))break}s[o+16>>2]=n,s[n+12>>2]=n,s[n+24>>2]=t,s[n+8>>2]=n;break t}e=s[t+8>>2],s[e+12>>2]=n,s[t+8>>2]=n,s[n+24>>2]=0,s[n+12>>2]=t,s[n+8>>2]=e}else s[262]=r|i,s[o>>2]=n,s[n+12>>2]=n,s[n+24>>2]=o,s[n+8>>2]=n;if(e=s[269]+-1|0,s[269]=e,!e){for(n=1500;n=(e=s[n>>2])+8|0,e;);s[269]=-1}}}}function _(e){var t,r=0;return c[e+20>>2]<=c[e+28>>2]||(a[s[e+36>>2]](e,0,0),s[e+20>>2])?((r=s[e+4>>2])>>>0<(t=s[e+8>>2])>>>0&&(r=r-t|0,a[s[e+40>>2]](e,r,r>>31,1)),s[e+28>>2]=0,s[e+16>>2]=0,s[e+20>>2]=0,s[e+4>>2]=0,s[e+8>>2]=0,0):-1}function b(e){for(var t=0,r=0;r=t,e;)e&=e-1,t=t+1|0;return r}function A(e){var t;return(-1>>>(t=31&e)&-2)<<t|(-1<<(e=0-e&31)&-2)>>>e}function E(){return n.byteLength/65536|0}return{__wasm_call_ctors:function(){},malloc:m,openBox:function(e,t){e|=0,t|=0;var r,n,i,a=0;return g=r=g-16|0,s[r+12>>2]=0,s[r+8>>2]=0,s[r+4>>2]=0,s[r>>2]=0,function(e,t,r,n,i,a){var c=0,l=0,d=0,h=0,f=0,p=0;if(c=(u[e+2|0]^u[e+1|0]^u[0|e])<<24>>24,s[a>>2]=c+-48,c=47+(t-c|0)|0,s[n>>2]=c,f=r,p=m(c),s[f>>2]=p,l=s[a>>2],d=m(l),s[i>>2]=d,(0|l)>0)for(c=l;;){if(d=(l-c|0)+d|0,l=(t-l|0)+e|0,o[0|d]=u[(t-c|0)+e|0]^u[l+-1|0]^u[l+-2|0],(0|(c=c+-1|0))<1){c=s[n>>2];break}d=s[i>>2],l=s[a>>2]}if((0|c)>0)for(;t=s[r>>2]+h|0,h=h+1|0,o[0|t]=u[h+e|0],(0|h)<s[n>>2];);}(e,t,r+12|0,r+4|0,r+8|0,r),function(e,t){var r=0,n=0,i=0,a=0,s=0,c=0,l=0;if((0|t)>=1)for(i=85,a=250;n=b(r),s=u[0|(c=e+r|0)],l=n,n=1&r,o[0|c]=l+(21+((s^(n?i:a))<<24>>24)|0),a=n?a:s,i=n?s:i,(0|(r=r+1|0))!=(0|t););}(e=s[r+12>>2],t=s[r+4>>2]),n=function(e){var t=0;return(255&(t=e+-48|0))>>>0<=9?t<<24>>24:((e+-97&255)>>>0<26?e+-87|0:-1)<<24>>24}(o[0|e]),s[r>>2]=n,i=m(a=t-n|0),o[i+(a=a+-1|0)|0]=0,(0|a)>=1&&function(e,t,r){var n,i=0;if(r>>>0>=8192)d(0|e,0|t,0|r);else{n=e+r|0;e:if(3&(e^t))if(n>>>0<4)r=e;else if((i=n+-4|0)>>>0<e>>>0)r=e;else for(r=e;o[0|r]=u[0|t],o[r+1|0]=u[t+1|0],o[r+2|0]=u[t+2|0],o[r+3|0]=u[t+3|0],t=t+4|0,(r=r+4|0)>>>0<=i>>>0;);else{t:if((0|r)<1)r=e;else if(3&e)for(r=e;;){if(o[0|r]=u[0|t],t=t+1|0,(r=r+1|0)>>>0>=n>>>0)break t;if(!(3&r))break}else r=e;if(!((e=-4&n)>>>0<64||r>>>0>(i=e+-64|0)>>>0))for(;s[r>>2]=s[t>>2],s[r+4>>2]=s[t+4>>2],s[r+8>>2]=s[t+8>>2],s[r+12>>2]=s[t+12>>2],s[r+16>>2]=s[t+16>>2],s[r+20>>2]=s[t+20>>2],s[r+24>>2]=s[t+24>>2],s[r+28>>2]=s[t+28>>2],s[r+32>>2]=s[t+32>>2],s[r+36>>2]=s[t+36>>2],s[r+40>>2]=s[t+40>>2],s[r+44>>2]=s[t+44>>2],s[r+48>>2]=s[t+48>>2],s[r+52>>2]=s[t+52>>2],s[r+56>>2]=s[t+56>>2],s[r+60>>2]=s[t+60>>2],t=t- -64|0,(r=r- -64|0)>>>0<=i>>>0;);if(r>>>0>=e>>>0)break e;for(;s[r>>2]=s[t>>2],t=t+4|0,(r=r+4|0)>>>0<e>>>0;);}if(r>>>0<n>>>0)for(;o[0|r]=u[0|t],t=t+1|0,(0|n)!=(0|(r=r+1|0)););}}(i,e+1|0,t+(-1^n)|0),v(e),v(s[r+8>>2]),g=r+16|0,0|i},free:v,__errno_location:function(){return 1024},fflush:function e(t){var r=0;if(t|=0)return s[t+76>>2],0|_(t);if(s[260]&&(r=e(s[260])),p(1028),t=s[259])for(;c[t+20>>2]>c[t+28>>2]&&(r=_(t)|r),t=s[t+56>>2];);return f(1028),0|r},setThrew:function(e,t){e|=0,t|=0,s[385]||(s[386]=t,s[385]=e)},stackSave:function(){return 0|g},stackAlloc:function(e){return g=e=g-(e|=0)&-16,0|e},stackRestore:function(e){g=e|=0},__growWasmMemory:function(t){return 0|function(t){t|=0;var r=0|E(),a=r+t|0;if(r<a&&a<65536){var d=new ArrayBuffer(l(a,65536)),h=new e.Int8Array(d);h.set(o),o=h,o=new e.Int8Array(d),new e.Int16Array(d),s=new e.Int32Array(d),u=new e.Uint8Array(d),new e.Uint16Array(d),c=new e.Uint32Array(d),new e.Float32Array(d),new e.Float64Array(d),n=d,i.buffer=d}return r}(0|(t|=0))}}}({Int8Array:Int8Array,Int16Array:Int16Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array,NaN:NaN,Infinity:1/0,Math:Math},X,l.buffer))}},instantiate:function(e,t){return{then:function(r,n){r({instance:new d.Instance(new d.Module(e,t))})}}},RuntimeError:Error};o=[],"object"!==_typeof$3(d)&&G("No WebAssembly support found. Build with -s WASM=0 to target JavaScript instead.");var h=new d.Table({initial:1,maximum:1,element:"anyfunc"}),f=!1;function p(e,t){e||G("Assertion failed: "+t)}var g,y,m,v,_,b="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function A(e,t,r,n){if(!(n>0))return 0;for(var i=r,a=r+n-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(r>=a)break;t[r++]=s}else if(s<=2047){if(r+1>=a)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=a)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+3>=a)break;s>=2097152&&c("Invalid Unicode code point 0x"+s.toString(16)+" encountered when serializing a JS string to an UTF-8 string on the asm.js/wasm heap! (Valid unicode code points should be in range 0-0x1FFFFF)."),t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-i}function E(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),n<=127?++t:t+=n<=2047?2:n<=65535?3:4}return t}function S(e,t){return e%t>0&&(e+=t-e%t),e}function T(e){g=e,n.HEAP8=y=new Int8Array(e),n.HEAP16=new Int16Array(e),n.HEAP32=v=new Int32Array(e),n.HEAPU8=m=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAPU32=_=new Uint32Array(e),n.HEAPF32=new Float32Array(e),n.HEAPF64=new Float64Array(e)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var w=1712;p(!0,"stack must start aligned"),p(!0,"heap must start aligned");var C=8192;n.TOTAL_STACK&&p(C===n.TOTAL_STACK,"the stack size can no longer be determined at runtime");var k=n.TOTAL_MEMORY||65536;function I(){p(!0),_[429]=34821223,_[430]=2310721022,v[0]=1668509029}function $(){var e=_[429],t=_[430];34821223==e&&2310721022==t||G("Stack overflow! Stack cookie has been overwritten, expected hex dwords 0x89BACDFE and 0x02135467, but received 0x"+t.toString(16)+" "+e.toString(16)),1668509029!==v[0]&&G("Runtime error: The application has corrupted its heap memory area (address zero)!")}function P(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?n.dynCall_v(r):n.dynCall_vi(r,t.arg):r(void 0===t.arg?null:t.arg)}else t()}}Object.getOwnPropertyDescriptor(n,"TOTAL_MEMORY")||Object.defineProperty(n,"TOTAL_MEMORY",{configurable:!0,get:function(){G("Module.TOTAL_MEMORY has been replaced with plain INITIAL_TOTAL_MEMORY")}}),p(k>=C,"TOTAL_MEMORY should be larger than TOTAL_STACK, was "+k+"! (TOTAL_STACK=8192)"),p("undefined"!=typeof Int32Array&&"undefined"!=typeof Float64Array&&void 0!==Int32Array.prototype.subarray&&void 0!==Int32Array.prototype.set,"JS engine does not provide full typed array support"),(l=n.wasmMemory?n.wasmMemory:new d.Memory({initial:k/65536}))&&(g=l.buffer),p((k=g.byteLength)%65536==0),T(g),v[388]=9904,function(){var e=new Int16Array(1),t=new Int8Array(e.buffer);if(e[0]=25459,115!==t[0]||99!==t[1])throw"Runtime error: expected the system to be little-endian!"}();var x=[],R=[],O=[],D=[],L=!1;p(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),p(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),p(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),p(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var M=0,N=null,B=null,U={};function G(t){throw n.onAbort&&n.onAbort(t),s(t+=""),u(t),f=!0,t="abort("+t+") at "+(i=function(){var t=new Error;if(!t.stack){try{throw new Error(0)}catch(e){t=e}if(!t.stack)return"(no stack trace available)"}return t.stack.toString()}(),n.extraStackTrace&&(i+="\n"+n.extraStackTrace()),r=/\b_Z[\w\d_]+/g,i.replace(r,(function(e){var t,r=(t=e,c("warning: build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),t);return e===r?e:r+" ["+e+"]"}))),new d.RuntimeError(t);var r,i}n.preloadedImages={},n.preloadedAudios={};var V={error:function(){G("Filesystem support (FS) was not included. The problem is that you are using files from JS, but files were not used from C/C++, so filesystem support was not auto-included. You can force-include filesystem support with  -s FORCE_FILESYSTEM=1")},init:function(){V.error()},createDataFile:function(){V.error()},createPreloadedFile:function(){V.error()},createLazyFile:function(){V.error()},open:function(){V.error()},mkdev:function(){V.error()},registerDevice:function(){V.error()},analyzePath:function(){V.error()},loadFilesFromDB:function(){V.error()},ErrnoError:function(){V.error()}};n.FS_createDataFile=V.createDataFile,n.FS_createPreloadedFile=V.createPreloadedFile;var F="data:application/octet-stream;base64,";function j(e){return String.prototype.startsWith?e.startsWith(F):0===e.indexOf(F)}var H,Z="aw.wasm";function W(){try{if(o)return new Uint8Array(o);var e=function(e){if(j(e))return function(e){try{for(var t=K(e),r=new Uint8Array(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}catch(i){throw new Error("Converting base64 string to bytes failed.")}}(e.slice(F.length))}(Z);if(e)return e;throw"both async and sync fetching of the wasm failed"}catch(t){G(t)}}j(Z)||(H=Z,Z=n.locateFile?n.locateFile(H,a):a+H),R.push({func:function(){se()}});var K="function"==typeof atob?atob:function(e){var t,r,n,i,a,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",c=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=s.indexOf(e.charAt(c++))<<2|(i=s.indexOf(e.charAt(c++)))>>4,r=(15&i)<<4|(a=s.indexOf(e.charAt(c++)))>>2,n=(3&a)<<6|(o=s.indexOf(e.charAt(c++))),u+=String.fromCharCode(t),64!==a&&(u+=String.fromCharCode(r)),64!==o&&(u+=String.fromCharCode(n))}while(c<e.length);return u},X={__lock:function(){},__unlock:function(){},emscripten_memcpy_big:function(e,t,r){m.set(m.subarray(t,t+r),e)},emscripten_resize_heap:function(t){var r=y.length;p(t>r);var n=65536,i=2147418112;if(t>i)return u("Cannot enlarge memory, asked to go up to "+t+" bytes, but the limit is "+i+" bytes!"),!1;for(var a=Math.max(r,16777216);a<t;)(a=a<=536870912?S(2*a,n):Math.min(S((3*a+2147483648)/4,n),i))===r&&c("Cannot ask for more memory since we reached the practical limit in browsers (which is just below 2GB), so the request would have failed. Requesting only "+y.length);return function(t){try{return l.grow(t-g.byteLength+65535>>16),T(l.buffer),1}catch(e){console.error("emscripten_realloc_buffer: Attempted to grow heap from "+g.byteLength+" bytes to "+t+" bytes, but got error: "+e)}}(a)?(u("Warning: Enlarging memory arrays, this is not fast! "+[r,a]),!0):(u("Failed to grow the heap from "+r+" bytes to "+a+" bytes, not enough memory!"),!1)},memory:l,table:h},Y=function(){var t,r={env:X,wasi_unstable:X};function i(e,t){var r=e.exports;n.asm=r,function(e){if(M--,n.monitorRunDependencies&&n.monitorRunDependencies(M),e?(p(U[e]),delete U[e]):u("warning: run dependency removed without ID"),0==M&&(null!==N&&(clearInterval(N),N=null),B)){var t=B;B=null,t()}}("wasm-instantiate")}t="wasm-instantiate",M++,n.monitorRunDependencies&&n.monitorRunDependencies(M),t?(p(!U[t]),U[t]=1,null===N&&"undefined"!=typeof setInterval&&(N=setInterval((function(){if(f)return clearInterval(N),void(N=null);var e=!1;for(var t in U)e||(e=!0,u("still waiting on run dependencies:")),u("dependency: "+t);e&&u("(end of list)")}),1e4))):u("warning: run dependency added without ID");var a=n;function s(e){p(n===a,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),a=null,i(e.instance)}function c(e){return(o||"function"!=typeof fetch?new Promise((function(e,t){e(W())})):fetch(Z,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+Z+"'";return e.arrayBuffer()})).catch((function(){return W()}))).then((function(e){return d.instantiate(e,r)})).then(e,(function(e){u("failed to asynchronously prepare wasm: "+e),G(e)}))}if(n.instantiateWasm)try{return n.instantiateWasm(r,i)}catch(e){return u("Module.instantiateWasm callback failed with error: "+e),!1}return function(){if(o||"function"!=typeof d.instantiateStreaming||j(Z)||"function"!=typeof fetch)return c(s);fetch(Z,{credentials:"same-origin"}).then((function(e){return d.instantiateStreaming(e,r).then(s,(function(e){u("wasm streaming compile failed: "+e),u("falling back to ArrayBuffer instantiation"),c(s)}))}))}(),{}}(),z=Y.__wasm_call_ctors;Y.__wasm_call_ctors=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),z.apply(null,arguments)};var J=Y.malloc;Y.malloc=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),J.apply(null,arguments)};var Q=Y.openBox;Y.openBox=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),Q.apply(null,arguments)};var q=Y.free;Y.free=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),q.apply(null,arguments)};var ee=Y.__errno_location;Y.__errno_location=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),ee.apply(null,arguments)};var te=Y.fflush;Y.fflush=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),te.apply(null,arguments)};var re=Y.setThrew;Y.setThrew=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),re.apply(null,arguments)};var ne=Y.stackSave;Y.stackSave=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),ne.apply(null,arguments)};var ie=Y.stackAlloc;Y.stackAlloc=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),ie.apply(null,arguments)};var ae=Y.stackRestore;Y.stackRestore=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),ae.apply(null,arguments)};var oe=Y.__growWasmMemory;Y.__growWasmMemory=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),oe.apply(null,arguments)},n.asm=Y;var se=n.___wasm_call_ctors=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.__wasm_call_ctors.apply(null,arguments)},ue=n._malloc=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.malloc.apply(null,arguments)};n._openBox=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.openBox.apply(null,arguments)},n._free=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.free.apply(null,arguments)},n.___errno_location=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.__errno_location.apply(null,arguments)},n._fflush=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.fflush.apply(null,arguments)},n._setThrew=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.setThrew.apply(null,arguments)};var ce=n.stackSave=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.stackSave.apply(null,arguments)};n.stackAlloc=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.stackAlloc.apply(null,arguments)},n.stackRestore=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.stackRestore.apply(null,arguments)};var le,de=n.__growWasmMemory=function(){return p(L,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.__growWasmMemory.apply(null,arguments)};function he(e){function t(){le||(le=!0,f||($(),p(!L),L=!0,P(R),$(),P(O),n.onRuntimeInitialized&&n.onRuntimeInitialized(),p(!n._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),function(){if($(),n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)e=n.postRun.shift(),D.unshift(e);var e;P(D)}()))}M>0||(I(),function(){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)e=n.preRun.shift(),x.unshift(e);var e;P(x)}(),M>0||(n.setStatus?(n.setStatus("Running..."),setTimeout((function(){setTimeout((function(){n.setStatus("")}),1),t()}),1)):t(),$()))}if(n.asm=Y,n.intArrayFromString=function(e,t,r){var n=r>0?r:E(e)+1,i=new Array(n),a=A(e,i,0,i.length);return t&&(i.length=a),i},Object.getOwnPropertyDescriptor(n,"intArrayToString")||(n.intArrayToString=function(){G("'intArrayToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"ccall")||(n.ccall=function(){G("'ccall' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"cwrap")||(n.cwrap=function(){G("'cwrap' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"setValue")||(n.setValue=function(){G("'setValue' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getValue")||(n.getValue=function(){G("'getValue' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"allocate")||(n.allocate=function(){G("'allocate' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getMemory")||(n.getMemory=function(){G("'getMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"AsciiToString")||(n.AsciiToString=function(){G("'AsciiToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stringToAscii")||(n.stringToAscii=function(){G("'stringToAscii' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"UTF8ArrayToString")||(n.UTF8ArrayToString=function(){G("'UTF8ArrayToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),n.UTF8ToString=function(e,t){return e?function(e,t,r){for(var n=t+r,i=t;e[i]&&!(i>=n);)++i;if(i-t>16&&e.subarray&&b)return b.decode(e.subarray(t,i));for(var a="";t<i;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var u=63&e[t++];if(224==(240&o)?o=(15&o)<<12|s<<6|u:(240!=(248&o)&&c("Invalid UTF-8 leading byte 0x"+o.toString(16)+" encountered when deserializing a UTF-8 string on the asm.js/wasm heap to a JS string!"),o=(7&o)<<18|s<<12|u<<6|63&e[t++]),o<65536)a+=String.fromCharCode(o);else{var l=o-65536;a+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else a+=String.fromCharCode((31&o)<<6|s)}else a+=String.fromCharCode(o)}return a}(m,e,t):""},Object.getOwnPropertyDescriptor(n,"stringToUTF8Array")||(n.stringToUTF8Array=function(){G("'stringToUTF8Array' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stringToUTF8")||(n.stringToUTF8=function(){G("'stringToUTF8' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"lengthBytesUTF8")||(n.lengthBytesUTF8=function(){G("'lengthBytesUTF8' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"UTF16ToString")||(n.UTF16ToString=function(){G("'UTF16ToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stringToUTF16")||(n.stringToUTF16=function(){G("'stringToUTF16' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"lengthBytesUTF16")||(n.lengthBytesUTF16=function(){G("'lengthBytesUTF16' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"UTF32ToString")||(n.UTF32ToString=function(){G("'UTF32ToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stringToUTF32")||(n.stringToUTF32=function(){G("'stringToUTF32' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"lengthBytesUTF32")||(n.lengthBytesUTF32=function(){G("'lengthBytesUTF32' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),n.allocateUTF8=function(e){var t=E(e)+1,r=ue(t);return r&&A(e,y,r,t),r},Object.getOwnPropertyDescriptor(n,"stackTrace")||(n.stackTrace=function(){G("'stackTrace' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addOnPreRun")||(n.addOnPreRun=function(){G("'addOnPreRun' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addOnInit")||(n.addOnInit=function(){G("'addOnInit' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addOnPreMain")||(n.addOnPreMain=function(){G("'addOnPreMain' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addOnExit")||(n.addOnExit=function(){G("'addOnExit' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addOnPostRun")||(n.addOnPostRun=function(){G("'addOnPostRun' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"writeStringToMemory")||(n.writeStringToMemory=function(){G("'writeStringToMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"writeArrayToMemory")||(n.writeArrayToMemory=function(){G("'writeArrayToMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"writeAsciiToMemory")||(n.writeAsciiToMemory=function(){G("'writeAsciiToMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addRunDependency")||(n.addRunDependency=function(){G("'addRunDependency' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"removeRunDependency")||(n.removeRunDependency=function(){G("'removeRunDependency' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"ENV")||(n.ENV=function(){G("'ENV' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"FS")||(n.FS=function(){G("'FS' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"FS_createFolder")||(n.FS_createFolder=function(){G("'FS_createFolder' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createPath")||(n.FS_createPath=function(){G("'FS_createPath' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createDataFile")||(n.FS_createDataFile=function(){G("'FS_createDataFile' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createPreloadedFile")||(n.FS_createPreloadedFile=function(){G("'FS_createPreloadedFile' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createLazyFile")||(n.FS_createLazyFile=function(){G("'FS_createLazyFile' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createLink")||(n.FS_createLink=function(){G("'FS_createLink' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createDevice")||(n.FS_createDevice=function(){G("'FS_createDevice' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_unlink")||(n.FS_unlink=function(){G("'FS_unlink' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"GL")||(n.GL=function(){G("'GL' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"dynamicAlloc")||(n.dynamicAlloc=function(){G("'dynamicAlloc' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"loadDynamicLibrary")||(n.loadDynamicLibrary=function(){G("'loadDynamicLibrary' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"loadWebAssemblyModule")||(n.loadWebAssemblyModule=function(){G("'loadWebAssemblyModule' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getLEB")||(n.getLEB=function(){G("'getLEB' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getFunctionTables")||(n.getFunctionTables=function(){G("'getFunctionTables' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"alignFunctionTables")||(n.alignFunctionTables=function(){G("'alignFunctionTables' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"registerFunctions")||(n.registerFunctions=function(){G("'registerFunctions' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addFunction")||(n.addFunction=function(){G("'addFunction' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"removeFunction")||(n.removeFunction=function(){G("'removeFunction' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getFuncWrapper")||(n.getFuncWrapper=function(){G("'getFuncWrapper' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"prettyPrint")||(n.prettyPrint=function(){G("'prettyPrint' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"makeBigInt")||(n.makeBigInt=function(){G("'makeBigInt' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"dynCall")||(n.dynCall=function(){G("'dynCall' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getCompilerSetting")||(n.getCompilerSetting=function(){G("'getCompilerSetting' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stackSave")||(n.stackSave=function(){G("'stackSave' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stackRestore")||(n.stackRestore=function(){G("'stackRestore' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stackAlloc")||(n.stackAlloc=function(){G("'stackAlloc' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"establishStackSpace")||(n.establishStackSpace=function(){G("'establishStackSpace' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"print")||(n.print=function(){G("'print' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"printErr")||(n.printErr=function(){G("'printErr' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getTempRet0")||(n.getTempRet0=function(){G("'getTempRet0' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"setTempRet0")||(n.setTempRet0=function(){G("'setTempRet0' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"callMain")||(n.callMain=function(){G("'callMain' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"abort")||(n.abort=function(){G("'abort' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),n.Pointer_stringify=function(e,t){G("this function has been removed - you should use UTF8ToString(ptr, maxBytesToRead) instead!")},Object.getOwnPropertyDescriptor(n,"warnOnce")||(n.warnOnce=function(){G("'warnOnce' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),n.writeStackCookie=I,n.checkStackCookie=$,n.abortStackOverflow=function(e){G("Stack overflow! Attempted to allocate "+e+" bytes on the stack, but stack has only "+(w-ce()+e)+" bytes available!")},Object.getOwnPropertyDescriptor(n,"intArrayFromBase64")||(n.intArrayFromBase64=function(){G("'intArrayFromBase64' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"tryParseAsDataURI")||(n.tryParseAsDataURI=function(){G("'tryParseAsDataURI' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"ALLOC_NORMAL")||Object.defineProperty(n,"ALLOC_NORMAL",{configurable:!0,get:function(){G("'ALLOC_NORMAL' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(n,"ALLOC_STACK")||Object.defineProperty(n,"ALLOC_STACK",{configurable:!0,get:function(){G("'ALLOC_STACK' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(n,"ALLOC_DYNAMIC")||Object.defineProperty(n,"ALLOC_DYNAMIC",{configurable:!0,get:function(){G("'ALLOC_DYNAMIC' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(n,"ALLOC_NONE")||Object.defineProperty(n,"ALLOC_NONE",{configurable:!0,get:function(){G("'ALLOC_NONE' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(n,"calledRun")||Object.defineProperty(n,"calledRun",{configurable:!0,get:function(){G("'calledRun' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}}),n.then=function(e){if(le)e(n);else{var t=n.onRuntimeInitialized;n.onRuntimeInitialized=function(){t&&t(),e(n)}}return n},B=function e(){le||he(),le||(B=e)},n.run=he,n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return he(),t}),_scriptDir,sameValue$1=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t},call$2=functionCall,fixRegExpWellKnownSymbolLogic=fixRegexpWellKnownSymbolLogic,anObject$1=anObject$p,isNullOrUndefined=isNullOrUndefined$a,requireObjectCoercible$1=requireObjectCoercible$e,sameValue=sameValue$1,toString$b=toString$v,getMethod=getMethod$7,regExpExec=regexpExecAbstract;function debounce$1(e,t,r){var n;return function(){var i=this,a=arguments,o=function(){n=null,r||e.apply(i,a)},s=r&&!n;clearTimeout(n),n=setTimeout(o,t),s&&e.apply(i,a)}}fixRegExpWellKnownSymbolLogic("search",(function(e,t,r){return[function(t){var r=requireObjectCoercible$1(this),n=isNullOrUndefined(t)?void 0:getMethod(t,e);return n?call$2(n,t,r):new RegExp(t)[e](toString$b(r))},function(e){var n=anObject$1(this),i=toString$b(e),a=r(t,n,i);if(a.done)return a.value;var o=n.lastIndex;sameValue(o,0)||(n.lastIndex=0);var s=regExpExec(n,i);return sameValue(n.lastIndex,o)||(n.lastIndex=o),null===s?-1:s.index}]}));var ProxyPromise$1=function(){function e(){var t,r;_classCallCheck$4(this,e);var n=new Promise((function(e,n){t=e,r=n}));return n.resolve=t,n.reject=r,n}return _createClass$5(e,[{key:"resolve",value:function(e){}},{key:"reject",value:function(e){}}]),e}(),$$r=_export,uncurryThis$b=functionUncurryThis,$Date=Date,thisTimeValue=uncurryThis$b($Date.prototype.getTime);$$r({target:"Date",stat:!0},{now:function(){return thisTimeValue(new $Date)}});var Raf=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"install",value:function(){if(window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame,!window.requestAnimationFrame){var e=Date.now();window.requestAnimationFrame=function(t){var r=Date.now(),n=Math.max(16.7-(r-e),0),i=setTimeout(t,n);return e=r+n,i}}window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}}]),e}(),FpsDetection=function(){function e(){_classCallCheck$4(this,e),this.fps=0,this.isStoped=!0,this.ticks=[],this.isSupport=!0,this.maxFps=0,this.step=this._step.bind(this),this.rafId=null}return _createClass$5(e,[{key:"_step",value:function(e){var t=this.ticks;if(t.unshift(e),t.length>10){var r=t.pop();r&&(this.fps=Math.floor(1e4/(e-r)),this.updateFpsInfo())}this.isStoped||(this.rafId=window.requestAnimationFrame(this.step))}},{key:"updateFpsInfo",value:function(){this.fps>this.maxFps&&(this.maxFps=this.fps)}},{key:"start",value:function(){void 0!==window.requestAnimationFrame&&(this.isStoped=!1,this.rafId=window.requestAnimationFrame(this.step))}},{key:"stop",value:function(){window.cancelAnimationFrame(this.rafId),this.isStoped=!0}}],[{key:"install",value:function(){Raf.install()}}]),e}(),Xml2Json=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"parse",value:function(t){var r=e.parseXmlString(t);return null!==r?e.parseDOMChildren(r):null}},{key:"parseXmlString",value:function(e){if(void 0===e)return null;var t,r=new window.DOMParser;try{(t=r.parseFromString(e,"text/xml")).getElementsByTagNameNS("*","parsererror").length>0&&(t=null)}catch(n){t=null}return t}},{key:"parseDOMChildren",value:function(t,r){if(t.nodeType===Node.DOCUMENT_NODE){for(var n={},i=t.childNodes,a=0;a<i.length;a++){var o=i[a];o.nodeType===Node.ELEMENT_NODE&&(n=e.parseDOMChildren(o))}return n}if(t.nodeType===Node.ELEMENT_NODE){for(var s={__cnt:0},u=[],c=t.childNodes,l=0;l<c.length;l++){var d=c[l],h=e.getNodeLocalName(d);if(d.nodeType!==Node.COMMENT_NODE){var f=r+"."+h;if(s.__cnt++,null==s[h]){var p=e.parseDOMChildren(d,f);if("#text"!==h||/[^\s]/.test(p)){var g={};g[h]=p,u.push(g)}s[h]=p,e.toArrayAccessForm(s,h)}else{null!=s[h]&&(s[h]instanceof Array||(s[h]=[s[h]],e.toArrayAccessForm(s,h,f)));var y=e.parseDOMChildren(d,f);if("#text"!==h||/[^\s]/.test(y)){var m={};m[h]=y,u.push(m)}s[h][s[h].length]=y}}}for(var v=0;v<t.attributes.length;v++){var _=t.attributes[v];s.__cnt++;var b=_.value;s[_.name]=b}var A=t.prefix;return null!=A&&""!==A&&(s.__cnt++,s.__prefix=A),null!=s["#text"]&&(s.__text=s["#text"],s.__text instanceof Array&&(s.__text=s.__text.join("\n")),delete s["#text"],delete s["#text_asArray"]),null!=s["#cdata-section"]&&(s.__cdata=s["#cdata-section"],delete s["#cdata-section"],delete s["#cdata-section_asArray"]),1===s.__cnt&&null!=s.__text?s=s.__text:1===s.__cnt&&null!=s.__cdata&&(s=s.__cdata),delete s.__cnt,s}if(t.nodeType===Node.TEXT_NODE||t.nodeType===Node.CDATA_SECTION_NODE)return t.nodeValue}},{key:"getNodeLocalName",value:function(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!==t||(t=e.nodeName),t}},{key:"toArrayAccessForm",value:function(e,t){e[t]instanceof Array||(e[t]=[e[t]])}}]),e}();function isSupportRawCryptoCTR(){var e=new ProxyPromise$1,t=window.crypto||window.msCrypto;if(!t)return e.resolve(!1),e;var r=new Uint8Array(16),n=new Uint8Array([1]),i=null;try{t.subtle.generateKey({name:"AES-CTR",length:256},!1,["encrypt","decrypt"]).then((function(e){return i=e,t.subtle.encrypt({name:"AES-CTR",counter:r,length:128},e,n)})).then((function(e){return t.subtle.decrypt({name:"AES-CTR",counter:r,length:128},i,e)})).then((function(t){var r=new Uint8Array(t);e.resolve(r[0]===n[0])})).catch((function(){e.resolve(!1)}))}catch(error){e.resolve(!1)}return e}var IntervalTimer$2=function(){function e(){_classCallCheck$4(this,e),this.timeID=null,this.func=null}return _createClass$5(e,[{key:"repeat",value:function(e,t){this.timeID=1,this.repeatInterval(e,t)}},{key:"repeatInterval",value:function(e,t){var r=this;this.timeID&&(null===this.func&&(this.func=e),this.func===e&&(this.timeID&&clearTimeout(this.timeID),this.timeID=null,this.timeID=setTimeout((function(){e(),r.repeatInterval(e,t)}),t)))}},{key:"clear",value:function(){clearTimeout(this.timeID),this.timeID=null}}]),e}(),IntervalTimer$1$1=IntervalTimer$2,isSupport$3=_isLocalStorageUsable$2();function probeSupport$2(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function checkIfLocalStorageThrows$2(){var t="_localstorage_support_test";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(e){return!0}}function _isLocalStorageUsable$2(){return probeSupport$2&&!checkIfLocalStorageThrows$2()}var proxyLocalStorage={length:isSupport$3?localStorage.length:0,clear:function(e){try{for(var t=localStorage.length-1;t>=0;t--){var r=localStorage.key(t);0===r.indexOf(e)&&localStorage.removeItem(r)}}catch(error){}},getItem:function(e){try{return localStorage.getItem(e)}catch(error){return null}},key:function(e){try{return localStorage.key(e)}catch(error){return null}},setItem:function(e,t){try{localStorage.setItem(e,t)}catch(error){}},removeItem:function(e){try{localStorage.removeItem(e)}catch(error){}},isSupport:isSupport$3},proxyLocalStorage$1=proxyLocalStorage,LOGOPEN="undefined"!=typeof window&&(window.location.search.indexOf("log=true")>-1||!!proxyLocalStorage$1.getItem("abrdebug")||!!proxyLocalStorage$1.getItem("playerlog")),debug$2={},debugPrefix={log:"log",network:"network",abr:"abr",encrypt:"encrypt",segment:"segment",definition:"definition",content:"content",mse:"mse",media:"media",time:"time",preload:"preload",gap:"gap"};for(var item in debugPrefix)debug$2[item]=LOGOPEN?console.log.bind(window,"".concat(item,":")):function(){};var DEFAULT_PROGRESS_TIMER=1e3,DEFAULT_PRELOAD_TIME=50,DEFAULT_CHECK_BUFFER_TIME=10,DASH_BUFFER_BREAK=2e4,DASH_NO_INITSEGMENT=6e3,DASH_NO_CANPLAY=16e3,DEFAULT_END=1,SPPED_CACHE$1="danger_d_speed",MAX_TIMESTAMP=5e9,MIN_EXPIRE_INTERVAL=300,MONITOR_HEADERS$1={"x-cache":"x_cache","x-response-sinfo":"server_ip"},SIDX_EXCEPTION="sidx_exception",SEGMENT_SIZE_CONFIG={"360p":.45,"480p":.75,"720p":1.6,"1080p":5,"2k":7.5,"4k":12.5},PLAYER_START="player_start",WASM_START="wasm_start",WASM_READY="wasm_ready",INIT_FINISHED="init_finished",CORE_START="core_start",START_PLAY="start_play",ERROR_HANDLER="error_handler",ERROR_CATCHING="error_catching",ERROR_NO_MP4OPTS="error_no_mp4opts",ERROR_CATCH_FINISHED="error_catch_finished",NEXT_START="next_start",NEXT_FINISHED="next_finished",SEGMENT_STATE={NO_START:0,GOING:1,APPEND:2},MEDIA_CONTENT_ERR="media_exception",MP4_SOURCE_ERR="mp4_source_exception",TASK_REQUEST_EXPIRED="task_request_expired",CDM_LICENSE_ERROR="CDM_LICENSE_ERROR",CDM_LICENSE_SUCCESS="CDM_LICENSE_SUCCESS",MPD_SEEK_TYPE={NORMAL:0,SEEK:1,INIT:2},DASH_TYPE={MAIN:"0",BACK:"1"},CHANGE_STATES$2={INIT:"init",ERR:"error"},URL_DASH_TAG="currentDashType",TRANSFORM_IV=new Uint8Array([91,104,69,75,156,171,238,71,202,4,244,5]).buffer,ArrayBufferViewCore$1=arrayBufferViewCore,TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS=typedArrayConstructorsRequireWrappers,aTypedArrayConstructor=ArrayBufferViewCore$1.aTypedArrayConstructor,exportTypedArrayStaticMethod=ArrayBufferViewCore$1.exportTypedArrayStaticMethod;function checkIsMSBrowser(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),r=e.indexOf("Trident/");return t>0||r>0}function checkIsQQBrowser(){return window.navigator.userAgent.toLowerCase().indexOf("qqbrowser")>-1}function checkIsFirefoxBrowser(){var e=window.navigator.userAgent;return!(window.location.search.indexOf("firefox_dash=true")>-1||!!proxyLocalStorage$1.getItem("firefox_dash"))&&e.toLowerCase().indexOf("firefox")>-1}function checkIsSafariBrowser(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function checkIsChromeCoreBrowser(){return navigator.userAgent.toLowerCase().indexOf("chrome")>-1}function checkIsEdgeBrowser(){return navigator.userAgent.indexOf("Edge")>0||navigator.userAgent.indexOf("Edg/")>0}function checkIsIncompatibleBrowser(){var e=checkIsSafariBrowser(),t=checkIsMSBrowser(),r=checkIsFirefoxBrowser(),n=checkIsEdgeBrowser();return e||t||r||n}function checkWebAssemblySupport(){try{if("object"===("undefined"==typeof WebAssembly?"undefined":_typeof$3(WebAssembly))&&"function"==typeof WebAssembly.instantiate){var t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(e){console.log(e)}return!1}function checkMediaSourceSupport(){var e=window.MediaSource=window.MediaSource||window.WebKitMediaSource;return e&&"function"==typeof e.isTypeSupported}exportTypedArrayStaticMethod("of",(function(){for(var e=0,t=arguments.length,r=new(aTypedArrayConstructor(this))(t);t>e;)r[e]=arguments[e++];return r}),TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS);var AV1MimeTypes=['video/mp4; codecs="av01.0.01M.08,mp4a.40.5"'];function isCodecSupported(e){if(!checkMediaSourceSupport())return!1;for(var t=0;t<e.length;t++){var r=e[t];if(MediaSource.isTypeSupported(r))return!0}return!1}function isAV1Supported(){return isCodecSupported(AV1MimeTypes)}function isEMESupported$1(){return!!navigator.requestMediaKeySystemAccess&&!checkIsIncompatibleBrowser()}function isSupported$1(){return checkWebAssemblySupport()&&checkMediaSourceSupport()&&!checkIsMSBrowser()}function isEncryptSupported(){return checkWebAssemblySupport()&&checkMediaSourceSupport()&&!checkIsMSBrowser()&&!checkIsQQBrowser()}function getDrmServerUrl(e){return new Promise((function(t,r){checkWebAssemblySupport()&&checkMediaSourceSupport()&&navigator.requestMediaKeySystemAccess||t(void 0);checkIsSafariBrowser();var n=checkIsChromeCoreBrowser(),i=checkIsEdgeBrowser();n&&!checkIsQQBrowser()?navigator.requestMediaKeySystemAccess("com.widevine.alpha",[{initDataTypes:["keyids","webm"],audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.2"'}],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42c01e"'}]}]).then((function(r){t("https://".concat(e,"/video/drm/v1/widevine?aid=32&kid="))}),(function(){t(void 0)})):t(i?"https://".concat(e,"/video/drm/v1/playready?aid=32&kid="):void 0)}))}var isSupport$2=Object.freeze(Object.defineProperty({__proto__:null,AV1MimeTypes:AV1MimeTypes,checkWebAssemblySupport:checkWebAssemblySupport,getDrmServerUrl:getDrmServerUrl,isAV1Supported:isAV1Supported,isCodecSupported:isCodecSupported,isEMESupported:isEMESupported$1,isEncryptSupported:isEncryptSupported,isSupported:isSupported$1},Symbol.toStringTag,{value:"Module"})),global$5=global$O,fails$6=fails$10,uncurryThis$a=functionUncurryThis,toString$a=toString$v,trim$1=stringTrim.trim,whitespaces$1=whitespaces$5,$parseInt$1=global$5.parseInt,_Symbol$1=global$5.Symbol,ITERATOR$1=_Symbol$1&&_Symbol$1.iterator,hex$1=/^[+-]?0x/i,exec$2=uncurryThis$a(hex$1.exec),FORCED$2=8!==$parseInt$1(whitespaces$1+"08")||22!==$parseInt$1(whitespaces$1+"0x16")||ITERATOR$1&&!fails$6((function(){$parseInt$1(Object(ITERATOR$1))})),numberParseInt=FORCED$2?function(e,t){var r=trim$1(toString$a(e));return $parseInt$1(r,t>>>0||(exec$2(hex$1,r)?16:10))}:$parseInt$1,$$q=_export,$parseInt=numberParseInt;$$q({global:!0,forced:parseInt!=$parseInt},{parseInt:$parseInt});var $$p=_export,getBuiltIn$2=getBuiltIn$j,uncurryThis$9=functionUncurryThis,fails$5=fails$10,toString$9=toString$v,validateArgumentsLength=validateArgumentsLength$6,itoc=base64Map.itoc,$btoa=getBuiltIn$2("btoa"),charAt$3=uncurryThis$9("".charAt),charCodeAt$1=uncurryThis$9("".charCodeAt),NO_ARG_RECEIVING_CHECK=!!$btoa&&!fails$5((function(){$btoa()})),WRONG_ARG_CONVERSION=!!$btoa&&fails$5((function(){return"bnVsbA=="!==$btoa(null)})),WRONG_ARITY=!!$btoa&&1!==$btoa.length;$$p({global:!0,enumerable:!0,forced:NO_ARG_RECEIVING_CHECK||WRONG_ARG_CONVERSION||WRONG_ARITY},{btoa:function(e){if(validateArgumentsLength(arguments.length,1),NO_ARG_RECEIVING_CHECK||WRONG_ARG_CONVERSION||WRONG_ARITY)return $btoa(toString$9(e));for(var t,r,n=toString$9(e),i="",a=0,o=itoc;charAt$3(n,a)||(o="=",a%1);){if((r=charCodeAt$1(n,a+=3/4))>255)throw new(getBuiltIn$2("DOMException"))("The string contains characters outside of the Latin1 range","InvalidCharacterError");i+=charAt$3(o,63&(t=t<<8|r)>>8-a%1*8)}return i}});var global$4=global$O,fails$4=fails$10,uncurryThis$8=functionUncurryThis,toString$8=toString$v,trim=stringTrim.trim,whitespaces=whitespaces$5,charAt$2=uncurryThis$8("".charAt),$parseFloat$1=global$4.parseFloat,_Symbol=global$4.Symbol,ITERATOR=_Symbol&&_Symbol.iterator,FORCED$1=1/$parseFloat$1(whitespaces+"-0")!=-1/0||ITERATOR&&!fails$4((function(){$parseFloat$1(Object(ITERATOR))})),numberParseFloat=FORCED$1?function(e){var t=trim(toString$8(e)),r=$parseFloat$1(t);return 0===r&&"-"==charAt$2(t,0)?-0:r}:$parseFloat$1,$$o=_export,$parseFloat=numberParseFloat;$$o({global:!0,forced:parseFloat!=$parseFloat},{parseFloat:$parseFloat});var $$n=_export,uncurryThis$7=functionUncurryThis,toString$7=toString$v,fromCharCode=String.fromCharCode,charAt$1=uncurryThis$7("".charAt),exec$1=uncurryThis$7(/./.exec),stringSlice$1=uncurryThis$7("".slice),hex2=/^[\da-f]{2}$/i,hex4=/^[\da-f]{4}$/i;$$n({global:!0},{unescape:function(e){for(var t,r,n=toString$7(e),i="",a=n.length,o=0;o<a;){if("%"===(t=charAt$1(n,o++)))if("u"===charAt$1(n,o)){if(r=stringSlice$1(n,o+1,o+5),exec$1(hex4,r)){i+=fromCharCode(parseInt(r,16)),o+=5;continue}}else if(r=stringSlice$1(n,o,o+2),exec$1(hex2,r)){i+=fromCharCode(parseInt(r,16)),o+=2;continue}i+=t}return i}});var $$m=_export,$reduce=arrayReduce.left,arrayMethodIsStrict$2=arrayMethodIsStrict$8,CHROME_VERSION=engineV8Version,IS_NODE=engineIsNode,STRICT_METHOD$2=arrayMethodIsStrict$2("reduce"),CHROME_BUG=!IS_NODE&&CHROME_VERSION>79&&CHROME_VERSION<83;$$m({target:"Array",proto:!0,forced:!STRICT_METHOD$2||CHROME_BUG},{reduce:function(e){var t=arguments.length;return $reduce(this,e,t,t>1?arguments[1]:void 0)}});var util$1={ArrayBufferToString:function(e){for(var t="",r=new Uint8Array(e),n=0;n<r.length;n++)t+=String.fromCharCode(r[n]);return t},StringToArrayBuffer:function(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t},Base64ToHex:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=window.atob(e.replace(/-/g,"+").replace(/_/g,"/"));if(t){for(var n=[],i=0;i<r.length;i++)n.push(r.charCodeAt(i));return new Uint8Array(n).buffer}for(var a="",o=0;o<r.length;o++)a+=("0"+r.charCodeAt(o).toString(16)).substr(-2);return a},HexToBase64:function(e){for(var t="",r=0;r<e.length;r+=2)t+=String.fromCharCode(parseInt(e.substr(r,2),16));return window.btoa(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},findBox:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(e.type!==t){if(e&&e.subBox){var n=e.subBox.filter((function(e){return e.type===t}));n.length?n.forEach((function(e){return r.push(e)})):e.subBox.forEach((function(e){return util$1.findBox(e,t,r)}))}}else r.push(e);return(r=[].concat(r)).length>1?r:r[0]},padStart:function(e,t,r){for(var n=String(r),i=t>>0,a=Math.ceil(i/n.length),o=[],s=String(e);a--;)o.push(n);return o.join("").substring(0,i-s.length)+s},durationConvert:function(e){var t=0,r=0,n=0;return(e=e.slice(e.indexOf("PT")+2)).indexOf("H")>-1&&e.indexOf("M")>-1&&e.indexOf("S")>-1?(t=parseFloat(e.slice(0,e.indexOf("H"))),r=parseFloat(e.slice(e.indexOf("H")+1,e.indexOf("M"))),n=parseFloat(e.slice(e.indexOf("M")+1,e.indexOf("S")))):e.indexOf("H")>-1&&e.indexOf("M")>-1&&e.indexOf("S")<0?(t=parseFloat(e.slice(0,e.indexOf("H"))),r=parseFloat(e.slice(e.indexOf("H")+1,e.indexOf("M")))):e.indexOf("H")<0&&e.indexOf("M")>-1&&e.indexOf("S")>-1?(r=parseFloat(e.slice(0,e.indexOf("M"))),n=parseFloat(e.slice(e.indexOf("M")+1,e.indexOf("S")))):e.indexOf("H")>-1&&e.indexOf("M")<0&&e.indexOf("S")>-1?(t=parseFloat(e.slice(0,e.indexOf("H"))),n=parseFloat(e.slice(e.indexOf("H")+1,e.indexOf("S")))):e.indexOf("H")<0&&e.indexOf("M")<0&&e.indexOf("S")>-1?n=parseFloat(e.slice(0,e.indexOf("S"))):e.indexOf("H")<0&&e.indexOf("M")>-1&&e.indexOf("S")<0&&(r=parseFloat(e.slice(0,e.indexOf("M")))),3600*t+60*r+n},preFixInterge:function(e,t){return(Array(t).join(0)+e).slice(-t)},toHex:function(){for(var e=[],t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach((function(t){e.push(util$1.padStart(Number(t).toString(16),2,0))})),e},sum:function(){for(var e=0,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach((function(t){e+=t})),e},toUTF8:function(e){for(var t=encodeURIComponent(e),r=unescape(t),n=new Uint8Array(r.length),i=0;i<r.length;++i)n[i]=r.charCodeAt(i);return n.buffer},fromHex:function(e){for(var t=new Uint8Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=parseInt(e.substr(r,2),16);return t},fromCharCode:function(e){for(var t="",r=0;r<e.length;r+=16e3){var n=e.subarray(r,r+16e3);t+=String.fromCharCode.apply(null,n)}return t},toBase64:function(e,t){var r=util$1.fromCharCode(e);t=void 0===t||t;var n=window.btoa(r).replace(/\+/g,"-").replace(/\//g,"_");return t?n:n.replace(/=*$/,"")},str2hex:function(e){if(""===e)return"";for(var t=[],r=0;r<e.length;r++)t.push(e.charCodeAt(r));return t},bufferToString:function(e){return("0"+Number(e).toString(16)).slice(-2).toUpperCase()},stringToBuffer:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e[r]+e[r+1],16));return new Uint8Array(t)}};util$1.toHex=function(){for(var e=[],t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach((function(t){e.push(util$1.padStart(Number(t).toString(16),2,0))})),e},util$1.formatIV=function(e){var t="";return e.forEach((function(e){t+=util$1.bufferToString(e)})),t},util$1.round=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Number(e.toFixed(t))},util$1.isSogou=function(){return window.navigator.userAgent.toLowerCase().indexOf("metasr")>-1},util$1.isEdge=function(){var e=window.navigator.userAgent.toLowerCase();return e.indexOf("edge")>-1||e.indexOf("edg/")>-1},util$1.offInDestroy=function(e,t,r,n){e.once(n,(function i(){e.off(t,r),e.off(n,i)}))},util$1.on=function(e,t,r,n){if(n)e.on(t,r),util$1.offInDestroy(e,t,r,n);else{e.on(t,(function n(i){r(i),e.off(t,n)}))}},util$1.once=function(e,t,r,n){if(n)e.once(t,r),util$1.offInDestroy(e,t,r,n);else{e.once(t,(function n(i){r(i),e.off(t,n)}))}},util$1.promisePolyfill=function(){Promise.prototype.finally||(Promise.prototype.finally={finally:function(e){var t=function(t){return Promise.resolve(e()).then(t)};return this.then((function(e){return t((function(){return e}))}),(function(e){return t((function(){return Promise.reject(e)}))}))}}.finally)},util$1.transformHeaders=function(e,t){var r=Object.assign({},e);return Object.keys(t).forEach((function(n){var i=t[n];e&&e[n]&&(r[i]=e[n],delete r[n])})),r},util$1.generateUniqueKey=function(e){var t=e.vid,r=e.start,n=e.end,i=e.mediaType,a=e.definition,o=e.codecType,s=e.format,u=e.bitrate;return r=r||0,n=n||0,o=o||"h264",s=s||"dash",t&&i?a?"".concat(t,"#").concat(i,"#").concat(a,"#").concat(r,"#").concat(n,"#").concat(o,"#").concat(s,"#").concat(u):"".concat(t,"#").concat(i,"#").concat(r,"#").concat(n,"#").concat(o,"#").concat(s,"#").concat(u):null},util$1.getDefinition=function(e){if(!e)return null;var t=e.split("#");return t.length>2?t[2]:null},util$1.exchangeListUrl=function(e){if(e&&0!==e.length)for(var t=0;t<e.length;t++)util$1.exchangeUrl(e[t])},util$1.exchangeUrl=function(e){if(e&&e.main_url&&e.backup_url_1){var t=e.main_url,r=e.backup_url_1,n=t.split("?");2===n.length&&-1===r.indexOf("?")?(e.main_url=r+"?"+n[1],e.backup_url_1=n[0]):(e.main_url=r,e.backup_url_1=t)}},util$1.validateFragment=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(t instanceof ArrayBuffer){try{var n=new Uint8Array(t,4,4),i=String.fromCharCode.apply(null,n);if(2===r.length){var a=r[1]-r[0]+1;if(!(t.byteLength===a))return}if("moof"!==i&&"styp"!==i&&"ftyp"!==i)return!1}catch(e){return!1}return!0}return!1},util$1.validateUrlRange=function(e,t){var r=e||[];if(r.length>0)for(var n=0;n<r.length;n++){var i=r[n];if(/([0-9.\-A-Za-z]+)/.test(i)&&t.indexOf(i)>-1)return!0}return!1},util$1.isBase64=function(e){return/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)$/.test(e)};var cipher=function(e){var t=function(e){return e.split("").map((function(e){return e.charCodeAt(0)}))},r=function(e){return("0"+Number(e).toString(16)).substr(-2)},n=function(r){return t(e).reduce((function(e,t){return e^t}),r)};return function(e){return e.split("").map(t).map(n).map(r).join("")}},decipher=function(e){var t=function(t){return(r=e,r.split("").map((function(e){return e.charCodeAt(0)}))).reduce((function(e,t){return e^t}),t);var r};return function(e){return e.match(/.{1,2}/g).map((function(e){return parseInt(e,16)})).map(t).map((function(e){return String.fromCharCode(e)})).join("")}},myCipher=cipher("vodTimestampSalt"),myDecipher=decipher("vodTimestampSalt");util$1.getUnionInfo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"".concat(e).concat(myCipher((new Date).getTime().toString()))},util$1.checkUnionInfoExpired=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30;if(0===t.indexOf(e)){var n=parseInt(myDecipher(t.slice(e.length))),i=(new Date).getTime()-n;if(i>0&&i<=1e3*r)return!0}return!1},util$1.getCookieValue=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=document.cookie.split(";"),r=0;r<t.length;r++){var n=t[r].trim().split("=");if(n[0]===e)return n[1]}return null},util$1.nowTime=function(){try{return parseInt(performance.now(),10)}catch(e){return(new Date).getTime()}},util$1.getBitrateItem=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=t,a=util$1.getSelectorList(e,r),o=i.getSuitableBitrate?i.getSuitableBitrate(a,n):i.bitRateAdapter.select(a);return o},util$1.getSelectorList=function(e,t){for(var r=e.dynamic_video_list,n=[],i=0;i<r.length;i++){var a=r[i];n.push({bitrate:a.bitrate,definition:a.definition,duration:t})}return n};var PRELOAD_NEXT$3="PRELOAD_NEXT",PRELOAD_SEG_DONE$1="PRELOAD_SEG_DONE",STATES$2={PREPARE:"PREPARE",IDLE:"IDLE",PRELOADING:"PRELOADING",FINISH:"FINISH"},ONE_STEP_DONE$1="ONE_STEP_DONE",MEDIA_TYPES$2={VIDEO:0,AUDIO:1,MIXED:2},CACHE_TYPES$1={INDEXDB:0,MEMORY:1},DOWN_STATES$1={FAIL:-1,SUCCESS:0,DOWNLOADING:1},VTYPES$3={MP4:"MP4",DASH:"DASH",HLS:"HLS"},eventEmitter={exports:{}},d$2={exports:{}},_undefined$1=void 0,is$4=function(e){return e!==_undefined$1&&null!==e},isValue$6=is$4,possibleTypes={object:!0,function:!0,undefined:!0},is$3=function(e){return!!isValue$6(e)&&hasOwnProperty.call(possibleTypes,_typeof$7(e))},isObject$8=is$3,is$2=function(e){if(!isObject$8(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(error){return!1}},isPrototype=is$2,is$1=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(error){return!1}return!isPrototype(e)},isFunction$1=is$1,classRe=/^\s*class[\s{/}]/,functionToString=Function.prototype.toString,is=function(e){return!!isFunction$1(e)&&!classRe.test(functionToString.call(e))},isImplemented$2=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")},isImplemented$1=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}},noop=function(){},_undefined=noop(),isValue$5=function(e){return e!==_undefined&&null!==e},isValue$4=isValue$5,keys$3=Object.keys,shim$2=function(e){return keys$3(isValue$4(e)?Object(e):e)},keys$2=isImplemented$1()?Object.keys:shim$2,isValue$3=isValue$5,validValue=function(e){if(!isValue$3(e))throw new TypeError("Cannot use null or undefined");return e},keys$1=keys$2,value$1=validValue,max=Math.max,shim$1=function(t,r){var n,i,a,o=max(arguments.length,2);for(t=Object(value$1(t)),a=function(i){try{t[i]=r[i]}catch(e){n||(n=e)}},i=1;i<o;++i)keys$1(r=arguments[i]).forEach(a);if(void 0!==n)throw n;return t},assign$2=isImplemented$2()?Object.assign:shim$1,isValue$2=isValue$5,forEach=Array.prototype.forEach,create=Object.create,process$1=function(e,t){var r;for(r in e)t[r]=e[r]},normalizeOptions=function(e){var t=create(null);return forEach.call(arguments,(function(e){isValue$2(e)&&process$1(Object(e),t)})),t},str="razdwatrzy",isImplemented=function(){return"function"==typeof str.contains&&(!0===str.contains("dwa")&&!1===str.contains("foo"))},indexOf=String.prototype.indexOf,shim=function(e){return indexOf.call(this,e,arguments[1])>-1},contains$2=isImplemented()?String.prototype.contains:shim,isValue$1=is$4,isPlainFunction=is,assign$1=assign$2,normalizeOpts=normalizeOptions,contains$1=contains$2,d$1=d$2.exports=function(e,t){var r,n,i,a,o;return arguments.length<2||"string"!=typeof e?(a=t,t=e,e=null):a=arguments[2],isValue$1(e)?(r=contains$1.call(e,"c"),n=contains$1.call(e,"e"),i=contains$1.call(e,"w")):(r=i=!0,n=!1),o={value:t,configurable:r,enumerable:n,writable:i},a?assign$1(normalizeOpts(a),o):o};d$1.gs=function(e,t,r){var n,i,a,o;return"string"!=typeof e?(a=r,r=t,t=e,e=null):a=arguments[3],isValue$1(t)?isPlainFunction(t)?isValue$1(r)?isPlainFunction(r)||(a=r,r=void 0):r=void 0:(a=t,t=r=void 0):t=void 0,isValue$1(e)?(n=contains$1.call(e,"c"),i=contains$1.call(e,"e")):(n=!0,i=!1),o={get:t,set:r,configurable:n,enumerable:i},a?assign$1(normalizeOpts(a),o):o};var validCallable=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e};!function(e,t){var r,n,i,a,o,s,u,c=d$2.exports,l=validCallable,d=Function.prototype.apply,h=Function.prototype.call,f=Object.create,p=Object.defineProperty,g=Object.defineProperties,y=Object.prototype.hasOwnProperty,m={configurable:!0,enumerable:!1,writable:!0};n=function(e,t){var n,a;return l(t),a=this,r.call(this,e,n=function(){i.call(a,e,n),d.call(t,this,arguments)}),n.__eeOnceListener__=t,this},a=function(e){var t,r,n,i,a;if(y.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"===_typeof$7(i)){for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];for(i=i.slice(),t=0;n=i[t];++t)d.call(n,this,a)}else switch(arguments.length){case 1:h.call(i,this);break;case 2:h.call(i,this,arguments[1]);break;case 3:h.call(i,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];d.call(i,this,a)}},o={on:r=function(e,t){var r;return l(t),y.call(this,"__ee__")?r=this.__ee__:(r=m.value=f(null),p(this,"__ee__",m),m.value=null),r[e]?"object"===_typeof$7(r[e])?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},once:n,off:i=function(e,t){var r,n,i,a;if(l(t),!y.call(this,"__ee__"))return this;if(!(r=this.__ee__)[e])return this;if("object"===_typeof$7(n=r[e]))for(a=0;i=n[a];++a)i!==t&&i.__eeOnceListener__!==t||(2===n.length?r[e]=n[a?0:1]:n.splice(a,1));else n!==t&&n.__eeOnceListener__!==t||delete r[e];return this},emit:a},s={on:c(r),once:c(n),off:c(i),emit:c(a)},u=g({},s),e.exports=t=function(e){return null==e?f(u):g(Object(e),s)},t.methods=o}(eventEmitter,eventEmitter.exports);var EventEmitter=eventEmitter.exports,DESCRIPTORS$4=descriptors,uncurryThis$6=functionUncurryThis,objectKeys$1=objectKeys$4,toIndexedObject$2=toIndexedObject$e,$propertyIsEnumerable$1=objectPropertyIsEnumerable.f,propertyIsEnumerable=uncurryThis$6($propertyIsEnumerable$1),push$2=uncurryThis$6([].push),createMethod=function(e){return function(t){for(var r,n=toIndexedObject$2(t),i=objectKeys$1(n),a=i.length,o=0,s=[];a>o;)r=i[o++],DESCRIPTORS$4&&!propertyIsEnumerable(n,r)||push$2(s,e?[r,n[r]]:n[r]);return s}},objectToArray={entries:createMethod(!0),values:createMethod(!1)},$$l=_export,$values=objectToArray.values;$$l({target:"Object",stat:!0},{values:function(e){return $values(e)}});var isValue=isValue$5,map={function:!0,object:!0},isObject$7=function(e){return isValue(e)&&map[_typeof$7(e)]||!1},isObject$6=isObject$7,validObject=function(e){if(!isObject$6(e))throw new TypeError(e+" is not an Object");return e},value=validObject,hasOwnProperty$1=Object.prototype.hasOwnProperty,allOff=function(e){var t,r=arguments[1];if(value(e),void 0===r)hasOwnProperty$1.call(e,"__ee__")&&delete e.__ee__;else{if(!(t=hasOwnProperty$1.call(e,"__ee__")&&e.__ee__))return;t[r]&&delete t[r]}},RETRY_MAX$1=10,PRELOADER$1=function(){function e(t,r,n,i,a){_classCallCheck$4(this,e),EventEmitter(this),this.state=STATES$2.PREPARE,this.options=t||{},this.logger=t.logger||function(){},this._preloadManager=r,this.player=r.player;var o=n.handlers,s=n.predictInst,u=n.readyPromise;this._predictInst=s,this._handlers=o,this._predictInstReadyPromise=u,this._toLoadList=[],this.retryCount=0,this._cachedHandler=i,this._cachedDataHanlder=a,this.cnt=0}return _createClass$5(e,[{key:"start",value:function(){var e=this,t=new ProxyPromise$1;return this._handlers.start(this.options).then((function(r){r.onObtain().then((function(n){e._predictInstReadyPromise.then((function(){e._predictInst.updateMediaInfos(n);var i=e._predictInst.preloadPredict(e.options),a=e._predictInst.cachedData;e._cachedDataHanlder(Object.assign({vid:e.options.vid},{data:a}));var o=Object.assign(i,e.options);r.onTransform(o).then((function(r){e._toLoadList=r,t.resolve(r)}))}))}))})).catch((function(e){t.reject(new Error("preload unit start error"))})),t}},{key:"preloadSeg",value:function(){var e=this;if(0===this._toLoadList.length)return this.state=STATES$2.FINISH,void this.emit(PRELOAD_SEG_DONE$1,!0);this.state="PRELOADING";var t=this._toLoadList.shift();this._handlers.onRequest(t,(function(r){var n=Object.assign({},t.extData,r);e._cachedHandler(n)})).then((function(){e.state=STATES$2.IDLE,e.emit(PRELOAD_SEG_DONE$1)})).catch((function(t){e.requestError(),e.emit(PRELOAD_SEG_DONE$1,!1)}))}},{key:"requestError",value:function(){this.retryCount++,this.state=STATES$2.IDLE,this.retryCount>=RETRY_MAX$1&&(this.state=STATES$2.FINISH),this.emit(ONE_STEP_DONE$1),this.logger("preload request error")}},{key:"cancelLoading",value:function(){this._toLoadList=[]}},{key:"destroy",value:function(){allOff(this)}}]),e}();function getIDB$1(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){}}var idb$2=getIDB$1(),idb$1$1=idb$2;function isIndexedDBValid$1(){try{if(!idb$1$1||!idb$1$1.open)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),r="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||r)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function executeCallback$1(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function executeTwoCallbacks$1(e,t,r){"function"==typeof t&&e.then(t),"function"==typeof r&&e.catch(r)}function normalizeKey$1(e){return"string"!=typeof e&&(console.warn("".concat(e," used as a key, but it is not a string.")),e=String(e)),e}var dbContexts$1={},READ_ONLY$1="readonly",READ_WRITE$1="readwrite";function _deferReadiness$1(e){var t=dbContexts$1[e.name],r={};r.promise=new Promise((function(e,t){r.resolve=e,r.reject=t})),t.deferredOperations.push(r),t.dbReady?t.dbReady=t.dbReady.then((function(){return r.promise})):t.dbReady=r.promise}function _advanceReadiness$1(e){var t=dbContexts$1[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function _rejectReadiness$1(e,t){var r=dbContexts$1[e.name].deferredOperations.pop();if(r)return r.reject(t),r.promise}function _getConnection$1(e,t){return new Promise((function(r,n){if(dbContexts$1[e.name]=dbContexts$1[e.name]||createDbContext$1(),e.db){if(!t)return r(e.db);_deferReadiness$1(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var a=idb$1$1.open.apply(idb$1$1,i);t&&(a.onupgradeneeded=function(t){var r=a.result;try{r.createObjectStore(e.storeName)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),n(a.error)},a.onsuccess=function(){r(a.result),_advanceReadiness$1(e)}}))}function _getOriginalConnection$1(e){return _getConnection$1(e,!1)}function _getUpgradedConnection$1(e){return _getConnection$1(e,!0)}function _isUpgradeNeeded$1(e,t){if(!e.db)return!0;var r=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,i=e.version>e.db.version;if(n&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||r){if(r){var a=e.db.version+1;a>e.version&&(e.version=a)}return!0}return!1}function _tryReconnect$1(e){_deferReadiness$1(e);for(var t=dbContexts$1[e.name],r=t.forages,n=0;n<r.length;n++){var i=r[n];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,_getOriginalConnection$1(e).then((function(t){return e.db=t,_isUpgradeNeeded$1(e)?_getUpgradedConnection$1(e):t})).then((function(n){e.db=t.db=n;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=n})).catch((function(t){throw _rejectReadiness$1(e,t),t}))}function createTransaction$1(e,t,r,n){void 0===n&&(n=1);try{var i=e.db.transaction(e.storeName,t);r(null,i)}catch(a){if(n>0&&(!e.db||"InvalidStateError"===a.name||"NotFoundError"===a.name))return Promise.resolve().then((function(){if(!e.db||"NotFoundError"===a.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),_getUpgradedConnection$1(e)})).then((function(){return _tryReconnect$1(e).then((function(){createTransaction$1(e,t,r,n-1)}))})).catch(r);r(a)}}function createDbContext$1(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}var AsyncStorage$1=function(){function t(){_classCallCheck$4(this,t)}return _createClass$5(t,[{key:"ready",value:function(){return this._ready}},{key:"_initStorage",value:function(e){var t=this;t._defaultConfig=e;var r={db:null};if(e)for(var n in e)r[n]=e[n];var i=dbContexts$1[r.name];i||(i=createDbContext$1(),dbContexts$1[r.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=t._fullyReady);var a=[];function o(){return Promise.resolve()}for(var s=0;s<i.forages.length;s++){var u=i.forages[s];u!==t&&a.push(u._initReady().catch(o))}var c=i.forages.slice(0);return t._ready=Promise.all(a).then((function(){return r.db=i.db,_getOriginalConnection$1(r)})).then((function(e){return r.db=e,_isUpgradeNeeded$1(r,t._defaultConfig.version)?_getUpgradedConnection$1(r):e})).then((function(e){r.db=i.db=e,t._dbInfo=r;for(var n=0;n<c.length;n++){var a=c[n];a!==t&&(a._dbInfo.db=r.db,a._dbInfo.version=r.version)}})),t._ready}},{key:"probeSupport",get:function(){return isIndexedDBValid$1()}},{key:"getItem",value:function(t,r){var n=this;t=normalizeKey$1(t);var i=new Promise((function(r,i){n.ready().then((function(){createTransaction$1(n._dbInfo,READ_ONLY$1,(function(a,o){if(a)return i(a);try{var s=o.objectStore(n._dbInfo.storeName).get(t);s.onsuccess=function(){var e=s.result;void 0===e&&(e=null),r(e)},s.onerror=function(){i(s.error)}}catch(e){i(e)}}))})).catch(i)}));return executeCallback$1(i,r),i}},{key:"setItem",value:function(t,r,n){var i=this;t=normalizeKey$1(t);var a=new Promise((function(n,a){i.ready().then((function(){return r})).then((function(r){createTransaction$1(i._dbInfo,READ_WRITE$1,(function(o,s){if(o)return a(o);try{var u=s.objectStore(i._dbInfo.storeName);null===r&&(r=void 0);var c=u.put(r,t);s.oncomplete=function(){void 0===r&&(r=null),n(r)},s.onabort=s.onerror=function(){var e=c.error?c.error:c.transaction.error;a(e)}}catch(e){a(e)}}))})).catch(a)}));return executeCallback$1(a,n),a}},{key:"removeItem",value:function(t,r){var n=this;t=normalizeKey$1(t);var i=new Promise((function(r,i){n.ready().then((function(){createTransaction$1(n._dbInfo,READ_WRITE$1,(function(a,o){if(a)return i(a);try{var s=o.objectStore(n._dbInfo.storeName).delete(t);o.oncomplete=function(){r()},o.onerror=function(){i(s.error)},o.onabort=function(){var e=s.error?s.error:s.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return executeCallback$1(i,r),i}},{key:"clear",value:function(t){var r=this,n=new Promise((function(t,n){r.ready().then((function(){createTransaction$1(r._dbInfo,READ_WRITE$1,(function(i,a){if(i)return n(i);try{var o=a.objectStore(r._dbInfo.storeName).clear();a.oncomplete=function(){t()},a.onabort=a.onerror=function(){var e=o.error?o.error:o.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return executeCallback$1(n,t),n}},{key:"length",value:function(t){var r=this,n=new Promise((function(t,n){r.ready().then((function(){createTransaction$1(r._dbInfo,READ_ONLY$1,(function(i,a){if(i)return n(i);try{var o=a.objectStore(r._dbInfo.storeName).count();o.onsuccess=function(){t(o.result)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return executeCallback$1(n,t),n}},{key:"all",value:function(t){var r=this,n=new Promise((function(t,n){r.ready().then((function(){createTransaction$1(r._dbInfo,READ_ONLY$1,(function(i,a){if(i)return n(i);try{var o=a.objectStore(r._dbInfo.storeName).openCursor(),s=[];o.onsuccess=function(){var e=o.result;e?(s.push({key:e.key,value:e.value}),e.continue()):t(s)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return executeCallback$1(n,t),n}},{key:"_fullyReady",value:function(e){var t=this,r=t._initReady().then((function(){var e=dbContexts$1[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return executeTwoCallbacks$1(r,e,e),r}}]),t}(),IndexedDB$1=AsyncStorage$1,MemoryCache$2=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,[{key:"_initStorage",value:function(e){var t=e.name+"_"+e.storeName;return this.key=t,window[t]&&"object"===_typeof$4(window[t])||(window[t]={}),this.store=window[t],Promise.resolve()}},{key:"getItem",value:function(e,t){var r=this.store[e];return void 0===r&&(r=null),this._internalPromise(t,r)}},{key:"setItem",value:function(e,t,r){return this.store[e]=t,this._internalPromise(r)}},{key:"removeItem",value:function(e,t){return delete this.store[e],this._internalPromise(t)}},{key:"clear",value:function(e){return this.store={},window[this.key]={},this._internalPromise(e)}},{key:"length",value:function(e){var t=Object.keys(this.store).length;return this._internalPromise(e,t)}},{key:"_internalPromise",value:function(e,t){var r=t?Promise.resolve(t):Promise.resolve();return executeCallback$1(r,e),r}},{key:"all",value:function(e){for(var t=[],r=Object.keys(this.store),n=0;n<r.length;n++){var i=r[n];t.push({key:i,value:this.store[i]})}return this._internalPromise(e,t)}},{key:"probeSupport",value:function(){return!0}}]),e}(),MemoryCache$1$1=MemoryCache$2,DefaultConfig$1={description:"",name:"__PRE_CACHE__",storeName:"keyvaluepairs",version:1},SPLIT$1="|",SESSION_KEY$1="__PRE_CACHE__KEYS",TIMESPLIT$1="$",MAX_CACHE$1=200,PreloadCache$2=function(){function e(t,r){_classCallCheck$4(this,e);var n=r===CACHE_TYPES$1.MEMORY?MemoryCache$1$1:IndexedDB$1;this._driver=new n,this._driver._initStorage(DefaultConfig$1).catch((function(){})),this._hasIdbForbidden=!1,this._maxCache=!t||t<=0?MAX_CACHE$1:t,this.setMaxCache(this._maxCache),this._allCachedKeys={},this._allCachedTimeKeys={},this.getCachedKeysFromLocal(),this._readyPromise=new ProxyPromise$1,this.init()}return _createClass$5(e,[{key:"getCachedKeysFromLocal",value:function(){var e=proxyLocalStorage$1.getItem(SESSION_KEY$1);if(e)for(var t=e.split(SPLIT$1),r=0;r<t.length;r++){var n=t[r],i=this._getCacheKeyInfos(n),a=i.time,o=i.cachedKey;this._allCachedKeys[o]=1,this._allCachedTimeKeys[o]=a}}},{key:"_getCacheKeyInfos",value:function(e){var t,r=e.split(TIMESPLIT$1);return 2===r.length&&(t=r[0],e=r[1]),{time:t,cachedKey:e}}},{key:"writeCachedKeysToLocal",value:function(e){var t=[];this._allCachedKeys={},this._allCachedTimeKeys={};for(var r=0;r<e.length;r++){var n=e[r].key,i=this._getCacheKeyInfos(n),a=i.time,o=i.cachedKey;this._allCachedKeys[o]=1,this._allCachedTimeKeys[o]=a,t.push(n)}var s=t.join(SPLIT$1);proxyLocalStorage$1.setItem(SESSION_KEY$1,s)}},{key:"init",value:function(){var e=this;this._driver.setItem("test","test").then((function(){})).catch((function(){e._hasIdbForbidden=!0})).finally((function(){e._driver.removeItem("test").catch((function(){})),e._hasIdbForbidden&&(e._driver=new MemoryCache$1$1,e._driver._initStorage(DefaultConfig$1)),e._getAll(),e._readyPromise.resolve()}))}},{key:"_getAll",value:function(){var e=this;this._driver.all().then((function(t){e._cachedLength=t.length;var r=t.length-e._maxCache,n=t;if(r>0){var i=t.slice(0,r);n=t.slice(r);for(var a=0;a<i.length;a++)e.removeItem(i[a].key).then((function(){}))}e.writeCachedKeysToLocal(n)})).catch((function(){}))}},{key:"getItem",value:function(e,t){if(!this.hasItem(e))return Promise.resolve(!1);var r=this._getTimeKey(e).timeKey;return this._driver.getItem(r,t)}},{key:"setItem",value:function(e,t,r){var n=this;this._getTimeKey(e).timeKey&&this.removeItem(e);var i=(new Date).getTime();this._allCachedKeys[e]=1,this._allCachedTimeKeys[e]=i;var a=this._genTimeKey(e,i);return r=r?function(){n._getAll(),r()}:function(){n._getAll()},this._driver.setItem(a,t,r)}},{key:"_getTimeKey",value:function(e){var t=this._allCachedTimeKeys[e],r=e;return t&&(r=this._genTimeKey(e,t)),{timeKey:r,time:t}}},{key:"_genTimeKey",value:function(e,t){return"".concat(t).concat(TIMESPLIT$1).concat(e)}},{key:"removeItem",value:function(e,t){var r=this._getTimeKey(e).timeKey,n=this._driver.removeItem(r,t);return delete this._allCachedKeys[e],delete this._allCachedTimeKeys[e],n}},{key:"hasItem",value:function(e){return!!this._allCachedKeys[e]}},{key:"clear",value:function(e){return this._driver.clear(e)}},{key:"length",value:function(e){return this._driver.length(e)}},{key:"setMaxCache",value:function(e){"number"==typeof e&&e>0&&(this._maxCache=e)}}]),e}(),PreloadCache$1$1=PreloadCache$2,PRELOADER_KEY$1="DEFAULT",PreloaderManager$2=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck$4(this,e),EventEmitter(this),this._preloadDataList=[],this._currentPreloadInst=null,this._dashPreloadList=[],this.autoPreload=t.autoPreload||!1,this._onPreloadNext=this.onPreloadNextReady.bind(this),this.on(PRELOAD_NEXT$3,this._onPreloadNext),this._preloaderConfigs={},this.update(t,r,n),this._cacheInst=new PreloadCache$1$1(t.preloadMaxCacheCount,t.preloadCacheType),this._preloadCacheProgress={},this._ptag_=!0,this._cachedDatas={}}return _createClass$5(e,[{key:"_getProloaderKey",value:function(e){return e.vtype?e.vtype:PRELOADER_KEY$1}},{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!r)throw new Error("PreloaderManager predictInst is null");var n=this._getProloaderKey(e);this._preloaderConfigs[n]={predictInst:r,readyPromise:r.init(e),handlers:t}}},{key:"cachedDatas",get:function(){return this._cachedDatas}},{key:"onCacheSegment",value:function(e){var t=e.vid,r=e.format,n=e.cacheKey,i=e.total,a=e.loaded,o=e.isInitSegment,s=e.mediaType,u=this.getProgressCacheKey(t,r,s),c=this._preloadCacheProgress[u];c||(c=this._preloadCacheProgress[u]={}),c[n]={total:i,loaded:a,isInitSegment:o}}},{key:"onCachePredict",value:function(e){var t=e.vid,r=e.data;t&&r&&(this._cachedDatas[t]=r)}},{key:"getProgressCacheKey",value:function(e,t,r){return"".concat(e,"-").concat(t,"-").concat(r)}},{key:"onPreloadNextReady",value:function(){this.onPreloadNext()}},{key:"onPreloadSegDone",value:function(){this.autoPreload&&this.emit(PRELOAD_NEXT$3)}},{key:"onPreloadNext",value:function(){var e=this;if(null==this._currentPreloadInst&&this._preloadDataList.length>0){if(this._preloadDataList.length>0){var t=this._preloadDataList.shift().data;if(t.payload){var r=this._getProloaderKey(t),n=this._preloaderConfigs[r];if(!n)return void console.warn("need to set vtype, no preloader",t);this._currentPreloadInst=new PRELOADER$1(t,this,n,(function(t){e.onCacheSegment(t)}),(function(t){e.onCachePredict(t)})),this._currentPreloadInst.on(PRELOAD_SEG_DONE$1,this.onPreloadSegDone.bind(this)),this._currentPreloadInst.start().then((function(){e._currentPreloadInst.preloadSeg()})).catch((function(){e._currentPreloadInst=null}))}}}else null!=this._currentPreloadInst&&(this._currentPreloadInst.state===STATES$2.IDLE?this._currentPreloadInst.preloadSeg():this._currentPreloadInst.state===STATES$2.FINISH?(this._currentPreloadInst.destroy(),this._currentPreloadInst=null):this._currentPreloadInst.state===STATES$2.PREPARE&&(this._currentPreloadInst.cnt++,this._currentPreloadInst.cnt>2&&(this._currentPreloadInst.destroy(),this._currentPreloadInst=null)))}},{key:"addDashPreloader",value:function(e){e&&e.data&&(this._preloadDataList.push(e),this.sort(this._preloadDataList),this.autoPreload&&this.emit(PRELOAD_NEXT$3))}},{key:"_addDashPreloader",value:function(e){e&&e.data&&this._preloadDataList.push(e)}},{key:"addDashPreloaderList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.sort(e);for(var t=0;t<e.length;t++)this._addDashPreloader(e[t])}},{key:"sort",value:function(e){e.sort((function(e,t){return void 0===e.order&&void 0===e.order||e.order<t.order?-1:1}))}},{key:"destroy",value:function(){this.off(PRELOAD_NEXT$3,this._onPreloadNext)}},{key:"cancelLoading",value:function(){this._currentPreloadInst&&(this._currentPreloadInst.cancelLoading(),this._currentPreloadInst=null),this._preloadDataList=[]}},{key:"preloadCacheProgress",value:function(e){var t=e.vid,r=e.format,n=e.mediaType,i=e.prelaodType,a=e.bitrate,o=e.set_duration,s=e.set_size,u=e.media_type,c=e.start_time,l=this.getProgressCacheKey(t,r,n),d=this._preloadCacheProgress[l];if(d){for(var h=Object.values(d),f=0,p=0,g=0,y=0,m=0,v=0;v<h.length;v++){var _=h[v];_.isInitSegment&&(f=_.total,g=_.loaded,y=_.loaded===_.total?DOWN_STATES$1.SUCCESS:DOWN_STATES$1.DOWNLOADING),p+=_.total,m+=_.loaded}return{media_type:u,preload_type:i,stream_bitrate:a,header_size:f,content_total_size:p,start_time:c||-1,state_info:{set_duration:o,set_size:s,current_header_download_size:g,current_content_download_size:m,header_download_state:y,content_download_state:m===p?DOWN_STATES$1.SUCCESS:DOWN_STATES$1.DOWNLOADING}}}return null}},{key:"getPreloadTaskInfos",value:function(){}},{key:"getItem",value:function(e,t){return this._cacheInst.getItem(e,t)}},{key:"setItem",value:function(e,t,r){return this._cacheInst.setItem(e,t,r)}},{key:"removeItem",value:function(e,t){return this.removeItem(e,t)}}],[{key:"getInstance",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.GLOBAL_KEY+(t.globalKey?t.globalKey:""),a=window[i];if(a&&a._ptag_)return a.update(t,r,n),a;var o=new e(t,r,n);return window[i]=o,o}}]),e}();PreloaderManager$2.GLOBAL_KEY="__preloadcontext__";var PreloaderManager$1$1=PreloaderManager$2,PreloaderBase$1=function(){function t(e){_classCallCheck$4(this,t),EventEmitter(this),this.options=e,this.promisePolyfill(),this.before(),this.check(),this._preloadManager=PreloaderManager$1$1.getInstance(e,this.handlers,this.predictInst),this.loadingTasks=[]}return _createClass$5(t,[{key:"promisePolyfill",value:function(){Promise.prototype.finally||(Promise.prototype.finally={finally:function(e){var t=function(t){return Promise.resolve(e()).then(t)};return this.then((function(e){return t((function(){return e}))}),(function(e){return t((function(){return Promise.reject(e)}))}))}}.finally)}},{key:"before",value:function(){throw new Error("need")}},{key:"check",value:function(){if(!this.handlers)throw new Error("handlers null");if(!this.handlers.start||!this.handlers.onRequest)throw new Error("handlers callback null");if(!this.predictInst)throw new Error("predictInst null");if(!this.predictInst.__p__)throw new Error("predictInst need extends predictbase")}},{key:"preloadNext",value:function(){this._preloadManager.emit(PRELOAD_NEXT$3)}},{key:"preloadManager",get:function(){return this._preloadManager}},{key:"start",value:function(e){throw new Error("start need implment, return Promise")}},{key:"cancelLoading",value:function(){for(var t=0;t<this.loadingTasks.length;t++)try{var r=this.loadingTasks[t];"function"==typeof r.cancel&&r.cancel()}catch(e){}this.loadingTasks=[],this._preloadManager.cancelLoading()}},{key:"addTasker",value:function(e){this.loadingTasks.push(e)}},{key:"removeTasker",value:function(e){var t=this;setTimeout((function(){for(var r=t.loadingTasks.length-1;r>-1;r--)if(t.loadingTasks[r]===e){t.loadingTasks.splice(r,1);break}}))}},{key:"addDashPreloader",value:function(e){this._preloadManager.addDashPreloader(e)}},{key:"addDashPreloaderList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._preloadManager.addDashPreloaderList(e)}}]),t}(),PredictBase$1=function(){function e(){_classCallCheck$4(this,e),this.bandwidth2item={},this._mediaInfos=null,this.__p__=!0}return _createClass$5(e,[{key:"init",value:function(){throw new Error("init func not implement, return promise")}},{key:"preloadPredict",value:function(e){throw new Error("preloadPredict error",e)}},{key:"updateMediaInfos",value:function(e){if(this._mediaInfos=e,this.bandwidth2item={},this.dynamic_video=e&&e.dynamic_video_list,this.dynamic_video&&this.dynamic_video.length>0)for(var t=0;t<this.dynamic_video.length;t++){var r=this.dynamic_video[t];this.bandwidth2item[r.bitrate||r.bandwidth]=r}}},{key:"getIdx",value:function(e,t){var r=0;return e.forEach((function(e,n){e.definition===t&&(r=n)})),r}},{key:"cachedData",get:function(){return null}}]),e}(),VTYPES$2=VTYPES$3,$$k=_export,$every=arrayIteration.every,arrayMethodIsStrict$1=arrayMethodIsStrict$8,STRICT_METHOD$1=arrayMethodIsStrict$1("every");$$k({target:"Array",proto:!0,forced:!STRICT_METHOD$1},{every:function(e){return $every(this,e,arguments.length>1?arguments[1]:void 0)}});var XHR$1=_createClass$3((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.url,n=t.method,i=void 0===n?"GET":n,a=t.type,o=void 0===a?"arraybuffer":a,s=t.data,u=void 0===s?{}:s;return _classCallCheck$2(this,e),new Promise((function(e,t){var n=new window.XMLHttpRequest,a=i.toUpperCase(),s=[];for(var c in o&&(n.responseType=o),u)s.push("k=".concat(u[c]));if("GET"===a)n.open(a,"".concat(r,"?").concat(s.join("&"))),n.send();else{if("POST"!==a)throw new Error("xhr ".concat(a," is not supported"));n.open(a,r,!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(u))}n.onload=function(){200===n.status||206===n.status?e(n):t(n)},n.onerror=function(){t(n)}}))})),ERROR_TYPE_CODE={data:1e3,runtime:1002,parse:1004,other:9999,notSupport:1005,canplay:1006,bufferbreak:1007,network:1003,pdnetwork:1008,licetwork:1009,media:1010},Errors=_createClass$3((function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;_classCallCheck$2(this,e);var a={errorType:t,errorTypeCode:ERROR_TYPE_CODE[t],errorCode:r,playerVersion:"3.0.45"};return n&&"object"===_typeof$3(n)&&Object.keys(n).map((function(e){return a[e]=n[e],e})),i&&(a.currentTime=i.currentTime||0,a.duration=i.duration||0,a.ended=i.ended?0:1,a.vtype="dash"===i.playerType?"DASH":"LOWER_MP4",i.config&&(a.vid=i.config.vid),i.error&&(a.videoError=i.error)),a}));Errors.NETWORK="network",Errors.PD_NETWORK="pdnetwork",Errors.LIC_NETWORK="licetwork",Errors.MSE="mse",Errors.PARSE="parse",Errors.FORMAT="format",Errors.DECODER="decoder",Errors.RUNTIME="runtime",Errors.CANPLAY="canplay",Errors.BUFFERBREAK="bufferbreak",Errors.TIMEOUT="timeout",Errors.OTHER="other",Errors.MEDIA="media",Errors.NETEORK_ERROR_CODES={timeout:-499895,401:-499898,403:-499897,404:-499898},Errors.MPD_PARSE_ERROR=-499970,Errors.MSE_PARSE_ERROR=-499971,Errors.DUR_PARSE_ERROR=-499972,Errors.SEG_PARSE_ERROR=-499973,Errors.LIC_PARSE_ERROR=-499974,Errors.SID_PARSE_ERROR=-499975,Errors.HEADER_PARSE_ERROR=-499976,Errors.BUF_PARSE_ERROR=-499977,Errors.BYTE_PARSE_ERROR=-499978,Errors.BOX_KEY_ERROR=-499983,Errors.NO_CANPLAY_ERROR=-499985,Errors.BUFFERBREAK_ERROR=-499986,Errors.NETWORK_DISCONNECT=-499900,Errors.CDM_LICENSE_ERROR=-499901,Errors.MSE_MEDIA_TYPES_NOT_SUPPORTED=-499902,Errors.INIT_SEGMENT_ERROR=-499903,Errors.MSE_APPEND_ERROR=-499904;var $$j=_export,ArrayBufferModule=arrayBuffer,NATIVE_ARRAY_BUFFER=arrayBufferBasicDetection;$$j({global:!0,constructor:!0,forced:!NATIVE_ARRAY_BUFFER},{DataView:ArrayBufferModule.DataView});var Stream=function(){function e(t){if(_classCallCheck$2(this,e),!(t instanceof ArrayBuffer))throw new Errors(Errors.PARSE,Errors.BUF_PARSE_ERROR,{line:9,handle:"[Stream] constructor",msg:"data is valid"});this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}return _createClass$3(e,[{key:"position",get:function(){return this.dataview.position},set:function(e){this.dataview.position=e}},{key:"skip",value:function(t){for(var r=Math.floor(t/4),n=t%4,i=0;i<r;i++)e.readByte(this.dataview,4);n>0&&e.readByte(this.dataview,n)}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return e.readByte(this.dataview,2)}},{key:"readUint24",value:function(){return e.readByte(this.dataview,3)}},{key:"readUint32",value:function(){return e.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return e.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this.dataview,4,!0)}},{key:"readString",value:function(e){if(this.position+e<=this.buffer.byteLength){for(var t="",r=0;r<e;r++)t+=String.fromCharCode(this.readUint8());return t}throw new Errors(Errors.PARSE,Errors.BYTE_PARSE_ERROR,{line:124,handle:"[Stream] readString",msg:"readstring error"})}}],[{key:"readByte",value:function(e,t,r){var n;switch(t){case 1:n=r?e.getInt8(e.position):e.getUint8(e.position);break;case 2:n=r?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(r)throw new Error("not supported for readByte 3");n=e.getUint8(e.position)<<16,n|=e.getUint8(e.position+1)<<8,n|=e.getUint8(e.position+2);break;case 4:n=r?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(r)throw new Errors(Errors.PARSE,Errors.BYTE_PARSE_ERROR,{line:73,handle:"[Stream] readByte",msg:"not supported for readBody 8"});n=e.getUint32(e.position)<<32,n|=e.getUint32(e.position+4);break;default:n=""}return e.position+=t,n}}]),e}(),Box=function(){function e(){_classCallCheck$2(this,e),this.headSize=8,this.size=0,this.type="",this.subBox=[],this.start=-1}return _createClass$3(e,[{key:"readHeader",value:function(e){if(this.start=e.position,this.size=e.readUint32(),this.type=String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),1===this.size)this.size=e.readUint64();else if(0===this.size&&"mdat"!==this.type)throw new Errors(Errors.PARSE,Errors.HEADER_PARSE_ERROR,{line:20,handle:"[Box] readHeader",msg:"parse mp4 mdat box failed"});if("uuid"===this.type)for(var t=[],r=0;r<16;r++)t.push(e.readUint8())}},{key:"readBody",value:function(t){var r,n=this.size-t.position+this.start,i=this.type;this.data=t.buffer.slice(t.position,t.position+n),t.position+=this.data.byteLength,(r=e.containerBox.find((function(e){return e===i}))?e.containerParser:e[i])&&r instanceof Function&&r.call(this)}},{key:"read",value:function(e){this.readHeader(e),this.readBody(e)}}],[{key:"containerParser",value:function(){for(var t=new Stream(this.data),r=t.buffer.byteLength;t.position<r;){var n=new e;n.readHeader(t),this.subBox.push(n),n.readBody(t)}delete this.data,t=null}},{key:"parseSampleFlags",value:function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}}}]),e}();Box.containerBox=["moov","trak","edts","mdia","minf","dinf","stbl","mvex","moof","traf","mfra","udta"];var concat={};Object.defineProperty(concat,"__esModule",{value:!0}),concat.default=function(e){for(var t=0,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var a=!0,o=!1,s=void 0;try{for(var u,c=n[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var l=u.value;t+=l.length}}catch(_){o=!0,s=_}finally{try{!a&&c.return&&c.return()}finally{if(o)throw s}}var d=new e(t),h=0,f=!0,p=!1,g=void 0;try{for(var y,m=n[Symbol.iterator]();!(f=(y=m.next()).done);f=!0){var v=y.value;d.set(v,h),h+=v.length}}catch(_){p=!0,g=_}finally{try{!f&&m.return&&m.return()}finally{if(p)throw g}}return d};var _concat=concat,_concat2=_interopRequireDefault(_concat);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var lib$1=_concat2.default;function MP4DecConfigDescrTag(e){var t,r=new Box;return r.type=e.readUint8(),128===(t=e.readUint8())?(r.extend=!0,e.skip(2),t=e.readUint8()+5):t+=2,r.size=t,r.typeID=e.readUint8(),r.streamUint=e.readUint8(),r.bufferSize=Stream.readByte(e.dataview,3),r.maximum=e.readUint32(),r.average=e.readUint32(),r.subBox.push(Box.MP4DecSpecificDescrTag(e)),r}function MP4DecSpecificDescrTag(e){var t,r,n=new Box;n.type=e.readUint8(),128===(t=e.readUint8())?(n.extend=!0,e.skip(2),r=(t=e.readUint8()+5)-5):(r=t,t+=2),n.size=t;for(var i=[],a=0;a<r;a++)i.push(Number(e.readUint8()).toString(16).padStart(2,"0"));return n.EScode=i,delete n.subBox,n}function MP4ESDescrTag(e){var t,r=new Box;return r.type=e.readUint8(),128===(t=e.readUint8())?(r.extend=!0,e.skip(2),t=e.readUint8()+5):t+=2,r.size=t,r.esID=e.readUint16(),r.priority=e.readUint8(),r.subBox.push(Box.MP4DecConfigDescrTag(e)),r.subBox.push(Box.SLConfigDescriptor(e)),r}function SLConfigDescriptor(e){var t,r=new Box;return r.type=e.readUint8(),128===(t=e.readUint8())?(r.extend=!0,e.skip(2),t=e.readUint8()+5):t+=2,r.size=t,r.SL=e.readUint8(),delete r.subBox,r}function av01(){var e=new Stream(this.data);for(this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),e.skip(2),this.data_reference_index=e.readUint16(),e.skip(16),this.width=e.readUint16(),this.height=e.readUint16(),e.skip(50);e.position<e.buffer.byteLength;){var t=new Box;t.readHeader(e),this.subBox.push(t),t.readBody(e)}delete this.data,e=null}function av1C(){var e=new Stream(this.data),t=e.readUint8();this.marker=t>>7&1,console.assert(1===this.marker,"maker should 1"),this.version=127&t,console.assert(1===this.version,"version shoud 1"),t=e.readUint8(),this.seq_profile=t>>5&7,this.seq_level_idx_0=31&t,t=e.readUint8(),this.seq_tier_0=t>>7&1,this.high_bitdepth=t>>6&1,this.twelve_bit=t>>5&1,this.monochrome=t>>4&1,this.chroma_subsampling_x=t>>3&1,this.chroma_subsampling_y=t>>2&1,this.chroma_sample_position=3&t,t=e.readUint8(),this.initial_presentation_delay_present=t>>4&1,this.initial_presentation_delay_present&&(this.initial_presentation_delay_minus_one=15&t),this.configOBUs=new Uint8Array(e.buffer.slice(e.position))}function avc1(){var e=new Stream(this.data);e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(16),this.width=e.readUint16(),this.height=e.readUint16(),this.horizresolution=e.readUint32(),this.vertresolution=e.readUint32(),e.skip(4),this.frameCount=e.readUint16(),e.skip(1);for(var t=0;t<31;t++)String.fromCharCode(e.readUint8());for(this.depth=e.readUint16(),e.skip(2);e.position<e.buffer.byteLength;){var r=new Box;r.readHeader(e),this.subBox.push(r),r.readBody(e)}delete this.data,e=null}var Golomb=function(){function e(t){_classCallCheck$2(this,e),this.TAG="Golomb",this._buffer=t,this._bufferIndex=0,this._totalBytes=t.byteLength,this._totalBits=8*t.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}return _createClass$3(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._totalBytes-this._bufferIndex,t=Math.min(4,e),r=new Uint8Array(4);r.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+t)),this._currentWord=new DataView(r.buffer).getUint32(0),this._bufferIndex+=t,this._currentWordBitsLeft=8*t}},{key:"readBits",value:function(e){var t=Math.min(this._currentWordBitsLeft,e),r=this._currentWord>>>32-t;if(e>32)throw new Error("Cannot read more than 32 bits at a time");return this._currentWordBitsLeft-=t,this._currentWordBitsLeft>0?this._currentWord<<=t:this._totalBytes-this._bufferIndex>0&&this._fillCurrentWord(),(t=e-t)>0&&this._currentWordBitsLeft?r<<t|this.readBits(t):r}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e;for(e=0;e<this._currentWordBitsLeft;e++)if(0!=(this._currentWord&2147483648>>>e))return this._currentWord<<=e,this._currentWordBitsLeft-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}(),SPSParser=function(){function e(){_classCallCheck$2(this,e)}return _createClass$3(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,r=t.byteLength,n=new Uint8Array(r),i=0,a=0;a<r;a++)a>=2&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(n[i]=t[a],i++);return new Uint8Array(n.buffer,0,i)}},{key:"parseSPS",value:function(t){var r=e._ebsp2rbsp(t),n=new Golomb(r);n.readByte();var i=n.readByte();n.readByte();var a=n.readByte();n.readUEG();var o=e.getProfileString(i),s=e.getLevelString(a),u=1,c=420,l=8;if((100===i||110===i||122===i||244===i||44===i||83===i||86===i||118===i||128===i||138===i||144===i)&&(3===(u=n.readUEG())&&n.readBits(1),u<=3&&(c=[0,420,422,444][u]),l=n.readUEG()+8,n.readUEG(),n.readBits(1),n.readBool()))for(var d=3!==u?8:12,h=0;h<d;h++)n.readBool()&&(h<6?e._skipScalingList(n,16):e._skipScalingList(n,64));n.readUEG();var f=n.readUEG();if(0===f)n.readUEG();else if(1===f){n.readBits(1),n.readSEG(),n.readSEG();for(var p=n.readUEG(),g=0;g<p;g++)n.readSEG()}n.readUEG(),n.readBits(1);var y=n.readUEG(),m=n.readUEG(),v=n.readBits(1);0===v&&n.readBits(1),n.readBits(1);var _=0,b=0,A=0,E=0;n.readBool()&&(_=n.readUEG(),b=n.readUEG(),A=n.readUEG(),E=n.readUEG());var S=1,T=1,w=0,C=!0,k=0,I=0;if(n.readBool()){if(n.readBool()){var $=n.readByte();$>0&&$<16?(S=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][$-1],T=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][$-1]):255===$&&(S=n.readByte()<<8|n.readByte(),T=n.readByte()<<8|n.readByte())}if(n.readBool()&&n.readBool(),n.readBool()&&(n.readBits(4),n.readBool()&&n.readBits(24)),n.readBool()&&(n.readUEG(),n.readUEG()),n.readBool()){var P=n.readBits(32),x=n.readBits(32);C=n.readBool(),w=(k=x)/(I=2*P)}}var R=1;1===S&&1===T||(R=S/T);var O=0,D=0;0===u?(O=1,D=2-v):(O=3===u?1:2,D=(1===u?2:1)*(2-v));var L=16*(y+1),M=16*(m+1)*(2-v);L-=(_+b)*O,M-=(A+E)*D;var N=Math.ceil(L*R);return n.destroy(),n=null,{profile_string:o,level_string:s,bit_depth:l,chroma_format:c,chroma_format_string:e.getChromaFormatString(c),frame_rate:{fixed:C,fps:w,fps_den:I,fps_num:k},par_ratio:{width:S,height:T},codec_size:{width:L,height:M},present_size:{width:N,height:M}}}},{key:"_skipScalingList",value:function(e,t){for(var r=8,n=8,i=0;i<t;i++)0!==n&&(n=(r+e.readSEG()+256)%256),r=0===n?r:n}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}},{key:"toVideoMeta",value:function(e){var t={};e&&e.codec_size&&(t.codecWidth=e.codec_size.width,t.codecHeight=e.codec_size.height,t.presentWidth=e.present_size.width,t.presentHeight=e.present_size.height),t.profile=e.profile_string,t.level=e.level_string,t.bitDepth=e.bit_depth,t.chromaFormat=e.chroma_format,t.parRatio={width:e.par_ratio.width,height:e.par_ratio.height},t.frameRate=e.frame_rate;var r=t.frameRate.fps_den,n=t.frameRate.fps_num;t.refSampleDuration=Math.floor(t.timescale*(r/n))}}]),e}();function avcC(){var e=new Stream(this.data);this.configVersion=e.readUint8(),this.profile=e.readUint8(),this.profileCompatibility=e.readUint8(),this.AVCLevelIndication=e.readUint8(),this.lengthSizeMinusOne=1+(3&e.readUint8()),this.numOfSequenceParameterSets=31&e.readUint8();var t=e.readUint16();this.sequenceLength=t;for(var r=[],n=0;n<t;n++)r.push(e.readUint8());this.spsInfo=SPSParser.parseSPS(new Uint8Array(r)),this.ppsCount=e.readUint8();var i=e.readUint16();this.ppsLength=i;for(var a=[],o=0;o<i;o++)a.push(Number(e.readUint8()).toString(16));this.pps=a,this.sps=r;for(var s=[],u=e.dataview.byteLength;e.position<u;)s.push(e.readUint8());this.last=s,delete this.subBox,delete this.data,e=null}function btrt(){var e=new Stream(this.data);this.bufferSizeDB=e.readUint32(),this.maxBitrate=e.readUint32(),this.avgBitrate=e.readUint32(),delete this.subBox,delete this.data,e=null}function co64(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)t.push(e.readUint64());delete this.subBox,delete this.data,e=null}function ctts(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.entryCount=e.readUint32();var t=[];this.entry=t;for(var r=0,n=this.entryCount;r<n;r++)t.push({count:e.readUint32(),offset:e.readUint32()});delete this.subBox,delete this.data,e=null}function dref(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3);var t=e.readUint32();this.entryCount=t;for(var r=0;r<t;r++){var n=new Box;this.subBox.push(n),n.read(e)}delete this.data,e=null}function elst(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3);var t=[],r=e.readUint32();this.entries=t;for(var n=0;n<r;n++){var i={};t.push(i),1===this.version?(i.segment_duration=e.readUint64(),i.media_time=e.readUint64()):(i.segment_duration=e.readUint32(),i.media_time=e.readInt32()),i.media_rate_integer=e.readInt16(),i.media_rate_fraction=e.readInt16()}delete this.subBox,e=null}function enca(){var e=new Stream(this.data);for(e.readUint16(),e.readUint16(),e.readUint16(),this.data_reference_index=e.readUint16(),e.readUint32(),e.readUint32(),this.channelCount=e.readUint16(),this.samplesize=e.readUint16(),e.readUint16(),e.readUint16(),this.sampleRate=e.readUint32()/65536;e.position<e.buffer.byteLength;){var t=new Box;t.readHeader(e),this.subBox.push(t),t.readBody(e)}e=null}function encv(){var e=new Stream(this.data);for(e.readUint16(),e.readUint16(),e.readUint16(),e.readUint16(),e.skip(16),this.width=e.readUint16(),this.height=e.readUint16(),this.horizresolution=e.readUint32(),this.vertresolution=e.readUint32(),e.readUint32(),this.frame_count=e.readUint16(),e.skip(32),this.depth=e.readUint16(),e.readUint16();e.position<e.buffer.byteLength;){var t=new Box;t.readHeader(e),this.subBox.push(t),t.readBody(e)}e=null}function esds(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3);var t=Box.MP4ESDescrTag(e);this.subBox.push(t),delete this.data,e=null}function frma(){var e=new Stream(this.data);this.data_format="";for(var t=0;t<4;t++)this.data_format+=String.fromCharCode(e.readUint8())}function ftyp(){}function hdlr(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),e.skip(4),this.handleType="".concat(String.fromCharCode(e.readUint8())).concat(String.fromCharCode(e.readUint8())).concat(String.fromCharCode(e.readUint8())).concat(String.fromCharCode(e.readUint8())),e.skip(12);for(var t=[];e.position<this.size-8;)t.push(String.fromCharCode(e.readUint8()));this.name=t.join(""),delete this.subBox,e=null}function iods(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3);for(var t=[],r=e.buffer.byteLength;e.position<r;)t.push(e.readUint8());this.content=t,delete this.subBox,delete this.data,e=null}var UTC=function(){function e(){_classCallCheck$2(this,e);var t=new Date;t.setFullYear(1904),t.setMonth(0),t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),this.time=t}return _createClass$3(e,[{key:"setTime",value:function(e){return this.time.setTime(this.time.getTime()+Number(e)),this.time.toLocaleString()}}]),e}();function mdhd(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),1===this.version?(this.create=e.readUint64(),this.modify=e.readUint64(),this.createTime=(new UTC).setTime(1e3*this.create),this.modifyTime=(new UTC).setTime(1e3*this.modify),this.timescale=e.readUint32(),this.duration=e.readUint64()):(this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new UTC).setTime(1e3*this.create),this.modifyTime=(new UTC).setTime(1e3*this.modify),this.timescale=e.readUint32(),this.duration=e.readUint32()),this.language=e.readUint16(),e.readUint16(),delete this.subBox,e=null}function mehd(){var e=new Stream(this.data);e.skip(4),this.fragment_duration=e.readUint32()}function mp4a(){var e=new Stream(this.data);e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(8),this.channelCount=e.readUint16(),this.sampleSize=e.readUint16(),e.skip(4),this.sampleRate=e.readUint32()>>16;var t=new Box;t.readHeader(e),this.subBox.push(t),t.readBody(e),delete this.data,e=null}function mvhd(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new UTC).setTime(1e3*this.create),this.modifyTime=(new UTC).setTime(1e3*this.modify),this.timeScale=e.readUint32(),this.duration=e.readUint32(),this.rate=e.readUint16()+"."+e.readUint16(),this.volume=e.readUint8()+"."+e.readUint8(),Stream.readByte(e.dataview,8),Stream.readByte(e.dataview,2);for(var t=[],r=0;r<9;r++)t.push(e.readUint16()+"."+e.readUint16());this.matrix=t,Stream.readByte(e.dataview,24),this.nextTrackID=e.readUint32(),delete this.subBox}function pasp(){var e=new Stream(this.data);this.hSpacing=e.readUint32(),this.vSpacing=e.readUint32(),e=null}function pssh(){var e=new Stream(this.data);this.version=e.readUint8(),this.flags=e.readUint24();for(var t=[],r=[],n=0;n<16;n++)r.push(util$1.toHex(e.readUint8()));if(this.version>0)for(var i=e.readUint32(),a=0;a<String(i).length;a++)for(var o=0;o<16;o++){var s=e.readUint8();t.push(util$1.toHex(s))}var u=e.readUint32();this.data_size=u,e.skip(u),this.kid=t,this.system_id=r,this.buffer=e.buffer,e=null}function saio(){var e=new Stream(this.data);this.entry_count=e.readUint32(),e=null}function saiz(){var e=new Stream(this.data);this.default_sample_info_size=e.readUint8(),e.readUint32(),this.sample_info_size=e.readUint32(),e=null}function schm(){var e=new Stream(this.data);this.scheme_version=e.readUint32(),this.scheme_type="";for(var t=0;t<4;t++)this.scheme_type+=String.fromCharCode(e.readUint8());if(1&this.flags){this.scheme_uri="";for(var r=0;r<this.size-this.hdr_size-8;r++)this.scheme_uri+=String.fromCharCode(e.readUint8())}}function senc(){var e=new Stream(this.data);this.version=e.readUint8(),this.flags=e.readUint24();var t=e.readUint32();if(this.samples=[],t)for(var r=0;r<t;r++){var n={},i=2&this.flags;if(i&&Math.floor(this.data.byteLength/t)<=16?n.InitializationVector=[e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()]:n.InitializationVector=[e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()],i){n.subsamples=[];for(var a=e.readUint16(),o=0;o<a;o++){var s={};s.BytesOfClearData=e.readUint16(),s.BytesOfProtectedData=e.readUint32(),n.subsamples.push(s)}}this.samples.push(n)}}function sidx(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.reference_ID=e.readUint32(),this.timescale=e.readUint32(),0===this.version?(this.earliest_presentation_time=e.readUint32(),this.first_offset=e.readUint32()):(this.earliest_presentation_time=e.readUint64(),this.first_offset=e.readUint64()),e.readUint16(),this.references=[];for(var t=e.readUint16(),r=0;r<t;r++){var n={};this.references.push(n);var i=e.readUint32();n.reference_type=i>>31&1,n.referenced_size=2147483647&i,n.subsegment_duration=e.readUint32(),i=e.readUint32(),n.starts_with_SAP=i>>31&1,n.SAP_type=i>>28&7,n.SAP_delta_time=268435455&i}e=null}function smhd(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.balance=e.readInt8()+"."+e.readInt8(),delete this.subBox,delete this.data,e=null}function stco(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null}function stsc(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)t.push({first_chunk:e.readUint32(),samples_per_chunk:e.readUint32(),sample_desc_index:e.readUint32()});for(var i,a,o=0,s=this.count;o<s-1;o++)i=t[o],a=t[o-1],i.chunk_count=t[o+1].first_chunk-i.first_chunk,i.first_sample=0===o?1:a.first_sample+a.chunk_count*a.samples_per_chunk;if(1===this.count){var u=t[0];u.first_sample=1,u.chunk_count=0}else if(this.count>1){var c=t[this.count-1],l=t[this.count-2];c.first_sample=l.first_sample+l.chunk_count*l.samples_per_chunk,c.chunk_count=0}delete this.subBox,delete this.data,e=null}function stsd(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.entryCount=e.readUint32();var t=new Box;t.readHeader(e),this.subBox.push(t),t.readBody(e),delete this.data,e=null}function stss(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null}function stsz(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.sampleSize=e.readUint32(),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)this.sampleSize?t.push(this.sampleSize):t.push(e.readUint32());delete this.subBox,delete this.data,e=null}function stts(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.count=e.readUint32();for(var t=[],r=0,n=this.count;r<n;r++)t.push({sampleCount:e.readUint32(),sampleDuration:e.readUint32()});this.entry=t,delete this.subBox,delete this.data,e=null}function tenc(){var e=new Stream(this.data);e.skip(6),this.default_IsEncrypted=e.readUint8(),this.default_IV_size=e.readUint8(),this.default_KID=[];for(var t=0;t<16;t++)this.default_KID.push(util$1.toHex(e.readUint8()))}function tfhd(){var e=new Stream(this.data);this.version=e.readUint8(),this.flags=e.readUint24(),e.skip(3),this.track_id=e.readUint8(),this.hdr_size=16,this.size>this.hdr_size&&1&this.flags?(this.base_data_offset=e.readUint64(),this.hdr_size=this.hdr_size+8):this.base_data_offset=0,this.size>this.hdr_size&&2&this.flags?(this.default_sample_description_index=e.readUint32(),this.hdr_size=this.hdr_size+4):this.default_sample_description_index=0,this.size>this.hdr_size&&8&this.flags?(this.default_sample_duration=e.readUint32(),this.hdr_size=this.hdr_size+4):this.default_sample_duration=0,this.size>this.hdr_size&&16&this.flags?(this.default_sample_size=e.readUint32(),this.hdr_size=this.hdr_size+4):this.default_sample_size=0,this.size>this.hdr_size&&32&this.flags?(this.default_sample_flags=e.readUint32(),this.hdr_size=this.hdr_size+4):this.default_sample_flags=0}function tkhd(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3,0),1===this.version?(this.create=e.readUint64(),this.modify=e.readUint64(),this.createTime=(new UTC).setTime(1e3*this.create),this.modifyTime=(new UTC).setTime(1e3*this.modify),this.trackID=e.readUint32(),this.reserverd=e.readUint32(),this.duration=e.readUint64()):(this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new UTC).setTime(1e3*this.create),this.modifyTime=(new UTC).setTime(1e3*this.modify),this.trackID=e.readUint32(),this.reserverd=e.readUint32(),this.duration=e.readUint32()),e.readUint64(),this.layer=e.readInt16(),this.alternate_group=e.readInt16(),this.volume=e.readInt16()>>8,e.readUint16();for(var t=[],r=0;r<9;r++)t.push(e.readUint16()+"."+e.readUint16());this.matrix=t,this.width=e.readUint16()+"."+e.readUint16(),this.height=e.readUint16()+"."+e.readUint16(),delete this.subBox,e=null}function trun(){var e=new Stream(this.data);this.version=e.readUint8(),this.flags=e.readUint24(),this.samples=[],this.sampleInfos=[];var t,r,n=1&this.flags,i=4&this.flags,a=256&this.flags,o=512&this.flags,s=1024&this.flags,u=2048&this.flags,c=e.readUint32();for(n&&(this.dataOffset=e.readUint32()),i&&c&&(r=Box.parseSampleFlags([e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()]));c>0;)c--,t={},a&&(t.duration=e.readUint32()),o&&(t.size=e.readUint32()),s&&(t.flags=Box.parseSampleFlags([e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()])),u&&(t.compositionTimeOffset=e.readUint32()),this.samples.push(t.size),this.sampleInfos.push(t);r&&this.sampleInfos.length>0&&(this.sampleInfos[0].flags=r),delete this.subBox,e=null}var findBox=util$1.findBox;function udta(){}function meta(){var e=new Stream(this.data),t=e.buffer.byteLength;this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3);for(var r=this;e.position<t;){var n=new Box;n.readHeader(e),r.subBox.push(n),n.readBody(e)}this.vid=null;var i=findBox(r,"keys"),a=findBox(r,"ilst");if(i&&a){var o=i.metaKeys.indexOf("comment");if(o>-1){var s=a.datas[o];"string"==typeof s&&s.indexOf("vid")>-1&&(this.vid=s.split(":")[1])}}if(!this.vid&&a)for(var u=0;u<a.datas.length;u++){var c=a.datas[u];if("string"==typeof c&&c.indexOf("vid")>-1){this.vid=c.split(":")[1];break}}delete r.data,e=null}function keys(){var e=new Stream(this.data);e.skip(4),this.count=e.readUint32(),this.metaKeys=[];for(var t=0;t<this.count;t++){var r=e.readUint32();r-=8,"mdta"!==e.readString(4)&&e.skip(r);var n=e.readString(r);this.metaKeys.push(n)}e=null}function ilst(){var e=new Stream(this.data),t=e.buffer.byteLength;for(this.datas=[];e.position<t;){e.skip(4);var r=e.readUint32()-1,n=e.readUint32();if("data"!==e.readString(4))e.skip(n-8);else{e.skip(8);var i=e.readString(n-16);this.datas[r]=i}}e=null}function vmhd(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=[e.readUint8(),e.readUint8(),e.readUint8()],this.graphicsmode=e.readUint16(),this.opcolor=[e.readUint16(),e.readUint16(),e.readUint16()],delete this.subBox,e=null}Box.MP4DecConfigDescrTag=MP4DecConfigDescrTag,Box.MP4DecSpecificDescrTag=MP4DecSpecificDescrTag,Box.MP4ESDescrTag=MP4ESDescrTag,Box.SLConfigDescriptor=SLConfigDescriptor,Box.av01=av01,Box.av1C=av1C,Box.avc1=avc1,Box.avcC=avcC,Box.btrt=btrt,Box.co64=co64,Box.ctts=ctts,Box.dref=dref,Box.elst=elst,Box.enca=enca,Box.encv=encv,Box.esds=esds,Box.frma=frma,Box.ftyp=ftyp,Box.hdlr=hdlr,Box.iods=iods,Box.mdhd=mdhd,Box.mehd=mehd,Box.mp4a=mp4a,Box.mvhd=mvhd,Box.pasp=pasp,Box.pssh=pssh,Box.saio=saio,Box.saiz=saiz,Box.schm=schm,Box.senc=senc,Box.sidx=sidx,Box.smhd=smhd,Box.stco=stco,Box.stsc=stsc,Box.stsd=stsd,Box.stss=stss,Box.stsz=stsz,Box.stts=stts,Box.tenc=tenc,Box.tfhd=tfhd,Box.tkhd=tkhd,Box.trun=trun,Box.udta=udta,Box.meta=meta,Box.ilst=ilst,Box.keys=keys,Box.vmhd=vmhd;var Parse=_createClass$3((function e(t){_classCallCheck$2(this,e),this.buffer=null,this.boxes=[],this.nextBox=null,this.start=0;var r=this;r.buffer?lib$1(Uint8Array,r.buffer,t):r.buffer=t;var n=t.byteLength;t.position=0;for(var i=new Stream(t);n-i.position>=8;){var a=new Box;if(a.readHeader(i),a.size-8<=n-i.position)a.readBody(i),r.boxes.push(a);else{if("mdat"!==a.type){r.nextBox=a,i.position-=8;break}a.readBody(i),r.boxes.push(a)}}r.buffer=new Uint8Array(r.buffer.slice(i.position))})),_CodecsConfigMap,CodecsItem=_createClass$3((function e(t,r,n,i,a,o){_classCallCheck$2(this,e),this.type=t,this.codecs=r,this.visualEntryBox=n,this.configurationBox=i,this.types=a,this.logCodeType=o})),CodecsTypes={AVC:"avc",AV1:"av1"},CodecsConfigMap=(_CodecsConfigMap={},_defineProperty$3(_CodecsConfigMap,CodecsTypes.AVC,new CodecsItem("avc","avc1.64001E","avc1","avcC",["h264"],"h264")),_defineProperty$3(_CodecsConfigMap,CodecsTypes.AV1,new CodecsItem("av1","av01.0.08M.08","av01","av1C",["av1"],"av1")),_CodecsConfigMap),MPD=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;_classCallCheck$2(this,t),EventEmitter(this),this.url=e,this.options=r,this.dash=n,this.mediaList={video:[],audio:[]},this.retryMax=10,this.retry=0,this.type="live",this.isEnd=!1,this.duration=0,this.videoCodecType=null,this.videoCodecs=null,this.hasSync=!1}var r;return _createClass$3(t,[{key:"calcVideoCodeType",value:function(e,t){if((e||t)&&!this.videoCodecType){var r=null;t?r=t.split(".")[0]:e&&(r=e.split(".")[0]);for(var n=Object.keys(CodecsConfigMap),i=0;i<n.length;i++){var a=n[i],o=CodecsConfigMap[a];if(o.types.concat(o.visualEntryBox).indexOf(r)>-1){this.videoCodecType=a,this.videoCodecs=o.codecs;break}}debug$2.log("mpd dataType:",e,"codecs:",t,"cal type:",this.videoCodecType,"videoCodecs",this.videoCodecs),this.videoCodecType||(this.videoCodecType=CodecsTypes.AVC,this.videoCodecs=CodecsConfigMap[CodecsTypes.AVC].codecs,console.warn("calcVideoCodeType default")),this.dash&&this.dash._pluginInst&&this.dash._pluginInst.setCodeInfo(this.videoCodecType)}}},{key:"fetch",value:(r=_asyncToGenerator$3(_regeneratorRuntime$1().mark((function e(r){var n,i,a,o=this;return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,i={TYPE:"LIVE",ENDLIST:""},a=[],e.abrupt("return",new Promise((function(e,s){new XHR$1({type:"",url:r}).then((function(u){var c=u.responseText;if(c){var l=t.parseMPD(c);l||s(new Error("parse mpd error"));var d=[];"static"===l.type&&(i.TYPE="VOD"),l.minBufferTime&&(i.minBufferTime=util$1.durationConvert(l.minBufferTime)),l.maxSegmentDuration&&(i.maxSegmentDuration=util$1.durationConvert(l.maxSegmentDuration)),l.mediaPresentationDuration&&(n.duration=util$1.durationConvert(l.mediaPresentationDuration));var h="";l.BaseURL&&(h=l.BaseURL[0]);var f=l.Period[0];!n.duration&&f&&f.duration&&(n.duration=util$1.durationConvert(f.duration)),i.duration=n.duration,f.AdaptationSet&&f.AdaptationSet.length>1&&f.AdaptationSet.forEach((function(e){var t="video/mp4",i="avc1.64001E",a="640",s="360",u="25",c="1:1",l="1",f="588633";e.mimeType&&("video/mp4"===(t=e.mimeType)?(i=e.codecs,a=parseFloat(e.width),s=parseFloat(e.height),u=parseFloat(e.frameRate),c=e.sar,l=e.startWithSAP,f=parseFloat(e.bandwidth),n.calcVideoCodeType(null,i)):"audio/mp4"===t&&(i=e.codecs,l=e.startWithSAP,f=parseFloat(e.bandwidth))),e.Representation.forEach((function(p){d.indexOf(p.id)>-1&&(p.id=(parseInt(d[d.length-1],10)+1).toString()),d.push(p.id);var g,y="",m=[],v=0,_=0,b=r.slice(0,r.lastIndexOf("/")+1)+h;p.mimeType&&(t=p.mimeType),p.mimeType&&(t=p.mimeType),"video/mp4"===t?(p.codecs&&(i=p.codecs,n.calcVideoCodeType(null,i)),p.width&&(a=parseFloat(p.width)),p.height&&(s=parseFloat(p.height)),p.frameRate&&(u=parseFloat(p.frameRate)),p.sar&&(c=p.sar),p.startWithSAP&&(l=p.startWithSAP),p.bandwidth&&(f=parseFloat(p.bandwidth))):"audio/mp4"===t&&(p.codecs&&(i=p.codecs),p.startWithSAP&&(l=p.startWithSAP),p.bandwidth&&(f=parseFloat(p.bandwidth))),p.BaseURL&&p.BaseURL.length>0&&(b+=p.BaseURL[0]),e.SegmentTemplate&&e.SegmentTemplate.length>0&&(g=e.SegmentTemplate[0]),p.SegmentTemplate&&p.SegmentTemplate.length>0&&(g=p.SegmentTemplate[0]);var A=!1;if((e.ContentProtection||p.ContentProtection)&&(A=!0),g){y=g.initialization,v=parseFloat(g.timescale),_=parseFloat(g.duration);for(var E=Math.round(_/v),S=parseInt(g.startNumber,10),T=S+Math.ceil(n.duration/E)-1,w=S;w<=T;w++){var C=E*(w-S),k=E*(w-S+1);w===T&&(E=n.duration-E*(T-S),k=n.duration),m.push({idx:w,start:Math.round(C),end:Math.round(k),url:b+g.media.replace("$RepresentationID$",p.id).replace("$Number%04d$",util$1.preFixInterge(w,4)),downloaded:0,segmentDuration:E,height:s})}}if(f=parseInt(f),"video/mp4"===t){var I,$;if(o.options.dynamic_video&&o.options.dynamic_video.dynamic_video_list)for(var P=0;P<o.options.dynamic_video.dynamic_video_list.length;P++){var x=o.options.dynamic_video.dynamic_video_list[P];x.bitrate===f&&(I=x.size,$=x.definition)}n.mediaList.video.push({id:p.id,baseURL:b,initSegment:b+y.replace("$RepresentationID$",p.id),inited:!1,mediaSegments:m,mimeType:t,codecs:i,width:a,height:s,size:I,frameRate:u,sar:c,startWithSAP:l,bandwidth:f,timescale:v,duration:_,encrypted:A,definition:$})}else if("audio/mp4"===t){var R;if(o.options.dynamic_video&&o.options.dynamic_video.dynamic_audio_list)for(var O=0;O<o.options.dynamic_video.dynamic_audio_list.length;O++)o.options.dynamic_video.dynamic_audio_list[O].bitrate===f&&(R=o.options.dynamic_video.dynamic_audio_list[O].size);n.mediaList.audio.push({id:p.id,baseURL:b,initSegment:b+y.replace("$RepresentationID$",p.id),inited:!1,mediaSegments:m,mimeType:t,codecs:i,startWithSAP:l,bandwidth:f,size:R,timescale:v,duration:_,encrypted:A})}}))})),["video","audio"].forEach((function(e){n.mediaList[e].length>0&&(n.mediaList[e].selectedIdx="video"===e&&n.dash.selectedIdx||0,"video"===e&&n.mediaList[e].sort((function(t,r){return"video"===e?r.height-t.height:r.bandwidth-t.bandwidth})))})),0===n.mediaList.video.length&&0===n.mediaList.audio.length&&setTimeout((function(){n.dash.player&&n.dash.player.emit("NO_MEDIALIST",{dynamic_type:"segment_template"})})),e({meta:i,segments:a})}else n.dash.emit("error",new Errors(Errors.PARSE,Errors.MPD_PARSE_ERROR,{line:253,handle:"[MPD] parse",msg:"mpd segment template Parse error",url:r},n.dash.player)),s()})).catch((function(e){var t=403===e.status?TASK_REQUEST_EXPIRED:"mpd Request error";n.dash.emit("error",new Errors(Errors.PD_NETWORK,Errors.NETEORK_ERROR_CODES[e&&e.status?e.status:"timeout"],{line:258,handle:"[MPD] xhr",msg:t,url:r},n.dash.player)),s(e)}))})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"init",value:function(e){var t=this,r=t.options;if(r.dynamic_video.dynamic_type&&"segment_template"!==r.dynamic_video.dynamic_type){t.dashType="segment_base";var n=0;r.duration;var i=r.dynamic_video;["dynamic_video_list","dynamic_audio_list"].forEach((function(e){var a="dynamic_audio_list"===e;i[e].forEach((function(i){var o=parseInt(i.init_range.split("-")[0],10),s=parseInt(i.init_range.split("-")[1],10),u=parseInt(i.index_range.split("-")[0],10),c=parseInt(i.index_range.split("-")[1],10);a||t.calcVideoCodeType(i.codec_type),t.mediaList["dynamic_audio_list"===e?"audio":"video"].push({id:("dynamic_audio_list"===e?0:n++).toString(),baseURL:i.main_url,initSegment:i.main_url,initSegmentRange:[o,s],sidxRange:[u,c],inited:!1,hasSidx:!1,mediaSegments:[],mimeType:a?"audio/mp4":"video/mp4",codecs:a?"mp4a.40.2":i.codec_type&&i.codec_type.indexOf("h265")>-1?"hev1.1.6.L93.B0":t.videoCodecs,width:i.vwidth,height:i.vheight,bandwidth:parseInt(i.bitrate),size:i.size,timescale:-1,duration:r.duration,encrypted:i.encrypt,kid:i.kid,definition:i.definition,sidxRes:void 0})}))})),t.type="vod",["video","audio"].forEach((function(e){t.mediaList[e].length>0&&(t.mediaList[e].selectedIdx="video"===e&&t.dash.selectedIdx||0,"video"===e&&t.mediaList[e].sort((function(t,r){return"video"===e?r.height-t.height:r.bandwidth-t.bandwidth})))})),0===t.mediaList.video.length&&0===t.mediaList.audio.length&&t.dash&&t.dash.player&&setTimeout((function(){t.dash.player.emit("NO_MEDIALIST",{dynamic_type:"segment_base"})})),t.emit("ready")}else t.dashType="segment_template",t.fetch(r.dynamic_video.main_url).then((function(e){t.type=e.meta.TYPE.toLocaleLowerCase(),t.emit("ready")}),(function(){["video","audio"].forEach((function(e){t.mediaList[e]=[]})),t.retry++,t.retry,t.retryMax}))}},{key:"getSidx",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"video",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,a=this,o=a.mediaList[r][n],s=o.sidxRange[1];o.sidxFetching=!0;try{var u=t instanceof ArrayBuffer?t:t.buffer;new Parse(u).boxes.every((function(e){if("sidx"===e.type){var r=[],n=0,a=0,u=s+1,c=u-1;return e.references.forEach((function(t,i){a+=t.subsegment_duration,c+=t.referenced_size,r.push({idx:i+1,url:o.initSegment,start:Math.round(n/e.timescale),end:Math.round(a/e.timescale),startRaw:n/e.timescale,endRaw:a/e.timescale,range:[u,c],downloaded:0,segmentDuration:Math.round(t.subsegment_duration/e.timescale),reference_type:t.reference_type,starts_with_SAP:t.starts_with_SAP,SAP_type:t.SAP_type,SAP_delta_time:t.SAP_delta_time}),n=a+1,u=c+1})),r[0].startTime_=0,o.mediaDuration=0,r.forEach((function(e,t){o.mediaDuration+=e.segmentDuration,t>0&&(e.startTime_=r[t-1].startTime_+r[t-1].segmentDuration),t===r.length-1&&i&&(e.end=i)})),o.hasSidx=!0,o.mediaSegments=r,o.timescale=e.timescale,o.sidxRes=t,!1}return!0})),o.sidxFetching=!1}catch(e){throw o.sidxFetching=!1,a.dash.reportMonitorEvent(SIDX_EXCEPTION),new Errors(Errors.PARSE,Errors.SID_PARSE_ERROR,{line:398,handle:"[MPD] getSidx",msg:"mpd segment base Parse getSidx error"},a.dash.player)}}},{key:"checkInBuffered",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=this.dash.mse.buffered(e);if(!o)return!1;var s=this._inBufferd(t,i,o,n),u=this._inBufferd(r,a,o,n);return!(!s.in||!u.in||s.index!==u.index)}},{key:"_inBufferd",value:function(e,t,r,n){for(var i=0;i<r.length;i++){var a=util$1.round(r.start(i)),o=util$1.round(r.end(i));if(a<=e&&e<=o)return{index:i,in:!0};if(a<=t&&t<=o)return{index:i,in:!0}}return{in:!1}}},{key:"_doSyncAV",value:function(){var e=this.mediaList;if(!this.hasSync){var t=!1;if(e.video.length<1&&(t=!0),e.audio.length<1&&(t=!0),!t){var r=this.mediaList.video[this.mediaList.video.selectedIdx].mediaSegments,n=this.mediaList.audio[this.mediaList.audio.selectedIdx].mediaSegments,i=Math.min(r.length,n.length),a=n[i-1],o=r[i-1];a.incomplete=!0,o.incomplete=!0}this.hasSync=!0}}},{key:"syncAV",value:function(){this.hasSync=!1}},{key:"seek",value:function(e,t){var r=this;debug$2.log("mpd seek: ".concat(e));var n=this;this._doSyncAV();var i={};return new Promise((function(a,o){"vod"===r.type||void 0!==e?(["video","audio"].forEach((function(r){if(n.mediaList[r].length<1)return!0;var a=n.mediaList[r][n.mediaList[r].selectedIdx].mediaSegments;i[r]=a.filter((function(i,a){if(i.downloaded===SEGMENT_STATE.APPEND){if(n.checkInBuffered(r,i.start,i.end,0,i.startRaw,i.endRaw))return!1;if(i.incomplete)return!1;debug$2.log("".concat(r," ").concat(a," start:").concat(i.start," end:").concat(i.end," segment downloaded set false")),i.downloaded=SEGMENT_STATE.NO_START}var o=i.start>=t&&i.end<=e,s=i.start<=e&&e<=i.end;return!(!o&&!s||i.downloaded!==SEGMENT_STATE.NO_START)}))})),a(i)):o("media error2")}))}},{key:"clearBuffer",value:function(e,t,r){var n=this,i=r?[r]:["video","audio"];"vod"===n.type&&i.forEach((function(r){n.mediaList[r].length>0&&n.mediaList[r][n.mediaList[r].selectedIdx].mediaSegments.forEach((function(n,i){n.end<e||n.start>t||(debug$2.log("".concat(r," ").concat(i," start:").concat(n.start," end:").concat(n.end," segment downloaded set false")),n.downloaded=SEGMENT_STATE.NO_START)}))}))}}],[{key:"parseMPD",value:function(e){var t;if("string"==typeof e&&(t=e),e instanceof ArrayBuffer){var r=new Uint8Array(e);t=String.fromCharCode.apply(null,r)}if(!t)return null;var n=performance.now();return t=t.replace(/<(\/)?(\w+:)+(\w+)/g,"<$1$3"),debug$2.log("MPD cost",performance.now()-n),Xml2Json.parse(t)}},{key:"parseTime",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=e.getAttribute(r);i&&(t[n||r]=util$1.durationConvert(i))}}]),t}();function ownKeys$d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$1(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$d(Object(r),!0).forEach((function(t){_defineProperty$2(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _regeneratorRuntime(){_regeneratorRuntime=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(C){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i,a,o,s,u=t&&t.prototype instanceof d?t:d,h=Object.create(u.prototype),f=new S(n||[]);return h._invoke=(i=e,a=r,o=f,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return{value:void 0,done:!0}}for(o.method=e,o.arg=t;;){var r=o.delegate;if(r){var n=b(r,o);if(n){if(n===l)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===s)throw s="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s="executing";var u=c(i,a,o);if("normal"===u.type){if(s=o.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:o.done}}"throw"===u.type&&(s="completed",o.method="throw",o.arg=u.arg)}}),h}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(C){return{type:"throw",arg:C}}}e.wrap=u;var l={};function d(){}function h(){}function f(){}var p={};s(p,i,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(T([])));y&&y!==t&&r.call(y,i)&&(p=y);var m=f.prototype=d.prototype=Object.create(p);function v(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function n(i,a,o,s){var u=c(e[i],e,a);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==_typeof$7(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(d).then((function(e){l.value=e,o(l)}),(function(e){return n("throw",e,o,s)}))}s(u.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function b(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function T(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:w}}function w(){return{value:void 0,done:!0}}return h.prototype=f,s(m,"constructor",f),s(f,"constructor",h),h.displayName=s(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},v(_.prototype),s(_.prototype,a,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new _(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},v(m),s(m,o,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=T,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;E(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function _typeof$2(e){return(_typeof$2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep$2(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(error){return void r(error)}s.done?t(u):Promise.resolve(u).then(n,i)}function _asyncToGenerator$2(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$2(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$2(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck$1(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$2(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$2(e,t,r){return t&&_defineProperties$2(e.prototype,t),r&&_defineProperties$2(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$2(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$1(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$1(e,t)}function _getPrototypeOf$1(e){return(_getPrototypeOf$1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$1(e,t){return(_setPrototypeOf$1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$n(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _construct$2(e,t,r){return(_construct$2=_isNativeReflectConstruct$n()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&_setPrototypeOf$1(i,r.prototype),i}).apply(null,arguments)}function _isNativeFunction$2(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _wrapNativeSuper$2(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper$2=function(e){if(null===e||!_isNativeFunction$2(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct$2(e,arguments,_getPrototypeOf$1(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf$1(r,e)},_wrapNativeSuper$2(e)}function _objectWithoutPropertiesLoose$1(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function _objectWithoutProperties$1(e,t){if(null==e)return{};var r,n,i=_objectWithoutPropertiesLoose$1(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function _assertThisInitialized$1(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$1(e,t){if(t&&("object"===_typeof$7(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$1(e)}function _createSuper$m(e){var t=_isNativeReflectConstruct$n();return function(){var r,n=_getPrototypeOf$1(e);if(t){var i=_getPrototypeOf$1(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$1(this,r)}}function _unsupportedIterableToArray$2(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$2(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$2(e,t):void 0}}function _arrayLikeToArray$2(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _createForOfIteratorHelper$2(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$2(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function createPublicPromise$2(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return r.used=!1,r.resolve=function(){return r.used=!0,e.apply(void 0,arguments)},r.reject=function(){return r.used=!0,t.apply(void 0,arguments)},r}var LoaderType$2={FETCH:"fetch",XHR:"xhr"},ResponseType$2={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"},NetError$2=function(e){_inherits$1(r,e);var t=_createSuper$m(r);function r(e,n,i,a){var o;return _classCallCheck$1(this,r),_defineProperty$2(_assertThisInitialized$1(o=t.call(this,a)),"retryCount",0),_defineProperty$2(_assertThisInitialized$1(o),"isTimeout",!1),_defineProperty$2(_assertThisInitialized$1(o),"loaderType",LoaderType$2.FETCH),_defineProperty$2(_assertThisInitialized$1(o),"startTime",0),_defineProperty$2(_assertThisInitialized$1(o),"endTime",0),o.url=e,o.request=n,o.response=i,o}return _createClass$2(r)}(_wrapNativeSuper$2(Error)),$$i=_export;$$i({target:"Number",stat:!0},{isNaN:function(e){return e!=e}});var toString$6=Object.prototype.toString;function isObject$5(e){return null!==e&&"object"===_typeof$2(e)}function isPlainObject$2(e){if("[object Object]"!==toString$6.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function isDate$2(e){return"[object Date]"===toString$6.call(e)}function getRangeValue$2(e){if(e&&null!==e[0]&&void 0!==e[0]&&(0!==e[0]||null!==e[1]&&void 0!==e[1])){var t="bytes="+e[0]+"-";return e[1]&&(t+=e[1]),t}}function encode$2(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function setUrlParams$2(e,t){if(e){if(!t)return e;var r,n=Object.keys(t).map((function(e){if(null!=(r=t[e]))return Array.isArray(r)?e+="[]":r=[r],r.map((function(t){return isDate$2(t)?t=t.toISOString():isObject$5(t)&&(t=JSON.stringify(t)),"".concat(encode$2(e),"=").concat(encode$2(t))})).join("&")})).filter(Boolean).join("&");if(n){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}}function createResponse$2(e,t,r,n,i,a,o,s,u,c){return i=null!=i?parseFloat(i):null,n=parseInt(n||"0",10),Number.isNaN(n)&&(n=0),{data:e,done:t,option:{range:u,vid:c,index:s,contentLength:n,age:i,startTime:a,firstByteTime:o,endTime:Date.now()},response:r}}var MaxQueueCapacity$1=10,INVALID_SPEED$1=0,SpeedSampler$2=function(){function e(){_classCallCheck$1(this,e),this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,this._realTimeSpeed=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return _createClass$2(e,[{key:"reset",value:function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0}},{key:"addBytes",value:function(e){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=e,this._totalBytes+=e):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=e,this._totalBytes+=e):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=e,this._totalBytes+=e,this._lastCheckpoint=this._now())}},{key:"currentKBps",get:function(){this.addBytes(0);var e=(this._now()-this._lastCheckpoint)/1e3;return 0===e&&(e=1),this._intervalBytes/e/1024}},{key:"lastSecondKBps",get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0}}],[{key:"getSpeed",value:function(){var e=INVALID_SPEED$1;if(this._netRecords.length<1)return e;var t=[];this._netRecords.map((function(e){t.push(e)})),t.sort((function(e,t){return e.mSpeedInbPS-t.mSpeedInbPS}));for(var r=t.length,n=0,i=0;i<r;i++)n+=t[i].mBytes;n/=2;for(var a=0;a<r;a++)if((n-=t[a].mBytes)<=0){e=t[a].mSpeedInbPS;break}return e<0?INVALID_SPEED$1:e}},{key:"getRealTimeSpeed",value:function(){return this._realTimeSpeed}},{key:"getRTT",value:function(){if(this._netRecords.length<1)return 0;var e=[];this._netRecords.map((function(t){e.push(t.mRTT)})),e.sort((function(e,t){return e-t}));var t=e.length;return t%2==0?(e[t/2-1]+e[t/2])/2:e[Math.floor(t/2)]}},{key:"netSampling",value:function(e){this._netRecords.push(e),this._realTimeSpeed=e.mSpeedInbPS,this._netRecords.length>MaxQueueCapacity$1&&this._netRecords.splice(0,1)}}]),e}();_defineProperty$2(SpeedSampler$2,"_netRecords",[]);var CACHESIZE=2097152,FetchLoader$2=function(){function e(){_classCallCheck$1(this,e),_defineProperty$2(this,"_abortController",null),_defineProperty$2(this,"_timeoutTimer",null),_defineProperty$2(this,"_reader",null),_defineProperty$2(this,"_response",null),_defineProperty$2(this,"_aborted",!1),_defineProperty$2(this,"_index",-1),_defineProperty$2(this,"_range",null),_defineProperty$2(this,"_receivedLength",0),_defineProperty$2(this,"_running",!1),_defineProperty$2(this,"_logger",null),_defineProperty$2(this,"_vid",""),_defineProperty$2(this,"_onProcessMinLen",0)}var t;return _createClass$2(e,[{key:"load",value:function(e){var t,r=this,n=e.url,i=e.vid,a=e.timeout,o=e.responseType,s=e.onProgress,u=e.index,c=e.onTimeout,l=e.range,d=e.transformResponse,h=e.request,f=e.params,p=e.logger,g=e.method,y=e.headers,m=e.body,v=e.mode,_=e.credentials,b=e.cache,A=e.redirect,E=e.referrer,S=e.referrerPolicy,T=e.onProcessMinLen;this._logger=p,this._aborted=!1,this._onProcessMinLen=T,this._abortController="undefined"!=typeof AbortController&&new AbortController,this._running=!0,this._index=u,this._range=l||[0,0],this._vid=i||n;var w={method:g,headers:y,body:m,mode:v,credentials:_,cache:b,redirect:A,referrer:E,referrerPolicy:S,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal},C=!1;clearTimeout(this._timeoutTimer),n=setUrlParams$2(n,f);var k=getRangeValue$2(l);k&&((y=h?h.headers:w.headers=w.headers||new Headers)instanceof Headers?y.append("Range",k):y.Range=k),a&&(this._timeoutTimer=setTimeout((function(){if(C=!0,r.cancel(),c){var e=new NetError$2(n,w);e.isTimeout=!0,c(e)}}),a));var I=Date.now();return this._logger.debug("[fetch load start], index,",u,",range,",l),new Promise((function(e,t){fetch(h||n,h?void 0:w).then(function(){var i=_asyncToGenerator$2(_regeneratorRuntime().mark((function i(a){var c,h,f;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(clearTimeout(r._timeoutTimer),r._response=a,!r._aborted&&r._running){i.next=4;break}return i.abrupt("return");case 4:if(d&&(a=d(a,n)||a),a.ok){i.next=7;break}throw new NetError$2(n,w,a,"bad network response");case 7:if(c=Date.now(),o!==ResponseType$2.TEXT){i.next=15;break}return i.next=11,a.text();case 11:h=i.sent,r._running=!1,i.next=36;break;case 15:if(o!==ResponseType$2.JSON){i.next=22;break}return i.next=18,a.json();case 18:h=i.sent,r._running=!1,i.next=36;break;case 22:if(!s){i.next=29;break}return r.resolve=e,r.reject=t,r._loadChunk(a,s,I,c),i.abrupt("return");case 29:return i.next=31,a.arrayBuffer();case 31:h=i.sent,h=new Uint8Array(h),r._running=!1,f=Date.now()-I,SpeedSampler$2.netSampling({mTime:f,mBytes:h.byteLength,mSpeedInbPS:8*h.byteLength/(f/1e3),mRTT:c-I});case 36:r._logger.debug("[fetch load end], index,",u,",range,",l),e(createResponse$2(h,!0,a,a.headers.get("Content-Length"),a.headers.get("age"),I,c,u,l,r._vid));case 38:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()).catch((function(e){clearTimeout(r._timeoutTimer),r._running=!1,r._aborted&&!C||((e=e instanceof NetError$2?e:new NetError$2(n,w)).startTime=I,e.endTime=Date.now(),e.isTimeout=C,t(e))}))}))}},{key:"cancel",value:(t=_asyncToGenerator$2(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){e.next=14;break}if(e.prev=5,!this._reader){e.next=9;break}return e.next=9,this._reader.cancel();case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch(error){}this._abortController=null}case 15:case"end":return e.stop()}}),e,this,[[5,11]])}))),function(){return t.apply(this,arguments)})},{key:"_loadChunk",value:function(e,t,r,n){var i=this;if(!e.body||!e.body.getReader)return this._running=!1,void this.reject(NetError$2(e.url,"",e,"onProgress of bad response.body.getReader"));this._onProcessMinLen>0&&(this._cache=new Uint8Array(CACHESIZE),this._writeIdx=0);var a,o,s,u=this._reader=e.body.getReader(),c=function(){var l=_asyncToGenerator$2(_regeneratorRuntime().mark((function l(){var d,h,f,p,g;return _regeneratorRuntime().wrap((function(l){for(;;)switch(l.prev=l.next){case 0:return o=Date.now(),l.prev=1,l.next=4,u.read();case 4:a=l.sent,s=Date.now(),l.next=13;break;case 8:return l.prev=8,l.t0=l.catch(1),s=Date.now(),i._aborted||(i._running=!1,i.reject(l.t0)),l.abrupt("return");case 13:if(d=i._range[0]+i._receivedLength,!i._aborted){l.next=18;break}return i._running=!1,t(void 0,!1,{range:[d,d],vid:i._vid,index:i._index,startTime:o,endTime:s},e),l.abrupt("return");case 18:h=a.value?a.value.byteLength:0,i._receivedLength+=h,i._logger.debug("ã€fetchLoader,onProgress callã€‘,task,",i._range,", start,",d,", end,",i._range[0]+i._receivedLength,", done,",a.done),i._writeIdx+h>=i._onProcessMinLen||a.done?((f=new Uint8Array(i._writeIdx+h)).set(i._cache.slice(0,i._writeIdx),0),h>0&&f.set(a.value,i._writeIdx),i._writeIdx=0,i._logger.debug("ã€fetchLoader,onProgress enoughã€‘,done,",a.done,",len,",f.byteLength,", writeIdx,",i._writeIdx)):h>0&&i._writeIdx+h<CACHESIZE?(i._cache.set(a.value,i._writeIdx),i._writeIdx+=h,i._logger.debug("ã€fetchLoader,onProgress cacheã€‘,len,",h,", writeIdx,",i._writeIdx)):h>0&&(p=new Uint8Array(i._writeIdx+h+2048),i._logger.debug("ã€fetchLoader,onProgress extra startã€‘,size,",i._writeIdx+h+2048,", datalen,",h,", writeIdx,",i._writeIdx),p.set(i._cache.slice(0,i._writeIdx),0),h>0&&p.set(a.value,i._writeIdx),i._writeIdx+=h,delete i._cache,i._cache=p,i._logger.debug("ã€fetchLoader,onProgress extra endã€‘,len,",h,", writeIdx,",i._writeIdx)),(f&&f.byteLength>0||a.done)&&t(f,a.done,{range:[i._range[0]+i._receivedLength-f.byteLength,i._range[0]+i._receivedLength],vid:i._vid,index:i._index,startTime:o,endTime:s},e),g=Date.now()-r,i._logger.debug("[fetchLoader SPEED], fetch speed(b/s),",8*i._receivedLength/(g/1e3)),SpeedSampler$2.netSampling({mTime:g,mBytes:i._receivedLength,mSpeedInbPS:8*i._receivedLength/(g/1e3),mRTT:n-r}),a.done?(i._running=!1,i._logger.debug("[fetchLoader onProgress end],task,",i._range,",done,",a.done),i.resolve(createResponse$2(a,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),o,n,i._index,i._range,i._vid))):c();case 27:case"end":return l.stop()}}),l,null,[[1,8]])})));return function(){return l.apply(this,arguments)}}();c()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return!("undefined"==typeof fetch)}}]),e}();function getConfig$3(e){return _objectSpread2$1({loaderType:LoaderType$2.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:ResponseType$2.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:1},e)}var XhrLoader$2=function(){function t(){_classCallCheck$1(this,t),_defineProperty$2(this,"_xhr",null),_defineProperty$2(this,"_aborted",!1),_defineProperty$2(this,"_timeoutTimer",null),_defineProperty$2(this,"_range",null),_defineProperty$2(this,"_receivedLength",0),_defineProperty$2(this,"_url",null),_defineProperty$2(this,"_onProgress",null),_defineProperty$2(this,"_index",-1),_defineProperty$2(this,"_headers",null),_defineProperty$2(this,"_chunkSizeKBList",[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192]),_defineProperty$2(this,"_currentChunkSizeKB",384),_defineProperty$2(this,"_currentSpeedNormalized",0),_defineProperty$2(this,"_zeroSpeedChunkCount",0),_defineProperty$2(this,"_timeout",null),_defineProperty$2(this,"_xhr",null),_defineProperty$2(this,"_withCredentials",null),_defineProperty$2(this,"_startTime",-1),_defineProperty$2(this,"_speedSampler",new SpeedSampler$2),_defineProperty$2(this,"_loadCompleteResolve",null),_defineProperty$2(this,"_loadCompleteReject",null),_defineProperty$2(this,"_runing",!1),_defineProperty$2(this,"_logger",!1),_defineProperty$2(this,"_vid",""),_defineProperty$2(this,"_responseType",void 0),_defineProperty$2(this,"_credentials",void 0),_defineProperty$2(this,"_method",void 0),_defineProperty$2(this,"_transformResponse",void 0),_defineProperty$2(this,"_firstRtt",void 0),_defineProperty$2(this,"_subRangeStartTime",void 0)}return _createClass$2(t,[{key:"load",value:function(e){var t=this;clearTimeout(this._timeoutTimer),this._logger=e.logger,this._range=e.range||[0,0],this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials="include"===e.credentials||"same-origin"===e.credentials,this._timeout=e.timeout||null,this._runing=!0,this._vid=e.vid||e.url,this._responseType=e.responseType,this._firstRtt=-1,this._onTimeout=e.onTimeout,this._request=e.request,this._credentials=e.credentials,this._logger.debug("ã€xhrLoader taskã€‘, range",this._range),this._url=setUrlParams$2(e.url,e.params);var r=Date.now();return new Promise((function(e,r){t._loadCompleteResolve=e,t._loadCompleteReject=r,t._startLoad()})).catch((function(e){if(clearTimeout(t._timeoutTimer),t._runing=!1,!t._aborted)throw(e=e instanceof NetError$2?e:new NetError$2(t._url,t._request)).startTime=r,e.endTime=Date.now(),e}))}},{key:"_startLoad",value:function(){var e=null;if(this._range&&this._range.length>1)if(this._onProgress){this._subRangeStartTime=Date.now(),this._firstRtt=-1;var t=1024*this._currentChunkSizeKB,r=this._range[0]+this._receivedLength,n=this._range[1];t<this._range[1]-r&&(n=r+t),e=[r,n],this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",e)}else e=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",e);this._internalOpen(e)}},{key:"_internalOpen",value:function(t){var r=this;try{this._startTime=Date.now();var n=this._xhr=new XMLHttpRequest;n.open(this._method||"GET",this._url,!0),n.responseType=this._responseType,this._timeout&&(n.timeout=this._timeout),n.withCredentials=this._credentials,n.onload=this._onLoad.bind(this),n.onreadystatechange=this._onReadyStatechange.bind(this),n.onerror=function(e){r._running=!1,r._loadCompleteReject(e)},n.ontimeout=function(e){if(r.cancel(),r._onTimeout){var t=new NetError$2(r._url,r._request);t.isTimeout=!0,r._onTimeout(t)}r._loadCompleteReject(e)};var i=getRangeValue$2(t),a=null;i&&((a=this._headers||{}).Range=i),a&&Object.keys(a).forEach((function(e){n.setRequestHeader(e,a[e])})),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",t),n.send()}catch(e){this._loadCompleteReject(e)}}},{key:"_onReadyStatechange",value:function(e){2===e.target.readyState&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(e){var t=e.target.status;if(t<200||t>299)return this._loadCompleteReject(new NetError$2(this._url,null,_objectSpread2$1(_objectSpread2$1({},e.target.response),{},{status:t}),"bad response,status:"+t));var r=this._speedSampler.lastSecondKBps;if(0===r&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(r=this._speedSampler.currentKBps)),0!==r){var n=this._normalizeSpeed(r);this._currentSpeedNormalized!==n&&(this._currentSpeedNormalized=n,this._currentChunkSizeKB=n)}var i,a=null,o=!1;if(this._responseType===ResponseType$2.ARRAY_BUFFER){var s=new Uint8Array(e.target.response);if(i=this._range[0]+this._receivedLength,s&&s.byteLength>0){this._receivedLength+=s.byteLength;var u=Date.now()-this._subRangeStartTime;this._speedSampler.addBytes(s.byteLength),SpeedSampler$2.netSampling({mTime:u,mBytes:this._receivedLength,mSpeedInbPS:8*this._receivedLength/(u/1e3),mRTT:this._firstRtt-this._subRangeStartTime})}a=s,o=!(this._range.length>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]),this._logger.debug("[xhr load done->], tast :",this._range,", start",i,"end ",this._range[0]+this._receivedLength,",dataLen,",s?s.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",o)}else o=!0,a=e.target.response;var c={ok:t>=200&&t<300,status:t,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(c=this._transformResponse(c,this._url)||c),this._onProgress&&this._onProgress(a,o,{index:this._index,vid:this._vid,range:[i,this._range[0]+this._receivedLength],startTime:this._startTime,endTime:Date.now()},c),o?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(createResponse$2(this._onProgress?null:a,o,c,c.headers["content-length"],c.headers.age,this._startTime,-1,this._index,this._range,this._vid))):this._startLoad()}},{key:"_normalizeSpeed",value:function(e){var t=this._chunkSizeKBList,r=t.length-1,n=0,i=0,a=r;if(e<t[0])return t[0];for(;i<=a;){if((n=i+Math.floor((a-i)/2))===r||e>=t[n]&&e<t[n+1])return t[n];t[n]<e?i=n+1:a=n-1}}},{key:"cancel",value:function(){if(!this._aborted)return this._aborted=!0,this._runing=!1,this._xhr?this._xhr.abort():void 0}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}},{key:"_getHeaders",value:function(e){var t,r={},n=_createForOfIteratorHelper$2(e.getAllResponseHeaders().trim().split("\r\n"));try{for(n.s();!(t=n.n()).done;){var i=t.value.split(": ");r[i[0].toLowerCase()]=i.slice(1).join(": ")}}catch(a){n.e(a)}finally{n.f()}return r}}],[{key:"isSupported",value:function(){return"undefined"!=typeof XMLHttpRequest}}]),t}(),bind=functionBindContext,uncurryThis$5=functionUncurryThis,IndexedObject=indexedObject,toObject$1=toObject$k,toPropertyKey$1=toPropertyKey$6,lengthOfArrayLike=lengthOfArrayLike$n,objectCreate=objectCreate$1,arrayFromConstructorAndList=arrayFromConstructorAndList$3,$Array=Array,push$1=uncurryThis$5([].push),arrayGroup=function(e,t,r,n){for(var i,a,o,s=toObject$1(e),u=IndexedObject(s),c=bind(t,r),l=objectCreate(null),d=lengthOfArrayLike(u),h=0;d>h;h++)o=u[h],(a=toPropertyKey$1(c(o,h,s)))in l?push$1(l[a],o):l[a]=[o];if(n&&(i=n(s))!==$Array)for(a in l)l[a]=arrayFromConstructorAndList(i,l[a]);return l},$$h=_export,$group=arrayGroup,addToUnscopables$1=addToUnscopables$6;$$h({target:"Array",proto:!0},{group:function(e){var t=arguments.length>1?arguments[1]:void 0;return $group(this,e,t)}}),addToUnscopables$1("group");var Logger$5=function(){function e(t){_classCallCheck$1(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return _createClass$2(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).debug.apply(t,[this._prefix].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,[this._prefix].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).error.apply(t,[this._prefix].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();_defineProperty$2(Logger$5,"disabled",!0);var _excluded$4=["retry","retryDelay","onRetryError","transformError"],Task$2=function(){function e(t,r){_classCallCheck$1(this,e),this.promise=createPublicPromise$2(),this.alive=!!r.onProgress,!r.logger&&(r.logger=new Logger$5("Loader")),this._loaderType=t,this._loader=t===LoaderType$2.FETCH?new FetchLoader$2:new XhrLoader$2,this._config=r,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._logger=r.logger}var t;return _createClass$2(e,[{key:"exec",value:function(){var e=this,t=this._config,r=t.retry,n=t.retryDelay,i=t.onRetryError,a=t.transformError,o=_objectWithoutProperties$1(t,_excluded$4),s=function(){var t=_asyncToGenerator$2(_regeneratorRuntime().mark((function t(){var u,c;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e._loader.load(o);case 3:u=t.sent,e.promise.resolve(u),t.next=28;break;case 7:if(t.prev=7,t.t0=t.catch(0),e._loader.running=!1,e._logger.debug("[task request catch err]",t.t0),!e._canceled){t.next=13;break}return t.abrupt("return");case 13:if(!(t.t0.response&&t.t0.response.status>=400&&t.t0.response.status<=599)){t.next=16;break}return e.promise.reject(t.t0),t.abrupt("return");case 16:if(t.t0.loaderType=e._loaderType,t.t0.retryCount=e._retryCount,c=t.t0,a&&(c=a(c)||c),i&&e._retryCount>0&&i(c,e._retryCount,r),e._retryCount++,!(e._retryCount<=r)){t.next=27;break}return clearTimeout(e._retryTimer),e._logger.debug("[task request setTimeout],retry",e._retryCount,",retry range,",o.range),e._retryTimer=setTimeout(s,n),t.abrupt("return");case 27:e.promise.reject(c);case 28:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();return s(),this.promise}},{key:"cancel",value:(t=_asyncToGenerator$2(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,e.abrupt("return",this._loader.cancel());case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"running",get:function(){return this._loader&&this._loader.running}}]),e}();function sleep$1(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))}var NetLoader$2=function(){function e(t){_classCallCheck$1(this,e),_defineProperty$2(this,"type",LoaderType$2.FETCH),_defineProperty$2(this,"_queue",[]),_defineProperty$2(this,"_alive",[]),_defineProperty$2(this,"_currentTask",null),this._config=getConfig$3(t),this._config.loaderType!==LoaderType$2.XHR&&FetchLoader$2.isSupported()||(this.type=LoaderType$2.XHR),this.log=t.logger}var t;return _createClass$2(e,[{key:"isFetch",value:function(){return this.type===LoaderType$2.FETCH}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"!=typeof e&&e?t=e:t.url=e||t.url||this._config.url,(t=Object.assign({},this._config,t)).params&&(t.params=Object.assign({},t.params)),t.headers&&isPlainObject$2(t.headers)&&(t.headers=Object.assign({},t.headers)),t.body&&isPlainObject$2(t.body)&&(t.body=Object.assign({},t.body)),t.transformRequest&&(t=t.transformRequest(t)||t),t.logger=this.log;var r=new Task$2(this.type,t);return this._queue.push(r),1!==this._queue.length||this._currentTask&&this._currentTask.running||this._processTask(),r.promise}},{key:"cancel",value:(t=_asyncToGenerator$2(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._queue.map((function(e){return e.cancel()})).concat(this._alive.map((function(e){return e.cancel()}))),this._currentTask&&t.push(this._currentTask.cancel()),this._queue=[],this._alive=[],e.next=6,Promise.all(t);case 6:return e.next=8,sleep$1();case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_processTask",value:function(){var e=this;this._currentTask=this._queue.shift(),this._currentTask&&(this._currentTask.alive&&this._alive.push(this._currentTask),this._currentTask.exec().catch((function(e){})).finally((function(){e._processTask()})))}}],[{key:"isFetchSupport",value:function(){return FetchLoader$2.isSupported()}},{key:"getSpeed",value:function(){return SpeedSampler$2.getSpeed()}},{key:"getRealTimeSpeed",value:function(){return SpeedSampler$2.getRealTimeSpeed()}},{key:"getRTT",value:function(){return SpeedSampler$2.getRTT()}}]),e}();function getAllHeaders(e){if(e instanceof Headers){var t,r={},n=_createForOfIteratorHelper$3(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;r[i[0]]=i[1]}}catch(a){n.e(a)}finally{n.f()}return r}return e}var Loader=function(){function e(t,r){_classCallCheck$2(this,e),this._config=_objectSpread2$2({responseType:"arraybuffer"},t),this._preloadManager=r,this.videoLogger=new Logger$5("VideoLoader_",this._config.vid),this.audioLogger=new Logger$5("AudioLoader_",this._config.vid),t.openLog&&Logger$5.enable(),this._videoLoader=new NetLoader$2(_objectSpread2$2(_objectSpread2$2({},this._config),{},{logger:this.videoLogger})),this._audioLoader=new NetLoader$2(_objectSpread2$2(_objectSpread2$2({},this._config),{},{logger:this.audioLogger})),this._isSupportUrlRange="fetch"===this._videoLoader.type}var t,r;return _createClass$3(e,[{key:"load",value:(r=_asyncToGenerator$3(_regeneratorRuntime$1().mark((function t(r,n,i,a){var o,s,u,c,l,d,h,f,p,g,y,m,v,_,b,A=arguments;return _regeneratorRuntime$1().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=A.length>4&&void 0!==A[4]&&A[4],s=A.length>5&&void 0!==A[5]?A[5]:null,u=a.cacheKey||util$1.generateUniqueKey(a),c={start:a.start,end:a.end,bandwidth:a.bandwidth||a.bitrate,sequence:a.idx,fps:a.fps,mediaType:r,selectedIdx:a.selectedIdx,definition:a.definition},!this._preloadManager){t.next=11;break}return t.next=7,this._preloadManager.getItem(u);case 7:if(!((l=t.sent).res instanceof ArrayBuffer)){t.next=11;break}return s&&s(l.res,!0,{range:i},null,a),t.abrupt("return",{res:l.res,headers:l.headers,status:l.status,fromCache:!0,selectedIdx:a.selectedIdx,extData:c,cacheKey:u});case 11:if(d=!s||this._isSupportUrlRange,h=d&&(this._config.useUrlRange||a.useUrlRange||!1),f=n,h&&i&&i.length>1&&(f=n+(n.split("?")[1]?"&":"?")+"range=".concat(i[0],"-").concat(i[1])),i&&0!==i.length&&!h||(i=void 0),debug$2.log("load res: ",a),t.prev=17,p="video"===r?this._videoLoader:this._audioLoader){t.next=21;break}return t.abrupt("return");case 21:return t.next=23,p.load(f,{range:i,onProgress:s,selectedIdx:a.selectedIdx,sequence:a.idx,initSegment:a.initSegment,onProcessMinLen:this._config.onProcessMinLen});case 23:if(g=t.sent){t.next=26;break}return t.abrupt("return",null);case 26:return y=g.data,m=g.response,v={res:y instanceof Uint8Array?y.buffer:y,headers:getAllHeaders(m.headers),status:m.status},o&&this._preloadManager.setItem(u,v).catch((function(){})),e.historySpeed.length>=20&&e.historySpeed.shift(),e.historySpeed.push(NetLoader$2.getSpeed()),t.abrupt("return",_objectSpread2$2(_objectSpread2$2({},v),{},{extData:c,selectedIdx:a.selectedIdx,cacheKey:u}));case 34:return t.prev=34,t.t0=t.catch(17),t.abrupt("return",{res:"error",status:null===(_=t.t0.response)||void 0===_?void 0:_.status,header:getAllHeaders(null===(b=t.t0.response)||void 0===b?void 0:b.headers),cacheKey:u});case 37:case"end":return t.stop()}}),t,this,[[17,34]])}))),function(e,t,n,i){return r.apply(this,arguments)})},{key:"cancel",value:(t=_asyncToGenerator$3(_regeneratorRuntime$1().mark((function e(t){var r;return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return r="video"===t?this._videoLoader:this._audioLoader,e.next=4,r.cancel();case 4:e.next=10;break;case 6:return e.next=8,this._audioLoader.cancel();case 8:return e.next=10,this._videoLoader.cancel();case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"destroy",value:function(){this.cancel(),this._audioLoader=null,this._videoLoader=null}}],[{key:"currentSpeed",get:function(){return NetLoader$2.getRealTimeSpeed()}},{key:"historyAvspeed",get:function(){var t=e.historySpeed.reduce((function(e,t){return e+t}),0);return 0===e.historySpeed.length?0:t/e.historySpeed.length}}]),e}();Loader.historySpeed=[];var collection=collection$2,collectionStrong=collectionStrong$2;collection("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),collectionStrong);var SPPED_CACHE="danger_d_speed";function convert32ToC64(e){var t=e.toString(16);return t.length<=8?{high:0,low:e}:{high:parseInt(t.substr(0,t.length-8),16),low:parseInt(t.substr(t.length-8),16)}}var BaseAbr=function(){function e(t,r,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{logger:function(){},openLog:!1};_classCallCheck$4(this,e),this.bitrate=r,this.segment_duration=i||5e3,this.logger=a.logger,this.openLog=a.openLog,this.cdnHost=t.cdnHost,this._loadedPromise=new ProxyPromise$1,this._wasmPromise=new ProxyPromise$1,this.config=t,this.autoBitrateOpts=t.autoBitrateOpts||{},this.stall_penalty=this.autoBitrateOpts.stall_penalty||11,this.switch_penalty=this.autoBitrateOpts.switch_penalty||4,this.interval=this.autoBitrateOpts.interval||1e3;var o=t.progressTimer||1e3,s=this.autoBitrateOpts.startInterval||o;this.initInterval=.8*s,this._prealodMethod=t.preloadmethod||0,this._videoWidth=0,this._videoHeight=0,this._hasDeviceInfoChanged=!0,this.updateMediaInfos(n,!1)}return _createClass$5(e,[{key:"onLoadWasm",value:function(){var e=this,t=this.module={onRuntimeInitialized:function(){e._wasmPromise.resolve()}};return(0,this.autoBitrateOpts.module)(t),this._wasmPromise}},{key:"updateMediaInfos",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._heightToDefitionConfig=new Map,this._bitrateToDefitionConfig=new Map,e?(this.mediaInfos=e,this.mediaInfos.dynamic_video_list.forEach((function(e){t._heightToDefitionConfig.set(e.vheight,e),t._bitrateToDefitionConfig.set(e.bitrate,e)}))):r&&console.error("baseAbr mediaInfos null")}},{key:"parseMPD",value:function(){if(this.setDebugModel(this.openLog),this.mediaInfos){this.logger("mediaInfos",this.mediaInfos);try{for(var e=[],t=this.mediaInfos.dynamic_video_list,r=0;r<t.length;r++){var n=t[r];e.push({stream_id:"s".concat(r),bandwidth:n.bitrate||n.bandwidth,width:n.vwidth||n.width,height:n.vheight||n.height,codec:n.codecs||n.codec_type||"h264",frame_rate:Number(n.fps)||-1,segment_duration:this.segment_duration})}var i={v_adaptation:e},a=JSON.stringify(i);this.module.ccall("parseMPD","null",["string"],[a])}catch(error){}}else console.warn("mediaInfos is null")}},{key:"_getDefautSpeed",value:function(e){var t=0,r=window.navigator.connection;if(r&&r.downlink)t=1024*navigator.connection.downlink/8,this.logger("initSpeed connect",t);else try{t=parseFloat(proxyLocalStorage$1.getItem(SPPED_CACHE))||0,this.logger("initSpeed connect",t)}catch(error){}return 0===t&&(t=e&&e.historyAvspeed||0,this.logger("initSpeed history",t)),t}},{key:"setDebugModel",value:function(e){this.module._setDebugModel(e)}},{key:"updateBitrate",value:function(e){this.bitrate=e}},{key:"_updatePreloadSupplier",value:function(e,t){this.module._updatePreloadSupplier(e,t)}},{key:"updatePreloadSupplier",value:function(e){var t=this._getDefautSpeed();this._updatePreloadSupplier(t,e)}},{key:"getPreloadBitrate",value:function(){var e,t=null,r=[];try{this.logger("preloadMethod",this._prealodMethod),e=this.module._getPreloadBitrate(this._prealodMethod);for(var n=0;n<5;n++)r.push(this.module.HEAP32[e/Int32Array.BYTES_PER_ELEMENT+n]);var i={bitrate:r[0],pduration:r[1],preloadType:r[2],size:r[3],mediaType:r[4]};return this.logger("getPreloadBitrate",i),i}catch(error){t=null,console.log("getPreloadBitrate",error)}finally{this.module._free(e)}return t}},{key:"_updateDeviceInfo",value:function(e){try{if(this._hasDeviceInfoChanged){var t=window.devicePixelRatio||1;this.module._updateDeviceInfo(this._videoWidth||Number(this.config.width),this._videoHeight||Number(this.config.height),t,e||-1)}this._hasDeviceInfoChanged=!1}catch(error){console.log("_updateDeviceInfo")}}},{key:"preload",value:function(e){this.parseMPD(),this.updatePreloadSupplier(e),this._updateDeviceInfo(-1);var t=window.devicePixelRatio||1;return this.logger("baseAbr updateDeviceInfo width",this._videoWidth||Number(this.config.width),"height",this._videoHeight||Number(this.config.height),"dpr",t),this.getPreloadBitrate()}}]),e}();function _createSuper$l(e){var t=_isNativeReflectConstruct$m();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$m(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}BaseAbr.SPPED_CACHE=SPPED_CACHE;var ABR_EVENTS={ABR_CHANGE:"ABR_CHANGE_A",ABR_UPDATE_SPEC:"ABR_UPDATE_SPEC",START_ABR:"START_ABR",UPDATE_AUTO_DESC:"UPDATE_AUTO_DESC",ABR_START_PROGRESS:"ABR_START_PROGRESS",MAX_BUFFER_CHANGE:"MAX_BUFFER_CHANGE"},INIT_BIRTATE=0,AUTO_FLAG="__auto__",MIN_WAITIONG$1=200,SEEKING_STATE={SEEK_NO:0,SEEK_FORWARD:1,SEEK_BACKWORD:-1},STALL_STATE={STALL_NO:0,STALL:1},AVG_ARGS={PLAYBACK_BITRATE:"avg_play_bitrate",DOWNLOAD_BITRATE:"avg_download_bitrate",DOWNLOAD_NETWORK_SPEED:"avg_download_speed",PREDICT_NETWORK_SPEED:"avg_predict_speed",BUFFER_LENGTH:"avg_buffer_length",QOE:"avg_qoe"},ABR=function(t){_inherits$4(n,t);var r=_createSuper$l(n);function n(e,t,i,a,o){var s,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{logger:function(){},openLog:!1};_classCallCheck$4(this,n),(s=r.call(this,t,i,a,o,u)).player=e,s.timerId=0,s.isOpenAutoDefi=!!s.autoBitrateOpts.isOpenAutoDefi,s.onPlayrateChange=s._onPlayrateChange.bind(_assertThisInitialized$4(s)),s.onPlay=s._onPlay.bind(_assertThisInitialized$4(s)),s._stop=s.stop.bind(_assertThisInitialized$4(s)),s._bufferRange=new Map,s._sortedBufferRange=[],s._lastCheckResolutionStamp=0,s._currentDefinition=null,s._isSeeking=!1,s._waitingStartTime=0,s._stallCount=0,s._seekState=SEEKING_STATE.SEEK_NO,s._stallState=STALL_STATE.STALL_NO,s._videoCurrentTime=0,s.listeners=[{evt:"playbackrateChange",handler:s.onPlayrateChange},{evt:"ended",handler:s._stop},{evt:"error",handler:s._stop},{evt:"timeupdate",handler:s._onTimeUpdate.bind(_assertThisInitialized$4(s))},{evt:"addVideoBufferEnd",handler:s._bufferRangeUpdate.bind(_assertThisInitialized$4(s))},{evt:"canplay",handler:s._updateAutoDesc.bind(_assertThisInitialized$4(s))},{evt:"play",handler:s._onplayStart.bind(_assertThisInitialized$4(s))},{evt:ABR_EVENTS.MAX_BUFFER_CHANGE,handler:s._onMaxBufferChange.bind(_assertThisInitialized$4(s))},{evt:"seeking",handler:s._onSeeking.bind(_assertThisInitialized$4(s))},{evt:"seeked",handler:s._onSeekEnd.bind(_assertThisInitialized$4(s))},{evt:"waiting",handler:s._onWaiting.bind(_assertThisInitialized$4(s))},{evt:"playing",handler:s._onPlaying.bind(_assertThisInitialized$4(s))}],s._hasStart=!1,s.listeners.forEach((function(e){var t=e.evt,r=e.handler;s.player.on(t,r)})),s._isPaused=!1,s._hasAddFrament=!1,s._eventInfo={local_time_ms:0,internet_speed:0,buffer_length:0,last_bitrate:0,now_bitrate:0,play_speed:1},s._bitrateSet=[],s._generalInfo={},s._currentInAbr=!1,s._hasCalcTimelineLog=!1,s._abr_play_info={start_play_time_ms:0,is_hint:0,playback_info:{internet_speed_record:[],play_bitrate_record:[],buffer_length_record:[],play_speed_record:[],qoe_record:[],qoe_a_record:[],qoe_b_record:[],qoe_c_record:[]}},s._abrMethod=s.autoBitrateOpts.method||0,s.logger("abr: constructor"),s._loopInterval=s.initInterval,s._tickCount=0,s._fps=30,FpsDetection.install(),s.startTime=performance.now(),s.logger("time abr",(new Date).getTime()),s._maxCacheTimeVideo=s.config.maxBufferLength||s.config.preloadTime||50,s._maxCacheTimeAudio=s._maxCacheTimeVideo,s._prevDefinitionItem=null,s._currentItem=null,s._switchCount=0,s._switchBitrate=0,s._avgStatItems={};for(var c=Object.keys(AVG_ARGS),l=0;l<c.length;l++){var d=c[l],h=AVG_ARGS[d];s._avgStatItems[h]=new AvgStat}return s._qoeArgs=[0,0,0,0],s._abrUsed=-1,s._abrAlwaysOn=1,s._prelaodInfo=null,s._hasLogStartInfo=!1,s._hasExecuteAbrAlgo=!1,s._lastExecuteTimeInMs=0,s}return _createClass$5(n,[{key:"init",value:function(e){return this._mediaList=e,this.isOpenAutoDefi?this.onLoadWasm():this._wasmPromise.resolve(),this._wasmPromise}},{key:"execute",value:function(){return this.listenSize(),this.initFps(),this.onWinElemSizeChange(),this.onPlay()}},{key:"_onSeeking",value:function(){this._isSeeking=!0,this.player.currentTime<this._videoCurrentTime?this._seekState=SEEKING_STATE.SEEK_BACKWORD:this._seekState=SEEKING_STATE.SEEK_FORWARD,this.logger("seekState",this._seekState)}},{key:"_onSeekEnd",value:function(){this._isSeeking=!1}},{key:"_onWaiting",value:function(){var e=this;this._isSeeking||this._waitingStartTime>0||(this._waitingStartTime=(new Date).getTime(),this._stallId=setTimeout((function(){clearTimeout(e._stallId),e._stallCount++,e._stallState=STALL_STATE.STALL}),MIN_WAITIONG$1))}},{key:"_onPlaying",value:function(){this._waitingStartTime=0,this._stallState=STALL_STATE.STALL_NO,clearTimeout(this._stallId)}},{key:"initFps",value:function(){this.fpsDetection=new FpsDetection,this.fpsDetection.start(),this._fps=this.fpsDetection.fps,this._hasDeviceInfoChanged=!0}},{key:"listenSize",value:function(){this.mediaElem=this.player.video,this._onWinSizeChange=debounce$1(this.onWinElemSizeChange.bind(this),1e3,!1),window.addEventListener("resize",this._onWinSizeChange)}},{key:"onWinElemSizeChange",value:function(){if(this.mediaElem){var e=this.mediaElem.getBoundingClientRect();this._videoWidth=Math.floor(e.width),this._videoHeight=Math.floor(e.height),this._hasDeviceInfoChanged=!0}}},{key:"_onMaxBufferChange",value:function(e){var t=e.videoCacheTime,r=e.audioCacheTime;this._maxCacheTimeAudio=r,this._maxCacheTimeVideo=t}},{key:"_onTimeUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._sortedBufferRange&&0!==this._sortedBufferRange.length&&this._currentInAbr){this._videoCurrentTime=this.player.currentTime;var r=Date.now();if(!(r-this._lastCheckResolutionStamp<1e3&&0!==this._lastCheckResolutionStamp)||t){this._lastCheckResolutionStamp=r;for(var n=this.player.currentTime,i=0,a=this._sortedBufferRange.length-1,o=null;i<=a;){var s=Math.floor(i+(a-i)/2),u=this._sortedBufferRange[s];if(n<u.start)a=s-1;else{if(!(n>=u.end)){o=u;break}i=s+1}}if(o){var c=this._bitrateToDefitionConfig.get(o.bandwidth),l=c&&c.definition;if(this._currentDefinition===l&&!t||!l)return void(l||this.logger("error defintion, mpdé…ç½®ä¸ŽæŽ¥å£é…ç½®ä¸ä¸€è‡´"));this._currentDefinition=l,this._prevDefinitionItem=this._currentItem,this._currentFps=c.fps,this._currentItem=c,this._emitAutoDescChange(l,!1,this._currentFps,c)}}}}},{key:"_emitAutoDescChange",value:function(e,t,r,n){console.log("[ABR],emitAutoDescChange, definition, ",e,",item,",n,",pre_item,",this._prevDefinitionItem),this.player.emit(ABR_EVENTS.UPDATE_AUTO_DESC,{definition:e,reset:t,fps:r,item:n,pre_item:this._prevDefinitionItem})}},{key:"_onplayStart",value:function(){this._hasStart=!0,this.logger("onplaystart")}},{key:"_updateAutoDesc",value:function(){var e=this;this._currentInAbr&&this._currentDefinition&&(this._updateId=setTimeout((function(){clearTimeout(e._updateId),e._emitAutoDescChange(e._currentDefinition,!1,e._currentFps,e._currentItem)}),0))}},{key:"_bufferRangeUpdate",value:function(e){if(void 0!==e.start){null===this._currentItem&&this._onTimeUpdate(null,!0);var t=e.start;this._hasAddFrament=!0,this._bufferRange.set(t,e);var r=_toConsumableArray$1(this._bufferRange.values());this._sortedBufferRange=r.sort((function(e,t){return e.start-t.start})),this.avgStat(AVG_ARGS.DOWNLOAD_BITRATE,e.bandwidth)}}},{key:"_onPlayrateChange",value:function(){this.module&&this.updateBufferInfo()}},{key:"_onPlay",value:function(){var e=this;if(!this.isOpenAutoDefi)return this.logger("onPlay"),INIT_BIRTATE;var t=INIT_BIRTATE;try{this.logger("abr: loadeddata"),this.updateSwitchInfo(),this.parseMPD(),this.updateDeviceInfo();var r=n.getIsPlayAutoDefi(this.autoBitrateOpts);if(this.isOpenAutoDefi&&r){this._abrUsed=1;var i=this._getDefautSpeed(this.player);t=this._loopAbr(i),this.start(),this.logger("time abr start prgress",(new Date).getTime()),this.logger("time abr costTime",performance.now()-this.startTime),this.logger("abr onplay"),this.startTimer=setTimeout((function(){e._loopInterval=e.interval,clearTimeout(e.startTimer),e.logger("interval change")}),5e3)}}catch(error){this.logger("abr: loadeddata error",error),this.logger("time abr costTime err",performance.now()-this.startTime)}return t}},{key:"start",value:function(){if(this.logger("abr: start"),this._isPaused=!1,!this._hasCalcTimelineLog){var e=1===Math.floor(100*Math.random());this._abr_play_info.is_hint=e?1:0}this._hasCalcTimelineLog=!0,this._loop()}},{key:"_loop",value:function(){var e=this;this._isPaused||(clearTimeout(this.timerId),this.timerId=setTimeout((function(){if(!e.player.paused||!e.player.config.autoplay&&!e._hasStart){var t=e._hasAddFrament?void 0:e._getDefautSpeed(e.player);e._loopAbr(t)}e._loop()}),this._loopInterval))}},{key:"updateDeviceInfo",value:function(){try{if(this.fpsDetection){var e=this.fpsDetection.fps;e!==this._fps&&(this._fps=e,this._hasDeviceInfoChanged=!0)}this._updateDeviceInfo(this._fps)}catch(error){}}},{key:"updateBufferInfo",value:function(e){var t=this.player.playbackRate,r=this.bufferLength,n=e||Math.floor(this.player.downloadSpeed);return this._tickCount<5&&0===n&&(n=this._getDefautSpeed(this.player),this.logger("initSpeed fix")),this.logger("maxCacheTimeAudio:",this._maxCacheTimeAudio,"maxCacheVideoTime",this._maxCacheTimeVideo,"seekState",this._seekState,"stallState",this._stallState),this.module._updateBufferInfo(t,this._maxCacheTimeAudio,this._maxCacheTimeVideo,r,r,n,this._seekState,this.player.currentTime,this._stallState),this._seekState=SEEKING_STATE.SEEK_NO,this._eventInfo={internet_speed:n,buffer_length:r,last_bitrate:this.bitrate,play_speed:t},this.logger("playRate:",t,"buff:",r,"downloadSpeed:",n),{buffer:r,downloadSpeed:n}}},{key:"updateSwitchInfo",value:function(){var e=(new Date).getTime();this._openTimeMs=e,this._abr_play_info.start_play_time_ms=e;var t=this.player.config.preloadTime||50,r=convert32ToC64(e),n=this.autoBitrateOpts.noStallCheckTime||5,i=this.openLog;this.logger("openTime:",e,"this.logger",i),this.module._updateSwitchInfo(r.low,r.high,n,i,this.stall_penalty,this.switch_penalty);var a=this._mediaList.video,o=a.map((function(e){var t=e.bandwidth,r=e.bitrate;return t||r}));this._bitrateSet=o.map((function(e,t){return{bitrate:e,codecs:a[t].codecs||a[t].codec_type}})),this._generalInfo={max_cache_time:t,bitrate_set:this._bitrateSet,segment_duration:this.segment_duration,preload_info:{},startup_info:{}}}},{key:"updatePreloadCacheInfo",value:function(t){try{this._prelaodInfo=t,this.logger("update preloadInfo",t),t&&t.item_num!==t.items.length&&(this.logger("preloadInfo invalid"),this._prelaodInfo=null)}catch(e){this.logger("updatePreloadCacheInfo",e),this._prelaodInfo=null}}},{key:"updatePreloadLogInfo",value:function(e){this._generalInfo.preload_info=e||{}}},{key:"_updatePreloadInfo",value:function(){try{var t=this.player.getPreloadInfos();if(t){var r=t.preloadInfo,n=t.abr;this.updatePreloadLogInfo(r),n&&this.updatePreloadCacheInfo(r)}if(this.logger("_updatePreloadInfo preloadinfos",t),null!=this._prelaodInfo){var i=JSON.stringify(this._prelaodInfo);this.module.ccall("updatePreloadInfo","null",["string"],[i])}else this.logger("_updatePreloadInfo preloadinfo null, no preload")}catch(e){this.logger("_updatePreloadInfo err",e)}}},{key:"_loopAbr",value:function(e){var t;this._tickCount++;var r=[];try{this.updateDeviceInfo();var n=this.updateBufferInfo(e),i=n.downloadSpeed,a=n.buffer;t=this.module._getPredictedBitrate(this.bitrate,this._abrMethod);for(var o=0;o<7;o++)r.push(this.module.HEAP32[t/Int32Array.BYTES_PER_ELEMENT+o]);var s=r[0],u=1===r[1];this._eventInfo.now_bitrate=s,this._eventInfo.local_time_ms=(new Date).getTime();var c=0;if(s!==this.bitrate&&0!==s){var l=this.bitrate;c=Math.abs(l-s);for(var d=[],h=this.player.video.buffered,f=0;f<h.length;f++)d.push({start:h.start(f),end:h.end(f)});var p=this._videoWidth||Number(this.config.width),g=this._videoHeight||Number(this.config.height),y=(new Date).getTime(),m={speed:"".concat(i," KB/s"),buffer_length:"".concat(a," s"),video_pos:this.player.currentTime,all_buffers:d,seek_state:this._seekState,stall_state:this._stallState,screen_width:p,screen_height:g,dpr:window&&window.devicePixelRatio,playbackRate:this.player.playbackRate,bitrateSet:this._bitrateSet,abrMethod:this._abrMethod,delta:this._hasExecuteAbrAlgo?y-this._lastExecuteTimeInMs:0};this._lastExecuteTimeInMs=y,this._hasExecuteAbrAlgo=!0,this.player.emit(ABR_EVENTS.ABR_CHANGE,this.bitrate,s,u,JSON.stringify(m)),this.logger("abr loop predicte:",s,"willStall:",u,"switchBitrate",c,"cur",l),this.bitrate=s}this._hasLogStartInfo||(this._hasLogStartInfo=!0,this._generalInfo.startup_info={predict_bitrate:s,download_speed:i,screen_width:this._videoWidth||Number(this.config.width),screen_height:this._videoHeight||Number(this.config.height),device_pixel_ratio:window&&window.devicePixelRatio,screen_fps:this._fps,startup_method:this._abrMethod}),this.player.emit("ABR_LOOP"),this.onAbrLoop(i,r[2],c,r.slice(3))}catch(error){this.logger("abr error",error),console.log("error",error)}finally{this.module._free(t)}return this.bitrate}},{key:"stop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!0===e&&(this._abrAlwaysOn=-1),clearTimeout(this.timerId),this._isPaused=!0,this.logger("abr: stop")}},{key:"destroy",value:function(){var e=this;this._stop(),this.listeners.forEach((function(t){var r=t.evt,n=t.handler;e.player.off(r,n)})),this.player=null,this._heightToDefitionConfig=null,this._bitrateToDefitionConfig=null,this._bufferRange=null,this._sortedBufferRange=null,this.module=null,clearTimeout(this._stallId),clearTimeout(this._updateId),clearTimeout(this.startTimer),window.removeEventListener("resize",this._onWinSizeChange),this.fpsDetection&&this.fpsDetection.stop(),this.player=null}},{key:"eventInfo",get:function(){return this._eventInfo}},{key:"generalInfo",get:function(){return this._generalInfo}},{key:"bufferLength",get:function(){var e=this.player.getBufferedRange(),t=this.player.video.currentTime,r=e[1]-Math.max(e[0],t);return r=Math.max(0,r).toFixed(2),parseFloat(r)}},{key:"downloadSpeed",get:function(){return Math.floor(this.player.downloadSpeed)}},{key:"nowBitrate",get:function(){return this.bitrate}},{key:"openTimeMs",get:function(){return this._openTimeMs}},{key:"isCurrentInAbr",get:function(){return this._currentInAbr},set:function(e){this._currentInAbr=e}},{key:"onAbrLoop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(this._qoeArgs=n,this._currentItem&&this.avgStat(AVG_ARGS.PLAYBACK_BITRATE,this._currentItem.bitrate),this.avgStat(AVG_ARGS.DOWNLOAD_NETWORK_SPEED,1e3*e*8),this.avgStat(AVG_ARGS.PREDICT_NETWORK_SPEED,t),this.avgStat(AVG_ARGS.BUFFER_LENGTH,this.bufferLength),this.avgStat(AVG_ARGS.QOE,this.getQoeRelValue(0)),r>0&&(this._switchCount++,this._switchBitrate+=r),this._abr_play_info.is_hint){var i=this,a=((new Date).getTime()-this.openTimeMs)/1e3;a=parseFloat(a.toFixed(2)),this._abr_play_info.playback_info.internet_speed_record.push([a,i.downloadSpeed]),this._abr_play_info.playback_info.play_bitrate_record.push([a,i.nowBitrate]),this._abr_play_info.playback_info.buffer_length_record.push([a,i.bufferLength]),this._abr_play_info.playback_info.play_speed_record.push([a,this.player.playbackRate]),this._abr_play_info.playback_info.qoe_record.push([a,this.getQoeRelValue(0)]),this._abr_play_info.playback_info.qoe_a_record.push([a,this.getQoeRelValue(1)]),this._abr_play_info.playback_info.qoe_b_record.push([a,this.getQoeRelValue(2)]),this._abr_play_info.playback_info.qoe_c_record.push([a,this.getQoeRelValue(3)])}}},{key:"getQoeRelValue",value:function(e){return this._qoeArgs[e]/100}},{key:"avgStat",value:function(e,t){var r=this._avgStatItems[e];r&&r.add(t)}},{key:"getAbrPlayInfo",value:function(){return this._abr_play_info}},{key:"updateAbrMethod",value:function(e){this._abrMethod=e}},{key:"getAbrMethod",value:function(){return this._abrMethod}},{key:"getAbrVVStats",value:function(){for(var e={},t=Object.keys(AVG_ARGS),r=0;r<t.length;r++){var n=t[r],i=AVG_ARGS[n],a=this._avgStatItems[i];e[i]=a.avg()}return e.switch_counts=this._switchCount,e.avg_switch_bitrate=0===this._switchCount?0:this._switchBitrate/this._switchCount,e.abr_qoe=this.getQoeRelValue(0),e.abr_qoe_a=this.getQoeRelValue(1),e.abr_qoe_b=this.getQoeRelValue(2),e.abr_qoe_c=this.getQoeRelValue(3),e.abr_method=this._abrMethod,e.abr_used=this._abrUsed,e.abr_always_on=this._abrAlwaysOn,this.logger("abrVVStats",e),e}}],[{key:"getIsPlayAutoDefi",value:function(e){return!!e.isPlayAutoDefi}}]),n}(BaseAbr),AvgStat=function(){function e(){_classCallCheck$4(this,e),this.total=0,this.count=0}return _createClass$5(e,[{key:"add",value:function(e){this.total+=e,this.count++}},{key:"avg",value:function(){if(0===this.count)return 0;var e=this.total/this.count;return Math.floor(e)}}]),e}(),MEDIA_TYPES$1=MEDIA_TYPES$2,PrelaodAbr=function(e){_inherits$2(r,e);var t=_createSuper$n(r);function r(e,n,i,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{logger:function(){},openLog:!1};return _classCallCheck$2(this,r),t.call(this,e,n,i,a,o)}return _createClass$3(r,[{key:"init",value:function(){return this.onLoadWasm()}},{key:"preloadPredict",value:function(){return this.preload(MEDIA_TYPES$1.VIDEO)}}]),r}(BaseAbr),MixedPredict=function(e){_inherits$2(r,e);var t=_createSuper$n(r);function r(e){var n;return _classCallCheck$2(this,r),(n=t.call(this)).loggerConfig=e,n._isWasmSupport=checkWebAssemblySupport(),n}return _createClass$3(r,[{key:"init",value:function(e){var t=e.autoBitrateOpts||{},r=t.module;return this.isOpenAbr=t.isOpenAutoDefi,this.isOpenAbr&&!r&&(console.warn("if open abr, need [module], abr open change to close"),this.isOpenAbr=!1),this._isWasmSupport&&r&&this.isOpenAbr?(this._abrPreloadInst=new PrelaodAbr(e,0,null,5,this.loggerConfig),this._abrPreloadInst.init()):Promise.resolve()}},{key:"preloadPredict",value:function(e){var t=this._mediaInfos,r=0,n=0;if(this._isWasmSupport&&this.isOpenAbr&&(e.useAbr||void 0===e.useAbr)){this._abrPreloadInst.updateMediaInfos(this._mediaInfos);var i=this._abrPreloadPredict();r=i.videoIdx,n=i.time}else r=this.getIdx(t.dynamic_video_list,e.defaultDefinition),this._cachedData=null;var a=t.dynamic_video_list[r]||t.dynamic_video_list[0];return{bandwidth:a.bitrate||a.bandwidth,executeTime:n}}},{key:"_abrPreloadPredict",value:function(){var e=this._abrPreloadInst.preloadPredict();this._cachedData=e;var t=e.bitrate,r=0,n=this.bandwidth2item[t];if(n){var i=n.definition;r=this.getIdx(this._mediaInfos.dynamic_video_list,i)}return{videoIdx:r,time:e.pduration}}},{key:"cachedData",get:function(){return this._cachedData}}]),r}(PredictBase$1);function transformTopModel(e){e.duration=e.dashOpts.Data.Duration,e.dashOpts.dynamic_video=e.dashOpts.Data,e.dashOpts.dynamic_video.dynamic_video_list=[],e.dashOpts.dynamic_video.dynamic_audio_list=[],e.dashOpts.dynamic_video.dynamic_type=e.dashOpts.Data.AdaptiveInfo.AdaptiveType,e.dashOpts.dynamic_video.main_url=e.dashOpts.Data.AdaptiveInfo.MainPlayUrl;for(var t=0;t<e.dashOpts.Data.PlayInfoList.length;t++){var r=e.dashOpts.Data.PlayInfoList[t],n={backup_url_1:r.BackupPlayUrl,bitrate:e.dashOpts.Data.VideoID?r.Bitrate:1e3*r.Bitrate,check_info:r.CheckInfo,codec_type:r.Codec,definition:r.Definition,encrypt:!(!r.PlayAuth||!r.PlayAuthID&&!r.PlayAuthId),file_hash:r.FileHash||r.Md5,file_id:r.FileID,index_range:r.IndexRange,init_range:r.InitRange,kid:r.PlayAuthID||r.PlayAuthId,logo_type:r.Logo||r.LogoType,main_url:r.MainPlayUrl,preload_interval:r.PreloadInterval,preload_max_step:r.PreloadMaxStep,preload_min_step:r.PreloadMinStep,preload_size:r.PreloadSize,quality:r.Quality,size:r.Size,spade_a:r.PlayAuth,vheight:r.Height,vtype:r.Format,vwidth:r.Width};"video"===r.MediaType||"video"===r.FileType?e.dashOpts.dynamic_video.dynamic_video_list.push(n):"audio"!==r.MediaType&&"audio"!==r.FileType||e.dashOpts.dynamic_video.dynamic_audio_list.push(n)}}var _BITRATE_SELECTOR$1=null,DashPreloader=function(t){_inherits$2(i,t);var r,n=_createSuper$n(i);function i(e,t,r){var a;return _classCallCheck$2(this,i),t.vtype=VTYPES$2.DASH,(a=n.call(this,t)).player=e,a.logger=r||function(){},a.loader=new Loader({},a.preloadManager),a}return _createClass$3(i,[{key:"before",value:function(){var t=this;this.handlers={start:function(e){return t.start(e)},onRequest:function(e,r){var n=e.url,i=e.range,a=e.extData;return t.getData(n,i,a,r)}},this.loggerConfig={logger:function(){},openLog:!1};try{!!localStorage.getItem("abrdebug")&&(this.loggerConfig.logger=console.log,this.loggerConfig.openLog=!0)}catch(e){}this.predictInst=new MixedPredict(this.loggerConfig)}},{key:"start",value:function(e){var t=this,r=new ProxyPromise$1,n=e.payload;if("TOP"===e.playInfoType){var a={dashOpts:e.payload};transformTopModel(a),n=a.dashOpts.dynamic_video}n.dynamic_video_list&&n.dynamic_video_list.forEach((function(e){e.bitrate=e.real_bitrate||e.bitrate})),n.dynamic_audio_list&&n.dynamic_audio_list.forEach((function(e){e.bitrate=e.real_bitrate||e.bitrate}));var o=new MPD("anytext",{dynamic_video:n},this),s={mediaInfos:{dynamic_video_list:[],dynamic_audio_list:[]},onObtain:function(e){var t=new ProxyPromise$1;return t.resolve(s.mediaInfos),t},onTransform:function(r){var a=new ProxyPromise$1;if(i.BitRateAdapter){var s=t.getUserSelectDefinition(),u=util$1.getSelectorList(n,e.duration),c=i.BitRateAdapter.getSuitableBitrate(u,s);t.logger("[xgplayer-encrypt] preloader getSuitableBitrate",c,"userSelectDefinition",s),c&&(r.bandwidth=c.bitrate)}var l=o.mediaList.video||[],d=o.mediaList.audio||[],h=e.vid;if("segment_template"===o.dashType)t._calRequests(o,r,a,e,!0);else{var f=[];if(d&&d.length>0){var p=t.makeInitBaseSegemntRequest(o,e.duration,"audio",0,void 0,h);f.push(p)}if(l&&l.length>0){var g=t._calVideoItemIdx(l,r.bandwidth)||0,y=l[g].definition,m=t.makeInitBaseSegemntRequest(o,e.duration,"video",g,y,h);f.push(m)}Promise.all(f).then((function(){t._calRequests(o,r,a,e)})).catch((function(e){console.warn&&console.warn("catch no reqeuset",e),a.resolve([])}))}return a}};return o.once("ready",(function(){s.type=o.type,s.mediaInfos.dynamic_video_list=o.mediaList.video||[],s.mediaInfos.dynamic_audio_list=o.mediaList.audio||[],r.resolve(s)})),o.init(),r}},{key:"_calRequests",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=[],o=t.bandwidth,s=t.time,u=t.executeTime,c=e.mediaList.video||[],l=e.mediaList.audio||[],d=n.vid;if(l&&l.length>0){var h=this._calUrls(l[0],s,u,"audio",d,null,i);a=a.concat(h)}if(c&&c.length>0){var f=this._calVideoItemIdx(c,o)||0,p=c[f],g=this._calUrls(p,s,u,"video",d,p.definition,i);a=a.concat(g)}0===a.length&&console.warn&&console.warn("no reqeusts from preloader"),r.resolve(a)}},{key:"_calUrls",value:function(e,t,r,n,i,a){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=[];if(e){var u=e;o&&s.push({url:u.initSegment,range:u.initSegmentRange||[],extData:{cacheKey:util$1.generateUniqueKey({vid:i,mediaType:n,codecType:u.codec_type,format:"dash",bitrate:u.bandwidth||u.bitrate}),vid:i,format:"dash",isInitSegment:!0,mediaType:n,useUrlRange:util$1.validateUrlRange(this.options.url_range_domains,u.initSegment)}});var c=e.mediaSegments,l=this._calStartEnd(c,t,r),d=c[l];s.push({url:d.url,range:d.range||[],extData:{cacheKey:util$1.generateUniqueKey({vid:i,mediaType:n,codecType:u.codec_type,format:"dash",start:d.start,end:d.end,definition:a,bitrate:u.bandwidth||u.bitrate}),vid:i,format:"dash",isInitSegment:!1,mediaType:n,useUrlRange:util$1.validateUrlRange(this.options.url_range_domains,d.url)}})}return s}},{key:"_calStartEnd",value:function(e,t,r){for(var n=-1,i=0;i<e.length;i++){var a=e[i],o=t||0;if(a.start>=o&&o<a.end){n=i;break}}return-1===n&&(n=0),n}},{key:"_calVideoItemIdx",value:function(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(n&&n.bandwidth===t)return r}return null}},{key:"getData",value:(r=_asyncToGenerator$3(_regeneratorRuntime$1().mark((function e(t){var r,n,i,a,o,s,u,c=arguments;return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>1&&void 0!==c[1]?c[1]:[],n=c.length>2&&void 0!==c[2]?c[2]:{},i=c.length>3?c[3]:void 0,e.prev=3,e.next=6,this.loader.load(n.mediaType,t,r,n,!0);case 6:return a=e.sent,o=a.res,s=a.headers,u=a.cacheKey,i&&i({total:o.byteLength,loaded:o.byteLength,cacheKey:u||n.cacheKey}),e.abrupt("return",{res:o,headers:s});case 14:return e.prev=14,e.t0=e.catch(3),console.log("preload get data error",e.t0),e.abrupt("return",{res:null});case 18:case"end":return e.stop()}}),e,this,[[3,14]])}))),function(e){return r.apply(this,arguments)})},{key:"makeInitBaseSegemntRequest",value:function(e,t,r,n,i,a){var o=this,s=new ProxyPromise$1,u=e.mediaList[r][n],c=[u.initSegmentRange[0],u.sidxRange[1]],l=u.initSegment,d={mediaType:r,vid:a,definition:i,useUrlRange:util$1.validateUrlRange(this.options.url_range_domains,l),timeout:-1,isInitSegment:!0,bitrate:u.bandwidth||u.bitrate};return this.getData(l,c,d,(function(e){var t=Object.assign({},e,{vid:a,mediaType:r,isInitSegment:!0,format:"dash"});o._preloadManager.onCacheSegment(t)}),-1).then((function(i){var a=i.res;a&&"error"!==a?o.handleInitData(a,c,u.sidxRange).then((function(i){i.sidxSegmentRes&&e.getSidx(i.sidxSegmentRes,r,n,t),util$1.validateFragment(i.initSegmentRes,c)?s.resolve(i.initSegmentRes):(s.reject({mediaType:r,index:n,initSegmentRange:c,url:l,rejected:!0}),o.logger("initSegmentRequest åˆ†ç‰‡æ ¡éªŒå¤±è´¥"))})).catch((function(e){s.reject({mediaType:r,index:n,initSegmentRange:c,url:l,rejected:!0}),o.logger("initSegmentRequest error",e)})):s.reject({mediaType:r,index:n,initSegmentRange:c,url:l,rejected:!0})})).catch((function(e){s.reject({mediaType:r,index:n,initSegmentRange:c,url:l,rejected:!0}),o.logger("initSegmentRequest error",e)})),s}},{key:"handleInitData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new ProxyPromise$1,i=e instanceof ArrayBuffer;if(i){var a=0===t.length?e:e.slice(t[0],t[1]+1),o=null===r?null:e.slice(r[0],r[1]+1);n.resolve({initSegmentRes:a,sidxSegmentRes:o})}else;return n}},{key:"checkIfExistInList",value:function(e){for(var t=this._preloadManager._preloadDataList,r=0;r<t.length;r++)if(e===t[r].data.vid)return!0;return!1}},{key:"addPreloader",value:function(e,t){if(e.data){e.data.vtype||(e.data.vtype=VTYPES$2.DASH);var r=e.data.vid,n=this.checkIfExistInList(r);this.logger("[Preloader-Dash] addPreloader checkIfExistInList",r,n),t&&r===t||n||this.addDashPreloader(e)}}},{key:"addPreloaderList",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,r=0;r<e.length;r++)this.addPreloader(e[r],t)}},{key:"setUserSelectDefinition",value:function(e){this._preloadManager&&(this._preloadManager.userDefinition=e)}},{key:"getUserSelectDefinition",value:function(){return this._preloadManager.userDefinition||null}}],[{key:"BitRateAdapter",get:function(){return _BITRATE_SELECTOR$1},set:function(e){_BITRATE_SELECTOR$1=e}}]),i}(PreloaderBase$1);DashPreloader.encryptUtils=isSupport$2;var $$g=_export,$some=arrayIteration.some,arrayMethodIsStrict=arrayMethodIsStrict$8,STRICT_METHOD=arrayMethodIsStrict("some");function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$1(e,t,r){return t&&_defineProperties$1(e.prototype,t),r&&_defineProperties$1(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$1(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _construct$1(e,t,r){return(_construct$1=_isNativeReflectConstruct$l()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&_setPrototypeOf(i,r.prototype),i}).apply(null,arguments)}function _isNativeFunction$1(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _wrapNativeSuper$1(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper$1=function(e){if(null===e||!_isNativeFunction$1(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct$1(e,arguments,_getPrototypeOf(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(r,e)},_wrapNativeSuper$1(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof$7(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _createSuper$k(e){var t=_isNativeReflectConstruct$l();return function(){var r,n=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}$$g({target:"Array",proto:!0,forced:!STRICT_METHOD},{some:function(e){return $some(this,e,arguments.length>1?arguments[1]:void 0)}});var CONTENT_TYPES$1={VIDEO:"video",AUDIO:"audio"},ERROR_TYPES$3={MSE_OP_FAIL:"MS_OP_FAIL",MSE_DESTROY:"MSE_DESTROY",QuotaExceededError:"QuotaExceededError"},MSEError=function(e){_inherits(r,e);var t=_createSuper$k(r);function r(e){var n,i=e.msg,a=e.context,o=e.name;return _classCallCheck(this,r),(n=t.call(this,i)).context=a,n.name=o,n}return _createClass$1(r)}(_wrapNativeSuper$1(Error)),MSE$2=function(){function t(e,r){_classCallCheck(this,t),this.mediaSource=new window.MediaSource(e),this.url=window.URL.createObjectURL(this.mediaSource),this.queue=[],this._hasDestroyed=!1,this._sourceOpenPromise=new ProxyPromise$1,this._onSourceOpen=this._onSourceOpen.bind(this),this._onSourceBufferError=this._onSourceBufferError.bind(this),this._onSourceBufferUpdateEnd=this._onSourceBufferUpdateEnd.bind(this),this.mediaSource.addEventListener("sourceopen",this._onSourceOpen),this.opQueues={},this.sourceBuffers={},this.updateHanders={},this.errorHandlers={},this.logger=r||function(){},this._sourceOpenDonePromise=new ProxyPromise$1,this.mseFullFlags={}}return _createClass$1(t,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_defineProperty$1({},CONTENT_TYPES$1.VIDEO,{mimeType:"video/mp4",codec:'video/mp4; codecs="avc1.64001E, mp4a.40.5"'});this.contentTypes=t;var r=Object.keys(this.contentTypes);return this._sourceOpenPromise.then((function(){for(var t=0;t<r.length;t++)try{!function(){var n=r[t],i=e.contentTypes[n].codec,a=e.mediaSource.addSourceBuffer(i),o=function(){return e._onSourceBufferError(n)};a.addEventListener("error",o);var s=function(){return e._onSourceBufferUpdateEnd(n)};a.addEventListener("updateend",s),e.updateHanders={},e.sourceBuffers[n]=a,e.opQueues[n]=[],e.updateHanders[n]=s,e.errorHandlers[n]=o,e.mseFullFlags[n]=!1}()}catch(error){e._sourceOpenDonePromise.reject(error)}e.logger("[debug mse] mse init ready, readyState",e.mediaSource.readyState),e._sourceOpenDonePromise.resolve()})),this._sourceOpenDonePromise}},{key:"sourceOpenPromise",value:function(){return this._sourceOpenPromise}},{key:"_onSourceOpen",value:function(){this.mediaSource.removeEventListener("sourceopen",this._onSourceOpen),this._sourceOpenPromise.resolve()}},{key:"_onSourceBufferError",value:function(e){if(!this._hasDestroyed){var t=this.opQueues[e][0];this.logger("[debug mse] sourceBuffer error, contentType",e,"readyState",this.mediaSource.readyState,"context",t.context,"name",t.name),t.p.reject(new MSEError({msg:ERROR_TYPES$3.MSE_OP_FAIL,context:t.context,name:t.name}))}}},{key:"_onSourceBufferUpdateEnd",value:function(e){if(!this._hasDestroyed){var t=this.opQueues[e][0];t&&(t.p.resolve(t.context),this.pop(e))}}},{key:"state",get:function(){return this.mediaSource.readyState}},{key:"duration",get:function(){return this.mediaSource.duration}},{key:"setDuration",value:function(e){var t=this;return this.mediaSource.duration>e?Promise.resolve():this.enqueueBlockOp((function(){t.ended()?t.logger("[debug mse] setDuration ended"):(t.logger("[debug mse] setDuration"),t.mediaSource.duration=e)}),"setDuration")}},{key:"appendBuffer",value:function(e,t,r){var n=this;return this.enqueueOp(e,(function(){return n._append(e,t,r)}),"appendBuffer",r)}},{key:"_append",value:function(e,t,r){this.logger("[real append], len = ",t.byteLength,"context",r),this.sourceBuffers[e].appendBuffer(t)}},{key:"enqueueOp",value:function(e,t,r,n){var i=this;if(this._hasDestroyed)return Promise.reject(new Error(ERROR_TYPES$3.MSE_DESTROY)).catch((function(){}));var a={handler:t,p:new ProxyPromise$1,name:r,context:n};return this._sourceOpenDonePromise.then((function(){if(i._hasDestroyed)return a.p.reject(new Error(ERROR_TYPES$3.MSE_DESTROY)).catch((function(){}));i.opQueues[e]||(i.opQueues[e]=[]),i.mseFullFlags[e]&&"removeBuffer"===a.name?(i.opQueues[e].splice(0,0,a),i.mseFullFlags[e]=!1,i.handleOp(e)):(i.opQueues[e].push(a),1===i.opQueues[e].length&&i.handleOp(e))})),a.p}},{key:"enqueueBlockOp",value:function(t,r){var n=this;if(this._hasDestroyed)return Promise.reject(new Error(ERROR_TYPES$3.MSE_DESTROY));var i=new ProxyPromise$1;return this._sourceOpenDonePromise.then((function(){if(n._hasDestroyed)return i.reject(new Error(ERROR_TYPES$3.MSE_DESTROY));for(var a=[],o=Object.keys(n.contentTypes),s=function(e){var t=o[e],i=new ProxyPromise$1,s={handler:function(){return i.resolve()},p:i,name:r};n.opQueues[t]||(n.opQueues[t]=[]),n.opQueues[t].push(s),a.push(i),1===n.opQueues[t].length&&s.handler()},u=0;u<o.length;u++)s(u);Promise.all(a).then((function(){try{t()}catch(e){console.log(e)}finally{for(var r=0;r<o.length;r++){var a=o[r];n.pop(a)}i.resolve()}})).catch((function(e){console.log("waiting cath",e)}))})),i}},{key:"isFull",get:function(){for(var e=!1,t=Object.keys(this.contentTypes),r=0;r<t.length;r++){var n=t[r];if(this.mseFullFlags[n]){e=!0;break}}return e}},{key:"handleOp",value:function(e){if(!this._hasDestroyed){var t=this.opQueues[e][0],r=this.mseFullFlags[e];if(t&&!r)try{t.handler()}catch(error){t.p.reject(new Error(error.name)),error.name===ERROR_TYPES$3.QuotaExceededError?this.mseFullFlags[e]=!0:this.pop(e)}}}},{key:"pop",value:function(e){this._hasDestroyed||(this.opQueues[e].shift(),this.handleOp(e))}},{key:"clearEnqueAndRemoveBuffer",value:function(e,t,r,n){r<=t?this._onSourceBufferUpdateEnd(e):(this.opQueues[e]=this.opQueues[e].slice(0,1),this.removeBuffer(e,t,r,n))}},{key:"removeBuffer",value:function(e,t,r,n){var i=this;return this.enqueueOp(e,(function(){return i._remove(e,t,r)}),"removeBuffer",n)}},{key:"_remove",value:function(e,t,r){r<=t?this._onSourceBufferUpdateEnd(e):this.sourceBuffers[e].remove(t,r)}},{key:"endOfStream",value:function(){var e=this;return this.enqueueBlockOp((function(){e.ended()||e._hasDestroyed||e.mediaSource.endOfStream()}),"endOfStream")}},{key:"ended",value:function(){return!this.mediaSource||"ended"===this.mediaSource.readyState}},{key:"isMediaSourceOpen",value:function(){return!!this.mediaSource&&"open"===this.mediaSource.readyState}},{key:"abort",value:function(e,t){var r=this;return this.isMediaSourceOpen()?this.enqueueOp(e,(function(){r.sourceBuffers[e].abort(),r._onSourceBufferUpdateEnd(e)}),"abort",t):Promise.resolve()}},{key:"reuse",value:function(e,t){for(var r=Object.keys(this.contentTypes),n=0;n<r.length;n++){var i=r[n];this.removeBuffer(i,e,t)}}},{key:"_forceAbort",value:function(){try{for(var e=Object.keys(this.contentTypes),t=0;t<e.length;t++){var r=e[t];this.sourceBuffers[r].abort()}}catch(error){console.log("forceAbort error")}}},{key:"destroy",value:function(){if(this.logger("[debug mse] destroy execute"),!this._hasDestroyed){this._forceAbort(),this._hasDestroyed=!0,window.URL.revokeObjectURL(this.url),this.mediaSource&&(this.mediaSource.removeEventListener("sourceclose",this._onMediaSourceClose),this.mediaSource.removeEventListener("sourceopen",this._onSourceOpen));for(var e=Object.keys(this.contentTypes),t=0;t<e.length;t++){var r=e[t],n=this.sourceBuffers[r];if(n){var i=this.errorHandlers[r];n.removeEventListener("error",i);var a=this.updateHanders[r];n.removeEventListener("updateend",a)}}this.opQueues={},this.sourceBuffers={}}}},{key:"buffered",value:function(e){return this.sourceBuffers[e]&&this.sourceBuffers[e].buffered}},{key:"sourceBuffer",value:function(e){return this.sourceBuffers[e]}},{key:"removeSourceBuffer",value:function(e){var t=this.sourceBuffer(e);if(t){this.mediaSource.removeSourceBuffer(t);var r=this.errorHandlers[e];t.removeEventListener("error",r);var n=this.updateHanders[e];t.removeEventListener("updateend",n),delete this.errorHandlers[e],delete this.sourceBuffers[e],delete this.updateHanders[e]}}},{key:"setTimeoffset",value:function(e,t,r){var n=this;return this.enqueueOp(e,(function(){t<0&&(t+=.001),n.sourceBuffers[e].timestampOffset=t,n._onSourceBufferUpdateEnd(e)}),"setTimeoffset",r)}}],[{key:"isSupported",value:function(e){return window.MediaSource&&window.MediaSource.isTypeSupported(e)}}]),t}(),$$f=_export,uncurryThis$4=functionUncurryThis,toString$5=toString$v,charAt=uncurryThis$4("".charAt),charCodeAt=uncurryThis$4("".charCodeAt),exec=uncurryThis$4(/./.exec),numberToString=uncurryThis$4(1..toString),toUpperCase=uncurryThis$4("".toUpperCase),raw=/[\w*+\-./@]/,hex=function(e,t){for(var r=numberToString(e,16);r.length<t;)r="0"+r;return r};$$f({global:!0},{escape:function(e){for(var t,r,n=toString$5(e),i="",a=n.length,o=0;o<a;)t=charAt(n,o++),exec(raw,t)?i+=t:i+=(r=charCodeAt(t,0))<256?"%"+hex(r,2):"%u"+toUpperCase(hex(r,4));return i}});var EME$1=function(){function e(t){_classCallCheck$2(this,e),this.drm=t,this.KEYSYSTEM_TYPE="",this.keys={},this.drm.clearKeys?(this.KEYSYSTEM_TYPE="org.w3.clearkey",this.keys=this.drm.clearKeys):this.drm.widevine?(this.KEYSYSTEM_TYPE="com.widevine.alpha",this.keys=this.drm.widevine):this.drm.playready&&(this.KEYSYSTEM_TYPE="com.microsoft.playready",this.keys=this.drm.playready),this.options=[],this.ensurePromise=void 0,this.licenseStep=0,EventEmitter(this)}return _createClass$3(e,[{key:"bail",value:function(e){}},{key:"getLicenseRequestFromMessage",value:function(e){if("com.microsoft.playready"===this.KEYSYSTEM_TYPE){var t=null,r=new DOMParser,n=new Uint16Array(e),i=String.fromCharCode.apply(null,n),a=r.parseFromString(i,"application/xml");if(!a.getElementsByTagName("PlayReadyKeyMessage")[0])return e;var o=a.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;return o&&(t=window.atob(o)),t}return new Uint8Array(e)}},{key:"parseServerResponse",value:function(e){var t="http://schemas.xmlsoap.org/soap/envelope/";if(window.DOMParser){var r=this.uintToString(e),n=(new window.DOMParser).parseFromString(r,"text/xml"),i=n?n.getElementsByTagNameNS(t,"Envelope")[0]:null,a=i?i.getElementsByTagNameNS(t,"Body")[0]:null;if(a?a.getElementsByTagNameNS(t,"Fault")[0]:null)return null}return e}},{key:"uintToString",value:function(e){var t=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(t))}},{key:"licenseRequestReady",value:function(e){var t=this,r=new XMLHttpRequest;r.open("GET",this.keys.serverURL),r.onreadystatechange=function(){if(4===r.readyState){var n=e.message,i=r.response;"com.microsoft.playready"===t.KEYSYSTEM_TYPE&&(i=JSON.parse(r.response),i="".concat(i.licenseAcquisitionUrl,"?ExpressPlayToken=").concat(i.token));var a=new XMLHttpRequest;a.keySession=e.target,a.responseType="arraybuffer",a.withCredentials=!1,a.open("POST",String(i)),"com.microsoft.playready"===t.KEYSYSTEM_TYPE&&a.setRequestHeader("Content-type","text/xml"),a.onreadystatechange=function(){if(4===a.readyState){if(200!==a.status)return void t.emit(CDM_LICENSE_ERROR,{data:t.licenseStep});var e;t.emit(CDM_LICENSE_SUCCESS,{data:t.licenseStep}),t.licenseStep++,e="com.microsoft.playready"===t.KEYSYSTEM_TYPE?t.parseServerResponse(a.response):new Uint8Array(a.response),a.keySession.update(e).catch(console.error.bind(console,"update() failed"))}},a.send(t.getLicenseRequestFromMessage(n))}},r.send()}},{key:"UpdateSessionFunc",value:function(e){var t=this;return function(r){var n=[],i=[];Object.keys(e).forEach((function(t){var r=e[t],a=util$1.fromHex(t),o=util$1.fromHex(r),s={kty:"oct",kid:util$1.toBase64(a,!1),k:util$1.toBase64(o,!1)};n.push(s),i.push(s.kid)}));var a={keys:n},o=JSON.stringify(a);r.target.update(util$1.StringToArrayBuffer(o)).then((function(){}),t.bail(" MediaKeySession update failed"))}}},{key:"KeysChange",value:function(e){}},{key:"EnsureMediaKeysCreated",value:function(e,t){return this.ensurePromise||(this.ensurePromise=navigator.requestMediaKeySystemAccess(t,[{initDataTypes:["keyids","webm"],audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.2"'}],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42c01e"'}]}]).then((function(e){return e.createMediaKeys()}),this.bail(" Failed to request key system access.")).then((function(t){return e.setMediaKeys(t)}),this.bail(" failed to create MediaKeys object"))),this.ensurePromise}},{key:"SetupEME",value:function(e,t){var r=this,n=this;e.sessions=[];util$1.on(this,"encrypted",(function(t){var i,a,o;"org.w3.clearkey"===r.KEYSYSTEM_TYPE?(i="keyids",a=JSON.stringify({kids:["0123456789abcdef0123456789abcdef"]}),o=new Uint8Array(util$1.toUTF8(a))):"com.widevine.alpha"===r.KEYSYSTEM_TYPE?(i="cenc",o=t&&new Uint8Array(t.initData)||new Uint8Array([0,0,0,67,112,115,115,104,0,0,0,0,237,239,139,169,121,214,74,206,163,200,39,220,213,29,33,237,0,0,0,35,8,1,18,16,51,51,51,51,51,51,51,51,51,51,51,51,0,0,0,0,26,10,105,110,116,101,114,116,114,117,115,116,34,1,42])):"com.microsoft.playready"===r.KEYSYSTEM_TYPE&&(i="cenc",o=t&&new Uint8Array(t.initData)||new Uint8Array([0,0,2,38,112,115,115,104,0,0,0,0,154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149,0,0,2,6,6,2,0,0,1,0,1,0,252,1,60,0,87,0,82,0,77,0,72,0,69,0,65,0,68,0,69,0,82,0,32,0,120,0,109,0,108,0,110,0,115,0,61,0,34,0,104,0,116,0,116,0,112,0,58,0,47,0,47,0,115,0,99,0,104,0,101,0,109,0,97,0,115,0,46,0,109,0,105,0,99,0,114,0,111,0,115,0,111,0,102,0,116,0,46,0,99,0,111,0,109,0,47,0,68,0,82,0,77,0,47,0,50,0,48,0,48,0,55,0,47,0,48,0,51,0,47,0,80,0,108,0,97,0,121,0,82,0,101,0,97,0,100,0,121,0,72,0,101,0,97,0,100,0,101,0,114,0,34,0,32,0,118,0,101,0,114,0,115,0,105,0,111,0,110,0,61,0,34,0,52,0,46,0,48,0,46,0,48,0,46,0,48,0,34,0,62,0,60,0,68,0,65,0,84,0,65,0,62,0,60,0,80,0,82,0,79,0,84,0,69,0,67,0,84,0,73,0,78,0,70,0,79,0,62,0,60,0,75,0,69,0,89,0,76,0,69,0,78,0,62,0,49,0,54,0,60,0,47,0,75,0,69,0,89,0,76,0,69,0,78,0,62,0,60,0,65,0,76,0,71,0,73,0,68,0,62,0,65,0,69,0,83,0,67,0,84,0,82,0,60,0,47,0,65,0,76,0,71,0,73,0,68,0,62,0,60,0,47,0,80,0,82,0,79,0,84,0,69,0,67,0,84,0,73,0,78,0,70,0,79,0,62,0,60,0,75,0,73,0,68,0,62,0,77,0,122,0,77,0,122,0,77,0,122,0,77,0,122,0,77,0,122,0,77,0,122,0,77,0,122,0,77,0,122,0,65,0,65,0,65,0,65,0,65,0,65,0,61,0,61,0,60,0,47,0,75,0,73,0,68,0,62,0,60,0,67,0,72,0,69,0,67,0,75,0,83,0,85,0,77,0,62,0,65,0,49,0,53,0,66,0,89,0,87,0,68,0,52,0,113,0,115,0,73,0,61,0,60,0,47,0,67,0,72,0,69,0,67,0,75,0,83,0,85,0,77,0,62,0,60,0,47,0,68,0,65,0,84,0,65,0,62,0,60,0,47,0,87,0,82,0,77,0,72,0,69,0,65,0,68,0,69,0,82,0,62,0])),n.EnsureMediaKeysCreated(e,n.KEYSYSTEM_TYPE).then((function(){var t=e.mediaKeys.createSession();return e.sessions.push(t),"org.w3.clearkey"===n.KEYSYSTEM_TYPE?t.addEventListener("message",n.UpdateSessionFunc(n.keys)):("com.widevine.alpha"===n.KEYSYSTEM_TYPE||"com.microsoft.playready"===n.KEYSYSTEM_TYPE)&&t.addEventListener("message",n.licenseRequestReady.bind(n)),t.addEventListener("keystatuseschange",n.KeysChange),t.generateRequest(i,o.buffer)}),n.bail(" failed to ensure MediaKeys on HTMLMediaElement")).then((function(){}),n.bail(" Failed to generate request."))}),"destroy")}},{key:"destroy",value:function(){allOff(this)}}]),e}(),DASH=function(){function t(e,r,n){_classCallCheck$2(this,t),EventEmitter(this),this._pluginInst=r,this.__dash__=n;var i=r.config,a=r.player,o=r._kernal;this.kernal=o,this.mse=void 0,this.config=i,this.player=a,this.url=e,this.inited=!1,this.loadingTasks=[],this.keyValue=void 0,this.dynamic_video=this.config.dashOpts.dynamic_video,this.useEME=this.config.useEME,this.intertrustServerURL=this.config.intertrustServerURL,this.taskErrorList=[],this.defaultDefinition=this.config.defaultDefinition,this.selectedIdx=0,this.getLicenseUrl=this.config.getLicenseUrl,this.egleIds={},this.first_segment_request={video:{request:!1,ext:{fromCache:!1}},audio:{request:!1,ext:{fromCache:!1}}},this.segment_request={video:[],audio:[]},this.loader=new Loader({openLog:LOGOPEN,onProcessMinLen:this.config.onProcessMinLen},this._pluginInst.preloadManager)}var r,n,i,a;return _createClass$3(t,[{key:"getData",value:(a=_asyncToGenerator$3(_regeneratorRuntime$1().mark((function e(t){var r,n,i,a,o,s,u,c,l,d,h,f=arguments;return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.length>1&&void 0!==f[1]?f[1]:[],n=f.length>2?f[2]:void 0,i=f.length>3&&void 0!==f[3]?f[3]:{},a=f.length>4&&void 0!==f[4]&&f[4],o=f.length>5&&void 0!==f[5]?f[5]:null,e.next=7,this.loader.load(n,t,r,i,a,o?function(e,t,r,n){o(e,t,r,n,i)}:null);case 7:if(!((s=e.sent).res instanceof ArrayBuffer)){e.next=12;break}return u=s.res,c=s.headers,l=s.status,d=s.fromCache,h=s.cacheKey,d&&this.emitPreloadHit(h),e.abrupt("return",{res:u,headers:c,status:l,fromCache:d});case 12:return e.abrupt("return",s);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"playWithKeyValue",value:function(e,t){var r,n=this;r=n.__dash__.awManager.openBox(t);var i=new ProxyPromise$1;return new Promise((function(e,t){var i=util$1.getCookieValue("volcvui");n.config.useUnionInfoDRM&&util$1.checkUnionInfoExpired(n.player.unionID,i,n.config.keyTokenExpiredDuration)?n.__dash__.awManager.transformWithUnionInfo(r,i).then((function(t){e(t)})):e(r)})).then((function(t){t||n.player.emit("DRM_ERROR",new Errors(Errors.PARSE,Errors.BOX_KEY_ERROR)),n.config.dashOpts.drm={clearKeys:_defineProperty$3({},e,t)},n.keyValue=t,(n.__dash__.dashVideoEncrypted||n.__dash__.dashAudioEncrypted)&&!1===n.useEME&&n.__dash__.crypto?isSupportRawCryptoCTR().then((function(e){debug$2.encrypt("importKeys useRaw",e),n.useRawCrypto=e,e?n.__dash__.crypto.importKeys(n.keyValue).then(i.resolve):i.resolve()})):(debug$2.log("no importKeys"),i.resolve())})),i}},{key:"_getCryptInfos",value:function(){var e="",t="";if(this.dynamic_video.dynamic_video_list&&this.dynamic_video.dynamic_video_list.length>0){for(var r=0;r<this.dynamic_video.dynamic_video_list.length;r++)if(this.dynamic_video.dynamic_video_list[r].kid){e=this.dynamic_video.dynamic_video_list[r].kid,t=this.dynamic_video.dynamic_video_list[r].spade_a;break}}else if(this.dynamic_video.dynamic_audio_list)for(var n=0;n<this.dynamic_video.dynamic_audio_list.length;n++)if(this.dynamic_video.dynamic_audio_list[n].kid){e=this.dynamic_video.dynamic_audio_list[n].kid,t=this.dynamic_video.dynamic_audio_list[n].spade_a;break}return{keyId:e,spade_a:t}}},{key:"init",value:function(e){if(!this._hasDestroyed){this._initStartMs=Date.now(),this.kernal.setNodeTime("initdash","newplayer_start");var t=this._getCryptInfos(),r=t.keyId,n=t.spade_a,i=this;return i.config.dashOpts&&i.config.dashOpts.drm&&!i.useEME&&!i.keyValue&&(i.keyValue=Object.values(i.config.dashOpts.drm.clearKeys)[0],debug$2.log("initDash kv")),new Promise((function(t,a){if(r)if(i.player.emit("drmTypeChange",1),i.intertrustServerURL){var o=window.navigator.userAgent.toLocaleLowerCase().indexOf("chrome")>-1?"widevine":"playready";i.config.dashOpts.drm=_defineProperty$3({},o,{serverURL:i.intertrustServerURL+r}),i.initDash(e,t,a)}else if(i.config.usePlaySpade)setTimeout((function(){i.playWithKeyValue(r,n).then((function(){debug$2.encrypt("playWithKeyValue resolve"),i.initDash(e,t,a)}))}),0);else if(i.config.keyToken&&i.config.playDomain){var s=i.config.playDomain,u=util$1.isBase64(i.config.keyToken)?window.atob(i.config.keyToken):i.config.keyToken;new XHR$1({type:"json",method:"GET",url:"//".concat(s,"?").concat(u,"&DrmType=").concat(i.config.useUnionInfoDRM?"webdevice":"22","&PlayAuthIds=").concat(r,"&ssl=true")}).then((function(o){var c=o.response;c&&c.Result&&c.Result.PlayAuthInfoList?(n=c.Result.PlayAuthInfoList[0].PlayAuthContent,i.playWithKeyValue(r,n).then((function(){debug$2.encrypt("playWithKeyValue resolve"),i.initDash(e,t,a)}))):(i.player.emit("DRM_ERROR",new Errors(Errors.PARSE,Errors.LIC_PARSE_ERROR,{url:i.getLicenseUrl,data:{host:s,keyToken:u}})),a({}))})).catch((function(e){void 0!==e.status&&i.player.emit("DRM_ERROR",new Errors(Errors.LIC_NETWORK,Errors.NETEORK_ERROR_CODES[e&&e.status?e.status:"timeout"],{url:i.getLicenseUrl,data:{host:s,keyToken:u}})),a(e)}))}else{var c={drm_type:"22",license_request:[{vid:i.config.vid||"",kids:[].concat(r)}]};new XHR$1({type:"json",method:"POST",url:i.getLicenseUrl,data:c}).then((function(o){var s=o.response;s&&s.play_licenses?(n=s.play_licenses[i.config.vid][r],i.playWithKeyValue(r,n).then((function(){debug$2.encrypt("playWithKeyValue resolve"),i.initDash(e,t,a)}))):(i.player.emit("DRM_ERROR",new Errors(Errors.PARSE,Errors.LIC_PARSE_ERROR,{url:i.getLicenseUrl,data:c})),a({error:"DRM_ERROR"}))})).catch((function(e){void 0!==e.status&&i.player.emit("DRM_ERROR",new Errors(Errors.LIC_NETWORK,Errors.NETEORK_ERROR_CODES[e&&e.status?e.status:"timeout"],{url:i.getLicenseUrl,data:c})),a(e)}))}else i.initDash(e,t,a)}))}}},{key:"_handleIncompleSegment",value:function(e,t){var r=this;e.incomplete=!0,r.__dash__&&(r.__dash__._minDuration=Math.min(t,r.__dash__._minDuration))}},{key:"initDash",value:function(e,t,r){var n,i,a,o=this;this._pluginInst.info({msg:"dash init",data:"dash init",startMs:this._initStartMs,profile:!0}),this.kernal.setNodeTime("initdashdone","initdash");var s=this;s.config.dashOpts&&s.config.dashOpts.drm&&s.useEME&&(s.eme=new EME$1(s.config.dashOpts.drm),s.eme.on(CDM_LICENSE_ERROR,(function(e){o.player&&o.player.emit("log",_objectSpread2$2({type:"oneevent",end_type:CDM_LICENSE_ERROR,ua:navigator.userAgent},e)),o.player.errorHandler(new Errors(Errors.LIC_NETWORK,Errors.CDM_LICENSE_ERROR,{line:1021,handle:"",msg:"CDM license reject"}))})),s.eme.on(CDM_LICENSE_SUCCESS,(function(e){o.player&&o.player.emit("log",_objectSpread2$2({type:"oneevent",end_type:CDM_LICENSE_SUCCESS,ua:navigator.userAgent},e))}))),this.kernal.setNodeTime("initmpd");var u=new MPD(e,s.config.dashOpts,s);s.mpd=u;var c=Date.now();util$1.once(u,"ready",(function(){if(!s._hasDestroyed){debug$2.log("mpd ready"),o.kernal.setNodeTime("initmpddone"),o._pluginInst.info({msg:"mpd ready",name:"mpd ready",startMs:c,profile:!0}),s.type=u.type,i=u.mediaList.video,a=u.mediaList.audio;var e=s.config?s.config.defaultDefinition:null,r=o._pluginInst.getPreloadStat(),l=!1;if(r.video){var d=Object.keys(r.video)[0],h=util$1.getDefinition(d);h&&(e=h,l=!0)}var f=o.player.config.userSelectDefinition&&o.config.focusUserDefinition;if(f&&(e!==o.player.config.userSelectDefinition&&l&&(l=!1),e=o.player.config.userSelectDefinition),o._pluginInst.bitRateAdapter&&!l&&!f){var p=o.player?o.player.config.userSelectDefinition:null,g=util$1.getBitrateItem(s.config.dashOpts.dynamic_video,o._pluginInst.bitRateAdapter,s.config.duration,p);debug$2.log("[xgplayer-encrypt] onReady",s.config.vid,"item",g),g&&(e=g.definition)}debug$2.log("[xgplayer-encrypt] onReady",s.config.vid,"video definition",e);var y=!1;e&&i.forEach((function(t,r){t.definition===e&&(o.config.defaultDefinition=e,i.selectedIdx=r,y=!0)})),y||(i.selectedIdx=0),s.eme&&s.useEME&&s.eme.SetupEME(s.player.video),debug$2.segment(i),debug$2.segment(a);var m=Date.now();o.kernal.setNodeTime("initmse_sbopen"),n=new MSE$2(s.config&&s.config.mediaType,LOGOPEN?console.log:void 0);var v=!!(i.length>0&&i[i.selectedIdx])&&s.config&&!s.config.dashOpts.audioOnly,_=!!(a.length>0&&a[a.selectedIdx]),b=u.mediaList.audio,A=u.mediaList.video,E={};_&&(E[CONTENT_TYPES$1.AUDIO]={mimeType:"audio/mp4",codec:'audio/mp4; codecs="'.concat(b[b.selectedIdx].codecs,'"')}),v&&(E[CONTENT_TYPES$1.VIDEO]={mimeType:"video/mp4",codec:'video/mp4; codecs="'.concat(A[A.selectedIdx].codecs,'"')}),n.init(E).then((function(){o.kernal.setNodeTime("initmse_sbopendone"),o._pluginInst.info({msg:"mse init success",name:"mseInit",startMs:m,profile:!0});var e=[];s.config&&!s.config.dashOpts.audioOnly&&i&&i.length>0&&i[i.selectedIdx]&&i[i.selectedIdx].initSegment&&e.push(s.__dash__._makeInitSegemntRequestWithRetry("video",i.selectedIdx,!0)),a[a.selectedIdx]&&a[a.selectedIdx].initSegment&&e.push(s.__dash__._makeInitSegemntRequestWithRetry("audio",a.selectedIdx,!0)),Promise.all(e).then((function(e){var t,r,n;t=e,r=-1,n=[],(s.config&&s.config.dashOpts.audioOnly?["audio"]:["video","audio"]).forEach((function(e){var i=u.mediaList[e];if(!(i.length<1)&&i[i.selectedIdx]&&i[i.selectedIdx].mimeType){r++;var a=t[r];if(!a.initSegmentRes)return debug$2.abr("initSegment null, task request error, stop"),void s.emit("error",new Errors(Errors.PARSE,Errors.SEG_PARSE_ERROR,{line:180,handle:"[DASH] addBuffer",msg:"wrapperData.initSegmentRes is null"},s.player));n.push(s.__dash__._appendInitSegment(e,a,i.selectedIdx))}})),Promise.all(n).then((function(){o.kernal.setNodeTime("metaready_initsegend"),s.inited=!0,(v&&(i[i.selectedIdx].encrypted||i[i.selectedIdx].kid)||_&&(a[a.selectedIdx].encrypted||a[a.selectedIdx].kid))&&s.eme&&s.eme.emit("encrypted"),"vod"===s.type&&(s.seek(0,0),s.emit("start_play"))})).catch((function(e){s.player.errorHandler(new Errors(Errors.MSE,Errors.MSE_APPEND_ERROR,{line:329,msg:"mse append error ".concat(e.message?e.message:e)}))}))})).catch((function(e){s&&s.player&&s.player.errorHandler(e),debug$2.log("appendInitPromise error",e,"player destroyed ? ",!(s&&s.player))}))})).catch((function(e){s&&s.player&&s.player.errorHandler(new Errors(Errors.MSE,Errors.MSE_MEDIA_TYPES_NOT_SUPPORTED,{line:329,msg:"mse init fail"})),debug$2.log("mse init error",e,"player destroyed ? ",!(s&&s.player))})),s.mse=n,t(n)}})),u.init()}},{key:"seek",value:(i=_asyncToGenerator$3(_regeneratorRuntime$1().mark((function e(t,r){var n,i,a,o,s,u;return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,e.next=3,this.mpd.seek(t,r);case 3:if(i=e.sent,a=n.mpd.mediaList.video,o=n.mpd.mediaList.audio,s=!!(a.length>0&&a[a.selectedIdx]),u=!!(o.length>0&&o[o.selectedIdx]),!(s&&u&&2*a[a.selectedIdx].mediaDuration<o[o.selectedIdx].mediaDuration)){e.next=11;break}return n.emit("error",new Errors(Errors.PARSE,Errors.DUR_PARSE_ERROR,{line:261,handle:"[DASH] seek",msg:"the video.mediaDuration not match audio.mediaDuration"},n.player)),e.abrupt("return");case 11:debug$2.log("seekResult: ",i),(n.config.dashOpts&&n.config.dashOpts.audioOnly?["audio"]:["video","audio"]).forEach((function(e){i[e]&&i[e].length>0&&i[e].every((function(t){return t.downloaded===SEGMENT_STATE.APPEND||t.downloaded===SEGMENT_STATE.GOING||(t.downloaded=SEGMENT_STATE.GOING,n.config.useProgressiveAppend?n.makeSegmentRequest(e,t,(function(r,i,a,o,s){var u=a.range||[t.start,t.end];debug$2.log("append ".concat(e," ").concat(u[0]," ").concat(u[1])),s.range=u,n.appendSegment(e,r,t,{},s,!1,i)})).catch((function(e){n.updateItemState(t),console.log("err1",e)})):n.makeSegmentRequest(e,t).then((function(r){var i=r.res,a=r.headers,o=r.extData;n.updateItemState(t,!0),debug$2.log("append ".concat(e," ").concat(t.start," ").concat(t.end)),n.appendSegment(e,i,t,a||{},o,!0,!0)})).catch((function(e){n.updateItemState(t),console.log("err2",e)}))),!0}))}));case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"makeSegmentRequest",value:(n=_asyncToGenerator$3(_regeneratorRuntime$1().mark((function e(t,r){var n,i,a,o,s,u,c,l,d,h,f,p,g,y,m,v=arguments;return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=v.length>2&&void 0!==v[2]?v[2]:null,i=this,a=new ProxyPromise$1,void 0===r.range&&(r.range=[]),o=this.first_segment_request[t],(s=!o.request)&&(this.first_segment_request[t].request=!0),u=this.segment_request[t],"video"===t&&debug$2.network("http get video start: ".concat(r.start,", end: ").concat(r.end," ,range: ").concat(r.range)),i.player&&i.__dash__._checkUrlRange(r.url),c={limitSizeM:1/0,segment_resolution:"",isVideo:"video"===t,ratio:i.config.segmentRatio||7.5,vid:i.config.vid,mediaType:t,start:r.start,end:r.end,useUrlRange:i.config.useUrlRange},l=1/0,d=i.mpd.mediaList[t],h=d[d.selectedIdx],"video"===t){try{f=h.definition||i.__dash__.bandwidth2item[h.bandwidth].definition,l=SEGMENT_SIZE_CONFIG[f.toLowerCase()],c.segment_resolution=f.toLowerCase(),c.definition=c.segment_resolution}catch(error){l=1/0}c.limitSizeM=l}return c.bitrate=h.bandwidth||h.bitrate,c.idx=h.idx,s&&(o.task=util$1.nowTime()),e.next=20,this.getData(r.url,r.range,t,c,!1,n);case 20:return(p=e.sent)?(g=p.res,y=p.fromCache,m=g instanceof ArrayBuffer,s&&(o.taskfinish=util$1.nowTime(),o.ext.fromCache=y,o.ext.mediaType=t,o.ext.definition=c.definition,m?o.ext.byteLength=g.byteLength:o.ext.error=g),m||u.push({mediaType:t,definition:r.definition,start:r.start}),g instanceof ArrayBuffer?(a.resolve({res:g,headers:null,extData:{status:p.status,segment_resolution:c.segment_resolution}}),i.mseLog("task loadsucc",r,t)):206===p.status||200===p.status||(i.mseLog("task loaderror",r,t),n&&i.mse.abort("video"===t?CONTENT_TYPES$1.VIDEO:CONTENT_TYPES$1.AUDIO),i.updateItemState(r))):(console.log("response err"),a.reject(new Error("request error"))),e.abrupt("return",a);case 23:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"reportMonitorEvent",value:function(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=this,s=o.getReportData(r,n,i,a),u=i.eagleid;if(u){if(!this.egleIds||this.egleIds[u])return;this.egleIds[u]=1}o.player&&o.player.emit("log",{type:"oneevent",end_type:e,cdnUrl:t,ext:s})}},{key:"getReportData",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=util$1.transformHeaders(r,MONITOR_HEADERS$1),a=Object.assign({},{start:e||-1,end:t||-1},i,n);return a}},{key:"reportMenuEvent",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=this._pluginInst.player,o=this.getReportData(t,r,n,i);o.url=e,a.emit("menusegment",o)}},{key:"appendSegment",value:function(t,r,n,i,a){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],u=this;if(!this._hasDestroyed&&u.mpd&&r){var c,l=a.status,d=a.segment_resolution,h=u.mpd.mediaList[t],f=h.selectedIdx,p=0,g=-1,y=n.realUrl||n.url;if(o&&(r instanceof ArrayBuffer||r instanceof Uint8Array))try{g=r.byteLength;var m=new Uint8Array(r,4,4),v=String.fromCharCode.apply(null,m);if("moof"!==v&&"styp"!==v&&(debug$2.media("segment content error",n,i),p=1,u.reportMonitorEvent(MEDIA_CONTENT_ERR,y,n.range[0],n.range[1],i,{segment_size:r.byteLength,status:l,segment_resolution:d,box_type:v,step:p,segment_origin_size:g})),"ftyp"===v&&200===l&&2===n.range.length){p=2;var _=n.range[0];r=r.slice(_,n.range[1]+1)}}catch(e){u.reportMonitorEvent(MEDIA_CONTENT_ERR,y,n.range[0],n.range[1],i,{segment_size:r.byteLength,status:l,segment_resolution:d,step:p,box_type:"error",segment_origin_size:g}),debug$2.media("segment content catch",n,e)}u.reportMenuEvent(y,n.range[0],n.range[1],i,{segment_size:r.byteLength,status:l,segment_resolution:d}),u.keyValue&&(u.__dash__.dashVideoEncrypted||u.__dash__.dashAudioEncrypted)&&!1===u.useEME&&u.__dash__.crypto?(c=performance.now(),u.mseLog("decryptBody start",n,t),u.__dash__.crypto.decryptBody(r,this.keyValue,"video"===t,u.useRawCrypto).then((function(e){var r=e.data,i=e.id,a=e.headerId;if(r){var o=performance.now();if(u.encryptTotalAll||(u.encryptTotalAll=0),u.encryptTotalAll+=o-c,debug$2.encrypt("encryptTotalAll:".concat(u.encryptTotalAll)),u.mseLog("decryptBody succ",n,t),"video"===t&&(u.encryptTotal||(u.encryptTotal=0),u.encryptTotal+=o-c,debug$2.encrypt("encryptVideo:".concat(u.encryptTotal)),i<a))return u.updateItemState(n),void console.warn("decrytbody discard, id:".concat(i,", headerId:").concat(a,", index:").concat(f,",  url:").concat(n.url,", start:").concat(n.start));u.doAppendSegment(t,h,r,n,f,null,s)}else u.updateItemState(n)}))):u.doAppendSegment(t,h,r,n,f,a.range,s)}}},{key:"doAppendSegment",value:function(e,t,r,n,i,a,o){var s=this;if(!this._hasDestroyed){var u=this,c={start:n.start,end:n.end,index:i,bandwidth:t[t.selectedIdx].bandwidth,fps:t[t.selectedIdx].fps,mediaType:e,sequence:n.idx};e!==CONTENT_TYPES$1.VIDEO||-1===this.__dash__.curVideoInitSegmentIdx||i===this.__dash__.curVideoInitSegmentIdx?u.mse.appendBuffer(e,new Uint8Array(r),_objectSpread2$2({range:a},c)).then((function(){if(u.player){s.mseLog("appendBuffer success",n,e,a),o&&u.updateItemState(n,!0),"video"===e&&u.player.emit("addVideoBufferEnd",c);var t=u.mse,r=u.mpd;if(t&&c.start>=0&&o){var i=t.buffered(e);if(0===i.length)return;var l=i.end(i.length-1),d=r.mediaList[e][c.index].mediaSegments[c.sequence-1];d.incomplete&&(u._handleIncompleSegment(d,l),debug$2.log("extData",c))}}else debug$2.log("appendBuffer destroy return")})).catch((function(e){debug$2.log("err",e),"QuotaExceededError"!==e.message&&u.updateItemState(n,!1),"QuotaExceededError"===e.message&&u.__dash__&&u.__dash__.clearBuffer(),e&&e.message===ERROR_TYPES$3.MSE_OP_FAIL&&u.player&&u.player.emit(new Errors(Errors.MSE,Errors.MSE_PARSE_ERROR,{line:800,handle:"[DASH] appendInit",msg:e.message}))})):debug$2.log("init ä¸Ž segmentä¸åŒ¹é…")}}},{key:"abortLoadingTasks",value:(r=_asyncToGenerator$3(_regeneratorRuntime$1().mark((function e(){return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loader.cancel();case 2:debug$2.log("preload abortLoadingTasks");case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"updateItemState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=[];e.length>0?r=e:r.push(e),r.forEach((function(e){e.downloaded=t?SEGMENT_STATE.APPEND:SEGMENT_STATE.NO_START}))}},{key:"mseLog",value:function(e,t,r,n){debug$2.mse("type-".concat(r,"-start-").concat(t.start,"-end-").concat(t.end,"-").concat(e,",range:").concat(JSON.stringify(n||t.range)))}},{key:"emitPreloadHit",value:function(e){debug$2.preload("emit preloadhit",e),this.player&&this.player.emit("log",{type:"onetemp",action:"append",data:{preload_hit:e+"|"}})}},{key:"destroy",value:function(){this.loader.cancel(),this._hasDestroyed=!0}}]),t}(),encodedJs="IWZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIGUoZSx0KXtpZighKGUgaW5zdGFuY2VvZiB0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiB0KGUsdCl7Zm9yKHZhciByPTA7cjx0Lmxlbmd0aDtyKyspe3ZhciBuPXRbcl07bi5lbnVtZXJhYmxlPW4uZW51bWVyYWJsZXx8ITEsbi5jb25maWd1cmFibGU9ITAsInZhbHVlImluIG4mJihuLndyaXRhYmxlPSEwKSxPYmplY3QuZGVmaW5lUHJvcGVydHkoZSxuLmtleSxuKX19ZnVuY3Rpb24gcihlLHIsbil7cmV0dXJuIHImJnQoZS5wcm90b3R5cGUsciksbiYmdChlLG4pLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJwcm90b3R5cGUiLHt3cml0YWJsZTohMX0pLGV9ZnVuY3Rpb24gbihlLHQscil7cmV0dXJuIHQgaW4gZT9PYmplY3QuZGVmaW5lUHJvcGVydHkoZSx0LHt2YWx1ZTpyLGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwfSk6ZVt0XT1yLGV9ZnVuY3Rpb24gaShlLHQpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiB0JiZudWxsIT09dCl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpO2UucHJvdG90eXBlPU9iamVjdC5jcmVhdGUodCYmdC5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTplLHdyaXRhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH19KSxPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwicHJvdG90eXBlIix7d3JpdGFibGU6ITF9KSx0JiZvKGUsdCl9ZnVuY3Rpb24gYShlKXtyZXR1cm4oYT1PYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LmdldFByb3RvdHlwZU9mLmJpbmQoKTpmdW5jdGlvbihlKXtyZXR1cm4gZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlKX0pKGUpfWZ1bmN0aW9uIG8oZSx0KXtyZXR1cm4obz1PYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mLmJpbmQoKTpmdW5jdGlvbihlLHQpe3JldHVybiBlLl9fcHJvdG9fXz10LGV9KShlLHQpfWZ1bmN0aW9uIHUoKXtpZigidW5kZWZpbmVkIj09dHlwZW9mIFJlZmxlY3R8fCFSZWZsZWN0LmNvbnN0cnVjdClyZXR1cm4hMTtpZihSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKXJldHVybiExO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBQcm94eSlyZXR1cm4hMDt0cnl7cmV0dXJuIEJvb2xlYW4ucHJvdG90eXBlLnZhbHVlT2YuY2FsbChSZWZsZWN0LmNvbnN0cnVjdChCb29sZWFuLFtdLChmdW5jdGlvbigpe30pKSksITB9Y2F0Y2goZSl7cmV0dXJuITF9fWZ1bmN0aW9uIHMoZSx0LHIpe3JldHVybihzPXUoKT9SZWZsZWN0LmNvbnN0cnVjdC5iaW5kKCk6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPVtudWxsXTtuLnB1c2guYXBwbHkobix0KTt2YXIgaT1uZXcoRnVuY3Rpb24uYmluZC5hcHBseShlLG4pKTtyZXR1cm4gciYmbyhpLHIucHJvdG90eXBlKSxpfSkuYXBwbHkobnVsbCxhcmd1bWVudHMpfWZ1bmN0aW9uIGMoZSx0KXtpZih0JiYoIm9iamVjdCI9PXR5cGVvZiB0fHwiZnVuY3Rpb24iPT10eXBlb2YgdCkpcmV0dXJuIHQ7aWYodm9pZCAwIT09dCl0aHJvdyBuZXcgVHlwZUVycm9yKCJEZXJpdmVkIGNvbnN0cnVjdG9ycyBtYXkgb25seSByZXR1cm4gb2JqZWN0IG9yIHVuZGVmaW5lZCIpO3JldHVybiBmdW5jdGlvbihlKXtpZih2b2lkIDA9PT1lKXRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7cmV0dXJuIGV9KGUpfWZ1bmN0aW9uIGYoZSl7dmFyIHQ9dSgpO3JldHVybiBmdW5jdGlvbigpe3ZhciByLG49YShlKTtpZih0KXt2YXIgaT1hKHRoaXMpLmNvbnN0cnVjdG9yO3I9UmVmbGVjdC5jb25zdHJ1Y3Qobixhcmd1bWVudHMsaSl9ZWxzZSByPW4uYXBwbHkodGhpcyxhcmd1bWVudHMpO3JldHVybiBjKHRoaXMscil9fWZ1bmN0aW9uIGwoZSx0KXtmb3IoOyFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSx0KSYmbnVsbCE9PShlPWEoZSkpOyk7cmV0dXJuIGV9ZnVuY3Rpb24geSgpe3JldHVybiB5PSJ1bmRlZmluZWQiIT10eXBlb2YgUmVmbGVjdCYmUmVmbGVjdC5nZXQ/UmVmbGVjdC5nZXQuYmluZCgpOmZ1bmN0aW9uKGUsdCxyKXt2YXIgbj1sKGUsdCk7aWYobil7dmFyIGk9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihuLHQpO3JldHVybiBpLmdldD9pLmdldC5jYWxsKGFyZ3VtZW50cy5sZW5ndGg8Mz9lOnIpOmkudmFsdWV9fSx5LmFwcGx5KHRoaXMsYXJndW1lbnRzKX1mdW5jdGlvbiBoKGUpe3JldHVybiBmdW5jdGlvbihlKXtpZihBcnJheS5pc0FycmF5KGUpKXJldHVybiBwKGUpfShlKXx8ZnVuY3Rpb24oZSl7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiBTeW1ib2wmJm51bGwhPWVbU3ltYm9sLml0ZXJhdG9yXXx8bnVsbCE9ZVsiQEBpdGVyYXRvciJdKXJldHVybiBBcnJheS5mcm9tKGUpfShlKXx8ZnVuY3Rpb24oZSx0KXtpZighZSlyZXR1cm47aWYoInN0cmluZyI9PXR5cGVvZiBlKXJldHVybiBwKGUsdCk7dmFyIHI9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGUpLnNsaWNlKDgsLTEpOyJPYmplY3QiPT09ciYmZS5jb25zdHJ1Y3RvciYmKHI9ZS5jb25zdHJ1Y3Rvci5uYW1lKTtpZigiTWFwIj09PXJ8fCJTZXQiPT09cilyZXR1cm4gQXJyYXkuZnJvbShlKTtpZigiQXJndW1lbnRzIj09PXJ8fC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KHIpKXJldHVybiBwKGUsdCl9KGUpfHxmdW5jdGlvbigpe3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpfSgpfWZ1bmN0aW9uIHAoZSx0KXsobnVsbD09dHx8dD5lLmxlbmd0aCkmJih0PWUubGVuZ3RoKTtmb3IodmFyIHI9MCxuPW5ldyBBcnJheSh0KTtyPHQ7cisrKW5bcl09ZVtyXTtyZXR1cm4gbn1mb3IodmFyIHY9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7ZSh0aGlzLHQpfXJldHVybiByKHQsW3trZXk6Im1peEluIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gT2JqZWN0LmFzc2lnbih0aGlzLGUpfX0se2tleToiY2xvbmUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9bmV3IHRoaXMuY29uc3RydWN0b3I7cmV0dXJuIE9iamVjdC5hc3NpZ24oZSx0aGlzKSxlfX1dLFt7a2V5OiJjcmVhdGUiLHZhbHVlOmZ1bmN0aW9uKCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGgsdD1uZXcgQXJyYXkoZSkscj0wO3I8ZTtyKyspdFtyXT1hcmd1bWVudHNbcl07cmV0dXJuIHModGhpcyx0KX19XSksdH0oKSxkPWZ1bmN0aW9uKHQpe2kobyx0KTt2YXIgbj1mKG8pO2Z1bmN0aW9uIG8oKXt2YXIgdCxyPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTpbXSxpPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTo0KnIubGVuZ3RoO2UodGhpcyxvKSx0PW4uY2FsbCh0aGlzKTt2YXIgYT1yO2lmKGEgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciYmKGE9bmV3IFVpbnQ4QXJyYXkoYSkpLChhIGluc3RhbmNlb2YgSW50OEFycmF5fHxhIGluc3RhbmNlb2YgVWludDhDbGFtcGVkQXJyYXl8fGEgaW5zdGFuY2VvZiBJbnQxNkFycmF5fHxhIGluc3RhbmNlb2YgVWludDE2QXJyYXl8fGEgaW5zdGFuY2VvZiBJbnQzMkFycmF5fHxhIGluc3RhbmNlb2YgVWludDMyQXJyYXl8fGEgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXl8fGEgaW5zdGFuY2VvZiBGbG9hdDY0QXJyYXkpJiYoYT1uZXcgVWludDhBcnJheShhLmJ1ZmZlcixhLmJ5dGVPZmZzZXQsYS5ieXRlTGVuZ3RoKSksYSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpe2Zvcih2YXIgdT1hLmJ5dGVMZW5ndGgscz1bXSxjPTA7Yzx1O2MrPTEpc1tjPj4+Ml18PWFbY108PDI0LWMlNCo4O3Qud29yZHM9cyx0LnNpZ0J5dGVzPXV9ZWxzZSB0LndvcmRzPXIsdC5zaWdCeXRlcz1pO3JldHVybiB0fXJldHVybiByKG8sW3trZXk6InRvU3RyaW5nIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTp3O3JldHVybiBlLnN0cmluZ2lmeSh0aGlzKX19LHtrZXk6ImNvbmNhdCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy53b3JkcyxyPWUud29yZHMsbj10aGlzLnNpZ0J5dGVzLGk9ZS5zaWdCeXRlcztpZih0aGlzLmNsYW1wKCksbiU0KWZvcih2YXIgYT0wO2E8aTthKz0xKXt2YXIgbz1yW2E+Pj4yXT4+PjI0LWElNCo4JjI1NTt0W24rYT4+PjJdfD1vPDwyNC0obithKSU0Kjh9ZWxzZSBmb3IodmFyIHU9MDt1PGk7dSs9NCl0W24rdT4+PjJdPXJbdT4+PjJdO3JldHVybiB0aGlzLnNpZ0J5dGVzKz1pLHRoaXN9fSx7a2V5OiJjbGFtcCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLndvcmRzLHQ9dGhpcy5zaWdCeXRlcztlW3Q+Pj4yXSY9NDI5NDk2NzI5NTw8MzItdCU0KjgsZS5sZW5ndGg9TWF0aC5jZWlsKHQvNCl9fSx7a2V5OiJjbG9uZSIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT15KGEoby5wcm90b3R5cGUpLCJjbG9uZSIsdGhpcykuY2FsbCh0aGlzKTtyZXR1cm4gZS53b3Jkcz10aGlzLndvcmRzLnNsaWNlKDApLGV9fV0sW3trZXk6InJhbmRvbSIsdmFsdWU6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0LHI9W10sbj1mdW5jdGlvbihlKXt2YXIgdD1lLHI9OTg3NjU0MzIxLG49NDI5NDk2NzI5NTtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZT0oKHI9MzY5NjkqKDY1NTM1JnIpKyhyPj4xNikmbik8PDE2KSsodD0xOGUzKig2NTUzNSZ0KSsodD4+MTYpJm4pJm47cmV0dXJuIGUvPTQyOTQ5NjcyOTYsKGUrPS41KSooTWF0aC5yYW5kb20oKT4uNT8xOi0xKX19LGk9MDtpPGU7aSs9NCl7dmFyIGE9big0Mjk0OTY3Mjk2Kih0fHxNYXRoLnJhbmRvbSgpKSk7dD05ODc2NTQwNzEqYSgpLHIucHVzaCg0Mjk0OTY3Mjk2KmEoKXwwKX1yZXR1cm4gbmV3IG8ocixlKX19XSksb30odiksdz17c3RyaW5naWZ5OmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLndvcmRzLHI9ZS5zaWdCeXRlcyxuPVtdLGk9MDtpPHI7aSs9MSl7dmFyIGE9dFtpPj4+Ml0+Pj4yNC1pJTQqOCYyNTU7bi5wdXNoKChhPj4+NCkudG9TdHJpbmcoMTYpKSxuLnB1c2goKDE1JmEpLnRvU3RyaW5nKDE2KSl9cmV0dXJuIG4uam9pbigiIil9LHBhcnNlOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLmxlbmd0aCxyPVtdLG49MDtuPHQ7bis9MilyW24+Pj4zXXw9cGFyc2VJbnQoZS5zdWJzdHIobiwyKSwxNik8PDI0LW4lOCo0O3JldHVybiBuZXcgZChyLHQvMil9fSxnPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLmxlbmd0aCxyPVtdLG49MDtuPHQ7bis9MSlyW24+Pj4yXXw9KDI1NSZlLmNoYXJDb2RlQXQobikpPDwyNC1uJTQqODtyZXR1cm4gbmV3IGQocix0KX0sbT1mdW5jdGlvbihlKXtyZXR1cm4gZyh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoZSkpKX0sYj1mdW5jdGlvbih0KXtpKG8sdCk7dmFyIG49ZihvKTtmdW5jdGlvbiBvKCl7dmFyIHQ7cmV0dXJuIGUodGhpcyxvKSwodD1uLmNhbGwodGhpcykpLl9taW5CdWZmZXJTaXplPTAsdH1yZXR1cm4gcihvLFt7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhPW5ldyBkLHRoaXMuX25EYXRhQnl0ZXM9MH19LHtrZXk6Il9hcHBlbmQiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PWU7InN0cmluZyI9PXR5cGVvZiB0JiYodD1tKHQpKSx0aGlzLl9kYXRhLmNvbmNhdCh0KSx0aGlzLl9uRGF0YUJ5dGVzKz10LnNpZ0J5dGVzfX0se2tleToiX3Byb2Nlc3MiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0LHI9dGhpcy5fZGF0YSxuPXRoaXMuYmxvY2tTaXplLGk9ci53b3JkcyxhPXIuc2lnQnl0ZXMsbz1hLyg0Km4pLHU9KG89ZT9NYXRoLmNlaWwobyk6TWF0aC5tYXgoKDB8byktdGhpcy5fbWluQnVmZmVyU2l6ZSwwKSkqbixzPU1hdGgubWluKDQqdSxhKTtpZih1KXtmb3IodmFyIGM9MDtjPHU7Yys9bil0aGlzLl9kb1Byb2Nlc3NCbG9jayhpLGMpO3Q9aS5zcGxpY2UoMCx1KSxyLnNpZ0J5dGVzLT1zfXJldHVybiBuZXcgZCh0LHMpfX0se2tleToiY2xvbmUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9eShhKG8ucHJvdG90eXBlKSwiY2xvbmUiLHRoaXMpLmNhbGwodGhpcyk7cmV0dXJuIGUuX2RhdGE9dGhpcy5fZGF0YS5jbG9uZSgpLGV9fV0pLG99KHYpLGs9ZnVuY3Rpb24odCl7aShvLHQpO3ZhciBuPWYobyk7ZnVuY3Rpb24gbyh0KXt2YXIgcjtyZXR1cm4gZSh0aGlzLG8pLChyPW4uY2FsbCh0aGlzKSkuYmxvY2tTaXplPTE2LHIuY2ZnPU9iamVjdC5hc3NpZ24obmV3IHYsdCksci5yZXNldCgpLHJ9cmV0dXJuIHIobyxbe2tleToicmVzZXQiLHZhbHVlOmZ1bmN0aW9uKCl7eShhKG8ucHJvdG90eXBlKSwicmVzZXQiLHRoaXMpLmNhbGwodGhpcyksdGhpcy5fZG9SZXNldCgpfX0se2tleToidXBkYXRlIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5fYXBwZW5kKGUpLHRoaXMuX3Byb2Nlc3MoKSx0aGlzfX0se2tleToiZmluYWxpemUiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBlJiZ0aGlzLl9hcHBlbmQoZSksdGhpcy5fZG9GaW5hbGl6ZSgpfX1dLFt7a2V5OiJfY3JlYXRlSGVscGVyIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCxyKXtyZXR1cm4gbmV3IGUocikuZmluYWxpemUodCl9fX0se2tleToiX2NyZWF0ZUhtYWNIZWxwZXIiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbih0LHIpe3JldHVybiBuZXcgXyhlLHIpLmZpbmFsaXplKHQpfX19XSksb30oYiksXz1mdW5jdGlvbih0KXtpKGEsdCk7dmFyIG49ZihhKTtmdW5jdGlvbiBhKHQscil7dmFyIGk7ZSh0aGlzLGEpLGk9bi5jYWxsKHRoaXMpO3ZhciBvPW5ldyB0O2kuX2hhc2hlcj1vO3ZhciB1PXI7InN0cmluZyI9PXR5cGVvZiB1JiYodT1tKHUpKTt2YXIgcz1vLmJsb2NrU2l6ZSxjPTQqczt1LnNpZ0J5dGVzPmMmJih1PW8uZmluYWxpemUocikpLHUuY2xhbXAoKTt2YXIgZj11LmNsb25lKCk7aS5fb0tleT1mO3ZhciBsPXUuY2xvbmUoKTtpLl9pS2V5PWw7Zm9yKHZhciB5PWYud29yZHMsaD1sLndvcmRzLHA9MDtwPHM7cCs9MSl5W3BdXj0xNTQ5NTU2ODI4LGhbcF1ePTkwOTUyMjQ4NjtyZXR1cm4gZi5zaWdCeXRlcz1jLGwuc2lnQnl0ZXM9YyxpLnJlc2V0KCksaX1yZXR1cm4gcihhLFt7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLl9oYXNoZXI7ZS5yZXNldCgpLGUudXBkYXRlKHRoaXMuX2lLZXkpfX0se2tleToidXBkYXRlIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5faGFzaGVyLnVwZGF0ZShlKSx0aGlzfX0se2tleToiZmluYWxpemUiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuX2hhc2hlcixyPXQuZmluYWxpemUoZSk7cmV0dXJuIHQucmVzZXQoKSx0LmZpbmFsaXplKHRoaXMuX29LZXkuY2xvbmUoKS5jb25jYXQocikpfX1dKSxhfSh2KSx4PXtzdHJpbmdpZnk6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS53b3JkcyxyPWUuc2lnQnl0ZXMsbj10aGlzLl9tYXA7ZS5jbGFtcCgpO2Zvcih2YXIgaT1bXSxhPTA7YTxyO2ErPTMpZm9yKHZhciBvPSh0W2E+Pj4yXT4+PjI0LWElNCo4JjI1NSk8PDE2fCh0W2ErMT4+PjJdPj4+MjQtKGErMSklNCo4JjI1NSk8PDh8dFthKzI+Pj4yXT4+PjI0LShhKzIpJTQqOCYyNTUsdT0wO3U8NCYmYSsuNzUqdTxyO3UrPTEpaS5wdXNoKG4uY2hhckF0KG8+Pj42KigzLXUpJjYzKSk7dmFyIHM9bi5jaGFyQXQoNjQpO2lmKHMpZm9yKDtpLmxlbmd0aCU0OylpLnB1c2gocyk7cmV0dXJuIGkuam9pbigiIil9LHBhcnNlOmZ1bmN0aW9uKGUpe3ZhciB0PWUubGVuZ3RoLHI9dGhpcy5fbWFwLG49dGhpcy5fcmV2ZXJzZU1hcDtpZighbil7dGhpcy5fcmV2ZXJzZU1hcD1bXSxuPXRoaXMuX3JldmVyc2VNYXA7Zm9yKHZhciBpPTA7aTxyLmxlbmd0aDtpKz0xKW5bci5jaGFyQ29kZUF0KGkpXT1pfXZhciBhPXIuY2hhckF0KDY0KTtpZihhKXt2YXIgbz1lLmluZGV4T2YoYSk7LTEhPT1vJiYodD1vKX1yZXR1cm4gZnVuY3Rpb24oZSx0LHIpe2Zvcih2YXIgbj1bXSxpPTAsYT0wO2E8dDthKz0xKWlmKGElNCl7dmFyIG89cltlLmNoYXJDb2RlQXQoYS0xKV08PGElNCoyfHJbZS5jaGFyQ29kZUF0KGEpXT4+PjYtYSU0KjI7bltpPj4+Ml18PW88PDI0LWklNCo4LGkrPTF9cmV0dXJuIGQuY3JlYXRlKG4saSl9KGUsdCxuKX0sX21hcDoiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0ifSxBPVtdLHo9MDt6PDY0O3orPTEpQVt6XT00Mjk0OTY3Mjk2Kk1hdGguYWJzKE1hdGguc2luKHorMSkpfDA7dmFyIFM9ZnVuY3Rpb24oZSx0LHIsbixpLGEsbyl7dmFyIHU9ZSsodCZyfH50Jm4pK2krbztyZXR1cm4odTw8YXx1Pj4+MzItYSkrdH0sVT1mdW5jdGlvbihlLHQscixuLGksYSxvKXt2YXIgdT1lKyh0Jm58ciZ+bikraStvO3JldHVybih1PDxhfHU+Pj4zMi1hKSt0fSxDPWZ1bmN0aW9uKGUsdCxyLG4saSxhLG8pe3ZhciB1PWUrKHRecl5uKStpK287cmV0dXJuKHU8PGF8dT4+PjMyLWEpK3R9LEI9ZnVuY3Rpb24oZSx0LHIsbixpLGEsbyl7dmFyIHU9ZSsocl4odHx+bikpK2krbztyZXR1cm4odTw8YXx1Pj4+MzItYSkrdH0sTz1mdW5jdGlvbih0KXtpKG8sdCk7dmFyIG49ZihvKTtmdW5jdGlvbiBvKCl7cmV0dXJuIGUodGhpcyxvKSxuLmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gcihvLFt7a2V5OiJfZG9SZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLl9oYXNoPW5ldyBkKFsxNzMyNTg0MTkzLDQwMjMyMzM0MTcsMjU2MjM4MzEwMiwyNzE3MzM4NzhdKX19LHtrZXk6Il9kb1Byb2Nlc3NCbG9jayIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9ZSxuPTA7bjwxNjtuKz0xKXt2YXIgaT10K24sYT1lW2ldO3JbaV09MTY3MTE5MzUmKGE8PDh8YT4+PjI0KXw0Mjc4MjU1MzYwJihhPDwyNHxhPj4+OCl9dmFyIG89dGhpcy5faGFzaC53b3Jkcyx1PXJbdCswXSxzPXJbdCsxXSxjPXJbdCsyXSxmPXJbdCszXSxsPXJbdCs0XSx5PXJbdCs1XSxoPXJbdCs2XSxwPXJbdCs3XSx2PXJbdCs4XSxkPXJbdCs5XSx3PXJbdCsxMF0sZz1yW3QrMTFdLG09clt0KzEyXSxiPXJbdCsxM10saz1yW3QrMTRdLF89clt0KzE1XSx4PW9bMF0sej1vWzFdLE89b1syXSxFPW9bM107eD1TKHgseixPLEUsdSw3LEFbMF0pLEU9UyhFLHgseixPLHMsMTIsQVsxXSksTz1TKE8sRSx4LHosYywxNyxBWzJdKSx6PVMoeixPLEUseCxmLDIyLEFbM10pLHg9Uyh4LHosTyxFLGwsNyxBWzRdKSxFPVMoRSx4LHosTyx5LDEyLEFbNV0pLE89UyhPLEUseCx6LGgsMTcsQVs2XSksej1TKHosTyxFLHgscCwyMixBWzddKSx4PVMoeCx6LE8sRSx2LDcsQVs4XSksRT1TKEUseCx6LE8sZCwxMixBWzldKSxPPVMoTyxFLHgseix3LDE3LEFbMTBdKSx6PVMoeixPLEUseCxnLDIyLEFbMTFdKSx4PVMoeCx6LE8sRSxtLDcsQVsxMl0pLEU9UyhFLHgseixPLGIsMTIsQVsxM10pLE89UyhPLEUseCx6LGssMTcsQVsxNF0pLHo9Uyh6LE8sRSx4LF8sMjIsQVsxNV0pLHg9VSh4LHosTyxFLHMsNSxBWzE2XSksRT1VKEUseCx6LE8saCw5LEFbMTddKSxPPVUoTyxFLHgseixnLDE0LEFbMThdKSx6PVUoeixPLEUseCx1LDIwLEFbMTldKSx4PVUoeCx6LE8sRSx5LDUsQVsyMF0pLEU9VShFLHgseixPLHcsOSxBWzIxXSksTz1VKE8sRSx4LHosXywxNCxBWzIyXSksej1VKHosTyxFLHgsbCwyMCxBWzIzXSkseD1VKHgseixPLEUsZCw1LEFbMjRdKSxFPVUoRSx4LHosTyxrLDksQVsyNV0pLE89VShPLEUseCx6LGYsMTQsQVsyNl0pLHo9VSh6LE8sRSx4LHYsMjAsQVsyN10pLHg9VSh4LHosTyxFLGIsNSxBWzI4XSksRT1VKEUseCx6LE8sYyw5LEFbMjldKSxPPVUoTyxFLHgseixwLDE0LEFbMzBdKSx6PVUoeixPLEUseCxtLDIwLEFbMzFdKSx4PUMoeCx6LE8sRSx5LDQsQVszMl0pLEU9QyhFLHgseixPLHYsMTEsQVszM10pLE89QyhPLEUseCx6LGcsMTYsQVszNF0pLHo9Qyh6LE8sRSx4LGssMjMsQVszNV0pLHg9Qyh4LHosTyxFLHMsNCxBWzM2XSksRT1DKEUseCx6LE8sbCwxMSxBWzM3XSksTz1DKE8sRSx4LHoscCwxNixBWzM4XSksej1DKHosTyxFLHgsdywyMyxBWzM5XSkseD1DKHgseixPLEUsYiw0LEFbNDBdKSxFPUMoRSx4LHosTyx1LDExLEFbNDFdKSxPPUMoTyxFLHgseixmLDE2LEFbNDJdKSx6PUMoeixPLEUseCxoLDIzLEFbNDNdKSx4PUMoeCx6LE8sRSxkLDQsQVs0NF0pLEU9QyhFLHgseixPLG0sMTEsQVs0NV0pLE89QyhPLEUseCx6LF8sMTYsQVs0Nl0pLHo9Qyh6LE8sRSx4LGMsMjMsQVs0N10pLHg9Qih4LHosTyxFLHUsNixBWzQ4XSksRT1CKEUseCx6LE8scCwxMCxBWzQ5XSksTz1CKE8sRSx4LHosaywxNSxBWzUwXSksej1CKHosTyxFLHgseSwyMSxBWzUxXSkseD1CKHgseixPLEUsbSw2LEFbNTJdKSxFPUIoRSx4LHosTyxmLDEwLEFbNTNdKSxPPUIoTyxFLHgseix3LDE1LEFbNTRdKSx6PUIoeixPLEUseCxzLDIxLEFbNTVdKSx4PUIoeCx6LE8sRSx2LDYsQVs1Nl0pLEU9QihFLHgseixPLF8sMTAsQVs1N10pLE89QihPLEUseCx6LGgsMTUsQVs1OF0pLHo9Qih6LE8sRSx4LGIsMjEsQVs1OV0pLHg9Qih4LHosTyxFLGwsNixBWzYwXSksRT1CKEUseCx6LE8sZywxMCxBWzYxXSksTz1CKE8sRSx4LHosYywxNSxBWzYyXSksej1CKHosTyxFLHgsZCwyMSxBWzYzXSksb1swXT1vWzBdK3h8MCxvWzFdPW9bMV0renwwLG9bMl09b1syXStPfDAsb1szXT1vWzNdK0V8MH19LHtrZXk6Il9kb0ZpbmFsaXplIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMuX2RhdGEsdD1lLndvcmRzLHI9OCp0aGlzLl9uRGF0YUJ5dGVzLG49OCplLnNpZ0J5dGVzO3Rbbj4+PjVdfD0xMjg8PDI0LW4lMzI7dmFyIGk9TWF0aC5mbG9vcihyLzQyOTQ5NjcyOTYpLGE9cjt0WzE1KyhuKzY0Pj4+OTw8NCldPTE2NzExOTM1JihpPDw4fGk+Pj4yNCl8NDI3ODI1NTM2MCYoaTw8MjR8aT4+PjgpLHRbMTQrKG4rNjQ+Pj45PDw0KV09MTY3MTE5MzUmKGE8PDh8YT4+PjI0KXw0Mjc4MjU1MzYwJihhPDwyNHxhPj4+OCksZS5zaWdCeXRlcz00Kih0Lmxlbmd0aCsxKSx0aGlzLl9wcm9jZXNzKCk7Zm9yKHZhciBvPXRoaXMuX2hhc2gsdT1vLndvcmRzLHM9MDtzPDQ7cys9MSl7dmFyIGM9dVtzXTt1W3NdPTE2NzExOTM1JihjPDw4fGM+Pj4yNCl8NDI3ODI1NTM2MCYoYzw8MjR8Yz4+PjgpfXJldHVybiBvfX0se2tleToiY2xvbmUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9eShhKG8ucHJvdG90eXBlKSwiY2xvbmUiLHRoaXMpLmNhbGwodGhpcyk7cmV0dXJuIGUuX2hhc2g9dGhpcy5faGFzaC5jbG9uZSgpLGV9fV0pLG99KGspO2suX2NyZWF0ZUhlbHBlcihPKSxrLl9jcmVhdGVIbWFjSGVscGVyKE8pO3ZhciBFPWZ1bmN0aW9uKHQpe2koYSx0KTt2YXIgbj1mKGEpO2Z1bmN0aW9uIGEodCl7dmFyIHI7cmV0dXJuIGUodGhpcyxhKSwocj1uLmNhbGwodGhpcykpLmNmZz1PYmplY3QuYXNzaWduKG5ldyB2LHtrZXlTaXplOjQsaGFzaGVyOk8saXRlcmF0aW9uczoxfSx0KSxyfXJldHVybiByKGEsW3trZXk6ImNvbXB1dGUiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7Zm9yKHZhciByLG49dGhpcy5jZmcsaT1uLmhhc2hlci5jcmVhdGUoKSxhPWQuY3JlYXRlKCksbz1hLndvcmRzLHU9bi5rZXlTaXplLHM9bi5pdGVyYXRpb25zO28ubGVuZ3RoPHU7KXtyJiZpLnVwZGF0ZShyKSxyPWkudXBkYXRlKGUpLmZpbmFsaXplKHQpLGkucmVzZXQoKTtmb3IodmFyIGM9MTtjPHM7Yys9MSlyPWkuZmluYWxpemUociksaS5yZXNldCgpO2EuY29uY2F0KHIpfXJldHVybiBhLnNpZ0J5dGVzPTQqdSxhfX1dKSxhfSh2KSxMPWZ1bmN0aW9uKHQpe2kobyx0KTt2YXIgbj1mKG8pO2Z1bmN0aW9uIG8odCxyLGkpe3ZhciBhO3JldHVybiBlKHRoaXMsbyksKGE9bi5jYWxsKHRoaXMpKS5jZmc9T2JqZWN0LmFzc2lnbihuZXcgdixpKSxhLl94Zm9ybU1vZGU9dCxhLl9rZXk9cixhLnJlc2V0KCksYX1yZXR1cm4gcihvLFt7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt5KGEoby5wcm90b3R5cGUpLCJyZXNldCIsdGhpcykuY2FsbCh0aGlzKSx0aGlzLl9kb1Jlc2V0KCl9fSx7a2V5OiJwcm9jZXNzIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5fYXBwZW5kKGUpLHRoaXMuX3Byb2Nlc3MoKX19LHtrZXk6ImZpbmFsaXplIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gZSYmdGhpcy5fYXBwZW5kKGUpLHRoaXMuX2RvRmluYWxpemUoKX19XSxbe2tleToiY3JlYXRlRW5jcnlwdG9yIix2YWx1ZTpmdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLmNyZWF0ZSh0aGlzLl9FTkNfWEZPUk1fTU9ERSxlLHQpfX0se2tleToiY3JlYXRlRGVjcnlwdG9yIix2YWx1ZTpmdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLmNyZWF0ZSh0aGlzLl9ERUNfWEZPUk1fTU9ERSxlLHQpfX0se2tleToiX2NyZWF0ZUhlbHBlciIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9ZnVuY3Rpb24oZSl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiBlP0Y6SH07cmV0dXJue2VuY3J5cHQ6ZnVuY3Rpb24ocixuLGkpe3JldHVybiB0KG4pLmVuY3J5cHQoZSxyLG4saSl9LGRlY3J5cHQ6ZnVuY3Rpb24ocixuLGkpe3JldHVybiB0KG4pLmRlY3J5cHQoZSxyLG4saSl9fX19XSksb30oYik7TC5fRU5DX1hGT1JNX01PREU9MSxMLl9ERUNfWEZPUk1fTU9ERT0yLEwua2V5U2l6ZT00LEwuaXZTaXplPTQ7dmFyIEk9ZnVuY3Rpb24odCl7aShhLHQpO3ZhciBuPWYoYSk7ZnVuY3Rpb24gYSh0LHIpe3ZhciBpO3JldHVybiBlKHRoaXMsYSksKGk9bi5jYWxsKHRoaXMpKS5fY2lwaGVyPXQsaS5faXY9cixpfXJldHVybiByKGEsbnVsbCxbe2tleToiY3JlYXRlRW5jcnlwdG9yIix2YWx1ZTpmdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLkVuY3J5cHRvci5jcmVhdGUoZSx0KX19LHtrZXk6ImNyZWF0ZURlY3J5cHRvciIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5EZWNyeXB0b3IuY3JlYXRlKGUsdCl9fV0pLGF9KHYpO2Z1bmN0aW9uIFIoZSx0LHIpe3ZhciBuLGk9ZSxhPXRoaXMuX2l2O2E/KG49YSx0aGlzLl9pdj12b2lkIDApOm49dGhpcy5fcHJldkJsb2NrO2Zvcih2YXIgbz0wO288cjtvKz0xKWlbdCtvXV49bltvXX12YXIgRD1mdW5jdGlvbih0KXtpKGEsdCk7dmFyIG49ZihhKTtmdW5jdGlvbiBhKCl7cmV0dXJuIGUodGhpcyxhKSxuLmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gcihhKX0oSSk7RC5FbmNyeXB0b3I9ZnVuY3Rpb24odCl7aShhLHQpO3ZhciBuPWYoYSk7ZnVuY3Rpb24gYSgpe3JldHVybiBlKHRoaXMsYSksbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIHIoYSxbe2tleToicHJvY2Vzc0Jsb2NrIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciByPXRoaXMuX2NpcGhlcixuPXIuYmxvY2tTaXplO1IuY2FsbCh0aGlzLGUsdCxuKSxyLmVuY3J5cHRCbG9jayhlLHQpLHRoaXMuX3ByZXZCbG9jaz1lLnNsaWNlKHQsdCtuKX19XSksYX0oRCksRC5EZWNyeXB0b3I9ZnVuY3Rpb24odCl7aShhLHQpO3ZhciBuPWYoYSk7ZnVuY3Rpb24gYSgpe3JldHVybiBlKHRoaXMsYSksbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIHIoYSxbe2tleToicHJvY2Vzc0Jsb2NrIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciByPXRoaXMuX2NpcGhlcixuPXIuYmxvY2tTaXplLGk9ZS5zbGljZSh0LHQrbik7ci5kZWNyeXB0QmxvY2soZSx0KSxSLmNhbGwodGhpcyxlLHQsbiksdGhpcy5fcHJldkJsb2NrPWl9fV0pLGF9KEQpO3ZhciBNPXtwYWQ6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9NCp0LG49ci1lLnNpZ0J5dGVzJXIsaT1uPDwyNHxuPDwxNnxuPDw4fG4sYT1bXSxvPTA7bzxuO28rPTQpYS5wdXNoKGkpO3ZhciB1PWQuY3JlYXRlKGEsbik7ZS5jb25jYXQodSl9LHVucGFkOmZ1bmN0aW9uKGUpe3ZhciB0PWUscj0yNTUmdC53b3Jkc1t0LnNpZ0J5dGVzLTE+Pj4yXTt0LnNpZ0J5dGVzLT1yfX0sVD1mdW5jdGlvbih0KXtpKG8sdCk7dmFyIG49ZihvKTtmdW5jdGlvbiBvKHQscixpKXt2YXIgYTtyZXR1cm4gZSh0aGlzLG8pLChhPW4uY2FsbCh0aGlzLHQscixPYmplY3QuYXNzaWduKHttb2RlOkQscGFkZGluZzpNfSxpKSkpLmJsb2NrU2l6ZT00LGF9cmV0dXJuIHIobyxbe2tleToicmVzZXQiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU7eShhKG8ucHJvdG90eXBlKSwicmVzZXQiLHRoaXMpLmNhbGwodGhpcyk7dmFyIHQ9dGhpcy5jZmcscj10Lml2LG49dC5tb2RlO3RoaXMuX3hmb3JtTW9kZT09PXRoaXMuY29uc3RydWN0b3IuX0VOQ19YRk9STV9NT0RFP2U9bi5jcmVhdGVFbmNyeXB0b3I6KGU9bi5jcmVhdGVEZWNyeXB0b3IsdGhpcy5fbWluQnVmZmVyU2l6ZT0xKSx0aGlzLl9tb2RlPWUuY2FsbChuLHRoaXMsciYmci53b3JkcyksdGhpcy5fbW9kZS5fX2NyZWF0b3I9ZX19LHtrZXk6Il9kb1Byb2Nlc3NCbG9jayIsdmFsdWU6ZnVuY3Rpb24oZSx0KXt0aGlzLl9tb2RlLnByb2Nlc3NCbG9jayhlLHQpfX0se2tleToiX2RvRmluYWxpemUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGUsdD10aGlzLmNmZy5wYWRkaW5nO3JldHVybiB0aGlzLl94Zm9ybU1vZGU9PT10aGlzLmNvbnN0cnVjdG9yLl9FTkNfWEZPUk1fTU9ERT8odC5wYWQodGhpcy5fZGF0YSx0aGlzLmJsb2NrU2l6ZSksZT10aGlzLl9wcm9jZXNzKCEwKSk6KGU9dGhpcy5fcHJvY2VzcyghMCksdC51bnBhZChlKSksZX19XSksb30oTCksaj1mdW5jdGlvbih0KXtpKGEsdCk7dmFyIG49ZihhKTtmdW5jdGlvbiBhKHQpe3ZhciByO3JldHVybiBlKHRoaXMsYSksKHI9bi5jYWxsKHRoaXMpKS5taXhJbih0KSxyfXJldHVybiByKGEsW3trZXk6InRvU3RyaW5nIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4oZXx8dGhpcy5mb3JtYXR0ZXIpLnN0cmluZ2lmeSh0aGlzKX19XSksYX0odiksVj17c3RyaW5naWZ5OmZ1bmN0aW9uKGUpe3ZhciB0PWUuY2lwaGVydGV4dCxyPWUuc2FsdDtyZXR1cm4ocj9kLmNyZWF0ZShbMTM5ODg5MzY4NCwxNzAxMDc2ODMxXSkuY29uY2F0KHIpLmNvbmNhdCh0KTp0KS50b1N0cmluZyh4KX0scGFyc2U6ZnVuY3Rpb24oZSl7dmFyIHQscj14LnBhcnNlKGUpLG49ci53b3JkcztyZXR1cm4gMTM5ODg5MzY4ND09PW5bMF0mJjE3MDEwNzY4MzE9PT1uWzFdJiYodD1kLmNyZWF0ZShuLnNsaWNlKDIsNCkpLG4uc3BsaWNlKDAsNCksci5zaWdCeXRlcy09MTYpLGouY3JlYXRlKHtjaXBoZXJ0ZXh0OnIsc2FsdDp0fSl9fSxIPWZ1bmN0aW9uKHQpe2koYSx0KTt2YXIgbj1mKGEpO2Z1bmN0aW9uIGEoKXtyZXR1cm4gZSh0aGlzLGEpLG4uYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiByKGEsbnVsbCxbe2tleToiZW5jcnlwdCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsbil7dmFyIGk9T2JqZWN0LmFzc2lnbihuZXcgdix0aGlzLmNmZyxuKSxhPWUuY3JlYXRlRW5jcnlwdG9yKHIsaSksbz1hLmZpbmFsaXplKHQpLHU9YS5jZmc7cmV0dXJuIGouY3JlYXRlKHtjaXBoZXJ0ZXh0Om8sa2V5OnIsaXY6dS5pdixhbGdvcml0aG06ZSxtb2RlOnUubW9kZSxwYWRkaW5nOnUucGFkZGluZyxibG9ja1NpemU6YS5ibG9ja1NpemUsZm9ybWF0dGVyOmkuZm9ybWF0fSl9fSx7a2V5OiJkZWNyeXB0Iix2YWx1ZTpmdW5jdGlvbihlLHQscixuKXt2YXIgaT10LGE9T2JqZWN0LmFzc2lnbihuZXcgdix0aGlzLmNmZyxuKTtyZXR1cm4gaT10aGlzLl9wYXJzZShpLGEuZm9ybWF0KSxlLmNyZWF0ZURlY3J5cHRvcihyLGEpLmZpbmFsaXplKGkuY2lwaGVydGV4dCl9fSx7a2V5OiJfcGFyc2UiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiBlP3QucGFyc2UoZSx0aGlzKTplfX1dKSxhfSh2KTtILmNmZz1PYmplY3QuYXNzaWduKG5ldyB2LHtmb3JtYXQ6Vn0pO3ZhciBQPXtleGVjdXRlOmZ1bmN0aW9uKGUsdCxyLG4pe3ZhciBpPW47aXx8KGk9ZC5yYW5kb20oOCkpO3ZhciBhPUUuY3JlYXRlKHtrZXlTaXplOnQrcn0pLmNvbXB1dGUoZSxpKSxvPWQuY3JlYXRlKGEud29yZHMuc2xpY2UodCksNCpyKTtyZXR1cm4gYS5zaWdCeXRlcz00KnQsai5jcmVhdGUoe2tleTphLGl2Om8sc2FsdDppfSl9fSxGPWZ1bmN0aW9uKHQpe2koYSx0KTt2YXIgbj1mKGEpO2Z1bmN0aW9uIGEoKXtyZXR1cm4gZSh0aGlzLGEpLG4uYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiByKGEsbnVsbCxbe2tleToiZW5jcnlwdCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsbil7dmFyIGk9T2JqZWN0LmFzc2lnbihuZXcgdix0aGlzLmNmZyxuKSxhPWkua2RmLmV4ZWN1dGUocixlLmtleVNpemUsZS5pdlNpemUpO2kuaXY9YS5pdjt2YXIgbz1ILmVuY3J5cHQuY2FsbCh0aGlzLGUsdCxhLmtleSxpKTtyZXR1cm4gby5taXhJbihhKSxvfX0se2tleToiZGVjcnlwdCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsbil7dmFyIGk9dCxhPU9iamVjdC5hc3NpZ24obmV3IHYsdGhpcy5jZmcsbik7aT10aGlzLl9wYXJzZShpLGEuZm9ybWF0KTt2YXIgbz1hLmtkZi5leGVjdXRlKHIsZS5rZXlTaXplLGUuaXZTaXplLGkuc2FsdCk7cmV0dXJuIGEuaXY9by5pdixILmRlY3J5cHQuY2FsbCh0aGlzLGUsaSxvLmtleSxhKX19XSksYX0oSCk7Ri5jZmc9T2JqZWN0LmFzc2lnbihILmNmZyx7a2RmOlB9KTtmb3IodmFyIE49W10sVz1bXSxLPVtdLHE9W10sWD1bXSxaPVtdLEo9W10sJD1bXSxHPVtdLFE9W10sWT1bXSxlZT0wO2VlPDI1NjtlZSs9MSlZW2VlXT1lZTwxMjg/ZWU8PDE6ZWU8PDFeMjgzO2Zvcih2YXIgdGU9MCxyZT0wLG5lPTA7bmU8MjU2O25lKz0xKXt2YXIgaWU9cmVecmU8PDFecmU8PDJecmU8PDNecmU8PDQ7aWU9aWU+Pj44XjI1NSZpZV45OSxOW3RlXT1pZSxXW2llXT10ZTt2YXIgYWU9WVt0ZV0sb2U9WVthZV0sdWU9WVtvZV0sc2U9MjU3KllbaWVdXjE2ODQzMDA4KmllO0tbdGVdPXNlPDwyNHxzZT4+PjgscVt0ZV09c2U8PDE2fHNlPj4+MTYsWFt0ZV09c2U8PDh8c2U+Pj4yNCxaW3RlXT1zZSxzZT0xNjg0MzAwOSp1ZV42NTUzNypvZV4yNTcqYWVeMTY4NDMwMDgqdGUsSltpZV09c2U8PDI0fHNlPj4+OCwkW2llXT1zZTw8MTZ8c2U+Pj4xNixHW2llXT1zZTw8OHxzZT4+PjI0LFFbaWVdPXNlLHRlPyh0ZT1hZV5ZW1lbWVt1ZV5hZV1dXSxyZV49WVtZW3JlXV0pOnRlPXJlPTF9dmFyIGNlPVswLDEsMiw0LDgsMTYsMzIsNjQsMTI4LDI3LDU0XSxmZT1mdW5jdGlvbih0KXtpKGEsdCk7dmFyIG49ZihhKTtmdW5jdGlvbiBhKCl7cmV0dXJuIGUodGhpcyxhKSxuLmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gcihhLFt7a2V5OiJfZG9SZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZTtpZighdGhpcy5fblJvdW5kc3x8dGhpcy5fa2V5UHJpb3JSZXNldCE9PXRoaXMuX2tleSl7dGhpcy5fa2V5UHJpb3JSZXNldD10aGlzLl9rZXk7dmFyIHQ9dGhpcy5fa2V5UHJpb3JSZXNldCxyPXQud29yZHMsbj10LnNpZ0J5dGVzLzQ7dGhpcy5fblJvdW5kcz1uKzY7dmFyIGk9NCoodGhpcy5fblJvdW5kcysxKTt0aGlzLl9rZXlTY2hlZHVsZT1bXTtmb3IodmFyIGE9dGhpcy5fa2V5U2NoZWR1bGUsbz0wO288aTtvKz0xKW88bj9hW29dPXJbb106KGU9YVtvLTFdLG8lbj9uPjYmJm8lbj09NCYmKGU9TltlPj4+MjRdPDwyNHxOW2U+Pj4xNiYyNTVdPDwxNnxOW2U+Pj44JjI1NV08PDh8TlsyNTUmZV0pOihlPU5bKGU9ZTw8OHxlPj4+MjQpPj4+MjRdPDwyNHxOW2U+Pj4xNiYyNTVdPDwxNnxOW2U+Pj44JjI1NV08PDh8TlsyNTUmZV0sZV49Y2Vbby9ufDBdPDwyNCksYVtvXT1hW28tbl1eZSk7dGhpcy5faW52S2V5U2NoZWR1bGU9W107Zm9yKHZhciB1PXRoaXMuX2ludktleVNjaGVkdWxlLHM9MDtzPGk7cys9MSl7dmFyIGM9aS1zO2U9cyU0P2FbY106YVtjLTRdLHVbc109czw0fHxjPD00P2U6SltOW2U+Pj4yNF1dXiRbTltlPj4+MTYmMjU1XV1eR1tOW2U+Pj44JjI1NV1dXlFbTlsyNTUmZV1dfX19fSx7a2V5OiJlbmNyeXB0QmxvY2siLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dGhpcy5fZG9DcnlwdEJsb2NrKGUsdCx0aGlzLl9rZXlTY2hlZHVsZSxLLHEsWCxaLE4pfX0se2tleToiZGVjcnlwdEJsb2NrIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciByPWUsbj1yW3QrMV07clt0KzFdPXJbdCszXSxyW3QrM109bix0aGlzLl9kb0NyeXB0QmxvY2socix0LHRoaXMuX2ludktleVNjaGVkdWxlLEosJCxHLFEsVyksbj1yW3QrMV0sclt0KzFdPXJbdCszXSxyW3QrM109bn19LHtrZXk6Il9kb0NyeXB0QmxvY2siLHZhbHVlOmZ1bmN0aW9uKGUsdCxyLG4saSxhLG8sdSl7Zm9yKHZhciBzPWUsYz10aGlzLl9uUm91bmRzLGY9c1t0XV5yWzBdLGw9c1t0KzFdXnJbMV0seT1zW3QrMl1eclsyXSxoPXNbdCszXV5yWzNdLHA9NCx2PTE7djxjO3YrPTEpe3ZhciBkPW5bZj4+PjI0XV5pW2w+Pj4xNiYyNTVdXmFbeT4+PjgmMjU1XV5vWzI1NSZoXV5yW3BdO3ArPTE7dmFyIHc9bltsPj4+MjRdXmlbeT4+PjE2JjI1NV1eYVtoPj4+OCYyNTVdXm9bMjU1JmZdXnJbcF07cCs9MTt2YXIgZz1uW3k+Pj4yNF1eaVtoPj4+MTYmMjU1XV5hW2Y+Pj44JjI1NV1eb1syNTUmbF1ecltwXTtwKz0xO3ZhciBtPW5baD4+PjI0XV5pW2Y+Pj4xNiYyNTVdXmFbbD4+PjgmMjU1XV5vWzI1NSZ5XV5yW3BdO3ArPTEsZj1kLGw9dyx5PWcsaD1tfXZhciBiPSh1W2Y+Pj4yNF08PDI0fHVbbD4+PjE2JjI1NV08PDE2fHVbeT4+PjgmMjU1XTw8OHx1WzI1NSZoXSlecltwXTtwKz0xO3ZhciBrPSh1W2w+Pj4yNF08PDI0fHVbeT4+PjE2JjI1NV08PDE2fHVbaD4+PjgmMjU1XTw8OHx1WzI1NSZmXSlecltwXTtwKz0xO3ZhciBfPSh1W3k+Pj4yNF08PDI0fHVbaD4+PjE2JjI1NV08PDE2fHVbZj4+PjgmMjU1XTw8OHx1WzI1NSZsXSlecltwXTtwKz0xO3ZhciB4PSh1W2g+Pj4yNF08PDI0fHVbZj4+PjE2JjI1NV08PDE2fHVbbD4+PjgmMjU1XTw8OHx1WzI1NSZ5XSlecltwXTtwKz0xLHNbdF09YixzW3QrMV09ayxzW3QrMl09XyxzW3QrM109eH19XSksYX0oVCk7ZmUua2V5U2l6ZT04O3ZhciBsZT1ULl9jcmVhdGVIZWxwZXIoZmUpLHllPWZ1bmN0aW9uKGUpe3ZhciB0PXcucGFyc2UoZSk7cmV0dXJuIGouY3JlYXRlKHtjaXBoZXJ0ZXh0OnR9KX0saGU9ZnVuY3Rpb24odCl7aShhLHQpO3ZhciBuPWYoYSk7ZnVuY3Rpb24gYSgpe3JldHVybiBlKHRoaXMsYSksbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIHIoYSl9KEkpO2hlLkVuY3J5cHRvcj1mdW5jdGlvbih0KXtpKGEsdCk7dmFyIG49ZihhKTtmdW5jdGlvbiBhKCl7cmV0dXJuIGUodGhpcyxhKSxuLmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gcihhLFt7a2V5OiJwcm9jZXNzQmxvY2siLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9ZSxuPXRoaXMuX2NpcGhlcixpPW4uYmxvY2tTaXplLGE9dGhpcy5faXYsbz10aGlzLl9jb3VudGVyO2EmJih0aGlzLl9jb3VudGVyPWEuc2xpY2UoMCksbz10aGlzLl9jb3VudGVyLHRoaXMuX2l2PXZvaWQgMCk7dmFyIHU9by5zbGljZSgwKTtuLmVuY3J5cHRCbG9jayh1LDApLG9baS0xXT1vW2ktMV0rMXwwO2Zvcih2YXIgcz0wO3M8aTtzKz0xKXJbdCtzXV49dVtzXX19XSksYX0oaGUpLGhlLkRlY3J5cHRvcj1oZS5FbmNyeXB0b3I7dmFyIHBlPXtwYWQ6ZnVuY3Rpb24oKXt9LHVucGFkOmZ1bmN0aW9uKCl7fX0sdmU9e0FycmF5QnVmZmVyVG9TdHJpbmc6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PSIiLHI9bmV3IFVpbnQ4QXJyYXkoZSksbj0wO248ci5sZW5ndGg7bisrKXQrPVN0cmluZy5mcm9tQ2hhckNvZGUocltuXSk7cmV0dXJuIHR9LFN0cmluZ1RvQXJyYXlCdWZmZXI6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PW5ldyBBcnJheUJ1ZmZlcihlLmxlbmd0aCkscj1uZXcgVWludDhBcnJheSh0KSxuPTA7bjxlLmxlbmd0aDtuKyspcltuXT1lLmNoYXJDb2RlQXQobik7cmV0dXJuIHR9LEJhc2U2NFRvSGV4OmZ1bmN0aW9uKGUpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdJiZhcmd1bWVudHNbMV0scj13aW5kb3cuYXRvYihlLnJlcGxhY2UoLy0vZywiKyIpLnJlcGxhY2UoL18vZywiLyIpKTtpZih0KXtmb3IodmFyIG49W10saT0wO2k8ci5sZW5ndGg7aSsrKW4ucHVzaChyLmNoYXJDb2RlQXQoaSkpO3JldHVybiBuZXcgVWludDhBcnJheShuKS5idWZmZXJ9Zm9yKHZhciBhPSIiLG89MDtvPHIubGVuZ3RoO28rKylhKz0oIjAiK3IuY2hhckNvZGVBdChvKS50b1N0cmluZygxNikpLnN1YnN0cigtMik7cmV0dXJuIGF9LEhleFRvQmFzZTY0OmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0iIixyPTA7cjxlLmxlbmd0aDtyKz0yKXQrPVN0cmluZy5mcm9tQ2hhckNvZGUocGFyc2VJbnQoZS5zdWJzdHIociwyKSwxNikpO3JldHVybiB3aW5kb3cuYnRvYSh0KS5yZXBsYWNlKC89L2csIiIpLnJlcGxhY2UoL1wrL2csIi0iKS5yZXBsYWNlKC9cLy9nLCJfIil9LGZpbmRCb3g6ZnVuY3Rpb24oZSx0KXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXT9hcmd1bWVudHNbMl06W107aWYoZS50eXBlIT09dCl7aWYoZSYmZS5zdWJCb3gpe3ZhciBuPWUuc3ViQm94LmZpbHRlcigoZnVuY3Rpb24oZSl7cmV0dXJuIGUudHlwZT09PXR9KSk7bi5sZW5ndGg/bi5mb3JFYWNoKChmdW5jdGlvbihlKXtyZXR1cm4gci5wdXNoKGUpfSkpOmUuc3ViQm94LmZvckVhY2goKGZ1bmN0aW9uKGUpe3JldHVybiB2ZS5maW5kQm94KGUsdCxyKX0pKX19ZWxzZSByLnB1c2goZSk7cmV0dXJuKHI9W10uY29uY2F0KHIpKS5sZW5ndGg+MT9yOnJbMF19LHBhZFN0YXJ0OmZ1bmN0aW9uKGUsdCxyKXtmb3IodmFyIG49U3RyaW5nKHIpLGk9dD4+MCxhPU1hdGguY2VpbChpL24ubGVuZ3RoKSxvPVtdLHU9U3RyaW5nKGUpO2EtLTspby5wdXNoKG4pO3JldHVybiBvLmpvaW4oIiIpLnN1YnN0cmluZygwLGktdS5sZW5ndGgpK3V9LGR1cmF0aW9uQ29udmVydDpmdW5jdGlvbihlKXt2YXIgdD0wLHI9MCxuPTA7cmV0dXJuKGU9ZS5zbGljZShlLmluZGV4T2YoIlBUIikrMikpLmluZGV4T2YoIkgiKT4tMSYmZS5pbmRleE9mKCJNIik+LTEmJmUuaW5kZXhPZigiUyIpPi0xPyh0PXBhcnNlRmxvYXQoZS5zbGljZSgwLGUuaW5kZXhPZigiSCIpKSkscj1wYXJzZUZsb2F0KGUuc2xpY2UoZS5pbmRleE9mKCJIIikrMSxlLmluZGV4T2YoIk0iKSkpLG49cGFyc2VGbG9hdChlLnNsaWNlKGUuaW5kZXhPZigiTSIpKzEsZS5pbmRleE9mKCJTIikpKSk6ZS5pbmRleE9mKCJIIik+LTEmJmUuaW5kZXhPZigiTSIpPi0xJiZlLmluZGV4T2YoIlMiKTwwPyh0PXBhcnNlRmxvYXQoZS5zbGljZSgwLGUuaW5kZXhPZigiSCIpKSkscj1wYXJzZUZsb2F0KGUuc2xpY2UoZS5pbmRleE9mKCJIIikrMSxlLmluZGV4T2YoIk0iKSkpKTplLmluZGV4T2YoIkgiKTwwJiZlLmluZGV4T2YoIk0iKT4tMSYmZS5pbmRleE9mKCJTIik+LTE/KHI9cGFyc2VGbG9hdChlLnNsaWNlKDAsZS5pbmRleE9mKCJNIikpKSxuPXBhcnNlRmxvYXQoZS5zbGljZShlLmluZGV4T2YoIk0iKSsxLGUuaW5kZXhPZigiUyIpKSkpOmUuaW5kZXhPZigiSCIpPi0xJiZlLmluZGV4T2YoIk0iKTwwJiZlLmluZGV4T2YoIlMiKT4tMT8odD1wYXJzZUZsb2F0KGUuc2xpY2UoMCxlLmluZGV4T2YoIkgiKSkpLG49cGFyc2VGbG9hdChlLnNsaWNlKGUuaW5kZXhPZigiSCIpKzEsZS5pbmRleE9mKCJTIikpKSk6ZS5pbmRleE9mKCJIIik8MCYmZS5pbmRleE9mKCJNIik8MCYmZS5pbmRleE9mKCJTIik+LTE/bj1wYXJzZUZsb2F0KGUuc2xpY2UoMCxlLmluZGV4T2YoIlMiKSkpOmUuaW5kZXhPZigiSCIpPDAmJmUuaW5kZXhPZigiTSIpPi0xJiZlLmluZGV4T2YoIlMiKTwwJiYocj1wYXJzZUZsb2F0KGUuc2xpY2UoMCxlLmluZGV4T2YoIk0iKSkpKSwzNjAwKnQrNjAqcitufSxwcmVGaXhJbnRlcmdlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuKEFycmF5KHQpLmpvaW4oMCkrZSkuc2xpY2UoLXQpfSx0b0hleDpmdW5jdGlvbigpe2Zvcih2YXIgZT1bXSx0PWFyZ3VtZW50cy5sZW5ndGgscj1uZXcgQXJyYXkodCksbj0wO248dDtuKyspcltuXT1hcmd1bWVudHNbbl07cmV0dXJuIHIuZm9yRWFjaCgoZnVuY3Rpb24odCl7ZS5wdXNoKHZlLnBhZFN0YXJ0KE51bWJlcih0KS50b1N0cmluZygxNiksMiwwKSl9KSksZX0sc3VtOmZ1bmN0aW9uKCl7Zm9yKHZhciBlPTAsdD1hcmd1bWVudHMubGVuZ3RoLHI9bmV3IEFycmF5KHQpLG49MDtuPHQ7bisrKXJbbl09YXJndW1lbnRzW25dO3JldHVybiByLmZvckVhY2goKGZ1bmN0aW9uKHQpe2UrPXR9KSksZX0sdG9VVEY4OmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lbmNvZGVVUklDb21wb25lbnQoZSkscj11bmVzY2FwZSh0KSxuPW5ldyBVaW50OEFycmF5KHIubGVuZ3RoKSxpPTA7aTxyLmxlbmd0aDsrK2kpbltpXT1yLmNoYXJDb2RlQXQoaSk7cmV0dXJuIG4uYnVmZmVyfSxmcm9tSGV4OmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1uZXcgVWludDhBcnJheShlLmxlbmd0aC8yKSxyPTA7cjxlLmxlbmd0aDtyKz0yKXRbci8yXT1wYXJzZUludChlLnN1YnN0cihyLDIpLDE2KTtyZXR1cm4gdH0sZnJvbUNoYXJDb2RlOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0iIixyPTA7cjxlLmxlbmd0aDtyKz0xNmUzKXt2YXIgbj1lLnN1YmFycmF5KHIscisxNmUzKTt0Kz1TdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsbil9cmV0dXJuIHR9LHRvQmFzZTY0OmZ1bmN0aW9uKGUsdCl7dmFyIHI9dmUuZnJvbUNoYXJDb2RlKGUpO3Q9dm9pZCAwPT09dHx8dDt2YXIgbj13aW5kb3cuYnRvYShyKS5yZXBsYWNlKC9cKy9nLCItIikucmVwbGFjZSgvXC8vZywiXyIpO3JldHVybiB0P246bi5yZXBsYWNlKC89KiQvLCIiKX0sc3RyMmhleDpmdW5jdGlvbihlKXtpZigiIj09PWUpcmV0dXJuIiI7Zm9yKHZhciB0PVtdLHI9MDtyPGUubGVuZ3RoO3IrKyl0LnB1c2goZS5jaGFyQ29kZUF0KHIpKTtyZXR1cm4gdH0sYnVmZmVyVG9TdHJpbmc6ZnVuY3Rpb24oZSl7cmV0dXJuKCIwIitOdW1iZXIoZSkudG9TdHJpbmcoMTYpKS5zbGljZSgtMikudG9VcHBlckNhc2UoKX0sc3RyaW5nVG9CdWZmZXI6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PVtdLHI9MDtyPGUubGVuZ3RoO3IrPTIpdC5wdXNoKHBhcnNlSW50KGVbcl0rZVtyKzFdLDE2KSk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHQpfX07dmUudG9IZXg9ZnVuY3Rpb24oKXtmb3IodmFyIGU9W10sdD1hcmd1bWVudHMubGVuZ3RoLHI9bmV3IEFycmF5KHQpLG49MDtuPHQ7bisrKXJbbl09YXJndW1lbnRzW25dO3JldHVybiByLmZvckVhY2goKGZ1bmN0aW9uKHQpe2UucHVzaCh2ZS5wYWRTdGFydChOdW1iZXIodCkudG9TdHJpbmcoMTYpLDIsMCkpfSkpLGV9LHZlLmZvcm1hdElWPWZ1bmN0aW9uKGUpe3ZhciB0PSIiO3JldHVybiBlLmZvckVhY2goKGZ1bmN0aW9uKGUpe3QrPXZlLmJ1ZmZlclRvU3RyaW5nKGUpfSkpLHR9LHZlLnJvdW5kPWZ1bmN0aW9uKGUpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTowO3JldHVybiBOdW1iZXIoZS50b0ZpeGVkKHQpKX0sdmUuaXNTb2dvdT1mdW5jdGlvbigpe3JldHVybiB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoIm1ldGFzciIpPi0xfSx2ZS5pc0VkZ2U9ZnVuY3Rpb24oKXt2YXIgZT13aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpO3JldHVybiBlLmluZGV4T2YoImVkZ2UiKT4tMXx8ZS5pbmRleE9mKCJlZGcvIik+LTF9LHZlLm9mZkluRGVzdHJveT1mdW5jdGlvbihlLHQscixuKXtlLm9uY2UobiwoZnVuY3Rpb24gaSgpe2Uub2ZmKHQsciksZS5vZmYobixpKX0pKX0sdmUub249ZnVuY3Rpb24oZSx0LHIsbil7aWYobillLm9uKHQsciksdmUub2ZmSW5EZXN0cm95KGUsdCxyLG4pO2Vsc2V7ZS5vbih0LChmdW5jdGlvbiBuKGkpe3IoaSksZS5vZmYodCxuKX0pKX19LHZlLm9uY2U9ZnVuY3Rpb24oZSx0LHIsbil7aWYobillLm9uY2UodCxyKSx2ZS5vZmZJbkRlc3Ryb3koZSx0LHIsbik7ZWxzZXtlLm9uY2UodCwoZnVuY3Rpb24gbihpKXtyKGkpLGUub2ZmKHQsbil9KSl9fSx2ZS5wcm9taXNlUG9seWZpbGw9ZnVuY3Rpb24oKXtQcm9taXNlLnByb3RvdHlwZS5maW5hbGx5fHwoUHJvbWlzZS5wcm90b3R5cGUuZmluYWxseT17ZmluYWxseTpmdW5jdGlvbihlKXt2YXIgdD1mdW5jdGlvbih0KXtyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGUoKSkudGhlbih0KX07cmV0dXJuIHRoaXMudGhlbigoZnVuY3Rpb24oZSl7cmV0dXJuIHQoKGZ1bmN0aW9uKCl7cmV0dXJuIGV9KSl9KSwoZnVuY3Rpb24oZSl7cmV0dXJuIHQoKGZ1bmN0aW9uKCl7cmV0dXJuIFByb21pc2UucmVqZWN0KGUpfSkpfSkpfX0uZmluYWxseSl9LHZlLnRyYW5zZm9ybUhlYWRlcnM9ZnVuY3Rpb24oZSx0KXt2YXIgcj1PYmplY3QuYXNzaWduKHt9LGUpO3JldHVybiBPYmplY3Qua2V5cyh0KS5mb3JFYWNoKChmdW5jdGlvbihuKXt2YXIgaT10W25dO2UmJmVbbl0mJihyW2ldPWVbbl0sZGVsZXRlIHJbbl0pfSkpLHJ9LHZlLmdlbmVyYXRlVW5pcXVlS2V5PWZ1bmN0aW9uKGUpe3ZhciB0PWUudmlkLHI9ZS5zdGFydCxuPWUuZW5kLGk9ZS5tZWRpYVR5cGUsYT1lLmRlZmluaXRpb24sbz1lLmNvZGVjVHlwZSx1PWUuZm9ybWF0LHM9ZS5iaXRyYXRlO3JldHVybiByPXJ8fDAsbj1ufHwwLG89b3x8ImgyNjQiLHU9dXx8ImRhc2giLHQmJmk/YT8iIi5jb25jYXQodCwiIyIpLmNvbmNhdChpLCIjIikuY29uY2F0KGEsIiMiKS5jb25jYXQociwiIyIpLmNvbmNhdChuLCIjIikuY29uY2F0KG8sIiMiKS5jb25jYXQodSwiIyIpLmNvbmNhdChzKToiIi5jb25jYXQodCwiIyIpLmNvbmNhdChpLCIjIikuY29uY2F0KHIsIiMiKS5jb25jYXQobiwiIyIpLmNvbmNhdChvLCIjIikuY29uY2F0KHUsIiMiKS5jb25jYXQocyk6bnVsbH0sdmUuZ2V0RGVmaW5pdGlvbj1mdW5jdGlvbihlKXtpZighZSlyZXR1cm4gbnVsbDt2YXIgdD1lLnNwbGl0KCIjIik7cmV0dXJuIHQubGVuZ3RoPjI/dFsyXTpudWxsfSx2ZS5leGNoYW5nZUxpc3RVcmw9ZnVuY3Rpb24oZSl7aWYoZSYmMCE9PWUubGVuZ3RoKWZvcih2YXIgdD0wO3Q8ZS5sZW5ndGg7dCsrKXZlLmV4Y2hhbmdlVXJsKGVbdF0pfSx2ZS5leGNoYW5nZVVybD1mdW5jdGlvbihlKXtpZihlJiZlLm1haW5fdXJsJiZlLmJhY2t1cF91cmxfMSl7dmFyIHQ9ZS5tYWluX3VybCxyPWUuYmFja3VwX3VybF8xLG49dC5zcGxpdCgiPyIpOzI9PT1uLmxlbmd0aCYmLTE9PT1yLmluZGV4T2YoIj8iKT8oZS5tYWluX3VybD1yKyI/IituWzFdLGUuYmFja3VwX3VybF8xPW5bMF0pOihlLm1haW5fdXJsPXIsZS5iYWNrdXBfdXJsXzE9dCl9fSx2ZS52YWxpZGF0ZUZyYWdtZW50PWZ1bmN0aW9uKGUpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTpbXTtpZihlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe3RyeXt2YXIgcj1uZXcgVWludDhBcnJheShlLDQsNCksbj1TdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwscik7aWYoMj09PXQubGVuZ3RoKXt2YXIgaT10WzFdLXRbMF0rMTtpZighKGUuYnl0ZUxlbmd0aD09PWkpKXJldHVybn1pZigibW9vZiIhPT1uJiYic3R5cCIhPT1uJiYiZnR5cCIhPT1uKXJldHVybiExfWNhdGNoKGEpe3JldHVybiExfXJldHVybiEwfXJldHVybiExfSx2ZS52YWxpZGF0ZVVybFJhbmdlPWZ1bmN0aW9uKGUsdCl7dmFyIHI9ZXx8W107aWYoci5sZW5ndGg+MClmb3IodmFyIG49MDtuPHIubGVuZ3RoO24rKyl7dmFyIGk9cltuXTtpZigvKFswLTkuXC1BLVphLXpdKykvLnRlc3QoaSkmJnQuaW5kZXhPZihpKT4tMSlyZXR1cm4hMH1yZXR1cm4hMX0sdmUuaXNCYXNlNjQ9ZnVuY3Rpb24oZSl7cmV0dXJuL14oW0EtWmEtejAtOSsvXXs0fSkqKFtBLVphLXowLTkrL117NH18W0EtWmEtejAtOSsvXXszfT18W0EtWmEtejAtOSsvXXsyfT09KSQvLnRlc3QoZSl9O3ZhciBkZSx3ZSxnZSxtZSxiZT0oZGU9InZvZFRpbWVzdGFtcFNhbHQiLHdlPWZ1bmN0aW9uKGUpe3JldHVybiBlLnNwbGl0KCIiKS5tYXAoKGZ1bmN0aW9uKGUpe3JldHVybiBlLmNoYXJDb2RlQXQoMCl9KSl9LGdlPWZ1bmN0aW9uKGUpe3JldHVybigiMCIrTnVtYmVyKGUpLnRvU3RyaW5nKDE2KSkuc3Vic3RyKC0yKX0sbWU9ZnVuY3Rpb24oZSl7cmV0dXJuIHdlKGRlKS5yZWR1Y2UoKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGVedH0pLGUpfSxmdW5jdGlvbihlKXtyZXR1cm4gZS5zcGxpdCgiIikubWFwKHdlKS5tYXAobWUpLm1hcChnZSkuam9pbigiIil9KSxrZT1mdW5jdGlvbihlKXt2YXIgdD1mdW5jdGlvbih0KXtyZXR1cm4ocj1lLHIuc3BsaXQoIiIpLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIGUuY2hhckNvZGVBdCgwKX0pKSkucmVkdWNlKChmdW5jdGlvbihlLHQpe3JldHVybiBlXnR9KSx0KTt2YXIgcn07cmV0dXJuIGZ1bmN0aW9uKGUpe3JldHVybiBlLm1hdGNoKC8uezEsMn0vZykubWFwKChmdW5jdGlvbihlKXtyZXR1cm4gcGFyc2VJbnQoZSwxNil9KSkubWFwKHQpLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoZSl9KSkuam9pbigiIil9fSgidm9kVGltZXN0YW1wU2FsdCIpO3ZlLmdldFVuaW9uSW5mbz1mdW5jdGlvbigpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXToiIjtyZXR1cm4iIi5jb25jYXQoZSkuY29uY2F0KGJlKChuZXcgRGF0ZSkuZ2V0VGltZSgpLnRvU3RyaW5nKCkpKX0sdmUuY2hlY2tVbmlvbkluZm9FeHBpcmVkPWZ1bmN0aW9uKCl7dmFyIGU9YXJndW1lbnRzLmxlbmd0aD4wJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOiIiLHQ9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOiIiLHI9YXJndW1lbnRzLmxlbmd0aD4yJiZ2b2lkIDAhPT1hcmd1bWVudHNbMl0/YXJndW1lbnRzWzJdOjMwO2lmKDA9PT10LmluZGV4T2YoZSkpe3ZhciBuPXBhcnNlSW50KGtlKHQuc2xpY2UoZS5sZW5ndGgpKSksaT0obmV3IERhdGUpLmdldFRpbWUoKS1uO2lmKGk+MCYmaTw9MWUzKnIpcmV0dXJuITB9cmV0dXJuITF9LHZlLmdldENvb2tpZVZhbHVlPWZ1bmN0aW9uKCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXToiIix0PWRvY3VtZW50LmNvb2tpZS5zcGxpdCgiOyIpLHI9MDtyPHQubGVuZ3RoO3IrKyl7dmFyIG49dFtyXS50cmltKCkuc3BsaXQoIj0iKTtpZihuWzBdPT09ZSlyZXR1cm4gblsxXX1yZXR1cm4gbnVsbH0sdmUubm93VGltZT1mdW5jdGlvbigpe3RyeXtyZXR1cm4gcGFyc2VJbnQocGVyZm9ybWFuY2Uubm93KCksMTApfWNhdGNoKGUpe3JldHVybihuZXcgRGF0ZSkuZ2V0VGltZSgpfX0sdmUuZ2V0Qml0cmF0ZUl0ZW09ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWFyZ3VtZW50cy5sZW5ndGg+MyYmdm9pZCAwIT09YXJndW1lbnRzWzNdP2FyZ3VtZW50c1szXTpudWxsLGk9dCxhPXZlLmdldFNlbGVjdG9yTGlzdChlLHIpLG89aS5nZXRTdWl0YWJsZUJpdHJhdGU/aS5nZXRTdWl0YWJsZUJpdHJhdGUoYSxuKTppLmJpdFJhdGVBZGFwdGVyLnNlbGVjdChhKTtyZXR1cm4gb30sdmUuZ2V0U2VsZWN0b3JMaXN0PWZ1bmN0aW9uKGUsdCl7Zm9yKHZhciByPWUuZHluYW1pY192aWRlb19saXN0LG49W10saT0wO2k8ci5sZW5ndGg7aSsrKXt2YXIgYT1yW2ldO24ucHVzaCh7Yml0cmF0ZTphLmJpdHJhdGUsZGVmaW5pdGlvbjphLmRlZmluaXRpb24sZHVyYXRpb246dH0pfXJldHVybiBufTt2YXIgX2UseGU9e307T2JqZWN0LmRlZmluZVByb3BlcnR5KHhlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSx4ZS5kZWZhdWx0PWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0wLHI9YXJndW1lbnRzLmxlbmd0aCxuPUFycmF5KHI+MT9yLTE6MCksaT0xO2k8cjtpKyspbltpLTFdPWFyZ3VtZW50c1tpXTt2YXIgYT0hMCxvPSExLHU9dm9pZCAwO3RyeXtmb3IodmFyIHMsYz1uW1N5bWJvbC5pdGVyYXRvcl0oKTshKGE9KHM9Yy5uZXh0KCkpLmRvbmUpO2E9ITApe3ZhciBmPXMudmFsdWU7dCs9Zi5sZW5ndGh9fWNhdGNoKG0pe289ITAsdT1tfWZpbmFsbHl7dHJ5eyFhJiZjLnJldHVybiYmYy5yZXR1cm4oKX1maW5hbGx5e2lmKG8pdGhyb3cgdX19dmFyIGw9bmV3IGUodCkseT0wLGg9ITAscD0hMSx2PXZvaWQgMDt0cnl7Zm9yKHZhciBkLHc9bltTeW1ib2wuaXRlcmF0b3JdKCk7IShoPShkPXcubmV4dCgpKS5kb25lKTtoPSEwKXt2YXIgZz1kLnZhbHVlO2wuc2V0KGcseSkseSs9Zy5sZW5ndGh9fWNhdGNoKG0pe3A9ITAsdj1tfWZpbmFsbHl7dHJ5eyFoJiZ3LnJldHVybiYmdy5yZXR1cm4oKX1maW5hbGx5e2lmKHApdGhyb3cgdn19cmV0dXJuIGx9O3ZhciBBZT0oKF9lPXhlKSYmX2UuX19lc01vZHVsZT9fZTp7ZGVmYXVsdDpfZX0pLmRlZmF1bHQsemU9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7ZSh0aGlzLHQpLHRoaXMuYnVmZmVyPW5ldyBVaW50OEFycmF5KDApfXJldHVybiByKHQsW3trZXk6IndyaXRlIix2YWx1ZTpmdW5jdGlvbigpe2Zvcih2YXIgZT10aGlzLHQ9YXJndW1lbnRzLmxlbmd0aCxyPW5ldyBBcnJheSh0KSxuPTA7bjx0O24rKylyW25dPWFyZ3VtZW50c1tuXTtyLmZvckVhY2goKGZ1bmN0aW9uKHQpe3Q/ZS5idWZmZXI9QWUoVWludDhBcnJheSxlLmJ1ZmZlcix0KTpjb25zb2xlLmVycm9yKHQpfSkpfX1dLFt7a2V5OiJ3cml0ZVVpbnQxNiIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyBVaW50OEFycmF5KFtlPj44JjI1NSwyNTUmZV0pfX0se2tleToid3JpdGVVaW50MzIiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBuZXcgVWludDhBcnJheShbZT4+MjQsZT4+MTYmMjU1LGU+PjgmMjU1LDI1NSZlXSl9fV0pLHR9KCksU2U9TWF0aC5wb3coMiwzMiktMTtmdW5jdGlvbiBVZShlKXtpZighQXJyYXkuaXNBcnJheShlKSl7Zm9yKHZhciB0PVtdLHI9IiIsbj0wO248ZS5sZW5ndGg7bisrKW4lMiYmKHI9ZVtuLTFdK2Vbbl0sdC5wdXNoKHBhcnNlSW50KHIsMTYpKSxyPSIiKTtyZXR1cm4gdH1yZXR1cm4gZS5tYXAoKGZ1bmN0aW9uKGUpe3JldHVybiBwYXJzZUludChlLDE2KX0pKX12YXIgQ2U9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7ZSh0aGlzLHQpfXJldHVybiByKHQsbnVsbCxbe2tleToidHlwZSIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyBVaW50OEFycmF5KFtlLmNoYXJDb2RlQXQoMCksZS5jaGFyQ29kZUF0KDEpLGUuY2hhckNvZGVBdCgyKSxlLmNoYXJDb2RlQXQoMyldKX19LHtrZXk6InNpemUiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB6ZS53cml0ZVVpbnQzMihlKX19LHtrZXk6ImV4dGVuc2lvbiIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoW2UsdD4+MTYmMjU1LHQ+PjgmMjU1LDI1NSZ0XSl9fSx7a2V5OiJhdWRpb1RyYWsiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPTgsaT10LnRraGQoe2lkOmUudHJhY2tJRHx8MixkdXJhdGlvbjplLmF1ZGlvRHVyYXRpb24sdGltZXNjYWxlOmUuYXVkaW9UaW1lU2NhbGUsd2lkdGg6MCxoZWlnaHQ6MCx0eXBlOiJhdWRpbyJ9KSxhPWUuY2hhbm5lbENvdW50LG89ZS5zYW1wbGVSYXRlO2UuZW5jYSYmKGE9ZS5lbmNhLmNoYW5uZWxDb3VudCxvPWUuZW5jYS5zYW1wbGVSYXRlKTt2YXIgdT10Lm1kaWEoe3R5cGU6ImF1ZGlvIix0aW1lc2NhbGU6ZS5hdWRpb1RpbWVTY2FsZSxkdXJhdGlvbjplLmF1ZGlvRHVyYXRpb24sY2hhbm5lbENvdW50OmEsc2FtcGxlUmF0ZTpvLGF1ZGlvQ29uZmlnOmUuYXVkaW9Db25maWcsZW5jYTplLmVuY2F9KTtyZXR1cm5baSx1XS5mb3JFYWNoKChmdW5jdGlvbihlKXtuKz1lLmJ5dGVMZW5ndGh9KSksci53cml0ZSh0LnNpemUobiksdC50eXBlKCJ0cmFrIiksaSx1KSxyLmJ1ZmZlcn19LHtrZXk6InZpZGVvVHJhayIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49OCxpPXQudGtoZCh7aWQ6ZS50cmFja0lEfHwxLGR1cmF0aW9uOmUudmlkZW9EdXJhdGlvbix0aW1lc2NhbGU6ZS52aWRlb1RpbWVTY2FsZSx3aWR0aDplLndpZHRoLGhlaWdodDplLmhlaWdodCx0eXBlOiJ2aWRlbyJ9KSxhPXQubWRpYSh7dHlwZToidmlkZW8iLHRpbWVzY2FsZTplLnZpZGVvVGltZVNjYWxlLGR1cmF0aW9uOmUudmlkZW9EdXJhdGlvbixWaWRlb1Zpc3VhbFNhbXBsZUVudHJ5OmUuVmlkZW9WaXN1YWxTYW1wbGVFbnRyeSxWaWRlb0NvZGVjQ29uZmlndXJhdGlvbkJveDplLlZpZGVvQ29kZWNDb25maWd1cmF0aW9uQm94LGVuY3Y6ZS5lbmN2fSk7cmV0dXJuW2ksYV0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7bis9ZS5ieXRlTGVuZ3RofSkpLHIud3JpdGUodC5zaXplKG4pLHQudHlwZSgidHJhayIpLGksYSksci5idWZmZXJ9fSx7a2V5OiJidHJ0Iix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPW5ldyB6ZSxyPW5ldyBVaW50OEFycmF5KFswLDI4LDE1NiwxMjgsMCw0NSwxOTgsMTkyLDAsNDUsMTk4LDE5Ml0pO3JldHVybiBlLndyaXRlKHQuc2l6ZSg4K3IuYnl0ZUxlbmd0aCksdC50eXBlKCJidHJ0IiksciksZS5idWZmZXJ9fSx7a2V5OiJkaW5mIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPW5ldyB6ZTtyZXR1cm4gZS53cml0ZSh0LnNpemUoMzYpLHQudHlwZSgiZGluZiIpLHQuc2l6ZSgyOCksdC50eXBlKCJkcmVmIiksbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMSwwLDAsMCwxMiwxMTcsMTE0LDEwOCwzMiwwLDAsMCwxXSkpLGUuYnVmZmVyfX0se2tleToiZWR0cyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49ZS5kdXJhdGlvbixpPWUubWVkaWFUaW1lO3JldHVybiByLndyaXRlKHQuc2l6ZSgzNiksdC50eXBlKCJlZHRzIikpLHIud3JpdGUodC5zaXplKDI4KSx0LnR5cGUoImVsc3QiKSksci53cml0ZShuZXcgVWludDhBcnJheShbMCwwLDAsMSxuPj4yNCYyNTUsbj4+MTYmMjU1LG4+PjgmMjU1LDI1NSZuLGk+PjI0JjI1NSxpPj4xNiYyNTUsaT4+OCYyNTUsMjU1JmksMCwwLDAsMV0pKSxyLmJ1ZmZlcn19LHtrZXk6ImVuY2EiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPWUuZW5jYS5jaGFubmVsQ291bnQsaT1lLmVuY2Euc2FtcGxlUmF0ZSxhPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsbiwwLDE2LDAsMCwwLDAsaT4+OCYyNTUsMjU1JmksMCwwXSksbz10LmVzZHMoZS5hdWRpb0NvbmZpZyksdT10LnNpbmYoZS5lbmNhKTtyZXR1cm4gci53cml0ZSh0LnNpemUoMTYrYS5ieXRlTGVuZ3RoK28uYnl0ZUxlbmd0aCt1LmJ5dGVMZW5ndGgpLHQudHlwZSgiZW5jYSIpLGEsbyx0LnNpemUoOCt1LmJ5dGVMZW5ndGgpLHQudHlwZSgic2luZiIpLHUpLHIuYnVmZmVyfX0se2tleToiZW5jdiIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49ZS53aWR0aCxpPWUuaGVpZ2h0LGE9bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLG4+PjgmMjU1LDI1NSZuLGk+PjgmMjU1LDI1NSZpLDAsNzIsMCwwLDAsNzIsMCwwLDAsMCwwLDAsMCwxLDE4LDEwMCw5NywxMDUsMTA4LDEyMSwxMDksMTExLDExNiwxMDUsMTExLDExMCw0NywxMDQsMTA4LDExNSw0NiwxMDYsMTE1LDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwyNCwxNywxN10pLG89bmV3IFVpbnQ4QXJyYXkoZS5WaWRlb0NvZGVjQ29uZmlndXJhdGlvbkJveCksdT10LmJ0cnQoKSxzPXQuc2luZihlLmVuY3YpLGM9dC5wYXNwKGUpO3JldHVybiByLndyaXRlKHQuc2l6ZSgxNithLmJ5dGVMZW5ndGgrby5ieXRlTGVuZ3RoK3UuYnl0ZUxlbmd0aCtjLmJ5dGVMZW5ndGgrcy5ieXRlTGVuZ3RoKSx0LnR5cGUoImVuY3YiKSxhLG8sdSx0LnNpemUoOCtzLmJ5dGVMZW5ndGgpLHQudHlwZSgic2luZiIpLHMsYyksci5idWZmZXJ9fSx7a2V5OiJlc2RzIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTpbNDMsMTQ2LDgsMF0scj1lLmxlbmd0aCxuPW5ldyB6ZSxpPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDMsMjMrciwwLDEsMCw0LDE1K3IsNjQsMjEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDVdLmNvbmNhdChbcl0pLmNvbmNhdChlKS5jb25jYXQoWzYsMSwyXSkpO3JldHVybiBuLndyaXRlKHQuc2l6ZSg4K2kuYnl0ZUxlbmd0aCksdC50eXBlKCJlc2RzIiksaSksbi5idWZmZXJ9fSx7a2V5OiJmcm1hIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1uZXcgVWludDhBcnJheShbZS5kYXRhX2Zvcm1hdC5jaGFyQ29kZUF0KDApLGUuZGF0YV9mb3JtYXQuY2hhckNvZGVBdCgxKSxlLmRhdGFfZm9ybWF0LmNoYXJDb2RlQXQoMiksZS5kYXRhX2Zvcm1hdC5jaGFyQ29kZUF0KDMpXSk7cmV0dXJuIHIud3JpdGUodC5zaXplKDgrbi5ieXRlTGVuZ3RoKSx0LnR5cGUoImZybWEiKSxuKSxyLmJ1ZmZlcn19LHtrZXk6ImZ0eXAiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZTtyZXR1cm4gci53cml0ZSh0LnNpemUoZS5zaXplKSx0LnR5cGUoImZ0eXAiKSxuZXcgVWludDhBcnJheShlLmRhdGEpKSxyLmJ1ZmZlcn19LHtrZXk6ImhkbHIiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPVswLDAsMCwwLDAsMCwwLDAsMTE4LDEwNSwxMDAsMTAxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDg2LDEwNSwxMDAsMTAxLDExMSw3Miw5NywxMTAsMTAwLDEwOCwxMDEsMTE0LDBdO3JldHVybiJhdWRpbyI9PT1lJiYobi5zcGxpY2UuYXBwbHkobixbOCw0XS5jb25jYXQoWzExNSwxMTEsMTE3LDExMF0pKSxuLnNwbGljZS5hcHBseShuLFsyNCwxM10uY29uY2F0KFs4MywxMTEsMTE3LDExMCwxMDAsNzIsOTcsMTEwLDEwMCwxMDgsMTAxLDExNCwwXSkpKSxyLndyaXRlKHQuc2l6ZSg4K24ubGVuZ3RoKSx0LnR5cGUoImhkbHIiKSxuZXcgVWludDhBcnJheShuKSksci5idWZmZXJ9fSx7a2V5OiJtZGF0Iix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj04O3JldHVybiBlLnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7bis9ZS5zaXplfSkpLHIud3JpdGUodC5zaXplKG4pLHQudHlwZSgibWRhdCIpKSxlLnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ci53cml0ZShlLmJ1ZmZlcil9KSksci5idWZmZXJ9fSx7a2V5OiJtZGhkIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1uZXcgVWludDhBcnJheShbMCwwLDAsMCwyMTcsMjAsMzcsOTAsZT4+MjQmMjU1LGU+PjE2JjI1NSxlPj44JjI1NSwyNTUmZSwwLDAsMCwwLDIxLDE5OSwwLDBdKTtyZXR1cm4gci53cml0ZSh0LnNpemUoMTIrbi5ieXRlTGVuZ3RoKSx0LnR5cGUoIm1kaGQiKSx0LmV4dGVuc2lvbigwLDApLG4pLHIuYnVmZmVyfX0se2tleToibWRpYSIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49OCxpPXQubWRoZChlLnRpbWVzY2FsZSksYT10LmhkbHIoZS50eXBlKSxvPXQubWluZihlKTtyZXR1cm5baSxhLG9dLmZvckVhY2goKGZ1bmN0aW9uKGUpe24rPWUuYnl0ZUxlbmd0aH0pKSxyLndyaXRlKHQuc2l6ZShuKSx0LnR5cGUoIm1kaWEiKSxpLGEsbyksci5idWZmZXJ9fSx7a2V5OiJtZmhkIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1udWxsO3JldHVybiAxPT09ZS5pZD8obj16ZS53cml0ZVVpbnQzMih0LnZpZGVvU2VxdWVuY2UpLHQudmlkZW9TZXF1ZW5jZSs9MSk6KG49emUud3JpdGVVaW50MzIodC5hdWRpb1NlcXVlbmNlKSx0LmF1ZGlvU2VxdWVuY2UrPTEpLHIud3JpdGUodC5zaXplKDE2KSx0LnR5cGUoIm1maGQiKSx0LmV4dGVuc2lvbigwLDApLG4pLHIuYnVmZmVyfX0se2tleToibWluZiIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49OCxpPSJ2aWRlbyI9PT1lLnR5cGU/dC52bWhkKCk6dC5zbWhkKCksYT10LmRpbmYoKSxvPXQuc3RibChlKTtyZXR1cm5baSxhLG9dLmZvckVhY2goKGZ1bmN0aW9uKGUpe24rPWUuYnl0ZUxlbmd0aH0pKSxyLndyaXRlKHQuc2l6ZShuKSx0LnR5cGUoIm1pbmYiKSxpLGEsbyksci5idWZmZXJ9fSx7a2V5OiJtb29mIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj04LGk9dC5tZmhkKGUpLGE9dC50cmFmKGUpO3JldHVybltpLGFdLmZvckVhY2goKGZ1bmN0aW9uKGUpe24rPWUuYnl0ZUxlbmd0aH0pKSxyLndyaXRlKHQuc2l6ZShuKSx0LnR5cGUoIm1vb2YiKSxpLGEpLHIuYnVmZmVyfX0se2tleToibW9vdiIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49OCxpPXQubXZoZChlLmR1cmF0aW9uLGUudGltZVNjYWxlKSxhPXQubXZleChlLmR1cmF0aW9uLGUudGltZVNjYWxlKSxvPW51bGw7aWYobz1lLnZpZGVvQ29kZWM/dC52aWRlb1RyYWsoZSk6dC5hdWRpb1RyYWsoZSksZS5lbmN2KXtlLnBzc2h8fChlLnBzc2g9e2tpZDplLmtpZH0pO3ZhciB1PXQucHNzaChlLnBzc2gpO1tpLGEsbyx1XS5mb3JFYWNoKChmdW5jdGlvbihlKXtuKz1lLmJ5dGVMZW5ndGh9KSksci53cml0ZSh0LnNpemUobiksdC50eXBlKCJtb292IiksaSxhLG8sdSl9ZWxzZVtpLGEsb10uZm9yRWFjaCgoZnVuY3Rpb24oZSl7bis9ZS5ieXRlTGVuZ3RofSkpLHIud3JpdGUodC5zaXplKG4pLHQudHlwZSgibW9vdiIpLGksYSxvKTtyZXR1cm4gci5idWZmZXJ9fSx7a2V5OiJtcDRhIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLGUuY2hhbm5lbENvdW50LDAsMTYsMCwwLDAsMCxlLnNhbXBsZVJhdGU+PjgmMjU1LDI1NSZlLnNhbXBsZVJhdGUsMCwwXSksaT10LmVzZHMoZS5hdWRpb0NvbmZpZyk7cmV0dXJuIHIud3JpdGUodC5zaXplKDgrbi5ieXRlTGVuZ3RoK2kuYnl0ZUxlbmd0aCksdC50eXBlKCJtcDRhIiksbixpKSxyLmJ1ZmZlcn19LHtrZXk6Im12ZXgiLHZhbHVlOmZ1bmN0aW9uKGUscil7dmFyIG49bmV3IHplLGk9emUud3JpdGVVaW50MzIoZSpyKTtyZXR1cm4gbi53cml0ZSh0LnNpemUoODgpLHQudHlwZSgibXZleCIpLHQuc2l6ZSgxNiksdC50eXBlKCJtZWhkIiksdC5leHRlbnNpb24oMCwwKSxpLHQudHJleDEoMSksdC50cmV4MigyKSksbi5idWZmZXJ9fSx7a2V5OiJtdmhkIix2YWx1ZTpmdW5jdGlvbihlLHIpe3ZhciBuPW5ldyB6ZTtlKj1yO3ZhciBpPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCxyPj4yNCYyNTUscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyLGU+PjI0JjI1NSxlPj4xNiYyNTUsZT4+OCYyNTUsMjU1JmUsMCwxLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsNjQsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsM10pO3JldHVybiBuLndyaXRlKHQuc2l6ZSg4K2kubGVuZ3RoKSx0LnR5cGUoIm12aGQiKSxuZXcgVWludDhBcnJheShpKSksbi5idWZmZXJ9fSx7a2V5OiJwYXNwIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1lLnBpeGVsUmF0aW9bMF0saT1lLnBpeGVsUmF0aW9bMV0sYT1uZXcgVWludDhBcnJheShbbj4+MjQsbj4+MTYmMjU1LG4+PjgmMjU1LDI1NSZuLGk+PjI0LGk+PjE2JjI1NSxpPj44JjI1NSwyNTUmaV0pO3JldHVybiByLndyaXRlKHQuc2l6ZSg4K2EuYnl0ZUxlbmd0aCksdC50eXBlKCJwYXNwIiksYSksci5idWZmZXJ9fSx7a2V5OiJwc3NoIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1uZXcgVWludDhBcnJheShbMSwwLDAsMF0uY29uY2F0KFsxNiwxMTksMjM5LDIzNiwxOTIsMTc4LDc3LDIsMTcyLDIyNyw2MCwzMCw4MiwyMjYsMjUxLDc1XSxbMCwwLDAsMV0sVWUoZS5raWQpLFswLDAsMCwwXSkpO3JldHVybiByLndyaXRlKHQuc2l6ZSg4K24uYnl0ZUxlbmd0aCksdC50eXBlKCJwc3NoIiksbiksci5idWZmZXJ9fSx7a2V5OiJzYWlvIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj0xMiplLnNhbXBsZXMubGVuZ3RoKzE0MTsyPT09ZS5pZCYmZS5pc0F1ZGlvRW5jcnlwdGlvbiYmKG49MTQ5KTt2YXIgaT1uZXcgVWludDhBcnJheShbMSwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsbj4+MjQmMjU1LG4+PjE2JjI1NSxuPj44JjI1NSwyNTUmbl0pO3JldHVybiByLndyaXRlKHQuc2l6ZSg4K2kuYnl0ZUxlbmd0aCksdC50eXBlKCJzYWlvIiksaSksci5idWZmZXJ9fSx7a2V5OiJzYWl6Iix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1lLnNhbXBsZXMubGVuZ3RoLGk9bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMTYsbj4+MjQmMjU1LG4+PjE2JjI1NSxuPj44JjI1NSwyNTUmbl0pO3JldHVybiByLndyaXRlKHQuc2l6ZSg4K2kuYnl0ZUxlbmd0aCksdC50eXBlKCJzYWl6IiksaSksci5idWZmZXJ9fSx7a2V5OiJzYmdwIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1uZXcgVWludDhBcnJheShbMTE0LDExMSwxMDgsMTA4LDAsMCwwLDEsMCwwLDEsMjUsMCwwLDAsMV0pO3JldHVybiByLndyaXRlKHQuc2l6ZSgxMituLmJ5dGVMZW5ndGgpLHQudHlwZSgic2JncCIpLHQuZXh0ZW5zaW9uKDAsMCksbiksci5idWZmZXJ9fSx7a2V5OiJzY2hpIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1uZXcgVWludDhBcnJheShbXSksaT10LnRlbmMoZSk7cmV0dXJuIHIud3JpdGUodC5zaXplKDgrbi5ieXRlTGVuZ3RoK2kuYnl0ZUxlbmd0aCksdC50eXBlKCJzY2hpIiksbixpKSxyLmJ1ZmZlcn19LHtrZXk6InNjaG0iLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDk5LDEwMSwxMTAsOTksMCwxLDAsMF0pO3JldHVybiByLndyaXRlKHQuc2l6ZSg4K24uYnl0ZUxlbmd0aCksdC50eXBlKCJzY2htIiksbiksci5idWZmZXJ9fSx7a2V5OiJzZHRwIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemU7cmV0dXJuIHIud3JpdGUodC5zaXplKDEyK2Uuc2FtcGxlcy5sZW5ndGgpLHQudHlwZSgic2R0cCIpLHQuZXh0ZW5zaW9uKDAsMCkpLGUuc2FtcGxlcy5mb3JFYWNoKChmdW5jdGlvbih0KXtyLndyaXRlKG5ldyBVaW50OEFycmF5KDE9PT1lLmlkP1t0LmtleT8zMjoxNl06WzE2XSkpfSkpLHIuYnVmZmVyfX0se2tleToic2VuYyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49ZS5zYW1wbGVzLmxlbmd0aCxpPWUuc2FtcGxlT2Zmc2V0LGE9bitpLG89MT09PWUuaWQ/MTY6OCx1PTE9PT1lLmlkPzI6MCxzPVtdLGM9MDtyZXR1cm4gMT09PWUuaWQ/KHM9ZS52aWRlb1NlbmMuc2xpY2UoaSxhKSxjPWUudmlkZW9TZW5jTGVuZ3RoKTpzPWUuYXVkaW9TZW5jLnNsaWNlKGksYSksYz1jfHxvKm4sci53cml0ZSh0LnNpemUoMTYrYyksdC50eXBlKCJzZW5jIiksdC5leHRlbnNpb24oMCx1KSksci53cml0ZSh6ZS53cml0ZVVpbnQzMihuKSkscy5mb3JFYWNoKChmdW5jdGlvbihlKXtyLndyaXRlKHplLndyaXRlVWludDMyKGUuSW5pdGlhbGl6YXRpb25WZWN0b3JbMF0pKSxyLndyaXRlKHplLndyaXRlVWludDMyKGUuSW5pdGlhbGl6YXRpb25WZWN0b3JbMV0pKSxlLnN1YnNhbXBsZXMmJmUuc3Vic2FtcGxlcy5sZW5ndGgmJihyLndyaXRlKHplLndyaXRlVWludDE2KGUuc3Vic2FtcGxlcy5sZW5ndGgpKSxlLnN1YnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ci53cml0ZSh6ZS53cml0ZVVpbnQxNihlLkJ5dGVzT2ZDbGVhckRhdGEpKSxyLndyaXRlKHplLndyaXRlVWludDMyKGUuQnl0ZXNPZlByb3RlY3RlZERhdGEpKX0pKSl9KSksci5idWZmZXJ9fSx7a2V5OiJzaWR4Iix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj0xPT09ZS5pZD9lLnZpZGVvVGltZVNjYWxlOmUuYXVkaW9UaW1lU2NhbGUsaT1lLnNhbXBsZXNbMF0uZHVyYXRpb24sYT1pKmUuc2FtcGxlcy5sZW5ndGgsbz1lLnNhbXBsZU9mZnNldCppLHU9ODtlLnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dSs9ZS5zaXplfSkpO3ZhciBzPTA7aWYoMT09PWUuaWQpe3ZhciBjPTAsZj1lLnNhbXBsZXMubGVuZ3RoLGw9ZS5zYW1wbGVPZmZzZXQseT1mK2wsaD1lLnZpZGVvU2VuYy5zbGljZShsLHkpOzE9PT1lLmlkJiZoLmZvckVhY2goKGZ1bmN0aW9uKGUpe2MrPTgsZS5zdWJzYW1wbGVzJiZlLnN1YnNhbXBsZXMubGVuZ3RoJiYoYys9MixjKz02KmUuc3Vic2FtcGxlcy5sZW5ndGgpfSkpLGUudmlkZW9TZW5jTGVuZ3RoPWMscz11KzE0MSsxMiplLnNhbXBsZXMubGVuZ3RoK2MsZS5pc0F1ZGlvRW5jcnlwdGlvbiYmIWUuaXNWaWRlb0VuY3J5cHRpb24mJihzPXUrMTIqZS5zYW1wbGVzLmxlbmd0aCs4NCl9ZWxzZSBzPXUrMTA0KzQqZS5zYW1wbGVzLmxlbmd0aCxlLmlzQXVkaW9FbmNyeXB0aW9uJiYocz11KzE2OSsxMiplLnNhbXBsZXMubGVuZ3RoKTt2YXIgcD1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwyNTUmZS5pZCxuPj4yNCYyNTUsbj4+MTYmMjU1LG4+PjgmMjU1LDI1NSZuLG8+PjI0JjI1NSxvPj4xNiYyNTUsbz4+OCYyNTUsMjU1Jm8sMCwwLDAsMCwwLDAsMCwxLDAscz4+MTYmMjU1LHM+PjgmMjU1LDI1NSZzLGE+PjI0JjI1NSxhPj4xNiYyNTUsYT4+OCYyNTUsMjU1JmEsMTQ0LDAsMCwwXSk7cmV0dXJuIHIud3JpdGUodC5zaXplKDgrcC5ieXRlTGVuZ3RoKSx0LnR5cGUoInNpZHgiKSxwKSxyLmJ1ZmZlcn19LHtrZXk6InNpbmYiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPW5ldyBVaW50OEFycmF5KFtdKSxpPXQuZnJtYShlKSxhPXQuc2NobSgpLG89dC5zY2hpKGUpO3JldHVybiByLndyaXRlKG4saSxhLG8pLHIuYnVmZmVyfX0se2tleToic21oZCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT1uZXcgemU7cmV0dXJuIGUud3JpdGUodC5zaXplKDE2KSx0LnR5cGUoInNtaGQiKSxuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwXSkpLGUuYnVmZmVyfX0se2tleToic3RibCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49OCxpPXQuc3RzZChlKSxhPXQuc3R0cygpLG89dC5zdHNjKCksdT10LnN0c3ooKSxzPXQuc3RjbygpO3JldHVybltpLGEsbyx1LHNdLmZvckVhY2goKGZ1bmN0aW9uKGUpe24rPWUuYnl0ZUxlbmd0aH0pKSxyLndyaXRlKHQuc2l6ZShuKSx0LnR5cGUoInN0YmwiKSxpLGEsbyx1LHMpLHIuYnVmZmVyfX0se2tleToic3RjbyIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT1uZXcgemUscj1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwXSk7cmV0dXJuIGUud3JpdGUodC5zaXplKDE2KSx0LnR5cGUoInN0Y28iKSxyKSxlLmJ1ZmZlcn19LHtrZXk6InN0c2MiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9bmV3IHplLHI9bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMF0pO3JldHVybiBlLndyaXRlKHQuc2l6ZSgxNiksdC50eXBlKCJzdHNjIiksciksZS5idWZmZXJ9fSx7a2V5OiJzdHNkIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcixuPW5ldyB6ZTtyZXR1cm4gcj0iYXVkaW8iPT09ZS50eXBlP2UuZW5jYT90LmVuY2EoZSk6dC5tcDRhKGUpOmUuZW5jdj90LmVuY3YoZSk6ZS5WaWRlb1Zpc3VhbFNhbXBsZUVudHJ5LG4ud3JpdGUodC5zaXplKDE2K3IuYnl0ZUxlbmd0aCksdC50eXBlKCJzdHNkIiksdC5leHRlbnNpb24oMCwwKSxuZXcgVWludDhBcnJheShbMCwwLDAsMV0pLHIpLG4uYnVmZmVyfX0se2tleToic3RzeiIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT1uZXcgemUscj1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDBdKTtyZXR1cm4gZS53cml0ZSh0LnNpemUoMjApLHQudHlwZSgic3RzeiIpLHIpLGUuYnVmZmVyfX0se2tleToic3R0cyIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT1uZXcgemUscj1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwXSk7cmV0dXJuIGUud3JpdGUodC5zaXplKDE2KSx0LnR5cGUoInN0dHMiKSxyKSxlLmJ1ZmZlcn19LHtrZXk6InN0eXAiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPW5ldyBVaW50OEFycmF5KFsxMDksMTE1LDEwMCwxMDQsMCwwLDAsMCwxMDksMTE1LDEwMCwxMDQsMTA5LDExNSwxMDUsMTIwXSk7cmV0dXJuIHIud3JpdGUodC5zaXplKDgrbi5ieXRlTGVuZ3RoKSx0LnR5cGUoInN0eXAiKSxuKSxyLmJ1ZmZlcn19LHtrZXk6InRlbmMiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwyNTUmZS5kZWZhdWx0X0lzRW5jcnlwdGVkLDI1NSZlLmRlZmF1bHRfSVZfc2l6ZV0uY29uY2F0KFVlKGUuZGVmYXVsdF9LSUQpKSk7cmV0dXJuIHIud3JpdGUodC5zaXplKDgrbi5ieXRlTGVuZ3RoKSx0LnR5cGUoInRlbmMiKSxuKSxyLmJ1ZmZlcn19LHtrZXk6InRmZHQiLHZhbHVlOmZ1bmN0aW9uKGUscil7dmFyIG49bmV3IHplLGk9TWF0aC5mbG9vcihyLyhTZSsxKSksYT1NYXRoLmZsb29yKHIlKFNlKzEpKTtyZXR1cm4gZS5pc1ZpZGVvRW5jcnlwdGlvbnx8ZS5pc0F1ZGlvRW5jcnlwdGlvbj9uLndyaXRlKHQuc2l6ZSgxNiksdC50eXBlKCJ0ZmR0IiksdC5leHRlbnNpb24oMCwwKSx6ZS53cml0ZVVpbnQzMihhKSk6bi53cml0ZSh0LnNpemUoMjApLHQudHlwZSgidGZkdCIpLHQuZXh0ZW5zaW9uKDEsMCksemUud3JpdGVVaW50MzIoaSksemUud3JpdGVVaW50MzIoYSkpLG4uYnVmZmVyfX0se2tleToidGZoZCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49MTYsaT1lLmZsYWdzO3JldHVybiAyJmkmJihpPWUuZmxhZ3MtMiksMSZpJiYobis9OCksOCZpJiYobis9NCksMTYmaSYmKG4rPTQpLDMyJmkmJihuKz00KSxyLndyaXRlKHQuc2l6ZShuKSx0LnR5cGUoInRmaGQiKSksci53cml0ZSh6ZS53cml0ZVVpbnQzMihpKSksci53cml0ZSh6ZS53cml0ZVVpbnQzMihlLnRyYWNrX2lkKSksMSZpJiZyLndyaXRlKHplLndyaXRlVWludDY0KGUuYmFzZV9kYXRhX29mZnNldCkpLDgmaSYmci53cml0ZSh6ZS53cml0ZVVpbnQzMihlLmRlZmF1bHRfc2FtcGxlX2R1cmF0aW9uKSksMTYmaSYmci53cml0ZSh6ZS53cml0ZVVpbnQzMihlLmRlZmF1bHRfc2FtcGxlX3NpemUpKSwzMiZpJiZyLndyaXRlKHplLndyaXRlVWludDMyKGUuZGVmYXVsdF9zYW1wbGVfZmxhZ3MpKSxyLmJ1ZmZlcn19LHtrZXk6InRraGQiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPWUuaWQsaT1lLmR1cmF0aW9uKmUudGltZVNjYWxlLGE9ZS53aWR0aCxvPWUuaGVpZ2h0LHU9ZS50eXBlLHM9bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDMsMCwwLDAsMCwyMTcsMTcyLDIzNiw4NixuPj4yNCYyNTUsbj4+MTYmMjU1LG4+PjgmMjU1LDI1NSZuLDAsMCwwLDAsaT4+MjQmMjU1LGk+PjE2JjI1NSxpPj44JjI1NSwyNTUmaSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsInZpZGVvIj09PXU/MTowLCJhdWRpbyI9PT11PzE6MCwwLDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsNjQsMCwwLDAsYT4+OCYyNTUsMjU1JmEsMCwwLG8+PjgmMjU1LDI1NSZvLDAsMF0pO3JldHVybiByLndyaXRlKHQuc2l6ZSg4K3MuYnl0ZUxlbmd0aCksdC50eXBlKCJ0a2hkIikscyksci5idWZmZXJ9fSx7a2V5OiJ0cmFmIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj04LGk9dC50ZmhkKGUuaWQpLGE9dC50ZmR0KGUsZS50aW1lKTtpZihlLmlzVmlkZW9FbmNyeXB0aW9ufHxlLmlzQXVkaW9FbmNyeXB0aW9uKWlmKGUuaXNWaWRlb0VuY3J5cHRpb24paWYoMT09PWUuaWQpe3ZhciBvPXQuc2FpeihlKSx1PXQuc2FpbyhlKSxzPXQudHJ1bjEoZSksYz10LnNlbmMoZSk7W2ksYSxvLHUscyxjXS5mb3JFYWNoKChmdW5jdGlvbihlKXtuKz1lLmJ5dGVMZW5ndGh9KSksci53cml0ZSh0LnNpemUobiksdC50eXBlKCJ0cmFmIiksaSxhLG8sdSxzLGMpfWVsc2UgaWYoZS5pc0F1ZGlvRW5jcnlwdGlvbil7dmFyIGY9dC5zYmdwKGUpLGw9dC5zYWl6KGUpLHk9dC5zYWlvKGUpLGg9dC5zZW5jKGUpLHA9dC50cnVuMShlKTtbaSxhLGYsbCx5LGgscF0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7bis9ZS5ieXRlTGVuZ3RofSkpLHIud3JpdGUodC5zaXplKG4pLHQudHlwZSgidHJhZiIpLGksYSxmLGwseSxoLHApfWVsc2V7dmFyIHY9dC5zYmdwKGUpLGQ9dC50cnVuMShlKTtbaSxhLHYsZF0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7bis9ZS5ieXRlTGVuZ3RofSkpLHIud3JpdGUodC5zaXplKG4pLHQudHlwZSgidHJhZiIpLGksYSx2LGQpfWVsc2UgaWYoMT09PWUuaWQpe3ZhciB3PXQudHJ1bjEoZSk7W2ksYSx3XS5mb3JFYWNoKChmdW5jdGlvbihlKXtuKz1lLmJ5dGVMZW5ndGh9KSksci53cml0ZSh0LnNpemUobiksdC50eXBlKCJ0cmFmIiksaSxhLHcpfWVsc2V7dmFyIGc9dC5zYmdwKGUpLG09dC5zYWl6KGUpLGI9dC5zYWlvKGUpLGs9dC5zZW5jKGUpLF89dC50cnVuMShlKTtbaSxhLGcsbSxiLGssX10uZm9yRWFjaCgoZnVuY3Rpb24oZSl7bis9ZS5ieXRlTGVuZ3RofSkpLHIud3JpdGUodC5zaXplKG4pLHQudHlwZSgidHJhZiIpLGksYSxnLG0sYixrLF8pfWVsc2V7dmFyIHg9dC5zZHRwKGUpLEE9dC50cnVuKGUseC5ieXRlTGVuZ3RoKTtbaSxhLHgsQV0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7bis9ZS5ieXRlTGVuZ3RofSkpLHIud3JpdGUodC5zaXplKG4pLHQudHlwZSgidHJhZiIpLGksYSx4LEEpfXJldHVybiByLmJ1ZmZlcn19LHtrZXk6InRyZXgiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLGU+PjI0LGU+PjE2JjI1NSxlPj44JjI1NSwyNTUmZSwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDEsMCwxXSk7cmV0dXJuIHIud3JpdGUodC5zaXplKDgrbi5ieXRlTGVuZ3RoKSx0LnR5cGUoInRyZXgiKSxuKSxyLmJ1ZmZlcn19LHtrZXk6InRyZXgxIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1uZXcgVWludDhBcnJheShbMCwwLDAsMCxlPj4yNCxlPj4xNiYyNTUsZT4+OCYyNTUsMjU1JmUsMCwwLDAsMSwwLDAsMiwwLDAsMCwwLDAsMCwxLDAsMF0pO3JldHVybiByLndyaXRlKHQuc2l6ZSg4K24uYnl0ZUxlbmd0aCksdC50eXBlKCJ0cmV4Iiksbiksci5idWZmZXJ9fSx7a2V5OiJ0cmV4MiIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsZT4+MjQsZT4+MTYmMjU1LGU+PjgmMjU1LDI1NSZlLDAsMCwwLDEsMCwwLDQsMCwwLDAsMCwwLDIsMCwwLDBdKTtyZXR1cm4gci53cml0ZSh0LnNpemUoOCtuLmJ5dGVMZW5ndGgpLHQudHlwZSgidHJleCIpLG4pLHIuYnVmZmVyfX0se2tleToidHJ1biIsdmFsdWU6ZnVuY3Rpb24oZSxyKXt2YXIgbj1lLmlkLGk9MT09PW4/MTY6MTIsYT1uZXcgemUsbz16ZS53cml0ZVVpbnQzMihlLnNhbXBsZXMubGVuZ3RoKSx1PXplLndyaXRlVWludDMyKDk2K2kqZS5zYW1wbGVzLmxlbmd0aCtyKTtyZXR1cm4gYS53cml0ZSh0LnNpemUoMjAraSplLnNhbXBsZXMubGVuZ3RoKSx0LnR5cGUoInRydW4iKSx0LmV4dGVuc2lvbigwLGUuZmxhZ3MpLG8sdSksZS5zYW1wbGVzLmZvckVhY2goKGZ1bmN0aW9uKGUsdCl7YS53cml0ZSh6ZS53cml0ZVVpbnQzMihlLmR1cmF0aW9uKSksYS53cml0ZSh6ZS53cml0ZVVpbnQzMihlLnNpemUpKSwxPT09bj8oYS53cml0ZSh6ZS53cml0ZVVpbnQzMihlLmtleT8zMzU1NDQzMjoxNjg0Mjc1MikpLGEud3JpdGUoemUud3JpdGVVaW50MzIoZS5vZmZzZXQpKSk6YS53cml0ZSh6ZS53cml0ZVVpbnQzMigxNjc3NzIxNikpfSkpLGEuYnVmZmVyfX0se2tleToidHJ1bjEiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPWUuaWQsbj0xPT09cj8xMjo0LGk9bmV3IHplLGE9emUud3JpdGVVaW50MzIoZS5zYW1wbGVzLmxlbmd0aCksbz1udWxsO2lmKDE9PT1lLmlkKXt2YXIgdT0wOzE9PT1lLmlkJiYodT1lLnZpZGVvU2VuY0xlbmd0aCksbz16ZS53cml0ZVVpbnQzMigxMiplLnNhbXBsZXMubGVuZ3RoK3UrMTQ5KSwhZS5pc1ZpZGVvRW5jcnlwdGlvbiYmZS5pc0F1ZGlvRW5jcnlwdGlvbiYmKG89emUud3JpdGVVaW50MzIoZS5zYW1wbGVzLmxlbmd0aCpuKzkyKSl9ZWxzZXt2YXIgcz00KmUuc2FtcGxlcy5sZW5ndGgrMTIwO2UuaXNBdWRpb0VuY3J5cHRpb24mJihzPTEyKmUuc2FtcGxlcy5sZW5ndGgrMTc3KSxvPXplLndyaXRlVWludDMyKHMpfXJldHVybiBpLndyaXRlKHQuc2l6ZSgyMCtuKmUuc2FtcGxlcy5sZW5ndGgpLHQudHlwZSgidHJ1biIpLHQuZXh0ZW5zaW9uKDAsZS5mbGFncyksYSxvKSxlLnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7aS53cml0ZSh6ZS53cml0ZVVpbnQzMihlLnNpemUpKSwxPT09ciYmKGkud3JpdGUoemUud3JpdGVVaW50MzIoZS5rZXk/MzM1NTQ0MzI6NjU1MzYpKSxpLndyaXRlKHplLndyaXRlVWludDMyKGUub2Zmc2V0KSkpfSkpLGkuYnVmZmVyfX0se2tleToidm1oZCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT1uZXcgemU7cmV0dXJuIGUud3JpdGUodC5zaXplKDIwKSx0LnR5cGUoInZtaGQiKSxuZXcgVWludDhBcnJheShbMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDBdKSksZS5idWZmZXJ9fSx7a2V5OiJhdjAxIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1lLndpZHRoLGk9ZS5oZWlnaHQsYT10LmF2MUMoZSksbz1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsbj4+OCYyNTUsMjU1Jm4saT4+OCYyNTUsMjU1JmksMCw3MiwwLDAsMCw3MiwwLDAsMCwwLDAsMCwwLDEsMTgsMTAwLDk3LDEwNSwxMDgsMTIxLDEwOSwxMTEsMTE2LDEwNSwxMTEsMTEwLDQ3LDEwNCwxMDgsMTE1LDQ2LDEwNiwxMTUsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDI0LDE3LDE3XSksdT10LmJ0cnQoKSxzPXQucGFzcChlKTtyZXR1cm4gci53cml0ZSh0LnNpemUoOCtvLmJ5dGVMZW5ndGgrYS5ieXRlTGVuZ3RoK3UuYnl0ZUxlbmd0aCtzLmJ5dGVMZW5ndGgpLHQudHlwZSgiYXYwMSIpLG8sYSx1LHMpLHIuYnVmZmVyfX0se2tleToiYXYxQyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49bmV3IFVpbnQ4QXJyYXkoZS5hdjFDKTtyZXR1cm4gci53cml0ZSh0LnNpemUoOCtuLmJ5dGVMZW5ndGgpLHQudHlwZSgiYXYxQyIpLG4pLHIuYnVmZmVyfX0se2tleToiYXZjMSIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49ZS53aWR0aCxpPWUuaGVpZ2h0LGE9dC5hdmNDKGUpLG89bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLG4+PjgmMjU1LDI1NSZuLGk+PjgmMjU1LDI1NSZpLDAsNzIsMCwwLDAsNzIsMCwwLDAsMCwwLDAsMCwxLDE4LDEwMCw5NywxMDUsMTA4LDEyMSwxMDksMTExLDExNiwxMDUsMTExLDExMCw0NywxMDQsMTA4LDExNSw0NiwxMDYsMTE1LDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwyNCwxNywxN10pLHU9dC5idHJ0KCkscz10LnBhc3AoZSk7cmV0dXJuIHIud3JpdGUodC5zaXplKDgrby5ieXRlTGVuZ3RoK2EuYnl0ZUxlbmd0aCt1LmJ5dGVMZW5ndGgrcy5ieXRlTGVuZ3RoKSx0LnR5cGUoImF2YzEiKSxvLGEsdSxzKSxyLmJ1ZmZlcn19LHtrZXk6ImF2Y0MiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPWUuc3BzLGk9ZS5wcHMsYT1uZXcgVWludDhBcnJheShbMSxuWzFdLG5bMl0sblszXSwyNTUsMjI1XS5jb25jYXQoW24ubGVuZ3RoPj4+OCYyNTUsMjU1Jm4ubGVuZ3RoXSkuY29uY2F0KG4pLmNvbmNhdCgxKS5jb25jYXQoW2kubGVuZ3RoPj4+OCYyNTUsMjU1JmkubGVuZ3RoXSkuY29uY2F0KGkpKTtyZXR1cm4gci53cml0ZSh0LnNpemUoOCthLmJ5dGVMZW5ndGgpLHQudHlwZSgiYXZjQyIpLGEpLHIuYnVmZmVyfX1dKSx0fSgpO0NlLnZpZGVvU2VxdWVuY2U9MSxDZS5hdWRpb1NlcXVlbmNlPTE7dmFyIEJlLE9lPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe3ZhciByLG47ZSh0aGlzLHQpO3ZhciBpPW5ldyBQcm9taXNlKChmdW5jdGlvbihlLHQpe3I9ZSxuPXR9KSk7cmV0dXJuIGkucmVzb2x2ZT1yLGkucmVqZWN0PW4saX1yZXR1cm4gcih0LFt7a2V5OiJyZXNvbHZlIix2YWx1ZTpmdW5jdGlvbihlKXt9fSx7a2V5OiJyZWplY3QiLHZhbHVlOmZ1bmN0aW9uKGUpe319XSksdH0oKTtmdW5jdGlvbiBFZSgpe3RyeXtyZXR1cm4idW5kZWZpbmVkIiE9dHlwZW9mIGxvY2FsU3RvcmFnZSYmInNldEl0ZW0iaW4gbG9jYWxTdG9yYWdlJiYhIWxvY2FsU3RvcmFnZS5zZXRJdGVtfWNhdGNoKGUpe3JldHVybiExfX1FZSYmZnVuY3Rpb24oKXt2YXIgZT0iX2xvY2Fsc3RvcmFnZV9zdXBwb3J0X3Rlc3QiO3RyeXtsb2NhbFN0b3JhZ2Uuc2V0SXRlbShlLCEwKSxsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShlKX1jYXRjaCh0KXtyZXR1cm4hMH19KCk7dmFyIExlPXIoKGZ1bmN0aW9uIHQocixuLGksYSxvLHUpe2UodGhpcyx0KSx0aGlzLnR5cGU9cix0aGlzLmNvZGVjcz1uLHRoaXMudmlzdWFsRW50cnlCb3g9aSx0aGlzLmNvbmZpZ3VyYXRpb25Cb3g9YSx0aGlzLnR5cGVzPW8sdGhpcy5sb2dDb2RlVHlwZT11fSkpLEllPSJhdmMiLFJlPSJhdjEiO24oQmU9e30sSWUsbmV3IExlKCJhdmMiLCJhdmMxLjY0MDAxRSIsImF2YzEiLCJhdmNDIixbImgyNjQiXSwiaDI2NCIpKSxuKEJlLFJlLG5ldyBMZSgiYXYxIiwiYXYwMS4wLjA4TS4wOCIsImF2MDEiLCJhdjFDIixbImF2MSJdLCJhdjEiKSk7dmFyIERlPXttc2U6ZnVuY3Rpb24oKXt9fSxNZT1zZWxmLmNyeXB0b3x8c2VsZi5tc0NyeXB0byxUZT12ZS5maW5kQm94LGplPWZ1bmN0aW9uKGUsdCxyKXt2YXIgbj1udWxsO2lmKGU9PT1JZSYmKG49VmUodCxyKSksZT09PVJlJiYobj1mdW5jdGlvbihlLHQpe3ZhciByPVBlKGUsdCksbj1yLndpZHRoLGk9ci5oZWlnaHQsYT1yLnBpeGVsUmF0aW8sbz1yLmF2MUNCb3gsdT1yLnZpZGVvQ29kZWMscz1DZS5hdjAxKHt3aWR0aDpuLGhlaWdodDppLHBpeGVsUmF0aW86YSxhdjFDOm8uZGF0YX0pLGM9Q2UuYXYxQyh7YXYxQzpvLmRhdGF9KTtyZXR1cm57VmlkZW9WaXN1YWxTYW1wbGVFbnRyeTpzLFZpZGVvQ29kZWNDb25maWd1cmF0aW9uQm94OmMsdmlkZW9Db2RlYzp1fX0odCxyKSksIW4pdGhyb3cgbmV3IEVycm9yKCIiLmNvbmNhdChlLCIgbm90IHN1cHBvcnQiKSk7cmV0dXJuIG59LFZlPWZ1bmN0aW9uKGUsdCl7dmFyIHI9SGUoZSx0KSxuPXIud2lkdGgsaT1yLmhlaWdodCxhPXIudmlkZW9Db2RlYyxvPXIuc3BzLHU9ci5wcHMscz1yLnBpeGVsUmF0aW87cmV0dXJue1ZpZGVvVmlzdWFsU2FtcGxlRW50cnk6Q2UuYXZjMSh7c3BzOm8scHBzOnUsd2lkdGg6bixoZWlnaHQ6aSxwaXhlbFJhdGlvOnN9KSxWaWRlb0NvZGVjQ29uZmlndXJhdGlvbkJveDpDZS5hdmNDKHtzcHM6byxwcHM6dX0pLHZpZGVvQ29kZWM6YX19LEhlPWZ1bmN0aW9uKGUsdCl7dmFyIHIsbixpLGEsbyx1PVsxLDFdLHM9VGUodCwiYXZjQyIpOyJlbmN2Ij09PWUudHlwZSYmKHM9VGUoZSwiYXZjQyIpKTt2YXIgYz1UZSh0LCJ0a2hkIik7cmV0dXJuIHM/KGk9IiIuY29uY2F0KGUudHlwZSwiLiIpK3ZlLnRvSGV4KHMucHJvZmlsZSxzLnByb2ZpbGVDb21wYXRpYmlsaXR5LHMuQVZDTGV2ZWxJbmRpY2F0aW9uKS5qb2luKCIiKSxhPXMuc3BzLHU9W3Muc3BzSW5mby5wYXJfcmF0aW8ud2lkdGgscy5zcHNJbmZvLnBhcl9yYXRpby5oZWlnaHRdLHMuc3BzSW5mby5jb2RlY19zaXplJiYocj1zLnNwc0luZm8uY29kZWNfc2l6ZS53aWR0aCxuPXMuc3BzSW5mby5jb2RlY19zaXplLmhlaWdodCksbz1zLnBwcyYmcy5wcHMubWFwKChmdW5jdGlvbihlKXtyZXR1cm4gTnVtYmVyKCIweCIuY29uY2F0KGUpKX0pKSk6aT0iIi5jb25jYXQoZS50eXBlKSxjJiYhciYmKHI9Yy53aWR0aCxuPWMuaGVpZ2h0KSx7d2lkdGg6cixoZWlnaHQ6bix2aWRlb0NvZGVjOmksc3BzOmEscHBzOm8scGl4ZWxSYXRpbzp1fX07dmFyIFBlPWZ1bmN0aW9uKGUsdCl7dmFyIHIsbixpLGE9WzEsMV0sbz1UZSh0LCJhdjFDIik7ImVuY3YiPT09ZS50eXBlJiYocj1lLndpZHRoLG49ZS5oZWlnaHQsbz1UZShlLCJhdjFDIikpO3ZhciB1PVRlKHQsInRraGQiKTtyZXR1cm4gbz8oaT0iIi5jb25jYXQoZS50eXBlLCIuIiksYT1bMSwxXSk6aT0iIi5jb25jYXQoZS50eXBlKSx1JiYhciYmKHI9dS53aWR0aCxuPXUuaGVpZ2h0KSx7d2lkdGg6cixoZWlnaHQ6bix2aWRlb0NvZGVjOmkscGl4ZWxSYXRpbzphLGF2MUNCb3g6b319LEZlPXtkZWNyeXB0SGVhZGVyOmZ1bmN0aW9uKGUsdCl7Zm9yKHZhciByPXRoaXMsbj1uZXcgemUsaT1udWxsLGE9bnVsbCxvPTA7bzxlLmJveGVzLmxlbmd0aDtvKyspe3ZhciB1PWUuYm94ZXNbb107aWYoImZ0eXAiPT09dS50eXBlKXthPXU7YnJlYWt9fXJldHVybiBlLmJveGVzLmZvckVhY2goKGZ1bmN0aW9uKGUpe2lmKCJtb292Ij09PWUudHlwZSl7dmFyIG89ZnVuY3Rpb24oZSx0KXt2YXIgcixuLGksYSxvLHUscyxjLGY9VGUoZSwibXZoZCIpLGw9VGUoZSwidHJhayIpLHk9VGUoZSwidWR0YSIpLGg9VGUobCwiaGRsciIpLHA9VGUobCwibWRoZCIpO2lmKGgmJnApe3ZhciB2PVRlKGwsInN0c2QiKSxkPVRlKGwsInRraGQiKSx3PXYuc3ViQm94WzBdLGc9e307aWYoInZpZGUiPT09aC5oYW5kbGVUeXBlJiYoaT1sLGE9cC50aW1lc2NhbGUsZz1qZSh0LHcsbCkpLCJzb3VuIj09PWguaGFuZGxlVHlwZSl7bj1sO3ZhciBtPVRlKGwsImVzZHMiKSxiPVRlKGwsIm1wNGEiKSxrPVRlKGwsNSk7bz1wLnRpbWVzY2FsZSxyPW0/IiIuY29uY2F0KHcudHlwZSwiLiIpK3ZlLnRvSGV4KG0uc3ViQm94WzBdLnN1YkJveFswXS50eXBlSUQpKyIuIi5jb25jYXQobS5zdWJCb3hbMF0uc3ViQm94WzBdLnN1YkJveFswXS50eXBlKToiIi5jb25jYXQody50eXBlKSxrJiZrLkVTY29kZSYmKGM9ay5FU2NvZGUubWFwKChmdW5jdGlvbihlKXtyZXR1cm4gTnVtYmVyKCIweCIuY29uY2F0KGUpKX0pKSksYiYmKHU9Yi5jaGFubmVsQ291bnQscz1iLnNhbXBsZVJhdGUpO3ZhciBfPVRlKGwsImVuY2EiKTtfJiYodT1fLmNoYW5uZWxDb3VudCxzPV8uc2FtcGxlUmF0ZSl9dmFyIHg9dmUuZmluZEJveChsLCJzdHNjIiksQT12ZS5maW5kQm94KGwsInN0c3oiKSx6PXZlLmZpbmRCb3gobCwic3R0cyIpLFM9dmUuZmluZEJveChsLCJzdGNvIiksVT1mLmR1cmF0aW9uO2lmKDA9PT1VKXt2YXIgQz1UZShlLCJtZWhkIik7QyYmKFU9Qy5mcmFnbWVudF9kdXJhdGlvbil9cmV0dXJuIE9iamVjdC5hc3NpZ24oe2F1ZGlvQ29kZWM6cixhdWRpb1RyYWs6bix2aWRlb1RyYWs6aSxjcmVhdGVUaW1lOmYuY3JlYXRlVGltZSxtb2RpZnlUaW1lOmYubW9kaWZ5VGltZSxkdXJhdGlvbjpVL2YudGltZVNjYWxlLHRpbWVTY2FsZTpmLnRpbWVTY2FsZSx2aWRlb1RpbWVTY2FsZTphLGF1ZGlvVGltZVNjYWxlOm8scGl4ZWxSYXRpbzpbMSwxXSxjaGFubmVsQ291bnQ6dSxzYW1wbGVSYXRlOnMsYXVkaW9Db25maWc6YyxzdHNjOngsc3RzejpBLHN0dHM6eixzdGNvOlMsdWR0YTp5LHRyYWNrSUQ6ZCYmZC50cmFja0lEfSxnKX19KGUsdCk7aWYoby51ZHRhKXt2YXIgdT1UZShvLnVkdGEsIm1ldGEiKTtpPXUmJnUudmlkfW8udmlkZW9Db2RlYz9yLnZpZGVvTWV0YT1vOnIuYXVkaW9NZXRhPW8sbi53cml0ZShDZS5mdHlwKGEpKSxuLndyaXRlKENlLm1vb3YobykpfX0pKSx7YnVmZmVyOm4uYnVmZmVyLHZpZDppfX0sZGVjcnlwdEJvZHk6ZnVuY3Rpb24oZSx0LHIsbixpLGEpe3ZhciBvPW5ldyBPZTt0cnl7dmFyIHU9bmV3IHplLHM9bnVsbCxjPW51bGw7ZS5ib3hlcy5mb3JFYWNoKChmdW5jdGlvbihlKXtpZigic3R5cCI9PT1lLnR5cGV8fCJzaWR4Ij09PWUudHlwZSl1LndyaXRlKENlLnNpemUoZS5zaXplKSksdS53cml0ZShDZS50eXBlKGUudHlwZSkpLHUud3JpdGUobmV3IFVpbnQ4QXJyYXkoZS5kYXRhKSk7ZWxzZSBpZigibW9vZiI9PT1lLnR5cGUpe3M9VGUoZSwic2VuYyIpO3ZhciBmPVRlKGUsInNhaW8iKSxsPVRlKGUsInNhaXoiKSx5PVRlKGUsInRmaGQiKTtjPVRlKGUsInRydW4iKTt2YXIgaD0wO3MmJnMuc2FtcGxlcy5sZW5ndGg/KGg9cy5kYXRhLmJ5dGVMZW5ndGgrOCxmJiZmLmRhdGEmJihoPWgrZi5kYXRhLmJ5dGVMZW5ndGgrOCksbCYmbC5kYXRhJiYoaD1oK2wuZGF0YS5ieXRlTGVuZ3RoKzgpKTooeSYmMiZ5LmZsYWdzJiYoaD00KSxzPW51bGwpOyFmdW5jdGlvbiBlKHQpe3ZhciByPXQuc2l6ZSxuPXQudHlwZTtpZigic2FpbyIhPT1uJiYic2FpeiIhPT1uJiYic2VuYyIhPT1uKWlmKCJtb29mIiE9PW4mJiJ0cmFmIiE9PW58fChyLT1oKSwidGZoZCI9PT1uJiYyJnkuZmxhZ3MpdS53cml0ZShDZS50ZmhkKHkpKTtlbHNlIGlmKHUud3JpdGUoQ2Uuc2l6ZShyKSksdS53cml0ZShDZS50eXBlKG4pKSx0LnN1YkJveCYmdC5zdWJCb3gubGVuZ3RoKXQuc3ViQm94LmZvckVhY2goKGZ1bmN0aW9uKHQpe2UodCl9KSk7ZWxzZSBpZigidHJ1biI9PT1uKXt2YXIgaT1uZXcgRGF0YVZpZXcodC5kYXRhLDApO2kuc2V0SW50MzIoOCxpLmdldEludDMyKDgpLWgpLHUud3JpdGUobmV3IFVpbnQ4QXJyYXkoaS5idWZmZXIpKX1lbHNlIHUud3JpdGUobmV3IFVpbnQ4QXJyYXkodC5kYXRhKSl9KGUpfWVsc2UibWRhdCI9PT1lLnR5cGUmJih1LndyaXRlKENlLnNpemUoZS5zaXplKSksdS53cml0ZShDZS50eXBlKGUudHlwZSkpLHM/YT9GZS5kZWNyeXB0V2l0aFJhdyhzLGMsZSxyLG4saSkudGhlbigoZnVuY3Rpb24oZSl7ZT8odS53cml0ZShlKSxvLnJlc29sdmUodS5idWZmZXIpKTpvLnJlc29sdmUobnVsbCl9KSk6RmUuZGVjcnlwdFdpdGhDcnlwdG9Kc1dvcmQocyxjLGUsdCxyLG4pLnRoZW4oKGZ1bmN0aW9uKGUpe2U/KHUud3JpdGUoZSksby5yZXNvbHZlKHUuYnVmZmVyKSk6by5yZXNvbHZlKG51bGwpfSkpOih1LndyaXRlKG5ldyBVaW50OEFycmF5KGUuZGF0YSkpLG8ucmVzb2x2ZSh1LmJ1ZmZlcikpKX0pKX1jYXRjaChmKXtEZS5tc2UoIiVjIGRhc2hwbGF5ZXI6bXNlIGRlY3J5cHQgYm9keSBlcnJvciIsImNvbG9yOm9yYW5nZSIpLG8ucmVzb2x2ZShudWxsKX1yZXR1cm4gb30sZGVjcnlwdFdpdGhDcnlwdG9Kc1dvcmQ6ZnVuY3Rpb24oZSx0LHIsbixpLGEpe3ZhciBvPW5ldyBPZTt0cnl7dmFyIHU9bmV3IHplLHM9bmV3IFVpbnQ4QXJyYXkoci5kYXRhKTtlLnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSxyKXt2YXIgaT1lLkluaXRpYWxpemF0aW9uVmVjdG9yO2lmKGUuc3Vic2FtcGxlcyYmZS5zdWJzYW1wbGVzLmxlbmd0aCl7dmFyIGE9W10sbz1bXTtlLnN1YnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ9ZS5CeXRlc09mQ2xlYXJEYXRhK2UuQnl0ZXNPZlByb3RlY3RlZERhdGEscj1zLnNsaWNlKDAsdCk7YS5wdXNoKHIuc2xpY2UoMCxlLkJ5dGVzT2ZDbGVhckRhdGEpKSxvLnB1c2goci5zbGljZShlLkJ5dGVzT2ZDbGVhckRhdGEpKSxzPXMuc2xpY2UodCl9KSk7dmFyIGM9bmV3IHplO2Mud3JpdGUuYXBwbHkoYyxvKTt2YXIgZj1GZS5kZWNyeXB0V29yZEFycmF5KGMuYnVmZmVyLG4saSk7YS5mb3JFYWNoKChmdW5jdGlvbihlLHQpe3ZhciByPW9bdF0ubGVuZ3RoLG49Zi5zbGljZSgwLHIpO3Uud3JpdGUoZSksdS53cml0ZShuKSxmPWYuc2xpY2Uocil9KSl9ZWxzZXt2YXIgbD10LnNhbXBsZXNbcl07dS53cml0ZShGZS5kZWNyeXB0V29yZEFycmF5KHMuc2xpY2UoMCxsKSxuLGkpKSxzPXMuc2xpY2UobCl9fSkpO3ZhciBjPXUuYnVmZmVyO28ucmVzb2x2ZShjKX1jYXRjaChmKXtEZS5tc2UoIiVjIGRhc2hwbGF5ZXI6bXNlIGRlY3J5cHRXaXRoQ3J5cHRvSnNXb3JkIGVycm9yIiwiY29sb3I6b3JhbmdlIiksby5yZXNvbHZlKG51bGwpfXJldHVybiBvfSxkZWNyeXB0V2l0aFJhdzpmdW5jdGlvbihlLHQscixuLGksYSl7dmFyIG89bmV3IE9lLHU9bmV3IHplLHM9bmV3IFVpbnQ4QXJyYXkoci5kYXRhKSxjPVtdO3JldHVybiBlLnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSxyKXt2YXIgbj1lLkluaXRpYWxpemF0aW9uVmVjdG9yO2lmKGUuc3Vic2FtcGxlcyYmZS5zdWJzYW1wbGVzLmxlbmd0aCl7dmFyIGk9W10sYT1bXTtlLnN1YnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ9ZS5CeXRlc09mQ2xlYXJEYXRhK2UuQnl0ZXNPZlByb3RlY3RlZERhdGEscj1zLnNsaWNlKDAsdCk7aS5wdXNoKHIuc2xpY2UoMCxlLkJ5dGVzT2ZDbGVhckRhdGEpKSxhLnB1c2goci5zbGljZShlLkJ5dGVzT2ZDbGVhckRhdGEpKSxzPXMuc2xpY2UodCl9KSksYy5wdXNoKHtpdjpuLGVuY29kZUJ1ZmZlcnM6aSxlbmNEYXRhOmF9KX1lbHNle3ZhciBvPXQuc2FtcGxlc1tyXTtjLnB1c2goe2l2Om4sZW5jRGF0YTpbcy5zbGljZSgwLG8pXX0pLHM9cy5zbGljZShvKX19KSksdGhpcy5kZWNyeXB0U2FtcGxlcyhjLHUsbyxhKSxvfSxkZWNyeXB0U2FtcGxlczpmdW5jdGlvbihlLHQscixuKXtpZihlLmxlbmd0aD4wKXt2YXIgaT1lLnNoaWZ0KCksYT1pLmVuY0RhdGEsbz1uZXcgemU7by53cml0ZS5hcHBseShvLGgoYSkpLEZlLmRlY3J5cHRTYW1wbGUoby5idWZmZXIsaS5pdixuKS50aGVuKChmdW5jdGlvbihvKXt2YXIgdT1pLmVuY29kZUJ1ZmZlcnM7aWYodSl7dmFyIHM9bmV3IFVpbnQ4QXJyYXkobyk7dS5mb3JFYWNoKChmdW5jdGlvbihlLHIpe3ZhciBuPWFbcl0ubGVuZ3RoLGk9cy5zbGljZSgwLG4pO3Qud3JpdGUoZSksdC53cml0ZShpKSxzPXMuc2xpY2Uobil9KSl9ZWxzZSB0LndyaXRlKG5ldyBVaW50OEFycmF5KG8pKTtGZS5kZWNyeXB0U2FtcGxlcyhlLHQscixuKX0pLChmdW5jdGlvbigpe3IucmVzb2x2ZShudWxsKSxEZS5tc2UoIiVjIGRhc2hwbGF5ZXI6bXNlIGRlY3J5cHRTYW1wbGVzIGVyciIsImNvbG9yOm9yYW5nZSIpfSkpfWVsc2Ugci5yZXNvbHZlKHQuYnVmZmVyKX0sZGVjcnlwdFNhbXBsZTpmdW5jdGlvbihlLHQscil7dmFyIG49bmV3IFVpbnQ4QXJyYXkodCk7cmV0dXJuIE1lLnN1YnRsZS5kZWNyeXB0KHtuYW1lOiJBRVMtQ1RSIixjb3VudGVyOm4uYnVmZmVyLGxlbmd0aDo2NH0scixlKX0sZGVjcnlwdDpmdW5jdGlvbihlLHQscil7dmFyIG49dy5wYXJzZSh0KSxpPXcucGFyc2UodmUuZm9ybWF0SVYocikpO3JldHVybiBsZS5kZWNyeXB0KHllKGUpLG4se2l2OmksbW9kZTpoZSxwYWRkaW5nOnBlfSkudG9TdHJpbmcoKX0sZGVjcnlwdFdvcmRBcnJheTpmdW5jdGlvbihlLHQscil7dmFyIG49dy5wYXJzZSh0KSxpPXcucGFyc2UodmUuZm9ybWF0SVYocikpLGE9ZC5jcmVhdGUobmV3IFVpbnQ4QXJyYXkoZSkpLG89bGUuZGVjcnlwdChqLmNyZWF0ZSh7Y2lwaGVydGV4dDphfSksbix7aXY6aSxtb2RlOmhlLHBhZGRpbmc6cGV9KTtyZXR1cm4gRmUud29yZEFycmF5VG9VaW50OEFycmF5KG8pfSx3b3JkQXJyYXlUb1VpbnQ4QXJyYXk6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PWUuc2lnQnl0ZXMscj1lLndvcmRzLG49bmV3IFVpbnQ4QXJyYXkodCksaT0wLGE9MDtpIT09dDspe3ZhciBvPXJbYSsrXTtpZihuW2krK109KDQyNzgxOTAwODAmbyk+Pj4yNCxpPT09dClicmVhaztpZihuW2krK109KDE2NzExNjgwJm8pPj4+MTYsaT09PXQpYnJlYWs7aWYobltpKytdPSg2NTI4MCZvKT4+PjgsaT09PXQpYnJlYWs7bltpKytdPTI1NSZvfXJldHVybiBufX07b25tZXNzYWdlPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXM7aWYoImRlY3J5cHRCb2R5Ij09PWUuZGF0YS5tZXRob2Qpe3ZhciByPWUuZGF0YS5hcmdzO0ZlLmRlY3J5cHRCb2R5KHIucGFyc2VkLHIua2V5VmFsdWUsci5pc1ZpZGVvLHIuaWQsci5hZXNrZXksci51c2VSYXcpLnRoZW4oKGZ1bmN0aW9uKHIpe3QucG9zdE1lc3NhZ2Uoe21ldGhvZDoiZGVjcnlwdEJvZHkiLGlkOmUuZGF0YS5pZCxhcmdzOntkYXRhOnJ9fSl9KSl9ZWxzZSBpZigiZGVjcnlwdEhlYWRlciI9PT1lLmRhdGEubWV0aG9kKXt2YXIgbj1GZS5kZWNyeXB0SGVhZGVyKGUuZGF0YS5hcmdzLnBhcnNlZCxlLmRhdGEuY29kZWNzVHlwZSk7dGhpcy5wb3N0TWVzc2FnZSh7bWV0aG9kOiJkZWNyeXB0SGVhZGVyIixpZDplLmRhdGEuaWQsYXJnczp7ZGF0YTpuLmJ1ZmZlcix2aWQ6bi52aWR9fSl9ZWxzZSJsb2ciPT09ZS5kYXRhLm1ldGhvZCYmZS5kYXRhLnZhbHVlJiZjb25zb2xlLmxvZyYmKERlLm1zZT1jb25zb2xlLmxvZyl9fSgpOwo=",blob="undefined"!=typeof window&&window.Blob&&new Blob([atob(encodedJs)],{type:"text/javascript;charset=utf-8"});function WorkerWrapper(){var e=blob&&(window.URL||window.webkitURL).createObjectURL(blob);try{return e?new Worker(e,{}):new Worker("data:application/javascript;base64,"+encodedJs,{type:"module"})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}var workerCount=3,Crypto$2=function(){function e(){_classCallCheck$2(this,e),EventEmitter(this),this.workerList=[],this.bodyId=0,this.isSwitchHeader=!1,this.workerIndex=0,this.init(),this.headerId=0,this.crypto=window.crypto||window.msCrypto,this.aeskey=null}return _createClass$3(e,[{key:"init",value:function(){for(var e=this,t=0;t<workerCount;t++){var r=new WorkerWrapper;r.onmessage=function(t){e.emit(t.data.method,t.data)},r.postMessage({method:"log",value:LOGOPEN}),this.workerList.push(r)}}},{key:"importKeys",value:function(e){var t=this,r=new ProxyPromise$1,n=util$1.fromHex(e);return this.crypto.subtle.importKey("raw",n.buffer,{name:"AES-CTR",length:e.length},!1,["decrypt"]).then((function(e){t.aeskey=e,r.resolve()})),r}},{key:"updateHeaderId",value:function(){var e=this.bodyId+1;this.headerId=e,this.bodyId=e}},{key:"destroy",value:function(){this.workerList.forEach((function(e){e.terminate()})),this.workerList=[]}},{key:"decryptHeader",value:function(e,t){var r=this;return this.updateHeaderId(),new Promise((function(n){var i=new Parse(e),a=Math.floor(1e3*Math.random());r.workerList[0]&&r.workerList[0].postMessage({method:"decryptHeader",id:a,codecsType:t,args:{buf:e,parsed:i}});r.on("decryptHeader",(function e(t){t.id===a&&(r.off("decryptHeader",e),n({data:t.args.data,vid:t.args.vid}))}))}))}},{key:"decryptBody",value:function(e,t,r,n){var i=this,a=new Parse(e),o=i.bodyId+1;return i.bodyId=o,new Promise((function(e){i.on("decryptBody",(function t(r){r.id===o&&(i.off("decryptBody",t),e({data:r.args.data,id:o,headerId:i.headerId}))})),i.workerList[i.workerIndex]&&i.workerList[i.workerIndex].postMessage({method:"decryptBody",id:o,args:{parsed:a,keyValue:t,isVideo:r,id:i.workerIndex,aeskey:i.aeskey,useRaw:n}}),i.workerIndex=i.workerIndex+1,i.workerIndex>=workerCount&&(i.workerIndex=0)}))}}]),e}();function aesDec(e,t){return"string"==typeof t&&(t=JSON.parse(t)),derive(e).then((function(e){return new Promise((function(r,n){window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(t.iv),tagLength:128},e,t.encrypted).then((function(e){return new TextDecoder("utf-8").decode(e)})).then(r).catch((function(e){"OperationError"===String(e)&&(e="Wrong Password."),n(e)}))})).catch((function(e){throw e}))}))}function derive(e){return window.crypto.subtle.importKey("raw",e,"AES-GCM",!0,["encrypt","decrypt"])}var aes4js={decrypt:aesDec},sparkMd5={exports:{}};!function(e,t){e.exports=function(e){var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(e,t){var r=e[0],n=e[1],i=e[2],a=e[3];n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&i|~n&a)+t[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+t[1]-389564586|0)<<12|a>>>20)+r|0)&r|~a&n)+t[2]+606105819|0)<<17|i>>>15)+a|0)&a|~i&r)+t[3]-1044525330|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&i|~n&a)+t[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+t[5]+1200080426|0)<<12|a>>>20)+r|0)&r|~a&n)+t[6]-1473231341|0)<<17|i>>>15)+a|0)&a|~i&r)+t[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&i|~n&a)+t[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+t[9]-1958414417|0)<<12|a>>>20)+r|0)&r|~a&n)+t[10]-42063|0)<<17|i>>>15)+a|0)&a|~i&r)+t[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&i|~n&a)+t[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+t[13]-40341101|0)<<12|a>>>20)+r|0)&r|~a&n)+t[14]-1502002290|0)<<17|i>>>15)+a|0)&a|~i&r)+t[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&a|i&~a)+t[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+t[6]-1069501632|0)<<9|a>>>23)+r|0)&n|r&~n)+t[11]+643717713|0)<<14|i>>>18)+a|0)&r|a&~r)+t[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&a|i&~a)+t[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+t[10]+38016083|0)<<9|a>>>23)+r|0)&n|r&~n)+t[15]-660478335|0)<<14|i>>>18)+a|0)&r|a&~r)+t[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&a|i&~a)+t[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+t[14]-1019803690|0)<<9|a>>>23)+r|0)&n|r&~n)+t[3]-187363961|0)<<14|i>>>18)+a|0)&r|a&~r)+t[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&a|i&~a)+t[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+t[2]-51403784|0)<<9|a>>>23)+r|0)&n|r&~n)+t[7]+1735328473|0)<<14|i>>>18)+a|0)&r|a&~r)+t[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n^i^a)+t[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+t[8]-2022574463|0)<<11|a>>>21)+r|0)^r^n)+t[11]+1839030562|0)<<16|i>>>16)+a|0)^a^r)+t[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n^i^a)+t[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+t[4]+1272893353|0)<<11|a>>>21)+r|0)^r^n)+t[7]-155497632|0)<<16|i>>>16)+a|0)^a^r)+t[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n^i^a)+t[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+t[0]-358537222|0)<<11|a>>>21)+r|0)^r^n)+t[3]-722521979|0)<<16|i>>>16)+a|0)^a^r)+t[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n^i^a)+t[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+t[12]-421815835|0)<<11|a>>>21)+r|0)^r^n)+t[15]+530742520|0)<<16|i>>>16)+a|0)^a^r)+t[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((a=((a+=(n^((r=((r+=(i^(n|~a))+t[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+t[7]+1126891415|0)<<10|a>>>22)+r|0)^((i=((i+=(r^(a|~n))+t[14]-1416354905|0)<<15|i>>>17)+a|0)|~r))+t[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((a=((a+=(n^((r=((r+=(i^(n|~a))+t[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+t[3]-1894986606|0)<<10|a>>>22)+r|0)^((i=((i+=(r^(a|~n))+t[10]-1051523|0)<<15|i>>>17)+a|0)|~r))+t[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((a=((a+=(n^((r=((r+=(i^(n|~a))+t[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+t[15]-30611744|0)<<10|a>>>22)+r|0)^((i=((i+=(r^(a|~n))+t[6]-1560198380|0)<<15|i>>>17)+a|0)|~r))+t[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((a=((a+=(n^((r=((r+=(i^(n|~a))+t[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+t[11]-1120210379|0)<<10|a>>>22)+r|0)^((i=((i+=(r^(a|~n))+t[2]+718787259|0)<<15|i>>>17)+a|0)|~r))+t[9]-343485551|0)<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=a+e[3]|0}function n(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function i(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function a(e){var t,i,a,o,s,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)r(l,n(e.substring(t-64,t)));for(i=(e=e.substring(t-64)).length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<i;t+=1)a[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(a[t>>2]|=128<<(t%4<<3),t>55)for(r(l,a),t=0;t<16;t+=1)a[t]=0;return o=(o=8*c).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(o[2],16),u=parseInt(o[1],16)||0,a[14]=s,a[15]=u,r(l,a),l}function o(e){var t,n,a,o,s,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)r(l,i(e.subarray(t-64,t)));for(n=(e=t-64<c?e.subarray(t-64):new Uint8Array(0)).length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)a[t>>2]|=e[t]<<(t%4<<3);if(a[t>>2]|=128<<(t%4<<3),t>55)for(r(l,a),t=0;t<16;t+=1)a[t]=0;return o=(o=8*c).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(o[2],16),u=parseInt(o[1],16)||0,a[14]=s,a[15]=u,r(l,a),l}function s(e){var r,n="";for(r=0;r<4;r+=1)n+=t[e>>8*r+4&15]+t[e>>8*r&15];return n}function u(e){var t;for(t=0;t<e.length;t+=1)e[t]=s(e[t]);return e.join("")}function c(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function l(e,t){var r,n=e.length,i=new ArrayBuffer(n),a=new Uint8Array(i);for(r=0;r<n;r+=1)a[r]=e.charCodeAt(r);return t?a:i}function d(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function h(e,t,r){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e)),n.set(new Uint8Array(t),e.byteLength),r?n:n.buffer}function f(e){var t,r=[],n=e.length;for(t=0;t<n-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function p(){this.reset()}return u(a("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,n){var i,a,o,s,u=this.byteLength,c=t(r,u),l=u;return n!==e&&(l=t(n,u)),c>l?new ArrayBuffer(0):(i=l-c,a=new ArrayBuffer(i),o=new Uint8Array(a),s=new Uint8Array(this,c,i),o.set(s),a)}}(),p.prototype.append=function(e){return this.appendBinary(c(e)),this},p.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,i=this._buff.length;for(t=64;t<=i;t+=64)r(this._hash,n(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},p.prototype.end=function(e){var t,r,n=this._buff,i=n.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)a[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(a,i),r=u(this._hash),e&&(r=f(r)),this.reset(),r},p.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},p.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},p.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},p.prototype._finish=function(e,t){var n,i,a,o=t;if(e[o>>2]|=128<<(o%4<<3),o>55)for(r(this._hash,e),o=0;o<16;o+=1)e[o]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),a=parseInt(n[1],16)||0,e[14]=i,e[15]=a,r(this._hash,e)},p.hash=function(e,t){return p.hashBinary(c(e),t)},p.hashBinary=function(e,t){var r=u(a(e));return t?f(r):r},p.ArrayBuffer=function(){this.reset()},p.ArrayBuffer.prototype.append=function(e){var t,n=h(this._buff.buffer,e,!0),a=n.length;for(this._length+=e.byteLength,t=64;t<=a;t+=64)r(this._hash,i(n.subarray(t-64,t)));return this._buff=t-64<a?new Uint8Array(n.buffer.slice(t-64)):new Uint8Array(0),this},p.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,i=n.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)a[t>>2]|=n[t]<<(t%4<<3);return this._finish(a,i),r=u(this._hash),e&&(r=f(r)),this.reset(),r},p.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.ArrayBuffer.prototype.getState=function(){var e=p.prototype.getState.call(this);return e.buff=d(e.buff),e},p.ArrayBuffer.prototype.setState=function(e){return e.buff=l(e.buff,!0),p.prototype.setState.call(this,e)},p.ArrayBuffer.prototype.destroy=p.prototype.destroy,p.ArrayBuffer.prototype._finish=p.prototype._finish,p.ArrayBuffer.hash=function(e,t){var r=u(o(new Uint8Array(e)));return t?f(r):r},p}()}(sparkMd5);var SparkMD5=sparkMd5.exports,AwManager$1=function(){function e(){_classCallCheck$2(this,e)}return _createClass$3(e,[{key:"init",value:function(){var e=this;return new Promise((function(t){e.module={onRuntimeInitialized:function(){t()}},aw$2(e.module)}))}},{key:"openBox",value:function(e){var t=window.atob(e),r=util$1.str2hex(t),n=this.module._malloc(Number(r.length));this.module.HEAP8.set(r,n);var i=this.module._openBox(Number(n),r.length),a=this.module.UTF8ToString(i);return this.module._free(n),a}},{key:"transformWithUnionInfo",value:function(e,t){return new Promise((function(r,n){var i=util$1.StringToArrayBuffer(SparkMD5.hash(t)),a={encrypted:util$1.Base64ToHex(e,!0),iv:TRANSFORM_IV};aes4js.decrypt(i,a).then((function(e){r(e)}))}))}}]),e}(),$$e=_export,repeat=stringRepeat;$$e({target:"String",proto:!0},{repeat:repeat});var GapJump$1=function(){function e(t,r){_classCallCheck$2(this,e),this.player=t,this.mediaElem=t.video,this.config=r,this.timer=new IntervalTimer$1$1,this.prevReadyState=this.mediaElem.readyState,this.didFireLargeGap=!1,this.seekingEventReceived=!1,this.segmentAppended=!1,this.onWaitFunc=this._onWaiting.bind(this),this.onPlayFunc=this._onPlay.bind(this),this.isSafari=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),!1!==this.config.useGapJump&&this._start(),this.hasPlayed=!1}return _createClass$3(e,[{key:"_onWaiting",value:function(){this.onGapJump()}},{key:"_onPlay",value:function(){this.hasPlayed=!0}},{key:"_start",value:function(){var e=this;this.mediaElem.addEventListener("waiting",this.onWaitFunc),this.mediaElem.addEventListener("play",this.onPlayFunc),this.timer.repeat((function(){e.onGapJump()}),250)}},{key:"onSegmentAppend",value:function(){this.segmentAppended=!0,this.onGapJump()}},{key:"onSeeking",value:function(){this.seekingEventReceived=!0,this.segmentAppended=!1,this.didFireLargeGap=!1}},{key:"onGapJump",value:function(){if(this.mediaElem.readyState!==HTMLMediaElement.HAVE_NOTHING){if(this.mediaElem.seeking){if(!this.seekingEventReceived)return}else this.seekingEventReceived=!1;if(!this.mediaElem.paused||0===this.mediaElem.currentTime||!this.hasPlayed){this.mediaElem.readyState!==this.prevReadyState&&(this.didFireLargeGap=!1,this.prevReadyState=this.mediaElem.readyState);var t=this.mediaElem.buffered,r=this.config.smallGapLimit||.5,n=this.config.gapDetectionThreshold||.1,i=this.mediaElem.currentTime,a=this._getIndex(t,i,n);if(null!==a&&(0!==a||this.segmentAppended)){var o=t.start(a);if(!(o>this.mediaElem.duration)){var s=o-i,u=s<=r;s<e.BROWSER_GAP_TOLERANCE||u&&(this.mediaElem.currentTime=this.isSafari?o+.1:o,debug$2.gap("gapJump gapIndex",a,"isGapSamll",u,"jumpLargeGap",!1,"currentTime",this.mediaElem.currentTime),.08!==o&&this.player&&this.player.emit("log",{type:"oneevent",end_type:"gap",vid:this.config.vid,ext:{video_postion:Math.floor(1e3*o)}}))}}}}}},{key:"_getIndex",value:function(e,t,r){if(!e||!e.length)return null;if(1===e.length&&e.end(0)-e.start(0)<1e-6)return null;for(var n=this._getBuffered(e),i=null,a=0;a<n.length;a++){if(n[a].start>t&&(0===a||n[a-1].end-t<=r)){i=a;break}}return i}},{key:"_getBuffered",value:function(e){if(!e)return[];for(var t=[],r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}},{key:"destroy",value:function(){this.mediaElem.removeEventListener("waiting",this.onWaitFunc),this.mediaElem.removeEventListener("play",this.onPlayFunc),this.timer.clear(),this.timer=null}}]),e}();GapJump$1.BROWSER_GAP_TOLERANCE=.001;var PRELOAD_NEXT$2=PRELOAD_NEXT$3,CHANGE_STATES$1=CHANGE_STATES$2,__DASH__=function(){function e(t){var r=this;_classCallCheck$2(this,e),_defineProperty$3(this,"startProgressTimer",(function(){r._pluginInst.info({msg:"startProgressTimer"});var e=r,t=r.player,n=r.config;if(t&&e&&e.isDashCanUse&&e.dash.mse){var i=0;e.dash.mse.progressTimer=new IntervalTimer$1$1,e.dash.mse.progressTimer.repeat((function(){e&&e.isDashCanUse&&e.dash.mse&&e.dash.mse.progressTimer&&(e.handleUrlExpire(),++i*(n.progressTimer||DEFAULT_PROGRESS_TIMER)/1e3>DEFAULT_CHECK_BUFFER_TIME&&(e.clearBuffer&&e.clearBuffer(),i=0),n.disableBufferBreakCheck||(t.currentTime-(e.lastCurrentTime||0)>.1||t.paused?1!==e.dashBufferBreak&&2!==e.dashBufferBreak||(debug$2.log("è§†é¢‘æ²¡æœ‰å¡æ­»ï¼Œé‡ç½®å¡æ­»æ ‡è®°"),e.dashBufferBreak=0,clearTimeout(e.dashBufferBreakTimer),e.dashBufferBreakTimer=null):e.dashBufferBreak||(e.dashBufferBreak=1,debug$2.log("å¡æ­»è®¡æ—¶å¼€å§‹ï¼æŒç»­".concat(DASH_BUFFER_BREAK,"æ¯«ç§’åˆ™ç¡®è®¤å¡æ­»")),e.dashBufferBreakTimer=setTimeout((function(){1===e.dashBufferBreak&&(e.dashBufferBreak=2,debug$2.log("ç¡®è®¤å¡æ­»ï¼ï¼ï¼"),e.dash.emit("error",new Errors(Errors.BUFFERBREAK,Errors.BUFFERBREAK_ERROR,{line:1e3,handle:"[DASH] buffer break",msg:"buffer break"}))),e.dashBufferBreakTimer=null}),DASH_BUFFER_BREAK)),e.lastCurrentTime=t.currentTime),e.loadData(void 0),e.isEnded())}),n.progressTimer||DEFAULT_PROGRESS_TIMER)}})),_defineProperty$3(this,"_onAutoDescChange",(function(e){var t=e.definition,n=e.reset,i=e.fps,a=e.item;r.updateAutoDefiDesc(t,n,i,a)})),this._pluginInst=t.pluginInst;var n=this._pluginInst,i=n.player,a=n.config;this._minDuration=1/0,this.player=i,this.config=a,this.startTimestamp=(new Date).getTime(),this.lastDefiIdx=void 0,this.__isDashCanUse=!1,this.preloadBufferThreshold=this.config.preloadBufferThreshold||.5,this.abrInstance=null,this.definitions=[];var o=this.config.autoBitrateOpts||{};this.isPlayAutoDefi=ABR.getIsPlayAutoDefi(o),this.isOpenAutoDefi=!!o.isOpenAutoDefi,this.isCurrentAutoDefi=this.isOpenAutoDefi&&this.isPlayAutoDefi,this.bitrateMap={},this.curBitrate=0,this.defiIdMap={},this.definition2item={},this.bandwidth2item={},(this.preloadBufferThreshold<=0||this.preloadBufferThreshold>1)&&(this.preloadBufferThreshold=.5),this.curVideoInitSegmentIdx=-1,this.getPlayInfoTimestamp=this.startTimestamp/1e3,a.dashOpts.dynamic_video.dynamic_video_list&&a.dashOpts.dynamic_video.dynamic_video_list.length>0?this.urlExpireTimestamp=a.dashOpts.dynamic_video.dynamic_video_list[0].url_expire||0:a.dashOpts.dynamic_video.dynamic_audio_list&&a.dashOpts.dynamic_video.dynamic_audio_list.length>0&&(this.urlExpireTimestamp=a.dashOpts.dynamic_video.dynamic_audio_list[0].url_expire||0),this.gapJumpInst=new GapJump$1(i,a),util$1.on(i,"addVideoBufferEnd",(function(){r.gapJumpInst.onSegmentAppend()}),"dashDestroy")}var t,r,n;return _createClass$3(e,[{key:"initDash",value:function(e){var t=this;this.dash=e,this.bindPlayInterfaceEvent();var r=this.config;r.dashOpts.dynamic_video.dynamic_video_list.length>0&&(this.initAbr(),r.dashOpts.dynamic_video.dynamic_video_list.sort((function(e,t){return t.vheight-e.vheight})),r.dashOpts.dynamic_video.dynamic_video_list.forEach((function(e,n){e.definition===r.defaultDefinition&&(t.dash.selectedIdx=n)})),this.dashVideoEncrypted=r.dashOpts.dynamic_video.dynamic_video_list.some((function(e){return!!e.kid}))),r.dashOpts.dynamic_video.dynamic_audio_list.length>0&&(this.dashAudioEncrypted=r.dashOpts.dynamic_video.dynamic_audio_list.some((function(e){return!!e.kid})))}},{key:"isDashCanUse",get:function(){return this.__isDashCanUse},set:function(e){this.__isDashCanUse=e}},{key:"bindPlayInterfaceEvent",value:function(){var e=this._pluginInst,t=e.player,r=e.config;util$1.on(t,"DRM_ERROR",(function(){t.emit("playInterfaceInfo",r.dashOpts||{})}),"dashDestroy");util$1.on(t,"NO_MEDIALIST",(function(){t.emit("playInterfaceInfo",r.dashOpts||{})}),"dashDestroy")}},{key:"isEnded",value:function(){var e=this.dash,t=this.player,r=this.mse,n=this.config;if("vod"===e.type)if(t.ended)debug$2.log("player.ended === true"),"safari"===sniffer$1.browser&&(t.pause(),t.emit("ended"));else{var i=n.duration||t.duration||e.mpd.duration;if(t.duration&&(i=Math.min(i,t.duration)),e.mpd.duration&&(i=Math.min(i,e.mpd.duration)),i-this._minDuration<10&&(i=Math.min(i,this._minDuration)),i>0&&i-t.currentTime<DEFAULT_END){var a=this._findRangeForPlaybackTime(t.currentTime)||{start:0,end:0};debug$2.log("range",a,"current",t.currentTime,"duration",i);var o=Math.min(a.end,t.duration),s=t.currentTime-o>=0&&a.end>0,u=o-t.currentTime<DEFAULT_END&&a.end>0;(s||u)&&(debug$2.log("isEnded execute, isOver",s,"isClosed",u),r.endOfStream(),this.clearProgressTimer())}}}},{key:"dashDestroy",value:function(){var e=this.player,t=this.dash;for(var r in t&&t.mse&&t.mse.destroy(),t&&t.eme&&(t.eme.emit("destroy"),t.eme.destroy()),t&&e.errorHandler&&(t.abortLoadingTasks(),t.emit("destroy")),t&&t.mpd&&t.mpd.timer&&(clearTimeout(t.mpd.timer),t.mpd.timer=null),this.crypto&&this.crypto.destroy(),t&&t.destroy(),this.clearCheckCanplayTimer(),this.clearProgressTimer(),this.destroyAbr(),this.gapJumpInst&&this.gapJumpInst.destroy(),e&&(e.__dash__=null,this._pluginInst.unloadVideo(),"function"==typeof e.video.setMediaKeys&&e.video.setMediaKeys(null)),t)delete t[r];for(var n in this)delete this[n]}},{key:"bindComEvent",value:function(){var e=this;this._lastSeekTime=null;var t=this.player,r=this.config;util$1.on(t,"error",e.clearProgressTimer.bind(e),"dashDestroy"),util$1.on(t,"ended",e.clearProgressTimer.bind(e),"dashDestroy");util$1.on(t,"timeupdate",(function(){e.isDashCanUse&&r.dashOpts&&e.mse&&e.isEnded()}),"dashDestroy");var n=function(){var n=_asyncToGenerator$3(_regeneratorRuntime$1().mark((function n(){var i,a,o,s,u;return _regeneratorRuntime$1().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(debug$2.log("dash onSeeking"),e.isDashCanUse&&r.dashOpts){n.next=3;break}return n.abrupt("return");case 3:if(!t.ended){n.next=7;break}return"function"==typeof t.replayFunc&&t.replayFunc(),n.abrupt("return");case 7:if(i=t.getBufferedRange(t.buffered)[1],!(a=0===i)||e.switching){n.next=14;break}return debug$2.log("dash cancel loading task"),n.next=13,e.dash.abortLoadingTasks();case 13:e.mse.abort(CONTENT_TYPES$1.VIDEO);case 14:e.mse.isFull?a?e.clearBufferByTime(0,t.duration):e.clearBuffer(!0):a||e.clearBufferByTime(i,t.duration),o=r.useDurationBackoff||!1,s=Date.now()/1e3,u=t.duration-t.currentTime<1,o&&u&&(!this._lastSeekTime||this._lastSeekTime<s-1)&&(this._lastSeekTime=s,t.currentTime=t.duration-1),e.gapJumpInst&&e.gapJumpInst.onSeeking();case 20:case"end":return n.stop()}}),n,this)})));return function(){return n.apply(this,arguments)}}();util$1.on(t,"seeking",n,"dashDestroy");util$1.on(t,"seeked",(function(){debug$2.log("dash onSeeked"),e.isEnded()}),"dashDestroy"),util$1.on(t,"dashDestroy",e.dashDestroy.bind(this))}},{key:"destroy",value:function(){this.player.emit("dashDestroy")}},{key:"getMetaData",value:function(){var e=this,t={};return["video","audio"].forEach((function(r){var n=e.dash.mpd.mediaList[r],i=n[n.selectedIdx];t[r]={bandwidth:i.bandwidth,mimeType:i.mimeType,codecs:i.codecs,definition:i.definition,width:i.width,height:i.height,mediaDuration:i.mediaDuration,timescale:i.timescale}})),t}},{key:"_findRangeForPlaybackTime",value:function(e){var t,r=this.player,n=this.config;if(n.useBuffered2){var i=n.maxHoleDuration;if(!(t=r.buffered2))return;for(var a=0;a<t.length;a++){var o=t.start(a),s=t.end(a);if(e+i>=o&&e<s)return{start:o,end:s}}}else{if(!(t=r.buffered))return;for(var u=0;u<t.length;u++)if(util$1.round(t.start(u))<=util$1.round(e)&&util$1.round(t.end(u))>=util$1.round(e))return{start:util$1.round(t.start(u)),end:util$1.round(t.end(u)),rawStart:t.start(u),rawEnd:t.end(u)}}}},{key:"loadData",value:function(e){var t=this,r=this.player,n=this.config;if(!t.switching&&t.dash){var i,a=n.maxBufferLength||n.preloadTime||DEFAULT_PRELOAD_TIME,o=t.dash.mpd.mediaList.video;if(o&&o.length>0&&o[o.selectedIdx]){var s=o[o.selectedIdx].bandwidth;s<6e6&&(a*=2),i=o[o.selectedIdx].definition||this.bandwidth2item[s].definition}if(n.dynamicPreloadTimeOpts&&i){var u=n.dynamicPreloadTimeOpts[i];u&&(a=u)}t.preloadTime!==a&&(t.preloadTime=a,debug$2.log("maxCacheTimeAudio change",a),r.emit(ABR_EVENTS.MAX_BUFFER_CHANGE,{videoCacheTime:a,audioCacheTime:a})),e||(e=r.currentTime);var c=this._findRangeForPlaybackTime(e),l=r.duration+100;if(c&&c.end&&!t.isCurrentInAbr()){var d=t.dash.mpd.mediaList;["video","audio"].forEach((function(t){if(d[t].length<1)return!0;for(var r=d[t][d[t].selectedIdx].mediaSegments,n=0;n<r.length;n++)if(!(r[n].end<=e||r[n].start>=c.end||r[n].downloaded)&&l>r[n].start){l=r[n].start;break}}))}var h=l<=r.duration?l:c&&Math.ceil(Math.max(c.end,c.rawEnd))||Math.floor(e),f=r.duration<n.minBufferLength,p=r.currentTime+(f?r.duration/3:n.minBufferLength);n.preloadTime&&(p=r.currentTime+n.preloadTime*n.preloadBufferThreshold);var g=!1;if(this._pluginInst.preloadManager){var y=this._pluginInst.preloadManager;g=y._preloadDataList.length>0||null!==y._currentPreloadInst}h>p&&g&&r.emit(PRELOAD_NEXT$2);var m=n.preloadCancelTime;h<e+m&&g&&r.emit("PRELOAD_CANCEL"),h>e+a||t.dash.seek(h,r.currentTime)}}},{key:"startCheckCanplayTimer",value:function(){var e=this,t=this.player,r=this.config;if(t&&e&&!r.disableCanplayCheck){e.checkCanplayTimer=new IntervalTimer$1$1,e.checkCanplayTimer.repeat((function(){t&&e&&e.isDashCanUse&&e.checkCanplayTimer&&t.errorHandler&&(t.enterIsHide?(debug$2.log("è§†é¢‘å·²èµ·æ’­ï¼Œé‡ç½®æ ‡è®°"),e.dashNoCanplay=0,e.clearCheckCanplayTimer()):e.dashNoCanplay||"visible"!==document.visibilityState||(e.dashNoCanplay=1,debug$2.log("æœªèµ·æ’­è®¡æ—¶å¼€å§‹ï¼æŒç»­".concat(DASH_NO_INITSEGMENT,"æ¯«ç§’æ²¡æœ‰èŽ·å–åˆ°initåˆ†ç‰‡åˆ™ç¡®è®¤æ²¡æœ‰èµ·æ’­")),e.dashNoCanplayTimer=setTimeout((function(){e.dashNoCanplayTimer=null,1===e.dashNoCanplay&&!1===t.enterIsHide&&(t.dashState!==START_PLAY?(e.dashNoCanplay=2,debug$2.log("ç¡®è®¤æœªèŽ·å–åˆ°initåˆ†ç‰‡ï¼Œæ²¡æœ‰èµ·æ’­ï¼ï¼ï¼"),e.clearCheckCanplayTimer(),t.errorHandler(new Errors(Errors.CANPLAY,Errors.NO_CANPLAY_ERROR,{line:1021,handle:"[DASH] start play",msg:"start play no canplay"}))):r.disableDashNoCanplayCheck||(debug$2.log("æœªèµ·æ’­è®¡æ—¶å¼€å§‹ï¼æŒç»­".concat(DASH_NO_CANPLAY-DASH_NO_INITSEGMENT,"æ¯«ç§’åˆ™ç¡®è®¤æ²¡æœ‰èµ·æ’­")),e.dashNoCanplayTimer=setTimeout((function(){e.dashNoCanplayTimer=null,1===e.dashNoCanplay&&!1===t.enterIsHide&&(e.dashNoCanplay=2,debug$2.log("ç¡®è®¤æ²¡æœ‰èµ·æ’­ï¼ï¼ï¼"),e.clearCheckCanplayTimer(),t.errorHandler(new Errors(Errors.CANPLAY,Errors.NO_CANPLAY_ERROR,{line:1021,handle:"[DASH] start play",msg:"start play no canplay"})))}),DASH_NO_CANPLAY-DASH_NO_INITSEGMENT)))}),DASH_NO_INITSEGMENT)))}),r.progressTimer||DEFAULT_PROGRESS_TIMER)}}},{key:"clearCheckCanplayTimer",value:function(){var e=this;e&&(e&&e.checkCanplayTimer&&(e.checkCanplayTimer.clear(),e.checkCanplayTimer=null),e.dashNoCanplayTimer&&(clearTimeout(e.dashNoCanplayTimer),e.dashNoCanplayTimer=null,e.dashNoCanplay=void 0))}},{key:"handleUrlExpire",value:function(){this._pluginInst.handleUrlExpire(this)}},{key:"clearBuffer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this,r=this.player;if(t.isDashCanUse&&t.mse){debug$2.log("clearBuffer");var n=r.currentTime,i=this._findClosetGop(n,!1);if(i&&t.clearBufferByTime(0,i),e){var a=this._findClosetGop(n,!0);t.clearBufferByTime(a,r.duration)}}}},{key:"_findClosetGop",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=this.dash.mpd.mediaList.video,i=n[n.selectedIdx].mediaSegments;if(t){for(var a=0,o=0;o<i.length;o++)if(i[o].start>e&&++a>r)return i[o].start}else for(var s=0,u=i.length-1;u>-1;u--)if(i[u].end<e&&++s>r)return i[u].end}},{key:"clearBufferByTime",value:function(e,t){var r=this;debug$2.log("clearBufferByTime start: ".concat(e," end: ").concat(t)),r.dash.mpd.mediaList.video.length>0&&r.mse.removeBuffer(CONTENT_TYPES$1.VIDEO,e,t).catch((function(){})),r.dash.mpd.mediaList.audio.length>0&&r.mse.removeBuffer(CONTENT_TYPES$1.AUDIO,e,t).catch((function(){})),r.dash.mpd.clearBuffer(e,t)}},{key:"clearProgressTimer",value:function(){var e=this;e&&(e.isDashCanUse&&e.dash.mse&&e.dash.mse.progressTimer&&(e.dash.mse.progressTimer.clear(),e.dash.mse.progressTimer=null),e.dashBufferBreakTimer&&(clearTimeout(e.dashBufferBreakTimer),e.dashBufferBreakTimer=null,e.dashBufferBreak=void 0))}},{key:"emitMenuResolutionChange",value:function(){var e=this.player;try{var t=this.dash.mpd.mediaList.video;if(t){var r=t[t.selectedIdx],n={width:r.width,height:r.height};e.emit("RESOLUTION_UPDATE",n)}else e.emit("RESOLUTION_UPDATE")}catch(error){e.emit("RESOLUTION_UPDATE")}}},{key:"updateDashType",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=proxyLocalStorage$1.getItem(URL_DASH_TAG),n=DASH_TYPE;e=t||r===n.BACK?n.MAIN:n.BACK,proxyLocalStorage$1.setItem(URL_DASH_TAG,e)}},{key:"changeMainBackUrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:CHANGE_STATES$1.INIT,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t&&this._pluginInst){var r=this._pluginInst.config,n=proxyLocalStorage$1.getItem(URL_DASH_TAG),i=!1,a=DASH_TYPE;if((e===CHANGE_STATES$1.INIT&&n===a.BACK||e===CHANGE_STATES$1.ERR)&&(i=!0),debug$2.log("curDashType",n,"changeState",e,"needChange",i),i){var o=r.dashOpts.dynamic_video.main_url,s=r.dashOpts.dynamic_video.backup_url_1;r.dashOpts.dynamic_video.main_url=s,r.dashOpts.dynamic_video.backup_url_1=o,util$1.exchangeListUrl(r.dashOpts.dynamic_video.dynamic_video_list),util$1.exchangeListUrl(r.dashOpts.dynamic_video.dynamic_audio_list)}var u=r.dashOpts.dynamic_video.main_url;return this._checkUrlRange(u),r}}},{key:"_checkUrlRange",value:function(e){var t=this._pluginInst.config,r=t.url_range_domains||[],n=util$1.validateUrlRange(r,e);t.useUrlRange=n}},{key:"updateAutoDefiDesc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=this.player,a=this.config,o=a.autoBitrateOpts||{},s=o.autoDefiText||"auto";i.emit("ABR_AUTO_DESC_CHANGE",s,t?void 0:e,r,n),t||this._pluginInst.setCurrentDefitionInfos("è‡ªåŠ¨ ".concat(e),n)}},{key:"_startLoadInitSegment",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new ProxyPromise$1,i=this,a=this.dash,o=this.config,s=a.mpd.mediaList.video,u=s.selectedIdx;return s.every((function(a,c){if(a.id===e){t.abrInstance&&t.abrInstance.updateBitrate(i.defiIdMap[e].bitrate),r&&(t.lastDefiIdx=e),u=c,i.selectedIdx=c,o.defaultDefinition=s[i.selectedIdx].definition,i.switching=!0;var l=s[u].wrapperData;return l?((i.dashVideoEncrypted||i.dashAudioEncrypted)&&!1===o.useEME&&i.crypto&&i.crypto.updateHeaderId(),n.resolve(l)):i._makeInitSegemntRequestWithRetry("video",u).then((function(e){n.resolve(e)})).catch((function(e){debug$2.log("_makeInitSegemntRequestWithRetry",e)})),!1}return!0})),n}},{key:"abrSwitchURL",value:function(e){var t=this;this._pluginInst.info({msg:"abr switch",data:e});var r=this.dash,n=this.player,i=this.config;e=e.split("/")[e.split("/").length-1],this._startLoadInitSegment(e).then(function(){var e=_asyncToGenerator$3(_regeneratorRuntime$1().mark((function e(a){var o,s,u,c,l;return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.mpd.mediaList.video,e.next=3,t._switch(a.newIdx);case 3:if(s=e.sent,u=n.getBufferedRange(i.useBuffered2?n.buffered2:n.buffered)[1],c=o[s].mediaSegments.find((function(e){return e.start-u>=0}))){e.next=8;break}return e.abrupt("return");case 8:l=0===u?n.currentTime:(c.start+c.end)/2,t._appendInitSegment("video",a,a.newIdx).then((function(){t.switching=!1,t.loadData(l,MPD_SEEK_TYPE.SEEK)})).catch((function(e){debug$2.log("appendInitSegment",e)}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){debug$2.log("startLoadInitSegemnt",e)}))}},{key:"_switch",value:(n=_asyncToGenerator$3(_regeneratorRuntime$1().mark((function e(t){var r,n,i,a;return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.dash,n=r.mpd.mediaList.video,i=n.selectedIdx,n.selectedIdx=t,this.mse.abort(CONTENT_TYPES$1.VIDEO),e.next=7,r.abortLoadingTasks();case 7:return n[i].mediaSegments.every((function(e){return e.downloaded=SEGMENT_STATE.NO_START,!0})),(a=r.mpd.mediaList.audio)[a.selectedIdx]&&a[a.selectedIdx].mediaSegments&&a[a.selectedIdx].mediaSegments.forEach((function(e){e.downloaded===SEGMENT_STATE.GOING&&(e.downloaded=SEGMENT_STATE.NO_START)})),r.mpd.syncAV(),e.abrupt("return",i);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_handleInitData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=this.dash,a=new ProxyPromise$1,o=e instanceof ArrayBuffer;if(o){var s=0===t.length?e:e.slice(t[0],t[1]+1),u=null===r?null:e.slice(r[0],r[1]+1),c=i.mpd.videoCodecType;!1===i.useEME&&this.crypto?this.crypto.decryptHeader(s,c).then((function(t){var r=i.useEME?s:t.data;a.resolve({initSegmentRes:r,data:e,sidxSegmentRes:u,vid:t.vid,headers:n})})):a.resolve({initSegmentRes:s,data:e,sidxSegmentRes:u,vid:null,headers:n})}else;return a}},{key:"_appendInitSegment",value:function(e,t,r){var n=this,i=this.player,a=this.config.duration;this.dash.mpd.duration>0&&(a=this.dash.mpd.duration);var o=new ProxyPromise$1,s=this.dash.mpd.mediaList[e],u=t.initSegmentRes,c=t.sidxSegmentRes;return t.fromCache||(t.fromCache=!0,s[s.selectedIdx].wrapperData=t,c&&this.dash.mpd.getSidx(c,e,r,a)),this.mse.appendBuffer(e,u,{mediaType:e,index:r}).then((function(){if(n._pluginInst.info({msg:"appendInitSegment",data:{mediaType:e,index:r}}),s[s.selectedIdx].inited=!0,o.resolve(),"video"===e){n.curVideoInitSegmentIdx=r;var t=n._findClosetGop(i.currentTime,!0,0);n.dash.mpd.clearBuffer(t,i.duration,"video")}})).catch((function(e){e&&e.message===ERROR_TYPES$3.MSE_OP_FAIL&&i&&i.emit(new Errors(Errors.MSE,Errors.MSE_PARSE_ERROR,{line:800,handle:"[DASH] appendInit",msg:e.message}))})),o}},{key:"_makeInitSegemntRequest",value:(r=_asyncToGenerator$3(_regeneratorRuntime$1().mark((function e(){var t,r,n,i,a,o,s,u,c,l,d,h,f,p,g,y,m,v=arguments;return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=v.length>0&&void 0!==v[0]?v[0]:"video",r=v.length>1&&void 0!==v[1]?v[1]:0,n=this.dash,i=this.config,a=new ProxyPromise$1,o=n.mpd&&n.mpd.mediaList[t][r],s=[],u="",o){e.next=11;break}return a.reject({mediaType:t,index:r,initSegmentRange:s,url:u,rejected:!0}),debug$2.log("initSegmentRequest error"),e.abrupt("return",a);case 11:return s=(o.initSegmentRange||[]).concat(),(c="segment_base"===n.mpd.dashType)&&(s[1]=o.sidxRange[1]),u=o.initSegment,l="video"===t&&(o.definition||this.bandwidth2item[o.bandwidth].definition),this._checkUrlRange(u),d={mediaType:t,vid:i.vid,definition:"video"===t?l:void 0,useUrlRange:i.useUrlRange,timeout:-1,bitrate:o.bandwidth||o.bitrate,initSegment:!0},e.next=20,n.getData(u,s,t,d);case 20:return h=e.sent,f=h.res,p=h.headers,g=h.status,y=h.readyState,m=h.fromCache,f&&"error"!==f?this._handleInitData(f,o.initSegmentRange,c?o.sidxRange:null,p).then((function(e){e.newIdx=r,e.mediaType=t,e.initSegmentRange=s,e.cache=m,e.definition=d.definition,a.resolve(e)})):a.reject({mediaType:t,index:r,initSegmentRange:s,url:u,rejected:!0,reason:f,status:g,readyState:y}),e.abrupt("return",a);case 28:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_makeInitSegemntRequestWithRetry",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"video",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.handleUrlExpire();var i=new ProxyPromise$1;return n&&this._pluginInst._kernal.setNodeTime("init".concat(t,"_metastart")),this._makeInitSegemntRequest(t,r).then((function(a){e._pluginInst.info({msg:"initSegmentRequest succ"}),n&&e._pluginInst._kernal.setNodeTime("init".concat(t,"_metadone"),"init".concat(t,"_metastart"),{fromCache:a.cache,byteLength:a.data.byteLength,mediaType:t,index:r,definition:a.definition}),i.resolve(a)}),(function(e){i.reject(new Errors(Errors.NETWORK,Errors.INIT_SEGMENT_ERROR,{line:329,msg:"initsegment fail",mediaType:t,index:r,error:e.message?e.message:e}))})).catch((function(e){i.reject(new Errors(Errors.NETWORK,Errors.INIT_SEGMENT_ERROR,{msg:"initsegment fail",error:e.message,mediaType:t,index:r}))})),i}},{key:"updateAbrCacheData",value:function(e,t,r){var n=this.dash,i=this.config,a=i.autoBitrateOpts||{},o=n.mpd.mediaList.video,s=r.definition,u=i.definitionText&&i.definitionText[s]||s,c=o[e],l=r.bitrate;this.bitrateMap[l]={url:c.id,definition:s,definitionName:u},this.defiIdMap[c.id]={bitrate:l,definition:s},e===o.length-1&&this.isOpenAutoDefi&&this.definitions.push({name:a.autoDefiText||"auto",url:AUTO_FLAG,selected:t,definition:"è‡ªåŠ¨",fps:void 0})}},{key:"destroyAbr",value:function(){var e=this,t=this.player;e.abrInstance&&(t&&t.off(ABR_EVENTS.UPDATE_AUTO_DESC,this._onAutoDescChange),e.abrInstance.destroy(),e.abrInstance=null)}},{key:"initAbr",value:(t=_asyncToGenerator$3(_regeneratorRuntime$1().mark((function e(){var t,r,n,i;return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this,r=this.player,n=this.config,util$1.on(r,ABR_EVENTS.UPDATE_AUTO_DESC,this._onAutoDescChange,"dashDestroy"),this.bitrateMap={},this.defiIdMap={},i=LOGOPEN,t.abrInstance=new ABR(r,n,0,n.dashOpts.dynamic_video,5e3,{logger:debug$2.abr,openLog:i}),util$1.once(r,ABR_EVENTS.ABR_START_PROGRESS,this.startProgressTimer,"dashDestroy"),t.abrInstance.onAbrChange=function(e,n,i,a){var o=t.bitrateMap[e],s=t.bitrateMap[n],u=o.definition,c=s.definition;debug$2.abr("abr change prevD:",u,"curDef:"+c),u!==c&&(t.abrSwitchURL(s.url),r.emit("ABR_CHANGE",{prev:u,cur:c,prevName:o.definitionName,curName:s.definitionName,abrInfo:a}))},util$1.on(r,ABR_EVENTS.ABR_CHANGE,t.abrInstance.onAbrChange,"dashDestroy"),t.abrInstance.isCurrentInAbr=this.isCurrentAutoDefi;case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"isCurrentInAbr",value:function(){return!!this.abrInstance&&this.abrInstance.isCurrentInAbr}}]),e}(),CHANGE_STATES=CHANGE_STATES$2,DashKernal=function(){function e(t){var r=this;_classCallCheck$2(this,e),_defineProperty$3(this,"start",function(){var e=_asyncToGenerator$3(_regeneratorRuntime$1().mark((function e(t){var n,i,a,o,s,u;return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r._checkHasDestroy("start")){e.next=2;break}return e.abrupt("return");case 2:if(r.setNodeTime("newplayer_start"),n=Date.now(),i=r.__dash__,a=r._pluginInst,o=a.player,s=a.config,o.dashState=PLAYER_START,o.emit("dashStateChange",PLAYER_START),t||(t=o.config.url="anytext"),u=new DASH(t,r._pluginInst,i),i){e.next=13;break}return r._info({msg:"__dash__ is null, dashOpts",startMs:n,name:"start __dash__"}),e.abrupt("return");case 13:if(i.initDash(u),!i.dashVideoEncrypted&&!i.dashAudioEncrypted){e.next=26;break}return debug$2.log("åŠ å¯†è§†é¢‘"),s.useEME=isEMESupported$1(),s.useEME||(i.crypto=new Crypto$2),s.intertrustServerURL&&(s.useEME=!0),u.useEME=s.useEME,i.awManager=new AwManager$1,e.next=23,i.awManager.init();case 23:r._info({msg:"encrypt video ready useEME ".concat(u.useEME)}),e.next=28;break;case 26:debug$2.log("éžåŠ å¯†è§†é¢‘"),r._info({msg:" no encrypt video ready"});case 28:return o.dashState=WASM_START,o.emit("dashStateChange",WASM_START),e.next=32,r._onWasmReady({url:t});case 32:r._info({msg:"info player start execute",startMs:n,name:"start",profile:!0});case 33:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),_defineProperty$3(this,"_errorHandler",(function(e){if(!r._checkHasDestroy("errorHandler")){var t=r._pluginInst,n=t.player,i=t.config,a=e;if("string"==typeof e){if(n.video.error&&2===n.video.error.code)e=new Errors(Errors.NETWORK,Errors.NETEORK_ERROR_CODES.timeout,{},n);else{var o=n.video.error&&n.video.error.code||0;e=new Errors(o>0?Errors.MEDIA:Errors.OTHER,o,{},n)}e.msg=a,n.video.error&&(e.msg+=";code"+n.video.error.code+"; details: "+n.video.error.message)}if(r._info({msg:"dashKernal error",data:e,add:!0}),("network"!==e.errorType||!i.disableNetworkError)&&e&&n.dashState!==ERROR_HANDLER){n.dashState=ERROR_HANDLER,e.vid=i.vid,e.url=n.src;var s=r.__dash__,u=s&&s.isCurrentAutoDefi;if(e.errd&&"object"===_typeof$3(e.errd)&&s&&s.dash&&(e.errd.url=s.dash.url,e.url=s.dash.url),e.url&&e.url.indexOf("blob:")>-1&&i.dashOpts&&i.dashOpts.dynamic_video&&(e.url=i.dashOpts.dynamic_video.main_url),e&&e.errorCode===Errors.NETWORK_DISCONNECT)n.emit("error",e);else{if(n.emit("DATA_REPORT",e),e&&e.errorCode===Errors.CDM_LICENSE_ERROR)return r._pluginInst.destroyKernal(),void n.emit("error",e);if(e&&e.errorCode===Errors.MSE_MEDIA_TYPES_NOT_SUPPORTED)r._handleDegradeToMp4(e);else{if(e.segmentExpired||e.msg===TASK_REQUEST_EXPIRED)return s&&s.abrInstance&&"function"==typeof s.abrInstance._stop&&(s.abrInstance._stop(),debug$2.abr("error stop","expired",e.segmentExpired,e.ex)),void r._pluginInst.emitExpireEvent(e);if(!e.curReqVideoSegInfo&&s&&(e.curReqVideoSegInfo=JSON.parse(JSON.stringify(s.curReqVideoSegInfo||{}))),e.headers||(e.headers=e.curReqVideoSegInfo.headers||{}),!!i.useBackUrl&&!r._pluginInst._hasUsedBackUrl&&i.dashOpts&&i.dashOpts.dynamic_video&&s){debug$2.log("backup replay");var c=s.changeMainBackUrl(CHANGE_STATES.ERR,r._pluginInst._hasUsedBackUrl);return s.updateDashType(),u?c.autoBitrateOpts&&(c.autoBitrateOpts.isPlayAutoDefi=!0):(r.currentDefitionFromPlayer&&(c.defaultDefinition=r.currentDefitionFromPlayer.definition),c.autoBitrateOpts&&(c.autoBitrateOpts.isPlayAutoDefi=!1)),r._pluginInst._hasUsedBackUrl=!0,r._pluginInst.next(n.currentTime,"REPLAY",c,!0),void n.emit("playCatch","dash2dash_backup",e)}s&&s.updateDashType(!0),r._handleDegradeToMp4(e)}}}}})),this._pluginInst=t,this._initProfile(),this._proxyPlayer(),this._initialize()}var t,r;return _createClass$3(e,[{key:"_initProfile",value:function(){this.firstFrameTime={newplayer_initkernel:{now:util$1.nowTime(),cost:0,t:1},newplayer_start:{now:-1,cost:-1,t:2},initmpd:{now:-1,cost:-1,t:3},initmpddone:{now:-1,cost:-1,t:4},initmse_sbopen:{now:-1,cost:-1,t:5},initmse_sbopendone:{now:-1,cost:-1,t:6},initvideo_metastart:{now:-1,cost:-1,t:7,i:!0},initvideo_metadone:{now:-1,cost:-1,t:8,i:!0},initaudio_metastart:{now:-1,cost:-1,t:7,i:!0},initaudio_metadone:{now:-1,cost:-1,t:8,i:!0},metaready_initsegend:{now:-1,cost:-1,t:7},initvideo_segstart:{now:-1,cost:-1,t:8,i:!0},initvideo_segdone:{now:-1,cost:-1,t:9,i:!0},initaudio_segstart:{now:-1,cost:-1,t:8,i:!0},initaudio_segdone:{now:-1,cost:-1,t:9,i:!0},initdash:{now:-1,cost:-1,t:9,i:!0},initdashdone:{now:-1,cost:-1,t:9,i:!0}},this.firstFrameTimeTypeMap={};for(var e=Object.keys(this.firstFrameTime),t=0;t<e.length;t++){var r=this.firstFrameTime[e[t]];r.key=e[t],r.i||(this.firstFrameTimeTypeMap[r.t]=r)}}},{key:"setNodeTime",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this.firstFrameTime[e];if(n&&(n.now=util$1.nowTime(),r&&(n.extData=r),n.t>1)){var i=t?this.firstFrameTime[t]:this.firstFrameTimeTypeMap[n.t-1];n.cost=n.now-i.now}}},{key:"_proxyPlayer",value:function(){var e=this._pluginInst.player;this._originSwitchURL=e.switchURL,this._originErrorHandler=e.errorHandler,e.switchURL=this._switchURL.bind(this),e._startInit=this.start,e.dash=!0,e.errorHandler=this._errorHandler}},{key:"_info",value:function(e){this._pluginInst.info(e)}},{key:"_onWasmReady",value:(r=_asyncToGenerator$3(_regeneratorRuntime$1().mark((function e(t){var r,n,i,a,o,s,u,c,l,d,h,f,p,g,y=this;return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.url,n=this._pluginInst,i=n.player,a=n.config,o=this.__dash__,s=o.dash,i.dashState=WASM_READY,i.emit("dashStateChange",WASM_READY),debug$2.log("ç›‘å¬åˆ°wasm_ready"),this._info({msg:"wasm_ready"}),util$1.on(s,"error",this._errorHandler,"destroy"),o.bindComEvent(),e.prev=10,e.next=13,s.init(r);case 13:if(u=e.sent){e.next=17;break}return this._info({msg:"isDestroy ".concat(!i,", isMseNull ").concat(!u)}),e.abrupt("return");case 17:if(debug$2.time("initReady cost",(new Date).getTime()-o.startTimestamp),i.dashState=INIT_FINISHED,i.emit("dashStateChange",INIT_FINISHED),debug$2.log("dash initå®Œæˆ"),s.mpd.mediaList.video.length>0){for(a.defaultDefinition||(a.defaultDefinition=a.dashOpts.dynamic_video.dynamic_video_list[0].definition,o.lastDefiIdx=0),o.isOpenAutoDefi||(o.isCurrentAutoDefi=!1,o.abrInstance.isCurrentInAbr=!1),c=a.dashOpts.dynamic_video.dynamic_video_list,l=0;l<c.length;l++)d=c[l],o.bandwidth2item[d.bitrate]=d,o.definition2item[d.definition]=d;s.mpd.mediaList.video.sort((function(e,t){return t.height-e.height})),s.mpd.mediaList.video.forEach((function(e,t){var r=o.bandwidth2item[e.bandwidth],n=r.definition,u=!(n!==a.defaultDefinition||o.isOpenAutoDefi&&o.isPlayAutoDefi);o.definitions.push({name:a.definitionText&&a.definitionText[n]||n,url:e.id,selected:u,definition:r.definition,fps:r.fps}),e.frameRate=e.frameRate||r.fps||25;var c=r.bitrate;o.updateAbrCacheData(t,o.isPlayAutoDefi,r),n===a.defaultDefinition&&(i.emit("initialUrl",s.mpd.mediaList.video[t].baseURL),o.curBitrate=c,o.lastDefiIdx=t),u&&y._pluginInst.setCurrentDefitionInfos(r.definition,r)})),(h=o.definitions.some((function(e){return e.selected})))&&void 0!==o.lastDefiIdx||(h||(o.definitions[0].selected=!0,f=o.definitions[0].definition,this._pluginInst.setCurrentDefitionInfos(f,o.definition2item[f])),i.emit("initialUrl",s.mpd.mediaList.video[0].baseURL),o.curBitrate=a.dashOpts.dynamic_video.dynamic_video_list[0].bitrate,o.lastDefiIdx=0),i.emit("resourceReady",o.definitions,a.dashOpts.dynamic_video.dynamic_video_list),o.abrInstance.updateBitrate(o.curBitrate)}this._pluginInst.originStartInit.call(i,u.url),debug$2.time("start call cost",(new Date).getTime()-o.startTimestamp),i.dashState=CORE_START,i.emit("dashStateChange",CORE_START),o.startCheckCanplayTimer(),o.isDashCanUse=!0,o.mse=u,o.emitMenuResolutionChange(),"safari"===sniffer$1.browser&&(util$2.addClass(i.root,"canplay"),p=function(){util$2.removeClass(i.root,"xgplayer-is-enter")},util$1.once(i,"waiting",p)),g=function(){var e=_asyncToGenerator$3(_regeneratorRuntime$1().mark((function e(){return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!y._checkHasDestroy("onStartPlay")){e.next=2;break}return e.abrupt("return");case 2:if(i.emit("dash_start_play"),y._info({msg:"dash_start_play"}),i.dashState=START_PLAY,y._info({msg:"START_PLAY ready"}),i.emit("dashStateChange",START_PLAY),i.emit("playInterfaceInfo",a.dashOpts||{}),!o.abrInstance){e.next=12;break}return e.next=11,o.abrInstance.init(s.mpd.mediaList);case 11:o.abrInstance.execute();case 12:o.isCurrentAutoDefi||debug$2.time("onStartPlay cost not abr",(new Date).getTime()-o.startTimestamp),o.startProgressTimer(),debug$2.time("onStartPlay cost",(new Date).getTime()-o.startTimestamp);case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),util$1.once(s,"start_play",g),this._info({msg:"START_PLAY dashready"}),i.emit("dashready"),e.next=40;break;case 37:e.prev=37,e.t0=e.catch(10),i.errorHandler(e.t0);case 40:case"end":return e.stop()}}),e,this,[[10,37]])}))),function(e){return r.apply(this,arguments)})},{key:"_initialize",value:function(){this.setNodeTime("newplayer_initkernel"),debug$2.log("æ‰§è¡ŒdashKernal");var e=this._pluginInst,t=e.player,r=e.config;if(!r.dashOpts)return console.error("dashOpts in plugin config miss"),void this._info({msg:"dashOpts is null",startMs:Date.now(),name:"_initialize",add:!0});r.dashOpts.Data&&"TOP"===r.playInfoType&&this._playInfoInit(),r.dashOpts.dynamic_video&&(r.dashOpts.dynamic_video.dynamic_video_list=r.dashOpts.dynamic_video.dynamic_video_list||[],r.dashOpts.dynamic_video.dynamic_audio_list=r.dashOpts.dynamic_video.dynamic_audio_list||[],[r.dashOpts.dynamic_video.dynamic_video_list,r.dashOpts.dynamic_video.dynamic_audio_list].forEach((function(e){e.forEach((function(e){e.bitrate=parseInt(e.real_bitrate||e.bitrate)}))})));var n=CHANGE_STATES$2,i=new __DASH__({pluginInst:this._pluginInst});this.__dash__=i;var a=MSE$2.isSupported('video/mp4; codecs="avc1.64001E, mp4a.40.5"');a?i.changeMainBackUrl(n.INIT,this._hasUsedBackUrl):(this._info({msg:"isCodecSupported ".concat(a),add:!0}),t.errorHandler(new Errors(Errors.MSE,Errors.MSE_MEDIA_TYPES_NOT_SUPPORTED,{msg:"init"})))}},{key:"_switchURL",value:(t=_asyncToGenerator$3(_regeneratorRuntime$1().mark((function e(t){var r,n,i,a,o,s=this,u=arguments;return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(u.length>1&&void 0!==u[1])||u[1],n=this.__dash__,i=this._pluginInst,a=i.config,o=i.player,(t=t.split("/")[t.split("/").length-1])!==AUTO_FLAG){e.next=10;break}return n.abrInstance.start(),n.isCurrentAutoDefi=!0,n.abrInstance.isCurrentInAbr=!0,setTimeout((function(){n.abrInstance._onTimeUpdate(null,!0)})),e.abrupt("return");case 10:n.isCurrentAutoDefi&&(n.updateAutoDefiDesc("",!0),n.isCurrentAutoDefi=!1,n.abrInstance.isCurrentInAbr=this.isCurrentAutoDefi),r&&n.abrInstance.stop(!0),n._startLoadInitSegment(t,!0).then(function(){var e=_asyncToGenerator$3(_regeneratorRuntime$1().mark((function e(t){var r,i,u,c,l,d,h,f,p,g;return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s._checkHasDestroy("startLoadInit")){e.next=2;break}return e.abrupt("return");case 2:if(n.selectedIdx===t.newIdx){e.next=5;break}return debug$2.log("definitionSwitchTime cancel, current:",n.selectedIdx,"self",t.newIdx),e.abrupt("return");case 5:return r=n.dash,i=r.mpd.mediaList.video,e.next=9,n._switch(t.newIdx);case 9:u=e.sent,c=o.currentTime,l=null,l=i[u||0].mediaSegments.find((function(e){return e.start-c>6})),d=!1,l||(h=i[u||0].mediaSegments,l=h[h.length-1],d=!0),f=util$1.round(l.start+1),p=util$1.round(o.getBufferedRange(a.useBuffered2?o.buffered2:o.buffered)[1]),debug$2.log("åˆ‡æ¢æ¸…æ™°åº¦ curTime: ".concat(c," start: ").concat(f," end: ").concat(p)),g=i[i.selectedIdx].definition,s._pluginInst.setCurrentDefitionInfos(g,n.definition2item[g]),n.isCurrentInAbr()||(debug$2.log("definitionSwitchTime emit, current",n.selectedIdx),o.emit("definitionSwitchTime",f<c?c+1:f)),p-f>0&&"safari"!==sniffer$1.browser&&!d&&(debug$2.log("removeBuffer: ".concat(f," ").concat(p)),n.mse.removeBuffer(CONTENT_TYPES$1.VIDEO,f,p).catch((function(){}))),n._appendInitSegment("video",t,t.newIdx).then((function(){n.switching=!1,n.loadData((l.start+l.end)/2,MPD_SEEK_TYPE.SEEK),n.emitMenuResolutionChange()}));case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 13:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_playInfoInit",value:function(){var e=this._pluginInst,t=e.config,r=e.playerConfig;t.vid=t.dashOpts.Data.VideoID||t.dashOpts.Data.Vid,r.vid=t.vid,transformTopModel(t)}},{key:"_handleDegradeToMp4",value:function(e){var t=this;if(!this._checkHasDestroy("_handleDegradeToMp4")){var r=this._pluginInst,n=r.player,i=r.config;if(i.mp4Opts&&!this._hasDegradeMp4){this._hasDegradeMp4=!0,n.dashState=ERROR_CATCHING;var a=i.startTime||n.currentTime||0;setTimeout((function(){t._checkHasDestroy("degrademp4")||(t._pluginInst._setStartTime("destroy",a,!0,!1),n.emit("playertypechange"),n.dashState=ERROR_CATCH_FINISHED,n.emit("playCatch","dash2mp4",e),i.defaultFormat="mp4",t._pluginInst.changeKernal(),n.once("canplay",(function(){var e=n.video.play();e&&e.catch((function(){}))})))}),0)}else n.dashState=ERROR_NO_MP4OPTS,n.emit("error",e)}}},{key:"abrInstance",get:function(){return this.__dash__.abrInstance}},{key:"destroy",value:function(){var e=this._pluginInst.player;this.__dash__&&(this.__dash__.destroy(),this.__dash__=null),e.errorHandler=this._originErrorHandler,e._startInit=this._pluginInst._originStartInit,e.switchURL=this._originSwitchURL,this._pluginInst=null}},{key:"_checkHasDestroy",value:function(e){return!this._pluginInst&&(this._info({msg:"dashKernal destroy ".concat(e),add:!0}),!0)}},{key:"executeReady",value:function(){if(!this._checkHasDestroy("executeReady")){var e=this._pluginInst.player;util$1.once(e,"dash_start_play",(function(){e.dashState=NEXT_FINISHED,e.emit("nextEnded")}))}}},{key:"getStat",value:function(){var e=this;if(!this._checkHasDestroy("getStat")){var t={type:"dash"};if(this.__dash__&&this.__dash__.dash){t.segments=this.__dash__.dash.segment_request;var r=this.__dash__.dash.first_segment_request;this._setSegmentCost("video",r),this._setSegmentCost("audio",r)}var n={},i={};return Object.keys(this.firstFrameTime).forEach((function(t){var r=e.firstFrameTime[t];n[t]=r.cost,i[t]={now:r.now,cost:r.cost,extData:r.extData}})),t.performance=n,t.firstFrameTime=i,t.preLoadData=this.getPreloadStat(),t}}},{key:"_setSegmentCost",value:function(e,t){var r=t[e],n=r.task,i=r.taskfinish,a=r.ext,o=r.fromCache,s=r.request,u=this.firstFrameTime["init".concat(e,"_segstart")],c=this.firstFrameTime["init".concat(e,"_segdone")],l=this.firstFrameTime.metaready_initsegend;u.now=s?n:-1,u.cost=s?n-l.now:-1,c.now=s?i:-1,c.cost=s?i-n:-1,c.extData=a,c.fromCache=o}},{key:"getPreloadStat",value:function(){for(var e=["initaudio_metadone","initvideo_metadone","initaudio_segdone","initvideo_segdone"],t={length:0,byteLength:0,load:[],preload:this._pluginInst.getPreloadStat()},r=0;r<e.length;r++){var n=this.firstFrameTime[e[r]].extData;n&&n.fromCache&&n.byteLength&&(t.length+=n.byteLength,t.byteLength+=n.byteLength,t.load.push(n))}return t}}]),e}(),Mp4Kernal=function(){function e(t){var r=this;_classCallCheck$2(this,e),_defineProperty$3(this,"_errorHandler",(function(e){var t=r._pluginInst.player,n=e;if("string"==typeof e){if(t.video.error&&2===t.video.error.code)e=new Errors(Errors.NETWORK,Errors.NETEORK_ERROR_CODES.timeout,{},t);else{var i=t.video.error&&t.video.error.code||0;e=new Errors(Errors.MEDIA,i,{},t)}e.msg=n,t.video.error&&(e.msg+=";code"+t.video.error.code+"; details: "+t.video.error.message)}r._stat.error.push({err:e});var a=(new Date).getTime()/1e3>=r.urlExpireTimestamp&&r.urlExpireTimestamp>0;r._pluginInst.info({msg:"dash mp4 kernal error happend, url expired ".concat(a),err:e}),!a||!t.video.error||4!==t.video.error.code&&2!==t.video.error.code?t.emit("error",e):r._urlExpiredWhenInit||r._mp4CheckExpire()})),_defineProperty$3(this,"_updateMp4Auto",(function(){setTimeout((function(){r._updateMp4AutoDesc()}),0)})),this._url=null,this._pluginInst=t,this._urlExpiredWhenInit=!1,this._initialize(),this._stat={type:"mp4",error:[]}}return _createClass$3(e,[{key:"start",value:function(){var e=this._pluginInst,t=e.config,r=e.player;t.defaultFormat="mp4",this._pluginInst.originStartInit.call(r,this._url),r.errorHandler=this._errorHandler,this._pluginInst.info({msg:"dash mp4 kernal start"})}},{key:"executeReady",value:function(){var e=this._pluginInst.player;e.dashState=NEXT_FINISHED,e.emit("nextEnded")}},{key:"_initialize",value:function(){var e=this;this._handleMp4Definitions(),this._getMp4Opts();var t=this._pluginInst.player;t.dash=!1,setTimeout((function(){t.emit("resourceReady",e._mp4Definitions||[],[].concat(e._RawMp4Definitions)),e._updateMp4Auto()})),this.urlExpireTimestamp&&(this._urlExpiredWhenInit=(new Date).getTime()/1e3>=this.urlExpireTimestamp&&this.urlExpireTimestamp>0,this._mp4CheckExpire())}},{key:"_handleMp4Definitions",value:function(){var e=this,t=this._pluginInst,r=t.player,n=t.config;if(n.mp4Opts){this.mp4AutoItem=null;var i=[].concat(n.mp4Opts.mp4List||[]);i.every((function(e){return!!e.bitrate}))&&i.sort((function(e,t){return t.bitrate-e.bitrate}));var a=n.mp4Opts.isOpenAutoDefi,o=n.mp4Opts.isPlayAutoDefi,s=!1;if(a){var u={};i.forEach((function(e){u[(e.definition||"").toLowerCase()]=e}));for(var c=["720p","480p","360p"],l=null,d=0;d<c.length;d++){var h=u[c[d]];if(h){l=h;break}}if(l){this.mp4AutoItem=l;var f=n.mp4Opts.autoDefiText||"è‡ªåŠ¨",p="".concat(f,"(").concat(l.definition,")");i.push({definition:f,url:AUTO_FLAG,name:p,url_expire:l.url_expire||0,selected:!!o}),s=o}}if(i.length>0){var g=i[0].url,y=i[0].url;i.forEach((function(e){e.definition===n.defaultDefinition&&(g=e.url,y=e.url)})),a&&o&&this.mp4AutoItem&&(g=this.mp4AutoItem.url,y=AUTO_FLAG),this._mp4Url=y,this._url=g}if(!s){for(var m=0;m<i.length;m++){var v=i[m];if(n.defaultDefinition===v.definition){v.selected=!0,s=!0;break}}s||(i[0].selected=!0)}this._mp4Definitions=i.map((function(t){n.defaultDefinition===t.definition&&(e._url=t.url,o||(t.selected=!0));var r=JSON.parse(JSON.stringify(t));return r.name=n.definitionText&&n.definitionText[t.definition]||t.definition,r.url_expire=t.url_expire||0,r})),this._backup_url=this._mp4Definitions[0].backup_url,this._RawMp4Definitions=i;for(var _=!1,b=0;b<i.length;b++){var A=i[b];A.codec_type&&A.vtype&&("h264"===A.codec_type&&"mp4"===A.vtype||(_=!0))}_&&r.emit("log",{type:"oneevent",end_type:MP4_SOURCE_ERR})}}},{key:"_getMp4Opts",value:function(){var e=this._pluginInst.player,t={url:this._mp4Url,realUrl:this._url,mp4Definitions:[].concat(this._mp4Definitions)};return this._getPlayInfoTimestamp=(new Date).getTime()/1e3,t.mp4Definitions&&t.mp4Definitions.length>0&&(this.urlExpireTimestamp=t.mp4Definitions[0].url_expire||0),this._proxyPlayer(),this._destroyMp4AutoHandler(),e.on("canplay",this._updateMp4Auto),this.urlExpireTimestamp&&(this.mp4CheckExpire=this._mp4CheckExpire.bind(this),e.on("timeupdate",this.mp4CheckExpire)),t}},{key:"_proxyPlayer",value:function(){var e=this._pluginInst.player;this._originSwitchURL=e.switchURL,this._originErrorHandler=e.errorHandler,e.switchURL=this._switchURLMp4.bind(this),e.config.url=this._url}},{key:"_switchURLMp4",value:function(e){var t=this,r=this._pluginInst.player,n=e.split("/")[e.split("/").length-1]===AUTO_FLAG,i=n?this.mp4AutoItem.url:e;r.curTime=r.currentTime;var a=r.paused;this._url=n?AUTO_FLAG:e,r.ended||(r.src=i,util$1.once(r,"canplay",(function(){if(r.currentTime=r.curTime,!a){var e=r.play();void 0!==e&&e&&e.catch((function(e){}))}}))),n?this._setCurrentDefitionInfos("è‡ªåŠ¨ ".concat(this.mp4AutoItem.definition),this.mp4AutoItem):util$1.once(r,"definitionChange",(function(e){for(var r=e.to,n=null,i=t._pluginInst.cnofig,a=0;a<i.mp4Opts.mp4List.length;a++){var o=i.mp4Opts.mp4List[a];if(o.definition===r){n=o;break}}t._setCurrentDefitionInfos("".concat(r),n)}))}},{key:"_mp4CheckExpire",value:function(){this._pluginInst.handleUrlExpire(this,!0)}},{key:"_updateMp4AutoDesc",value:function(){var e=this._pluginInst.player,t=this._url!==AUTO_FLAG||void 0;this.mp4AutoItem&&(e.emit("MP4_AUTO_DESC_CHANGE",JSON.parse(JSON.stringify(this.mp4AutoItem)),!!t||void 0),t||this._setCurrentDefitionInfos(this.mp4AutoItem.definition,this.mp4AutoItem))}},{key:"_setCurrentDefitionInfos",value:function(e,t){this._pluginInst.setCurrentDefitionInfos(e,t)}},{key:"_destroyMp4AutoHandler",value:function(){var e=this._pluginInst.player;e.off("canplay",this._updateMp4Auto),e.off("timeupdate",this._mp4CheckExpire),e.off("error",this._errorSwitchFormat)}},{key:"destroy",value:function(){var e=this._pluginInst.player;e.errorHandler=this._originErrorHandler,this._destroyMp4AutoHandler(),this._pluginInst.unloadVideo(),e.switchURL=this._originSwitchURL}},{key:"getStat",value:function(){return this._stat}}]),e}(),PRELOAD_NEXT$1=PRELOAD_NEXT$3,MEDIA_TYPES=MEDIA_TYPES$2,STATS_EVENTS=STATS_EVENTS$2,KERNAL_TYPES={MP4:"mp4",DASH:"dash",VOID:"void"},version$3="3.0.45";function getterMap(e){return{playerVersion:{get:function(){return version$3},configurable:!0},downloadSpeed:{get:function(){return Loader.currentSpeed/8/1024},configurable:!0},historyAvspeed:{get:function(){return Loader.historyAvspeed/8/1024},configurable:!0},abrInstance:{get:function(){return e.abrInstance},configurable:!0},menuCodeType:{get:function(){return e.menuCodeType},configurable:!0},playerType:{get:function(){return e.playerType},configurable:!0},supportMenus:{get:function(){return e.supportMenus},configurable:!0},CDNUrl:{get:function(){return e.CDNUrl},configurable:!0},performance:{get:function(){var t=e.stat;return t&&t.performance},configurable:!0},stat:{get:function(){return e.stat},configurable:!0},preLoadData:{get:function(){var t=e.stat;return t&&t.preLoadData?t.preLoadData:{byteLength:0}},configurable:!0}}}var _playerPlayNext$1=null,DASHPlugin=function(e){_inherits$2(r,e);var t=_createSuper$n(r);function r(){var e;_classCallCheck$2(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$3(_assertThisInitialized$2(e=t.call.apply(t,[this].concat(i))),"_hasUsedBackUrl",!1),_defineProperty$3(_assertThisInitialized$2(e),"_pendingPreloaders",[]),e}return _createClass$3(r,[{key:"initDashPlayer",value:function(e){var t=this;this._checkVideoSwitch();var r=this.config;this._hasTriggerBufferThreshold=!1,this._setArgsFromConfig(),this.lastBuffer="0,0",this._menuCodeType=null,this._setConfigDashType(),util$1.promisePolyfill(),(window.location.href.indexOf("playerInstance=true")>-1||proxyLocalStorage$1.getItem("playerInstance"))&&(void 0===window.dashPlayerInstanceList&&(window.dashPlayerInstanceList=[]),window.dashPlayerInstanceList.push(e)),this.dashPreloader=new DashPreloader(e,r,debug$2.preload,this.bitRateAdapter),e.preloader=this.dashPreloader;this._pendingPreloaders.length>0&&(this.addPreloaderList(this._pendingPreloaders),this._pendingPreloaders=[]),this._startBufferCheck(),util$1.on(e,PRELOAD_NEXT$1,(function(){t.dashPreloader.preloadNext()}),"destroy"),this.changeKernal(!1),window.addEventListener("beforeunload",this.cacheSpeed)}},{key:"_checkVideoSwitch",value:function(){var e=this.player;if(!(e.video instanceof HTMLVideoElement)){var t=util$2.createDom("video","",this.getVideoConfig(this.playerConfig));this.removeVideo=e.video,t.muted=e.video.muted,t.volume=e.video.volume,e.video=t,e.attachVideoEvents(e.video);var r=this.removeVideo.parentNode;r&&r.removeChild(this.removeVideo),this.removeVideo=null}}},{key:"getVideoConfig",value:function(e){var t=Object.assign({},{controls:!1,autoplay:e.autoplay,playsinline:e.playsinline,"x5-playsinline":e.playsinline,"webkit-playsinline":e.playsinline,"x5-video-player-fullscreen":e["x5-video-player-fullscreen"]||e.x5VideoPlayerFullscreen,"x5-video-orientation":e["x5-video-orientation"]||e.x5VideoOrientation,airplay:e.airplay,"webkit-airplay":e.airplay,tabindex:2,mediaType:e.mediaType||"video"},e.videoConfig,e.videoAttributes);return e.loop&&(t.loop="loop"),t}},{key:"bitRateAdapter",get:function(){var e=this.player,t=this.config;return e&&e.plugins&&t.needAutoBitrate?e.plugins.bitrateselector:null}},{key:"next",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"NEXT",r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=this.player,a=this.config;this._pendingPreloaders=[],this._pausedWhenExpiredRestart=!1,"MEDIA_EXPIRED"===t&&i.paused&&(this._pausedWhenExpiredRestart=!0),i.dashState=NEXT_START;var o=!1;if(i.isSrcVoid||!a.dashOpts&&!a.mp4Opts||i.ended||"MEDIA_EXPIRED"===t||"REPLAY"===t||i.duration&&i.currentTime<i.duration-DEFAULT_END&&(i.emit("logger_next",t),o=!0),this._hasTriggerBufferThreshold=!1,i.emit("next",t),i.emit("playertypechange"),r)for(var s in r)a[s]=r[s];this._setArgsFromConfig(),o&&this._setConfigDashType(),i.config.startTime=e,i.config.startTimeCache=e,i.config.DASHPlugin=r;var u=i.config.autoplay;this._pausedWhenExpiredRestart&&u&&(i.config.autoplay=!1,i.once("canplay",(function(){setTimeout((function(){i.config.autoplay=u,i.pause()}))}))),this._syncParameters(),this.changeKernal(!0,!0),!n&&!i.config.autoplay||this._pausedWhenExpiredRestart||i.once("canplay",(function(){if(i.video){var e=i.video.play();e&&e.catch((function(){}))}})),this._pausedWhenExpiredRestart&&(this._pausedWhenExpiredRestart=!1)}},{key:"_replay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.next(e,"REPLAY")}},{key:"startPlayHandler",value:function(e,t,r){var n=this.config;if(n.dashOpts||n.mp4Opts){var i="NEXT"===t||"REPLAY"===t;this._setStartTime(r,e,i,!0)}}},{key:"beforePlayerInit",value:function(){if(!this._hasExecuteBeforeInit){var e=this.player;BasePlugin.defineGetterOrSetter(e,getterMap(this)),this._hasExecuteBeforeInit=!0,e.isReady=!0}}},{key:"afterCreate",value:function(){var e=this;this.steps=[];var t=this.player;this._syncParameters(),t.config.nullUrlStart=!0,r.unionID&&(t.unionID=r.unionID,r.unionID=void 0),this._proxyPlayer(),this.initDashPlayer(t),this.on("xglog",(function(r){"firstFrame"===r.eventType&&debug$2.log("[xgplayer-encrypt]>>>>firstFrame ",e.playerConfig.vid,r.fvt,"stat",t.stat)}))}},{key:"info",value:function(e){var t=this.player;STATS_EVENTS&&t.emit(STATS_EVENTS.STATS_INFO,e),e.add&&this.steps.push(e)}},{key:"resetStat",value:function(){var e=this.player;STATS_EVENTS&&e.emit(STATS_EVENTS.STATS_RESET)}},{key:"_syncParameters",value:function(){var e=this.config,t=this.playerConfig,r=e.vid||t.vid;e.vid=t.vid=r,t.autoBitrateOpts=e.autoBitrateOpts}},{key:"_proxyPlayer",value:function(){var e=this,t=this.player;this._originStartInit=t._startInit,t.getPreloadInfos=this.getPreloadInfos.bind(this),t.useHooks("replay",(function(t){e._replay()})),"function"==typeof this.player.playNext&&(_playerPlayNext$1=this.player.playNext),this.player.playNext=function(){e.playNext.apply(e,arguments)}}},{key:"playNext",value:function(){for(var e=this.player,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=r[0],a=r[1],o=r[2],s=r[3];e.setConfig(i),this.next(a,o,i.DASHPlugin,s)}},{key:"_setKernalType",value:function(){var e=this.config;e.dashOpts||e.mp4Opts?e.dashOpts&&e.mp4Opts?this._kernalType=e.defaultFormat:e.dashOpts?this._kernalType=KERNAL_TYPES.DASH:this._kernalType=KERNAL_TYPES.MP4:this._kernalType=KERNAL_TYPES.VOID}},{key:"changeKernal",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._setKernalType();var r=this.player;this.destroyKernal();var n=this._kernalType;n===KERNAL_TYPES.VOID?(r.isSrcVoid=!0,r.emit("playOptsVoid"),t&&r.emit("nextEnded")):(r.isSrcVoid=!1,this._setStartTime("destroy",r.config.startTime,!0,!1),n===KERNAL_TYPES.MP4?this._kernal=new Mp4Kernal(this):n===KERNAL_TYPES.DASH&&(this._kernal=new DashKernal(this))),e&&this._kernal&&(this._kernal.start(),t&&this._kernal.executeReady())}},{key:"destroyKernal",value:function(){this._kernal&&(this._kernal.destroy(),this._kernal=null)}},{key:"originStartInit",get:function(){return this._originStartInit}},{key:"_setArgsFromConfig",value:function(){var e=this.config;this._bufferThreshold=e.bufferThreshold}},{key:"setCurrentDefitionInfos",value:function(e,t){var r=t?t.fps:void 0;this._currentDefinition={definiton:e,fps:r,item:t}}},{key:"handleUrlExpire",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.config,i=this.player,a=i.paused,o=(new Date).getTime()/1e3>=e.urlExpireTimestamp&&e.urlExpireTimestamp>0;if(o&&(r||!a)&&n.getServerTime)i.serverTimeDiffPromise=i.serverTimeDiffPromise||n.getServerTime().catch((function(){return 0})),i.serverTimeDiffPromise.then((function(r){if(r&&(i.serverTimeDiff=(new Date).getTime()/1e3-r),(new Date).getTime()/1e3>=e.urlExpireTimestamp+i.serverTimeDiff){e.urlExpireTimestamp=MAX_TIMESTAMP;var n=new Errors(Errors.NETWORK,Errors.NETEORK_ERROR_CODES[403]);t.emitExpireEvent(n)}}));else if(o){var s=new Errors(Errors.NETWORK,Errors.NETEORK_ERROR_CODES[403]);this.emitExpireEvent(s)}}},{key:"emitExpireEvent",value:function(e){var t=this.player,r=(new Date).getTime()/1e3;this.emitExpireTimestamp?r-this.emitExpireTimestamp>MIN_EXPIRE_INTERVAL&&(this.emitExpireTimestamp=r,t.emit("MEDIA_EXPIRED",e),this.info({msg:"MEDIA_EXPIRED"})):(this.emitExpireTimestamp=r,t.emit("MEDIA_EXPIRED",e),this.info({msg:"MEDIA_EXPIRED"}))}},{key:"_getCurDashType",value:function(){var e=proxyLocalStorage$1.getItem(URL_DASH_TAG),t=DASH_TYPE;return e===t.BACK?e:t.MAIN}},{key:"_setCurDashType",value:function(){this._initDashType=this._getCurDashType()}},{key:"_setConfigDashType",value:function(){this._setCurDashType();var e=this.playerConfig.vodLogOpts;e&&(e.currentDashType=this._initDashType)}},{key:"addDashPreloader",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.dashPreloader?(this._setPreloaderLoadMode(!1),this.dashPreloader.addPreloader(e,this.config.vid||this.player.config.vid)):(console&&console.warn("dashPreloader has destroyed"),this._pendingPreloaders.push(e))}},{key:"addPreloader",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.addDashPreloader(e)}},{key:"_setPreloaderLoadMode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.dashPreloader&&(this.dashPreloader.preloadManager.autoPreload=e)}},{key:"addDashPreloaderList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.dashPreloader?(this._setPreloaderLoadMode(!1),this.dashPreloader.addPreloaderList(e,this.config.vid||this.player.config.vid)):(console&&console.warn("dashPreloader has destroyed"),this._pendingPreloaders=this._pendingPreloaders.concat(e))}},{key:"addPreloaderList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.addDashPreloaderList(e)}},{key:"setCodeInfo",value:function(e){var t=this.playerConfig.vodLogOpts,r=CodecsConfigMap[e],n=CodecsConfigMap[CodecsTypes.AVC],i=n.logCodeType,a=n.codecs;r&&(i=r.logCodeType,a=r.codecs),t&&(t.codec_type=i),this.menuCodeType=a}},{key:"cacheSpeed",value:function(){try{var e=Loader.historyAvspeed;e>0&&e!==1/0&&proxyLocalStorage$1.setItem(SPPED_CACHE$1,e)}catch(error){}window.removeEventListener("beforeunload",this.cacheSpeed)}},{key:"unloadVideo",value:function(){var e=this.player;try{e.video&&e.video.src&&(e.video.removeAttribute("src"),e.video.load())}catch(error){}}},{key:"destroy",value:function(){var e=this.player;clearInterval(this._bufferCheckTimer),this.cacheSpeed(),this.destroyKernal(),this.bitRateAdapter&&this.bitRateAdapter.destroy();var t=getterMap(this);Object.keys(t).forEach((function(t){delete e[t]})),this.player.playNext=_playerPlayNext$1,this.player.removeHooks("replay")}},{key:"_processPreloadProgress",value:function(e,t){for(var r=this.config,n=["video"],i=0;i<n.length;i++){var a=n[i],o=this.preloadManager.preloadCacheProgress({vid:r.vid,format:"dash",mediaType:a,prelaodType:e.preloadType,bitrate:e.bitrate,set_duration:e.pduration,set_size:e.size,media_type:"video"===a?MEDIA_TYPES.VIDEO:MEDIA_TYPES.AUDIO});o&&t.push(o)}}},{key:"getPreloadInfos",value:function(){var e=this.config;if(this.preloadManager&&this.preloadManager.preloadCacheProgress){var t=this.preloadManager.cachedDatas[e.vid],r=[];if(this._processPreloadProgress(t||{},r),r.length>0){var n={item_num:r.length,items:r},i={preloadInfo:n};return t&&(i.abr=1),debug$2.preload("updatePreloadCacheInfo",n),i}}return null}},{key:"getPreloadStat",value:function(){var e=this.playerConfig.vid||this.config.vid;if(this.preloadManager&&this.preloadManager._preloadCacheProgress){var t={},r=this.preloadManager.getProgressCacheKey(e,"dash","video"),n=this.preloadManager.getProgressCacheKey(e,"dash","audio");return t.video=this.preloadManager._preloadCacheProgress[r],t.audio=this.preloadManager._preloadCacheProgress[n],t}return{}}},{key:"_onBufferReachThreshold",value:function(){var e=this.player;if(e.video){for(var t=e.video.buffered,r=0,n=0,i=0;i<t.length&&(r=t.start(i),n=t.end(i),!(r<=e.video.currentTime&&e.video.currentTime<=n));i++);n-e.video.currentTime>=this._bufferThreshold&&!this._hasTriggerBufferThreshold&&(this._hasTriggerBufferThreshold=!0,e.emit("BUFFER_THRESHOLD",n-e.video.currentTime))}}},{key:"_startBufferCheck",value:function(){var e=this,t=this.player;this._bufferCheckTimer=setInterval((function(){if(t.video){for(var r=[],n=0,i=t.video.buffered.length;n<i;n++)r.push([t.video.buffered.start(n),t.video.buffered.end(n)]);r.toString()!==e.lastBuffer&&(e.lastBuffer=r.toString(),e._onBufferReachThreshold())}}),200)}},{key:"_setStartTime",value:function(e,t,r,n){var i=this,a=this.player,o=this.playerConfig,s=this.config;if(t>0||n){var u=!1,c=function(){u||(u=!0,a.currentTime=t,o.startTime=0,r&&t>0&&a.emit("setStartTime"),"mp4"===s.defaultFormat&&i.setCodeInfo(CodecsTypes.AVC))};util$1.once(a,"canplay",c,e),util$1.once(a,"playing",c,e)}}},{key:"preloadManager",get:function(){return this.dashPreloader?this.dashPreloader.preloadManager:null}},{key:"CDNUrl",get:function(){var e=this.config;if(e.dashOpts&&e.dashOpts.dynamic_video){var t=document.createElement("a");return t.href=e.dashOpts.dynamic_video.main_url,t.host}return null}},{key:"playerType",get:function(){return this.config.defaultFormat}},{key:"supportMenus",get:function(){var e="dash"===this.config.defaultFormat;return{speed:e,cdn:e,resolution:e}}},{key:"currentDefitionFromPlayer",get:function(){return this._currentDefinition}},{key:"abrInstance",get:function(){return this._kernal&&this._kernal.abrInstance?this._kernal.abrInstance:null}},{key:"menuCodeType",get:function(){return this._menuCodeType},set:function(e){var t=this.player;this._menuCodeType=e,t.emit("codecsupdate",e)}},{key:"stat",get:function(){var e=this.player;if(this._kernal&&!e.isSrcVoid){var t=this._kernal.getStat();return t.steps=this.steps,this.steps=[],e.video&&e.video.error&&(t.media={readyState:e.video.readyState,error:e.video.error.code,errorMsg:e.video.error.message}),t}return null}}],[{key:"registerPreloader",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e.vtype=VTYPES$2.DASH,DashPreloader.BitRateAdapter=t,new DashPreloader(null,e,console.log)}},{key:"pluginName",get:function(){return"DASHPlugin"}},{key:"defaultConfig",get:function(){return{bufferThreshold:10,defaultFormat:"dash",useEME:null,getLicenseUrl:"",intertrustServerURL:null,defaultDefinition:null,cdnHost:null,cdnBucket:null,useGapJump:!0,mediaType:void 0,useDurationBackoff:!1,useBuffered2:!1,maxHoleDuration:.5,preloadTime:void 0,maxBufferLength:void 0,minBufferLength:10,dynamicPreloadTimeOpts:null,preloadCancelTime:5,progressTimer:1e3,disableCanplayCheck:!0,disableDashNoCanplayCheck:!0,disableBufferBreakCheck:!0,definitionText:null,useUnionInfoDRM:!1,keyTokenExpiredDuration:null,keyToken:null,playDomain:null,defaultSampleDurationCheck:!1,segmentRatio:7.5,preloadBufferThreshold:.5,MaxAppendTimeout:50,vtype:VTYPES$2.DASH,focusUserDefinition:!1,useProgressiveAppend:!1,onProcessMinLen:5120}}},{key:"isEMESupported",value:function(){return isEMESupported$1()}},{key:"encryptUtils",get:function(){return isSupport$2}},{key:"DashPreloader",get:function(){return DashPreloader}},{key:"updateUnionInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return t?t.unionID=e:r.unionID=e,document.cookie="volcvui=".concat(util$1.getUnionInfo(e)),util$1.getCookieValue("volcvui")}}]),r}(BasePlugin),_assign=function(){return(_assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function __rest(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r}function __values(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function __read(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)o.push(n.value)}catch(s){i={error:s}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return o}function __spread(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e}var Hook$1=function(){function e(){this._hooks={},this._cache=[],this._hooksCache={}}return e.prototype.on=function(e,t){e&&t&&"function"==typeof t&&(this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(t))},e.prototype.once=function(e,t){var r=this;e&&t&&"function"==typeof t&&this.on(e,(function n(i){t(i),r.off(e,n)}))},e.prototype.off=function(e,t){if(e&&this._hooks[e]&&this._hooks[e].length)if(t){var r=this._hooks[e].indexOf(t);-1!==r&&this._hooks[e].splice(r,1)}else this._hooks[e]=[]},e.prototype.emit=function(e,t,r){if(r){if(!e)return;-1!==this._cache.indexOf(r)?this._emit(e,t):(this._hooksCache.hasOwnProperty(r)||(this._hooksCache[r]={}),this._hooksCache[r].hasOwnProperty(e)||(this._hooksCache[r][e]=[]),this._hooksCache[r][e].push(t))}else this._emit(e,t)},e.prototype._emit=function(e,t){e&&this._hooks[e]&&this._hooks[e].length&&__spread(this._hooks[e]).forEach((function(e){try{e(t)}catch(r){}}))},e.prototype.set=function(e){e&&-1===this._cache.indexOf(e)&&this._cache.push(e)},e}(),isObject$4=function(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)},isNumber$2=function(e){return"number"==typeof e&&!isNaN(e)},isString$1=function(e){return"string"==typeof e},isArray$2=function(e){return Array.isArray(e)},getIndex$1=(lastEventId=+Date.now()+Number((""+Math.random()).slice(2,8)),function(){return lastEventId+=1}),lastEventId,decrypto$1=function(e,t,r){if("string"==typeof e&&"number"==typeof t&&"number"==typeof r){var n,i=[];r=r<=25?r:r%25;var a=String.fromCharCode(r+97);n=e.split(a);for(var o=0;o<n.length;o++){var s=parseInt(n[o],r);s=1*s^t;var u=String.fromCharCode(s);i.push(u)}return i.join("")}},decodeUrl$1=function(e){return decrypto$1(e,64,25)},beforePageUnload$1=function(e){navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.addEventListener("pagehide",e,!1):window.addEventListener("beforeunload",e,!1)},getIframeUrl=function(){try{return JSON.parse(atob(window.name))||void 0}catch(e){return}},loadScript=function(e,t,r){var n=document.createElement("script");n.src=e,n.onerror=function(){r(e)},n.onload=function(){t()},document.getElementsByTagName("head")[0].appendChild(n)},isSupVisChange=function(){var e=0;return["hidden","msHidden","webkitHidden"].forEach((function(t){void 0!==document[t]&&(e=1)})),e},selfAdjust=function(e,t){void 0===e&&(e=function(){}),void 0===t&&(t=1e3);var r,n=Date.now()+t;return r=window.setTimeout((function i(){var a=Date.now()-n;e(),n+=t,r=window.setTimeout(i,Math.max(0,t-a))}),t),function(){window.clearTimeout(r)}},stringify=function(e,t,r){if(void 0===t&&(t=""),void 0===r&&(r={}),e===t)return t;var n=e;"/"===(n=n.split("#")[0].split("?")[0])[e.length-1]&&(n=n.substr(0,e.length-1)),n="/"!==t[0]?n.replace(/(https?:\/\/[\w-]+(\.[\w-]+){1,}(:[0-9]{1,5})?)(\/[.\w-]+)*\/?$/,"$1"+t):n.replace(/(https?:\/\/[\w-]+(\.[\w-]+){1,}(:[0-9]{1,5})?(\/[.\w-]+)*?)(\/[.\w-]+)?\/?$/,"$1/"+t);var i=Object.keys(r).map((function(e){return e+"="+r[e]})).join("&");return i.length>0?n+"?"+i:n},parseURL$1=function(e){var t=document.createElement("a");return t.href=e,t},parseUrlQuery$1=function(e){var t={};try{var r=parseURL$1(e).search;(r=r.slice(1)).split("&").forEach((function(e){var r,n,i=e.split("=");i.length&&(r=i[0],n=i[1]);try{t[r]=decodeURIComponent(void 0===n?"":n)}catch(a){t[r]=n}}))}catch(n){}return t},hashCode$1=function(e){for(var t=0,r=0,n=(e+="").length,i=0;i<n;i++)((t=31*t+e.charCodeAt(r++))>0x7fffffffffff||t<-0x800000000000)&&(t&=0xffffffffffff);return t<0&&(t+=0x7ffffffffffff),t};function createCommonjsModule$1(e,t){return e(t={exports:{}},t.exports),t.exports}var js_cookie=createCommonjsModule$1((function(e,t){var r;r=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var n in r)t[n]=r[n]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(n){function i(){}function a(t,r,a){if("undefined"!=typeof document){"number"==typeof(a=e({path:"/"},i.defaults,a)).expires&&(a.expires=new Date(1*new Date+864e5*a.expires)),a.expires=a.expires?a.expires.toUTCString():"";try{var o=JSON.stringify(r);/^[\{\[]/.test(o)&&(r=o)}catch(c){}r=n.write?n.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var s="";for(var u in a)a[u]&&(s+="; "+u,!0!==a[u]&&(s+="="+a[u].split(";")[0]));return document.cookie=t+"="+r+s}}function o(e,r){if("undefined"!=typeof document){for(var i={},a=document.cookie?document.cookie.split("; "):[],o=0;o<a.length;o++){var s=a[o].split("="),u=s.slice(1).join("=");r||'"'!==u.charAt(0)||(u=u.slice(1,-1));try{var c=t(s[0]);if(u=(n.read||n)(u,c)||t(u),r)try{u=JSON.parse(u)}catch(l){}if(i[c]=u,e===c)break}catch(l){}}return e?i[e]:i}}return i.set=a,i.get=function(e){return o(e,!1)},i.getJSON=function(e){return o(e,!0)},i.remove=function(t,r){a(t,"",e(r,{expires:-1}))},i.defaults={},i.withConverter=r,i}((function(){}))},e.exports=r()})),_getCookie$1=function(e,t){try{return js_cookie.get(e,{domain:t||document.domain})}catch(r){return""}},_setCookie$1=function(e,t,r,n){try{var i=n||document.domain,a=+new Date+(r||6048e5);js_cookie.set(e,t,{expires:new Date(a),path:"/",domain:i})}catch(o){}},Memory$1=function(){function e(){this.cache={}}return e.prototype.setItem=function(e,t){this.cache[e]=t},e.prototype.getItem=function(e){return this.cache[e]},e.prototype.removeItem=function(e){this.cache[e]=void 0},e.prototype.getCookie=function(e,t){return _getCookie$1(e,t)},e.prototype.setCookie=function(e,t,r,n){_setCookie$1(e,t,r,n)},e}();function isSupportLS$1(){try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}function isSupportSession$1(){try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}var local$1={getItem:function(e){try{var t=localStorage.getItem(e),r=t;try{t&&"string"==typeof t&&(r=JSON.parse(t))}catch(n){}return r||{}}catch(n){}return{}},setItem:function(e,t){try{var r="string"==typeof t?t:JSON.stringify(t);localStorage.setItem(e,r)}catch(n){}},removeItem:function(e){try{localStorage.removeItem(e)}catch(t){}},getCookie:function(e,t){return _getCookie$1(e,t)},setCookie:function(e,t,r,n){_setCookie$1(e,t,r,n)},isSupportLS:isSupportLS$1()},session$1={getItem:function(e){try{var t=sessionStorage.getItem(e),r=t;try{t&&"string"==typeof t&&(r=JSON.parse(t))}catch(n){}return r||{}}catch(n){}return{}},setItem:function(e,t){try{var r="string"==typeof t?t:JSON.stringify(t);sessionStorage.setItem(e,r)}catch(n){}},removeItem:function(e){try{sessionStorage.removeItem(e)}catch(t){}},getCookie:function(e,t){return _getCookie$1(e,t)},setCookie:function(e,t,r,n){_setCookie$1(e,t,r,n)},isSupportSession:isSupportSession$1()},Storage$1=function(){function e(e,t){this._storage=t&&"session"===t?session$1:!e&&local$1.isSupportLS?local$1:new Memory$1}return e.prototype.getItem=function(e){return this._storage.getItem(e)},e.prototype.setItem=function(e,t){this._storage.setItem(e,t)},e.prototype.getCookie=function(e,t){return this._storage.getCookie(e,t)},e.prototype.setCookie=function(e,t,r,n){this._storage.setCookie(e,t,r,n)},e.prototype.removeItem=function(e){this._storage.removeItem(e)},e}(),UTM$1=function(e,t,r,n){var i=new Storage$1(!1),a=new Storage$1(!1,"session"),o=e?"_tea_utm_cache_"+e:"_tea_utm_cache",s=e?"_$utm_from_url_"+e:"_$utm_from_url",u={},c=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],l={ad_id:Number(t.ad_id)||void 0,campaign_id:Number(t.campaign_id)||void 0,creative_id:Number(t.creative_id)||void 0,utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign,utm_term:t.utm_term,utm_content:t.utm_content,tr_shareuser:t.tr_shareuser,tr_admaster:t.tr_admaster,tr_param1:t.tr_param1,tr_param2:t.tr_param2,tr_param3:t.tr_param3,tr_param4:t.tr_param4};try{var d=!1;for(var h in l)l[h]&&(-1!==c.indexOf(h)?(u.hasOwnProperty("tracer_data")||(u.tracer_data={}),u.tracer_data[h]=l[h]):u[h]=l[h],d=!0);if(d)a.setItem(s,"1"),i.setCookie(o,JSON.stringify(u),n,r);else{var f=i.getCookie(o,r);f&&(u=JSON.parse(f))}a.getItem(s)&&(u.hasOwnProperty("tracer_data")||(u.tracer_data={}),u.tracer_data.$utm_from_url=1)}catch(p){return l}return u},Client$1=function(){function e(e,t,r){this.appid=e,this.domain=t,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=r}return e.prototype.init=function(){var e=window.navigator.userAgent,t=window.navigator.language,r=document.referrer,n=r?parseURL$1(r).hostname:"",i=parseUrlQuery$1(window.location.href),a=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(this.appVersion)?"wap":"web";this.utm=UTM$1(this.appid,i,this.domain,this.cookie_expire);var o=this.browser(),s=this.os();return{browser:o.browser,browser_version:o.browser_version,platform:a,os_name:s.os_name,os_version:s.os_version,userAgent:e,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(s.os_name),language:t,referrer:r,referrer_host:n,utm:this.utm,latest_data:this.last(r,n)}},e.prototype.last=function(e,t){var r="",n="",i="",a=location.hostname,o=!1;if(e&&t&&a!==t){r=e,n=t,o=!0;var s=parseUrlQuery$1(e);s.keyword&&(i=s.keyword)}return{$latest_referrer:r,$latest_referrer_host:n,$latest_search_keyword:i,isLast:o}},e.prototype.browser=function(){var e,t,r="",n=""+parseFloat(this.appVersion),i=this.userAgent;return-1!==i.indexOf("Edge")||-1!==i.indexOf("Edg")?(r="Microsoft Edge",-1!==i.indexOf("Edge")?(e=i.indexOf("Edge"),n=i.substring(e+5)):(e=i.indexOf("Edg"),n=i.substring(e+4))):-1!==(e=i.indexOf("MSIE"))?(r="Microsoft Internet Explorer",n=i.substring(e+5)):-1!==(e=i.indexOf("Lark"))?(r="Lark",n=i.substring(e+5,e+11)):-1!==(e=i.indexOf("MetaSr"))?(r="sougoubrowser",n=i.substring(e+7,e+10)):-1!==i.indexOf("MQQBrowser")||-1!==i.indexOf("QQBrowser")?(r="qqbrowser",-1!==i.indexOf("MQQBrowser")?(e=i.indexOf("MQQBrowser"),n=i.substring(e+11,e+15)):-1!==i.indexOf("QQBrowser")&&(e=i.indexOf("QQBrowser"),n=i.substring(e+10,e+17))):-1!==i.indexOf("Chrome")?-1!==(e=i.indexOf("MicroMessenger"))?(r="weixin",n=i.substring(e+15,e+20)):-1!==(e=i.indexOf("360"))?(r="360browser",n=i.substring(i.indexOf("Chrome")+7)):-1!==i.indexOf("baidubrowser")||-1!==i.indexOf("BIDUBrowser")?(-1!==i.indexOf("baidubrowser")?(e=i.indexOf("baidubrowser"),n=i.substring(e+13,e+16)):-1!==i.indexOf("BIDUBrowser")&&(e=i.indexOf("BIDUBrowser"),n=i.substring(e+12,e+15)),r="baidubrowser"):-1!==(e=i.indexOf("xiaomi"))?-1!==i.indexOf("openlanguagexiaomi")?(r="openlanguage xiaomi",n=i.substring(e+7,e+13)):(r="xiaomi",n=i.substring(e-7,e-1)):-1!==(e=i.indexOf("TTWebView"))?(r="TTWebView",n=i.substring(e+10,e+23)):(-1!==(e=i.indexOf("Chrome"))||-1!==(e=i.indexOf("Chrome")))&&(r="Chrome",n=i.substring(e+7)):-1!==i.indexOf("Safari")?-1!==(e=i.indexOf("QQ"))?(r="qqbrowser",n=i.substring(e+10,e+16)):-1!==(e=i.indexOf("Safari"))&&(r="Safari",n=i.substring(e+7),-1!==(e=i.indexOf("Version"))&&(n=i.substring(e+8))):-1!==(e=i.indexOf("Firefox"))?(r="Firefox",n=i.substring(e+8)):-1!==(e=i.indexOf("MicroMessenger"))?(r="weixin",n=i.substring(e+15,e+20)):-1!==(e=i.indexOf("QQ"))&&(r="qqbrowser",n=i.substring(e+3,e+8)),-1!==(t=n.indexOf(";"))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(" "))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(")"))&&(n=n.substring(0,t)),{browser:r,browser_version:n}},e.prototype.os=function(){for(var e="",t="",r=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],n=0;n<r.length;n++){var i=r[n];if(i.r.test(this.userAgent)){"Mac OS X"===(e=i.s)&&this.isNewIpad()&&(e="iOS");break}}var a,o,s=function(e,t){var r=e.exec(t);return r&&r[1]?r[1]:""},u=function(e,t){var r=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:"+e+")","i").exec(t);return r?r.slice(1)[0]:""};switch(/Windows/.test(e)&&(t=s(/Windows (.*)/,e),e="windows"),e){case"Mac OS X":t=u("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),e="mac";break;case"Android":(o=s(/Android ([\.\_\d]+)/,a=this.userAgent))||(o=s(/Android\/([\.\_\d]+)/,a)),t=o,e="android";break;case"iOS":t=this.isNewIpad()?u("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(t=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?t[1]+"."+t[2]+"."+(0|t[3]):"",e="ios"}return{os_name:e,os_version:t}},e.prototype.getDeviceModel=function(e){var t="";try{if("android"===e)navigator.userAgent.split(";").forEach((function(e){e.indexOf("Build/")>-1&&(t=e.slice(0,e.indexOf("Build/")))}));else if("ios"===e||"mac"===e||"windows"===e)if(this.isNewIpad())t="iPad";else{var r=navigator.userAgent.replace("Mozilla/5.0 (",""),n=r.indexOf(";");t=r.slice(0,n)}}catch(i){return t.trim()}return t.trim()},e.prototype.isNewIpad=function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1},e}(),LOG$1;LOG$1={cn:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az28z1gz1hz1gz1cz18z1nz1gz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz21z1ez18z1jz1gz49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz18z1jz1gz24z18z49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k"};var AB_DOMAINS$1={cn:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},LOG_URL$1=LOG$1,SDK_VERSION$1="5.0.29",SDK_USE_TYPE$1="npm",SDK_TYPE$1=SDK_USE_TYPE$1,VISUAL_EDITOR_RANGERS="https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/visual-editor-rangers.js",VISUAL_AB_CORE="https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/visual-ab-core.js",VISUAL_AB_LOADER="https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/visual-ab-loader.js",HOT_PIC_URL="https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/heatmap-core",VISUAL_URL_INSPECTOR="https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/tester-event-inspector",Types$1,DebuggerMesssge$1$1,e;e=Types$1||(Types$1={}),e.Init="init",e.Config="config",e.Start="start",e.Ready="ready",e.TokenComplete="token-complete",e.TokenStorage="token-storage",e.TokenFetch="token-fetch",e.TokenError="token-error",e.ConfigUuid="config-uuid",e.ConfigWebId="config-webid",e.ConfigDomain="config-domain",e.CustomWebId="custom-webid",e.TokenChange="token-change",e.TokenReset="token-reset",e.ConfigTransform="config-transform",e.EnvTransform="env-transform",e.SessionReset="session-reset",e.SessionResetTime="session-reset-time",e.Event="event",e.Events="events",e.EventNow="event-now",e.CleanEvents="clean-events",e.BeconEvent="becon-event",e.SubmitBefore="submit-before",e.SubmitScuess="submit-scuess",e.SubmitAfter="submit-after",e.SubmitError="submit-error",e.SubmitVerify="submit-verify",e.Stay="stay",e.ResetStay="reset-stay",e.StayReady="stay-ready",e.SetStay="set-stay",e.RouteChange="route-change",e.RouteReady="route-ready",e.Ab="ab",e.AbVar="ab-var",e.AbAllVars="ab-all-vars",e.AbConfig="ab-config",e.AbExternalVersion="ab-external-version",e.AbVersionChangeOn="ab-version-change-on",e.AbVersionChangeOff="ab-version-change-off",e.AbOpenLayer="ab-open-layer",e.AbCloseLayer="ab-close-layer",e.AbReady="ab-ready",e.AbComplete="ab-complete",e.Profile="profile",e.ProfileSet="profile-set",e.ProfileSetOnce="profile-set-once",e.ProfileUnset="profile-unset",e.ProfileIncrement="profile-increment",e.ProfileAppend="profile-append",e.ProfileClear="profile-clear",e.Autotrack="autotrack",e.AutotrackReady="autotrack-ready",e.CepReady="cep-ready",e.TracerReady="tracer-ready",function(e){e.DEBUGGER_MESSAGE="debugger-message",e.DEBUGGER_MESSAGE_SDK="debugger-message-sdk",e.DEBUGGER_MESSAGE_FETCH="debugger-message-fetch",e.DEBUGGER_MESSAGE_FETCH_RESULT="debugger-message-fetch-result",e.DEBUGGER_MESSAGE_EVENT="debugger-message-event",e.DEVTOOL_WEB_READY="devtool-web-ready"}(DebuggerMesssge$1$1||(DebuggerMesssge$1$1={}));var Types$1$1=Types$1,undef$1=void 0,date$1=new Date,timeZoneMin$1=date$1.getTimezoneOffset(),timezone$1=parseInt(""+-timeZoneMin$1/60,10),tz_offset$1=60*timeZoneMin$1,WEBID_URL$1="/webid",TOB_URL$1="/tobid",REPORT_URL$1="/list",COOKIE_EXPIRE$1=6048e5,ConfigManager$1=function(){function e(e,t){this.is_first_time=!0,this.configPersist=!1,this.initConfig=t,this.collect=e;var r=new Client$1(t.app_id,t.cookie_domain||"",t.cookie_expire||COOKIE_EXPIRE$1).init(),n="__tea_cache_first_"+t.app_id;this.configKey="__tea_cache_config_"+t.app_id,this.sessionStorage=new Storage$1(!1,"session"),this.localStorage=new Storage$1(!1,"local"),t.configPersist&&(this.configPersist=!0,this.storage=1===t.configPersist?this.sessionStorage:this.localStorage);var i=this.localStorage.getItem(n);i&&"1"===i?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(n,"1")),this.envInfo={user:{user_unique_id:undef$1,user_type:undef$1,user_id:undef$1,user_is_auth:undef$1,user_is_login:undef$1,device_id:undef$1,web_id:undef$1,ip_addr_id:undef$1,user_unique_id_type:undef$1},header:{app_id:undef$1,app_name:undef$1,app_install_id:undef$1,install_id:undef$1,app_package:undef$1,app_channel:undef$1,app_version:undef$1,os_name:r.os_name,os_version:r.os_version,device_model:r.device_model,ab_client:undef$1,traffic_type:undef$1,client_ip:undef$1,device_brand:undef$1,os_api:undef$1,access:undef$1,language:r.language,region:undef$1,app_language:undef$1,app_region:undef$1,ab_version:undef$1,creative_id:r.utm.creative_id,ad_id:r.utm.ad_id,campaign_id:r.utm.campaign_id,log_type:undef$1,rnd:undef$1,platform:r.platform,sdk_version:SDK_VERSION$1,sdk_lib:"js",province:undef$1,city:undef$1,timezone:timezone$1,tz_offset:tz_offset$1,tz_name:undef$1,sim_region:undef$1,carrier:undef$1,resolution:r.screen_width+"x"+r.screen_height,browser:r.browser,browser_version:r.browser_version,referrer:r.referrer,referrer_host:r.referrer_host,width:r.screen_width,height:r.screen_height,screen_width:r.screen_width,screen_height:r.screen_height,utm_term:r.utm.utm_term,utm_content:r.utm.utm_content,utm_source:r.utm.utm_source,utm_medium:r.utm.utm_medium,utm_campaign:r.utm.utm_campaign,tracer_data:JSON.stringify(r.utm.tracer_data),custom:{},wechat_unionid:undef$1,wechat_openid:undef$1}},this.ab_version="",this.evtParams={},this.reportErrorCallback=function(){},this.initDomain()}return e.prototype.initDomain=function(){var e=this.initConfig.channel_domain;if(e)this.domain=e;else{var t=this.initConfig.channel;this.domain=decodeUrl$1(LOG_URL$1[t])}},e.prototype.setDomain=function(e){this.domain=e},e.prototype.getDomain=function(){return this.domain},e.prototype.setAbVersion=function(e){this.ab_version=e},e.prototype.getAbVersion=function(){return this.ab_version},e.prototype.setAbData=function(e){this.ab_data=e},e.prototype.getAbData=function(){return this.ab_data||{}},e.prototype.getUrl=function(e){var t="";switch(e){case"event":t=this.initConfig.report_url||REPORT_URL$1;break;case"webid":t=WEBID_URL$1;break;case"tobid":t=TOB_URL$1}var r="";return this.initConfig.caller&&(r="?sdk_version="+SDK_VERSION$1+"&sdk_name=web&app_id="+this.initConfig.app_id+"&caller="+this.initConfig.caller),""+this.getDomain()+t+r},e.prototype.set=function(e){var t=this;Object.keys(e).forEach((function(r){if(void 0!==e[r]&&null!==e[r]||t.delete(r),"evtParams"===r)t.evtParams=_assign({},t.evtParams||{},e.evtParams||{});else if("_staging_flag"===r)t.evtParams=_assign({},t.evtParams||{},{_staging_flag:e._staging_flag});else if("reportErrorCallback"===r&&"function"==typeof e[r])t.reportErrorCallback=e[r];else{var n="",i="";if(r.indexOf(".")>-1){var a=r.split(".");n=a[0],i=a[1]}n?"user"===n||"header"===n?t.envInfo[n][i]=e[r]:t.envInfo.header.custom[i]=e[r]:t.envInfo.user.hasOwnProperty(r)?["user_type","ip_addr_id"].indexOf(r)>-1?t.envInfo.user[r]=e[r]?Number(e[r]):e[r]:["user_id","web_id","user_unique_id","user_unique_id_type"].indexOf(r)>-1?t.envInfo.user[r]=e[r]?String(e[r]):e[r]:["user_is_auth","user_is_login"].indexOf(r)>-1?t.envInfo.user[r]=Boolean(e[r]):"device_id"===r&&(t.envInfo.user[r]=e[r]):t.envInfo.header.hasOwnProperty(r)?t.envInfo.header[r]=e[r]:t.envInfo.header.custom[r]=e[r]}}))},e.prototype.get=function(e){try{return e?"evtParams"===e?this.evtParams:"reportErrorCallback"===e?this[e]:this.envInfo.user.hasOwnProperty(e)?this.envInfo.user[e]:this.envInfo.header.hasOwnProperty(e)?this.envInfo.header[e]:JSON.parse(JSON.stringify(this.envInfo[e])):JSON.parse(JSON.stringify(this.envInfo))}catch(t){console.log("get config stringify error "),this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:t.message})}},e.prototype.setStore=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey)||{};if(t&&Object.keys(e).length){var r=Object.assign(e,t);this.storage.setItem(this.configKey,r)}}catch(n){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:n.message})}},e.prototype.getStore=function(){try{if(!this.configPersist)return null;var e=this.storage.getItem(this.configKey);return e&&Object.keys(e).length?e:null}catch(t){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:t.message}),null}},e.prototype.delete=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey);t&&t.hasOwnProperty(e)&&(delete t[e],this.storage.setItem(this.configKey,t))}catch(r){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:r.message})}},e}(),Logger$4=function(){function e(e,t){this.isLog=t||!1,this.name=e||""}return e.prototype.info=function(e){this.isLog&&console.log("%c %s","color: yellow; background-color: black;","[instance: "+this.name+"] "+e)},e.prototype.warn=function(e){this.isLog&&console.warn("[instance: "+this.name+"] "+e)},e.prototype.error=function(e){this.isLog&&console.error("[instance: "+this.name+"] "+e)},e.prototype.throw=function(e){throw this.error(this.name),new Error(e)},e}(),AppBridge$1=function(){function e(e,t){this.collect=e,this.native=t}var t=e.prototype;return t.bridgeInject=function(){try{return!!this.native&&(AppLogBridge?(console.log("AppLogBridge is injected"),!0):(console.log("AppLogBridge is not inject"),!1))}catch(e){return console.log("AppLogBridge is not inject"),!1}},t.bridgeReady=function(){var e=this;return new Promise((function(t,r){try{e.bridgeInject()?AppLogBridge.hasStarted((function(e){console.log("AppLogBridge is started? : "+e),e?t(!0):r(!1)})):r(!1)}catch(n){console.log("AppLogBridge, error:"+JSON.stringify(n.stack)),r(!1)}}))},t.setNativeAppId=function(e){try{AppLogBridge.setNativeAppId(JSON.stringify(e)),console.log("change bridge appid, event report with appid: "+e)}catch(t){console.error("setNativeAppId error")}},t.setConfig=function(e){var t=this;try{Object.keys(e).forEach((function(r){"user_unique_id"===r?t.setUserUniqueId(e[r]):e[r]?t.addHeaderInfo(r,e[r]):t.removeHeaderInfo(r)}))}catch(r){console.error("setConfig error")}},t.setUserUniqueId=function(e){try{AppLogBridge.setUserUniqueId(e)}catch(t){console.error("setUserUniqueId error")}},t.addHeaderInfo=function(e,t){try{AppLogBridge.addHeaderInfo(e,t)}catch(r){console.error("addHeaderInfo error")}},t.setHeaderInfo=function(e){try{AppLogBridge.setHeaderInfo(JSON.stringify(e))}catch(t){console.error("setHeaderInfo error")}},t.removeHeaderInfo=function(e){try{AppLogBridge.removeHeaderInfo(e)}catch(t){console.error("removeHeaderInfo error")}},t.reportPv=function(e){this.onEventV3("predefine_pageview",e)},t.onEventV3=function(e,t){try{AppLogBridge.onEventV3(e,t),this.collect.emit(DebuggerMesssge.DEBUGGER_MESSAGE,{type:DebuggerMesssge.DEBUGGER_MESSAGE_EVENT,info:"bridgeåŸ‹ç‚¹ä¸ŠæŠ¥",time:Date.now(),data:[{events:[{event:e,params:t}]}],code:200,status:"success"})}catch(r){console.error("onEventV3 error")}},t.profileSet=function(e){try{AppLogBridge.profileSet(e)}catch(t){console.error("profileSet error")}},t.profileSetOnce=function(e){try{AppLogBridge.profileSetOnce(e)}catch(t){console.error("profileSetOnce error")}},t.profileIncrement=function(e){try{AppLogBridge.profileIncrement(e)}catch(t){console.error("profileIncrement error")}},t.profileUnset=function(e){try{AppLogBridge.profileUnset(e)}catch(t){console.error("profileUnset error")}},t.profileAppend=function(e){try{AppLogBridge.profileAppend(e)}catch(t){console.error("profileAppend error")}},e}(),ERROR$2={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005};function fetch$1$1(e,t,r,n,i,a,o,s,u){try{var c=new XMLHttpRequest,l=s||"POST";c.open(l,""+e,!0),c.setRequestHeader("Content-Type","application/json; charset=utf-8"),o&&c.setRequestHeader("X-MCS-AppKey",""+o),n&&(c.withCredentials=!0),c.onload=function(){if(i){var e=null;if(c.responseText){try{e=JSON.parse(c.responseText)}catch(r){e={}}i(e,t)}}},r&&(c.timeout=r,c.ontimeout=function(){a&&a(t,ERROR$2.TIMEOUT)}),c.onerror=function(){c.abort(),a&&a(t,ERROR$2.XHR_ON)},u?c.send(t):c.send(JSON.stringify(t))}catch(d){}}var GIF_URL$1="/gif",ERROR$1$1={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005},isSupportBeacon$1=function(){return!(!window.navigator||!window.navigator.sendBeacon)},encodePayload$1=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&void 0!==e[r]&&(t+="&"+r+"="+encodeURIComponent(JSON.stringify(e[r])));return"&"===t[0]?t.slice(1):t},sendByImg$1=function(e,t,r,n){try{var i,a=e.match(/\/v\d\//);i=a?a[0]:-1!==e.indexOf("/v1/")?"/v1/":"/v2/";var o=e.split(i)[0];if(!o)return void n(e,t,ERROR$1$1.NO_URL);t.forEach((function(i){var a=encodePayload$1(i),s=new Image(1,1);s.onload=function(){s=null,r&&r()},s.onerror=function(){s=null,n&&n(e,t,ERROR$1$1.IMG_ON)},s.src=""+o+GIF_URL$1+"?"+a}))}catch(s){n&&n(e,t,ERROR$1$1.IMG_CATCH,s.message)}},request$2=function(e,t,r,n,i,a,o,s){var u=window.navigator.userAgent;if(-1===window.navigator.appName.indexOf("Microsoft Internet Explorer")||-1===u.indexOf("MSIE 8.0")&&-1===u.indexOf("MSIE 9.0")){if(o)return isSupportBeacon$1()?void(window.navigator.sendBeacon(e,JSON.stringify(t))?i():a(e,t,ERROR$1$1.BEACON_FALSE)):void sendByImg$1(e,t,i,a)}else sendByImg$1(e,t,i,a);fetch$1$1(e,t,r,n,i,a,"","",s)},EventCheck$1=function(){function e(e,t){this.collector=e,this.config=t,this.eventNameWhiteList=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure"],this.paramsNameWhiteList=["$inactive","$inline","$target_uuid_list","$source_uuid","$is_spider","$source_id","$is_first_time","_staging_flag"],this.regStr=new RegExp("^[a-zA-Z0-9][a-z0-9A-Z_.-]{1,255}$")}return e.prototype.checkVerify=function(e){var t=this;if(!e||!e.length)return!1;var r=e[0];if(!r)return!1;var n=r.events,i=r.header;if(!n||!n.length)return!1;var a=!0;return n.forEach((function(e){t.checkEventName(e.event)||(a=!1,e.checkEvent="äº‹ä»¶åä¸èƒ½ä»¥ $ or __å¼€å¤´"),t.checkEventParams(e.params)||(a=!1,e.checkParams="å±žæ€§åä¸èƒ½ä»¥ $ or __å¼€å¤´")})),this.checkEventParams(i)||(a=!1),a},e.prototype.checkEventName=function(e){return!!e&&this.calculate(e,"event")},e.prototype.checkEventParams=function(e){var t=e;if("string"==typeof e&&(t=JSON.parse(t)),!Object.keys(t).length)return!0;for(var r in t)return!(!this.calculate(r,"params")||"string"==typeof t[r]&&t[r].length>1024&&(console.warn("params: "+r+" can not over 1024 byte, please check;"),1));return!0},e.prototype.calculate=function(e,t){return-1!==("event"===t?this.eventNameWhiteList:this.paramsNameWhiteList).indexOf(e)||(this.regStr.test(e)?!new RegExp("^\\$").test(e)&&!new RegExp("^__").test(e)||(console.warn(("event"===t?"event":"params")+" name: "+e+" can not start with $ or __, pleace check;"),!1):(console.warn(("event"===t?"event":"params")+" name: "+e+" is illegal, can not start with $ or __, pleace check;"),!1))},e}(),Event$3=function(){function e(){this.eventLimit=50,this.enable_ttwebid=!1,this.eventCache=[],this.beconEventCache=[]}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.config=t,this.configManager=e.configManager,this.eventCheck=new EventCheck$1(e,t),this.cacheStorgae=new Storage$1(!0),this.localStorage=new Storage$1(!1),this.maxReport=t.max_report||10,this.reportTime=t.reportTime||30,this.timeout=t.timeout||1e5,this.enable_ttwebid=t.enable_ttwebid,this.reportUrl=this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_"+this.configManager.get("app_id"),this.beconKey="__tea_cache_events_becon_"+this.configManager.get("app_id"),this.abKey="__tea_sdk_ab_version_"+this.configManager.get("app_id"),this.collect.on(Types$1$1.Ready,(function(){r.reportAll(!1)})),this.collect.on(Types$1$1.ConfigDomain,(function(){r.reportUrl=r.configManager.getUrl("event")})),this.collect.on(Types$1$1.Event,(function(e){r.event(e)})),this.collect.on(Types$1$1.BeconEvent,(function(e){r.beconEvent(e)})),this.collect.on(Types$1$1.CleanEvents,(function(){r.reportAll(!1)})),this.linster()},e.prototype.linster=function(){var e=this;window.addEventListener("unload",(function(){e.reportAll(!0)}),!1),beforePageUnload$1((function(){e.reportAll(!0)})),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&e.reportAll(!0)}),!1)},e.prototype.reportAll=function(e){this.report(e),this.reportBecon()},e.prototype.event=function(e){var t=this;try{var r=__spread(e,this.cacheStorgae.getItem(this.eventKey)||[]);if(this.cacheStorgae.setItem(this.eventKey,r),this.reportTimeout&&clearTimeout(this.reportTimeout),r.length>=this.maxReport)this.report(!1);else{var n=this.reportTime;this.reportTimeout=setTimeout((function(){t.report(!1),t.reportTimeout=null}),n)}}catch(i){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:i.message})}},e.prototype.beconEvent=function(e){var t=__spread(e,this.cacheStorgae.getItem(this.beconKey)||[]);this.cacheStorgae.setItem(this.beconKey,t),this.collect.destroyInstance||this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(t)),!0))},e.prototype.reportBecon=function(){if(!this.collect.destroyInstance&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var e=this.cacheStorgae.getItem(this.beconKey)||[];e&&e.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))}},e.prototype.report=function(e){if(!this.collect.destroyInstance&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var t=this.cacheStorgae.getItem(this.eventKey)||[];t.length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(t,e))}},e.prototype.sliceEvent=function(e,t){if(e.length>this.eventLimit)for(var r=0;r<e.length;r+=this.eventLimit){var n;n=e.slice(r,r+this.eventLimit);var i=this.split(this.merge(n));this.send(i,t)}else i=this.split(this.merge(e)),this.send(i,t)},e.prototype.merge=function(e,t){var r=this,n=this.configManager.get(),i=n.header,a=n.user;i.custom=JSON.stringify(i.custom);var o=this.configManager.get("evtParams"),s=this.configManager.get("user_unique_id_type"),u=e.map((function(e){try{Object.keys(o).length&&!t&&(e.params=_assign({},o,e.params)),s&&(e.params.$user_unique_id_type=s);var n=r.localStorage.getItem(r.abKey);return n&&n.uuid&&n.uuid===a.user_unique_id&&r.configManager.getAbVersion()&&(e.ab_sdk_version=r.configManager.getAbVersion()),e.session_id=r.collect.sessionManager.getSessionId(),e.params=JSON.stringify(e.params),e}catch(i){return r.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:i.message}),e}})),c=JSON.parse(JSON.stringify({events:u,user:a,header:i}));c.local_time=Math.floor(Date.now()/1e3),c.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0;var l=[];return l.push(c),l},e.prototype.split=function(e){return e.map((function(e){var t=[];return t.push(e),t}))},e.prototype.send=function(e,t){var r=this;e.length&&e.forEach((function(e){try{var n=JSON.parse(JSON.stringify(e));r.config.filter&&((n=r.config.filter(n))||console.warn("filter must return data !!")),r.collect.eventFilter&&n&&((n=r.collect.eventFilter(n))||console.warn("filterEvent api must return data !!"));var i=n||e;if(r.eventCheck.checkVerify(i),!i.length)return;r.collect.emit(Types$1$1.SubmitBefore,i),r.collect.emit(Types$1$1.SubmitVerify,i),request$2(r.reportUrl,i,r.timeout,r.enable_ttwebid,(function(e,t){e&&0!==e.e?(r.collect.emit(Types$1$1.SubmitError,{type:"f_data",eventData:t,errorCode:e.e,response:e}),r.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_EVENT,info:"åŸ‹ç‚¹ä¸ŠæŠ¥å¤±è´¥",time:Date.now(),data:i,code:e.e,failType:"æ•°æ®å¼‚å¸¸",status:"fail"})):(r.collect.emit(Types$1$1.SubmitScuess,{eventData:t,res:e}),r.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_EVENT,info:"åŸ‹ç‚¹ä¸ŠæŠ¥æˆåŠŸ",time:Date.now(),data:i,code:200,status:"success"}))}),(function(e,t){r.configManager.get("reportErrorCallback")(e,t),r.collect.emit(Types$1$1.SubmitError,{type:"f_net",eventData:e,errorCode:t}),r.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_EVENT,info:"åŸ‹ç‚¹ä¸ŠæŠ¥ç½‘ç»œå¼‚å¸¸",time:Date.now(),data:i,code:t,failType:"ç½‘ç»œå¼‚å¸¸",status:"fail"})}),t,!1),r.collect.emit(Types$1$1.SubmitAfter,i)}catch(a){console.warn("something error, "+JSON.stringify(a.stack)),r.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:a.message})}}))},e}(),b$1=function e(t){return t?(t^16*Math.random()>>t/4).toString(10):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)},localWebId$1=function(){return b$1().replace(/-/g,"").slice(0,19)},Token$1=function(){function e(){this.cacheToken={},this.enableCookie=!1,this.enable_ttwebid=!1,this.enableCustomWebid=!1}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.config=t,this.configManager=this.collect.configManager,this.storage=new Storage$1(!1),this.tokenKey="__tea_cache_tokens_"+t.app_id,this.enable_ttwebid=t.enable_ttwebid,this.enableCustomWebid=t.enable_custom_webid,this.collect.on(Types$1$1.ConfigUuid,(function(e){r.setUuid(e)})),this.collect.on(Types$1$1.ConfigWebId,(function(e){r.setWebId(e)})),this.enableCookie=t.cross_subdomain,this.expiresTime=t.cookie_expire||6048e5,this.cookieDomain=t.cookie_domain||"",this.checkStorage()},e.prototype.checkStorage=function(){var e=this;if(this.enableCookie){var t=this.storage.getCookie(this.tokenKey,this.cookieDomain);this.cacheToken=t&&"string"==typeof t?JSON.parse(t):{}}else this.cacheToken=this.storage.getItem(this.tokenKey)||{};this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid?this.enableCustomWebid?this.collect.on(Types$1$1.CustomWebId,(function(){e.tokenReady=!0,e.collect.emit(Types$1$1.TokenComplete)})):this.checkEnv()||(this.enable_ttwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},e.prototype.check=function(){this.cacheToken&&this.cacheToken.web_id?this.complete(this.cacheToken):this.config.disable_webid?this.complete({web_id:localWebId$1(),user_unique_id:this.configManager.get("user_unique_id")||localWebId$1()}):this.remoteWebid()},e.prototype.checkEnv=function(){var e=window.navigator.userAgent;if(-1!==e.indexOf("miniProgram")||-1!==e.indexOf("MiniProgram")){var t=parseUrlQuery$1(window.location.href);return!(!t||!t.Web_ID||(this.complete({web_id:""+t.Web_ID,user_unique_id:this.configManager.get("user_unique_id")||""+t.Web_ID}),0))}return!1},e.prototype.remoteWebid=function(){var e=this,t=this.configManager.getUrl("webid"),r={app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""};this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK å‘èµ·WEBIDè¯·æ±‚",logType:"fetch",level:"info",time:Date.now(),data:r}),fetch$1$1(t,r,3e3,!1,(function(t){t&&0===t.e?e.complete({web_id:e.configManager.get("web_id")||t.web_id,user_unique_id:e.configManager.get("user_unique_id")||t.web_id}):(e.collect.emit(Types$1$1.TokenError),console.warn("[]appid: "+e.config.app_id+" webid error, init error~")),e.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"WEBIDè¯·æ±‚æˆåŠŸ",logType:"fetch",level:"info",time:Date.now(),data:t})}),(function(){e.collect.emit(Types$1$1.TokenError),e.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"WEBIDè¯·æ±‚ç½‘ç»œå¼‚å¸¸",logType:"fetch",level:"error",time:Date.now(),data:null}),console.warn("[]appid: "+e.config.app_id+", get webid error, init error~")}))},e.prototype.complete=function(e){var t=e.web_id,r=e.user_unique_id;e.timestamp=Date.now(),this.collect.configManager.set({web_id:t,user_unique_id:r}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(Types$1$1.TokenComplete)},e.prototype.completeTtWid=function(e){var t=e.user_unique_id||"",r=this.configManager.get("user_unique_id");(r||t)&&this.configManager.set({user_unique_id:r||t}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(Types$1$1.TokenComplete)},e.prototype.setUuid=function(e){if(e&&-1===["null","undefined","Null","None"].indexOf(e)){var t=String(e),r=this.configManager.get("user_unique_id"),n=this.cacheToken&&this.cacheToken.user_unique_id;if(t===r&&t===n)return;this.configManager.set({user_unique_id:t}),this.cacheToken||(this.cacheToken={}),this.cacheToken.user_unique_id=t,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(Types$1$1.TokenChange,"uuid"),this.collect.emit(Types$1$1.SessionReset)}else this.clearUuid()},e.prototype.clearUuid=function(){this.config.enable_ttwebid||this.configManager.get("web_id")&&(this.configManager.set({user_unique_id:this.configManager.get("web_id")}),this.cacheToken&&this.cacheToken.web_id&&(this.cacheToken.user_unique_id=this.cacheToken.web_id,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken)),this.collect.emit(Types$1$1.TokenReset))},e.prototype.setWebId=function(e){if(e&&!this.config.enable_ttwebid){this.cacheToken&&this.cacheToken.web_id?this.cacheToken.web_id!==e&&(this.cacheToken.user_unique_id=this.cacheToken.web_id===this.cacheToken.user_unique_id?e:this.cacheToken.user_unique_id,this.cacheToken.web_id=e):(this.cacheToken={},this.cacheToken.web_id=e,this.cacheToken.user_unique_id=e),this.cacheToken.timestamp=Date.now();var t=this.configManager.get("web_id"),r=this.configManager.get("user_unique_id");r&&r!==t||(this.configManager.set({user_unique_id:e}),this.collect.emit(Types$1$1.TokenChange,"uuid")),t!==e&&(this.configManager.set({web_id:e}),this.collect.emit(Types$1$1.TokenChange,"webid")),this.setStorage(this.cacheToken)}},e.prototype.setStorage=function(e){e._type_=this.enableCustomWebid?"custom":"default",delete e["diss".split("").reverse().join("")],this.enableCookie||this.enable_ttwebid?(this.storage.setCookie(this.tokenKey,e,this.expiresTime,this.cookieDomain),this.enable_ttwebid&&(delete e.web_id,this.storage.setItem(this.tokenKey,e))):this.storage.setItem(this.tokenKey,e),this.cacheToken=e},e.prototype.getReady=function(){return this.tokenReady},e.prototype.getTobId=function(){var e=this,t=this.configManager.getUrl("tobid");return new Promise((function(r){fetch$1$1(t,{app_id:e.config.app_id,user_unique_id:e.configManager.get("user_unique_id"),web_id:e.configManager.get("web_id"),user_unique_id_type:e.configManager.get("user_unique_id_type")},3e4,e.enable_ttwebid,(function(e){e&&0===e.e?r(e.tobid):r("")}),(function(){r("")}))}))},e}(),sessionId$1=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},Session$1=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.storage=new Storage$1(!1,"session"),this.sessionKey="__tea_session_id_"+t.app_id,this.expireTime=t.expireTime||18e5,this.disableSession=t.disable_session,this.disableSession||(this.setSessionId(),this.collect.on(Types$1$1.SessionReset,(function(){r.resetSessionId()})),this.collect.on(Types$1$1.SessionResetTime,(function(){r.updateSessionIdTime()})))},e.prototype.updateSessionIdTime=function(){var e=this.storage.getItem(this.sessionKey);if(e&&e.sessionId){var t=e.timestamp;Date.now()-t>this.expireTime?e={sessionId:sessionId$1(),timestamp:Date.now()}:e.timestamp=Date.now(),this.storage.setItem(this.sessionKey,e),this.resetExpTime()}},e.prototype.setSessionId=function(){var e=this,t=this.storage.getItem(this.sessionKey);t&&t.sessionId?t.timestamp=Date.now():t={sessionId:sessionId$1(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t),this.sessionExp=setInterval((function(){e.checkEXp()}),this.expireTime)},e.prototype.getSessionId=function(){var e=this.storage.getItem(this.sessionKey);return this.disableSession?"":e&&e.sessionId?e.sessionId:""},e.prototype.resetExpTime=function(){var e=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval((function(){e.checkEXp()}),this.expireTime))},e.prototype.resetSessionId=function(){var e={sessionId:sessionId$1(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,e)},e.prototype.checkEXp=function(){var e=this.storage.getItem(this.sessionKey);e&&e.sessionId&&Date.now()-e.timestamp+30>=this.expireTime&&(e={sessionId:sessionId$1(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e))},e}(),AutoBase$1=function(e){var t=e.app_id,r=e.channel,n=e.onTokenReady,i=LOG_URL$1[r]+"/webid",a=new Storage$1(!1),o="__tea_cache_tokens_"+t,s=a.getItem(o);s&&s.web_id?n(s.web_id):request$2(i,{app_key:"",app_id:t,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer},3e3,!1,(function(e){if(e&&0===e.e){n(e.web_id);var t={web_id:e.web_id,user_unique_id:e.web_id,timestamp:Date.now()};a.setItem(o,t)}else n("")}),(function(){n("")}),!0)},Debugger$1=function(){function e(e,t){this.devToolReady=!1,this.devToolOrigin="*",this.sendAlready=!1,this.collect=e,this.config=t,this.app_id=t.app_id,this.filterEvent=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure","bav2b_page","bav2b_beat","bav2b_page_statistics","bav2b_click","bav2b_page_exposure","_be_active","predefine_pageview","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append","predefine_page_alive","predefine_page_close","abtest_exposure"],this.load()}return e.prototype.loadScript=function(e){try{var t=document.createElement("script");t.src=e,t.onerror=function(){console.log("load DevTool render fail")},t.onload=function(){console.log("load DevTool render success")},document.getElementsByTagName("body")[0].appendChild(t)}catch(r){console.log("devTool load fail, "+r.message)}},e.prototype.load=function(){try{this.loadBaseInfo(),this.loadHook();var e=parseUrlQuery$1(window.location.href);if(!e.open_devtool_web||parseInt(e.app_id)!==this.app_id)return;this.addLintener(),this.loadDebuggerModule(),this.loadDevTool()}catch(t){console.log("debug fail, "+t.message)}},e.prototype.loadDevTool=function(){this.loadScript("https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/devtool/debug-web.js")},e.prototype.loadBaseInfo=function(){var e=this;this.info=[{title:"åŸºæœ¬ä¿¡æ¯",type:1,infoName:{app_id:this.config.app_id,channel:this.config.channel,"ä¸ŠæŠ¥åŸŸå":this.collect.configManager.getDomain(),"SDKç‰ˆæœ¬":SDK_VERSION$1,"SDKå¼•å…¥æ–¹å¼":SDK_TYPE$1}},{title:"ç”¨æˆ·ä¿¡æ¯",type:2,infoName:{uuid:this.collect.configManager.get("user").user_unique_id||"",web_id:this.collect.configManager.get("user").web_id||"",ssid:"ç‚¹å‡»èŽ·å–SSID"}},{title:"å…¬å…±å‚æ•°ä¿¡æ¯",type:2,infoName:{"æµè§ˆå™¨":this.collect.configManager.get("browser"),"æµè§ˆå™¨ç‰ˆæœ¬":this.collect.configManager.get("browser_version"),"å¹³å°":this.collect.configManager.get("platform"),"è®¾å¤‡åž‹å·":this.collect.configManager.get("device_model"),"æ“ä½œç³»ç»Ÿ":this.collect.configManager.get("os_name"),"æ“ä½œç³»ç»Ÿç‰ˆæœ¬":this.collect.configManager.get("os_version"),"å±å¹•åˆ†è¾¨çŽ‡":this.collect.configManager.get("os_version"),"æ¥æº":this.collect.configManager.get("referrer"),"è‡ªå®šä¹‰ä¿¡æ¯":""}},{title:"é…ç½®ä¿¡æ¯",type:3,infoName:{"å…¨åŸ‹ç‚¹":!!this.config.autotrack,"åœç•™æ—¶é•¿":!!this.config.enable_stay_duration}},{title:"A/Bé…ç½®ä¿¡æ¯",type:4,infoName:{"A/Bå®žéªŒ":!!this.config.enable_ab_test}},{title:"å®¢æˆ·ç«¯ä¿¡æ¯",type:3,infoName:{"æ‰“é€šå¼€å…³":!!this.config.Native}}],this.log=[],this.event=[],this.collect.on(Types$1$1.Ready,(function(){e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id,e.info[2].infoName["è‡ªå®šä¹‰ä¿¡æ¯"]=JSON.stringify(e.collect.configManager.get("custom")),e.config.enable_ab_test&&(e.info[4].infoName["å·²æ›å…‰VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["A/BåŸŸå"]=e.config.ab_channel_domain||decodeUrl$1(AB_DOMAINS$1[e.config.channel]),e.info[4].infoName["å…¨éƒ¨é…ç½®"]=e.collect.configManager.getAbData()),e.config.Native&&(e.info[5].infoName["æ˜¯å¦æ‰“é€š"]=!!e.collect.bridgeReport)}))},e.prototype.loadHook=function(){var e=this;this.collect.on(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,(function(t){switch(t.type){case DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK:var r={time:t.time,type:t.logType||"sdk",level:t.level,name:t.info,show:!0,levelShow:!0,needDesc:!!t.data};return t.data&&(r.desc={content:JSON.stringify(t.data)}),e.updateLog(r),t.secType&&"AB"===t.secType?(e.info[4].infoName["å·²æ›å…‰VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["å…¨éƒ¨é…ç½®"]=e.collect.configManager.getAbData()):"USER"===t.secType&&(e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id),void e.updateInfo();case DebuggerMesssge$1$1.DEBUGGER_MESSAGE_EVENT:if(t.data&&t.data.length){var n=t.data[0],i=n.events;if(!i.length)return;i.forEach((function(r){r.checkShow=!0,r.searchShow=!0,r.success=t.status,r.type=-1!==e.filterEvent.indexOf(r.event)?"sdk":"cus",r.type=e.collect.bridgeReport?"bridge":r.type,r.info="","fail"===t.status&&(r.info={message:"code: "+t.code+"ï¼Œ msg: "+t.failType})})),e.updateEvent(n)}return}}))},e.prototype.addLintener=function(){var e=this;window.addEventListener("message",(function(t){if(t&&t.data&&"devtool:web:ready"===t.data.type){if(e.devToolOrigin=t.origin,e.devToolReady=!0,e.sendAlready)return;console.log("inittttt"),e.sendData("devtool:web:init",{info:e.info,log:e.log,event:e.event}),e.sendAlready=!0}t&&t.data&&"devtool:web:ssid"===t.data.type&&e.collect.getToken((function(t){e.info[1].infoName.ssid=t.tobid,e.updateInfo()}))}))},e.prototype.sendData=function(e,t){try{var r={type:e,payload:t};(window.opener||window.parent).postMessage(r,this.devToolOrigin)}catch(n){}},e.prototype.updateInfo=function(){this.devToolReady&&this.sendData("devtool:web:info",this.info)},e.prototype.updateLog=function(e){this.devToolReady?this.sendData("devtool:web:log",e):this.log.push(e)},e.prototype.updateEvent=function(e){this.devToolReady?this.sendData("devtool:web:event",e):this.event.push(e)},e.prototype.loadDebuggerModule=function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.appendChild(document.createTextNode("#debugger-applog-web {\n      position: absolute;\n      width: 90px;\n      height: 30px;\n      background: #23c243;\n      border-radius: 6px;\n      color: #fff;\n      font-size: 12px;\n      bottom: 5%;\n      right: 10%;\n      text-align: center;\n      line-height: 30px;\n      cursor: pointer;\n      z-index:100;\n    }")),e.appendChild(t);var r=document.createElement("div");r.innerHTML='<div id="debugger-applog-web" class="debugger-applog-web">AppLogè°ƒè¯•</div>';var n=document.createElement("div");n.innerHTML='<div id="debugger-container" class="debugger-container"></div>',document.getElementsByTagName("body")[0].appendChild(r),document.getElementsByTagName("body")[0].appendChild(n),document.getElementById("debugger-applog-web").addEventListener("click",(function(){(window.opener||window.parent).postMessage({type:"devtool:web:open-draw"},location.origin)}))},e}(),sdk_type="base";sdk_type="full";var Collector$2=function(){function e(e){this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroyInstance=!1,this.sdkReady=!1,this.adapters={},this.name=e,this.hook=new Hook$1,this.remotePlugin=new Map,this.Types=Types$1$1,this.adapters.fetch=fetch$1$1,this.adapters.storage=Storage$1}return e.usePlugin=function(t,r,n){if(r){for(var i=!1,a=0,o=e.plugins.length;a<o;a++)if(e.plugins[a].name===r){e.plugins[a].plugin=t,e.plugins[a].options=n||{},i=!0;break}i||e.plugins.push({name:r,plugin:t,options:n})}else e.plugins.push({plugin:t})},e.prototype.usePlugin=function(e,t,r){e&&("full"===sdk_type&&this.remotePlugin.get(e)?console.info("your sdk version has "+e+" already ~"):t?"string"==typeof t?this.remotePlugin.get(e)||this.remotePlugin.set(e,{src:t,call:r}):this.remotePlugin.get(e)||this.remotePlugin.set(e,{instance:t}):this.remotePlugin.get(e)||this.remotePlugin.set(e,"sdk"))},e.prototype.init=function(t){var r=this;this.inited?console.warn("[instance: "+this.name+"], every instance's api: init,  can be call only one time!"):t&&isObject$4(t)?t.app_id&&isNumber$2(t.app_id)?!t.app_key||isString$1(t.app_key)?(t.channel_domain||-1!==["cn","sg","va"].indexOf(t.channel)||(console.warn("channel must be `cn`, `sg`,`va` !!!"),t.channel="cn"),this.logger=new Logger$4(this.name,t.log),this.appBridge=new AppBridge$1(this,t.Native),this.bridgeReport=this.appBridge.bridgeInject(),this.configManager=new ConfigManager$1(this,t),this.debugger=new Debugger$1(this,t),this.initConfig=t,this.emit(Types$1$1.Init),this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK æ‰§è¡ŒINIT",data:t,level:"info",time:Date.now()}),t.disable_auto_pv&&(this.disableAutoPageView=!0),this.bridgeReport||(this.configManager.set({app_id:t.app_id}),this.eventManager=new Event$3,this.tokenManager=new Token$1,this.sessionManager=new Session$1,Promise.all([new Promise((function(e){r.once(Types$1$1.TokenComplete,(function(){e(!0)}))})),new Promise((function(e){r.once(Types$1$1.Start,(function(){e(!0)}))}))]).then((function(){try{e.plugins.reduce((function(e,t){var n=t.plugin,i=t.options,a=Object.assign(r.initConfig,i),o=new n;return o.apply(r,a),e.push(o),e}),r.pluginInstances)}catch(n){console.log("load plugin error, "+n.message),r.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:n.message})}r.sdkReady=!0,r.emit(Types$1$1.Ready),r.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK åˆå§‹åŒ–å®Œæˆ",time:Date.now(),level:"info",data:r.configManager.get("user")}),r.logger.info("appid: "+t.app_id+", userInfo:"+JSON.stringify(r.configManager.get("user"))),r.logger.info("appid: "+t.app_id+", sdk is ready, version is "+SDK_VERSION$1+", you can report now !!!"),t.disable_auto_pv&&(r.disableAutoPageView=!0);try{(t.enable_ab_test||t.autotrack)&&(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(n){r.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:n.message})}r.pageView(),r.on(Types$1$1.TokenChange,(function(e){"webid"===e&&r.pageView(),r.logger.info("appid: "+t.app_id+" token change, new userInfo:"+JSON.stringify(r.configManager.get("user"))),r.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK è®¾ç½®äº†ç”¨æˆ·ä¿¡æ¯",time:Date.now(),secType:"USER",level:"info",data:r.configManager.get("user")})})),r.on(Types$1$1.TokenReset,(function(){r.logger.info("appid: "+t.app_id+" token reset, new userInfo:"+JSON.stringify(r.configManager.get("user"))),r.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK é‡ç½®äº†ç”¨æˆ·ä¿¡æ¯",time:Date.now(),secType:"USER",level:"info",data:r.configManager.get("user")})})),r.on(Types$1$1.RouteChange,(function(e){e.init||t.disable_route_report||r.pageView()}));try{(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(n){}})),this.tokenManager.apply(this,t),this.eventManager.apply(this,t),this.sessionManager.apply(this,t)),this.inited=!0):console.warn("app_key param is error, must be string, please check!"):console.warn("app_id param is error, must be number, please check!"):console.warn("init params error,please check")},e.prototype.config=function(e){if(this.inited)if(e&&isObject$4(e))if(this.bridgeReport)this.appBridge.setConfig(e);else{e._staging_flag&&1===e._staging_flag&&(this.staging=!0),e.disable_auto_pv&&(this.disableAutoPageView=!0,delete e.disable_auto_pv);var t=_assign({},e);if(this.initConfig&&this.initConfig.configPersist){var r=this.configManager.getStore();r&&(t=Object.assign(r,e)),this.configManager.setStore(e)}t.web_id,t.user_unique_id;var n=__rest(t,["web_id","user_unique_id"]);t.hasOwnProperty("web_id")&&this.emit(Types$1$1.ConfigWebId,t.web_id),t.hasOwnProperty("user_unique_id")&&this.emit(Types$1$1.ConfigUuid,t.user_unique_id),this.configManager.set(n),this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK æ‰§è¡ŒCONFIG",level:"info",time:Date.now(),data:t})}else console.warn("config params is error, please check");else console.warn("config must be use after function init")},e.prototype.setDomain=function(e){this.configManager&&this.configManager.setDomain(e),this.emit(Types$1$1.ConfigDomain)},e.prototype.getConfig=function(e){return this.configManager.get(e)},e.prototype.send=function(){this.start()},e.prototype.start=function(){this.inited&&!this.sended&&(this.sended=!0,this.emit(Types$1$1.Start),this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK æ‰§è¡ŒSTART",level:"info",time:Date.now()}),this.bridgeReport&&(this.pageView(),this.emit(Types$1$1.Ready)))},e.prototype.event=function(e,t){var r=this;try{if(this.initConfig&&this.initConfig.disable_track_event)return;var n=[];Array.isArray(e)?e.forEach((function(e){n.push(r.processEvent(e[0],e[1]||{}))})):n.push(this.processEvent(e,t)),this.bridgeReport?n.forEach((function(e){var t=e.event,n=e.params;r.appBridge.onEventV3(t,JSON.stringify(n))})):n.length&&(this.emit(Types$1$1.Event,n),this.emit(Types$1$1.SessionResetTime))}catch(i){console.warn("something error, please check"),this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:i.message})}},e.prototype.beconEvent=function(e,t){if(!this.initConfig||!this.initConfig.disable_track_event)if(Array.isArray(e))console.warn("beconEvent not support batch report, please check");else{var r=[];r.push(this.processEvent(e,t||{})),r.length&&(this.emit(Types$1$1.BeconEvent,r),this.emit(Types$1$1.SessionResetTime))}},e.prototype.processEvent=function(e,t){void 0===t&&(t={});try{var r=e;/^event\./.test(e)&&(r=e.slice(6));var n=t;"object"!=_typeof$7(n)&&(n={}),n.profile?delete n.profile:n.event_index=getIndex$1();var i=void 0;return n.local_ms?(i=n.local_ms,delete n.local_ms):i=+new Date,{event:r,params:n,local_time_ms:i,is_bav:this.initConfig&&this.initConfig.autotrack?1:0}}catch(a){return this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:a.message}),{event:e,params:t}}},e.prototype.filterEvent=function(e){this.eventFilter=e},e.prototype.on=function(e,t){this.hook.on(e,t)},e.prototype.once=function(e,t){this.hook.once(e,t)},e.prototype.off=function(e,t){this.hook.off(e,t)},e.prototype.emit=function(e,t,r){this.hook.emit(e,t,r)},e.prototype.set=function(e){this.hook.set(e)},e.prototype.pageView=function(){this.disableAutoPageView||this.predefinePageView()},e.prototype.predefinePageView=function(e){void 0===e&&(e={});var t={title:document.title||location.pathname,url:location.href,url_path:location.pathname,time:Date.now(),referrer:window.document.referrer,$is_first_time:""+this.configManager.is_first_time},r=_assign({},t,e);this.event("predefine_pageview",r)},e.prototype.clearEventCache=function(){this.emit(Types$1$1.CleanEvents)},e.prototype.setWebIDviaUnionID=function(e){if(e){var t=hashCode$1(e);this.config({web_id:""+t,wechat_unionid:e}),this.emit(Types$1$1.CustomWebId)}},e.prototype.setWebId=function(e){this.config({web_id:""+e})},e.prototype.setWebIDviaOpenID=function(e){if(e){var t=hashCode$1(e);this.config({web_id:""+t,wechat_openid:e}),this.emit(Types$1$1.CustomWebId)}},e.prototype.setNativeAppId=function(e){this.bridgeReport&&this.appBridge.setNativeAppId(e)},e.prototype.resetStayDuration=function(e,t,r){this.emit(Types$1$1.ResetStay,{url_path:e,title:t,url:r},Types$1$1.Stay)},e.prototype.resetStayParams=function(e,t,r){void 0===e&&(e=""),void 0===t&&(t=""),void 0===r&&(r=""),this.emit(Types$1$1.SetStay,{url_path:e,title:t,url:r},Types$1$1.Stay)},e.prototype.getToken=function(e,t){var r=this,n=!1,i=function(t){if(!n){n=!0;var i=r.configManager.get().user;return t&&(i.tobid=t,i["diss".split("").reverse().join("")]=t),e(_assign({},i))}},a=function(){r.tokenManager.getTobId().then((function(e){i(e)}))};this.sdkReady?a():(t&&setTimeout((function(){i()}),t),this.on(Types$1$1.Ready,(function(){a()})))},e.prototype.profileSet=function(e){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(e)):this.emit(Types$1$1.ProfileSet,e,Types$1$1.Profile),this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK æ‰§è¡ŒprofileSet",level:"info",time:Date.now(),data:e})},e.prototype.profileSetOnce=function(e){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(e)):this.emit(Types$1$1.ProfileSetOnce,e,Types$1$1.Profile),this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK æ‰§è¡ŒprofileSetOnce",level:"info",time:Date.now(),data:e})},e.prototype.profileIncrement=function(e){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(e)):this.emit(Types$1$1.ProfileIncrement,e,Types$1$1.Profile),this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK æ‰§è¡ŒprofileIncrement",level:"info",time:Date.now(),data:e})},e.prototype.profileUnset=function(e){this.bridgeReport?this.appBridge.profileUnset(e):this.emit(Types$1$1.ProfileUnset,e,Types$1$1.Profile),this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK æ‰§è¡ŒprofileUnset",level:"info",time:Date.now(),data:e})},e.prototype.profileAppend=function(e){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(e)):this.emit(Types$1$1.ProfileAppend,e,Types$1$1.Profile),this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK æ‰§è¡ŒprofileAppend",level:"info",time:Date.now(),data:e})},e.prototype.setExternalAbVersion=function(e){this.emit(Types$1$1.AbExternalVersion,"string"==typeof e&&e?(""+e).trim():null,Types$1$1.Ab)},e.prototype.getVar=function(e,t,r){this.emit(Types$1$1.AbVar,{name:e,defaultValue:t,callback:r},Types$1$1.Ab)},e.prototype.getABconfig=function(e,t){this.emit(Types$1$1.AbConfig,{params:e,callback:t},Types$1$1.Ab)},e.prototype.getAbSdkVersion=function(){return this.configManager.getAbVersion()},e.prototype.onAbSdkVersionChange=function(e){var t=this;return this.emit(Types$1$1.AbVersionChangeOn,e,Types$1$1.Ab),function(){t.emit(Types$1$1.AbVersionChangeOff,e,Types$1$1.Ab)}},e.prototype.offAbSdkVersionChange=function(e){this.emit(Types$1$1.AbVersionChangeOff,e,Types$1$1.Ab)},e.prototype.openOverlayer=function(){this.emit(Types$1$1.AbOpenLayer,"",Types$1$1.Ab)},e.prototype.closeOverlayer=function(){this.emit(Types$1$1.AbCloseLayer,"",Types$1$1.Ab)},e.prototype.getAllVars=function(e){this.emit(Types$1$1.AbAllVars,e,Types$1$1.Ab)},e.prototype.autoInitializationRangers=function(e){AutoBase$1(e)},e.prototype.destoryInstace=function(){this.destroyInstance||(this.destroyInstance=!0,this.off(Types$1$1.TokenComplete))},e.plugins=[],e}(),STYLE_ID="__rangers_ab_style__";function openOverlayer(){if(!document.getElementById(STYLE_ID)){var e="body { opacity: 0 !important; }",t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.id=STYLE_ID,r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),t.appendChild(r)}}function closeOverlayer(){var e=document.getElementById(STYLE_ID);e&&e.parentElement.removeChild(e)}var msgQueueMap={},allowdOrigins=[],addAllowdOrigin=function(e){e.length&&e.forEach((function(e){allowdOrigins.push(e)}))};function dispatchMsg(e,t,r,n){var i=e&&e.source||window.opener||window.parent,a=e&&e.origin||n||"*",o={type:t,payload:r};i.postMessage(JSON.stringify(o),a)}function receiveMsg(e,t){msgQueueMap[e]=msgQueueMap[e]||[],msgQueueMap[e].push(t)}function processMsg(e){if(allowdOrigins.some((function(e){return"*"===e}))||allowdOrigins.some((function(t){return e.origin.indexOf(t)>-1}))){var t=e.data;if("string"==typeof e.data)try{t=JSON.parse(e.data)}catch(i){t=void 0}if(!t)return;var r=t.type,n=t.payload;msgQueueMap[r]&&msgQueueMap[r].forEach((function(t){"function"==typeof t&&t(e,n)}))}}function init$1(e,t){var r=_assign({},e);delete r.filter,(window.opener||window.parent).postMessage({type:"tea:sdk:info",config:r,version:t},"*"),window.addEventListener("message",processMsg,!1)}var VISUAL_URL="",isLoaded=!1;function loadEditorScript(e){var t=e.event,r=e.editorUrl;e.collectInstance,e.fromSession,isLoaded||(isLoaded=!0,loadScript(r,(function(){dispatchMsg(t,"abEditorScriptloadSuccess")}),(function(){t&&dispatchMsg(t,"abEditorScriptloadError"),isLoaded=!1})))}function readyToLoadEditor(e,t){window.TEAVisualEditor=window.TEAVisualEditor||{},addAllowdOrigin(["*"]);var r,n="";init$1(t,SDK_VERSION$1);var i="";try{var a=window.performance.getEntriesByType("resource");if(a&&a.length&&(a.forEach((function(e){"script"===e.initiatorType&&e.name&&-1!==e.name.indexOf("collect")&&(i=e.name)})),i||document.currentScript&&(i=document.currentScript.src),i&&(r=i.split("/"))&&r.length)){n="https:/";for(var o=2;o<r.length&&o!==r.length-1;o++)n=n+"/"+r[o];n+="/visual-ab-core"}}catch(s){}receiveMsg("tea:openVisualABEditor",(function(r){var i=r.data;if("string"==typeof r.data)try{i=JSON.parse(r.data)}catch(s){i=void 0}if(i){var a=i.lang;if(i.appId!==t.app_id)return dispatchMsg(r,"appIdError"),void console.error("abtest appid is not belong the page appid please check");var o=i.version;VISUAL_URL=o&&n?n+(o?"."+o:".1.0.1")+".js?query="+Date.now():VISUAL_AB_CORE+"?query="+Date.now(),window.TEAVisualEditor.lang=a,window.TEAVisualEditor.__ab_domin=t.channel_domain||"",loadEditorScript({event:r,editorUrl:VISUAL_URL,collectInstance:e})}}))}var loadMuiltlink=function(e,t){window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.appId=t.app_id,receiveMsg("tea:openTesterEventInspector",(function(t){var r=t.data;if("string"==typeof t.data)try{r=JSON.parse(t.data)}catch(o){r=void 0}if(r){var n=r.referrer,i=r.lang,a=r.appId;window.TEAVisualEditor.__editor_ajax_domain=n||"",window.TEAVisualEditor.__ab_appId=a||"",window.TEAVisualEditor.lang=i||"",loadEditorScript({event:t,editorUrl:VISUAL_URL_INSPECTOR+".js?query="+Date.now(),collectInstance:e})}}))},loadVisual=function(e){window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.__ab_config=e,loadScript(VISUAL_AB_LOADER+"?query="+Date.now(),(function(){console.log("load visual render success")}),(function(){console.log("load visual render fail")}))},CallbackType;!function(e){e[e.Var=0]="Var",e[e.All=1]="All"}(CallbackType||(CallbackType={}));var STORAGE_EXPRIRE=2592e6,API="/service/2/abtest_config/",Ab=function(){function e(){this.fetchStatus="no",this.refreshFetchStatus="complete",this.versions=[],this.extVersions=[],this.mulilinkVersions=[],this.enable_multilink=!1,this.enable_ab_visual=!1,this.editMode=!1,this.callbacks=[],this.data=null,this.changeListener=new Map,this.readyStatus=!1,this.exposureCache=[]}return e.prototype.apply=function(e,t){var r=this;if(this.collect=e,this.config=t,this.config.enable_ab_test){var n=t.enable_multilink,i=t.ab_channel_domain,a=t.enable_ab_visual,o=i||decodeUrl$1(AB_DOMAINS$1[t.channel||"cn"]),s=e.adapters,u=s.storage,c=s.fetch;this.cacheStorgae=new u(!1),this.fetch=c,this.enable_multilink=n,this.enable_ab_visual=a,this.abKey="__tea_sdk_ab_version_"+t.app_id,this.fetchUrl=""+o+API,this.reportUrl=""+e.configManager.getUrl("event"),this.exposureLimit=t.exposure_limit||20,this.ab_batch_time=t.ab_batch_time||500;var l=this.collect.Types;this.types=l,this.collect.on(l.TokenChange,(function(e){"uuid"===e&&r.readyStatus&&(r.clearCache(),r.fetchAB())})),this.collect.on(l.AbVar,(function(e){var t=e.name,n=e.defaultValue,i=e.callback;r.getVar(t,n,i)})),this.collect.on(l.AbAllVars,(function(e){r.getAllVars(e)})),this.collect.on(l.AbConfig,(function(e){var t=e.params,n=e.callback;r.getABconfig(t,n)})),this.collect.on(l.AbExternalVersion,(function(e){r.setExternalAbVersion(e)})),this.collect.on(l.AbOpenLayer,(function(){r.openOverlayer()})),this.collect.on(l.AbCloseLayer,(function(){r.closeOverlayer()})),this.collect.on(l.AbVersionChangeOn,(function(e){r.changeListener.set(e,e)})),this.collect.on(l.AbVersionChangeOff,(function(e){r.changeListener.get(e)&&r.changeListener.delete(e)})),this.loadMode(),(this.enable_ab_visual||this.enable_multilink)&&this.openOverlayer(this.config.multilink_timeout_ms||500),this.checkLocal(),this.ready("ab"),this.readyStatus||(this.fetchAB(),this.readyStatus=!0),this.collect.emit(l.AbReady)}},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var r=this.collect.hook._hooksCache[e];if(!Object.keys(r).length)return;var n=function(e){r[e].length&&r[e].forEach((function(r){t.collect.hook.emit(e,r)}))};for(var i in r)n(i)}},e.prototype.loadMode=function(){var e=getIframeUrl(),t="";if(e){var r=e.scenario,n=e.href;r?(this.editMode=!0,t=r):!n||-1===n.indexOf("datatester")&&-1===n.indexOf("visual-editor")||(this.editMode=!0,t="visual-editor")}this.enable_ab_visual&&(readyToLoadEditor(this.collect,this.config),"visual-editor"===t)?this.collect.destoryInstace():this.enable_multilink&&loadMuiltlink(this.collect,this.config)},e.prototype.checkLocal=function(){var e=this.getABCache(),t=e.ab_version,r=e.ab_ext_version,n=e.ab_version_multilink,i=e.data,a=this.checkFromUrl();a?this.mulilinkVersions.push(a):this.mulilinkVersions=n||[],this.extVersions=r||[],this.versions=t||[],this.data=i;var o=this.versions.concat(this.extVersions);this.enable_multilink&&(o=o.concat(this.mulilinkVersions)),this.configVersions(o.join(","))},e.prototype.checkFromUrl=function(){var e=parseUrlQuery$1(window.location.href);return e&&e.vid?e.vid:""},e.prototype.updateVersions=function(){var e=this.extVersions.length?this.versions.concat(this.extVersions):this.versions,t=e.concat(this.mulilinkVersions);this.configVersions(t.join(",")),this.updateABCache(),this.changeListener.size>0&&this.changeListener.forEach((function(t){"function"==typeof t&&t(e)}))},e.prototype.configVersions=function(e){this.collect.configManager.setAbVersion(e)},e.prototype.getVar=function(e,t,r){if(!e)throw new Error("variable must not be empty");if(void 0===t)throw new Error("variable no default value");if("function"!=typeof r)throw new Error("callback must be a function");var n={name:e,defaultValue:t,callback:r,type:CallbackType.Var};"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealVar(n,e):this.callbacks.push(n)},e.prototype.getRealVar=function(e,t){var r=e.name,n=e.defaultValue,i=e.callback,a=this.data;if(a){if(isObject$4(a[r])){var o=a[r].vid;return"$ab_url"===t?this.mulilinkVersions.includes(o)||this.mulilinkVersions.push(o):this.versions.includes(o)||this.versions.push(o),this.updateVersions(),this.fechEvent(o,t,n),i(a[r].val),void this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK æ›å…‰äº†å®žéªŒ"+r,level:"info",time:Date.now(),data:a[r]})}this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK è°ƒç”¨getVar",level:"info",time:Date.now(),data:n}),i(n)}else i(n)},e.prototype.getAllVars=function(e){if("function"!=typeof e)throw new Error("callback must be a function");var t={callback:e,type:CallbackType.All};"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealAllVars(t):this.callbacks.push(t)},e.prototype.getRealAllVars=function(e){(0,e.callback)(this.data?JSON.parse(JSON.stringify(this.data)):{}),this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK è°ƒç”¨getAllVars",level:"info",time:Date.now(),data:this.data})},e.prototype.fechEvent=function(e,t,r){try{if(this.config.disable_track_event)return;if(!e)return;var n=this.collect.configManager.get(),i=n.header,a=n.user,o=this.getABCache();if(o&&o.uuid&&o.uuid!==a.user_unique_id)return;var s={event:"abtest_exposure",ab_sdk_version:""+e,params:JSON.stringify({app_id:this.config.appId,ab_url:"$ab_url"===t?r:window.location.href}),local_time_ms:Date.now()};i.custom=JSON.stringify(i.custom);var u={events:[s],user:a,header:i};"$ab_url"===t&&window.navigator.sendBeacon?window.navigator.sendBeacon(this.reportUrl,JSON.stringify([u])):this.reportExposure(u)}catch(c){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:c.message})}},e.prototype.reportExposure=function(e){var t=this;this.exposureCache.push(e),this.reportTimeout&&clearTimeout(this.reportTimeout),this.exposureCache.length>=this.exposureLimit?this.report():this.reportTimeout=setTimeout((function(){t.report(),clearTimeout(t.reportTimeout)}),this.ab_batch_time)},e.prototype.report=function(){var e=this;this.fetch(this.reportUrl,this.exposureCache,2e4),this.exposureCache.forEach((function(t){e.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_EVENT,info:"åŸ‹ç‚¹ä¸ŠæŠ¥æˆåŠŸ",time:Date.now(),data:[t],code:200,status:"success"})})),this.exposureCache=[]},e.prototype.setExternalAbVersion=function(e){this.extVersions=[e],this.updateVersions()},e.prototype.getABconfig=function(e,t){var r=Object.keys(e);r&&r.length&&this.collect.configManager.set(e),this.fetchAB(t)},e.prototype.getABCache=function(e){var t={ab_version:[],ab_ext_version:[],ab_version_multilink:[],data:null,timestamp:+new Date,uuid:""};return t=this.cacheStorgae.getItem(this.abKey)||t,Date.now()-t.timestamp>=STORAGE_EXPRIRE?(this.cacheStorgae.removeItem(this.abKey),null):e?t[e]:t},e.prototype.updateABCache=function(){var e=this.getABCache();e.ab_version_multilink=this.mulilinkVersions,e.ab_ext_version=this.extVersions,e.ab_version=this.versions,e.timestamp=Date.now(),this.cacheStorgae.setItem(this.abKey,e)},e.prototype.setAbCache=function(e){var t=this.getABCache();t.data=this.data,t.uuid=e,t.timestamp=Date.now(),this.cacheStorgae.setItem(this.abKey,t),this.collect.configManager.setAbData(this.data)},e.prototype.clearCache=function(){this.refreshFetchStatus="ing",this.data={},this.extVersions=[],this.mulilinkVersions=[],this.versions=[]},e.prototype.openOverlayer=function(e){var t=this;if(openOverlayer(),e)var r=setTimeout((function(){t.closeOverlayer(),clearTimeout(r)}),e)},e.prototype.closeOverlayer=function(){closeOverlayer()},e.prototype.fetchComplete=function(e,t){var r=this;if(e&&"[object Object]"==Object.prototype.toString.call(e)){this.data=e,this.setAbCache(t);var n=[];Object.keys(e).forEach((function(t){var r=e[t].vid;r&&n.push(r)})),this.versions=this.versions.filter((function(e){return n.includes(e)}));var i=e.$ab_url,a=e.$ab_modification;if(a&&a.val&&this.enable_ab_visual){if(this.collect.destroyInstance)return;this.getVar("$ab_modification",window.location.href,(function(){loadVisual(a.val)}))}else if(i&&this.enable_multilink){this.mulilinkVersions=this.mulilinkVersions.filter((function(e){return n.includes(e)}));var o=i.val,s=i.vid;o&&s&&this.getVar("$ab_url",o,(function(){r.editMode||o!==window.location.href&&setTimeout((function(){if(!r.collect.destroyInstance){var e=""+o;e=-1===e.indexOf("http")?"https://"+e:e,parseURL$1(e).host!==location.host&&(e=e+"&vid="+s),window.history.replaceState("","",e),window.location.href=e}}),100)}))}this.updateVersions()}this.callbacks.forEach((function(e){return r[e.type===CallbackType.Var?"getRealVar":"getRealAllVars"](e,"")})),this.callbacks=[]},e.prototype.fetchAB=function(e){var t=this,r=window.location.href,n=this.collect.configManager.get(),i={header:_assign({aid:this.config.app_id},n.user||{},n.header||{},{ab_sdk_version:this.collect.configManager.getAbVersion(),ab_url:r})};this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK å‘èµ·ABå®žéªŒè¯·æ±‚",level:"info",logType:"fetch",time:Date.now(),data:i}),this.fetch(this.fetchUrl,i,this.config.ab_timeout||3e3,!1,(function(r){t.fetchStatus="complete",t.refreshFetchStatus="complete";var i=r.data;"success"===r.message?(t.fetchComplete(i,n.user.user_unique_id),e&&e(i)):(t.fetchComplete(null,n.user.user_unique_id),e&&e(null)),t.collect.emit(t.types.AbComplete,i),t.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"ABå®žéªŒè¯·æ±‚æˆåŠŸ",level:"info",logType:"fetch",time:Date.now(),data:i})}),(function(){t.fetchStatus="complete",t.refreshFetchStatus,t.fetchComplete(null,n.user.user_unique_id),e&&e(null),t.collect.emit(t.types.AbComplete,null),t.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"ABå®žéªŒè¯·æ±‚ç½‘ç»œå¼‚å¸¸",level:"error",logType:"fetch",time:Date.now()})}))},e.prototype.filterUrl=function(e){try{var t="";-1!==e.indexOf("&multilink=true")?t="&multilink=true[\0-Ã¿]*":-1!==e.indexOf("?multilink=true")&&(t="\\?multilink=true[\0-Ã¿]*");var r=new RegExp(t,"g");e=e.replace(r,"")}catch(n){}return e},e}(),Et=function(){function e(){}return e.prototype.apply=function(e,t){var r=this,n=e.adapters.fetch;if(t.event_verify_url)if("string"==typeof t.event_verify_url){if(this.url=t.event_verify_url+"/v1/list_test",this.url){var i=e.Types;e.on(i.SubmitBefore,(function(e){n(r.url,e,3e4)}))}}else console.log("please use correct et_test url")},e}(),Alive=function(){function e(e,t){this.maxDuration=432e5,this.aliveDTime=6e4,this.options={aliveName:"predefine_page_alive",params:{}},this.collect=e,this.config=t,this.pageStartTime=Date.now(),this.sessionStartTime=this.pageStartTime,this.timerHandler=null,isObject$4(t.enable_stay_duration)&&(this.options=Object.assign(this.options,t.enable_stay_duration))}return e.prototype.setParams=function(e,t,r){this.set_path=e,this.set_url=r,this.set_title=t},e.prototype.enable=function(e,t,r){this.url_path=e,this.url=r,this.title=t,this.disableCallback=this.enablePageAlive()},e.prototype.disable=function(){this.disableCallback(),this.pageStartTime=Date.now()},e.prototype.sendEvent=function(e,t){void 0===t&&(t=!1);var r=t?this.aliveDTime:Date.now()-this.sessionStartTime;r<0||r>this.aliveDTime||Date.now()-this.pageStartTime>this.maxDuration||(this.collect.beconEvent(this.options.aliveName,_assign({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),duration:r,is_support_visibility_change:isSupVisChange(),startTime:this.sessionStartTime,hidden:document.visibilityState,leave:e},this.options.params)),this.sessionStartTime=Date.now())},e.prototype.getParams=function(e){switch(e){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},e.prototype.setUpTimer=function(){var e=this;return this.timerHandler&&clearInterval(this.timerHandler),setInterval((function(){Date.now()-e.sessionStartTime>e.aliveDTime&&e.sendEvent(!1,!0)}),1e3)},e.prototype.visibilitychange=function(){"hidden"===document.visibilityState?this.timerHandler&&(clearInterval(this.timerHandler),this.sendEvent(!1)):"visible"===document.visibilityState&&(this.sessionStartTime=Date.now(),this.timerHandler=this.setUpTimer())},e.prototype.beforeunload=function(){document.hidden||this.sendEvent(!0)},e.prototype.enablePageAlive=function(){var e=this;this.timerHandler=this.setUpTimer();var t=this.visibilitychange.bind(this),r=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",t),beforePageUnload$1(r),function(){e.beforeunload(),document.removeEventListener("visibilitychange",t),window.removeEventListener("beforeunload",r),window.removeEventListener("pagehide",r)}},e}(),Close=function(){function e(e,t){var r=this;this.maxDuration=432e5,this.aliveDTime=6e4,this.options={closeName:"predefine_page_close",params:{}},this.visibilitychange=function(){"hidden"===document.visibilityState?r.activeEndTime=Date.now():"visible"===document.visibilityState&&(r.activeEndTime&&(r.totalTime+=r.activeEndTime-r.activeStartTime,r.activeTimes+=1),r.activeEndTime=void 0,r.activeStartTime=Date.now())},this.beforeunload=function(){if(r.totalTime+=(r.activeEndTime||Date.now())-r.activeStartTime,r.config.autotrack)try{window.sessionStorage.setItem("_tea_cache_duration",JSON.stringify({duration:r.totalTime,page_title:document.title||location.pathname}))}catch(e){}r.sendEventPageClose()},this.collect=e,this.config=t,this.maxDuration=t.maxDuration||864e5,this.pageStartTime=Date.now(),isObject$4(t.enable_stay_duration)&&(this.options=Object.assign(this.options,t.enable_stay_duration)),this.resetData()}return e.prototype.setParams=function(e,t,r){this.set_path=e,this.set_url=r,this.set_title=t},e.prototype.enable=function(e,t,r){this.url_path=e,this.url=r,this.title=t,this.disableCallback=this.enablePageClose()},e.prototype.disable=function(){this.disableCallback()},e.prototype.resetData=function(){this.activeStartTime=void 0===this.activeStartTime?this.pageStartTime:Date.now(),this.activeEndTime=void 0,this.activeTimes=1,this.totalTime=0},e.prototype.sendEventPageClose=function(){var e=Date.now()-this.pageStartTime;this.totalTime<0||e<0||this.totalTime>=this.maxDuration||(this.collect.beconEvent(this.options.closeName,_assign({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),active_times:this.activeTimes,duration:this.totalTime,total_duration:e,is_support_visibility_change:isSupVisChange()},this.options.params)),this.pageStartTime=Date.now(),this.resetData())},e.prototype.getParams=function(e){switch(e){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},e.prototype.enablePageClose=function(){var e=this,t=this.visibilitychange.bind(this),r=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",t),beforePageUnload$1(r),function(){e.beforeunload(),document.removeEventListener("visibilitychange",t),window.removeEventListener("beforeunload",r),window.removeEventListener("pagehide",r)}},e}(),Stay=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;if(this.collect=e,this.config=t,this.config.enable_stay_duration){this.title=document.title||location.pathname,this.url=location.href,this.url_path=location.pathname,this.pageAlive=new Alive(e,t),this.pageClose=new Close(e,t);var n=this.collect.Types;this.collect.on(n.ResetStay,(function(e){var t=e.url_path,n=e.title,i=e.url;r.resetStayDuration(t,n,i)})),this.collect.on(n.RouteChange,(function(e){e.init||t.disable_route_report||r.resetStayDuration()})),this.collect.on(n.SetStay,(function(e){var t=e.url_path,n=e.title,i=e.url;r.setStayParmas(t,n,i)})),this.enable(this.url_path,this.title,this.url),this.ready(n.Stay),this.collect.emit(n.StayReady)}},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var r=this.collect.hook._hooksCache[e];if(!Object.keys(r).length)return;var n=function(e){r[e].length&&r[e].forEach((function(r){t.collect.hook.emit(e,r)}))};for(var i in r)n(i)}},e.prototype.enable=function(e,t,r){this.pageAlive.enable(e,t,r),this.pageClose.enable(e,t,r)},e.prototype.disable=function(){this.pageAlive.disable(),this.pageClose.disable()},e.prototype.setStayParmas=function(e,t,r){void 0===e&&(e=""),void 0===t&&(t=""),void 0===r&&(r=""),this.pageAlive.setParams(e,t,r),this.pageClose.setParams(e,t,r),this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK æ‰§è¡Œ resetStayParams",level:"info",time:Date.now(),data:{url_path:e,title:t,url:r}})},e.prototype.reset=function(e,t,r){this.disable(),this.enable(e,t,r)},e.prototype.resetStayDuration=function(e,t,r){this.reset(e,t,r),this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK æ‰§è¡Œ resetStayDuration",level:"info",time:Date.now(),data:{url_path:e,title:t,url:r}})},e}(),Profile=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.config=t,this.duration=6e4,this.reportUrl=e.configManager.getDomain()+"/profile/list";var n=e.Types,i=e.adapters.fetch;this.eventCheck=new EventCheck$1(e,t),this.fetch=i,this.cache={},this.collect.on(n.ProfileSet,(function(e){r.setProfile(e)})),this.collect.on(n.ProfileSetOnce,(function(e){r.setOnceProfile(e)})),this.collect.on(n.ProfileUnset,(function(e){r.unsetProfile(e)})),this.collect.on(n.ProfileIncrement,(function(e){r.incrementProfile(e)})),this.collect.on(n.ProfileAppend,(function(e){r.appendProfile(e)})),this.collect.on(n.ProfileClear,(function(){r.cache={}})),this.ready(n.Profile)},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var r=this.collect.hook._hooksCache[e];if(!Object.keys(r).length)return;var n=function(e){r[e].length&&r[e].forEach((function(r){t.collect.hook.emit(e,r)}))};for(var i in r)n(i)}},e.prototype.report=function(e,t){void 0===t&&(t={});try{if(this.config.disable_track_event)return;var r=[];r.push(this.collect.processEvent(e,t));var n=this.collect.eventManager.merge(r);this.fetch(this.reportUrl,n),this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_EVENT,info:"åŸ‹ç‚¹ä¸ŠæŠ¥æˆåŠŸ",time:Date.now(),data:n,code:200,status:"success"})}catch(i){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:i.message})}},e.prototype.setProfile=function(e){var t=this.formatParams(e);t&&Object.keys(t).length&&(this.pushCache(t),this.report("__profile_set",_assign({},t,{profile:!0})))},e.prototype.setOnceProfile=function(e){var t=this.formatParams(e,!0);t&&Object.keys(t).length&&(this.pushCache(t),this.report("__profile_set_once",_assign({},t,{profile:!0})))},e.prototype.incrementProfile=function(e){e?this.report("__profile_increment",_assign({},e,{profile:!0})):console.warn("please check the params, must be object!!!")},e.prototype.unsetProfile=function(e){if(e){var t={};t[e]="1",this.report("__profile_unset",_assign({},t,{profile:!0}))}else console.warn("please check the key, must be string!!!")},e.prototype.appendProfile=function(e){if(e){var t={};for(var r in e)"string"==typeof e[r]||"Array"===Object.prototype.toString.call(e[r]).slice(8,-1)?t[r]=e[r]:console.warn("please check the value of param: "+r+", must be string or array !!!");Object.keys(t).length&&this.report("__profile_append",_assign({},t,{profile:!0}))}else console.warn("please check the params, must be object!!!")},e.prototype.pushCache=function(e){var t=this;Object.keys(e).forEach((function(r){t.cache[r]={val:t.clone(e[r]),timestamp:Date.now()}}))},e.prototype.formatParams=function(e,t){var r=this;void 0===t&&(t=!1);try{if(!e||"[object Object]"!==Object.prototype.toString.call(e))return void console.warn("please check the params type, must be object !!!");var n={};for(var i in e)"string"==typeof e[i]||"number"==typeof e[i]||"Array"===Object.prototype.toString.call(e[i]).slice(8,-1)?n[i]=e[i]:console.warn("please check the value of params:"+i+", must be string,number,Array !!!");var a=Object.keys(n);if(!a.length)return;if(!this.eventCheck.checkEventParams(n))return;var o=Date.now();return a.filter((function(n){var i=r.cache[n];return t?!i:!(i&&r.compare(i.val,e[n])&&o-i.timestamp<r.duration)})).reduce((function(e,t){return e[t]=n[t],e}),{})}catch(s){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:s.message}),console.log("error")}},e.prototype.compare=function(e,t){try{return JSON.stringify(e)===JSON.stringify(t)}catch(r){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:r.message}),!1}},e.prototype.clone=function(e){try{return JSON.parse(JSON.stringify(e))}catch(t){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:t.message}),e}},e.prototype.unReady=function(){console.warn("sdk is not ready, please use this api after start")},e}(),HeartBeat=function(){function e(){var e=this;this.setInterval=function(){e.clearIntervalFunc=selfAdjust((function(){e.isSessionhasEvent&&e.endCurrentSession()}),e.sessionInterval)},this.clearInterval=function(){e.clearIntervalFunc&&e.clearIntervalFunc()}}return e.prototype.apply=function(e,t){var r=this;if(this.collect=e,!t.disable_heartbeat){this.sessionInterval=6e4,this.startTime=0,this.lastTime=0,this.setInterval();var n=this.collect.Types;this.collect.on(n.SessionReset,(function(){r.process()}))}},e.prototype.endCurrentSession=function(){this.collect.event("_be_active",{start_time:this.startTime,end_time:this.lastTime,url:window.location.href,referrer:window.document.referrer,title:document.title||location.pathname}),this.isSessionhasEvent=!1,this.startTime=0},e.prototype.process=function(){this.isSessionhasEvent||(this.isSessionhasEvent=!0,this.startTime=+new Date);var e=this.lastTime||+new Date;this.lastTime=+new Date,this.lastTime-e>this.sessionInterval&&(this.clearInterval(),this.endCurrentSession(),this.setInterval())},e}(),Monitor=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;if(this.collect=e,this.config=t,!this.config.channel_domain){var n=e.adapters.fetch;if(this.fetch=n,!t.disable_track_event&&!t.disable_sdk_monitor){this.url=e.configManager.getUrl("event");var i=this.collect.Types;this.collect.on(i.Ready,(function(){r.sdkOnload()})),this.collect.on(i.SubmitError,(function(e){var t=e.type,n=e.eventData,i=e.errorCode;"f_data"===t&&r.sdkError(n,i)}))}}},e.prototype.sdkOnload=function(){var e=this;try{var t=this.collect.configManager.get(),r=t.header,n=t.user,i=r.app_id,a=r.app_name,o=r.sdk_version,s=n.web_id,u={events:[{event:"onload",params:JSON.stringify({app_id:i,app_name:a||"",sdk_version:o,sdk_type:SDK_TYPE$1,sdk_config:this.config,sdk_desc:"TOC"}),local_time_ms:Date.now()}],user:{user_unique_id:s},header:{}};setTimeout((function(){e.fetch(e.url,[u],3e4,!1,(function(){}),(function(){}),"566f58151b0ed37e")}),16)}catch(c){}},e.prototype.sdkError=function(e,t){var r=this;try{var n=e[0],i=n.user,a=n.header,o=[];e.forEach((function(e){e.events.forEach((function(e){o.push(e)}))}));var s={events:o.map((function(e){return{event:"on_error",params:JSON.stringify({error_code:t,app_id:a.app_id,app_name:a.app_name||"",error_event:e.event,sdk_version:a.sdk_version,local_time_ms:e.local_time_ms,tea_event_index:Date.now(),params:e.params,header:JSON.stringify(a),user:JSON.stringify(i)}),local_time_ms:Date.now()}})),user:{user_unique_id:i.user_unique_id},header:{}};setTimeout((function(){r.fetch(r.url,[s],3e4,!1,(function(){}),(function(){}),"566f58151b0ed37e")}),16)}catch(u){}},e}();function isNeedElement(e,t){if(void 0===t&&(t="list"),!e)return!1;if(t&&"list"===t){if(["LI","TR","DL"].includes(e.nodeName))return!0;if(e.dataset&&e.dataset.hasOwnProperty("teaIdx"))return!0;if(e.hasAttribute&&e.hasAttribute("data-tea-idx"))return!0}else{if(["A","BUTTON"].includes(e.nodeName))return!0;if(e.dataset&&e.dataset.hasOwnProperty("teaContainer"))return!0;if(e.hasAttribute&&e.hasAttribute("data-tea-container"))return!0;if(e.hasAttribute&&hasAttributes(e,"ss"))return!0}return!1}var isAttrFilter=function(e,t){return!!hasAttributes(e,t)};function getContainer(e){for(var t=e;t&&!isNeedElement(t,"container");){if("HTML"===t.nodeName||"BODY"===t.nodeName)return e;t=t.parentElement}return t||e}function getNodeText(e){var t="";return 3===e.nodeType?t=e.textContent.trim():e.dataset&&e.dataset.hasOwnProperty("teaTitle")||e.hasAttribute("ata-tea-title")?t=e.getAttribute("data-tea-title"):e.hasAttribute("title")?t=e.getAttribute("title"):"INPUT"===e.nodeName&&["button","submit"].includes(e.getAttribute("type"))?t=e.getAttribute("value"):"IMG"===e.nodeName&&e.getAttribute("alt")&&(t=e.getAttribute("alt")),t.slice(0,200)}function getText(e){var t=getContainer(e),r=[];return function e(t){var n=getNodeText(t);if(n&&-1===r.indexOf(n)&&r.push(n),t.childNodes.length>0)for(var i=t.childNodes,a=0;a<i.length;a++)8!==i[a].nodeType&&e(i[a])}(t),r}function getTextSingle(e){var t=getContainer(e),r="";return function e(t){var n=getNodeText(t);if(n&&(r+=n),t.childNodes.length>0)for(var i=t.childNodes,a=0;a<i.length;a++)3===i[a].nodeType&&e(i[a])}(t),r}function ignore(e){for(var t=e;t&&t.parentNode;){if(t.hasAttribute("data-tea-ignore"))return!0;if("HTML"===t.nodeName||"body"===t.nodeName)return!1;t=t.parentNode}return!1}var hasAttribute=function(e,t){return e.hasAttribute?e.hasAttribute(t):e.attributes?!(!e.attributes[t]||!e.attributes[t].specified):void 0},hasAttributes=function(e,t){if("string"==typeof t)return hasAttribute(e,t);if(isArray$2(t)){for(var r=!1,n=0;n<t.length;n++)if(hasAttribute(e,t[n])){r=!0;break}return r}},getAttributes=function(e,t){var r={};if("string"==typeof t)hasAttribute(e,t)&&(r.attrs=e.getAttribute(t));else if(isArray$2(t))for(var n=0;n<t.length;n++)hasAttribute(e,t[n])&&(r[t[n]]=e.getAttribute(t[n]));return r},elementLevel=function(e){if(e.children.length){var t=e.children;return![].slice.call(t).some((function(e){return e.children.length>0}))}return!0},isSVG=function(e){if("svg"===e.tagName.toLowerCase())return!0;for(var t=e.parentElement,r=!1;t;)"svg"===t.tagName.toLowerCase()?(t=null,r=!0):t=t.parentElement;return r};function isTrack(e,t){if(1!==e.nodeType)return!1;if(!t.svg&&isSVG(e))return!1;if(["HTML","BODY"].includes(e.tagName.toUpperCase()))return!1;var r=e;return!("none"===r.style.display||!isNeedElement(r,"container")&&!elementLevel(r))}var Listener=function(){function e(e,t,r){var n=this;this.clickEvent=function(e){isTrack(e.target,n.options)&&n.eventHandel({eventType:"dom",eventName:"click"},e)},this.changeEvent=function(e){n.eventHandel({eventType:"dom",eventName:"change"},e)},this.submitEvent=function(e){n.eventHandel({eventType:"dom",eventName:"submit"},e)},this.getPageViewEvent=function(e,t){t&&"pushState"===t&&n.eventHandel({eventType:"dom",eventName:"beat"},_assign({beat_type:0},e)),n.eventHandel({eventType:"dom",eventName:"page_view"},e)},this.getPageLoadEvent=function(e){n.eventHandel({eventType:"dom",eventName:"page_statistics"},{lcp:e})},this.config=r.getConfig().eventConfig,this.collect=t,this.options=e,this.beatTime=e.beat,this.statistics=!1}return e.prototype.init=function(e){this.eventHandel=e;var t=this.config.mode;this.addListener(t)},e.prototype.addListener=function(e){var t=this;if("proxy-capturing"===e&&(this.config.click&&window.document.addEventListener("click",this.clickEvent,!0),this.config.change&&window.document.addEventListener("change",this.changeEvent,!0),this.config.submit&&window.document.addEventListener("submit",this.submitEvent,!0),this.config.pv&&this.collect.on("route-change",(function(e){var r=e.config,n=e.name;t.getPageViewEvent(r,n)})),this.config.beat)){try{"complete"===document.readyState?this.beatEvent(this.beatTime):window.addEventListener("load",(function(){t.beatEvent(t.beatTime)}));var r=0,n=null;window.addEventListener("scroll",(function(){clearTimeout(n),n=setTimeout(i,500),r=document.documentElement.scrollTop||document.body.scrollTop}));var i=function(){(document.documentElement.scrollTop||document.body.scrollTop)==r&&t.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:1})}}catch(o){}try{var a=window.performance&&window.performance.getEntriesByType("paint");a&&a.length?(new PerformanceObserver((function(e){var r=e.getEntries(),n=r[r.length-1],i=n.renderTime||n.loadTime;t.statistics||(t.getPageLoadEvent(i),t.statistics=!0)})).observe({entryTypes:["largest-contentful-paint"]}),setTimeout((function(){t.statistics||(t.getPageLoadEvent(a[0].startTime||0),t.statistics=!0)}),2e3)):this.getPageLoadEvent(0)}catch(o){this.getPageLoadEvent(0)}}},e.prototype.removeListener=function(){window.document.removeEventListener("click",this.clickEvent,!0),window.document.removeEventListener("change",this.changeEvent,!0),window.document.removeEventListener("submit",this.submitEvent,!0)},e.prototype.beatEvent=function(e){var t=this;try{var r;this.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:3}),this.beatTime&&(r=setInterval((function(){t.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:2})}),e)),beforePageUnload$1((function(){t.eventHandel({eventType:"dom",eventName:"beat",eventSend:"becon"},{beat_type:0}),t.beatTime&&clearInterval(r)}))}catch(n){}},e}(),defaultConfig$1={eventConfig:{mode:"proxy-capturing",submit:!1,click:!0,change:!1,pv:!0,beat:!0,hashTag:!1,impr:!1},scoutConfig:{mode:"xpath"}},Config=function(){function e(e,t){this.config=e,this.config.eventConfig=Object.assign(this.config.eventConfig,t)}return e.prototype.getConfig=function(){return this.config},e.prototype.setConfig=function(e){return this.config=e},e}();function getPositionData(e){if(e){var t=e.getBoundingClientRect(),r=t.width,n=t.height;return{left:t.left,top:t.top,element_width:r,element_height:n}}}function getEventData(e,t){void 0===e&&(e={}),void 0===t&&(t={});var r=e.clientX,n=e.clientY,i=t.left,a=t.top,o=r-i>=0?r-i:0,s=n-a>=0?n-a:0;return{touch_x:Math.floor(o),touch_y:Math.floor(s)}}function getXpath(e){for(var t=[];null!==e.parentElement;)t.push(e),e=e.parentElement;var r=[],n=[];return t.forEach((function(e){var t=getXpathIndex(e),i=t.str,a=t.index;r.unshift(i),n.unshift(a)})),{element_path:"/"+r.join("/"),positions:n}}function getXpathIndex(e){if(null===e)return{str:"",index:0};var t=0,r=e.parentElement;if(r)for(var n=r.children,i=0;i<n.length&&n[i]!==e;i++)n[i].nodeName===e.nodeName&&t++;return{str:[e.nodeName.toLowerCase(),isNeedElement(e,"list")?"[]":""].join(""),index:t}}function getElementData(e,t,r,n){var i={},a=getPositionData(t),o=getEventData(e,a),s=a.element_width,u=a.element_height,c=o.touch_x,l=o.touch_y,d=getXpath(t),h=d.element_path,f=d.positions,p=getText(t),g=window.performance.timing.navigationStart,y=Date.now()-g,m=f.map((function(e){return""+e})),v=null;if(window.TEAVisualEditor&&window.TEAVisualEditor.getOriginXpath&&(v=window.TEAVisualEditor.getOriginXpath({xpath:h,positions:m})),i.element_path=v&&v.xpath||h,i.positions=v&&v.positions||m,n&&!n.text&&(i.texts=p,i.element_title=getTextSingle(t)),i.element_id=t.getAttribute("id")||"",i.element_class_name=t.getAttribute("class")||"",i.element_type=t.nodeType,i.element_width=Math.floor(s),i.element_height=Math.floor(u),i.touch_x=c,i.touch_y=l,i.page_manual_key="",i.elememt_manual_key="",i.since_page_start_ms=y,i.page_start_ms=g,i.page_path=location.pathname,i.page_host=location.host,r.track_attr&&isAttrFilter(t,r.track_attr)){var _=getAttributes(t,r.track_attr);for(var b in _)i[b]=_[b]}var A=getContainer(t);return"A"===A.tagName&&(i.href=A.getAttribute("href")),"IMG"===t.tagName&&(i.src=t.getAttribute("src")),i}var getEventData$1=function(e,t,r,n,i){return _assign({event:e},getElementData(t,r,n,i),{is_html:1,page_key:window.location.href,page_title:document.title})},getExtraEventData=function(e,t){try{if("bav2b_change"===e)return t.hasAttribute("data-tea-track")?{value:t.value}:{}}catch(r){return{}}},EventHandle=function(){function e(e,t){this.ignore={text:!1},this.initConfig=e,this.options=t,this.eventName=t&&"tea"===t.custom?{click:"__bav_click",page:"__bav_page",beat:"__bav_beat",static:"__bav_page_statistics",exposure:"__bav_page_exposure"}:{click:"bav2b_click",page:"bav2b_page",beat:"bav2b_beat",static:"bav2b_page_statistics",exposure:"bav2b_exposure"},t&&!1===t.text&&(this.ignore.text=!0),t&&t.exposure&&t.exposure.eventName&&(this.eventName.exposure=t.exposure.eventName)}return e.prototype.handleEvent=function(e,t){try{if(ignore(e.target))return null;var r="bav2b_click";switch(t){case"click":return r=this.eventName.click,getEventData$1(r,e,e.target,this.options,this.ignore);case"exposure":return r=this.eventName.exposure,getEventData$1(r,e,e.target,this.options,this.ignore);case"change":return _assign({},getEventData$1(r="bav2b_change",e,e.target,this.options),getExtraEventData(r,e.target));case"submit":return getEventData$1(r="bav2b_submit",e,e.target,this.options)}}catch(n){return console.error(n),null}},e.prototype.handleViewEvent=function(e){e.event=this.eventName.page,e.page_title=document.title,e.page_total_width=window.innerWidth,e.page_total_height=window.innerHeight;try{var t=window.sessionStorage.getItem("_tea_cache_duration");if(t){var r=JSON.parse(t);e.refer_page_duration_ms=r?r.duration:""}e.scroll_width=document.documentElement.scrollLeft?document.documentElement.scrollLeft+window.innerWidth:window.innerWidth,e.scroll_height=document.documentElement.scrollTop?document.documentElement.scrollTop+window.innerHeight:window.innerHeight,e.page_start_ms=window.performance.timing.navigationStart}catch(n){console.log("page event error "+JSON.stringify(n))}return e},e.prototype.handleStatisticsEvent=function(e){var t={};t.event=this.eventName.static,t.is_html=1,t.page_key=location.href,t.refer_page_key=document.referrer||"",t.page_title=document.title,t.page_manual_key=this.initConfig.autotrack.page_manual_key||"",t.refer_page_manual_key="";try{var r=e.lcp,n=window.performance.timing,i=n.loadEventEnd-n.navigationStart;t.page_init_cost_ms=parseInt(r||(i>0?i:0)),t.page_start_ms=n.navigationStart}catch(a){console.log("page_statistics event error "+JSON.stringify(a))}return t},e.prototype.handleBeadtEvent=function(e){e.event=this.eventName.beat,e.page_key=window.location.href,e.is_html=1,e.page_title=document.title,e.page_manual_key=this.initConfig.autotrack.page_manual_key||"";try{e.page_viewport_width=window.innerWidth,e.page_viewport_height=window.innerHeight,e.page_total_width=document.documentElement.scrollWidth,e.page_total_height=document.documentElement.scrollHeight,e.scroll_width=document.documentElement.scrollLeft+window.innerWidth,e.scroll_height=document.documentElement.scrollTop+window.innerHeight,e.since_page_start_ms=Date.now()-window.performance.timing.navigationStart,e.page_start_ms=window.performance.timing.navigationStart}catch(t){console.log("beat event error "+JSON.stringify(t))}return e},e}(),Request=function(){function e(e){this.collect=e,this.eventNameList=["report_click_event","report_change_event","report_submit_event","report_exposure_event","report_page_view_event","report_page_statistics_event","report_beat_event"]}return e.prototype.send=function(e,t){var r=e.eventSend,n=t.event;delete t.event,r&&"becon"===r?this.collect.beconEvent(n,t):this.collect.event(n,t)},e.prototype.get=function(e,t){var r=Object.assign({headers:{"content-type":"application/json"},method:"GET"},t);fetch(e,r)},e.prototype.post=function(e,t){var r=Object.assign({headers:{"content-type":"application/json"},method:"POST"},t);fetch(e,r)},e}(),COOKIE_KEY="_TEA_VE_OPEN",COOKIE_KEY_HOST="_TEA_VE_APIHOST",COOKIE_LANG="lang",COOKIE_EDIT_VERISON="_VISUAL_EDITOR_V",COOKIE_EDIT_URL="_VISUAL_EDITOR_U";function checkSession(){return"1"===js_cookie.get(COOKIE_KEY)}function checkSessionHost(){var e=js_cookie.get(COOKIE_KEY_HOST);try{e=JSON.parse(e)}catch(t){}return e}function checkEditUrl(){return js_cookie.get(COOKIE_EDIT_URL)}function setSession(){try{var e=window.TEAVisualEditor.lang=window.TEAVisualEditor.lang||js_cookie.get(COOKIE_LANG),t=window.TEAVisualEditor.__editor_ajax_domain=window.TEAVisualEditor.__editor_ajax_domain||js_cookie.get(COOKIE_KEY_HOST),r=window.TEAVisualEditor.__editor_verison=window.TEAVisualEditor.__editor_verison||js_cookie.get(COOKIE_EDIT_VERISON),n=window.TEAVisualEditor.__editor_url=window.TEAVisualEditor.__editor_url||js_cookie.get(COOKIE_EDIT_URL),i=+new Date,a=new Date(i+18e5);js_cookie.set(COOKIE_KEY,"1",{expires:a}),js_cookie.set(COOKIE_KEY_HOST,t,{expires:a}),js_cookie.set(COOKIE_EDIT_URL,n,{expires:a}),js_cookie.set(COOKIE_LANG,e,{expires:a}),js_cookie.set(COOKIE_EDIT_VERISON,r||"",{expires:a})}catch(o){console.log("set cookie err")}}var isLoaded$1=!1;function loadEditorScript$1(e){var t=e.event,r=e.editorUrl,n=e.autoTrackInstance;isLoaded$1||(isLoaded$1=!0,loadScript(r,(function(){dispatchMsg(t,"editorScriptloadSuccess"),n.destroy()}),(function(){t&&dispatchMsg(t,"editorScriptloadError"),isLoaded$1=!1})))}function readyToLoadEditor$1(e,t){window.TEAVisualEditor=window.TEAVisualEditor||{};var r="",n=VISUAL_EDITOR_RANGERS+"?query="+Date.now();window.TEAVisualEditor.appId=t.app_id;var i=t.channel_domain,a="";if(addAllowdOrigin(["*"]),i){var o,s="";try{var u=window.performance.getEntriesByType("resource");if(u&&u.length&&(u.forEach((function(e){"script"===e.initiatorType&&e.name&&-1!==e.name.indexOf("collect")&&(s=e.name)})),s&&(o=s.split("/"))&&o.length)){a="https:/";for(var c=2;c<o.length&&c!==o.length-1;c++)a=a+"/"+o[c];if(a&&a.indexOf("/5.0")){var l=a.split("/5.0");a=l[0]||a}}}catch(f){}}if(init$1(t,SDK_VERSION$1),checkSession()){var d=checkSessionHost(),h="";d&&(window.TEAVisualEditor.__editor_ajax_domain=d,h=checkEditUrl()),loadEditorScript$1({event:null,editorUrl:h||n,autoTrackInstance:e}),setSession()}else try{receiveMsg("tea:openVisualEditor",(function(t){var o=t.data;if("string"==typeof t.data)try{o=JSON.parse(t.data)}catch(f){o=void 0}if(o){var s=o.referrer,u=o.lang;if(s&&(window.TEAVisualEditor.__editor_ajax_domain=s),r=n,i){var c=o.version;r=a?a+(c?"/visual-editor-rangers-v"+c:"/visual-editor-rangers-v1.0.0")+".js":n,window.TEAVisualEditor.__editor_verison=c}window.TEAVisualEditor.__editor_url=r,window.TEAVisualEditor.lang=u,loadEditorScript$1({event:t,editorUrl:r,autoTrackInstance:e}),setSession()}})),window.TEAVisualEditor.openAutotrackEditor=function(){loadEditorScript$1({event:null,editorUrl:window.TEAVisualEditor.__editor_url,autoTrackInstance:e})}}catch(f){console.log("receive message error")}try{receiveMsg("tea:openHeatMapCore",(function(r){var n=HOT_PIC_URL,i=r.data.app_id;i&&i!==t.app_id||loadEditorScript$1({event:r,editorUrl:n+".js?query="+Date.now(),autoTrackInstance:e})}))}catch(f){console.log("openHeatMapCore error")}}var Observer=function(){function e(e){this._instance=null,this._intersection=e,this.init()}return e.prototype.init=function(){var e=this;this._instance=new MutationObserver((function(t){t.forEach((function(t){"attributes"===t.type&&e.attributeChangeObserve(t),"childList"===t.type&&e.modifyNodeObserve(t)}))})),this._instance.observe(document.body,{childList:!0,attributes:!0,subtree:!0,attributeOldValue:!1})},e.prototype.attributeChangeObserve=function(e){e.target.hasAttribute("data-exposure")?this.exposureAdd(e,"mutation"):this.exposureRemove(e)},e.prototype.modifyNodeObserve=function(e){var t=this;Array.prototype.forEach.call(e.addedNodes,(function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t.exposureAdd(e,"intersect"),t.mapChild(e,t.exposureAdd)})),Array.prototype.forEach.call(e.removedNodes,(function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t.exposureRemove(e),t.mapChild(e,t.exposureRemove)}))},e.prototype.mapChild=function(e,t){var r=this;1===e.nodeType&&e.children.length&&Array.prototype.forEach.call(e.children,(function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t(e),r.mapChild(e,t)}))},e.prototype.exposureAdd=function(e,t){this._intersection.exposureAdd(e,t)},e.prototype.exposureRemove=function(e){this._intersection.exposureRemove(e)},e._exposure_observer=null,e}(),Intersection=function(){function e(t,r){this.count=1,this.instance=this.buildObserver(),this.observeMap=e._observer_map,t.autotrack.exposure.ratio?this.Ratio=t.autotrack.exposure.ratio:0===t.autotrack.exposure.ratio?this.Ratio=0:this.Ratio=.5,this.EventHandle=r}return e.prototype.buildObserver=function(){var t=this;if(!e._observer_instance)return IntersectionObserver&&(e._observer_instance=new IntersectionObserver((function(e){e.forEach((function(e){t.observeMap.get(e.target._observeId)&&t.exposureEvent(e)}))}),{threshold:[.01,.25,.5,.75,1]})),e._observer_instance},e.prototype.exposureAdd=function(e,t){var r=e;"mutation"===t&&(r=e.target);var n=r._observeId;if(n||this.observeMap.has(n)){if(!1===r.visible){var i=r.getBoundingClientRect(),a=i.top,o=i.left,s=i.right,u=i.bottom;a>=0&&u<=window.innerHeight&&o>=0&&s<=window.innerWidth&&(r.visible=!0,this.EventHandle({eventType:"dom",eventName:"exposure"},e))}}else r._observeId=this.count,r.visible=!1,this.observeMap.set(this.count,r),this.observe(r),this.count++},e.prototype.exposureRemove=function(e){this.observeMap.has(e._observeId)&&(this.observeMap.delete(e._observeId),this.unobserve(e))},e.prototype.exposureEvent=function(e){if(e.intersectionRatio>=this.Ratio&&e.isIntersecting){if("0"===e.target.style.opacity||"hidden"===e.target.style.visibility)return;if(!0===e.target.visible)return;e.target.visible=!0,this.EventHandle({eventType:"dom",eventName:"exposure"},e)}else e.target.visible=!1},e.prototype.observe=function(e){this.instance.observe(e)},e.prototype.unobserve=function(e){this.instance.unobserve(e)},e._observer_instance=null,e._observer_map=new Map,e}(),Exposure=function(){function e(e,t){e.autotrack&&e.autotrack.exposure&&(this._intersection=new Intersection(e,t),this._observer=new Observer(this._intersection),this.initObserver())}return e.prototype.initObserver=function(){var e=this;Array.prototype.forEach.call(document.querySelectorAll("[data-exposure]"),(function(t){e._intersection.exposureAdd(t,"intersect")}))},e}(),defaultOpt={hashTag:!1,impr:!1},AutoTrack=function(){function e(){}return e.prototype.apply=function(e,t){if(this.autoTrackStart=!1,this.collect=e,this.config=t,t.autotrack){var r=e.Types;t.autotrack&&t.autotrack.collect_url&&!t.autotrack.collect_url()||(this.ready(r.Autotrack),this.collect.emit(r.AutotrackReady))}},e.prototype.ready=function(e){this.collect.set(e);var t=this.config.autotrack;t="object"==_typeof$7(t)?t:{},t=Object.assign(defaultOpt,t),this.destroyed=!1,this.options=t,this.Config=new Config(defaultConfig$1,this.options),this.Exposure=new Exposure(this.config,this.handle.bind(this)),this.Listener=new Listener(t,this.collect,this.Config),this.EventHandle=new EventHandle(this.config,t),this.Request=new Request(this.collect),this.autoTrackStart=!0,this.init(),readyToLoadEditor$1(this,this.config)},e.prototype.init=function(){this.Listener.init(this.handle.bind(this))},e.prototype.handle=function(e,t){"dom"===e.eventType&&this.handleDom(e,t)},e.prototype.handleDom=function(e,t){try{var r=e.eventName;if("click"===r||"exposure"===r||"change"===r||"submit"===r){var n=this.EventHandle.handleEvent(t,r);null!==n&&this.Request.send({eventType:"custom",eventName:"report_"+r+"_event",extra:{methods:"GET"}},n)}else if("page_view"===r||"page_statistics"===r){var i;i="page_view"===r?this.EventHandle.handleViewEvent(t):this.EventHandle.handleStatisticsEvent(t),this.Request.send({eventType:"custom",eventName:"report_${eventName}_event",extra:{methods:"GET"}},i)}else if("beat"===r){var a=this.EventHandle.handleBeadtEvent(t),o=e.eventSend;this.Request.send({eventType:"custom",eventName:"report_${eventName}_event",extra:{methods:"GET"},eventSend:o},a)}}catch(s){console.log("handel dom event error "+JSON.stringify(s))}},e.prototype.destroy=function(){if(!this.autoTrackStart)return console.warn("engine is undefined, make sure you have called autoTrack.start()");this.autoTrackStart=!1,this.Listener.removeListener()},e}(),State$1;!function(e){e.Net="net",e.FailNet="f_net",e.FailData="f_data"}(State$1||(State$1={}));var EventList={pv:["predefine_pageview"],sdk:["_be_active","predefine_page_alive","predefine_page_close","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append"],autotrack:["bav2b_click","bav2b_page","bav2b_beat","bav2b_page_statistics","__bav_click","__bav_page","__bav_beat","__bav_page_statistics"]},Tracer=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;if(this.ready=t.app_id&&t.enable_tracer&&!t.disable_track_event,this.ready){this.limit={pv:1,sdk:3,autotrack:3,log:3},this.errorCode={f_net:0,f_data:0},this.tracerCache=new Map,this.collect=e,this.appid=t.app_id,this.reportUrl=e.configManager.getUrl("event");var n=this.collect.Types,i=e.adapters.fetch;this.fetch=i,this.collect.on(n.Event,(function(){r.addCount("log")})),this.collect.on(n.SubmitError,(function(e){var t=e.type,n=e.eventDate,i=e.errorCode,a=e.response;r.addErrorCount(n,t,i,a)})),this.listener(),this.collect.emit(n.TracerReady)}},e.prototype.addCount=function(e,t,r){void 0===t&&(t="net"),void 0===r&&(r=1);try{this.tracerCache||(this.tracerCache=new Map);var n=void 0;if(this.tracerCache.has(e))(i=this.tracerCache.get(e)).has(t)?(n=i.get(t).params.count,n++,i.set(t,this.processTracer(n,e,t))):(n=r,i.set(t,this.processTracer(r,e,t)));else{var i=new Map;n=r,i.set(t,this.processTracer(r,e,t)),this.tracerCache.set(e,i)}"net"===t&&n>=this.limit[e]&&this.report(!1)}catch(a){console.log(a)}},e.prototype.addErrorCount=function(e,t,r,n){var i=this;try{if(e&&e.length){var a=e[0].events;a&&a.length&&("f_data"===t?(n&&n.hasOwnProperty("sc")?this.addCount("log",t,a.length-n.sc):this.addCount("log",t,a.length),this.errorCode[t]=r):a.forEach((function(e){var n="log";for(var a in EventList)if(-1!==EventList[a].indexOf(e.event)){n=a;break}i.addCount(n,t,1),i.errorCode[t]=r})))}}catch(o){}},e.prototype.report=function(e){if(this.tracerCache){var t=[];this.tracerCache.forEach((function(e){console.log(e),e.forEach((function(e){t.push(e)}))})),t&&t.length&&this.sendTracer(t,e)}},e.prototype.sendTracer=function(e,t){try{var r=this.collect.eventManager.merge(e);t&&window.navigator.sendBeacon?window.navigator.sendBeacon(this.reportUrl,JSON.stringify(r)):this.fetch(this.reportUrl,r),this.tracerCache=null}catch(n){}},e.prototype.processTracer=function(e,t,r){var n={count:e,state:r,key:t,params_for_special:"applog_trace",aid:this.appid,platform:"web",_staging_flag:1,sdk_version:SDK_VERSION$1};"f_net"!==r&&"f_data"!==r||(n.errorCode=this.errorCode[r]);var i=this.collect.processEvent("applog_trace",n);if(i&&i.event)return delete i.is_bav,i},e.prototype.listener=function(){var e=this;document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&e.leavePage()})),beforePageUnload$1((function(){e.leavePage()}))},e.prototype.leavePage=function(){this.report(!0)},e}(),dayjs_min=createCommonjsModule$1((function(e,t){e.exports=function(){var e="millisecond",t="second",r="minute",n="hour",i="day",a="week",o="month",s="quarter",u="year",c="date",l="Invalid Date",d=/^(\d{4})[-\/]?(\d{1,2})?[-\/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,f={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},p=function(e,t,r){var n=String(e);return!n||n.length>=t?e:""+Array(t+1-n.length).join(r)+e},g={s:p,z:function(e){var t=-e.utcOffset(),r=Math.abs(t),n=Math.floor(r/60),i=r%60;return(t<=0?"+":"-")+p(n,2,"0")+":"+p(i,2,"0")},m:function e(t,r){if(t.date()<r.date())return-e(r,t);var n=12*(r.year()-t.year())+(r.month()-t.month()),i=t.clone().add(n,o),a=r-i<0,s=t.clone().add(n+(a?-1:1),o);return+(-(n+(r-i)/(a?i-s:s-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(l){return{M:o,y:u,w:a,d:i,D:c,h:n,m:r,s:t,ms:e,Q:s}[l]||String(l||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},y="en",m={};m[y]=f;var v=function(e){return e instanceof E},_=function(e,t,r){var n;if(!e)return y;if("string"==typeof e)m[e]&&(n=e),t&&(m[e]=t,n=e);else{var i=e.name;m[i]=e,n=i}return!r&&n&&(y=n),n||!r&&y},b=function(e,t){if(v(e))return e.clone();var r="object"==_typeof$7(t)?t:{};return r.date=e,r.args=arguments,new E(r)},A=g;A.l=_,A.i=v,A.w=function(e,t){return b(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var E=function(){function f(e){this.$L=_(e.locale,null,!0),this.parse(e)}var p=f.prototype;return p.parse=function(e){this.$d=function(e){var t=e.date,r=e.utc;if(null===t)return new Date(NaN);if(A.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var n=t.match(d);if(n){var i=n[2]-1||0,a=(n[7]||"0").substring(0,3);return r?new Date(Date.UTC(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,a)):new Date(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,a)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},p.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},p.$utils=function(){return A},p.isValid=function(){return!(this.$d.toString()===l)},p.isSame=function(e,t){var r=b(e);return this.startOf(t)<=r&&r<=this.endOf(t)},p.isAfter=function(e,t){return b(e)<this.startOf(t)},p.isBefore=function(e,t){return this.endOf(t)<b(e)},p.$g=function(e,t,r){return A.u(e)?this[t]:this.set(r,e)},p.unix=function(){return Math.floor(this.valueOf()/1e3)},p.valueOf=function(){return this.$d.getTime()},p.startOf=function(e,s){var l=this,d=!!A.u(s)||s,h=A.p(e),f=function(e,t){var r=A.w(l.$u?Date.UTC(l.$y,t,e):new Date(l.$y,t,e),l);return d?r:r.endOf(i)},p=function(e,t){return A.w(l.toDate()[e].apply(l.toDate("s"),(d?[0,0,0,0]:[23,59,59,999]).slice(t)),l)},g=this.$W,y=this.$M,m=this.$D,v="set"+(this.$u?"UTC":"");switch(h){case u:return d?f(1,0):f(31,11);case o:return d?f(1,y):f(0,y+1);case a:var _=this.$locale().weekStart||0,b=(g<_?g+7:g)-_;return f(d?m-b:m+(6-b),y);case i:case c:return p(v+"Hours",0);case n:return p(v+"Minutes",1);case r:return p(v+"Seconds",2);case t:return p(v+"Milliseconds",3);default:return this.clone()}},p.endOf=function(e){return this.startOf(e,!1)},p.$set=function(a,s){var l,d=A.p(a),h="set"+(this.$u?"UTC":""),f=(l={},l[i]=h+"Date",l[c]=h+"Date",l[o]=h+"Month",l[u]=h+"FullYear",l[n]=h+"Hours",l[r]=h+"Minutes",l[t]=h+"Seconds",l[e]=h+"Milliseconds",l)[d],p=d===i?this.$D+(s-this.$W):s;if(d===o||d===u){var g=this.clone().set(c,1);g.$d[f](p),g.init(),this.$d=g.set(c,Math.min(this.$D,g.daysInMonth())).$d}else f&&this.$d[f](p);return this.init(),this},p.set=function(e,t){return this.clone().$set(e,t)},p.get=function(e){return this[A.p(e)]()},p.add=function(e,s){var c,l=this;e=Number(e);var d=A.p(s),h=function(t){var r=b(l);return A.w(r.date(r.date()+Math.round(t*e)),l)};if(d===o)return this.set(o,this.$M+e);if(d===u)return this.set(u,this.$y+e);if(d===i)return h(1);if(d===a)return h(7);var f=(c={},c[r]=6e4,c[n]=36e5,c[t]=1e3,c)[d]||1,p=this.$d.getTime()+e*f;return A.w(p,this)},p.subtract=function(e,t){return this.add(-1*e,t)},p.format=function(e){var t=this,r=this.$locale();if(!this.isValid())return r.invalidDate||l;var n=e||"YYYY-MM-DDTHH:mm:ssZ",i=A.z(this),a=this.$H,o=this.$m,s=this.$M,u=r.weekdays,c=r.months,d=function(e,r,i,a){return e&&(e[r]||e(t,n))||i[r].substr(0,a)},f=function(e){return A.s(a%12||12,e,"0")},p=r.meridiem||function(e,t,r){var n=e<12?"AM":"PM";return r?n.toLowerCase():n},g={YY:String(this.$y).slice(-2),YYYY:this.$y,M:s+1,MM:A.s(s+1,2,"0"),MMM:d(r.monthsShort,s,c,3),MMMM:d(c,s),D:this.$D,DD:A.s(this.$D,2,"0"),d:String(this.$W),dd:d(r.weekdaysMin,this.$W,u,2),ddd:d(r.weekdaysShort,this.$W,u,3),dddd:u[this.$W],H:String(a),HH:A.s(a,2,"0"),h:f(1),hh:f(2),a:p(a,o,!0),A:p(a,o,!1),m:String(o),mm:A.s(o,2,"0"),s:String(this.$s),ss:A.s(this.$s,2,"0"),SSS:A.s(this.$ms,3,"0"),Z:i};return n.replace(h,(function(e,t){return t||g[e]||i.replace(":","")}))},p.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},p.diff=function(e,c,l){var d,h=A.p(c),f=b(e),p=6e4*(f.utcOffset()-this.utcOffset()),g=this-f,y=A.m(this,f);return y=(d={},d[u]=y/12,d[o]=y,d[s]=y/3,d[a]=(g-p)/6048e5,d[i]=(g-p)/864e5,d[n]=g/36e5,d[r]=g/6e4,d[t]=g/1e3,d)[h]||g,l?y:A.a(y)},p.daysInMonth=function(){return this.endOf(o).$D},p.$locale=function(){return m[this.$L]},p.locale=function(e,t){if(!e)return this.$L;var r=this.clone(),n=_(e,t,!0);return n&&(r.$L=n),r},p.clone=function(){return A.w(this.$d,this)},p.toDate=function(){return new Date(this.valueOf())},p.toJSON=function(){return this.isValid()?this.toISOString():null},p.toISOString=function(){return this.$d.toISOString()},p.toString=function(){return this.$d.toUTCString()},f}(),S=E.prototype;return b.prototype=S,[["$ms",e],["$s",t],["$m",r],["$H",n],["$W",i],["$M",o],["$y",u],["$D",c]].forEach((function(e){S[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),b.extend=function(e,t){return e.$i||(e(t,E,b),e.$i=!0),b},b.locale=_,b.isDayjs=v,b.unix=function(e){return b(1e3*e)},b.en=m[y],b.Ls=m,b.p={},b}()})),duration=createCommonjsModule$1((function(e,t){var r,n,i,a,o,s,u,c,l,d,h,f,p,g,y,m,v;e.exports=(o=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,c=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,l={years:s=31536e6,months:u=2592e6,days:a=864e5,hours:i=36e5,minutes:6e4,seconds:1e3,milliseconds:1,weeks:6048e5},d=function(e){return e instanceof v},h=function(e,t,r){return new v(e,r,t.$l)},f=function(e){return n.p(e)+"s"},p=function(e){return e<0},g=function(e){return p(e)?Math.ceil(e):Math.floor(e)},y=function(e){return Math.abs(e)},m=function(e,t){return e?p(e)?{negative:!0,format:""+y(e)+t}:{negative:!1,format:""+e+t}:{negative:!1,format:""}},v=function(){function e(e,t,r){var n=this;if(this.$d={},this.$l=r,void 0===e&&(this.$ms=0,this.parseFromMilliseconds()),t)return h(e*l[f(t)],this);if("number"==typeof e)return this.$ms=e,this.parseFromMilliseconds(),this;if("object"==_typeof$7(e))return Object.keys(e).forEach((function(t){n.$d[f(t)]=e[t]})),this.calMilliseconds(),this;if("string"==typeof e){var i=e.match(c);if(i){var a=i.slice(2).map((function(e){return Number(e)}));return this.$d.years=a[0],this.$d.months=a[1],this.$d.weeks=a[2],this.$d.days=a[3],this.$d.hours=a[4],this.$d.minutes=a[5],this.$d.seconds=a[6],this.calMilliseconds(),this}}return this}var t=e.prototype;return t.calMilliseconds=function(){var e=this;this.$ms=Object.keys(this.$d).reduce((function(t,r){return t+(e.$d[r]||0)*l[r]}),0)},t.parseFromMilliseconds=function(){var e=this.$ms;this.$d.years=g(e/s),e%=s,this.$d.months=g(e/u),e%=u,this.$d.days=g(e/a),e%=a,this.$d.hours=g(e/i),e%=i,this.$d.minutes=g(e/6e4),e%=6e4,this.$d.seconds=g(e/1e3),e%=1e3,this.$d.milliseconds=e},t.toISOString=function(){var e=m(this.$d.years,"Y"),t=m(this.$d.months,"M"),r=+this.$d.days||0;this.$d.weeks&&(r+=7*this.$d.weeks);var n=m(r,"D"),i=m(this.$d.hours,"H"),a=m(this.$d.minutes,"M"),o=this.$d.seconds||0;this.$d.milliseconds&&(o+=this.$d.milliseconds/1e3);var s=m(o,"S"),u=e.negative||t.negative||n.negative||i.negative||a.negative||s.negative,c=i.format||a.format||s.format?"T":"",l=(u?"-":"")+"P"+e.format+t.format+n.format+c+i.format+a.format+s.format;return"P"===l||"-P"===l?"P0D":l},t.toJSON=function(){return this.toISOString()},t.format=function(e){var t=e||"YYYY-MM-DDTHH:mm:ss",r={Y:this.$d.years,YY:n.s(this.$d.years,2,"0"),YYYY:n.s(this.$d.years,4,"0"),M:this.$d.months,MM:n.s(this.$d.months,2,"0"),D:this.$d.days,DD:n.s(this.$d.days,2,"0"),H:this.$d.hours,HH:n.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:n.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:n.s(this.$d.seconds,2,"0"),SSS:n.s(this.$d.milliseconds,3,"0")};return t.replace(o,(function(e,t){return t||String(r[e])}))},t.as=function(e){return this.$ms/l[f(e)]},t.get=function(e){var t=this.$ms,r=f(e);return"milliseconds"===r?t%=1e3:t="weeks"===r?g(t/l[r]):this.$d[r],0===t?0:t},t.add=function(e,t,r){var n;return n=t?e*l[f(t)]:d(e)?e.$ms:h(e,this).$ms,h(this.$ms+n*(r?-1:1),this)},t.subtract=function(e,t){return this.add(e,t,!0)},t.locale=function(e){var t=this.clone();return t.$l=e,t},t.clone=function(){return h(this.$ms,this)},t.humanize=function(e){return r().add(this.$ms,"ms").locale(this.$l).fromNow(!e)},t.milliseconds=function(){return this.get("milliseconds")},t.asMilliseconds=function(){return this.as("milliseconds")},t.seconds=function(){return this.get("seconds")},t.asSeconds=function(){return this.as("seconds")},t.minutes=function(){return this.get("minutes")},t.asMinutes=function(){return this.as("minutes")},t.hours=function(){return this.get("hours")},t.asHours=function(){return this.as("hours")},t.days=function(){return this.get("days")},t.asDays=function(){return this.as("days")},t.weeks=function(){return this.get("weeks")},t.asWeeks=function(){return this.as("weeks")},t.months=function(){return this.get("months")},t.asMonths=function(){return this.as("months")},t.years=function(){return this.get("years")},t.asYears=function(){return this.as("years")},e}(),function(e,t,i){r=i,n=i().$utils(),i.duration=function(e,t){var r=i.locale();return h(e,{$l:r},t)},i.isDuration=d;var a=t.prototype.add,o=t.prototype.subtract;t.prototype.add=function(e,t){return d(e)&&(e=e.asMilliseconds()),a.bind(this)(e,t)},t.prototype.subtract=function(e,t){return d(e)&&(e=e.asMilliseconds()),o.bind(this)(e,t)}})}));dayjs_min.extend(duration);var ignoreList=["__cep_sdk_onboard","__cep_trigger_sdk","_be_active"],moreOP=["and","or","not"],CepRule=function(){function CepRule(){this.support=!0,this.currentPlan=1,this.shouldSendEvent=!1,this.staing=!1,this.test=!1,this.cepReady=!1,this.eventCache=[]}return CepRule.prototype.apply=function(e,t){var r=this;if(this.collect=e,this.config=t,this.config.cep){var n=e.adapters,i=n.fetch,a=n.storage,o=e.Types;this.types=o,this.storage=new a(!1),this.fetch=i,this.configManager=e.configManager,this.url=t.cep_url?""+t.cep_url:e.configManager.getDomain()+"/service/2/cep_settings/",this.reportUrl=e.configManager.getUrl("event"),this.key="__tea_cep_plan_"+t.app_id,this.quotasKey="__tea_cep_plan_quotas_"+t.app_id,this.isWait=!1,this.eventCache=[],this.test=e.configManager.staging,this.collect.on(o.SubmitAfter,(function(e){r.matchEvent(e)})),this.init()}},CepRule.prototype.init=function(){var e=this,t=!0,r=0,n=0,i=0,a=!1,o=this.storage.getItem(this.key)||{};if(o&&Object.keys(o).length&&(a=!0,r=o.last_update_time,n=o.fetch_interval,i=o.config_version||0,t=Date.now()-r>1e3*n),t){var s=this.configManager.get(),u=s.header,c=s.user;this.fetch(this.url,{header:u,user:c,local_time:Date.now(),config_version:i},1e4,!1,(function(t){t&&0===t.code?(o.fetch_interval=t.fetch_interval,o.data=t.data,o.last_update_time=Date.now(),o.config_version=t.config_version,e.clearQuotas(),e.initState(t.data),e.storage.setItem(e.key,o),t.data.forEach((function(t){e.event("__cep_sdk_onboard",t.plan_id)}))):304!==t.code&&400!==t.code||!a?console.log("code: "+t.code+", request errorï¼Œplease try leater"):(console.log("code: "+t.code+", use old rules~"),o.last_update_time=Date.now(),e.storage.setItem(e.key,o),e.initState(o.data))}),(function(){a?(e.planData=o.data,e.initState(o.data)):(e.support=!1,console.log("request errorï¼Œplease try leater"))}))}else o.last_update_time=Date.now(),this.storage.setItem(this.key,o),console.log("rule still work, use cache"),this.initState(o.data)},CepRule.prototype.initState=function(e){var t=this;e&&e.length&&(this.stateArray=new Map,this.waitArray=new Map,this.planData=e,e.forEach((function(e){var r=new Map;if(e.pattern&&e.pattern.events){var n=1===e.pattern.events.length;e.pattern.events.forEach((function(e){r.set(e.id,{id:e.id,isMatch:!1,event:null,after:e.after||null,connection:e.connection||null,window:e.window||null,matchTime:0,initTime:Date.now(),singleRule:n})})),t.stateArray.set(e.plan_id,{patternState:r,singleRule:n,pattern:{aid:e.aid,biz_id:e.biz_id,end_time:e.end_time,start_time:e.start_time,web_sdk_version:e.web_sdk_version,stage:e.stage},quotas:e.quotas})}})),this.cepReady=!0,this.dealCache(),this.collect.emit(this.types.CepReady))},CepRule.prototype.check=function(e){var t=Date.now();return Date.now()>1e3*e.end_time?(console.log("event rules:"+e.plan_id+" is over"),!1):t<1e3*e.start_time||t>1e3*e.end_time?(console.log("rule:"+e.plan_id+" time error"),!1):(this.staing="testing"===e.staing,!(SDK_VERSION$1<e.web_sdk_version&&(this.support=!1,console.log("you sdk version is oldï¼Œplease update to "+e.web_sdk_version+" at least"),1)))},CepRule.prototype.dealCache=function(){var e=this;if(this.eventCache.length){var t=1;this.eventCache.forEach((function(r){e.matchEvent(r),t++})),t===this.eventCache.length&&(this.eventCache=[])}},CepRule.prototype.matchEvent=function(e){if(this.support&&(!this.staing||this.test)&&e&&e.length)try{if(!this.cepReady)return void this.eventCache.push(e);var t=e[0],r=t.header,n=t.user,i=t.events;i.length&&i.reverse();for(var a=0;a<i.length;a++){var o=i[a].event;if(-1!==ignoreList.indexOf(o))return!1;this.matchRule(r,n,i[a])}}catch(s){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:s.message}),void console.log(s.message)}},CepRule.prototype.matchRule=function(e,t,r){try{for(var n=0;n<this.planData.length;n++){var i=this.planData[n],a=i.plan_id;if(this.check(i)&&this.checkQuotas(a)&&i.pattern&&i.pattern.events)for(var o=i.pattern.events,s=0;s<o.length;s++)if(this.rule(e,t,r,o[s].condition)){var u=this.stateArray.get(a).patternState,c=u.get(o[s].id);if(this.stateArray.get(a).singleRule){this.changeStatus(a,o[s].id,r),this.publish([r],a,o[s].id);break}if(!c.isMatch){c.after&&u.get(c.after).isMatch?this.changeStatus(a,o[s].id,r):c.after||this.changeStatus(a,o[s].id,r);break}}}this.statusCheck()}catch(l){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:l.message}),void console.log(l.message)}},CepRule.prototype.changeStatus=function(e,t,r){var n=this.stateArray.get(e),i=n.patternState.get(t);i.isMatch=!0,i.event=r,i.matchTime=r.local_time_ms||Date.now(),n.patternState.set(t,i),this.stateArray.set(e,n)},CepRule.prototype.statusCheck=function(){var e,t,r,n;try{for(var i=__values(this.stateArray),a=i.next();!a.done;a=i.next()){var o=__read(a.value,2),s=o[0],u=o[1],c=u.patternState;if(u.isSingle)break;try{for(var l=__values(c),d=l.next();!d.done;d=l.next()){var h=__read(d.value,2),f=h[0],p=h[1];if(p.after&&(!p.after||c.get(p.after).isMatch)){if("NOT_FOLLOWED_BY"===p.connection){p.isMatch?this.reset(s,f):Date.now()-c.get(p.after).matchTime>p.window?this.publish([c.get(p.after).event,p.event],s,f):this.startWait(s,f,p);break}p.isMatch?p.matchTime-c.get(p.after).matchTime<=p.window?this.publish([c.get(p.after).event,p.event],s,f):this.reset(s,f):Date.now()-c.get(p.after).matchTime>p.window?this.reset(s,f):this.startWait(s,f,p);break}}}catch(g){r={error:g}}finally{try{d&&!d.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}}}catch(y){e={error:y}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},CepRule.prototype.startWait=function(e,t,r){var n=this;try{this.waitArray.get(e)||this.waitArray.set(e,new Map);var i=this.waitArray.get(e);if(!i.get(t)){var a=setTimeout((function(){var i=n.stateArray.get(e).patternState,a=i.get(t);if("NOT_FOLLOWED_BY"===a.connection)!a.isMatch&&i.get(a.after).isMatch||a.matchTime-i.get(a.after).matchTime>r.window?((o=n.waitArray.get(e).get(t)).triggerWait=!0,n.waitArray.set(e,n.waitArray.get(e).set(t,o)),n.publish([i.get(a.after).event],e,t)):n.reset(e,t);else if("FOLLOWED_BY"===a.connection){var o;a.isMatch&&i.get(a.after).isMatch?((o=n.waitArray.get(e).get(t)).triggerWait=!0,n.waitArray.set(e,n.waitArray.get(e).set(t,o)),n.publish([i.get(a.after).event],e,t)):n.reset(e,t)}}),r.window);i.set(t,{waitFn:a,triggerWait:!1}),this.waitArray.set(e,i)}}catch(o){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:o.message}),console.log(o.message,o.stack)}},CepRule.prototype.rule=function(e,t,r,n){var i=this;try{var a=r.event,o=r.params;if(o=JSON.parse(o),-1!==moreOP.indexOf(n.op)){if(n.conditions&&n.conditions.length){var s=n.conditions,u=0,c=new Map;c.set(u,{op:n.op,result:void 0,resultList:[],resultKey:[],resultLength:s.length}),function r(n,s){for(var l=0;l<n.length;l++)if(u++,-1!==moreOP.indexOf(n[l].op)&&n[l].hasOwnProperty("conditions"))c.set(u,{op:n[l].op,result:void 0,fatherKey:s,resultList:[],resultKey:[],resultLength:n[l].conditions.length}),r(n[l].conditions,u);else{var d=i.scope(n[l].key),h=d.scope,f=d.key,p=d.key2,g=h?"header"===h?p?JSON.parse(e[p])[f]:e[f]:"user"===h?t[f]:o[f]:a,y=i.calculate(n[l].op,g,n[l].value);c.set(u,{op:n[l].op,result:y,fatherKey:s})}}(s,u);for(var l=c.get(0);void 0===l.result||l.resultList.length<l.resultLength;)c.forEach((function(e,t){if(void 0!==e.result&&void 0!==e.fatherKey){var r=c.get(e.fatherKey);r.resultList.length<r.resultLength&&-1===r.resultKey.indexOf(t)&&(r.resultKey.push(t),r.resultList.push(e.result),c.set(e.fatherKey,r))}})),c.forEach((function(e){e.resultList&&e.resultList.length===e.resultLength&&("and"===e.op&&(e.result=-1===e.resultList.indexOf(!1)),"or"===e.op&&(e.result=-1!==e.resultList.indexOf(!0)))}));return c.get(0).result}return!1}var d=this.scope(n.key),h=d.scope,f=d.key,p=d.key2,g=h?"header"===h?p?JSON.parse(e[p])[f]:e[f]:"user"===h?t[f]:o[f]:a;return this.calculate(n.op,g,n.value)}catch(y){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:y.message}),console.log(y.message),!1}},CepRule.prototype.publish=function(e,t,r){try{var n=this.configManager.get().user,i={biz_id:this.stateArray.get(t).pattern.biz_id,plan_id:t,uid:n.user_id||"",did:n.device_id||"",uuid:n.user_unique_id,events:e,extra:{url:window.location.href}};this.collect.emit("__cep_match",i),(window.opener||window.parent).postMessage({type:"__cep_match",data:i},"*"),this.event("__cep_trigger_sdk",t),this.addQuotas(t),this.reset(t,r),console.log(this.stateArray)}catch(a){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:a.message}),void console.log(a.message)}},CepRule.prototype.addQuotas=function(e){var t=this.stateArray.get(e).quotas;if(t&&t.length){var r=this.storage.getItem(this.quotasKey)||{};r[e]||(r[e]={value:0,lastTime:Date.now()});var n=r[e].value;0===n&&(r[e].lastTime=Date.now()),r[e].value=n+1,this.storage.setItem(this.quotasKey,r)}},CepRule.prototype.checkQuotas=function(e){var t=this.stateArray.get(e).quotas,r=this.storage.getItem(this.quotasKey)||{};if(r[e]||(r[e]={value:0,lastTime:Date.now()}),t&&t.length){var n=t[0].granularity,i=t[0].value;if("per_keyid"!==t[0].type)return!0;var a=this.release(n);return"all"===a?!(r[e].value>=i&&(console.log("plan:"+e+" limit"),1)):Date.now()-r[e].lastTime>=a?(r[e].value=0,r[e].lastTime=Date.now(),this.storage.setItem(this.quotasKey,r),!0):!(r[e].value>=i&&(console.log("plan:"+e+" limit"),1))}return!0},CepRule.prototype.clearQuotas=function(){this.storage.setItem(this.quotasKey,null)},CepRule.prototype.release=function(e){if("all"===e)return e;var t=dayjs_min.duration(e);return t?t.asMilliseconds():"all"},CepRule.prototype.reset=function(e,t){var r=this.stateArray.get(e);if(r.singleRule){var n=r.patternState.get(t);n.isMatch=!1,n.event=null,n.matchTime=0,n.initTime=Date.now(),r.patternState.set(t,n)}else r.patternState.forEach((function(e){e.isMatch=!1,e.event=null,e.matchTime=0,e.initTime=Date.now()}));this.stateArray.set(e,r);var i=this.waitArray.get(e);i&&i.get(t)&&(clearTimeout(i.get(t).waitFn),i.delete(t))},CepRule.prototype.event=function(e,t){try{var r={event:e,params:JSON.stringify({plan_id:t||"",biz_id:this.stateArray.get(t).pattern.biz_id}),local_time_ms:Date.now()},n=this.configManager.get(),i=n.header,a=n.user;i.custom=JSON.stringify(i.custom);var o={events:[r],user:a,header:i};this.fetch(this.reportUrl,[o])}catch(s){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:s.message}),void console.log(s.message)}},CepRule.prototype.scope=function(e){var t="",r="";if(e.indexOf(".")>-1){var n=e.split(".");t=n[0],e=n[1],"header"===t&&"custom"===e&&(e=n[2],r=n[1])}return{scope:t,key:e,key2:r}},CepRule.prototype.calculate=function(op,paramA,paramB){try{if("="===op)return paramA===paramB;if(-1!==["=","<",">",">=","<=","!="].indexOf(op))return eval(""+paramA+op+paramB);if(-1!==["in","contains"].indexOf(op))return-1!==paramB.indexOf(paramA);if(-1!==["is not null","is null"].indexOf(op))return"is null"===op?null==paramA:null!=paramA;if(-1!==["startswith","endswith"].indexOf(op)){if("startswith"===op)return 0===paramA.indexOf(paramB);var start=paramA.length-paramB.length,str=paramA.substr(start,paramB.length);return str===paramB}}catch(e){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:e.message}),console.log(e.message),!1}},CepRule}(),pluginExtendList={autotrack:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/autotrack.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/autotrack.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/autotrack.js"},object:"LogAutoTrack"},ab:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/ab.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/ab.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/ab.js"},object:"LogAb"},stay:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/stay.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/stay.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/stay.js"},object:"LogStay"},route:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/route.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/route.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/route.js"},object:"LogRoute"},cep:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/cep.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/cep.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/cep.js"},object:"LogCep"},tracer:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/tracer.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/tracer.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/tracer.js"},object:"LogTracer"},visual:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/visual.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/visual.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/visual.js"},object:"LogVisual"}},getLogPluginSpace=function(){return"undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null},pluginObject=getLogPluginSpace(),PluginExtend=function(){function e(){}return e.prototype.apply=function(e,t){this._plugin={},this.config=t,this.collect=e,this.channel=t.channel||"cn",this.loadExtend()},e.prototype.loadExtend=function(){var e=this;try{this.collect.remotePlugin.forEach((function(t,r){if("sdk"===t)if(pluginExtendList.hasOwnProperty(r)){var n=pluginExtendList[r].object,i=""+pluginExtendList[r].src[e.channel];e.exist(r,n,i)}else console.warn("your "+r+" is not existï¼Œplease check plugin name");else"object"==_typeof$7(t)&&(t.src?e.exist(r,t.call,t.src):e.process(r,t.instance,"INSTANCE"))}))}catch(t){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:t.message}),console.log("load extend error")}},e.prototype.exist=function(e,t,r){var n=this;pluginObject[t]?(this.process(e,pluginObject[t]),console.log("å·²æœ‰"+e+"æ’ä»¶ï¼Œé¿å…é‡å¤åŠ è½½~")):this.loadPlugin(e,r,(function(){n.process(e,pluginObject[t]),console.log(" %c %s %s %s","color: yellow; background-color: black;","â€“","load plugin:"+e+" success","-")}),(function(){console.log(" %c %s %s %s","color: red; background-color: yellow;","â€“","load plugin:"+e+" error","-")}))},e.prototype.process=function(e,t,r){try{if(r){var n=new t;n.apply&&n.apply(this.collect,this.config),console.log("excude "+e+" success")}else t&&t(this.collect,this.config)}catch(i){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:i.message}),console.log("excude "+e+" error, message:"+i.message)}},e.prototype.loadPlugin=function(e,t,r,n){var i=this;try{var a=document.createElement("script");a.src=t,this._plugin[e]||(this._plugin[e]=[]),this._plugin[e].push(r),a.onerror=function(){n(t)},a.onload=function(){i._plugin[e].forEach((function(e){e()}))},document.getElementsByTagName("head")[0].appendChild(a)}catch(o){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:o.message})}},e}(),Verify=function(){function e(){this.verifyReady=!1,this.waitTime=5e3,this.cleanStatus=!1}return e.prototype.apply=function(e,t){var r=this;this.collector=e,this.config=t;var n=e.adapters.storage;this.cacheStorgae=new n(!1,"session"),this.eventStorage=[],this.collector.on("submit-verify",(function(e){e&&e.length&&r.eventStore(e[0])})),this.checkCache()},e.prototype.checkCache=function(){var e=this;this.verifyCookieKey="__applog_verify_set_"+this.config.app_id,this.cacheStorgae.getCookie(this.verifyCookieKey);var t=this.cacheStorgae.getItem(this.verifyCookieKey);this.sign=t&&t.sign||"",this.origin=t&&t.origin||"*";var r=setTimeout((function(){e.cleanVerify(),clearTimeout(r),e.collector.off("submit-verify")}),this.waitTime);window.addEventListener("message",(function(t){t&&t.data&&"simulator:verify"===t.data.type&&(clearTimeout(r),e.receMessage(t))}),!0)},e.prototype.receMessage=function(e){if(!this.cleanStatus){var t=e.data;this.verifyReady=!0,this.sign=t.sign,this.origin=e.origin,this.cacheStorgae.setItem(this.verifyCookieKey,JSON.stringify({sign:t.sign,origin:e.origin})),this.eventStorage.length&&this.postVerify(this.eventStorage,t.sign,e.origin)}},e.prototype.eventStore=function(e){this.cleanStatus||(this.verifyReady?this.postVerify(e,this.sign,this.origin):this.eventStorage.push(e))},e.prototype.cleanVerify=function(){this.cleanStatus=!0,this.eventStorage=[]},e.prototype.postVerify=function(e,t,r){try{var n=[];isArray$2(e)?e.forEach((function(e){n.push(e)})):n.push(e);var i={type:"simulator:verify:event",sign:t,pageUrl:window.location.href,events:n};(window.opener||window.parent).postMessage(i,r)}catch(a){console.log("web verify post message error ~")}},e}(),RuotePage=function(){function e(){this.autotrack=!1,this.spa=!1,this.cache={},this.allowHash=!1}return e.prototype.apply=function(e,t){if(t.spa||t.autotrack){var r=e.Types;this.collect=e,this.config=t,this.appid=t.app_id,this.allowHash=t.allow_hash,this.fncArray=new Map,this.setKey(),this.setLocation(),this.hack(),this.init(),this.listener(),e.emit(r.RouteReady)}},e.prototype.setKey=function(){var e=this.collect.adapters.storage;this.storage=new e(!1),this.cache_key="__tea_cache_refer_"+this.appid,this.cache={refer_key:location.href,refer_title:document.title||location.pathname,refer_manual_key:""},this.config.autotrack&&"object"==_typeof$7(this.config.autotrack)&&this.config.autotrack.page_manual_key&&(this.cache.refer_manual_key=this.config.autotrack.page_manual_key),this.storage.setItem(this.cache_key,this.cache)},e.prototype.hack=function(){var e=this,t=window.history.pushState;history.pushState=function(r){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];"function"==typeof history.onpushstate&&history.onpushstate({state:r});var a=t.call.apply(t,__spread([history,r],n)),o=e.getPopStateChangeEventData();return e.lastLocation=stringify(location.href,n[1]),e.sendPv(o,"pushState"),a};var r=history.replaceState;history.replaceState=function(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];"function"==typeof history.onreplacestate&&history.onreplacestate({state:t});var a=r.call.apply(r,__spread([history,t],n)),o=e.getPopStateChangeEventData();return e.lastLocation=stringify(location.href,n[1]),e.sendPv(o),a}},e.prototype.setLocation=function(){"undefined"!=typeof window&&(this.lastLocation=window.location.href)},e.prototype.init=function(){var e=this.getPopStateChangeEventData();this.collect.emit("route-change",{config:e,init:!0})},e.prototype.listener=function(){var e=this,t=null;window.addEventListener("hashchange",(function(r){if(e.lastLocation!==window.location.href&&(clearTimeout(t),e.allowHash)){e.lastLocation=window.location.href;var n=e.getPopStateChangeEventData();e.sendPv(n)}})),window.addEventListener("popstate",(function(r){e.lastLocation!==window.location.href&&(t=setTimeout((function(){e.lastLocation=window.location.href;var t=e.getPopStateChangeEventData();e.sendPv(t)}),10))}))},e.prototype.getPopStateChangeEventData=function(){var e=this.pageConfig();return e.is_back=0,e},e.prototype.pageConfig=function(){try{var e,t,r=this.storage.getItem(this.cache_key)||{};e=document.referrer?document.referrer:r&&r.refer_key||"";var n=this.storage.getItem("__tea_cache_first_"+this.appid);return t=!n||1!=n,{is_html:1,url:location.href,referrer:e,page_key:location.href,refer_page_key:e,page_title:document.title||location.pathname,page_manual_key:this.config.autotrack&&this.config.autotrack.page_manual_key||"",refer_page_manual_key:r&&r.refer_manual_key||"",refer_page_title:r&&r.refer_title||"",page_path:location.pathname,page_host:location.host,is_first_time:""+t}}catch(i){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:i.message}),{}}},e.prototype.sendPv=function(e,t){this.collect.emit("route-change",{config:e,init:!1})},e}();Collector$2.usePlugin(PluginExtend,"extend"),Collector$2.usePlugin(Ab,"ab"),Collector$2.usePlugin(Stay,"stay"),Collector$2.usePlugin(AutoTrack,"autotrack"),Collector$2.usePlugin(Verify,"verify"),Collector$2.usePlugin(Et,"et"),Collector$2.usePlugin(Profile,"profile"),Collector$2.usePlugin(CepRule,"cep"),Collector$2.usePlugin(HeartBeat,"heartbeat"),Collector$2.usePlugin(Monitor,"monitor"),Collector$2.usePlugin(RuotePage,"route"),Collector$2.usePlugin(Tracer,"tracer"),new Collector$2("default");var Collector$1$1=Collector$2,wellKnownSymbolWrapped={},wellKnownSymbol$2=wellKnownSymbol$u;wellKnownSymbolWrapped.f=wellKnownSymbol$2;var global$3=global$O,path$1=global$3,path=path$1,hasOwn$4=hasOwnProperty_1,wrappedWellKnownSymbolModule$1=wellKnownSymbolWrapped,defineProperty$1=objectDefineProperty.f,wellKnownSymbolDefine=function(e){var t=path.Symbol||(path.Symbol={});hasOwn$4(t,e)||defineProperty$1(t,e,{value:wrappedWellKnownSymbolModule$1.f(e)})},call$1=functionCall,getBuiltIn$1=getBuiltIn$j,wellKnownSymbol$1=wellKnownSymbol$u,defineBuiltIn$1=defineBuiltIn$l,symbolDefineToPrimitive=function(){var e=getBuiltIn$1("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,n=wellKnownSymbol$1("toPrimitive");t&&!t[n]&&defineBuiltIn$1(t,n,(function(e){return call$1(r,this)}),{arity:1})},$$d=_export,global$2=global$O,call=functionCall,uncurryThis$3=functionUncurryThis,DESCRIPTORS$3=descriptors,NATIVE_SYMBOL$3=symbolConstructorDetection,fails$3=fails$10,hasOwn$3=hasOwnProperty_1,isPrototypeOf$1=objectIsPrototypeOf,anObject=anObject$p,toIndexedObject$1=toIndexedObject$e,toPropertyKey=toPropertyKey$6,$toString=toString$v,createPropertyDescriptor=createPropertyDescriptor$a,nativeObjectCreate=objectCreate$1,objectKeys=objectKeys$4,getOwnPropertyNamesModule=objectGetOwnPropertyNames,getOwnPropertyNamesExternal=objectGetOwnPropertyNamesExternal,getOwnPropertySymbolsModule$1=objectGetOwnPropertySymbols,getOwnPropertyDescriptorModule$1=objectGetOwnPropertyDescriptor,definePropertyModule=objectDefineProperty,definePropertiesModule=objectDefineProperties,propertyIsEnumerableModule=objectPropertyIsEnumerable,defineBuiltIn=defineBuiltIn$l,shared$2=shared$7.exports,sharedKey=sharedKey$4,hiddenKeys=hiddenKeys$6,uid=uid$5,wellKnownSymbol=wellKnownSymbol$u,wrappedWellKnownSymbolModule=wellKnownSymbolWrapped,defineWellKnownSymbol$1=wellKnownSymbolDefine,defineSymbolToPrimitive=symbolDefineToPrimitive,setToStringTag=setToStringTag$9,InternalStateModule=internalState,$forEach=arrayIteration.forEach,HIDDEN=sharedKey("hidden"),SYMBOL="Symbol",PROTOTYPE="prototype",setInternalState=InternalStateModule.set,getInternalState=InternalStateModule.getterFor(SYMBOL),ObjectPrototype=Object[PROTOTYPE],$Symbol=global$2.Symbol,SymbolPrototype$1=$Symbol&&$Symbol[PROTOTYPE],TypeError$1=global$2.TypeError,QObject=global$2.QObject,nativeGetOwnPropertyDescriptor=getOwnPropertyDescriptorModule$1.f,nativeDefineProperty=definePropertyModule.f,nativeGetOwnPropertyNames=getOwnPropertyNamesExternal.f,nativePropertyIsEnumerable=propertyIsEnumerableModule.f,push=uncurryThis$3([].push),AllSymbols=shared$2("symbols"),ObjectPrototypeSymbols=shared$2("op-symbols"),WellKnownSymbolsStore=shared$2("wks"),USE_SETTER=!QObject||!QObject[PROTOTYPE]||!QObject[PROTOTYPE].findChild,setSymbolDescriptor=DESCRIPTORS$3&&fails$3((function(){return 7!=nativeObjectCreate(nativeDefineProperty({},"a",{get:function(){return nativeDefineProperty(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=nativeGetOwnPropertyDescriptor(ObjectPrototype,t);n&&delete ObjectPrototype[t],nativeDefineProperty(e,t,r),n&&e!==ObjectPrototype&&nativeDefineProperty(ObjectPrototype,t,n)}:nativeDefineProperty,wrap=function(e,t){var r=AllSymbols[e]=nativeObjectCreate(SymbolPrototype$1);return setInternalState(r,{type:SYMBOL,tag:e,description:t}),DESCRIPTORS$3||(r.description=t),r},$defineProperty=function(e,t,r){e===ObjectPrototype&&$defineProperty(ObjectPrototypeSymbols,t,r),anObject(e);var n=toPropertyKey(t);return anObject(r),hasOwn$3(AllSymbols,n)?(r.enumerable?(hasOwn$3(e,HIDDEN)&&e[HIDDEN][n]&&(e[HIDDEN][n]=!1),r=nativeObjectCreate(r,{enumerable:createPropertyDescriptor(0,!1)})):(hasOwn$3(e,HIDDEN)||nativeDefineProperty(e,HIDDEN,createPropertyDescriptor(1,{})),e[HIDDEN][n]=!0),setSymbolDescriptor(e,n,r)):nativeDefineProperty(e,n,r)},$defineProperties=function(e,t){anObject(e);var r=toIndexedObject$1(t),n=objectKeys(r).concat($getOwnPropertySymbols(r));return $forEach(n,(function(t){DESCRIPTORS$3&&!call($propertyIsEnumerable,r,t)||$defineProperty(e,t,r[t])})),e},$create=function(e,t){return void 0===t?nativeObjectCreate(e):$defineProperties(nativeObjectCreate(e),t)},$propertyIsEnumerable=function(e){var t=toPropertyKey(e),r=call(nativePropertyIsEnumerable,this,t);return!(this===ObjectPrototype&&hasOwn$3(AllSymbols,t)&&!hasOwn$3(ObjectPrototypeSymbols,t))&&(!(r||!hasOwn$3(this,t)||!hasOwn$3(AllSymbols,t)||hasOwn$3(this,HIDDEN)&&this[HIDDEN][t])||r)},$getOwnPropertyDescriptor=function(e,t){var r=toIndexedObject$1(e),n=toPropertyKey(t);if(r!==ObjectPrototype||!hasOwn$3(AllSymbols,n)||hasOwn$3(ObjectPrototypeSymbols,n)){var i=nativeGetOwnPropertyDescriptor(r,n);return!i||!hasOwn$3(AllSymbols,n)||hasOwn$3(r,HIDDEN)&&r[HIDDEN][n]||(i.enumerable=!0),i}},$getOwnPropertyNames=function(e){var t=nativeGetOwnPropertyNames(toIndexedObject$1(e)),r=[];return $forEach(t,(function(e){hasOwn$3(AllSymbols,e)||hasOwn$3(hiddenKeys,e)||push(r,e)})),r},$getOwnPropertySymbols=function(e){var t=e===ObjectPrototype,r=nativeGetOwnPropertyNames(t?ObjectPrototypeSymbols:toIndexedObject$1(e)),n=[];return $forEach(r,(function(e){!hasOwn$3(AllSymbols,e)||t&&!hasOwn$3(ObjectPrototype,e)||push(n,AllSymbols[e])})),n};NATIVE_SYMBOL$3||($Symbol=function(){if(isPrototypeOf$1(SymbolPrototype$1,this))throw TypeError$1("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?$toString(arguments[0]):void 0,t=uid(e),r=function e(r){this===ObjectPrototype&&call(e,ObjectPrototypeSymbols,r),hasOwn$3(this,HIDDEN)&&hasOwn$3(this[HIDDEN],t)&&(this[HIDDEN][t]=!1),setSymbolDescriptor(this,t,createPropertyDescriptor(1,r))};return DESCRIPTORS$3&&USE_SETTER&&setSymbolDescriptor(ObjectPrototype,t,{configurable:!0,set:r}),wrap(t,e)},SymbolPrototype$1=$Symbol[PROTOTYPE],defineBuiltIn(SymbolPrototype$1,"toString",(function(){return getInternalState(this).tag})),defineBuiltIn($Symbol,"withoutSetter",(function(e){return wrap(uid(e),e)})),propertyIsEnumerableModule.f=$propertyIsEnumerable,definePropertyModule.f=$defineProperty,definePropertiesModule.f=$defineProperties,getOwnPropertyDescriptorModule$1.f=$getOwnPropertyDescriptor,getOwnPropertyNamesModule.f=getOwnPropertyNamesExternal.f=$getOwnPropertyNames,getOwnPropertySymbolsModule$1.f=$getOwnPropertySymbols,wrappedWellKnownSymbolModule.f=function(e){return wrap(wellKnownSymbol(e),e)},DESCRIPTORS$3&&(nativeDefineProperty(SymbolPrototype$1,"description",{configurable:!0,get:function(){return getInternalState(this).description}}),defineBuiltIn(ObjectPrototype,"propertyIsEnumerable",$propertyIsEnumerable,{unsafe:!0}))),$$d({global:!0,constructor:!0,wrap:!0,forced:!NATIVE_SYMBOL$3,sham:!NATIVE_SYMBOL$3},{Symbol:$Symbol}),$forEach(objectKeys(WellKnownSymbolsStore),(function(e){defineWellKnownSymbol$1(e)})),$$d({target:SYMBOL,stat:!0,forced:!NATIVE_SYMBOL$3},{useSetter:function(){USE_SETTER=!0},useSimple:function(){USE_SETTER=!1}}),$$d({target:"Object",stat:!0,forced:!NATIVE_SYMBOL$3,sham:!DESCRIPTORS$3},{create:$create,defineProperty:$defineProperty,defineProperties:$defineProperties,getOwnPropertyDescriptor:$getOwnPropertyDescriptor}),$$d({target:"Object",stat:!0,forced:!NATIVE_SYMBOL$3},{getOwnPropertyNames:$getOwnPropertyNames}),defineSymbolToPrimitive(),setToStringTag($Symbol,SYMBOL),hiddenKeys[HIDDEN]=!0;var NATIVE_SYMBOL$2=symbolConstructorDetection,symbolRegistryDetection=NATIVE_SYMBOL$2&&!!Symbol.for&&!!Symbol.keyFor,$$c=_export,getBuiltIn=getBuiltIn$j,hasOwn$2=hasOwnProperty_1,toString$4=toString$v,shared$1=shared$7.exports,NATIVE_SYMBOL_REGISTRY$1=symbolRegistryDetection,StringToSymbolRegistry=shared$1("string-to-symbol-registry"),SymbolToStringRegistry$1=shared$1("symbol-to-string-registry");$$c({target:"Symbol",stat:!0,forced:!NATIVE_SYMBOL_REGISTRY$1},{for:function(e){var t=toString$4(e);if(hasOwn$2(StringToSymbolRegistry,t))return StringToSymbolRegistry[t];var r=getBuiltIn("Symbol")(t);return StringToSymbolRegistry[t]=r,SymbolToStringRegistry$1[r]=t,r}});var $$b=_export,hasOwn$1=hasOwnProperty_1,isSymbol=isSymbol$6,tryToString=tryToString$7,shared=shared$7.exports,NATIVE_SYMBOL_REGISTRY=symbolRegistryDetection,SymbolToStringRegistry=shared("symbol-to-string-registry");$$b({target:"Symbol",stat:!0,forced:!NATIVE_SYMBOL_REGISTRY},{keyFor:function(e){if(!isSymbol(e))throw TypeError(tryToString(e)+" is not a symbol");if(hasOwn$1(SymbolToStringRegistry,e))return SymbolToStringRegistry[e]}});var $$a=_export,NATIVE_SYMBOL$1=symbolConstructorDetection,fails$2=fails$10,getOwnPropertySymbolsModule=objectGetOwnPropertySymbols,toObject=toObject$k,FORCED=!NATIVE_SYMBOL$1||fails$2((function(){getOwnPropertySymbolsModule.f(1)}));$$a({target:"Object",stat:!0,forced:FORCED},{getOwnPropertySymbols:function(e){var t=getOwnPropertySymbolsModule.f;return t?t(toObject(e)):[]}});var $$9=_export,DESCRIPTORS$2=descriptors,ownKeys$c=ownKeys$j,toIndexedObject=toIndexedObject$e,getOwnPropertyDescriptorModule=objectGetOwnPropertyDescriptor,createProperty=createProperty$6;$$9({target:"Object",stat:!0,sham:!DESCRIPTORS$2},{getOwnPropertyDescriptors:function(e){for(var t,r,n=toIndexedObject(e),i=getOwnPropertyDescriptorModule.f,a=ownKeys$c(n),o={},s=0;a.length>s;)void 0!==(r=i(n,t=a[s++]))&&createProperty(o,t,r);return o}});var $$8=_export,DESCRIPTORS$1=descriptors,defineProperties=objectDefineProperties.f;$$8({target:"Object",stat:!0,forced:Object.defineProperties!==defineProperties,sham:!DESCRIPTORS$1},{defineProperties:defineProperties});var DEBUG$1="undefined"!=typeof window&&window.location.href.indexOf("loggerdebug")>-1;function computeWatchDur(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=0,r=0;r<e.length;r++)isNaN(Number(e[r].end))||isNaN(Number(e[r].begin))||e[r].begin<0||e[r].end<0||e[r].end<e[r].begin||(t+=e[r].end-e[r].begin);return t=parseInt(1e3*t,10)}function getHostFromUrl(e){if(null==e||""===e||"string"!=typeof e)return"";var t=e.split("/"),r="";return t.length>3&&t[2]&&(r=t[2]),r}function generateSessionId(t){var r=(new Date).getTime();try{t=parseInt(t)}catch(e){t=0}return r+=t,window.performance&&"function"==typeof window.performance.now&&(r+=window.performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"===e?t:3&t|8).toString(16)}))}function isType(e){return function(t){return Object.prototype.toString.call(t)==="[object ".concat(e,"]")}}function getResponseHeaders(e){var t={};if(e instanceof window.XMLHttpRequest)try{e.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((function(e){var r=e.split(": "),n=r.shift(),i=r.join(": ");t[n]=i}))}catch(error){}return t}function log$1(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];DEBUG$1&&(t=console).log.apply(t,["[logger]",e].concat(n))}function nowTime(){try{return Math.round(window.performance.now())}catch(error){return(new Date).getTime()}}function curTimestamp(){return(new Date).getTime()}function formatData(e,t){var r={ext:e.ext||{},data:{}};return Object.keys(e).map((function(n){t[n]?r.data[t[n]]=e[n]:"ext"!==n&&(r.ext[n]=e[n])})),r}function getXhr(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(n,i){try{t||i(new Error("url is undefined"));var a=0,o=0,s={},u=new window.XMLHttpRequest;u.open("get",t),u.onreadystatechange=function(){2===u.readyState&&(s.headers=getResponseHeaders(u),s.connectTime=nowTime()-o,s.status=u.status,s.statusText=u.statusText,a=nowTime()),1===u.readyState&&(o=nowTime())},u.onload=function(){n(s)},u.onprogress=function(e){var t,r=nowTime()-a;r<5&&(r=nowTime()-o),t=parseInt(e.loaded/1e3/(r/1e3),10),s.speed=t,s.costTime=r},u.onerror=function(e){i(e)},u.ontimeout=function(){s.status||(s.status=-2),n(s)},u.onabort=function(){n(s)},u.responseType="arraybuffer",u.timeout=r.timeout||1e4,u.setRequestHeader("Range","bytes=".concat(r.range||"0-1048576")),u.send()}catch(e){i(e)}}))}function checkVideoSrcIsEmpty(e){return!e||window.location.href.indexOf(e)>-1}var KEYMAP={x_response_sinfo:"x-response-sinfo",x_response_cache:"x-response-cache",x_response_cinfo:"x-response-cinfo"};function transformHeader(e){if(!e)return{};var t={};return Object.keys(KEYMAP).map((function(r){if(e[r]||"string"!=typeof KEYMAP[r]){if(!e[r]&&KEYMAP[r]instanceof Array){var n=KEYMAP[r].filter((function(t){return void 0!==e[t]}));n.length>0?t[r]=e[n[0]]:t[r]=""}}else t[r]=e[KEYMAP[r]]||""})),t}function appendData(e,t){return e&&("string"==typeof t||"number"==typeof t)?e+""+t:t}function typeOf(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]}function parseTempData(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return Object.keys(t).map((function(n){e[n]="append"===r?appendData(e[n],t[n]):t[n]})),e}function hasClass$1(t,r){if(!t||!r)return!1;try{return Array.prototype.some.call(t.classList,(function(e){return e===r}))}catch(e){var n=t.className&&"object"===_typeof$4(t.className)?t.getAttribute("class"):t.className;return n&&!!n.match(new RegExp("(\\s|^)"+r+"(\\s|$)"))}}function formatDefinition(e){return"String"===typeOf(e)?e.replace("P","p"):e?"Number"===typeOf(e)?"".concat(e):void 0:""}function toJsonString(t){try{return JSON.stringify(t)}catch(e){return""}}var ENTRIES=[],MAX_COUNT=30;function findPerformanceInfo(t){var r={};try{var n=function(){t=t.replace(/^http:|^https:/,"");for(var e=ENTRIES||[],n=function(n){if(e[n].name.replace(/^http:|^https:/,"")===t)return["domainLookupEnd","domainLookupStart","startTime","requestStart","responseEnd","responseStart","connectStart","connectEnd","fetchStart"].map((function(t){r[t]=Math.round(e[n][t])})),r.url=e[n].name,r.duration=Math.round(e[n].duration),r.domainDuration=r.domainLookupEnd-r.domainLookupStart,r.connectDuration=r.connectEnd-r.connectStart,"break"},i=e.length-1;i>=0;i--){if("break"===n(i))break}return{v:r}}();if("object"===_typeof$4(n))return n.v}catch(e){return r}}function addPerformaceObserver(){try{new window.PerformanceObserver((function(e,t){var r=e.getEntriesByType("resource");ENTRIES.length>MAX_COUNT&&ENTRIES.splice(0,ENTRIES.length-MAX_COUNT);for(var n=0;n<r.length;n++)ENTRIES.push(r[n])})).observe({entryTypes:["resource"]})}catch(e){console.warn("PerformanceObserver not support",e)}}"undefined"!=typeof window&&addPerformaceObserver();var isSupport$1=_isLocalStorageUsable$1();function probeSupport$1(){try{return"undefined"!=typeof localStorage&&"setItem"in window.localStorage&&!!window.localStorage.setItem}catch(e){return!1}}function checkIfLocalStorageThrows$1(){var t="_localstorage_support_test";try{return window.localStorage.setItem(t,!0),window.localStorage.removeItem(t),!1}catch(e){return!0}}function _isLocalStorageUsable$1(){return probeSupport$1()&&!checkIfLocalStorageThrows$1()}var Strorage=isSupport$1?window.localStorage:{},LOGKEY="__xgplayerlogkey",LOCAL_LOG={set:function(e){try{var t=this.get();t.push(e),Strorage.setItem(LOGKEY,JSON.stringify(t))}catch(error){}},get:function(){try{var e=Strorage.getItem(LOGKEY);return e=e?JSON.parse(e):[]}catch(error){return[]}},remove:function(){try{Strorage.removeItem(LOGKEY)}catch(error){}},clear:function(){try{Strorage.clear()}catch(error){}}},$$7=_export,DESCRIPTORS=descriptors,global$1=global$O,uncurryThis$2=functionUncurryThis,hasOwn=hasOwnProperty_1,isCallable=isCallable$v,isPrototypeOf=objectIsPrototypeOf,toString$3=toString$v,defineProperty=objectDefineProperty.f,copyConstructorProperties=copyConstructorProperties$3,NativeSymbol=global$1.Symbol,SymbolPrototype=NativeSymbol&&NativeSymbol.prototype;if(DESCRIPTORS&&isCallable(NativeSymbol)&&(!("description"in SymbolPrototype)||void 0!==NativeSymbol().description)){var EmptyStringDescriptionStore={},SymbolWrapper=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:toString$3(arguments[0]),t=isPrototypeOf(SymbolPrototype,this)?new NativeSymbol(e):void 0===e?NativeSymbol():NativeSymbol(e);return""===e&&(EmptyStringDescriptionStore[t]=!0),t};copyConstructorProperties(SymbolWrapper,NativeSymbol),SymbolWrapper.prototype=SymbolPrototype,SymbolPrototype.constructor=SymbolWrapper;var NATIVE_SYMBOL="Symbol(test)"==String(NativeSymbol("test")),thisSymbolValue=uncurryThis$2(SymbolPrototype.valueOf),symbolDescriptiveString=uncurryThis$2(SymbolPrototype.toString),regexp=/^Symbol\((.*)\)[^)]+$/,replace$1=uncurryThis$2("".replace),stringSlice=uncurryThis$2("".slice);defineProperty(SymbolPrototype,"description",{configurable:!0,get:function(){var e=thisSymbolValue(this);if(hasOwn(EmptyStringDescriptionStore,e))return"";var t=symbolDescriptiveString(e),r=NATIVE_SYMBOL?stringSlice(t,7,-1):replace$1(t,regexp,"$1");return""===r?void 0:r}}),$$7({global:!0,constructor:!0,forced:!0},{Symbol:SymbolWrapper})}var RegMap=[{key:"QQBrowser",reg:/(qqbrowser)\/([\d.]+)/},{key:"QIHU360EE",reg:/qihu 360ee/},{key:"QIHU360SE",reg:/qihu 360se/},{key:"2345Explorer",reg:/(2345explorer)\/([\d.]+)/},{key:"Sogou",reg:/(metasr)/},{key:"Wexin",reg:/(micromessenger)\/([\d.]+)/},{key:"Openlanguage",reg:/(openlanguage)\/([\d.]+)/},{key:"NewsArticle",reg:/(newsarticle)\/([\d.]+)/},{key:"VideoArticle",reg:/(videoarticle)\/([\d.]+)/},{key:"Hotsoon",reg:/(live_stream)_([\d.]+)/},{key:"Aweme",reg:/(aweme)_([\d.]+)/},{key:"Lark",reg:/(lark)\/([\d.]+)/},{key:"PlayStation",reg:/(playstation)/},{key:"BingPreview",reg:/(bingpreview)\/([\d.]+)/},{key:"Baiduspider",reg:/(baiduspider-render)\/([\d.]+)/},{key:"YandexBot",reg:/(yandexbot)\/([\d.]+)/},{key:"Chrome",reg:/(chrome)\/([\d.]+)/},{key:"Safari",reg:/(version)\/([\d.]+)\s*(safari)/}],IERegMap=[{key:"Trident",reg:/(rv:)([\d.]+)/},{key:"Trident",reg:/(msie)\s*([\d.]+)/}];function isSupportMP4(){var e=document.createElement("video"),t={isSupport:!1,mime:""};return"function"==typeof e.canPlayType?(["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"].map((function(r){"probably"===e.canPlayType('video/mp4; codecs="'.concat(r,'"'))&&(t.isSupport=!0,t.mime+="||".concat(r))})),t):(e=null,t)}var SPIDER_UA=["Baiduspider","YandexBot"];function checkIsSpider(e,t){var r=!1;return SPIDER_UA.map((function(t){t===e&&(r=!0)})),/(\+http|; http|\(http):\/\/([\w.]+\/?)\S*/.test(t)&&(r=!0),r}function detect(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";e=e.toLocaleLowerCase();var t=/(iphone)/.test(e)||/(ipad)/.test(e),r=/(android)/.test(e),n=/(windows phone)/.test(e),i=t||r||n,a={isIOS:t,isAndroid:r,isMobile:i,isPC:!i,isPad:/(ipad)/.test(e)},o=isSupportMP4();a.isSupportMP4=o.isSupport,a.mime=o.mime;var s="",u=0,c=[],l=RegMap;/trident/.test(e)&&(l=IERegMap);for(var d=0;d<l.length;d++)if(c=l[d].reg.exec(e)){s=l[d].key,u=c.length>2?c[2]:"";break}if(s)a["is".concat(s)]=!0,a.name=s,a.appVersion=u;else{var h=checkIs360();h&&(a.name="360EE")}if(a.name&&"Trident"!==a.name){var f=/(trident)/.exec(e);f&&(a.name=a.name?"".concat(a.name,"_Trident"):"Trident")}return a.isSpider=checkIsSpider(a.name),a}function checkIs360(){var e=navigator.mimeTypes;if(e){for(var t=0;t<e.length;t++){if(e[t].type&&e[t].type.indexOf("360")>-1)return!0;if(e[t].type&&e[t].type.indexOf("application/vnd.chromium.remoting-viewer")>-1)return!0;if(e[t].description&&e[t].description.indexOf("360")>-1)return!0}return!1}}var Browser$1="undefined"!=typeof navigator&&detect(navigator.userAgent),defaultConfig={range:"0-1048576",timer:6e4,timeout:15e3},SpeedCheckTask=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck$4(this,e),Object.keys(defaultConfig).map((function(e){void 0!==t[e]&&null!==t[e]||(t[e]=defaultConfig[e])})),this.options=t,this._headers={},this.intervalId=null,this.ishangUp=!1,this._data={contentLength:0,statusText:"",status:-1,speed:0,costTime:0,connectTime:0,contentType:""},this.url=[]}return _createClass$5(e,[{key:"setData",value:function(e,t){var r=this;if(Object.keys(e).map((function(t){"headers"!==t&&(r._data[t]=e[t])})),e.headers&&Object.keys(e.headers).length>0){this._headers=transformHeader(e.headers),e.headers["content-type"]&&(this._data.contentType=e.headers["content-type"]);var n=(e.headers["content-range"]||"").split("/");n&&n.length>1&&(this._data.contentLength=parseInt(n[1]))}}},{key:"contentLength",get:function(){return this._data.length||0}},{key:"trigger",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"start",n=this.options;this.url=e,!this.url||"start"!==r&&(this.ishangUp||this.intervalId)?log$1("task>>cant`t trigger url",this.ishangUp,this.intervalId):(log$1("task>>trigger url ",e),this.ishangUp=!0,this.intervalId&&this.clear(),this.intervalId=setTimeout((function(){t.clear()}),"start"===r?500:n.timer),getXhr(this.url,{range:"start"===r?"0-1024":n.range,timeout:n.timeout}).then((function(e){log$1("getXhr>>check result ",e),t.setData(e||{}),t.ishangUp=!1})).catch((function(e){log$1("getXhr>>error ",e),t.ishangUp=!1,t._data.status=-1})))}},{key:"url",get:function(){return this.options.url},set:function(e){e&&(this.options.url=e)}},{key:"serverIp",get:function(){return this._headers.x_response_sinfo||""}},{key:"headers",get:function(){return this._headers||{}}},{key:"status",get:function(){return this._data.status||-1}},{key:"speed",get:function(){return this._data.speed}},{key:"clear",value:function(){clearTimeout(this.intervalId),this.intervalId=null}}]),e}(),version$2="0.11.11";function ownKeys$b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$b(Object(r),!0).forEach((function(t){_defineProperty$5(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}log$1("logger version is ".concat(version$2));var isObject$3=isType("Object"),REPORT_EVENTS={ONE_PLAY:"videoplayer_oneplay",ONE_OPERA:"videoplayer_oneopera",ONE_ERROR:"videoplayer_oneerror",ONE_EVENT:"videoplayer_oneevent",ONE_TEMP:"videoplayer_onetemp"},ERROR_TYPES$2={data:1e3,runtime:1002,parse:1004,network:1003,no_error_handler:9997,custom_error:9998,other:9999,notSupport:1005},ERROR_CODES$1={1:-499991,2:-499992,3:-499993,4:-499994,5:-499995},PLAYBACK_STATE={STOP:0,PLAYING:1,PAUSE:2,ERROR:3,LOADING:4},LOAD_STATES={UNKNOWN:0,PLAYABLE:1,STALLED:2,ERROR:3},ENDED_TYPE={ERROR:1,NEXT:2,ENDED:3,UNLOAD:4,DESTROY:5,PLAY_CATCH:6},LOGTYPES={RETRY:"error_retry",ONEERROR:"oneerror",ONEEVENT:"oneevent",ONETEMP:"onetemp"},CACHE_FILE_TYPE={NO_CACHE:0,CACHED:1},TEA_ID=1300,LS_KEY="__tea_cache_tokens_".concat(TEA_ID),DEFAULT_INTERVAL=-1,MAX_TIME=432e5,MAX_COST=36e5,COMMON_KEYS=["vtype","tag","subtag","codec_type","device_type"],MIN_WAITIONG=200,MAX_STALL_TIME=6e4,AB_SDK_VERSION="",Collector$1=null,XGPlayerAppLogger=function(){function t(r,n){var i=this;if(_classCallCheck$4(this,t),_defineProperty$5(this,"initializeUrlLog",(function(e){var t=e||"";"String"!==typeOf(t)&&(t=""),i.urlLog={initial_url:t,initial_host:getHostFromUrl(t),initial_ip:""}})),_defineProperty$5(this,"onMediaFormatError",(function(e){i.onOneEvent({end_type:(e.error_type||"")+"Error"})})),_defineProperty$5(this,"onDrmTypeChange",(function(e){i.addIfExist("drm_type",{drm_type:e},i._options)})),_defineProperty$5(this,"onReplayBtnClick",(function(){i.resetLoggerParams()})),_defineProperty$5(this,"onBeforeDefinitionChange",(function(){i.resLogs.ldst=nowTime(),i._endType="switch"})),_defineProperty$5(this,"onDefinitionChange",(function(e){var t=e.from,r=e.to;i.changeResolution(t,r,i.resLogs.ldst,"switch"),log$1("onDefinitionChange from:".concat(t,", to:").concat(r))})),_defineProperty$5(this,"onDefiChangeSuccess",(function(){log$1("onDefinitionChangeSuccess"),i.updateVideoSize(),i.triggerTask("start")})),_defineProperty$5(this,"onAbrChange",(function(e){var t=e.prev,r=e.cur,n=e.abrInfo;if(i.player.abrInstance){var a=i.player.abrInstance.eventInfo;log$1("abrChange",a),a.last_definition=t,a.now_definition=r,i.abrInfo.abr_event_info.video_switch.push(a),i.changeResolution(t,r,nowTime(),"abr_switch",n)}})),_defineProperty$5(this,"onAbrPrestallEnd",(function(e){i.abrInfo.abr_user_info.cancel_abr=e?1:0})),_defineProperty$5(this,"onTimeUpdate",(function(){var e=i.playlogs,t=i.resLogs,r=i.player;if(i.errorLog.try_err_c=0,e.vt||1!==i.startStep||(e.vt=curTimestamp(),log$1("onTimeUpdate: first frame inited","currentTime11:".concat(r.currentTime," vt-pt:").concat(e.vt-e.pt," vt-nt:").concat(e.vt-e.nt," vt-rt:").concat(e.vt-e.rt)),i.startStep=2),!t.initial_resolution){var n=r.currentDefitionFromPlayer&&r.currentDefitionFromPlayer.definition?r.currentDefitionFromPlayer.definition:r.config.defaultDefinition||r.video.videoHeight+"p"||"";n=formatDefinition(n),t.initial_resolution=n}t.final_resolution||(t.final_resolution=t.initial_resolution);var a=e.played.length;a<1?e.played.push({begin:r.currentTime,end:-1}):e.played[a-1].end=r.currentTime;var o=t.played.length;o<1?t.played.push({begin:r.currentTime,end:-1}):t.played[o-1].end=r.currentTime,i.lastVideoTime=r.currentTime||0,i.updateCurBuffer()})),_defineProperty$5(this,"onCanplay",(function(){log$1("onCanplay","this.startStep:".concat(i.startStep," ").concat(curTimestamp())),i.setVt()})),_defineProperty$5(this,"onLoadeddata",(function(){log$1("onLoadeddata","this.startStep:".concat(i.startStep," ").concat(curTimestamp())),i.setVt(),i.updateVideoSize()})),_defineProperty$5(this,"onLoadStart",(function(){var e=checkVideoSrcIsEmpty(i.player.currentSrc);i.triggerTask("start"),log$1("onLoadStart","this.startStep:".concat(i.startStep," ").concat(curTimestamp()," isSrcEmpty:").concat(e," player.src:").concat(i.player.src)),0!==i.startStep||e||"visible"!==document.visibilityState||i.setPt()})),_defineProperty$5(this,"onDashStateChange",(function(e){log$1("onDashStateChange","this.startStep:".concat(i.startStep," ").concat(nowTime()," state:").concat(e));var t=i.playlogs;if(i.startStep<2)switch(e){case"player_start":t.dash_pst=nowTime();break;case"wasm_start":t.dash_wst=nowTime();break;case"wasm_ready":t.dash_wrt=nowTime();break;case"init_finished":t.dash_ift=nowTime();break;case"core_start":t.dash_cst=nowTime();break;case"start_play":t.dash_spt=nowTime()}})),_defineProperty$5(this,"onMp4StateChange",(function(e){var t=e.state;(i.exInfo.states.length>10||"player_start"===t)&&(i.exInfo.states=[]),i.exInfo.states.push(e)})),_defineProperty$5(this,"onBufferedChange",(function(){var e=i.player.video&&i.player.video.buffered;if(e){var t=e.length;t>0&&e.end(t-1)+1>i.player.duration&&(i.bft=curTimestamp())}})),_defineProperty$5(this,"onPlayerInited",(function(){log$1("player init"),i._playerCreatedTime=curTimestamp(),i.playlogs.rt=curTimestamp()})),_defineProperty$5(this,"onNotAutoPlay",(function(){log$1("onNotAutoPlay","autoplay:".concat(i.isAutoplay)),0===i.isAutoplay?i.isAutoplay=2:1===i.isAutoplay&&(i.isAutoplay=3)})),_defineProperty$5(this,"onDashError",(function(e){e=e||{};var t=i.errorLog;t.last_errors.push(e.errorCode),t.accu_errc++,i.onOneError({errorType:e.errorTypeCode,code:e.errorCode,url:e.url||"",headers:e.headers||{}},0)})),_defineProperty$5(this,"onPlayerError",(function(e){e=e||{};var t=i.errorLog,r=i.player,n=i.line_app_id;if(log$1("onPlayerError","this.player.type:".concat(i.player.type," this.player.replayRunning:").concat(i.player.replayRunning," isSupportMP4:").concat(Browser$1.isSupportMP4," isPC:").concat(Browser$1.isPC)),log$1("onPlayerError",e),i.load_state=LOAD_STATES.ERROR,i._endType="error",i.suspendWaitingStatus("onPlayerError"),"dash"!==r.type||!r.replayRunning){if(e.url||(e.url=i.player.currentSrc),(1768===n||9999===n)&&Browser$1.isPC&&!Browser$1.isSupportMP4||Browser$1.isSpider)return t.errc=ERROR_CODES$1[5],t.errt=ERROR_TYPES$2.notSupport,i.onOneError({errorType:t.errt,code:t.errc,url:e.url,headers:e.headers||{}},0),void(i._isOnePlayReport=!0);t.errt=e.errorTypeCode||(e.errorType&&ERROR_TYPES$2[e.errorType]?ERROR_TYPES$2[e.errorType]:9999),e.errorCode?t.errc=e.errorCode>0&&ERROR_CODES$1[e.errorCode]?ERROR_CODES$1[e.errorCode]:e.errorCode:e.code&&(t.errc=e.code>0&&ERROR_CODES$1[e.code]?ERROR_CODES$1[e.code]:e.code),t.last_errors.push(t.errc),0===t.fir_errc&&(t.fir_errc=t.errc),i.onOnePlay(ENDED_TYPE.ERROR),i.onOneTemp(ENDED_TYPE.ERROR),i.sendDegradeLog("playCatch_end",i.playlogs.degrade),i.onOneError({errorType:t.errt,code:t.errc,url:e.url,headers:e.headers||{}}),i.sendEventsQueue()}})),_defineProperty$5(this,"onPlayInterfaceInfo",(function(e){log$1("onPlayInterfaceInfo",e);var t=i.errorLog,r=i.apiLog,n=i.playlogs;if(e&&Object.keys(e).map((function(t){"code"===t?r.vsc=e[t]:"message"===t?r.vsc_message=e.message||"successï¼Œè§†é¢‘å¯æ­£å¸¸æ’­æ”¾":r[t]=e[t]})),n.at=e.timestamep||(new Date).getTime(),(!e.error||-9988!==e.error.errc)&&(r.vsc=e.code||10,r.vsc_message=e.message||"successï¼Œè§†é¢‘å¯æ­£å¸¸æ’­æ”¾",e.error)){var a=e.error;t.errt=1e3,t.errc=a.errc||-9998,t.last_errors.push(a.errc||-9998),0===t.fir_errc&&(t.fir_errc=a.errc||-9998),t.accu_errc++,1===t.accu_errc&&(t.fir_errt=nowTime()),i.onOneError({errorType:1e3,code:a.errc||-9998,url:"",headers:{}})}})),_defineProperty$5(this,"onProgressEvent",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=i.netLog;if(e.speed){var r=e.speed>1e6?Math.floor(e.speed/1e3):e.speed;t.downloadSpeed=r,t.totalSpeed+=r,t.rqCount++}"oversize"!==e.type&&t.requestCount++,e.connectTime&&(t.connectCost=e.connectTime);var n=t.rqCount<7?100:e.costTime>=5e3?20:10;if(!("success"===e.type&&parseInt(100*Math.random(),10)<=n)){var a=findPerformanceInfo(e.cdnUrl),o=e.xhr||{},s=e.type?"progress_".concat(e.type):"progress",u=e.headers;u||(u=getResponseHeaders(o));var c=_objectSpread$a(_objectSpread$a({},u=transformHeader(u)),{},{download_speed:t.downloadSpeed,connect_cost:t.connectCost,c_dur:a.connectDuration||0,d_dur:a.domainDuration||0,r_dur:a.duration||0,rqtt:(new Date).getTime(),x_cache:u.x_response_cache||"",server_ip:u.x_response_sinfo});e.status?t.status=e.status:o&&o instanceof window.XMLHttpRequest&&(t.status=o.status||0),c.status=t.status;var l=e.cdnUrl||e.url;"error"===e.type&&i.merror.cdn.push(_objectSpread$a(_objectSpread$a({costTime:e.costTime,cur_play_pos:e.pos,cdn_url:l,cdn_host:getHostFromUrl(l)},c),u)),i.onOneEvent({costTime:e.costTime,vid:e.vid,end_type:s,cur_play_pos:e.pos,cdn_url:l,cdn_host:getHostFromUrl(l)},c,"error"===e.type?0:2)}})),_defineProperty$5(this,"onNext",(function(e){if(log$1("onNext:startStep:",i.startStep),i.startStep>0){if(i._reportInvalidVV(ENDED_TYPE.NEXT))return;i.onOnePlay(ENDED_TYPE.NEXT),i.onOneTemp(ENDED_TYPE.NEXT),i.sendEventsQueue()}i.vtype=null,i.playlogs.lc=0,i.resetLoggerParams()})),_defineProperty$5(this,"onNextEnded",(function(){var e=i.player,t=i.resLogs,r=formatDefinition(e.config.defaultDefinition||"");t.initial_resolution=r,t.final_resolution=r})),_defineProperty$5(this,"onXgLogWaiting",(function(e){var t=i.playlogs,r=i.resLogs,n=i.stall;if(i._options.checkByInnerLog&&0===e.type){log$1("onXgLogWaiting",e);var a=e.endType,o=e.costTime,s=e.start,u={download_speed:i.mp4Speed,avg_speed:i.mp4RealSpeed,mse_op:i.mp4MseOpLength,mp4_load_range:i.mp4LoadSegmentTimeRange,bitrate:i.curBitrate};if("waitingStart"===e.eventType)return i.onOneEvent({costTime:o,end_type:"waitstart"},u,2),void i.appendStallInfo("start",s);if("waitingEnd"===e.eventType){var c=nowTime();log$1("onXgLogWaiting>>".concat(a,"|costTime:").concat(o,"  vt:").concat(t.vt)),i.appendStallInfo("end",c,a),t.bc++,i.checkInBuffer(i.player.currentTime)?(t.de_bu_acu_t+=o,t.dbc++):(t.nbc++,t.n_bu_acu_t+=o),r.bc++,t.bu_acu_t+=o,r.bu_acu_t+=o,n.stall_end=c,n.stall_last_interval=n.stall_end-n.stall_start,n.stall_acc_time+=n.stall_last_interval,1===n.sc&&(n.first_buf_endt=c),i.onOneEvent({costTime:o,end_type:"waitend"},u,2)}}})),_defineProperty$5(this,"onSeeking",(function(){if(!checkVideoSrcIsEmpty(i.player.src)){var e=i.resLogs,t=i.playlogs,r=i.player,n=i.seekLog;log$1("onSeeking","currentTime:".concat(r.currentTime)),0===i.startStep&&i.setPt(),i.suspendWaitingStatus("seek"),i.isSeeking&&i.suspendSeekStatus("seek",!1),i.isSeeking=!0,t.played.push({begin:i.player.currentTime,end:-1}),e.played.push({begin:i.player.currentTime,end:-1}),n.lastSeekStartTime=nowTime(),n.seekBefore=i.lastVideoTime.toString(),n.intervalId=setTimeout((function(){i.isSeeking&&i.suspendSeekStatus("seekTimeout",!0)}),MAX_STALL_TIME)}})),_defineProperty$5(this,"onSeeked",(function(){checkVideoSrcIsEmpty(i.player.src)||i.isSeeking&&i.suspendSeekStatus("seeked",!0)})),_defineProperty$5(this,"onPlaying",(function(){i.suspendWaitingStatus("play"),i.load_state=LOAD_STATES.PLAYABLE;var e=nowTime();i.pauseLog.isPausing&&(i.pauseLog.isPausing=!1,i.pauseLog.pause_acu_t+=e-i.pauseLog.pause_start)})),_defineProperty$5(this,"onPlayCatch",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{errorType:"",errorTypeCode:0,errorCode:0,url:"",headers:{},status:0};if(log$1("onPlayCatch",e,t),e){var r=i.errorLog,n=i.playlogs,a=i.merror;a.playCatch.push(_objectSpread$a({errc:t.errorCode,errt:t.errorType},t.headers)),i.setBr("playcatch"),r.accu_errc++,r.try_err_c++,r.fir_errc=t.errorCode,t.errorCode&&r.last_errors.push(t.errorCode),i.suspendWaitingStatus("playcatch"),i.sendDegradeLog("playCatch",n.degrade,{cdn_url:t.url}),"mp42dash"===e?i.vtype="DASH_2":"dash2mp4"===e?i.vtype="MP4_2":"dash1mp4"===e&&(i.vtype="MP4_1"),n.degrade=e,i.onOneError({errorType:t.errorTypeCode,code:t.errorCode,url:t.url||"",status:t.httpCode||t.status,headers:t.headers||{},vid:t.vid||i.vid,preload_hit:t.preloadHit||0,preload_cached:t.preloadCached||0,endState:ENDED_TYPE.PLAY_CATCH,costTime:t.costTime,message:t.errorMessage},0)}})),_defineProperty$5(this,"onMediaExpied",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{errorType:"",errorTypeCode:0,errorCode:0,url:"",headers:{},status:0},t=i.errorLog,r=i.playlogs;log$1("onMediaExpied",e),i.suspendWaitingStatus("expied"),i.setBr("expied"),t.accu_errc++,t.try_err_c++,t.last_errors.push(e.errorCode),r.at=(new Date).getTime(),i.merror.expied.push(_objectSpread$a({errorType:e.errorTypeCode||e.errorType,code:e.errorCode,url:e.url||"",status:e.status},transformHeader(e.headers||{}))),i.onOneError({errorType:e.errorTypeCode||e.errorType,code:e.errorCode,url:e.url||"",status:e.status,headers:e.headers||{}},0)})),_defineProperty$5(this,"onLog",(function(e){log$1("onLog",e);var t=e.type;if(delete e.type,t)switch(t){case LOGTYPES.RETRY:break;case LOGTYPES.ONETEMP:i._templog||(i._templog={}),i._templog=parseTempData(i._templog,e.data,e.action),i._templog.preload_hit&&(i._cacheFile=CACHE_FILE_TYPE.CACHED);break;case LOGTYPES.ONEERROR:var r=i.errorLog;r.accu_errc++,r.try_err_c++,i.setBr("mp4error"),r.last_errors.push(e.code),i.onOneError(e,0);break;case LOGTYPES.ONEEVENT:var n=formatData(e,{costTime:"costTime",vid:"vid",end_type:"end_type",pos:"cur_play_pos",cdnUrl:"cdn_url"});n.ext&&["start","end"].map((function(e){n.ext[e]&&(n.ext["ext_".concat(e)]=n.ext[e],delete n.ext[e])})),i.onOneEvent(n.data,n.ext,2)}})),_defineProperty$5(this,"onPlay",(function(){log$1("onPlay","this.startStep :".concat(i.startStep," this.isEnded:").concat(i.isEnded)),i.isEnded&&(i.resetLoggerParams(),i.setPt())})),_defineProperty$5(this,"onPause",(function(){log$1("onPause");var e=i.pauseLog;e.isPausing=!0,e.pause_start=nowTime()})),_defineProperty$5(this,"onWaiting",(function(){var e=i.stall;i._options.checkByInnerLog||(log$1("onWaiting>","isSeeking:".concat(i.isSeeking," startStep:").concat(i.startStep," intervalId:").concat(e.intervalId)),i.isSeeking||0===i.playlogs.vt||i.inWaitingStart>0||(e.intervalId&&(window.clearTimeout(e.intervalId),e.intervalId=null),i.inWaitingStart=nowTime(),e.intervalId=window.setTimeout((function(){var e=i.stall;log$1("stall.intervalId>>".concat(e.intervalId," cost: ").concat(nowTime()-i.inWaitingStart)),i._endType="wait",i.load_state=LOAD_STATES.STALLED,i.vtype.indexOf("MP4")>-1&&i.player.currentTime>10&&i.task&&(i.triggerTask("waiting",i.initial_url),i.requestCount++),e.stall_start=i.inWaitingStart,1===e.sc&&(e.first_buf_startt=i.inWaitingStart),window.clearTimeout(e.intervalId),e.intervalId=null,i.startWaitingStatus(i.inWaitingStart,nowTime()-i.inWaitingStart),e.intervalId=setTimeout((function(){i.inWaitingStart>0&&i.suspendWaitingStatus("waitTimeout")}),MAX_STALL_TIME)}),MIN_WAITIONG)))})),_defineProperty$5(this,"onEnded",(function(){if(i.initial_url){log$1("onEnded","watchDur:".concat(i.watchDur," vt:").concat(i.vt," pt:").concat(i.pt)),i.isEnded=!0;var e=i.resLogs.df;i.changeResolution(e,e,nowTime(),"leave_switch"),i.onOnePlay(ENDED_TYPE.ENDED),i.sendDegradeLog("playCatch_end",i.playlogs.degrade),i.onOneTemp(ENDED_TYPE.ENDED),i.sendEventsQueue(),i.playlogs.lc++}})),_defineProperty$5(this,"onUnload",(function(){0!==i.startStep&&i.initial_url&&(i.onOneTemp(ENDED_TYPE.UNLOAD),i.sendDegradeLog("playCatch_end",i.playlogs.degrade),i._reportInvalidVV(ENDED_TYPE.UNLOAD)||(i._options.disableLocalCache?i.onOnePlay(ENDED_TYPE.UNLOAD,!1):i.onOnePlay(ENDED_TYPE.UNLOAD,!0)))})),_defineProperty$5(this,"onVisibilitychange",(function(){var e=i.playlogs.vt;"visible"===document.visibilityState&&(e||i.setPt())})),_defineProperty$5(this,"onDestroy",(function(){log$1("onDestroy:this.startStep:".concat(i.startStep," initial_url:").concat(i.initial_url," ").concat(!!i.initial_url)),console.log(">>>onDestroy",i.startStep>0&&!!i.initial_url),i.onOnePlay(ENDED_TYPE.DESTROY),i.startStep>0&&i.initial_url&&(i.onOneTemp(ENDED_TYPE.DESTROY),i.sendDegradeLog("playCatch_end",i.playlogs.degrade));var e=i.resLogs.df;i.changeResolution(e,e,nowTime(),"leave_switch"),i.sendEventsQueue(),Browser$1.isPC?window.removeEventListener("beforeunload",i.onUnload):(Browser$1.isMobile||Browser$1.isPad)&&window.removeEventListener("pagehide",i.onUnload),document.removeEventListener("visibilitychange",i.onVisibilitychange),i.listeners.forEach((function(e){i.player.off(e.evt,e.handler)})),i.clearTimers(),i.player.off("destroy",i.onDestroy),i.task&&i.task.clear()})),_defineProperty$5(this,"onOnePlay",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(log$1("onOnePlay _isOnePlayReport:".concat(i._isOnePlayReport," isLeave: ").concat(t," endState:").concat(e)),!i._isOnePlayReport){var r=i.errorLog,n=i.playlogs,a=i.abrInfo,o=i.resLogs,s=i.player,u=i.apiLog,c=i.pauseLog,l=i.stall,d=i.netLog,h=i.watchDur;i._isOnePlayReport=!0;var f=curTimestamp(),p=0,g=0,y=s.video&&s.video.buffered;if(y){for(var m=y.length,v=0,_=0;_<m;_++)v+=y.end(_)-y.start(_);p=g=1e3*v}var b=i.mp4FFInfo;Object.keys(b).map((function(e){i.exInfo[e]=b[e]})),i.setPerformance(),i.setStat();var A=_objectSpread$a(_objectSpread$a(_objectSpread$a({local_time:(new Date).getTime(),log_type:"video_playq",plugin_exception:0,player_create_exception:"",v:i.vid,initial_url:i.initial_url,initial_host:i.initial_host,initial_ip:i.curHeaders.x_response_sinfo||0,initial_type:i.initial_type},i.curHeaders),{},{initial_resolution:o.initial_resolution,final_resolution:o.final_resolution,pt:i.pt,prepare_start_time:n.nt,prepare_end_time:n.rt||curTimestamp(),vt:i.vt,lt:i.lt,lpt:i.lpt,fvt:i.fvt,nvt:i.nvt,bft:i.bft,sc:i.seekLog.sc,sat:i.seekLog.sat,bc:i.bc,dbc:n.dbc||0,nbc:n.nbc||0,video_net_s:i.videoNetworkState,status:i.curStatus,first_buf_startt:l.first_buf_startt,first_buf_endt:l.first_buf_endt,lc:n.lc,bu_acu_t:i.bu_acu_t>MAX_TIME?0:i.bu_acu_t,de_bu_acu_t:n.de_bu_acu_t||0,n_bu_acu_t:n.n_bu_acu_t||0,pause_acu_t:c.pause_acu_t,cur_play_pos:i.cur_play_pos,load_state:i.load_state,play_speed:i.playbackRate,playback_state:i.playback_state,end_state:e,watch_dur:h>MAX_TIME?0:h,switch_resolution_c:i.switchResolutionCount,is_start_play_automatically:i.isAutoplay,start_time:i.start_time,finish:i.finish,errt:r.errt,errc:r.errc,vsc:u.vsc,vsc_message:u.vsc_message,api_str:u.api_str,auth:u.auth||u.logid,width:i.videoWidth,height:i.videoHeight,vd:i.vd,video_length:parseInt(p,10),audio_length:parseInt(g,10),df:i.resolution,lf:o.lf,play_c:0,player_created_t:i.player_created_t,fir_errt:r.fir_errt,fir_errc:r.fir_errc,lv_method:0,ldst:o.ldst,ldet:o.ldet,is_disable_short_seek:0,mute:i.mute,volume:i.volume,download_speed:i.mp4RealSpeed?i.mp4RealSpeed:i.task&&i.task.speed?i.task.speed:d.downloadSpeed,avg_speed:i.mp4Speed?i.mp4Speed:d.rqCount>0?parseInt(d.totalSpeed/d.rqCount,10):0,bitrate:i.curBitrate,preload_state:i.preloadState,preload_hit:i.preLoadData.hit,preload_cached:i.preLoadData.duration||i.preLoadData.byteLength,mdl_req_num:d.requestCount,watingcost:i.watingCost,br:n.br,fbrt:n.fbrt,try_err_c:r.try_err_c,accu_errc:r.accu_errc,dash_pst:i.dash_pst,dash_wst:i.dash_wst,dash_wrt:i.dash_wrt,dash_ift:i.dash_ift,dash_cst:i.dash_cst,dash_spt:i.dash_spt,dash_break:2===s.dashBufferBreak?1:0,merror:toJsonString(i.merror),ex:toJsonString(i.exInfo),bufs:toJsonString(i.buffers.allBuffer),vs:o.vs,vds:o.vds,vps:o.vps},i.buffers.curBuffer),{},{degrade:n.degrade,cache_file:i._cacheFile});if(0!==i.vt&&(A.et=f),s&&s.config&&s.config.codecType&&(A.codec_type=s.config.codecType),s&&s.dashState&&(A.dash_state=s.dashState),["drm_type","dynamic_type","enable_bash"].forEach((function(e){i.addIfExist(e,i._options,A)})),s.abrInstance){var E=s.abrInstance;if(a.abr_general_info=E.generalInfo,a.abr_event_info.video_exit={local_time_ms:(new Date).getTime(),buffer_length:E.bufferLength,internet_speed:E.downloadSpeed,now_bitrate:E.nowBitrate,play_speed:i.player.playbackRate},E.getAbrPlayInfo&&(a.abr_play_info=E.getAbrPlayInfo()),E.getAbrVVStats){var S=E.getAbrVVStats();Object.keys(S).forEach((function(e){A[e]=S[e]}))}}a.abr_init_opts=i.player.config.autoBitrateOpts||{},A.abr_info=toJsonString(i.abrInfo),t?i.reportLog(REPORT_EVENTS.ONE_PLAY,A,t):i.reportLog(REPORT_EVENTS.ONE_PLAY,A)}})),_defineProperty$5(this,"onOneEvent",(function(e){var t=e.costTime,r=e.vid,n=e.end_type,a=e.cur_play_pos,o=e.cdn_url,s=e.cdn_host,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2?arguments[2]:void 0,l=i.buffers.curBuffer,d=_objectSpread$a({local_time:(new Date).getTime(),v:r||i.vid,cost_time:t,end_type:n||i.end_type,cdn_url:o||i.url,cdn_host:s||"",initial_type:i.initial_type,resolution:i.resolution,play_speed:i.playbackRate,first_frame_interval:nowTime()-i.pt,last_switch_interval:i.getLastInterval("lastSwitchStartTime",i.resLogs,!1),last_seek_interval:i.updateSeekPt(!1),last_event_interval:i.getLastInterval("lastEventTime"),cur_play_pos:a||i.cur_play_pos,video_ready_s:i.videoReadyState,video_seeking:i.videoSeeking,video_paused:i.videoPaused,bufs:toJsonString(i.buffers.allBuffer),retry_count:i.retry_count,at:i.playlogs.at,stay_seconds:parseInt(((new Date).getTime()-i.playlogs.at)/1e3,10),preload_state:i.preloadState,preload_hit:i.preLoadData.hit,preload_cached:i.preLoadData.duration||i.preLoadData.byteLength},l);if("waitstart"===n&&"function"==typeof i._options.getPageFPS){var h=i._options.getPageFPS();d.cur_fps=h.curFPS||0,d.avg_fps=h.avgFPS||0}var f=i.player;f&&f.dashState&&(d.dash_state=i.player.dashState),f&&f.config&&f.config.codecType&&(d.codec_type=f.config.codecType),Object.keys(u).forEach((function(e){d[e]=u[e]})),i.addIfExist("drm_type",i._options,d),i.reportLog(REPORT_EVENTS.ONE_EVENT,d,c)})),_defineProperty$5(this,"onOneTemp",(function(){if(log$1("onOneTemp>>",!i._templog),i._templog){var e=i.player,t=i.playlogs,r=i.pauseLog,n=i.errorLog,a=i.resLogs,o=i.watchDur,s=_objectSpread$a(_objectSpread$a(_objectSpread$a({local_time:(new Date).getTime()},i._templog),{},{v:i.vid,initial_type:i.initial_type,pt:i.pt,vt:i.vt,lt:i.lt,fvt:i.fvt,bc:i.bc,bu_acu_t:i.bu_acu_t>MAX_TIME?0:i.bu_acu_t,pause_acu_t:r.pause_acu_t,cur_play_pos:i.cur_play_pos,watch_dur:o>MAX_TIME?0:o,finish:i.finish,errt:n.errt,errc:n.errc,vd:i.vd,df:i.resolution,lf:a.lf,br:t.br,fbrt:t.fbrt,try_err_c:n.try_err_c,accu_errc:n.accu_errc,dash_break:2===e.dashBufferBreak?1:0,bufs:toJsonString(i.buffers.allBuffer),vs:a.vs,vds:a.vds,vps:a.vps},i.buffers.curBuffer),{},{degrade:t.degrade});0!==i.vt&&(s.et=curTimestamp()),["drm_type","dynamic_type","enable_bash"].forEach((function(e){i.addIfExist(e,i._options,s)})),e&&e.config&&e.config.codecType&&(s.codec_type=e.config.codecType),i.reportLog(REPORT_EVENTS.ONE_TEMP,s,0),i._templog=null}})),this.player=r,void 0===this.player||null===this.player)throw new Error("player is ".concat(this.player));if(n&&n.line_app_id){(n.isTask||void 0===n.isTask)&&(this.task=new SpeedCheckTask),this.eventQueue=[],this._instanceCreateTime=(new Date).getTime(),n.codec_type=n.codec_type||"h264",this._options=n,!this._options.maxQueueCount&&(this._options.maxQueueCount=5),this.line_app_id=parseInt(n.line_app_id,10)||0,this.line_user_id=(n.line_user_id||"").toString(),this.version=version$2,this.sdk_version=version$2,this.playerCoreVersion=n.playerCoreVersion||"",this.playerVersion=n.playerVersion||n.sdk_version,this.closeSeekLog=n.closeSeekLog||!1,this.start_time=1e3*(n.start_time||0),this.isFullAB=n.isFullAB||!1,this._initial_resolution="",this.__vtype=null,this.__dt="",this.isLowMp4=!1,this.resetLoggerParams();try{this.initializeTracker(),this.sendLocalLog(),this.bindEvt(),log$1("logger constructor:"+this.player.video)}catch(e){console.log(e)}}else console.warn("player.config.vodLogOpts.line_app_id is necessary for plugin xgVodLogger")}return _createClass$5(t,[{key:"resetLoggerParams",value:function(){log$1("resetLoggerParams");var e=this.playlogs?this.playlogs.lc:0;this.playlogs={nt:curTimestamp(),vt:0,rt:this.isEnded?curTimestamp():0,at:0,pt:0,bu_acu_t:0,bc:0,br:0,fbrt:"",dbc:0,de_bu_acu_t:0,nbc:0,n_bu_acu_t:0,played:[{begin:0,end:-1}],dash_pst:0,dash_wst:0,dash_wrt:0,dash_ift:0,dash_cst:0,dash_spt:0,interruptCount:0,degrade:"none",lc:e},this.degradeLog={bu_acu_t:0,bc:0,watch_dur:0,hasSendEnd:!1},this.buffers={allBuffer:[],curBuffer:{buf_diff:0,buf_s_pos:0,buf_e_pos:0,buf_include:0}},this.netLog={downloadSpeed:0,requestCount:0,connectCost:0,totalSpeed:0,rqCount:0,status:0},this.merror={cdn:[],player:[],playCatch:[],expied:[]},this.exInfo={buffer:{},stall:[],states:[]},this._templog=null,this._isOnePlayReport=!1,this.startStep=0,this.bft=0,this.initializeLogDatas(),this.initializeUrlLog()}},{key:"initializeLogDatas",value:function(){this.startStep=0,this.inWaitingStart=0,this.lastVideoTime=0,this._endType="",this._retryCount=0,this.lastOperaTime=DEFAULT_INTERVAL,this.lastEventTime=DEFAULT_INTERVAL,this.seekLog={intervalId:0,lastSeekStartTime:nowTime(),seekBefore:0,sat:0,sc:0},this.resLogs={lastSwitchStartTime:DEFAULT_INTERVAL,switch_count:0,abr_switch_count:0,initial_resolution:"",final_resolution:"",ldst:0,ldet:0,df:"",lf:"",played:[],bc:0,bu_acu_t:0,sc:0,sat:0,buf:0,lbuf:0,lplayed:0,vs:0,vds:0,vps:0,vis:0,bitrate:0},this.apiLog={code:0,message:"",logid:"",api:"",auth:"",error:{}},this.errorLog={accu_errc:0,try_err_c:0,errt:0,errc:0,fir_errt:0,fir_errc:Browser$1.isSupportMP4?0:1005,last_errors:[]},this.pauseLog={pause_acu_t:0,isPausing:!1,pause_start:0},this.stall={intervalId:0,stall_count:0,first_buf_startt:0,first_buf_endt:0,stall_start:0,stall_end:0,stall_last_interval:0,stall_acc_time:0},this._playerCreatedTime=0,this.load_state=LOAD_STATES.UNKNOWN,this.lv_method=6,this.isSeeking=!1,this.isEnded=!1,this.startStep=0,this.isAutoplay=this.player.config&&this.player.config.autoplay?1:0,this.abrInfo={abr_general_info:{},abr_event_info:{video_switch:[],video_stall:[],video_exit:{}},abr_play_info:{start_play_time_ms:0,is_hint:0,playback_info:{internet_speed_record:[],play_bitrate_record:[],buffer_length_record:[],play_speed_record:[]}},abr_user_info:{cancel_abr:0},abr_init_opts:this.player.config.autoBitrateOpts||{}},this._cacheFile=CACHE_FILE_TYPE.NO_CACHE}},{key:"initSessionId",value:function(){var e="0";try{e=window.localStorage.getItem(LS_KEY).web_id||"0"}catch(error){e="0"}this._sessionId=generateSessionId(e),log$1("sessionId ".concat(this._sessionId))}},{key:"initializeTracker",value:function(){var e=this._options;if(window.__xgplayer_vod_log__)this.tracker=window.__xgplayer_vod_log__;else{this.tracker=window.__xgplayer_vod_log__=new Collector$1("tracker");var t=e.channel||"cn",r={app_id:"cn"===(t="va"===t||"sg"===t?t:"cn")?TEA_ID:1300===TEA_ID?323254:TEA_ID,channel:t,log:!1,disable_sdk_monitor:!0};e.channelDomain&&(r.channel_domain=e.channelDomain),r.enable_ab_test=!!e.enableAbTest,this.tracker.init(r)}this.initSessionId();var n=navigator?navigator.hardwareConcurrency:0,i=navigator?navigator.deviceMemory:0;this.commonParams={play_type:0,source_type:"vid",sdk_version:this.sdk_version,pc:this.playerCoreVersion,pv:this.playerVersion,line_app_id:this.line_app_id,line_user_id:this.line_user_id,app_version:e.appVersion||"",platform:Browser$1.isPad?"pad":Browser$1.isMobile?"mobile":"pc",cpu_core:Number(n)||0,memory_size:Number(i)||0},log$1("commonParams ",this.commonParams);var a={evtParams:this.commonParams,disable_auto_pv:!0};log$1("Browser.name ",Browser$1.name),!Browser$1.name||Browser$1.isChrome||Browser$1.isSafari||(a.browser=Browser$1.name,Browser$1.appVersion&&(a.browser_version=Browser$1.appVersion)),this.line_user_id&&(a.user_unique_id=this.line_user_id,a.web_id=this.line_user_id),e.referrer&&(a.referrer=e.referrer,a.referrer_host=getHostFromUrl(e.referrer)),this.tracker.config(a),this.tracker.start()}},{key:"resetDefiInfo",value:function(){var e=this.resLogs;e.played=[],e.bc=0,e.bu_acu_t=0,e.sc=0,e.sat=0}},{key:"sendLocalLog",value:function(){var e=this,t=LOCAL_LOG.get();LOCAL_LOG.remove(),t.map((function(t){Object.keys(t).map((function(r){if(log$1("sendLocalLog",r,t[r]),e.player){e.player.emit("abLog",r,t[r]);var n=e._options.sendLocalCallback;n&&"function"==typeof n&&n(r,t[r])}e._track(r,t[r])}))}))}},{key:"_track",value:function(e,t){"function"==typeof this.tracker?this.tracker(e,t):this.tracker.event(e,t)}},{key:"bindEvt",value:function(){var e=this;this.listeners=[{evt:"play",handler:this.onPlay},{evt:"playing",handler:this.onPlaying},{evt:"pause",handler:this.onPause},{evt:"waiting",handler:this.onWaiting},{evt:"playInterfaceInfo",handler:this.onPlayInterfaceInfo},{evt:"DRM_ERROR",handler:this.onDashError},{evt:"ended",handler:this.onEnded},{evt:"loadeddata",handler:this.onLoadeddata},{evt:"loadstart",handler:this.onLoadStart},{evt:"canplay",handler:this.onCanplay},{evt:"dashStateChange",handler:this.onDashStateChange},{evt:"mp4StateChange",handler:this.onMp4StateChange},{evt:"autoplay was prevented",handler:this.onNotAutoPlay},{evt:"autoplay_was_prevented",handler:this.onNotAutoPlay},{evt:"seeking",handler:this.onSeeking},{evt:"seeked",handler:this.onSeeked},{evt:"complete",handler:this.onPlayerInited},{evt:"timeupdate",handler:this.onTimeUpdate},{evt:"bufferedChange",handler:this.onBufferedChange},{evt:"beforeDefinitionChange",handler:this.onBeforeDefinitionChange},{evt:"definitionChange",handler:this.onDefinitionChange},{evt:"definitionChangeSuccess",handler:this.onDefiChangeSuccess},{evt:"drmTypeChange",handler:this.onDrmTypeChange},{evt:"replayBtnClick",handler:this.onReplayBtnClick},{evt:"initialUrl",handler:this.initializeUrlLog},{evt:"ABR_CHANGE",handler:this.onAbrChange},{evt:"playCatch",handler:this.onPlayCatch},{evt:"MEDIA_EXPIRED",handler:this.onMediaExpied},{evt:"log",handler:this.onLog},{evt:"ABR_PRESTALL_END",handler:this.onAbrPrestallEnd},{evt:"progress_event",handler:this.onProgressEvent},{evt:"logger_next",handler:this.onNext},{evt:"playnext",handler:this.onNext},{evt:"nextEnded",handler:this.onNextEnded},{evt:"media_format_error",handler:this.onMediaFormatError},{evt:"xglog",handler:this.onXgLogWaiting}];var t=this.player.config.errorKey;log$1(">>>errorKey",t);var r={evt:"error",handler:this.onPlayerError};t&&(r.evt=t),this.listeners.push(r),this.listeners.forEach((function(t){e.player.on(t.evt,t.handler)})),this.bindUnload()}},{key:"addIfExist",value:function(e,t,r){if(isObject$3(t)){var n=t[e];!(null==n)&&(r[e]=n)}}},{key:"changeResolution",value:function(e,t,r,n,i){var a=this.resLogs;e=formatDefinition(e),t=formatDefinition(t),a.ldet=nowTime(),a.df=t,a.lf=e,a.final_resolution=t,a.switch_count++;var o=a.ldet-r,s={bc:a.bc,bu_acu_t:a.bu_acu_t,sc:a.sc,sat:a.sat,watch_dur:computeWatchDur(a.played)};i&&(s.abrInfo=i),this.updateVds(),this.resetDefiInfo(),this._options.closeResolutionLog||this.onOneOperator({costTime:o,operaType:n,stateBefore:e,stateAfter:t},s,0)}},{key:"getLastInterval",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=t[e],i=nowTime(),a=n===DEFAULT_INTERVAL?DEFAULT_INTERVAL:i-n;return r&&(t[e]=i),a}},{key:"updateSeekPt",value:function(e){return this.getLastInterval("lastSeekStartTime",this.seekLog,e)}},{key:"_reportInvalidVV",value:function(e){return!!this._isInvaidVV()&&(this.onOneError({endState:e,errorType:9998,code:-1,url:this.player.currentSrc,headers:{}},0),this._isOnePlayReport=!0,!0)}},{key:"_isInvaidVV",value:function(){return 0===this.vt&&-1===this.curStatus}},{key:"bindUnload",value:function(){Browser$1.isPC?window.addEventListener("beforeunload",this.onUnload):(Browser$1.isMobile||Browser$1.isPad)&&window.addEventListener("pagehide",this.onUnload),document.addEventListener("visibilitychange",this.onVisibilitychange),this.player.once("destroy",this.onDestroy)}},{key:"clearTimers",value:function(){var e=this.seekLog,t=this.stall;e.intervalId&&window.clearTimeout(e.intervalId),t.intervalId&&window.clearTimeout(t.intervalId)}},{key:"sendDegradeLog",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"playCatch",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};log$1("sendDegradeLog",e,t,r);var n=this.degradeLog;if(!(n.hasSendEnd||"playCatch_end"===e&&"none"===t)){"playCatch_end"===e&&(n.hasSendEnd=!0);var i=this.bu_acu_t-n.bu_acu_t;this.onOneEvent({costTime:this.vd,vid:this.vid,end_type:e,cur_play_pos:this.player.currentTime,cdn_url:r.url},_objectSpread$a({degrade:t,vt:this.vt,pt:this.pt,fvt:this.fvt,bc:this.bc-n.bc,bu_acu_t:i>MAX_TIME?0:i,watch_dur:this.watchDur-n.watch_dur},r),0)}}},{key:"setPerformance",value:function(){var e=this,t=this.player.performance||{};Object.keys(t).map((function(r){e.exInfo[r]=t[r]}))}},{key:"setStat",value:function(){var e=this,t=this.player.stat||{};t.performance&&delete t.performance,Object.keys(t).map((function(r){e.exInfo[r]=t[r]}))}},{key:"onOneOperator",value:function(e){var t=e.costTime,r=e.operaType,n=e.stateBefore,i=e.stateAfter,a=e.endType,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,u=this.getLastInterval("lastOperaTime"),c={local_time:(new Date).getTime(),v:this.vid,opera_type:r,state_before:n,state_after:i,cost_time:t,end_type:a||this.end_type,cdn_url:this.url,resolution:this.resolution,last_interval:u,bufs:toJsonString(this.buffers.allBuffer),cur_play_pos:this.cur_play_pos,retry_count:this.retry_count},l=this.player;l&&l.dashState&&(c.dash_state=this.player.dashState),Object.keys(o).forEach((function(e){c[e]=o[e]})),l&&l.config&&l.config.codecType&&(c.codec_type=l.config.codecType),this.addIfExist("drm_type",this._options,c),this.reportLog(REPORT_EVENTS.ONE_OPERA,c,s)}},{key:"onOneError",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{errorType:0,code:0,url:"",headers:{},costTime:0,vid:"",message:"",preload_hit:0,preload_cached:0},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;log$1("onOneError",e);var r=this.errorLog,n=this.apiLog,i=this.resLogs,a=this.player,o=this.playlogs,s=transformHeader(e.headers||{});this.setPerformance(),this.setStat();var u=_objectSpread$a(_objectSpread$a(_objectSpread$a({v:e.vid||this.vid,video_pos:this.cur_play_pos,local_time:(new Date).getTime(),cost_time:e&&e.costTime?e.costTime:0,errt:e.errorType,errc:e.code,es:this.es,cdn_url:e.url||this.url,bufs:toJsonString(this.buffers.allBuffer),resolution:i.final_resolution,last_errors:r.last_errors.join(";"),vsc:n.vsc,vsc_message:e.message||n.vsc_message,server_ip:s.x_response_sinfo||0,initial_url:this.initial_url,initial_host:this.initial_host},s),{},{cur_play_pos:this.cur_play_pos},this.buffers.curBuffer),{},{degrade:o.degrade,end_state:e.endState||ENDED_TYPE.ERROR,preload_hit:e.preload_hit,preload_cached:e.preload_cached,ex:toJsonString(this.exInfo),video_ready_s:this.videoReadyState});a&&a.dashState&&(u.dash_state=a.dashState),a&&a.config&&a.config.codecType&&(u.codec_type=a.config.codecType),this.addIfExist("drm_type",this._options,u),this.reportLog(REPORT_EVENTS.ONE_ERROR,u,t)}},{key:"reportLog",value:function(e,r,n){var i=this,a=this._options,o=this.player.ABTestTag;!r.player_sessionid&&(r.player_sessionid=this.sessionId),!r.web_url&&(r.web_url=window.location.href),r.user_agent=navigator.userAgent,r.dynamic_type=this.dynamicType;var s="Array"===typeOf(a.absdkVersion)?a.absdkVersion.join(","):a.absdkVersion;r.absdkVersion=s||t.AB_SDK_VERSION,null!=o&&(r.abtest_tag=o);var u=this._options;if(r.codec_type&&(u.codec_type=r.codec_type),isObject$3(u)&&(COMMON_KEYS.forEach((function(e){i.addIfExist(e,u,r)})),r.vtype=this.vtype),1===n){var c={};return c[e]=r,void LOCAL_LOG.set(c)}2!==n?(this.player&&this.player.emit("abLog",e,r),this._track(e,r)):this.addEventsQueue(e,r)}},{key:"addEventsQueue",value:function(e,t){this.eventQueue.push({event:e,params:t}),this.eventQueue.length>=this._options.maxQueueCount&&this.sendEventsQueue()}},{key:"sendEventsQueue",value:function(){for(;this.eventQueue.length>0;){var e=this.eventQueue.pop();this._track(e.event,e.params)}}},{key:"startWaitingStatus",value:function(e,t){this.onOneEvent({costTime:t,end_type:"waitstart"},{},2),this.appendStallInfo("start",e)}},{key:"triggerTask",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"start",t=arguments.length>1?arguments[1]:void 0;log$1("triggerTask>>",e);var r=checkVideoSrcIsEmpty(t=t||this.player.src);!r&&this.vtype.indexOf("MP4")>-1&&this.task&&this.task.trigger(t,e)}},{key:"appendStallInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"start",t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,n=this.exInfo.stall;if("start"===e){n.length>6&&n.splice(0,n.length-6);var i=this.buffers.curBuffer;n.push({start:t,end:-1,endType:"waitstart",cost:0,cur:this.cur_play_pos,buf_s:i.buf_s_pos,buf_e:i.buf_e_pos,buf_i:i.buf_include})}else if("end"===e){var a=n.length-1;if(a<0)return;n[a].end<0&&(n[a].end=t,n[a].endType=r,n[a].cost=t-n[a].start)}log$1("appendStallInfo",n)}},{key:"suspendWaitingStatus",value:function(e){var t=nowTime(),r=this.playlogs,n=this.resLogs,i=this.stall,a=this.inWaitingStart;if(!(a<=0||this.isSeeking||r.vt<=0)){if(log$1("suspendWaitingStatus>>".concat(e,"|costTime:").concat(t-a," isSeeking:").concat(this.isSeeking," vt:").concat(r.vt)),this.appendStallInfo("end",t,e),t-a>MIN_WAITIONG){var o=t-this.inWaitingStart;if(r.bc++,this.checkInBuffer(this.player.currentTime)?(r.de_bu_acu_t+=o,r.dbc++):(r.nbc++,r.n_bu_acu_t+=o),n.bc++,r.bu_acu_t+=o,n.bu_acu_t+=o,i.stall_end=t,i.stall_last_interval=i.stall_end-i.stall_start,i.stall_acc_time+=i.stall_last_interval,1===i.sc&&(i.first_buf_endt=t),this.player.abrInstance&&!this.isSeeking&&this.playlogs.vt){var s=this.player.abrInstance;this.abrInfo.abr_event_info.video_stall.push({local_time_ms:(new Date).getTime(),stall_duration:parseFloat((o/1e3).toFixed(2)),buffer_length:s.bufferLength,internet_speed:s.downloadSpeed,now_bitrate:s.nowBitrate,play_speed:this.player.playbackRate,is_abr:s.isCurrentInAbr?1:0})}this.onOneEvent({costTime:o,end_type:e||"wait"},{},2)}this._endType="",this.load_state=LOAD_STATES.PLAYABLE,this.inWaitingStart=0,window.clearTimeout(i.intervalId),i.intervalId=null}}},{key:"suspendSeekStatus",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.isSeeking){var r=this.seekLog,n=this.resLogs,i=this.player,a=nowTime()-r.lastSeekStartTime;log$1("suspendSeekStatus>>","".concat(e," currentTime:").concat(i.currentTime," costTime:").concat(a," sat:").concat(r.sat," resLogs.sat:").concat(n.sat)),r.intervalId&&window.clearTimeout(r.intervalId),r.intervalId=null,this.isSeeking=!1;var o=this._endType="seek",s=r.seekBefore,u=(i.currentTime||0).toString();r.sc++,r.sat+=a>MAX_COST?0:a,n.sc++,n.sat+=a>MAX_COST?0:a,this.updateSeekPt(!0),!this.closeSeekLog&&t&&this.onOneOperator({costTime:a,operaType:o,stateBefore:s,stateAfter:u,endType:e})}}},{key:"setPt",value:function(){var e=this.playlogs;this.startStep=1,!e.pt&&this.player.currentTime&&(this.isSeeking=!0),e.pt||(e.pt=curTimestamp(),log$1("setPt","init pt :".concat(e.pt,", document.visibilityState:").concat(document.visibilityState)))}},{key:"setVt",value:function(){var e=this.playlogs;1===this.startStep&&(e.vt||(e.vt=curTimestamp(),log$1("setVt: first frame inited","vt-pt:".concat(e.vt-e.pt," vt-nt:").concat(e.vt-e.nt))),this.startStep=2)}},{key:"setBr",value:function(e){var t=this.playlogs;t.vt>0&&(0===t.br&&(t.fbrt=e||""),t.br++)}},{key:"url",get:function(){var e=this.player;return e&&e.config?e.config.url:""}},{key:"vid",get:function(){var e=this.player;return e&&e.config?e.config.vid:""}},{key:"bc",get:function(){return this.playlogs.bc}},{key:"bu_acu_t",get:function(){return this.playlogs.bu_acu_t}},{key:"pt",get:function(){return this.playlogs.pt||curTimestamp()}},{key:"vt",get:function(){var e=this.playlogs,t=e.vt;return e.pt>0?t:0}},{key:"fvt",get:function(){var e=this.playlogs,t=e.vt,r=e.pt;return t>0&&r>0?parseInt(t-r,10):0}},{key:"nvt",get:function(){var e=this.playlogs,t=e.vt,r=e.nt;return t>0&&r>0?parseInt(t-r,10):0}},{key:"dash_pst",get:function(){return this.playlogs.dash_pst}},{key:"dash_wst",get:function(){return this.playlogs.dash_wst}},{key:"dash_wrt",get:function(){return this.playlogs.dash_wrt}},{key:"dash_ift",get:function(){return this.playlogs.dash_ift}},{key:"dash_cst",get:function(){return this.playlogs.dash_cst}},{key:"dash_spt",get:function(){return this.playlogs.dash_spt}},{key:"vd",get:function(){var e=this.player;return e.duration&&"number"==typeof e.duration&&e.duration>0?parseInt(1e3*e.duration,10):e.config.duration&&"number"==typeof e.config.duration?parseInt(1e3*e.config.duration,10):0}},{key:"cur_play_pos",get:function(){return parseInt(1e3*this.player.currentTime,10)}},{key:"volume",get:function(){return this.player.volume}},{key:"buffer_time",get:function(){var t=0;try{var r=this.player.getBufferedRange();t=r[1]-r[0]}catch(e){t=0}return t}},{key:"player_created_t",get:function(){return this._playerCreatedTime}},{key:"playbackRate",get:function(){return this.player.playbackRate}},{key:"mute",get:function(){return this.player.muted?0:1}},{key:"videoWidth",get:function(){var e=this.player;return e&&e.video?e.video.videoWidth:0}},{key:"videoHeight",get:function(){var e=this.player;return e&&e.video?e.video.videoHeight:0}},{key:"preload",get:function(){var e=this.player;return!(!e||!e.video)&&e.video.preload}},{key:"initial_url",get:function(){var e=this.player.currentSrc;return e.indexOf("blob:")>-1&&this.urlLog.initial_url?this.urlLog.initial_url:checkVideoSrcIsEmpty(e)?"":e}},{key:"initial_host",get:function(){var e=this.player.currentSrc;return e.indexOf("blob:")>-1&&this.urlLog.initial_host?this.urlLog.initial_host:getHostFromUrl(checkVideoSrcIsEmpty(e)?"":e)}},{key:"curHeaders",get:function(){var e=this.player,t=this.task;return e&&e.__dash__&&e.__dash__.curReqVideoSegInfo?transformHeader(e.__dash__.curReqVideoSegInfo.headers||{}):t?t.headers:{}}},{key:"curStatus",get:function(){var e=this.task,t=this.vtype,r=this.netLog;return t.indexOf("MP4")>-1?e?e.status:0:r.status}},{key:"play_type",get:function(){return 0}},{key:"resolution",get:function(){var e=this.player.curDefinition;return e?e.definition+"":this.resLogs.df}},{key:"sessionId",get:function(){return this._sessionId}},{key:"finish",get:function(){return this.isEnded?1:0}},{key:"end_type",get:function(){return this._endType}},{key:"mp4Speed",get:function(){if(!this.player||!this.player.plugins)return 0;var e=this.player.plugins.mp4encryptplayer;return e?e.speed:0}},{key:"mp4RealSpeed",get:function(){if(!this.player||!this.player.plugins)return 0;var e=this.player.plugins.mp4encryptplayer;return e?e.realTimeSpeed:0}},{key:"mp4MseOpLength",get:function(){if(!this.player||!this.player.plugins)return-1;var e=this.player.plugins.mp4encryptplayer;return e?e.opQueueLen||0:-1}},{key:"mp4LoadSegmentTimeRange",get:function(){if(!this.player||!this.player.plugins)return"";var e=this.player.plugins.mp4encryptplayer;return e?e.loadSegmentTimeRange.join(","):""}},{key:"mp4FFInfo",get:function(){if(!this.player||!this.player.plugins)return{};var e=this.player.plugins.mp4encryptplayer;return e&&e.firstFrameTime||{}}},{key:"preLoadData",get:function(){if(!this.player||!this.player.plugins)return[];var e=this.player.plugins.mp4encryptplayer;if(e&&e.preLoadData)return{hit:1,duration:e.preLoadData.duration,length:e.preLoadData.byteLength};var t=this.player.stat||{};if(t.preLoadData){var r=t.preLoadData.length;return{hit:r>0,length:r}}return{hit:0,duration:0,length:0}}},{key:"preloadState",get:function(){if(!this.player||!this.player.plugins)return 0;if(void 0!==this.player.preloadState)return this.player.preloadState||0;var e=this.player.plugins.mp4encryptplayer;return e&&e.preloadState?e.preloadState:0}},{key:"curBitrate",get:function(){var e=this.player,t=e.config,r=e.curDefinition;return r&&r.bitrate?r.bitrate:t.defaultBitrate?t.defaultBitrate:0}},{key:"videoReadyState",get:function(){var e=this.player;return e&&e.video?e.video.readyState:-1}},{key:"videoSeeking",get:function(){var e=this.player;return e&&e.video&&e.video.seeking?1:0}},{key:"videoPaused",get:function(){var e=this.player;return e&&e.video&&e.video.paused?1:0}},{key:"retry_count",get:function(){return this._retryCount}},{key:"switchResolutionCount",get:function(){return this.resLogs.switch_count}},{key:"isError",get:function(){return hasClass$1(this.player.root,"xgpplayer-is-error")}},{key:"isPlaying",get:function(){return hasClass$1(this.player.root,"xgplayer-playing")}},{key:"isStop",get:function(){return hasClass$1(this.player.root,"xgplayer-ended")||hasClass$1(this.player.root,"xgplayer-nostart")}},{key:"isPause",get:function(){return hasClass$1(this.player.root,"xgplayer-pause")}},{key:"isLoading",get:function(){return hasClass$1(this.player.root,"xgplayer-isloading")}},{key:"es",get:function(){return this.isPlaying?"playing":"beforePlay"}},{key:"lt",get:function(){var e=0;return 0===this.vt&&(log$1("lt init",this.playlogs.lt),e=curTimestamp()),e}},{key:"lpt",get:function(){return this.lt?this.lt-this.pt:0}},{key:"playback_state",get:function(){return this.isError?PLAYBACK_STATE.ERROR:this.isStop?PLAYBACK_STATE.STOP:this.isPause?PLAYBACK_STATE.PAUSE:this.isLoading?PLAYBACK_STATE.LOADING:PLAYBACK_STATE.PLAYING}},{key:"is_start_play_automatically",get:function(){return this.isAutoplay+""}},{key:"watchDur",get:function(){var e=this.player,t=this.playlogs;return e.cumulateTime?e.cumulateTime:computeWatchDur(t.played)}},{key:"vtype",get:function(){return this.__vtype?this.__vtype:this.player.dash?"DASH":"DASH"===this._options.vtype?"MP4":this._options.vtype||"MP4"},set:function(e){this.__vtype=e}},{key:"watingCost",get:function(){if(this.inWaitingStart>0){var e=nowTime()-this.inWaitingStart;return e>MAX_COST?0:e}return 0}},{key:"videoNetworkState",get:function(){var e=this.player;return e&&e.video?e.video.networkState:-1}},{key:"eagleid",get:function(){var e=this.player;return e&&e.__dash__&&e.__dash__.curReqVideoSegInfo?(e.__dash__.curReqVideoSegInfo.headers||{}).eagleid:""}},{key:"initial_type",get:function(){var e=this.player.config||{};return e&&e.vodLogOpts&&void 0!==e.vodLogOpts.currentDashType?parseInt(e.vodLogOpts.currentDashType,10):-1}},{key:"dynamicType",get:function(){var e=this.player;return this.__dt?this.__dt:e&&e.__dash__&&e.__dash__.dash&&e.__dash__.dash.mpd?(this.__dt=e.__dash__.dash.mpd.dashType,this.__dt):""}},{key:"updateCurBuffer",value:function(){var e=this.player,t=e.buffered,r=e.currentTime,n={buf_s_pos:0,buf_e_pos:0,buf_include:0},i=[];if(!t||t.length<1)return n;for(var a=-1,o=-1,s=t.length-1;s>-1;s--){var u=parseInt(1e3*t.start(s),10),c=parseInt(1e3*t.end(s),10);i.push({start:u,end:c}),r>u&&r<c?(n.buf_include=1,n.buf_s_pos=u,n.buf_e_pos=c):r<u&&(a<0||u-r<a)?(a=u-r,o=s):r>c&&(a<0||r-c<a)&&(a=r-c,o=s)}1!==n.buf_include&&o>-1&&(n.buf_s_pos=parseInt(1e3*t.start(o),10),n.buf_e_pos=parseInt(1e3*t.end(o),10)),n.buf_diff=parseInt(1e3*t.end(t.length-1)-1e3*r),this.buffers.allBuffer=i,this.buffers.curBuffer=n}},{key:"checkInBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.player.buffered;if(!r)return!1;e=parseInt(1e3*e,10);for(var n=0;n<r.length;n++){var i=parseInt(1e3*r.start(n),10)+t,a=parseInt(1e3*r.end(n),10)+t;if(e>i&&e<a)return!0}return!1}},{key:"updateVideoSize",value:function(){var e=this._options,t=this.player,r=this.resLogs,n=0,i=0;if(t.__dash__&&t.__dash__.dash&&t.__dash__.dash.mpd.mediaList){var a=t.__dash__.dash.mpd.mediaList.video,o=a[a.selectedIdx];log$1("updateVideoSizeã€‹ã€‹videoItem",o),i=o?o.bitrate||o.bandwidth:0,n=o?o.size:0}else{var s=this.player.curDefinition;s?(i=s.bitrate||t.config.bitrate||0,n=parseInt(s.bitrate*t.duration/8,10)):(n=e.videoSize||t.config.videoSize||0,i=e.bitrate||t.config.bitrate||0)}log$1("updateVideoSize","bitrate:".concat(i,", vs:").concat(n)),n&&(r.vs=n,r.vis=parseInt(n/t.duration,10),r.bitrate=i||r.vis)}},{key:"updateVds",value:function(){var e=this.resLogs,t=this.playlogs,r=this.player;if(0!==e.vis){for(var n=parseInt(computeWatchDur(t.played)/1e3,10),i=r.buffered,a=0,o=0;o<i.length;o++)a+=parseInt(i.end(o)-i.start(o),10);log$1("updateVds","pdur:".concat(n," bdur:").concat(a," \n         lbuf:").concat(e.lbuf," lplayed:").concat(e.lplayed," bitrate: ").concat(e.bitrate," vis:").concat(e.vis," vs:").concat(e.vs)),e.vps+=parseInt((n-e.lplayed)*e.vis,10),e.vds+=parseInt((a-e.lbuf)*e.vis,10),e.lplayed=n,e.lbuf=a}else log$1("updateVds","vis:".concat(e.vis))}}],[{key:"TEA_ID",get:function(){return TEA_ID},set:function(e){LS_KEY="__tea_cache_tokens_".concat(TEA_ID=e)}},{key:"AB_SDK_VERSION",get:function(){return AB_SDK_VERSION},set:function(e){AB_SDK_VERSION="Array"===typeOf(e)?e.join(","):e}},{key:"Collector",set:function(e){Collector$1=e}}]),t}();XGPlayerAppLogger.TEA_ID=1300,XGPlayerAppLogger.Collector=Collector$1$1;var xgVodLogger=function(e){if(e&&e.player){var t=e.player.config.vodLogOpts||{};e.player.vodLogger=new XGPlayerAppLogger(e.player,t),e.player.plugins.xgVodLogger=e.player.vodLogger}else this.vodLogger=new XGPlayerAppLogger(this,this.config.vodLogOpts||{})};xgVodLogger.pluginName="__xgVodLogger",xgVodLogger.playerConfig={},xgVodLogger.Collector=Collector$1$1,xgVodLogger.setABSdkVersion=function(e){XGPlayerAppLogger.AB_SDK_VERSION=e};var index_min$1={exports:{}},require$$0=getAugmentedNamespace(es);!function(e,t){e.exports=function(e){function t(){t=function(){return e};var e={},r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(k){u=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i,a,o,s,u=t&&t.prototype instanceof h?t:h,c=Object.create(u.prototype),f=new T(n||[]);return c._invoke=(i=e,a=r,o=f,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return{value:void 0,done:!0}}for(o.method=e,o.arg=t;;){var r=o.delegate;if(r){var n=A(r,o);if(n){if(n===d)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===s)throw s="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s="executing";var u=l(i,a,o);if("normal"===u.type){if(s=o.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:o.done}}"throw"===u.type&&(s="completed",o.method="throw",o.arg=u.arg)}}),c}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(k){return{type:"throw",arg:k}}}e.wrap=c;var d={};function h(){}function f(){}function p(){}var g={};u(g,a,(function(){return this}));var y=Object.getPrototypeOf,m=y&&y(y(w([])));m&&m!==r&&n.call(m,a)&&(g=m);var v=p.prototype=h.prototype=Object.create(g);function _(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function r(i,a,o,s){var u=l(e[i],e,a);if("throw"!==u.type){var c=u.arg,d=c.value;return d&&"object"==_typeof$7(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return r("throw",e,o,s)}))}s(u.arg)}var i;this._invoke=function(e,n){function a(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(a,a):a()}}function A(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,A(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=l(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function w(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:C}}function C(){return{value:void 0,done:!0}}return f.prototype=p,u(v,"constructor",p),u(p,"constructor",f),f.displayName=u(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,u(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},_(b.prototype),u(b.prototype,o,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new b(c(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},_(v),u(v,s,"Generator"),u(v,a,(function(){return this})),u(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=w,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;S(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:w(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function r(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(c){return void r(c)}s.done?t(u):Promise.resolve(u).then(n,i)}function n(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,u,"next",e)}function u(e){r(o,i,a,s,u,"throw",e)}s(void 0)}))}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,s(e,t)}function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(DR){return!1}}function c(e,t,r){return(c=u()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&s(i,r.prototype),i}).apply(null,arguments)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function h(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:{},p=function(e){return e&&e.Math==Math&&e},g=p("object"==("undefined"==typeof globalThis?"undefined":_typeof$7(globalThis))&&globalThis)||p("object"==("undefined"==typeof window?"undefined":_typeof$7(window))&&window)||p("object"==("undefined"==typeof self?"undefined":_typeof$7(self))&&self)||p("object"==_typeof$7(f)&&f)||function(){return this}()||Function("return this")(),y={},m=function(e){try{return!!e()}catch(t){return!0}},v=!m((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),_=!m((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),b=_,A=Function.prototype.call,E=b?A.bind(A):function(){return A.apply(A,arguments)},S={},T={}.propertyIsEnumerable,w=Object.getOwnPropertyDescriptor,C=w&&!T.call({1:2},1);S.f=C?function(e){var t=w(this,e);return!!t&&t.enumerable}:T;var k,I,$=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},P=_,x=Function.prototype,R=x.bind,O=x.call,D=P&&R.bind(O,O),L=P?function(e){return e&&D(e)}:function(e){return e&&function(){return O.apply(e,arguments)}},M=L,N=M({}.toString),B=M("".slice),U=function(e){return B(N(e),8,-1)},G=m,V=U,F=Object,j=L("".split),H=G((function(){return!F("z").propertyIsEnumerable(0)}))?function(e){return"String"==V(e)?j(e,""):F(e)}:F,Z=function(e){return null==e},W=Z,K=TypeError,X=function(e){if(W(e))throw K("Can't call method on "+e);return e},Y=H,z=X,J=function(e){return Y(z(e))},Q=function(e){return"function"==typeof e},q=Q,ee="object"==("undefined"==typeof document?"undefined":_typeof$7(document))&&document.all,te=void 0===ee&&void 0!==ee?function(e){return"object"==_typeof$7(e)?null!==e:q(e)||e===ee}:function(e){return"object"==_typeof$7(e)?null!==e:q(e)},re=g,ne=Q,ie=function(e){return ne(e)?e:void 0},ae=function(e,t){return arguments.length<2?ie(re[e]):re[e]&&re[e][t]},oe=L({}.isPrototypeOf),se=ae("navigator","userAgent")||"",ue=g,ce=se,le=ue.process,de=ue.Deno,he=le&&le.versions||de&&de.version,fe=he&&he.v8;fe&&(I=(k=fe.split("."))[0]>0&&k[0]<4?1:+(k[0]+k[1])),!I&&ce&&(!(k=ce.match(/Edge\/(\d+)/))||k[1]>=74)&&(k=ce.match(/Chrome\/(\d+)/))&&(I=+k[1]);var pe=I,ge=pe,ye=m,me=!!Object.getOwnPropertySymbols&&!ye((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ge&&ge<41})),ve=me&&!Symbol.sham&&"symbol"==_typeof$7(Symbol.iterator),_e=ae,be=Q,Ae=oe,Ee=Object,Se=ve?function(e){return"symbol"==_typeof$7(e)}:function(e){var t=_e("Symbol");return be(t)&&Ae(t.prototype,Ee(e))},Te=String,we=function(e){try{return Te(e)}catch(t){return"Object"}},Ce=Q,ke=we,Ie=TypeError,$e=function(e){if(Ce(e))return e;throw Ie(ke(e)+" is not a function")},Pe=$e,xe=Z,Re=function(e,t){var r=e[t];return xe(r)?void 0:Pe(r)},Oe=E,De=Q,Le=te,Me=TypeError,Ne={exports:{}},Be=g,Ue=Object.defineProperty,Ge=function(e,t){try{Ue(Be,e,{value:t,configurable:!0,writable:!0})}catch(r){Be[e]=t}return t},Ve=Ge,Fe="__core-js_shared__",je=g[Fe]||Ve(Fe,{}),He=je;(Ne.exports=function(e,t){return He[e]||(He[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.25.0",mode:"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Ze=X,We=Object,Ke=function(e){return We(Ze(e))},Xe=Ke,Ye=L({}.hasOwnProperty),ze=Object.hasOwn||function(e,t){return Ye(Xe(e),t)},Je=L,Qe=0,qe=Math.random(),et=Je(1..toString),tt=function(e){return"Symbol("+(void 0===e?"":e)+")_"+et(++Qe+qe,36)},rt=g,nt=Ne.exports,it=ze,at=tt,ot=me,st=ve,ut=nt("wks"),ct=rt.Symbol,lt=ct&&ct.for,dt=st?ct:ct&&ct.withoutSetter||at,ht=function(e){if(!it(ut,e)||!ot&&"string"!=typeof ut[e]){var t="Symbol."+e;ot&&it(ct,e)?ut[e]=ct[e]:ut[e]=st&&lt?lt(t):dt(t)}return ut[e]},ft=E,pt=te,gt=Se,yt=Re,mt=function(e,t){var r,n;if("string"===t&&De(r=e.toString)&&!Le(n=Oe(r,e)))return n;if(De(r=e.valueOf)&&!Le(n=Oe(r,e)))return n;if("string"!==t&&De(r=e.toString)&&!Le(n=Oe(r,e)))return n;throw Me("Can't convert object to primitive value")},vt=TypeError,_t=ht("toPrimitive"),bt=function(e,t){if(!pt(e)||gt(e))return e;var r,n=yt(e,_t);if(n){if(void 0===t&&(t="default"),r=ft(n,e,t),!pt(r)||gt(r))return r;throw vt("Can't convert object to primitive value")}return void 0===t&&(t="number"),mt(e,t)},At=bt,Et=Se,St=function(e){var t=At(e,"string");return Et(t)?t:t+""},Tt=te,wt=g.document,Ct=Tt(wt)&&Tt(wt.createElement),kt=function(e){return Ct?wt.createElement(e):{}},It=kt,$t=!v&&!m((function(){return 7!=Object.defineProperty(It("div"),"a",{get:function(){return 7}}).a})),Pt=v,xt=E,Rt=S,Ot=$,Dt=J,Lt=St,Mt=ze,Nt=$t,Bt=Object.getOwnPropertyDescriptor;y.f=Pt?Bt:function(e,t){if(e=Dt(e),t=Lt(t),Nt)try{return Bt(e,t)}catch(r){}if(Mt(e,t))return Ot(!xt(Rt.f,e,t),e[t])};var Ut={},Gt=v&&m((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Vt=te,Ft=String,jt=TypeError,Ht=function(e){if(Vt(e))return e;throw jt(Ft(e)+" is not an object")},Zt=v,Wt=$t,Kt=Gt,Xt=Ht,Yt=St,zt=TypeError,Jt=Object.defineProperty,Qt=Object.getOwnPropertyDescriptor,qt="enumerable",er="configurable",tr="writable";Ut.f=Zt?Kt?function(e,t,r){if(Xt(e),t=Yt(t),Xt(r),"function"==typeof e&&"prototype"===t&&"value"in r&&tr in r&&!r.writable){var n=Qt(e,t);n&&n.writable&&(e[t]=r.value,r={configurable:er in r?r.configurable:n.configurable,enumerable:qt in r?r.enumerable:n.enumerable,writable:!1})}return Jt(e,t,r)}:Jt:function(e,t,r){if(Xt(e),t=Yt(t),Xt(r),Wt)try{return Jt(e,t,r)}catch(n){}if("get"in r||"set"in r)throw zt("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var rr=Ut,nr=$,ir=v?function(e,t,r){return rr.f(e,t,nr(1,r))}:function(e,t,r){return e[t]=r,e},ar={exports:{}},or=v,sr=ze,ur=Function.prototype,cr=or&&Object.getOwnPropertyDescriptor,lr=sr(ur,"name"),dr={EXISTS:lr,PROPER:lr&&"something"===function(){}.name,CONFIGURABLE:lr&&(!or||or&&cr(ur,"name").configurable)},hr=Q,fr=je,pr=L(Function.toString);hr(fr.inspectSource)||(fr.inspectSource=function(e){return pr(e)});var gr,yr,mr,vr=fr.inspectSource,_r=Q,br=g.WeakMap,Ar=_r(br)&&/native code/.test(String(br)),Er=Ne.exports,Sr=tt,Tr=Er("keys"),wr=function(e){return Tr[e]||(Tr[e]=Sr(e))},Cr={},kr=Ar,Ir=g,$r=L,Pr=te,xr=ir,Rr=ze,Or=je,Dr=wr,Lr=Cr,Mr="Object already initialized",Nr=Ir.TypeError,Br=Ir.WeakMap;if(kr||Or.state){var Ur=Or.state||(Or.state=new Br),Gr=$r(Ur.get),Vr=$r(Ur.has),Fr=$r(Ur.set);gr=function(e,t){if(Vr(Ur,e))throw Nr(Mr);return t.facade=e,Fr(Ur,e,t),t},yr=function(e){return Gr(Ur,e)||{}},mr=function(e){return Vr(Ur,e)}}else{var jr=Dr("state");Lr[jr]=!0,gr=function(e,t){if(Rr(e,jr))throw Nr(Mr);return t.facade=e,xr(e,jr,t),t},yr=function(e){return Rr(e,jr)?e[jr]:{}},mr=function(e){return Rr(e,jr)}}var Hr={set:gr,get:yr,has:mr,enforce:function(e){return mr(e)?yr(e):gr(e,{})},getterFor:function(e){return function(t){var r;if(!Pr(t)||(r=yr(t)).type!==e)throw Nr("Incompatible receiver, "+e+" required");return r}}},Zr=m,Wr=Q,Kr=ze,Xr=v,Yr=dr.CONFIGURABLE,zr=vr,Jr=Hr.enforce,Qr=Hr.get,qr=Object.defineProperty,en=Xr&&!Zr((function(){return 8!==qr((function(){}),"length",{value:8}).length})),tn=String(String).split("String"),rn=ar.exports=function(e,t,r){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!Kr(e,"name")||Yr&&e.name!==t)&&(Xr?qr(e,"name",{value:t,configurable:!0}):e.name=t),en&&r&&Kr(r,"arity")&&e.length!==r.arity&&qr(e,"length",{value:r.arity});try{r&&Kr(r,"constructor")&&r.constructor?Xr&&qr(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(i){}var n=Jr(e);return Kr(n,"source")||(n.source=tn.join("string"==typeof t?t:"")),e};Function.prototype.toString=rn((function(){return Wr(this)&&Qr(this).source||zr(this)}),"toString");var nn=Q,an=Ut,on=ar.exports,sn=Ge,un=function(e,t,r,n){n||(n={});var i=n.enumerable,a=void 0!==n.name?n.name:t;if(nn(r)&&on(r,a,n),n.global)i?e[t]=r:sn(t,r);else{try{n.unsafe?e[t]&&(i=!0):delete e[t]}catch(o){}i?e[t]=r:an.f(e,t,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return e},cn={},ln=Math.ceil,dn=Math.floor,hn=Math.trunc||function(e){var t=+e;return(t>0?dn:ln)(t)},fn=function(e){var t=+e;return t!=t||0===t?0:hn(t)},pn=fn,gn=Math.max,yn=Math.min,mn=function(e,t){var r=pn(e);return r<0?gn(r+t,0):yn(r,t)},vn=fn,_n=Math.min,bn=function(e){return e>0?_n(vn(e),9007199254740991):0},An=bn,En=function(e){return An(e.length)},Sn=J,Tn=mn,wn=En,Cn=function(e){return function(t,r,n){var i,a=Sn(t),o=wn(a),s=Tn(n,o);if(e&&r!=r){for(;o>s;)if((i=a[s++])!=i)return!0}else for(;o>s;s++)if((e||s in a)&&a[s]===r)return e||s||0;return!e&&-1}},kn={includes:Cn(!0),indexOf:Cn(!1)},In=ze,$n=J,Pn=kn.indexOf,xn=Cr,Rn=L([].push),On=function(e,t){var r,n=$n(e),i=0,a=[];for(r in n)!In(xn,r)&&In(n,r)&&Rn(a,r);for(;t.length>i;)In(n,r=t[i++])&&(~Pn(a,r)||Rn(a,r));return a},Dn=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ln=On,Mn=Dn.concat("length","prototype");cn.f=Object.getOwnPropertyNames||function(e){return Ln(e,Mn)};var Nn={};Nn.f=Object.getOwnPropertySymbols;var Bn=ae,Un=cn,Gn=Nn,Vn=Ht,Fn=L([].concat),jn=Bn("Reflect","ownKeys")||function(e){var t=Un.f(Vn(e)),r=Gn.f;return r?Fn(t,r(e)):t},Hn=ze,Zn=jn,Wn=y,Kn=Ut,Xn=function(e,t,r){for(var n=Zn(t),i=Kn.f,a=Wn.f,o=0;o<n.length;o++){var s=n[o];Hn(e,s)||r&&Hn(r,s)||i(e,s,a(t,s))}},Yn=m,zn=Q,Jn=/#|\.prototype\./,Qn=function(e,t){var r=ei[qn(e)];return r==ri||r!=ti&&(zn(t)?Yn(t):!!t)},qn=Qn.normalize=function(e){return String(e).replace(Jn,".").toLowerCase()},ei=Qn.data={},ti=Qn.NATIVE="N",ri=Qn.POLYFILL="P",ni=Qn,ii=g,ai=y.f,oi=ir,si=un,ui=Ge,ci=Xn,li=ni,di=function(e,t){var r,n,i,a,o,s=e.target,u=e.global,c=e.stat;if(r=u?ii:c?ii[s]||ui(s,{}):(ii[s]||{}).prototype)for(n in t){if(a=t[n],i=e.dontCallGetSet?(o=ai(r,n))&&o.value:r[n],!li(u?n:s+(c?".":"#")+n,e.forced)&&void 0!==i){if(_typeof$7(a)==_typeof$7(i))continue;ci(a,i)}(e.sham||i&&i.sham)&&oi(a,"sham",!0),si(r,n,a,e)}},hi=U,fi=Array.isArray||function(e){return"Array"==hi(e)},pi=TypeError,gi=function(e){if(e>9007199254740991)throw pi("Maximum allowed index exceeded");return e},yi=St,mi=Ut,vi=$,_i=function(e,t,r){var n=yi(t);n in e?mi.f(e,n,vi(0,r)):e[n]=r},bi={};bi[ht("toStringTag")]="z";var Ai="[object z]"===String(bi),Ei=Ai,Si=Q,Ti=U,wi=ht("toStringTag"),Ci=Object,ki="Arguments"==Ti(function(){return arguments}()),Ii=Ei?Ti:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(r){}}(t=Ci(e),wi))?r:ki?Ti(t):"Object"==(n=Ti(t))&&Si(t.callee)?"Arguments":n},$i=L,Pi=m,xi=Q,Ri=Ii,Oi=vr,Di=function(){},Li=[],Mi=ae("Reflect","construct"),Ni=/^\s*(?:class|function)\b/,Bi=$i(Ni.exec),Ui=!Ni.exec(Di),Gi=function(e){if(!xi(e))return!1;try{return Mi(Di,Li,e),!0}catch(t){return!1}},Vi=function(e){if(!xi(e))return!1;switch(Ri(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ui||!!Bi(Ni,Oi(e))}catch(t){return!0}};Vi.sham=!0;var Fi=!Mi||Pi((function(){var e;return Gi(Gi.call)||!Gi(Object)||!Gi((function(){e=!0}))||e}))?Vi:Gi,ji=fi,Hi=Fi,Zi=te,Wi=ht("species"),Ki=Array,Xi=function(e){var t;return ji(e)&&(t=e.constructor,(Hi(t)&&(t===Ki||ji(t.prototype))||Zi(t)&&null===(t=t[Wi]))&&(t=void 0)),void 0===t?Ki:t},Yi=function(e,t){return new(Xi(e))(0===t?0:t)},zi=m,Ji=pe,Qi=ht("species"),qi=function(e){return Ji>=51||!zi((function(){var t=[];return(t.constructor={})[Qi]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},ea=di,ta=m,ra=fi,na=te,ia=Ke,aa=En,oa=gi,sa=_i,ua=Yi,ca=qi,la=pe,da=ht("isConcatSpreadable"),ha=la>=51||!ta((function(){var e=[];return e[da]=!1,e.concat()[0]!==e})),fa=ca("concat"),pa=function(e){if(!na(e))return!1;var t=e[da];return void 0!==t?!!t:ra(e)};ea({target:"Array",proto:!0,arity:1,forced:!ha||!fa},{concat:function(e){var t,r,n,i,a,o=ia(this),s=ua(o,0),u=0;for(t=-1,n=arguments.length;t<n;t++)if(pa(a=-1===t?o:arguments[t]))for(i=aa(a),oa(u+i),r=0;r<i;r++,u++)r in a&&sa(s,u,a[r]);else oa(u+1),sa(s,u++,a);return s.length=u,s}});var ga=Ii,ya=Ai?{}.toString:function(){return"[object "+ga(this)+"]"};Ai||un(Object.prototype,"toString",ya,{unsafe:!0});var ma,va,_a,ba,Aa="process"==U(g.process),Ea=Q,Sa=String,Ta=TypeError,wa=L,Ca=Ht,ka=function(e){if("object"==_typeof$7(e)||Ea(e))return e;throw Ta("Can't set "+Sa(e)+" as a prototype")},Ia=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=wa(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(n){}return function(r,n){return Ca(r),ka(n),t?e(r,n):r.__proto__=n,r}}():void 0),$a=Ut.f,Pa=ze,xa=ht("toStringTag"),Ra=function(e,t,r){e&&!r&&(e=e.prototype),e&&!Pa(e,xa)&&$a(e,xa,{configurable:!0,value:t})},Oa=ae,Da=Ut,La=v,Ma=ht("species"),Na=function(e){var t=Oa(e),r=Da.f;La&&t&&!t[Ma]&&r(t,Ma,{configurable:!0,get:function(){return this}})},Ba=oe,Ua=TypeError,Ga=function(e,t){if(Ba(t,e))return e;throw Ua("Incorrect invocation")},Va=Fi,Fa=we,ja=TypeError,Ha=function(e){if(Va(e))return e;throw ja(Fa(e)+" is not a constructor")},Za=Ht,Wa=Ha,Ka=Z,Xa=ht("species"),Ya=function(e,t){var r,n=Za(e).constructor;return void 0===n||Ka(r=Za(n)[Xa])?t:Wa(r)},za=_,Ja=Function.prototype,Qa=Ja.apply,qa=Ja.call,eo="object"==("undefined"==typeof Reflect?"undefined":_typeof$7(Reflect))&&Reflect.apply||(za?qa.bind(Qa):function(){return qa.apply(Qa,arguments)}),to=$e,ro=_,no=L(L.bind),io=function(e,t){return to(e),void 0===t?e:ro?no(e,t):function(){return e.apply(t,arguments)}},ao=ae("document","documentElement"),oo=L([].slice),so=TypeError,uo=function(e,t){if(e<t)throw so("Not enough arguments");return e},co=/(?:ipad|iphone|ipod).*applewebkit/i.test(se),lo=g,ho=eo,fo=io,po=Q,go=ze,yo=m,mo=ao,vo=oo,_o=kt,bo=uo,Ao=co,Eo=Aa,So=lo.setImmediate,To=lo.clearImmediate,wo=lo.process,Co=lo.Dispatch,ko=lo.Function,Io=lo.MessageChannel,$o=lo.String,Po=0,xo={},Ro="onreadystatechange";try{ma=lo.location}catch(EU){}var Oo=function(e){if(go(xo,e)){var t=xo[e];delete xo[e],t()}},Do=function(e){return function(){Oo(e)}},Lo=function(e){Oo(e.data)},Mo=function(e){lo.postMessage($o(e),ma.protocol+"//"+ma.host)};So&&To||(So=function(e){bo(arguments.length,1);var t=po(e)?e:ko(e),r=vo(arguments,1);return xo[++Po]=function(){ho(t,void 0,r)},va(Po),Po},To=function(e){delete xo[e]},Eo?va=function(e){wo.nextTick(Do(e))}:Co&&Co.now?va=function(e){Co.now(Do(e))}:Io&&!Ao?(ba=(_a=new Io).port2,_a.port1.onmessage=Lo,va=fo(ba.postMessage,ba)):lo.addEventListener&&po(lo.postMessage)&&!lo.importScripts&&ma&&"file:"!==ma.protocol&&!yo(Mo)?(va=Mo,lo.addEventListener("message",Lo,!1)):va=Ro in _o("script")?function(e){mo.appendChild(_o("script")).onreadystatechange=function(){mo.removeChild(this),Oo(e)}}:function(e){setTimeout(Do(e),0)});var No,Bo,Uo,Go,Vo,Fo,jo,Ho,Zo={set:So,clear:To},Wo=g,Ko=/ipad|iphone|ipod/i.test(se)&&void 0!==Wo.Pebble,Xo=/web0s(?!.*chrome)/i.test(se),Yo=g,zo=io,Jo=y.f,Qo=Zo.set,qo=co,es=Ko,ts=Xo,rs=Aa,ns=Yo.MutationObserver||Yo.WebKitMutationObserver,is=Yo.document,as=Yo.process,os=Yo.Promise,ss=Jo(Yo,"queueMicrotask"),us=ss&&ss.value;us||(No=function(){var e,t;for(rs&&(e=as.domain)&&e.exit();Bo;){t=Bo.fn,Bo=Bo.next;try{t()}catch(EU){throw Bo?Go():Uo=void 0,EU}}Uo=void 0,e&&e.enter()},qo||rs||ts||!ns||!is?!es&&os&&os.resolve?((jo=os.resolve(void 0)).constructor=os,Ho=zo(jo.then,jo),Go=function(){Ho(No)}):rs?Go=function(){as.nextTick(No)}:(Qo=zo(Qo,Yo),Go=function(){Qo(No)}):(Vo=!0,Fo=is.createTextNode(""),new ns(No).observe(Fo,{characterData:!0}),Go=function(){Fo.data=Vo=!Vo}));var cs=us||function(e){var t={fn:e,next:void 0};Uo&&(Uo.next=t),Bo||(Bo=t,Go()),Uo=t},ls=g,ds=function(e){try{return{error:!1,value:e()}}catch(EU){return{error:!0,value:EU}}},hs=function(){this.head=null,this.tail=null};hs.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var fs=hs,ps=g.Promise,gs="object"==("undefined"==typeof Deno?"undefined":_typeof$7(Deno))&&Deno&&"object"==_typeof$7(Deno.version),ys=!gs&&!Aa&&"object"==("undefined"==typeof window?"undefined":_typeof$7(window))&&"object"==("undefined"==typeof document?"undefined":_typeof$7(document)),ms=g,vs=ps,_s=Q,bs=ni,As=vr,Es=ht,Ss=ys,Ts=gs,ws=pe;vs&&vs.prototype;var Cs=Es("species"),ks=!1,Is=_s(ms.PromiseRejectionEvent),$s={CONSTRUCTOR:bs("Promise",(function(){var e=As(vs),t=e!==String(vs);if(!t&&66===ws)return!0;if(!ws||ws<51||!/native code/.test(e)){var r=new vs((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};if((r.constructor={})[Cs]=n,!(ks=r.then((function(){}))instanceof n))return!0}return!t&&(Ss||Ts)&&!Is})),REJECTION_EVENT:Is,SUBCLASSING:ks},Ps={},xs=$e,Rs=TypeError,Os=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw Rs("Bad Promise constructor");t=e,r=n})),this.resolve=xs(t),this.reject=xs(r)};Ps.f=function(e){return new Os(e)};var Ds,Ls,Ms,Ns=di,Bs=Aa,Us=g,Gs=E,Vs=un,Fs=Ia,js=Ra,Hs=Na,Zs=$e,Ws=Q,Ks=te,Xs=Ga,Ys=Ya,zs=Zo.set,Js=cs,Qs=function(e,t){var r=ls.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))},qs=ds,eu=fs,tu=Hr,ru=ps,nu=Ps,iu="Promise",au=$s.CONSTRUCTOR,ou=$s.REJECTION_EVENT,su=$s.SUBCLASSING,uu=tu.getterFor(iu),cu=tu.set,lu=ru&&ru.prototype,du=ru,hu=lu,fu=Us.TypeError,pu=Us.document,gu=Us.process,yu=nu.f,mu=yu,vu=!!(pu&&pu.createEvent&&Us.dispatchEvent),_u="unhandledrejection",bu=function(e){var t;return!(!Ks(e)||!Ws(t=e.then))&&t},Au=function(e,t){var r,n,i,a=t.value,o=1==t.state,s=o?e.ok:e.fail,u=e.resolve,c=e.reject,l=e.domain;try{s?(o||(2===t.rejection&&Cu(t),t.rejection=1),!0===s?r=a:(l&&l.enter(),r=s(a),l&&(l.exit(),i=!0)),r===e.promise?c(fu("Promise-chain cycle")):(n=bu(r))?Gs(n,r,u,c):u(r)):c(a)}catch(EU){l&&!i&&l.exit(),c(EU)}},Eu=function(e,t){e.notified||(e.notified=!0,Js((function(){for(var r,n=e.reactions;r=n.get();)Au(r,e);e.notified=!1,t&&!e.rejection&&Tu(e)})))},Su=function(e,t,r){var n,i;vu?((n=pu.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),Us.dispatchEvent(n)):n={promise:t,reason:r},!ou&&(i=Us["on"+e])?i(n):e===_u&&Qs("Unhandled promise rejection",r)},Tu=function(e){Gs(zs,Us,(function(){var t,r=e.facade,n=e.value;if(wu(e)&&(t=qs((function(){Bs?gu.emit("unhandledRejection",n,r):Su(_u,r,n)})),e.rejection=Bs||wu(e)?2:1,t.error))throw t.value}))},wu=function(e){return 1!==e.rejection&&!e.parent},Cu=function(e){Gs(zs,Us,(function(){var t=e.facade;Bs?gu.emit("rejectionHandled",t):Su("rejectionhandled",t,e.value)}))},ku=function(e,t,r){return function(n){e(t,n,r)}},Iu=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,Eu(e,!0))},$u=function e(t,r,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===r)throw fu("Promise can't be resolved itself");var i=bu(r);i?Js((function(){var n={done:!1};try{Gs(i,r,ku(e,n,t),ku(Iu,n,t))}catch(EU){Iu(n,EU,t)}})):(t.value=r,t.state=1,Eu(t,!1))}catch(EU){Iu({done:!1},EU,t)}}};if(au&&(hu=(du=function(e){Xs(this,hu),Zs(e),Gs(Ds,this);var t=uu(this);try{e(ku($u,t),ku(Iu,t))}catch(EU){Iu(t,EU)}}).prototype,(Ds=function(e){cu(this,{type:iu,done:!1,notified:!1,parent:!1,reactions:new eu,rejection:!1,state:0,value:void 0})}).prototype=Vs(hu,"then",(function(e,t){var r=uu(this),n=yu(Ys(this,du));return r.parent=!0,n.ok=!Ws(e)||e,n.fail=Ws(t)&&t,n.domain=Bs?gu.domain:void 0,0==r.state?r.reactions.add(n):Js((function(){Au(n,r)})),n.promise})),Ls=function(){var e=new Ds,t=uu(e);this.promise=e,this.resolve=ku($u,t),this.reject=ku(Iu,t)},nu.f=yu=function(e){return e===du||void 0===e?new Ls(e):mu(e)},Ws(ru)&&lu!==Object.prototype)){Ms=lu.then,su||Vs(lu,"then",(function(e,t){var r=this;return new du((function(e,t){Gs(Ms,r,e,t)})).then(e,t)}),{unsafe:!0});try{delete lu.constructor}catch(EU){}Fs&&Fs(lu,hu)}Ns({global:!0,constructor:!0,wrap:!0,forced:au},{Promise:du}),js(du,iu,!1),Hs(iu);var Pu={},xu=Pu,Ru=ht("iterator"),Ou=Array.prototype,Du=function(e){return void 0!==e&&(xu.Array===e||Ou[Ru]===e)},Lu=Ii,Mu=Re,Nu=Z,Bu=Pu,Uu=ht("iterator"),Gu=function(e){if(!Nu(e))return Mu(e,Uu)||Mu(e,"@@iterator")||Bu[Lu(e)]},Vu=E,Fu=$e,ju=Ht,Hu=we,Zu=Gu,Wu=TypeError,Ku=function(e,t){var r=arguments.length<2?Zu(e):t;if(Fu(r))return ju(Vu(r,e));throw Wu(Hu(e)+" is not iterable")},Xu=E,Yu=Ht,zu=Re,Ju=function(e,t,r){var n,i;Yu(e);try{if(!(n=zu(e,"return"))){if("throw"===t)throw r;return r}n=Xu(n,e)}catch(EU){i=!0,n=EU}if("throw"===t)throw r;if(i)throw n;return Yu(n),r},Qu=io,qu=E,ec=Ht,tc=we,rc=Du,nc=En,ic=oe,ac=Ku,oc=Gu,sc=Ju,uc=TypeError,cc=function(e,t){this.stopped=e,this.result=t},lc=cc.prototype,dc=function(e,t,r){var n,i,a,o,s,u,c,l=r&&r.that,d=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),f=!(!r||!r.IS_ITERATOR),p=!(!r||!r.INTERRUPTED),g=Qu(t,l),y=function(e){return n&&sc(n,"normal",e),new cc(!0,e)},m=function(e){return d?(ec(e),p?g(e[0],e[1],y):g(e[0],e[1])):p?g(e,y):g(e)};if(h)n=e.iterator;else if(f)n=e;else{if(!(i=oc(e)))throw uc(tc(e)+" is not iterable");if(rc(i)){for(a=0,o=nc(e);o>a;a++)if((s=m(e[a]))&&ic(lc,s))return s;return new cc(!1)}n=ac(e,i)}for(u=h?e.next:n.next;!(c=qu(u,n)).done;){try{s=m(c.value)}catch(EU){sc(n,"throw",EU)}if("object"==_typeof$7(s)&&s&&ic(lc,s))return s}return new cc(!1)},hc=ht("iterator"),fc=!1;try{var pc=0,gc={next:function(){return{done:!!pc++}},return:function(){fc=!0}};gc[hc]=function(){return this},Array.from(gc,(function(){throw 2}))}catch(EU){}var yc=function(e,t){if(!t&&!fc)return!1;var r=!1;try{var n={};n[hc]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(EU){}return r},mc=ps,vc=$s.CONSTRUCTOR||!yc((function(e){mc.all(e).then(void 0,(function(){}))})),_c=E,bc=$e,Ac=Ps,Ec=ds,Sc=dc;di({target:"Promise",stat:!0,forced:vc},{all:function(e){var t=this,r=Ac.f(t),n=r.resolve,i=r.reject,a=Ec((function(){var r=bc(t.resolve),a=[],o=0,s=1;Sc(e,(function(e){var u=o++,c=!1;s++,_c(r,t,e).then((function(e){c||(c=!0,a[u]=e,--s||n(a))}),i)})),--s||n(a)}));return a.error&&i(a.value),r.promise}});var Tc=di,wc=$s.CONSTRUCTOR,Cc=ps,kc=ae,Ic=Q,$c=un,Pc=Cc&&Cc.prototype;if(Tc({target:"Promise",proto:!0,forced:wc,real:!0},{catch:function(e){return this.then(void 0,e)}}),Ic(Cc)){var xc=kc("Promise").prototype.catch;Pc.catch!==xc&&$c(Pc,"catch",xc,{unsafe:!0})}var Rc=E,Oc=$e,Dc=Ps,Lc=ds,Mc=dc;di({target:"Promise",stat:!0,forced:vc},{race:function(e){var t=this,r=Dc.f(t),n=r.reject,i=Lc((function(){var i=Oc(t.resolve);Mc(e,(function(e){Rc(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}});var Nc=E,Bc=Ps;di({target:"Promise",stat:!0,forced:$s.CONSTRUCTOR},{reject:function(e){var t=Bc.f(this);return Nc(t.reject,void 0,e),t.promise}});var Uc=Ht,Gc=te,Vc=Ps,Fc=function(e,t){if(Uc(e),Gc(t)&&t.constructor===e)return t;var r=Vc.f(e);return(0,r.resolve)(t),r.promise},jc=di,Hc=$s.CONSTRUCTOR,Zc=Fc;ae("Promise"),jc({target:"Promise",stat:!0,forced:Hc},{resolve:function(e){return Zc(this,e)}});var Wc=Ii,Kc=String,Xc=function(e){if("Symbol"===Wc(e))throw TypeError("Cannot convert a Symbol value to a string");return Kc(e)},Yc=fn,zc=Xc,Jc=X,Qc=RangeError,qc=function(e){var t=zc(Jc(this)),r="",n=Yc(e);if(n<0||n==1/0)throw Qc("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(r+=t);return r};di({target:"String",proto:!0},{repeat:qc});var el=Ht,tl=function(){var e=el(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},rl=m,nl=g.RegExp,il=rl((function(){var e=nl("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),al=il||rl((function(){return!nl("a","y").sticky})),ol={BROKEN_CARET:il||rl((function(){var e=nl("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),MISSED_STICKY:al,UNSUPPORTED_Y:il},sl={},ul=On,cl=Dn,ll=Object.keys||function(e){return ul(e,cl)},dl=v,hl=Gt,fl=Ut,pl=Ht,gl=J,yl=ll;sl.f=dl&&!hl?Object.defineProperties:function(e,t){pl(e);for(var r,n=gl(t),i=yl(t),a=i.length,o=0;a>o;)fl.f(e,r=i[o++],n[r]);return e};var ml,vl=Ht,_l=sl,bl=Dn,Al=Cr,El=ao,Sl=kt,Tl=wr("IE_PROTO"),wl=function(){},Cl=function(e){return"<script>"+e+"<\/script>"},kl=function(e){e.write(Cl("")),e.close();var t=e.parentWindow.Object;return e=null,t},Il=function(){try{ml=new ActiveXObject("htmlfile")}catch(EU){}var e,t;Il="undefined"!=typeof document?document.domain&&ml?kl(ml):((t=Sl("iframe")).style.display="none",El.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Cl("document.F=Object")),e.close(),e.F):kl(ml);for(var r=bl.length;r--;)delete Il.prototype[bl[r]];return Il()};Al[Tl]=!0;var $l,Pl,xl=Object.create||function(e,t){var r;return null!==e?(wl.prototype=vl(e),r=new wl,wl.prototype=null,r[Tl]=e):r=Il(),void 0===t?r:_l.f(r,t)},Rl=m,Ol=g.RegExp,Dl=Rl((function(){var e=Ol(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),Ll=m,Ml=g.RegExp,Nl=Ll((function(){var e=Ml("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),Bl=E,Ul=L,Gl=Xc,Vl=tl,Fl=ol,jl=Ne.exports,Hl=xl,Zl=Hr.get,Wl=Dl,Kl=Nl,Xl=jl("native-string-replace",String.prototype.replace),Yl=RegExp.prototype.exec,zl=Yl,Jl=Ul("".charAt),Ql=Ul("".indexOf),ql=Ul("".replace),ed=Ul("".slice),td=(Pl=/b*/g,Bl(Yl,$l=/a/,"a"),Bl(Yl,Pl,"a"),0!==$l.lastIndex||0!==Pl.lastIndex),rd=Fl.BROKEN_CARET,nd=void 0!==/()??/.exec("")[1];(td||nd||rd||Wl||Kl)&&(zl=function(e){var t,r,n,i,a,o,s,u=this,c=Zl(u),l=Gl(e),d=c.raw;if(d)return d.lastIndex=u.lastIndex,t=Bl(zl,d,l),u.lastIndex=d.lastIndex,t;var h=c.groups,f=rd&&u.sticky,p=Bl(Vl,u),g=u.source,y=0,m=l;if(f&&(p=ql(p,"y",""),-1===Ql(p,"g")&&(p+="g"),m=ed(l,u.lastIndex),u.lastIndex>0&&(!u.multiline||u.multiline&&"\n"!==Jl(l,u.lastIndex-1))&&(g="(?: "+g+")",m=" "+m,y++),r=new RegExp("^(?:"+g+")",p)),nd&&(r=new RegExp("^"+g+"$(?!\\s)",p)),td&&(n=u.lastIndex),i=Bl(Yl,f?r:u,m),f?i?(i.input=ed(i.input,y),i[0]=ed(i[0],y),i.index=u.lastIndex,u.lastIndex+=i[0].length):u.lastIndex=0:td&&i&&(u.lastIndex=u.global?i.index+i[0].length:n),nd&&i&&i.length>1&&Bl(Xl,i[0],r,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(i[a]=void 0)})),i&&h)for(i.groups=o=Hl(null),a=0;a<h.length;a++)o[(s=h[a])[0]]=i[s[1]];return i});var id=zl;di({target:"RegExp",proto:!0,forced:/./.exec!==id},{exec:id});var ad=io,od=H,sd=Ke,ud=En,cd=Yi,ld=L([].push),dd=function(e){var t=1==e,r=2==e,n=3==e,i=4==e,a=6==e,o=7==e,s=5==e||a;return function(u,c,l,d){for(var h,f,p=sd(u),g=od(p),y=ad(c,l),m=ud(g),v=0,_=d||cd,b=t?_(u,m):r||o?_(u,0):void 0;m>v;v++)if((s||v in g)&&(f=y(h=g[v],v,p),e))if(t)b[v]=f;else if(f)switch(e){case 3:return!0;case 5:return h;case 6:return v;case 2:ld(b,h)}else switch(e){case 4:return!1;case 7:ld(b,h)}return a?-1:n||i?i:b}},hd={forEach:dd(0),map:dd(1),filter:dd(2),some:dd(3),every:dd(4),find:dd(5),findIndex:dd(6),filterReject:dd(7)},fd=hd.map;di({target:"Array",proto:!0,forced:!qi("map")},{map:function(e){return fd(this,e,arguments.length>1?arguments[1]:void 0)}});var pd=Ke,gd=ll;di({target:"Object",stat:!0,forced:m((function(){gd(1)}))},{keys:function(e){return gd(pd(e))}});var yd=we,md=TypeError,vd=function(e,t){if(!delete e[t])throw md("Cannot delete property "+yd(t)+" of "+yd(e))},_d=mn,bd=En,Ad=_i,Ed=Array,Sd=Math.max,Td=function(e,t,r){for(var n=bd(e),i=_d(t,n),a=_d(void 0===r?n:r,n),o=Ed(Sd(a-i,0)),s=0;i<a;i++,s++)Ad(o,s,e[i]);return o.length=s,o},wd=Td,Cd=Math.floor,kd=function e(t,r){var n=t.length,i=Cd(n/2);return n<8?Id(t,r):$d(t,e(wd(t,0,i),r),e(wd(t,i),r),r)},Id=function(e,t){for(var r,n,i=e.length,a=1;a<i;){for(n=a,r=e[a];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==a++&&(e[n]=r)}return e},$d=function(e,t,r,n){for(var i=t.length,a=r.length,o=0,s=0;o<i||s<a;)e[o+s]=o<i&&s<a?n(t[o],r[s])<=0?t[o++]:r[s++]:o<i?t[o++]:r[s++];return e},Pd=kd,xd=m,Rd=function(e,t){var r=[][e];return!!r&&xd((function(){r.call(null,t||function(){return 1},1)}))},Od=se.match(/firefox\/(\d+)/i),Dd=!!Od&&+Od[1],Ld=/MSIE|Trident/.test(se),Md=se.match(/AppleWebKit\/(\d+)\./),Nd=!!Md&&+Md[1],Bd=di,Ud=L,Gd=$e,Vd=Ke,Fd=En,jd=vd,Hd=Xc,Zd=m,Wd=Pd,Kd=Rd,Xd=Dd,Yd=Ld,zd=pe,Jd=Nd,Qd=[],qd=Ud(Qd.sort),eh=Ud(Qd.push),th=Zd((function(){Qd.sort(void 0)})),rh=Zd((function(){Qd.sort(null)})),nh=Kd("sort"),ih=!Zd((function(){if(zd)return zd<70;if(!(Xd&&Xd>3)){if(Yd)return!0;if(Jd)return Jd<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)Qd.push({k:t+n,v:r})}for(Qd.sort((function(e,t){return t.v-e.v})),n=0;n<Qd.length;n++)t=Qd[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));Bd({target:"Array",proto:!0,forced:th||!rh||!nh||!ih},{sort:function(e){void 0!==e&&Gd(e);var t=Vd(this);if(ih)return void 0===e?qd(t):qd(t,e);var r,n,i=[],a=Fd(t);for(n=0;n<a;n++)n in t&&eh(i,t[n]);for(Wd(i,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:Hd(t)>Hd(r)?1:-1}}(e)),r=Fd(i),n=0;n<r;)t[n]=i[n++];for(;n<a;)jd(t,n++);return t}});var ah=v,oh=fi,sh=TypeError,uh=Object.getOwnPropertyDescriptor,ch=ah&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(EU){return EU instanceof TypeError}}(),lh=di,dh=Ke,hh=mn,fh=fn,ph=En,gh=ch?function(e,t){if(oh(e)&&!uh(e,"length").writable)throw sh("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},yh=gi,mh=Yi,vh=_i,_h=vd,bh=qi("splice"),Ah=Math.max,Eh=Math.min;lh({target:"Array",proto:!0,forced:!bh},{splice:function(e,t){var r,n,i,a,o,s,u=dh(this),c=ph(u),l=hh(e,c),d=arguments.length;for(0===d?r=n=0:1===d?(r=0,n=c-l):(r=d-2,n=Eh(Ah(fh(t),0),c-l)),yh(c+r-n),i=mh(u,n),a=0;a<n;a++)(o=l+a)in u&&vh(i,a,u[o]);if(i.length=n,r<n){for(a=l;a<c-n;a++)s=a+r,(o=a+n)in u?u[s]=u[o]:_h(u,s);for(a=c;a>c-n+r;a--)_h(u,a-1)}else if(r>n)for(a=c-n;a>l;a--)s=a+r-1,(o=a+n-1)in u?u[s]=u[o]:_h(u,s);for(a=0;a<r;a++)u[a+l]=arguments[a+2];return gh(u,c-n+r),i}});var Sh=di,Th=kn.indexOf,wh=Rd,Ch=L([].indexOf),kh=!!Ch&&1/Ch([1],1,-0)<0,Ih=wh("indexOf");Sh({target:"Array",proto:!0,forced:kh||!Ih},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return kh?Ch(this,e,t)||0:Th(this,e,t)}});var $h=ht,Ph=xl,xh=Ut.f,Rh=$h("unscopables"),Oh=Array.prototype;null==Oh[Rh]&&xh(Oh,Rh,{configurable:!0,value:Ph(null)});var Dh,Lh,Mh,Nh=function(e){Oh[Rh][e]=!0},Bh=!m((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Uh=ze,Gh=Q,Vh=Ke,Fh=Bh,jh=wr("IE_PROTO"),Hh=Object,Zh=Hh.prototype,Wh=Fh?Hh.getPrototypeOf:function(e){var t=Vh(e);if(Uh(t,jh))return t[jh];var r=t.constructor;return Gh(r)&&t instanceof r?r.prototype:t instanceof Hh?Zh:null},Kh=m,Xh=Q,Yh=te,zh=Wh,Jh=un,Qh=ht("iterator"),qh=!1;[].keys&&("next"in(Mh=[].keys())?(Lh=zh(zh(Mh)))!==Object.prototype&&(Dh=Lh):qh=!0),(!Yh(Dh)||Kh((function(){var e={};return Dh[Qh].call(e)!==e})))&&(Dh={}),Xh(Dh[Qh])||Jh(Dh,Qh,(function(){return this}));var ef={IteratorPrototype:Dh,BUGGY_SAFARI_ITERATORS:qh},tf=ef.IteratorPrototype,rf=xl,nf=$,af=Ra,of=Pu,sf=function(){return this},uf=function(e,t,r,n){var i=t+" Iterator";return e.prototype=rf(tf,{next:nf(+!n,r)}),af(e,i,!1),of[i]=sf,e},cf=di,lf=E,df=Q,hf=uf,ff=Wh,pf=Ia,gf=Ra,yf=ir,mf=un,vf=Pu,_f=dr.PROPER,bf=dr.CONFIGURABLE,Af=ef.IteratorPrototype,Ef=ef.BUGGY_SAFARI_ITERATORS,Sf=ht("iterator"),Tf="keys",wf="values",Cf="entries",kf=function(){return this},If=function(e,t,r,n,i,a,o){hf(r,t,n);var s,u,c,l=function(e){if(e===i&&g)return g;if(!Ef&&e in f)return f[e];switch(e){case Tf:case wf:case Cf:return function(){return new r(this,e)}}return function(){return new r(this)}},d=t+" Iterator",h=!1,f=e.prototype,p=f[Sf]||f["@@iterator"]||i&&f[i],g=!Ef&&p||l(i),y="Array"==t&&f.entries||p;if(y&&(s=ff(y.call(new e)))!==Object.prototype&&s.next&&(ff(s)!==Af&&(pf?pf(s,Af):df(s[Sf])||mf(s,Sf,kf)),gf(s,d,!0)),_f&&i==wf&&p&&p.name!==wf&&(bf?yf(f,"name",wf):(h=!0,g=function(){return lf(p,this)})),i)if(u={values:l(wf),keys:a?g:l(Tf),entries:l(Cf)},o)for(c in u)(Ef||h||!(c in f))&&mf(f,c,u[c]);else cf({target:t,proto:!0,forced:Ef||h},u);return f[Sf]!==g&&mf(f,Sf,g,{name:i}),vf[t]=g,u},$f=J,Pf=Nh,xf=Pu,Rf=Hr,Of=Ut.f,Df=If,Lf=v,Mf="Array Iterator",Nf=Rf.set,Bf=Rf.getterFor(Mf),Uf=Df(Array,"Array",(function(e,t){Nf(this,{type:Mf,target:$f(e),index:0,kind:t})}),(function(){var e=Bf(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values"),Gf=xf.Arguments=xf.Array;if(Pf("keys"),Pf("values"),Pf("entries"),Lf&&"values"!==Gf.name)try{Of(Gf,"name",{value:"values"})}catch(EU){}var Vf=L,Ff=fn,jf=Xc,Hf=X,Zf=Vf("".charAt),Wf=Vf("".charCodeAt),Kf=Vf("".slice),Xf=function(e){return function(t,r){var n,i,a=jf(Hf(t)),o=Ff(r),s=a.length;return o<0||o>=s?e?"":void 0:(n=Wf(a,o))<55296||n>56319||o+1===s||(i=Wf(a,o+1))<56320||i>57343?e?Zf(a,o):n:e?Kf(a,o,o+2):i-56320+(n-55296<<10)+65536}},Yf={codeAt:Xf(!1),charAt:Xf(!0)},zf=Yf.charAt,Jf=Xc,Qf=Hr,qf=If,ep="String Iterator",tp=Qf.set,rp=Qf.getterFor(ep);qf(String,"String",(function(e){tp(this,{type:ep,string:Jf(e),index:0})}),(function(){var e,t=rp(this),r=t.string,n=t.index;return n>=r.length?{value:void 0,done:!0}:(e=zf(r,n),t.index+=e.length,{value:e,done:!1})}));var np={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},ip=kt("span").classList,ap=ip&&ip.constructor&&ip.constructor.prototype,op=ap===Object.prototype?void 0:ap,sp=g,up=np,cp=op,lp=Uf,dp=ir,hp=ht,fp=hp("iterator"),pp=hp("toStringTag"),gp=lp.values,yp=function(e,t){if(e){if(e[fp]!==gp)try{dp(e,fp,gp)}catch(EU){e[fp]=gp}if(e[pp]||dp(e,pp,t),up[t])for(var r in lp)if(e[r]!==lp[r])try{dp(e,r,lp[r])}catch(EU){e[r]=lp[r]}}};for(var mp in up)yp(sp[mp]&&sp[mp].prototype,mp);yp(cp,"DOMTokenList");var vp=m,_p=ht("iterator"),bp=!vp((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[_p]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://Ñ‚ÐµÑÑ‚").host||"#%D0%B1"!==new URL("http://a#Ð±").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host})),Ap=ar.exports,Ep=Ut,Sp=function(e,t,r){return r.get&&Ap(r.get,t,{getter:!0}),r.set&&Ap(r.set,t,{setter:!0}),Ep.f(e,t,r)},Tp=v,wp=L,Cp=E,kp=m,Ip=ll,$p=Nn,Pp=S,xp=Ke,Rp=H,Op=Object.assign,Dp=Object.defineProperty,Lp=wp([].concat),Mp=!Op||kp((function(){if(Tp&&1!==Op({b:1},Op(Dp({},"a",{enumerable:!0,get:function(){Dp(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach((function(e){t[e]=e})),7!=Op({},e)[r]||Ip(Op({},t)).join("")!=n}))?function(e,t){for(var r=xp(e),n=arguments.length,i=1,a=$p.f,o=Pp.f;n>i;)for(var s,u=Rp(arguments[i++]),c=a?Lp(Ip(u),a(u)):Ip(u),l=c.length,d=0;l>d;)s=c[d++],Tp&&!Cp(o,u,s)||(r[s]=u[s]);return r}:Op,Np=Ht,Bp=Ju,Up=io,Gp=E,Vp=Ke,Fp=function(e,t,r,n){try{return n?t(Np(r)[0],r[1]):t(r)}catch(EU){Bp(e,"throw",EU)}},jp=Du,Hp=Fi,Zp=En,Wp=_i,Kp=Ku,Xp=Gu,Yp=Array,zp=function(e){var t=Vp(e),r=Hp(this),n=arguments.length,i=n>1?arguments[1]:void 0,a=void 0!==i;a&&(i=Up(i,n>2?arguments[2]:void 0));var o,s,u,c,l,d,h=Xp(t),f=0;if(!h||this===Yp&&jp(h))for(o=Zp(t),s=r?new this(o):Yp(o);o>f;f++)d=a?i(t[f],f):t[f],Wp(s,f,d);else for(l=(c=Kp(t,h)).next,s=r?new this:[];!(u=Gp(l,c)).done;f++)d=a?Fp(c,i,[u.value,f],!0):u.value,Wp(s,f,d);return s.length=f,s},Jp=L,Qp=2147483647,qp=/[^\0-\u007E]/,eg=/[.\u3002\uFF0E\uFF61]/g,tg="Overflow: input needs wider integers to process",rg=RangeError,ng=Jp(eg.exec),ig=Math.floor,ag=String.fromCharCode,og=Jp("".charCodeAt),sg=Jp([].join),ug=Jp([].push),cg=Jp("".replace),lg=Jp("".split),dg=Jp("".toLowerCase),hg=function(e){return e+22+75*(e<26)},fg=function(e,t,r){var n=0;for(e=r?ig(e/700):e>>1,e+=ig(e/t);e>455;)e=ig(e/35),n+=36;return ig(n+36*e/(e+38))},pg=function(e){var t,r,n=[],i=(e=function(e){for(var t=[],r=0,n=e.length;r<n;){var i=og(e,r++);if(i>=55296&&i<=56319&&r<n){var a=og(e,r++);56320==(64512&a)?ug(t,((1023&i)<<10)+(1023&a)+65536):(ug(t,i),r--)}else ug(t,i)}return t}(e)).length,a=128,o=0,s=72;for(t=0;t<e.length;t++)(r=e[t])<128&&ug(n,ag(r));var u=n.length,c=u;for(u&&ug(n,"-");c<i;){var l=Qp;for(t=0;t<e.length;t++)(r=e[t])>=a&&r<l&&(l=r);var d=c+1;if(l-a>ig((Qp-o)/d))throw rg(tg);for(o+=(l-a)*d,a=l,t=0;t<e.length;t++){if((r=e[t])<a&&++o>Qp)throw rg(tg);if(r==a){for(var h=o,f=36;;){var p=f<=s?1:f>=s+26?26:f-s;if(h<p)break;var g=h-p,y=36-p;ug(n,ag(hg(p+g%y))),h=ig(g/y),f+=36}ug(n,ag(hg(h))),s=fg(o,d,c==u),o=0,c++}}o++,a++}return sg(n,"")},gg=un,yg=function(e,t,r){for(var n in t)gg(e,n,t[n],r);return e},mg=di,vg=g,_g=E,bg=L,Ag=v,Eg=bp,Sg=un,Tg=yg,wg=Ra,Cg=uf,kg=Hr,Ig=Ga,$g=Q,Pg=ze,xg=io,Rg=Ii,Og=Ht,Dg=te,Lg=Xc,Mg=xl,Ng=$,Bg=Ku,Ug=Gu,Gg=uo,Vg=Pd,Fg=ht("iterator"),jg="URLSearchParams",Hg="URLSearchParamsIterator",Zg=kg.set,Wg=kg.getterFor(jg),Kg=kg.getterFor(Hg),Xg=Object.getOwnPropertyDescriptor,Yg=function(e){if(!Ag)return vg[e];var t=Xg(vg,e);return t&&t.value},zg=Yg("fetch"),Jg=Yg("Request"),Qg=Yg("Headers"),qg=Jg&&Jg.prototype,ey=Qg&&Qg.prototype,ty=vg.RegExp,ry=vg.TypeError,ny=vg.decodeURIComponent,iy=vg.encodeURIComponent,ay=bg("".charAt),oy=bg([].join),sy=bg([].push),uy=bg("".replace),cy=bg([].shift),ly=bg([].splice),dy=bg("".split),hy=bg("".slice),fy=/\+/g,py=Array(4),gy=function(e){return py[e-1]||(py[e-1]=ty("((?:%[\\da-f]{2}){"+e+"})","gi"))},yy=function(e){try{return ny(e)}catch(EU){return e}},my=function(e){var t=uy(e,fy," "),r=4;try{return ny(t)}catch(EU){for(;r;)t=uy(t,gy(r--),yy);return t}},vy=/[!'()~]|%20/g,_y={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},by=function(e){return _y[e]},Ay=function(e){return uy(iy(e),vy,by)},Ey=Cg((function(e,t){Zg(this,{type:Hg,iterator:Bg(Wg(e).entries),kind:t})}),"Iterator",(function(){var e=Kg(this),t=e.kind,r=e.iterator.next(),n=r.value;return r.done||(r.value="keys"===t?n.key:"values"===t?n.value:[n.key,n.value]),r}),!0),Sy=function(e){this.entries=[],this.url=null,void 0!==e&&(Dg(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===ay(e,0)?hy(e,1):e:Lg(e)))};Sy.prototype={type:jg,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,n,i,a,o,s,u=Ug(e);if(u)for(r=(t=Bg(e,u)).next;!(n=_g(r,t)).done;){if(a=(i=Bg(Og(n.value))).next,(o=_g(a,i)).done||(s=_g(a,i)).done||!_g(a,i).done)throw ry("Expected sequence with length 2");sy(this.entries,{key:Lg(o.value),value:Lg(s.value)})}else for(var c in e)Pg(e,c)&&sy(this.entries,{key:c,value:Lg(e[c])})},parseQuery:function(e){if(e)for(var t,r,n=dy(e,"&"),i=0;i<n.length;)(t=n[i++]).length&&(r=dy(t,"="),sy(this.entries,{key:my(cy(r)),value:my(oy(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],n=0;n<t.length;)e=t[n++],sy(r,Ay(e.key)+"="+Ay(e.value));return oy(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Ty=function(){Ig(this,wy),Zg(this,new Sy(arguments.length>0?arguments[0]:void 0))},wy=Ty.prototype;if(Tg(wy,{append:function(e,t){Gg(arguments.length,2);var r=Wg(this);sy(r.entries,{key:Lg(e),value:Lg(t)}),r.updateURL()},delete:function(e){Gg(arguments.length,1);for(var t=Wg(this),r=t.entries,n=Lg(e),i=0;i<r.length;)r[i].key===n?ly(r,i,1):i++;t.updateURL()},get:function(e){Gg(arguments.length,1);for(var t=Wg(this).entries,r=Lg(e),n=0;n<t.length;n++)if(t[n].key===r)return t[n].value;return null},getAll:function(e){Gg(arguments.length,1);for(var t=Wg(this).entries,r=Lg(e),n=[],i=0;i<t.length;i++)t[i].key===r&&sy(n,t[i].value);return n},has:function(e){Gg(arguments.length,1);for(var t=Wg(this).entries,r=Lg(e),n=0;n<t.length;)if(t[n++].key===r)return!0;return!1},set:function(e,t){Gg(arguments.length,1);for(var r,n=Wg(this),i=n.entries,a=!1,o=Lg(e),s=Lg(t),u=0;u<i.length;u++)(r=i[u]).key===o&&(a?ly(i,u--,1):(a=!0,r.value=s));a||sy(i,{key:o,value:s}),n.updateURL()},sort:function(){var e=Wg(this);Vg(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,r=Wg(this).entries,n=xg(e,arguments.length>1?arguments[1]:void 0),i=0;i<r.length;)n((t=r[i++]).value,t.key,this)},keys:function(){return new Ey(this,"keys")},values:function(){return new Ey(this,"values")},entries:function(){return new Ey(this,"entries")}},{enumerable:!0}),Sg(wy,Fg,wy.entries,{name:"entries"}),Sg(wy,"toString",(function(){return Wg(this).serialize()}),{enumerable:!0}),wg(Ty,jg),mg({global:!0,constructor:!0,forced:!Eg},{URLSearchParams:Ty}),!Eg&&$g(Qg)){var Cy=bg(ey.has),ky=bg(ey.set),Iy=function(e){if(Dg(e)){var t,r=e.body;if(Rg(r)===jg)return t=e.headers?new Qg(e.headers):new Qg,Cy(t,"content-type")||ky(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Mg(e,{body:Ng(0,Lg(r)),headers:Ng(0,t)})}return e};if($g(zg)&&mg({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return zg(e,arguments.length>1?Iy(arguments[1]):{})}}),$g(Jg)){var $y=function(e){return Ig(this,qg),new Jg(e,arguments.length>1?Iy(arguments[1]):{})};qg.constructor=$y,$y.prototype=qg,mg({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:$y})}}var Py,xy=di,Ry=v,Oy=bp,Dy=g,Ly=io,My=L,Ny=un,By=Sp,Uy=Ga,Gy=ze,Vy=Mp,Fy=zp,jy=Td,Hy=Yf.codeAt,Zy=function(e){var t,r,n=[],i=lg(cg(dg(e),eg,"."),".");for(t=0;t<i.length;t++)r=i[t],ug(n,ng(qp,r)?"xn--"+pg(r):r);return sg(n,".")},Wy=Xc,Ky=Ra,Xy=uo,Yy={URLSearchParams:Ty,getState:Wg},zy=Hr,Jy=zy.set,Qy=zy.getterFor("URL"),qy=Yy.URLSearchParams,em=Yy.getState,tm=Dy.URL,rm=Dy.TypeError,nm=Dy.parseInt,im=Math.floor,am=Math.pow,om=My("".charAt),sm=My(/./.exec),um=My([].join),cm=My(1..toString),lm=My([].pop),dm=My([].push),hm=My("".replace),fm=My([].shift),pm=My("".split),gm=My("".slice),ym=My("".toLowerCase),mm=My([].unshift),vm="Invalid scheme",_m="Invalid host",bm="Invalid port",Am=/[a-z]/i,Em=/[\d+-.a-z]/i,Sm=/\d/,Tm=/^0x/i,wm=/^[0-7]+$/,Cm=/^\d+$/,km=/^[\da-f]+$/i,Im=/[\0\t\n\r #%/:<>?@[\\\]^|]/,$m=/[\0\t\n\r #/:<>?@[\\\]^|]/,Pm=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,xm=/[\t\n\r]/g,Rm=function(e){var t,r,n,i;if("number"==typeof e){for(t=[],r=0;r<4;r++)mm(t,e%256),e=im(e/256);return um(t,".")}if("object"==_typeof$7(e)){for(t="",n=function(e){for(var t=null,r=1,n=null,i=0,a=0;a<8;a++)0!==e[a]?(i>r&&(t=n,r=i),n=null,i=0):(null===n&&(n=a),++i);return i>r&&(t=n,r=i),t}(e),r=0;r<8;r++)i&&0===e[r]||(i&&(i=!1),n===r?(t+=r?":":"::",i=!0):(t+=cm(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},Om={},Dm=Vy({},Om,{" ":1,'"':1,"<":1,">":1,"`":1}),Lm=Vy({},Dm,{"#":1,"?":1,"{":1,"}":1}),Mm=Vy({},Lm,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Nm=function(e,t){var r=Hy(e,0);return r>32&&r<127&&!Gy(t,e)?e:encodeURIComponent(e)},Bm={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Um=function(e,t){var r;return 2==e.length&&sm(Am,om(e,0))&&(":"==(r=om(e,1))||!t&&"|"==r)},Gm=function(e){var t;return e.length>1&&Um(gm(e,0,2))&&(2==e.length||"/"===(t=om(e,2))||"\\"===t||"?"===t||"#"===t)},Vm=function(e){return"."===e||"%2e"===ym(e)},Fm={},jm={},Hm={},Zm={},Wm={},Km={},Xm={},Ym={},zm={},Jm={},Qm={},qm={},ev={},tv={},rv={},nv={},iv={},av={},ov={},sv={},uv={},cv=function e(t,r,n){var i,a,o,s=Wy(t);if(r){if(a=this.parse(s))throw rm(a);this.searchParams=null}else{if(void 0!==n&&(i=new e(n,!0)),a=this.parse(s,null,i))throw rm(a);(o=em(new qy)).bindURL(this),this.searchParams=o}};cv.prototype={type:"URL",parse:function(e,t,r){var n,i,a,o,s,u=this,c=t||Fm,l=0,d="",h=!1,f=!1,p=!1;for(e=Wy(e),t||(u.scheme="",u.username="",u.password="",u.host=null,u.port=null,u.path=[],u.query=null,u.fragment=null,u.cannotBeABaseURL=!1,e=hm(e,Pm,"")),e=hm(e,xm,""),n=Fy(e);l<=n.length;){switch(i=n[l],c){case Fm:if(!i||!sm(Am,i)){if(t)return vm;c=Hm;continue}d+=ym(i),c=jm;break;case jm:if(i&&(sm(Em,i)||"+"==i||"-"==i||"."==i))d+=ym(i);else{if(":"!=i){if(t)return vm;d="",c=Hm,l=0;continue}if(t&&(u.isSpecial()!=Gy(Bm,d)||"file"==d&&(u.includesCredentials()||null!==u.port)||"file"==u.scheme&&!u.host))return;if(u.scheme=d,t)return void(u.isSpecial()&&Bm[u.scheme]==u.port&&(u.port=null));d="","file"==u.scheme?c=tv:u.isSpecial()&&r&&r.scheme==u.scheme?c=Zm:u.isSpecial()?c=Ym:"/"==n[l+1]?(c=Wm,l++):(u.cannotBeABaseURL=!0,dm(u.path,""),c=ov)}break;case Hm:if(!r||r.cannotBeABaseURL&&"#"!=i)return vm;if(r.cannotBeABaseURL&&"#"==i){u.scheme=r.scheme,u.path=jy(r.path),u.query=r.query,u.fragment="",u.cannotBeABaseURL=!0,c=uv;break}c="file"==r.scheme?tv:Km;continue;case Zm:if("/"!=i||"/"!=n[l+1]){c=Km;continue}c=zm,l++;break;case Wm:if("/"==i){c=Jm;break}c=av;continue;case Km:if(u.scheme=r.scheme,i==Py)u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,u.path=jy(r.path),u.query=r.query;else if("/"==i||"\\"==i&&u.isSpecial())c=Xm;else if("?"==i)u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,u.path=jy(r.path),u.query="",c=sv;else{if("#"!=i){u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,u.path=jy(r.path),u.path.length--,c=av;continue}u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,u.path=jy(r.path),u.query=r.query,u.fragment="",c=uv}break;case Xm:if(!u.isSpecial()||"/"!=i&&"\\"!=i){if("/"!=i){u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,c=av;continue}c=Jm}else c=zm;break;case Ym:if(c=zm,"/"!=i||"/"!=om(d,l+1))continue;l++;break;case zm:if("/"!=i&&"\\"!=i){c=Jm;continue}break;case Jm:if("@"==i){h&&(d="%40"+d),h=!0,a=Fy(d);for(var g=0;g<a.length;g++){var y=a[g];if(":"!=y||p){var m=Nm(y,Mm);p?u.password+=m:u.username+=m}else p=!0}d=""}else if(i==Py||"/"==i||"?"==i||"#"==i||"\\"==i&&u.isSpecial()){if(h&&""==d)return"Invalid authority";l-=Fy(d).length+1,d="",c=Qm}else d+=i;break;case Qm:case qm:if(t&&"file"==u.scheme){c=nv;continue}if(":"!=i||f){if(i==Py||"/"==i||"?"==i||"#"==i||"\\"==i&&u.isSpecial()){if(u.isSpecial()&&""==d)return _m;if(t&&""==d&&(u.includesCredentials()||null!==u.port))return;if(o=u.parseHost(d))return o;if(d="",c=iv,t)return;continue}"["==i?f=!0:"]"==i&&(f=!1),d+=i}else{if(""==d)return _m;if(o=u.parseHost(d))return o;if(d="",c=ev,t==qm)return}break;case ev:if(!sm(Sm,i)){if(i==Py||"/"==i||"?"==i||"#"==i||"\\"==i&&u.isSpecial()||t){if(""!=d){var v=nm(d,10);if(v>65535)return bm;u.port=u.isSpecial()&&v===Bm[u.scheme]?null:v,d=""}if(t)return;c=iv;continue}return bm}d+=i;break;case tv:if(u.scheme="file","/"==i||"\\"==i)c=rv;else{if(!r||"file"!=r.scheme){c=av;continue}if(i==Py)u.host=r.host,u.path=jy(r.path),u.query=r.query;else if("?"==i)u.host=r.host,u.path=jy(r.path),u.query="",c=sv;else{if("#"!=i){Gm(um(jy(n,l),""))||(u.host=r.host,u.path=jy(r.path),u.shortenPath()),c=av;continue}u.host=r.host,u.path=jy(r.path),u.query=r.query,u.fragment="",c=uv}}break;case rv:if("/"==i||"\\"==i){c=nv;break}r&&"file"==r.scheme&&!Gm(um(jy(n,l),""))&&(Um(r.path[0],!0)?dm(u.path,r.path[0]):u.host=r.host),c=av;continue;case nv:if(i==Py||"/"==i||"\\"==i||"?"==i||"#"==i){if(!t&&Um(d))c=av;else if(""==d){if(u.host="",t)return;c=iv}else{if(o=u.parseHost(d))return o;if("localhost"==u.host&&(u.host=""),t)return;d="",c=iv}continue}d+=i;break;case iv:if(u.isSpecial()){if(c=av,"/"!=i&&"\\"!=i)continue}else if(t||"?"!=i)if(t||"#"!=i){if(i!=Py&&(c=av,"/"!=i))continue}else u.fragment="",c=uv;else u.query="",c=sv;break;case av:if(i==Py||"/"==i||"\\"==i&&u.isSpecial()||!t&&("?"==i||"#"==i)){if(".."===(s=ym(s=d))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(u.shortenPath(),"/"==i||"\\"==i&&u.isSpecial()||dm(u.path,"")):Vm(d)?"/"==i||"\\"==i&&u.isSpecial()||dm(u.path,""):("file"==u.scheme&&!u.path.length&&Um(d)&&(u.host&&(u.host=""),d=om(d,0)+":"),dm(u.path,d)),d="","file"==u.scheme&&(i==Py||"?"==i||"#"==i))for(;u.path.length>1&&""===u.path[0];)fm(u.path);"?"==i?(u.query="",c=sv):"#"==i&&(u.fragment="",c=uv)}else d+=Nm(i,Lm);break;case ov:"?"==i?(u.query="",c=sv):"#"==i?(u.fragment="",c=uv):i!=Py&&(u.path[0]+=Nm(i,Om));break;case sv:t||"#"!=i?i!=Py&&("'"==i&&u.isSpecial()?u.query+="%27":u.query+="#"==i?"%23":Nm(i,Om)):(u.fragment="",c=uv);break;case uv:i!=Py&&(u.fragment+=Nm(i,Dm))}l++}},parseHost:function(e){var t,r,n;if("["==om(e,0)){if("]"!=om(e,e.length-1))return _m;if(!(t=function(e){var t,r,n,i,a,o,s,u=[0,0,0,0,0,0,0,0],c=0,l=null,d=0,h=function(){return om(e,d)};if(":"==h()){if(":"!=om(e,1))return;d+=2,l=++c}for(;h();){if(8==c)return;if(":"!=h()){for(t=r=0;r<4&&sm(km,h());)t=16*t+nm(h(),16),d++,r++;if("."==h()){if(0==r)return;if(d-=r,c>6)return;for(n=0;h();){if(i=null,n>0){if(!("."==h()&&n<4))return;d++}if(!sm(Sm,h()))return;for(;sm(Sm,h());){if(a=nm(h(),10),null===i)i=a;else{if(0==i)return;i=10*i+a}if(i>255)return;d++}u[c]=256*u[c]+i,2!=++n&&4!=n||c++}if(4!=n)return;break}if(":"==h()){if(d++,!h())return}else if(h())return;u[c++]=t}else{if(null!==l)return;d++,l=++c}}if(null!==l)for(o=c-l,c=7;0!=c&&o>0;)s=u[c],u[c--]=u[l+o-1],u[l+--o]=s;else if(8!=c)return;return u}(gm(e,1,-1))))return _m;this.host=t}else if(this.isSpecial()){if(e=Zy(e),sm(Im,e))return _m;if(null===(t=function(e){var t,r,n,i,a,o,s,u=pm(e,".");if(u.length&&""==u[u.length-1]&&u.length--,(t=u.length)>4)return e;for(r=[],n=0;n<t;n++){if(""==(i=u[n]))return e;if(a=10,i.length>1&&"0"==om(i,0)&&(a=sm(Tm,i)?16:8,i=gm(i,8==a?1:2)),""===i)o=0;else{if(!sm(10==a?Cm:8==a?wm:km,i))return e;o=nm(i,a)}dm(r,o)}for(n=0;n<t;n++)if(o=r[n],n==t-1){if(o>=am(256,5-t))return null}else if(o>255)return null;for(s=lm(r),n=0;n<r.length;n++)s+=r[n]*am(256,3-n);return s}(e)))return _m;this.host=t}else{if(sm($m,e))return _m;for(t="",r=Fy(e),n=0;n<r.length;n++)t+=Nm(r[n],Om);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return Gy(Bm,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&Um(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,n=e.password,i=e.host,a=e.port,o=e.path,s=e.query,u=e.fragment,c=t+":";return null!==i?(c+="//",e.includesCredentials()&&(c+=r+(n?":"+n:"")+"@"),c+=Rm(i),null!==a&&(c+=":"+a)):"file"==t&&(c+="//"),c+=e.cannotBeABaseURL?o[0]:o.length?"/"+um(o,"/"):"",null!==s&&(c+="?"+s),null!==u&&(c+="#"+u),c},setHref:function(e){var t=this.parse(e);if(t)throw rm(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new lv(e.path[0]).origin}catch(EU){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+Rm(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Wy(e)+":",Fm)},getUsername:function(){return this.username},setUsername:function(e){var t=Fy(Wy(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=Nm(t[r],Mm)}},getPassword:function(){return this.password},setPassword:function(e){var t=Fy(Wy(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=Nm(t[r],Mm)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?Rm(e):Rm(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Qm)},getHostname:function(){var e=this.host;return null===e?"":Rm(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,qm)},getPort:function(){var e=this.port;return null===e?"":Wy(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=Wy(e))?this.port=null:this.parse(e,ev))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+um(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,iv))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=Wy(e))?this.query=null:("?"==om(e,0)&&(e=gm(e,1)),this.query="",this.parse(e,sv)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=Wy(e))?("#"==om(e,0)&&(e=gm(e,1)),this.fragment="",this.parse(e,uv)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var lv=function(e){var t=Uy(this,dv),r=Xy(arguments.length,1)>1?arguments[1]:void 0,n=Jy(t,new cv(e,!1,r));Ry||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},dv=lv.prototype,hv=function(e,t){return{get:function(){return Qy(this)[e]()},set:t&&function(e){return Qy(this)[t](e)},configurable:!0,enumerable:!0}};if(Ry&&(By(dv,"href",hv("serialize","setHref")),By(dv,"origin",hv("getOrigin")),By(dv,"protocol",hv("getProtocol","setProtocol")),By(dv,"username",hv("getUsername","setUsername")),By(dv,"password",hv("getPassword","setPassword")),By(dv,"host",hv("getHost","setHost")),By(dv,"hostname",hv("getHostname","setHostname")),By(dv,"port",hv("getPort","setPort")),By(dv,"pathname",hv("getPathname","setPathname")),By(dv,"search",hv("getSearch","setSearch")),By(dv,"searchParams",hv("getSearchParams")),By(dv,"hash",hv("getHash","setHash"))),Ny(dv,"toJSON",(function(){return Qy(this).serialize()}),{enumerable:!0}),Ny(dv,"toString",(function(){return Qy(this).serialize()}),{enumerable:!0}),tm){var fv=tm.createObjectURL,pv=tm.revokeObjectURL;fv&&Ny(lv,"createObjectURL",Ly(fv,tm)),pv&&Ny(lv,"revokeObjectURL",Ly(pv,tm))}Ky(lv,"URL"),xy({global:!0,constructor:!0,forced:!Oy,sham:!Ry},{URL:lv});var gv=L,yv=un,mv=id,vv=m,_v=ht,bv=ir,Av=_v("species"),Ev=RegExp.prototype,Sv=function(e,t,r,n){var i=_v(e),a=!vv((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),o=a&&!vv((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[Av]=function(){return r},r.flags="",r[i]=/./[i]),r.exec=function(){return t=!0,null},r[i](""),!t}));if(!a||!o||r){var s=gv(/./[i]),u=t(i,""[e],(function(e,t,r,n,i){var o=gv(e),u=t.exec;return u===mv||u===Ev.exec?a&&!i?{done:!0,value:s(t,r,n)}:{done:!0,value:o(r,t,n)}:{done:!1}}));yv(String.prototype,e,u[0]),yv(Ev,i,u[1])}n&&bv(Ev[i],"sham",!0)},Tv=Yf.charAt,wv=function(e,t,r){return t+(r?Tv(e,t).length:1)},Cv=L,kv=Ke,Iv=Math.floor,$v=Cv("".charAt),Pv=Cv("".replace),xv=Cv("".slice),Rv=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Ov=/\$([$&'`]|\d{1,2})/g,Dv=E,Lv=Ht,Mv=Q,Nv=U,Bv=id,Uv=TypeError,Gv=function(e,t){var r=e.exec;if(Mv(r)){var n=Dv(r,e,t);return null!==n&&Lv(n),n}if("RegExp"===Nv(e))return Dv(Bv,e,t);throw Uv("RegExp#exec called on incompatible receiver")},Vv=eo,Fv=E,jv=L,Hv=Sv,Zv=m,Wv=Ht,Kv=Q,Xv=Z,Yv=fn,zv=bn,Jv=Xc,Qv=X,qv=wv,e_=Re,t_=function(e,t,r,n,i,a){var o=r+e.length,s=n.length,u=Ov;return void 0!==i&&(i=kv(i),u=Rv),Pv(a,u,(function(a,u){var c;switch($v(u,0)){case"$":return"$";case"&":return e;case"`":return xv(t,0,r);case"'":return xv(t,o);case"<":c=i[xv(u,1,-1)];break;default:var l=+u;if(0===l)return a;if(l>s){var d=Iv(l/10);return 0===d?a:d<=s?void 0===n[d-1]?$v(u,1):n[d-1]+$v(u,1):a}c=n[l-1]}return void 0===c?"":c}))},r_=Gv,n_=ht("replace"),i_=Math.max,a_=Math.min,o_=jv([].concat),s_=jv([].push),u_=jv("".indexOf),c_=jv("".slice),l_="$0"==="a".replace(/./,"$0"),d_=!!/./[n_]&&""===/./[n_]("a","$0");Hv("replace",(function(e,t,r){var n=d_?"$":"$0";return[function(e,r){var n=Qv(this),i=Xv(e)?void 0:e_(e,n_);return i?Fv(i,e,n,r):Fv(t,Jv(n),e,r)},function(e,i){var a=Wv(this),o=Jv(e);if("string"==typeof i&&-1===u_(i,n)&&-1===u_(i,"$<")){var s=r(t,a,o,i);if(s.done)return s.value}var u=Kv(i);u||(i=Jv(i));var c=a.global;if(c){var l=a.unicode;a.lastIndex=0}for(var d=[];;){var h=r_(a,o);if(null===h)break;if(s_(d,h),!c)break;""===Jv(h[0])&&(a.lastIndex=qv(o,zv(a.lastIndex),l))}for(var f,p="",g=0,y=0;y<d.length;y++){for(var m=Jv((h=d[y])[0]),v=i_(a_(Yv(h.index),o.length),0),_=[],b=1;b<h.length;b++)s_(_,void 0===(f=h[b])?f:String(f));var A=h.groups;if(u){var E=o_([m],_,v,o);void 0!==A&&s_(E,A);var S=Jv(Vv(i,void 0,E))}else S=t_(m,o,v,_,A,i);v>=g&&(p+=c_(o,g,v)+S,g=v+m.length)}return p+c_(o,g)}]}),!!Zv((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!l_||d_);var h_=E,f_=Ht,p_=Z,g_=bn,y_=Xc,m_=X,v_=Re,__=wv,b_=Gv;Sv("match",(function(e,t,r){return[function(t){var r=m_(this),n=p_(t)?void 0:v_(t,e);return n?h_(n,t,r):new RegExp(t)[e](y_(r))},function(e){var n=f_(this),i=y_(e),a=r(t,n,i);if(a.done)return a.value;if(!n.global)return b_(n,i);var o=n.unicode;n.lastIndex=0;for(var s,u=[],c=0;null!==(s=b_(n,i));){var l=y_(s[0]);u[c]=l,""===l&&(n.lastIndex=__(i,g_(n.lastIndex),o)),c++}return 0===c?null:u}]}));var A_="\t\n\v\f\r Â áš€â€€â€â€‚â€ƒâ€„â€…â€†â€‡â€ˆâ€‰â€Šâ€¯âŸã€€\u2028\u2029\ufeff",E_=X,S_=Xc,T_=L("".replace),w_="[\t\n\v\f\r Â áš€â€€â€â€‚â€ƒâ€„â€…â€†â€‡â€ˆâ€‰â€Šâ€¯âŸã€€\u2028\u2029\ufeff]",C_=RegExp("^"+w_+w_+"*"),k_=RegExp(w_+w_+"*$"),I_=function(e){return function(t){var r=S_(E_(t));return 1&e&&(r=T_(r,C_,"")),2&e&&(r=T_(r,k_,"")),r}},$_={start:I_(1),end:I_(2),trim:I_(3)},P_=g,x_=m,R_=L,O_=Xc,D_=$_.trim,L_=A_,M_=P_.parseInt,N_=P_.Symbol,B_=N_&&N_.iterator,U_=/^[+-]?0x/i,G_=R_(U_.exec),V_=8!==M_(L_+"08")||22!==M_(L_+"0x16")||B_&&!x_((function(){M_(Object(B_))}))?function(e,t){var r=D_(O_(e));return M_(r,t>>>0||(G_(U_,r)?16:10))}:M_;di({global:!0,forced:parseInt!=V_},{parseInt:V_});var F_=Mp;di({target:"Object",stat:!0,arity:2,forced:Object.assign!==F_},{assign:F_});var j_="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,H_=fn,Z_=bn,W_=RangeError,K_=function(e){if(void 0===e)return 0;var t=H_(e),r=Z_(t);if(t!==r)throw W_("Wrong length or index");return r},X_=Array,Y_=Math.abs,z_=Math.pow,J_=Math.floor,Q_=Math.log,q_=Math.LN2,eb=Ke,tb=mn,rb=En,nb=function(e){for(var t=eb(this),r=rb(t),n=arguments.length,i=tb(n>1?arguments[1]:void 0,r),a=n>2?arguments[2]:void 0,o=void 0===a?r:tb(a,r);o>i;)t[i++]=e;return t},ib=g,ab=L,ob=v,sb=j_,ub=dr,cb=ir,lb=yg,db=m,hb=Ga,fb=fn,pb=bn,gb=K_,yb={pack:function(e,t,r){var n,i,a,o=X_(r),s=8*r-t-1,u=(1<<s)-1,c=u>>1,l=23===t?z_(2,-24)-z_(2,-77):0,d=e<0||0===e&&1/e<0?1:0,h=0;for((e=Y_(e))!=e||e===1/0?(i=e!=e?1:0,n=u):(n=J_(Q_(e)/q_),e*(a=z_(2,-n))<1&&(n--,a*=2),(e+=n+c>=1?l/a:l*z_(2,1-c))*a>=2&&(n++,a/=2),n+c>=u?(i=0,n=u):n+c>=1?(i=(e*a-1)*z_(2,t),n+=c):(i=e*z_(2,c-1)*z_(2,t),n=0));t>=8;)o[h++]=255&i,i/=256,t-=8;for(n=n<<t|i,s+=t;s>0;)o[h++]=255&n,n/=256,s-=8;return o[--h]|=128*d,o},unpack:function(e,t){var r,n=e.length,i=8*n-t-1,a=(1<<i)-1,o=a>>1,s=i-7,u=n-1,c=e[u--],l=127&c;for(c>>=7;s>0;)l=256*l+e[u--],s-=8;for(r=l&(1<<-s)-1,l>>=-s,s+=t;s>0;)r=256*r+e[u--],s-=8;if(0===l)l=1-o;else{if(l===a)return r?NaN:c?-1/0:1/0;r+=z_(2,t),l-=o}return(c?-1:1)*r*z_(2,l-t)}},mb=Wh,vb=Ia,_b=cn.f,bb=Ut.f,Ab=nb,Eb=Td,Sb=Ra,Tb=ub.PROPER,wb=ub.CONFIGURABLE,Cb=Hr.get,kb=Hr.set,Ib="ArrayBuffer",$b="DataView",Pb="Wrong index",xb=ib.ArrayBuffer,Rb=xb,Ob=Rb&&Rb.prototype,Db=ib.DataView,Lb=Db&&Db.prototype,Mb=Object.prototype,Nb=ib.Array,Bb=ib.RangeError,Ub=ab(Ab),Gb=ab([].reverse),Vb=yb.pack,Fb=yb.unpack,jb=function(e){return[255&e]},Hb=function(e){return[255&e,e>>8&255]},Zb=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Wb=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},Kb=function(e){return Vb(e,23,4)},Xb=function(e){return Vb(e,52,8)},Yb=function(e,t){bb(e.prototype,t,{get:function(){return Cb(this)[t]}})},zb=function(e,t,r,n){var i=gb(r),a=Cb(e);if(i+t>a.byteLength)throw Bb(Pb);var o=Cb(a.buffer).bytes,s=i+a.byteOffset,u=Eb(o,s,s+t);return n?u:Gb(u)},Jb=function(e,t,r,n,i,a){var o=gb(r),s=Cb(e);if(o+t>s.byteLength)throw Bb(Pb);for(var u=Cb(s.buffer).bytes,c=o+s.byteOffset,l=n(+i),d=0;d<t;d++)u[c+d]=l[a?d:t-d-1]};if(sb){var Qb=Tb&&xb.name!==Ib;if(db((function(){xb(1)}))&&db((function(){new xb(-1)}))&&!db((function(){return new xb,new xb(1.5),new xb(NaN),1!=xb.length||Qb&&!wb})))Qb&&wb&&cb(xb,"name",Ib);else{(Rb=function(e){return hb(this,Ob),new xb(gb(e))}).prototype=Ob;for(var qb,eA=_b(xb),tA=0;eA.length>tA;)(qb=eA[tA++])in Rb||cb(Rb,qb,xb[qb]);Ob.constructor=Rb}vb&&mb(Lb)!==Mb&&vb(Lb,Mb);var rA=new Db(new Rb(2)),nA=ab(Lb.setInt8);rA.setInt8(0,2147483648),rA.setInt8(1,2147483649),!rA.getInt8(0)&&rA.getInt8(1)||lb(Lb,{setInt8:function(e,t){nA(this,e,t<<24>>24)},setUint8:function(e,t){nA(this,e,t<<24>>24)}},{unsafe:!0})}else Ob=(Rb=function(e){hb(this,Ob);var t=gb(e);kb(this,{bytes:Ub(Nb(t),0),byteLength:t}),ob||(this.byteLength=t)}).prototype,Lb=(Db=function(e,t,r){hb(this,Lb),hb(e,Ob);var n=Cb(e).byteLength,i=fb(t);if(i<0||i>n)throw Bb("Wrong offset");if(i+(r=void 0===r?n-i:pb(r))>n)throw Bb("Wrong length");kb(this,{buffer:e,byteLength:r,byteOffset:i}),ob||(this.buffer=e,this.byteLength=r,this.byteOffset=i)}).prototype,ob&&(Yb(Rb,"byteLength"),Yb(Db,"buffer"),Yb(Db,"byteLength"),Yb(Db,"byteOffset")),lb(Lb,{getInt8:function(e){return zb(this,1,e)[0]<<24>>24},getUint8:function(e){return zb(this,1,e)[0]},getInt16:function(e){var t=zb(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=zb(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return Wb(zb(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return Wb(zb(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return Fb(zb(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return Fb(zb(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){Jb(this,1,e,jb,t)},setUint8:function(e,t){Jb(this,1,e,jb,t)},setInt16:function(e,t){Jb(this,2,e,Hb,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){Jb(this,2,e,Hb,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){Jb(this,4,e,Zb,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){Jb(this,4,e,Zb,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){Jb(this,4,e,Kb,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){Jb(this,8,e,Xb,t,arguments.length>2?arguments[2]:void 0)}});Sb(Rb,Ib),Sb(Db,$b);var iA={ArrayBuffer:Rb,DataView:Db},aA=Na,oA="ArrayBuffer",sA=iA.ArrayBuffer;di({global:!0,constructor:!0,forced:g.ArrayBuffer!==sA},{ArrayBuffer:sA}),aA(oA);var uA=di,cA=L,lA=m,dA=Ht,hA=mn,fA=bn,pA=Ya,gA=iA.ArrayBuffer,yA=iA.DataView,mA=yA.prototype,vA=cA(gA.prototype.slice),_A=cA(mA.getUint8),bA=cA(mA.setUint8);uA({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:lA((function(){return!new gA(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(vA&&void 0===t)return vA(dA(this),e);for(var r=dA(this).byteLength,n=hA(e,r),i=hA(void 0===t?r:t,r),a=new(pA(this,gA))(fA(i-n)),o=new yA(this),s=new yA(a),u=0;n<i;)bA(s,u++,_A(o,n++));return a}});var AA,EA,SA,TA={exports:{}},wA=j_,CA=v,kA=g,IA=Q,$A=te,PA=ze,xA=Ii,RA=we,OA=ir,DA=un,LA=Ut.f,MA=oe,NA=Wh,BA=Ia,UA=ht,GA=tt,VA=Hr.enforce,FA=Hr.get,jA=kA.Int8Array,HA=jA&&jA.prototype,ZA=kA.Uint8ClampedArray,WA=ZA&&ZA.prototype,KA=jA&&NA(jA),XA=HA&&NA(HA),YA=Object.prototype,zA=kA.TypeError,JA=UA("toStringTag"),QA=GA("TYPED_ARRAY_TAG"),qA="TypedArrayConstructor",eE=wA&&!!BA&&"Opera"!==xA(kA.opera),tE=!1,rE={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},nE={BigInt64Array:8,BigUint64Array:8},iE=function e(t){var r=NA(t);if($A(r)){var n=FA(r);return n&&PA(n,qA)?n.TypedArrayConstructor:e(r)}},aE=function(e){if(!$A(e))return!1;var t=xA(e);return PA(rE,t)||PA(nE,t)};for(AA in rE)(SA=(EA=kA[AA])&&EA.prototype)?VA(SA).TypedArrayConstructor=EA:eE=!1;for(AA in nE)(SA=(EA=kA[AA])&&EA.prototype)&&(VA(SA).TypedArrayConstructor=EA);if((!eE||!IA(KA)||KA===Function.prototype)&&(KA=function(){throw zA("Incorrect invocation")},eE))for(AA in rE)kA[AA]&&BA(kA[AA],KA);if((!eE||!XA||XA===YA)&&(XA=KA.prototype,eE))for(AA in rE)kA[AA]&&BA(kA[AA].prototype,XA);if(eE&&NA(WA)!==XA&&BA(WA,XA),CA&&!PA(XA,JA))for(AA in tE=!0,LA(XA,JA,{get:function(){return $A(this)?this[QA]:void 0}}),rE)kA[AA]&&OA(kA[AA],QA,AA);var oE={NATIVE_ARRAY_BUFFER_VIEWS:eE,TYPED_ARRAY_TAG:tE&&QA,aTypedArray:function(e){if(aE(e))return e;throw zA("Target is not a typed array")},aTypedArrayConstructor:function(e){if(IA(e)&&(!BA||MA(KA,e)))return e;throw zA(RA(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r,n){if(CA){if(r)for(var i in rE){var a=kA[i];if(a&&PA(a.prototype,e))try{delete a.prototype[e]}catch(EU){try{a.prototype[e]=t}catch(o){}}}XA[e]&&!r||DA(XA,e,r?t:eE&&HA[e]||t,n)}},exportTypedArrayStaticMethod:function(e,t,r){var n,i;if(CA){if(BA){if(r)for(n in rE)if((i=kA[n])&&PA(i,e))try{delete i[e]}catch(EU){}if(KA[e]&&!r)return;try{return DA(KA,e,r?t:eE&&KA[e]||t)}catch(EU){}}for(n in rE)!(i=kA[n])||i[e]&&!r||DA(i,e,t)}},getTypedArrayConstructor:iE,isView:function(e){if(!$A(e))return!1;var t=xA(e);return"DataView"===t||PA(rE,t)||PA(nE,t)},isTypedArray:aE,TypedArray:KA,TypedArrayPrototype:XA},sE=g,uE=m,cE=yc,lE=oE.NATIVE_ARRAY_BUFFER_VIEWS,dE=sE.ArrayBuffer,hE=sE.Int8Array,fE=!lE||!uE((function(){hE(1)}))||!uE((function(){new hE(-1)}))||!cE((function(e){new hE,new hE(null),new hE(1.5),new hE(e)}),!0)||uE((function(){return 1!==new hE(new dE(2),1,void 0).length})),pE=te,gE=Math.floor,yE=Number.isInteger||function(e){return!pE(e)&&isFinite(e)&&gE(e)===e},mE=fn,vE=RangeError,_E=function(e){var t=mE(e);if(t<0)throw vE("The argument can't be less than 0");return t},bE=RangeError,AE=function(e,t){var r=_E(e);if(r%t)throw bE("Wrong offset");return r},EE=io,SE=E,TE=Ha,wE=Ke,CE=En,kE=Ku,IE=Gu,$E=Du,PE=oE.aTypedArrayConstructor,xE=Q,RE=te,OE=Ia,DE=function(e,t,r){var n,i;return OE&&xE(n=t.constructor)&&n!==r&&RE(i=n.prototype)&&i!==r.prototype&&OE(e,i),e},LE=di,ME=g,NE=E,BE=v,UE=fE,GE=oE,VE=iA,FE=Ga,jE=$,HE=ir,ZE=yE,WE=bn,KE=K_,XE=AE,YE=St,zE=ze,JE=Ii,QE=te,qE=Se,eS=xl,tS=oe,rS=Ia,nS=cn.f,iS=function(e){var t,r,n,i,a,o,s=TE(this),u=wE(e),c=arguments.length,l=c>1?arguments[1]:void 0,d=void 0!==l,h=IE(u);if(h&&!$E(h))for(o=(a=kE(u,h)).next,u=[];!(i=SE(o,a)).done;)u.push(i.value);for(d&&c>2&&(l=EE(l,arguments[2])),r=CE(u),n=new(PE(s))(r),t=0;r>t;t++)n[t]=d?l(u[t],t):u[t];return n},aS=hd.forEach,oS=Na,sS=Ut,uS=y,cS=DE,lS=Hr.get,dS=Hr.set,hS=Hr.enforce,fS=sS.f,pS=uS.f,gS=Math.round,yS=ME.RangeError,mS=VE.ArrayBuffer,vS=mS.prototype,_S=VE.DataView,bS=GE.NATIVE_ARRAY_BUFFER_VIEWS,AS=GE.TYPED_ARRAY_TAG,ES=GE.TypedArray,SS=GE.TypedArrayPrototype,TS=GE.aTypedArrayConstructor,wS=GE.isTypedArray,CS="BYTES_PER_ELEMENT",kS="Wrong length",IS=function(e,t){TS(e);for(var r=0,n=t.length,i=new e(n);n>r;)i[r]=t[r++];return i},$S=function(e,t){fS(e,t,{get:function(){return lS(this)[t]}})},PS=function(e){var t;return tS(vS,e)||"ArrayBuffer"==(t=JE(e))||"SharedArrayBuffer"==t},xS=function(e,t){return wS(e)&&!qE(t)&&t in e&&ZE(+t)&&t>=0},RS=function(e,t){return t=YE(t),xS(e,t)?jE(2,e[t]):pS(e,t)},OS=function(e,t,r){return t=YE(t),!(xS(e,t)&&QE(r)&&zE(r,"value"))||zE(r,"get")||zE(r,"set")||r.configurable||zE(r,"writable")&&!r.writable||zE(r,"enumerable")&&!r.enumerable?fS(e,t,r):(e[t]=r.value,e)};BE?(bS||(uS.f=RS,sS.f=OS,$S(SS,"buffer"),$S(SS,"byteOffset"),$S(SS,"byteLength"),$S(SS,"length")),LE({target:"Object",stat:!0,forced:!bS},{getOwnPropertyDescriptor:RS,defineProperty:OS}),TA.exports=function(e,t,r){var n=e.match(/\d+$/)[0]/8,i=e+(r?"Clamped":"")+"Array",a="get"+e,o="set"+e,s=ME[i],u=s,c=u&&u.prototype,l={},d=function(e,t){fS(e,t,{get:function(){return e=t,(r=lS(this)).view[a](e*n+r.byteOffset,!0);var e,r},set:function(e){return i=t,a=e,s=lS(this),r&&(a=(a=gS(a))<0?0:a>255?255:255&a),void s.view[o](i*n+s.byteOffset,a,!0);var i,a,s},enumerable:!0})};bS?UE&&(u=t((function(e,t,r,i){return FE(e,c),cS(QE(t)?PS(t)?void 0!==i?new s(t,XE(r,n),i):void 0!==r?new s(t,XE(r,n)):new s(t):wS(t)?IS(u,t):NE(iS,u,t):new s(KE(t)),e,u)})),rS&&rS(u,ES),aS(nS(s),(function(e){e in u||HE(u,e,s[e])})),u.prototype=c):(u=t((function(e,t,r,i){FE(e,c);var a,o,s,l=0,h=0;if(QE(t)){if(!PS(t))return wS(t)?IS(u,t):NE(iS,u,t);a=t,h=XE(r,n);var f=t.byteLength;if(void 0===i){if(f%n)throw yS(kS);if((o=f-h)<0)throw yS(kS)}else if((o=WE(i)*n)+h>f)throw yS(kS);s=o/n}else s=KE(t),a=new mS(o=s*n);for(dS(e,{buffer:a,byteOffset:h,byteLength:o,length:s,view:new _S(a)});l<s;)d(e,l++)})),rS&&rS(u,ES),c=u.prototype=eS(SS)),c.constructor!==u&&HE(c,"constructor",u),hS(c).TypedArrayConstructor=u,AS&&HE(c,AS,i);var h=u!=s;l[i]=u,LE({global:!0,constructor:!0,forced:h,sham:!bS},l),CS in u||HE(u,CS,n),CS in c||HE(c,CS,n),oS(i)}):TA.exports=function(){},(0,TA.exports)("Uint8",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var DS=Ke,LS=mn,MS=En,NS=vd,BS=Math.min,US=[].copyWithin||function(e,t){var r=DS(this),n=MS(r),i=LS(e,n),a=LS(t,n),o=arguments.length>2?arguments[2]:void 0,s=BS((void 0===o?n:LS(o,n))-a,n-i),u=1;for(a<i&&i<a+s&&(u=-1,a+=s-1,i+=s-1);s-- >0;)a in r?r[i]=r[a]:NS(r,i),i+=u,a+=u;return r},GS=oE,VS=L(US),FS=GS.aTypedArray;(0,GS.exportTypedArrayMethod)("copyWithin",(function(e,t){return VS(FS(this),e,t,arguments.length>2?arguments[2]:void 0)}));var jS=hd.every,HS=oE.aTypedArray;(0,oE.exportTypedArrayMethod)("every",(function(e){return jS(HS(this),e,arguments.length>1?arguments[1]:void 0)}));var ZS=bt,WS=TypeError,KS=nb,XS=function(e){var t=ZS(e,"number");if("number"==typeof t)throw WS("Can't convert number to bigint");return BigInt(t)},YS=Ii,zS=E,JS=m,QS=oE.aTypedArray,qS=oE.exportTypedArrayMethod,eT=L("".slice);qS("fill",(function(e){var t=arguments.length;QS(this);var r="Big"===eT(YS(this),0,3)?XS(e):+e;return zS(KS,this,r,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),JS((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e})));var tT=En,rT=Ya,nT=oE.aTypedArrayConstructor,iT=oE.getTypedArrayConstructor,aT=function(e){return nT(rT(e,iT(e)))},oT=function(e,t){for(var r=0,n=tT(t),i=new e(n);n>r;)i[r]=t[r++];return i},sT=aT,uT=hd.filter,cT=function(e,t){return oT(sT(e),t)},lT=oE.aTypedArray;(0,oE.exportTypedArrayMethod)("filter",(function(e){var t=uT(lT(this),e,arguments.length>1?arguments[1]:void 0);return cT(this,t)}));var dT=hd.find,hT=oE.aTypedArray;(0,oE.exportTypedArrayMethod)("find",(function(e){return dT(hT(this),e,arguments.length>1?arguments[1]:void 0)}));var fT=hd.findIndex,pT=oE.aTypedArray;(0,oE.exportTypedArrayMethod)("findIndex",(function(e){return fT(pT(this),e,arguments.length>1?arguments[1]:void 0)}));var gT=hd.forEach,yT=oE.aTypedArray;(0,oE.exportTypedArrayMethod)("forEach",(function(e){gT(yT(this),e,arguments.length>1?arguments[1]:void 0)}));var mT=kn.includes,vT=oE.aTypedArray;(0,oE.exportTypedArrayMethod)("includes",(function(e){return mT(vT(this),e,arguments.length>1?arguments[1]:void 0)}));var _T=kn.indexOf,bT=oE.aTypedArray;(0,oE.exportTypedArrayMethod)("indexOf",(function(e){return _T(bT(this),e,arguments.length>1?arguments[1]:void 0)}));var AT=g,ET=m,ST=L,TT=oE,wT=Uf,CT=ht("iterator"),kT=AT.Uint8Array,IT=ST(wT.values),$T=ST(wT.keys),PT=ST(wT.entries),xT=TT.aTypedArray,RT=TT.exportTypedArrayMethod,OT=kT&&kT.prototype,DT=!ET((function(){OT[CT].call([1])})),LT=!!OT&&OT.values&&OT[CT]===OT.values&&"values"===OT.values.name,MT=function(){return IT(xT(this))};RT("entries",(function(){return PT(xT(this))}),DT),RT("keys",(function(){return $T(xT(this))}),DT),RT("values",MT,DT||!LT,{name:"values"}),RT(CT,MT,DT||!LT,{name:"values"});var NT=oE.aTypedArray,BT=oE.exportTypedArrayMethod,UT=L([].join);BT("join",(function(e){return UT(NT(this),e)}));var GT=eo,VT=J,FT=fn,jT=En,HT=Rd,ZT=Math.min,WT=[].lastIndexOf,KT=!!WT&&1/[1].lastIndexOf(1,-0)<0,XT=HT("lastIndexOf"),YT=KT||!XT?function(e){if(KT)return GT(WT,this,arguments)||0;var t=VT(this),r=jT(t),n=r-1;for(arguments.length>1&&(n=ZT(n,FT(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in t&&t[n]===e)return n||0;return-1}:WT,zT=eo,JT=YT,QT=oE.aTypedArray;(0,oE.exportTypedArrayMethod)("lastIndexOf",(function(e){var t=arguments.length;return zT(JT,QT(this),t>1?[e,arguments[1]]:[e])}));var qT=hd.map,ew=aT,tw=oE.aTypedArray;(0,oE.exportTypedArrayMethod)("map",(function(e){return qT(tw(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(ew(e))(t)}))}));var rw=$e,nw=Ke,iw=H,aw=En,ow=TypeError,sw=function(e){return function(t,r,n,i){rw(r);var a=nw(t),o=iw(a),s=aw(a),u=e?s-1:0,c=e?-1:1;if(n<2)for(;;){if(u in o){i=o[u],u+=c;break}if(u+=c,e?u<0:s<=u)throw ow("Reduce of empty array with no initial value")}for(;e?u>=0:s>u;u+=c)u in o&&(i=r(i,o[u],u,a));return i}},uw={left:sw(!1),right:sw(!0)},cw=uw.left,lw=oE.aTypedArray;(0,oE.exportTypedArrayMethod)("reduce",(function(e){var t=arguments.length;return cw(lw(this),e,t,t>1?arguments[1]:void 0)}));var dw=uw.right,hw=oE.aTypedArray;(0,oE.exportTypedArrayMethod)("reduceRight",(function(e){var t=arguments.length;return dw(hw(this),e,t,t>1?arguments[1]:void 0)}));var fw=oE.aTypedArray,pw=oE.exportTypedArrayMethod,gw=Math.floor;pw("reverse",(function(){for(var e,t=this,r=fw(t).length,n=gw(r/2),i=0;i<n;)e=t[i],t[i++]=t[--r],t[r]=e;return t}));var yw=g,mw=E,vw=oE,_w=En,bw=AE,Aw=Ke,Ew=m,Sw=yw.RangeError,Tw=yw.Int8Array,ww=Tw&&Tw.prototype,Cw=ww&&ww.set,kw=vw.aTypedArray,Iw=vw.exportTypedArrayMethod,$w=!Ew((function(){var e=new Uint8ClampedArray(2);return mw(Cw,e,{length:1,0:3},1),3!==e[1]})),Pw=$w&&vw.NATIVE_ARRAY_BUFFER_VIEWS&&Ew((function(){var e=new Tw(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));Iw("set",(function(e){kw(this);var t=bw(arguments.length>1?arguments[1]:void 0,1),r=Aw(e);if($w)return mw(Cw,this,r,t);var n=this.length,i=_w(r),a=0;if(i+t>n)throw Sw("Wrong length");for(;a<i;)this[t+a]=r[a++]}),!$w||Pw);var xw=aT,Rw=oo,Ow=oE.aTypedArray;(0,oE.exportTypedArrayMethod)("slice",(function(e,t){for(var r=Rw(Ow(this),e,t),n=xw(this),i=0,a=r.length,o=new n(a);a>i;)o[i]=r[i++];return o}),m((function(){new Int8Array(1).slice()})));var Dw=hd.some,Lw=oE.aTypedArray;(0,oE.exportTypedArrayMethod)("some",(function(e){return Dw(Lw(this),e,arguments.length>1?arguments[1]:void 0)}));var Mw=L,Nw=m,Bw=$e,Uw=Pd,Gw=Dd,Vw=Ld,Fw=pe,jw=Nd,Hw=oE.aTypedArray,Zw=oE.exportTypedArrayMethod,Ww=g.Uint16Array,Kw=Ww&&Mw(Ww.prototype.sort),Xw=!(!Kw||Nw((function(){Kw(new Ww(2),null)}))&&Nw((function(){Kw(new Ww(2),{})}))),Yw=!!Kw&&!Nw((function(){if(Fw)return Fw<74;if(Gw)return Gw<67;if(Vw)return!0;if(jw)return jw<602;var e,t,r=new Ww(516),n=Array(516);for(e=0;e<516;e++)t=e%4,r[e]=515-e,n[e]=e-2*t+3;for(Kw(r,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(r[e]!==n[e])return!0}));Zw("sort",(function(e){return void 0!==e&&Bw(e),Yw?Kw(this,e):Uw(Hw(this),(t=e,function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}));var t}),!Yw||Xw);var zw=bn,Jw=mn,Qw=aT,qw=oE.aTypedArray;(0,oE.exportTypedArrayMethod)("subarray",(function(e,t){var r=qw(this),n=r.length,i=Jw(e,n);return new(Qw(r))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,zw((void 0===t?n:Jw(t,n))-i))}));var eC=eo,tC=oE,rC=m,nC=oo,iC=g.Int8Array,aC=tC.aTypedArray,oC=tC.exportTypedArrayMethod,sC=[].toLocaleString,uC=!!iC&&rC((function(){sC.call(new iC(1))}));oC("toLocaleString",(function(){return eC(sC,uC?nC(aC(this)):aC(this),nC(arguments))}),rC((function(){return[1,2].toLocaleString()!=new iC([1,2]).toLocaleString()}))||!rC((function(){iC.prototype.toLocaleString.call([1,2])})));var cC=oE.exportTypedArrayMethod,lC=m,dC=L,hC=g.Uint8Array,fC=hC&&hC.prototype||{},pC=[].toString,gC=dC([].join);lC((function(){pC.call({})}))&&(pC=function(){return gC(this)});var yC=fC.toString!=pC;cC("toString",pC,yC),(0,TA.exports)("Int8",(function(e){return function(t,r,n){return e(this,t,r,n)}})),(0,TA.exports)("Uint8",(function(e){return function(t,r,n){return e(this,t,r,n)}}),!0),(0,TA.exports)("Int16",(function(e){return function(t,r,n){return e(this,t,r,n)}})),(0,TA.exports)("Uint16",(function(e){return function(t,r,n){return e(this,t,r,n)}})),(0,TA.exports)("Int32",(function(e){return function(t,r,n){return e(this,t,r,n)}})),(0,TA.exports)("Uint32",(function(e){return function(t,r,n){return e(this,t,r,n)}})),(0,TA.exports)("Float32",(function(e){return function(t,r,n){return e(this,t,r,n)}})),(0,TA.exports)("Float64",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var mC=E,vC=ze,_C=oe,bC=tl,AC=RegExp.prototype,EC=function(e){var t=e.flags;return void 0!==t||"flags"in AC||vC(e,"flags")||!_C(AC,e)?t:mC(bC,e)},SC=dr.PROPER,TC=un,wC=Ht,CC=Xc,kC=m,IC=EC,$C="toString",PC=RegExp.prototype.toString,xC=kC((function(){return"/a/b"!=PC.call({source:"a",flags:"b"})})),RC=SC&&PC.name!=$C;(xC||RC)&&TC(RegExp.prototype,$C,(function(){var e=wC(this);return"/"+CC(e.source)+"/"+CC(IC(e))}),{unsafe:!0});var OC=di,DC=fi,LC=Fi,MC=te,NC=mn,BC=En,UC=J,GC=_i,VC=ht,FC=oo,jC=qi("slice"),HC=VC("species"),ZC=Array,WC=Math.max;OC({target:"Array",proto:!0,forced:!jC},{slice:function(e,t){var r,n,i,a=UC(this),o=BC(a),s=NC(e,o),u=NC(void 0===t?o:t,o);if(DC(a)&&(r=a.constructor,(LC(r)&&(r===ZC||DC(r.prototype))||MC(r)&&null===(r=r[HC]))&&(r=void 0),r===ZC||void 0===r))return FC(a,s,u);for(n=new(void 0===r?ZC:r)(WC(u-s,0)),i=0;s<u;s++,i++)s in a&&GC(n,i,a[s]);return n.length=i,n}});var KC=di,XC=H,YC=J,zC=Rd,JC=L([].join),QC=XC!=Object,qC=zC("join",",");KC({target:"Array",proto:!0,forced:QC||!qC},{join:function(e){return JC(YC(this),void 0===e?",":e)}});var ek,tk,rk,nk=te,ik=U,ak=ht("match"),ok=function(e){var t;return nk(e)&&(void 0!==(t=e[ak])?!!t:"RegExp"==ik(e))},sk=eo,uk=E,ck=L,lk=Sv,dk=Ht,hk=Z,fk=ok,pk=X,gk=Ya,yk=wv,mk=bn,vk=Xc,_k=Re,bk=Td,Ak=Gv,Ek=id,Sk=m,Tk=ol.UNSUPPORTED_Y,wk=4294967295,Ck=Math.min,kk=[].push,Ik=ck(/./.exec),$k=ck(kk),Pk=ck("".slice),xk=!Sk((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]}));lk("split",(function(e,t,r){var n;return n="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,r){var n=vk(pk(this)),i=void 0===r?wk:r>>>0;if(0===i)return[];if(void 0===e)return[n];if(!fk(e))return uk(t,n,e,i);for(var a,o,s,u=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),l=0,d=new RegExp(e.source,c+"g");(a=uk(Ek,d,n))&&!((o=d.lastIndex)>l&&($k(u,Pk(n,l,a.index)),a.length>1&&a.index<n.length&&sk(kk,u,bk(a,1)),s=a[0].length,l=o,u.length>=i));)d.lastIndex===a.index&&d.lastIndex++;return l===n.length?!s&&Ik(d,"")||$k(u,""):$k(u,Pk(n,l)),u.length>i?bk(u,0,i):u}:"0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:uk(t,this,e,r)}:t,[function(t,r){var i=pk(this),a=hk(t)?void 0:_k(t,e);return a?uk(a,t,i,r):uk(n,vk(i),t,r)},function(e,i){var a=dk(this),o=vk(e),s=r(n,a,o,i,n!==t);if(s.done)return s.value;var u=gk(a,RegExp),c=a.unicode,l=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(Tk?"g":"y"),d=new u(Tk?"^(?:"+a.source+")":a,l),h=void 0===i?wk:i>>>0;if(0===h)return[];if(0===o.length)return null===Ak(d,o)?[o]:[];for(var f=0,p=0,g=[];p<o.length;){d.lastIndex=Tk?0:p;var y,m=Ak(d,Tk?Pk(o,p):o);if(null===m||(y=Ck(mk(d.lastIndex+(Tk?p:0)),o.length))===f)p=yk(o,p,c);else{if($k(g,Pk(o,f,p)),g.length===h)return g;for(var v=1;v<=m.length-1;v++)if($k(g,m[v]),g.length===h)return g;p=f=y}}return $k(g,Pk(o,f)),g}]}),!xk,Tk),function(e,t,r){function n(e,t){var r=parseInt(e.slice(t,t+2),16);return r>>>7==0?[1,r]:r>>>6==2?(r=(63&r)<<8,[2,r+=parseInt(e.slice(t+2,t+4),16)]):(r=(63&r)<<16,[3,r+=parseInt(e.slice(t+2,t+6),16)])}var i,a=0,o=[],s=[],u=parseInt(e.slice(0,8),16),c=parseInt(e.slice(8,16),16);if(1213091658!==u||1077891651!==c)throw new Error("mhe");if(0!==parseInt(e.slice(16,18),16))throw new Error("ve");for(i=0;i<4;++i)a+=(3&parseInt(e.slice(24+2*i,26+2*i),16))<<2*i;var l=parseInt(e.slice(32,40),16),d=2*parseInt(e.slice(48,56),16);for(i=56;i<d+56;i+=2)o.push(parseInt(e.slice(i,i+2),16));var h=d+56,f=parseInt(e.slice(h,h+4),16);for(h+=4,i=0;i<f;++i){var p=n(e,h);h+=2*p[0];for(var g="",y=0;y<p[1];++y){var m=n(e,h);g+=String.fromCharCode(a^m[1]),h+=2*m[0]}s.push(g)}t.p=null,function e(t,r,n,i,a){var u,c,l,d,h,f=-1,p=[],g=[0,null],y=null,m=[r];for(c=Math.min(r.length,n),l=0;l<c;++l)m.push(r[l]);m.p=i;for(var v=[];;)try{var _=o[t++];if(_<40)if(_<20)if(_<11)_<5?_<3?p[++f]=null:3===_?(u=o[t++],p[++f]=u<<24>>24):(u=(o[t]<<8)+o[t+1],t+=2,p[++f]=u<<16>>16):_<7?5===_?(u=((u=((u=o[t++])<<8)+o[t++])<<8)+o[t++],p[++f]=(u<<8)+o[t++]):(u=(o[t]<<8)+o[t+1],t+=2,p[++f]=+s[u]):7===_?(u=(o[t]<<8)+o[t+1],t+=2,p[++f]=s[u]):p[++f]=void 0;else if(_<14)_<12?p[++f]=a:12===_?(u=(o[t]<<8)+o[t+1],t+=2,f=f-u+1,c=p.slice(f,f+u),p[f]=c):p[++f]={};else if(_<18)if(14===_)u=(o[t]<<8)+o[t+1],t+=2,c=s[u],l=p[f--],p[f][c]=l;else{for(c=o[t++],l=o[t++],d=m;c>0;--c)d=d.p;p[++f]=d[l]}else 18===_?(u=(o[t]<<8)+o[t+1],t+=2,c=s[u],p[f]=p[f][c]):(c=p[f--],p[f]=p[f][c]);else if(_<27)if(_<23)if(_<21){for(c=o[t++],l=o[t++],d=m;c>0;--c)d=d.p;d[l]=p[f--]}else 21===_?(u=(o[t]<<8)+o[t+1],t+=2,c=s[u],l=p[f--],d=p[f--],l[c]=d):(c=p[f--],l=p[f--],d=p[f--],l[c]=d);else if(_<25)if(23===_){for(c=o[t++],l=o[t++],d=m,d=m;c>0;--c)d=d.p;p[++f]=d,p[++f]=l}else c=p[f--],p[f]+=c;else 25===_?(c=p[f--],p[f]-=c):(c=p[f--],p[f]*=c);else _<35?_<29?27===_?(c=p[f--],p[f]/=c):(c=p[f--],p[f]%=c):29===_?p[f]=-p[f]:(c=p[f--],l=p[f--],p[++f]=l[c]++):_<38?35===_?(c=p[f--],p[f]=p[f]==c):(c=p[f--],p[f]=p[f]===c):38===_?(c=p[f--],p[f]=p[f]!==c):(c=p[f--],p[f]=p[f]<c);else if(_<58)_<48?_<44?_<41?(c=p[f--],p[f]=p[f]<=c):41===_?(c=p[f--],p[f]=p[f]>c):(c=p[f--],p[f]=p[f]<<c):_<46?44===_?(c=p[f--],p[f]=p[f]>>c):(c=p[f--],p[f]=p[f]>>>c):46===_?(c=p[f--],p[f]=p[f]&c):(c=p[f--],p[f]=p[f]|c):_<52?_<50?48===_?p[f]=~p[f]:(c=p[f--],p[f]=p[f]^c):50===_?p[f]=!p[f]:(u=(u=(o[t]<<8)+o[t+1])<<16>>16,t+=2,p[f]?--f:t+=u):_<55?52===_?(u=(u=(o[t]<<8)+o[t+1])<<16>>16,t+=2,p[f]?t+=u:--f):(c=p[f--],(l=p[f--])[c]=p[f]):55===_?(c=p[f--],p[f]=p[f]instanceof c):p[f]=void 0;else if(_<66)if(_<61)_<59?p[f]=_typeof$7(p[f]):59===_?(u=o[t++],c=p[f--],(l=function e(){var t=e._v;return(0,e._u)(t[0],arguments,t[1],t[2],this)})._v=[c,u,m],l._u=e,p[++f]=l):(u=o[t++],c=p[f--],(d=[l=function e(){var t=e._v;return(0,e._u)(t[0],arguments,t[1],t[2],this)}]).p=m,l._v=[c,u,d],l._u=e,p[++f]=l);else if(_<64)61===_?(u=(u=(o[t]<<8)+o[t+1])<<16>>16,t+=2,(c=v[v.length-1])[1]=t+u):(u=(u=(o[t]<<8)+o[t+1])<<16>>16,t+=2,(c=v[v.length-1])&&!c[1]?(c[0]=3,c.push(t)):v.push([1,0,t]),t+=u);else{if(64===_)throw c=p[f--];if(l=(c=v.pop())[0],d=g[0],1===l)t=c[1];else if(0===l)if(0===d)t=c[1];else{if(1!==d)throw g[1];if(!y)return g[1];t=y[1],a=y[2],m=y[3],v=y[4],p[++f]=g[1],g=[0,null],y=y[0]}else t=c[2],c[0]=0,v.push(c)}else if(_<71)if(_<68)if(66===_){for(c=p[f--],l=null;d=v.pop();)if(2===d[0]||3===d[0]){l=d;break}if(l)g=[1,c],t=l[2],l[0]=0,v.push(l);else{if(!y)return c;t=y[1],a=y[2],m=y[3],v=y[4],p[++f]=c,g=[0,null],y=y[0]}}else f-=u=o[t++],l=p.slice(f+1,f+u+1),c=p[f--],d=p[f--],c._u===e?(c=c._v,y=[y,t,a,m,v],t=c[0],null==d&&(d=function(){return this}()),a=d,(m=[l].concat(l)).length=Math.min(c[1],u)+1,m.p=c[2],v=[]):p[++f]=c.apply(d,l);else if(68===_){for(u=o[t++],d=[void 0],h=u;h>0;--h)d[h]=p[f--];l=p[f--],c=Function.bind.apply(l,d),p[++f]=new c}else t+=2+(u=(u=(o[t]<<8)+o[t+1])<<16>>16);else _<73?71===_?(u=(u=(o[t]<<8)+o[t+1])<<16>>16,t+=2,(c=p[f--])||(t+=u)):(u=(u=(o[t]<<8)+o[t+1])<<16>>16,t+=2,c=p[f--],p[f]===c&&(--f,t+=u)):73===_?--f:(c=p[f],p[++f]=c)}catch(b){for(g=[0,null];(u=v.pop())&&!u[0];);if(!u){e:for(;y;){for(c=y[4];u=c.pop();)if(u[0])break e;y=y[0]}if(!y)throw b;t=y[1],a=y[2],m=y[3],v=y[4],y=y[0]}1===(c=u[0])?(t=u[2],u[0]=0,v.push(u),p[++f]=b):2===c?(t=u[2],u[0]=0,v.push(u),g=[3,b]):(t=u[3],u[0]=2,v.push(u),p[++f]=b)}}(l,[],0,t,r)}("484e4f4a403f52430022100c4da72e45000042f7ef7143780000488a050000003e3b0014000105000000403c0011000115000111000112000214000205000000843c0111000215000405000000923c0011000215000611000142084211000012000014000111040011000144011400020300140003110003110001274700161100001100031311000211000316170003214945ffe00211041b0b1100024302421104014a1200030b1100014302420b12000544001400011104014a1200031100010b4302491100014205000001123b021400020211021a11000211000143024905000002653c0111000215001011000212000214000305000003803c01110003150013050000039b3c0111000315001505000004813c0011000315001405000004ce3c0011000315000611000242110001030038254700060c00001400011100020300382547000c03041100011200001a1400021101014a1200070b43013400010b1400031100011400041100041103023733000c1103031100044401170004354911000411030437340007110004110305373400071100041103063734000711000411030737340007110004110308373400071100041103093734000711000411030a3734000711000411030b3733001b11030311000412000811000412000911000412000a440317000435491100041103033747006f11000412000a1400050c000014000603001400071100071100052747003811000611000703022d1311000411000713031811000703041c03081a192b2f11000611000703022d3549110007030118170007354945ffbe11000611000307000b354911000511000307000c354945001611000111000307000b354911000211000307000c3549110003420c000014000205000002e23c011400030300140005110005110001274700520211000306000e11000434000911040c4a12001043001a4301140006053ade67b70211000643001a17000435491100024a12001106000e0211000643001a03002f430149110005030418170005354945ffa4110202110002110001440242110001140002053ade68b114000306000d14000405000002fe3b00420500009069050000ffff1101032e1a11010303102c181101042e1701033549044650050000ffff1101022e1a11010203102c181101042e170102354911010303102b110102181101042e14000111000106000e1b170001354911000106000f18170001354911000111070c4a120010430006000f29470005030145000303011d1a42110001030038254700061103031400011100014a1200120b4301420b12000b14000211000112000b1400030b12000c14000411000112000c1400050b4a12001443004911000403041c47007003001400061100061100052747005e11000311000603022d13031811000603041c03081a192d0400ff2e1400071100021100041100061803022d1311000703181100041100061803041c03081a192b2f1100021100041100061803022d3549110006030118170006354945ff9845003503001400081100081100052747002611000311000803022d131100021100041100081803022d16110008030418170008354945ffd00b12000c110005180b07000c35490b420b12000b1400010b12000c14000211000111000203022d1306000d032011000203041c03081a192b2e11000111000203022d354911040c4a12001611000203041b4301110001070000354908421102011200021200064a1200070b43011400010b12000b4a1200170300430111000107000b35491100014211000112000b14000211000112000c1400030c000014000403001400051100051100032747005c11000211000503022d13031811000503041c03081a192d0400ff2e1400061100044a12001111000603042d4a120013031043014301491100044a120011030f1100062e4a12001303104301430149110005030118170005354945ff9a1100044a1200180700194301421100011200001400020c000014000303001400041100041100022747004711000311000403032d130211030d1100014a12001a1100040302430203104302031811000403081c03041a192b2f11000311000403032d3549110004030218170004354945ffaf11020211000311000203021b44024211000112000b14000211000112000c1400030c000014000403001400051100051100032747004211000211000503022d13031811000503041c03081a192d0400ff2e1400061100044a12001111030e4a12001c1100064301430149110005030118170005354945ffb41100044a1200180700194301421100011200001400020c000014000303001400041100041100022747004111000311000403022d130400ff1100014a12001d11000443012e031811000403041c03081a192b2f11000311000403022d3549110004030118170004354945ffb51102021100031100024402423e000d14000211031107001e440140413d001a0211030f021103101102044a120012110001430143014301424108421102044a12001b021103120211031311000143014301430142050000077e3b001400020211021a110002110001430249110002120002140003050000079f3c0011000315002205000007b43c0111000315002405000007f73c0111000315002a05000008d43c00110003150006110002421101014a1200070b43013400010b1700013549030011000107001f35491100014211030244000b070020354903000b070021354908421100011400020700231100023a233300101103054a12001b110002430117000235490b1200204a1200151100024301490b12002111000212000c180b070021354908420b1200201400030b12002514000411000312000b14000511000312000c14000611000603041100041a1b14000711000147000f11040c4a120016110007430145001611040c4a12002603001100072f0b12001f19030043021400071100071100041a14000811040c4a12002703041100081a1100064302140009110008470051030014000a11000a1100082747001d0b4a12002811000511000a43024911000a1100041817000a354945ffd91100054a12002903001100084302170002354911000312000c1100091911000307000c35491103021100021100094402421102011200021200064a1200070b43011400010b1200204a120006430011000107002035491100014205000009623b011400020211021a11000211000143024905000009a63c0111000215002d05000009c03c0111000215002e11000212000214000305000009dd3c0011000315002205000009f83c011100031500300500000a0d3c0111000315002c110002421101014a1200070b43013400010b1700023549031011000207002535491103014a1200031102014400110001430211000207002b35491100024a1200224300491100024205000009ae3b024211010111000244014a12002c11000143014205000009c83b024211040811010111000244024a12002c1100014301421102011200021200224a1200070b4301490b4a12002f43004908420b4a1200241100014301490b4a12002a4300490b4211000133000a0b4a1200241100014301490b4a1200314300420500000a713b021400020211021a1100021100014302491100021200021400030500000b963c001100031500220500000bb73c011100031500300500000bc73c0111000315002c110002421101014a1200070b43013400010b14000311000144001400041100041100031500321100021400050700231100053a233300101102054a12001b1100054301170005354911000412002514000603041100061a14000711000512000c110007293300101100044a12002c110002430117000535491100054a1200144300491100054a12000643001400081100081100031500331100054a120006430014000911000911000315003411000812000b14000a11000912000b14000b030014000c11000c1100062747003811000a11000c13055c5c5c5c3111000a11000c354911000b11000c1305363636363111000b11000c354911000c03011817000c354945ffbe11000711000807000c354911000711000907000c35491100034a120022430049110003420b1200321400011100014a1200224300491100014a1200300b12003443014908420b1200324a1200301100014301490b420b1200321400021100024a12002c11000143011400031100024a1200224300491100024a12002c0b1200334a12000643004a12001511000343014301420c0000140004030014000503001400061100061100022747008611000603041c47006f1100031100014a12001d11000603011943011311000603041c03021a2b1100031100014a12001d110006430113030611000603041c03021a192d2f14000711000411000503022d13110007031811000503041c03081a192b2f11000411000503022d35491100050301181700053549110006030118170006354945ff701102024a12000111000411000543024211000112000b14000211000112000c1400030b1200351400041100014a1200144300490c00001400050300140006110006110003274700c711000211000603022d13031811000603041c03081a192d0400ff2e03102b11000211000603011803022d13031811000603011803041c03081a192d0400ff2e03082b2f11000211000603021803022d13031811000603021803041c03081a192d0400ff2e2f140007030014000811000803042733000f1100060600361100081a18110003274700311100054a1200111100044a12003711000703060303110008191a2d033f2e4301430149110008030118170008354945ffb4110006030318170006354945ff2f1100044a1200370340430114000911000947001c11000512000003041c4700101100054a12001111000943014945ffe41100054a1200180700194301421100011200001400020b1200351400030b120038140004110004324700450c00000b07003835490b12003817000435490300140005110005110003120000274700211100051100041100034a12001d110005430116110005030118170005354945ffd21100034a120037034043011400061100064700211100014a120039110006430114000703011d110007263300071100071700023549021102091100011100021100044303421100011100021100032e110002301100042e2f1811000518110007181400081100081100062b1100080320110006192d2f11000218421100011100021100042e110003110004302e2f1811000518110007181400081100081100062b1100080320110006192d2f110002184211000111000211000331110004311811000518110007181400081100081100062b1100080320110006192d2f1100021842110001110003110002110004302f311811000518110007181400081100081100062b1100080320110006192d2f11000218420500000fbf3b001400020211021a1100021100014302491100021200021400030500000fd13c0011000315002f0500000fef3c021100031500280500001a213c001100031500310500001b773c00110003150006110002421101014a12003d0b11000043023400010b42110302056745230106003e06003f05103254760c000444010b1500400842110001140003030014000411000403102747004e11000211000418140005110001110005131400060500ff00ff11000603082b11000603182d2f2e06004111000603182b11000603082d2f2e2f11000311000516110004030118170004354945ffa90b12004012000b14000711000311000203001813140008110003110002030118131400091100031100020302181314000a1100031100020303181314000b1100031100020304181314000c1100031100020305181314000d1100031100020306181314000e1100031100020307181314000f1100031100020308181314001011000311000203091813140011110003110002030a1813140012110003110002030b1813140013110003110002030c1813140014110003110002030d1813140015110003110002030e1813140016110003110002030f181314001711000703001314001811000703011314001911000703021314001a11000703031314001b0211030d11001811001911001a11001b110008030711030b030013430717001835490211030d11001b11001811001911001a110009030c11030b030113430717001b35490211030d11001a11001b11001811001911000a031111030b030213430717001a35490211030d11001911001a11001b11001811000b031611030b030313430717001935490211030d11001811001911001a11001b11000c030711030b030413430717001835490211030d11001b11001811001911001a11000d030c11030b030513430717001b35490211030d11001a11001b11001811001911000e031111030b030613430717001a35490211030d11001911001a11001b11001811000f031611030b030713430717001935490211030d11001811001911001a11001b110010030711030b030813430717001835490211030d11001b11001811001911001a110011030c11030b030913430717001b35490211030d11001a11001b110018110019110012031111030b030a13430717001a35490211030d11001911001a11001b110018110013031611030b030b13430717001935490211030d11001811001911001a11001b110014030711030b030c13430717001835490211030d11001b11001811001911001a110015030c11030b030d13430717001b35490211030d11001a11001b110018110019110016031111030b030e13430717001a35490211030d11001911001a11001b110018110017031611030b030f13430717001935490211030e11001811001911001a11001b110009030511030b031013430717001835490211030e11001b11001811001911001a11000e030911030b031113430717001b35490211030e11001a11001b110018110019110013030e11030b031213430717001a35490211030e11001911001a11001b110018110008031411030b031313430717001935490211030e11001811001911001a11001b11000d030511030b031413430717001835490211030e11001b11001811001911001a110012030911030b031513430717001b35490211030e11001a11001b110018110019110017030e11030b031613430717001a35490211030e11001911001a11001b11001811000c031411030b031713430717001935490211030e11001811001911001a11001b110011030511030b031813430717001835490211030e11001b11001811001911001a110016030911030b031913430717001b35490211030e11001a11001b11001811001911000b030e11030b031a13430717001a35490211030e11001911001a11001b110018110010031411030b031b13430717001935490211030e11001811001911001a11001b110015030511030b031c13430717001835490211030e11001b11001811001911001a11000a030911030b031d13430717001b35490211030e11001a11001b11001811001911000f030e11030b031e13430717001a35490211030e11001911001a11001b110018110014031411030b031f13430717001935490211030f11001811001911001a11001b11000d030411030b032013430717001835490211030f11001b11001811001911001a110010030b11030b032113430717001b35490211030f11001a11001b110018110019110013031011030b032213430717001a35490211030f11001911001a11001b110018110016031711030b032313430717001935490211030f11001811001911001a11001b110009030411030b032413430717001835490211030f11001b11001811001911001a11000c030b11030b032513430717001b35490211030f11001a11001b11001811001911000f031011030b032613430717001a35490211030f11001911001a11001b110018110012031711030b032713430717001935490211030f11001811001911001a11001b110015030411030b032813430717001835490211030f11001b11001811001911001a110008030b11030b032913430717001b35490211030f11001a11001b11001811001911000b031011030b032a13430717001a35490211030f11001911001a11001b11001811000e031711030b032b13430717001935490211030f11001811001911001a11001b110011030411030b032c13430717001835490211030f11001b11001811001911001a110014030b11030b032d13430717001b35490211030f11001a11001b110018110019110017031011030b032e13430717001a35490211030f11001911001a11001b11001811000a031711030b032f13430717001935490211031011001811001911001a11001b110008030611030b033013430717001835490211031011001b11001811001911001a11000f030a11030b033113430717001b35490211031011001a11001b110018110019110016030f11030b033213430717001a35490211031011001911001a11001b11001811000d031511030b033313430717001935490211031011001811001911001a11001b110014030611030b033413430717001835490211031011001b11001811001911001a11000b030a11030b033513430717001b35490211031011001a11001b110018110019110012030f11030b033613430717001a35490211031011001911001a11001b110018110009031511030b033713430717001935490211031011001811001911001a11001b110010030611030b033813430717001835490211031011001b11001811001911001a110017030a11030b033913430717001b35490211031011001a11001b11001811001911000e030f11030b033a13430717001a35490211031011001911001a11001b110018110015031511030b033b13430717001935490211031011001811001911001a11001b11000c030611030b033c13430717001835490211031011001b11001811001911001a110013030a11030b033d13430717001b35490211031011001a11001b11001811001911000a030f11030b033e13430717001a35490211031011001911001a11001b110018110011031511030b033f13430717001935491100070300131100181803002f110007030035491100070301131100191803002f1100070301354911000703021311001a1803002f1100070302354911000703031311001b1803002f1100070303354908420b12002014000111000112000b14000203080b1200211a140003030811000112000c1a14000411000211000403052d13040080031811000403201c192b2f11000211000403052d354911040c4a12004211000306000e1b43011400051100031400060500ff00ff11000503082b11000503182d2f2e06004111000503182b11000503082d2f2e2f110002030f11000403401803092d03042b1835490500ff00ff11000603082b11000603182d2f2e06004111000603182b11000603082d2f2e2f110002030e11000403401803092d03042b18354903041100021200000301181a11000107000c35490b4a12002a4300490b12004014000711000712000b14000803001400091100090304274700441100081100091314000a0500ff00ff11000a03082b11000a03182d2f2e06004111000a03182b11000a03082d2f2e2f11000811000916110009030118170009354945ffb3110007421102011200021200064a1200070b43011400010b1200404a12000643001100010700403549110001420500001bd13b011400020211021a1100021100014302491100021200021400030500001c123c02110003150046110002421101014a1200070b43013400010b17000235491103014a12000311020144000d03040e00431102110e004403010e0045110001430311000207002b3549110002420b12002b1400041100041200444a12000143001400051103024a120001430014000611000612000b1400071100041200431400081100041200451400091100071200001100082747007f11000333000c1100054a1200301100034301491100054a12003011000143014a12002c110002430117000335491100054a120022430049030114000a11000a110009274700291100054a12002c110003430117000335491100054a12002243004911000a03011817000a354945ffcd1100064a12001511000343014945ff7403041100081a11000607000c3549110006420500001d5f3b031400020211021a1100021100014302490500001daf3c0211000215004a0500001dc13c0211000215004c0500001dd33c0111000215002d1100021200021400030500001e403c001100031500220500001e5b3c0111000315004f0500001e6e3c0111000315002c110002421101014a1200070b43013400010b17000435491103014a1200031102014400110003430211000407002b3549110001110004070047354911000211000407004835491100044a120022430049110004420b4a1200010b1200491100011100024303420b4a1200010b12004b1100011100024303420500001df33c011400020d0500001e083c030e004d0500001e243c030e004e420700231100013a2347000611051d45000311051b420211020211000243014a12004d1102011100011100021100034304420211020211000243014a12004e1102011100011100021100034304421102011200021200224a1200070b4301490b4a12002f43004908420b4a1200241100014301490b4a12002a43004211000133000a0b4a1200241100014301490b4a1200314300420500001ebc3b021400020211021a1100021100014302490500001ee93c0211000215004a0500001efa3c0211000215004c110002421101014a1200070b43013400010b170003354911000111000307005135491100021100030700523549110003420b1200534a1200011100011100024302420b1200544a1200011100011100024302421100011400040b12005214000611000647001311000617000535490300380b070052354500080b120055170005354903001400071100071100032747002d11000411000211000718131100051100071331110004110002110007183549110007030118170007354945ffc908420500001f933b001400020211021a110002110001430249110002421101014a12003d0b11000043023400010b420500001fd63b001400020211021a1100021100014302491100021200021400030500001fe83c02110003150057110002421101014a12003d0b11000043023400010b420b1200511400031100031200251400041103154a1200070b1100011100021100044304491100034a1200561100011100024302491100014a1200171100021100021100041843020b0700553549084205000020683b001400020211021a110002110001430249110002120002140003050000207a3c02110003150057110002421101014a12003d0b11000043023400010b420b1200511400031100031200251400041100014a1200171100021100021100041843021400051100034a1200581100011100024302491103154a1200070b1100011100021100044304491100050b0700553549084203041100021a14000311000311000112000c1100031c1914000411000403182b11000403102b2f11000403082b2f1100042f1400050c000014000603001400071100071100042747001b1100064a120011110005430149110007030418170007354945ffdb1102024a12000111000611000443021400081100014a12001511000843014908421100011400020400ff11000212000b11000212000c03011903022d132e14000311000212000c1100031911000207000c3549084205000021d43b031400020211021a11000211000143024911000212000214000305000022143c00110003150022050000229a3c0211000315002805000022ad3c00110003150031110002421101014a1200070b1100011100021103014a1200030d1102160e005b1102170e005c110003430243043400010b170004354903041100040700253549110004421102011200021200224a1200070b4301490b12002b14000211000212005d14000311000212005b1400040b1200470b1200051200492547000d11000412004a1700013545001211000412004c170001354903010b07001f35491100014a1200071100040b11000333000611000312000b43030b07005e35491100010b12005e07005f354908420b12005e4a12005711000111000243024908420b12002b12005c1400020b1200470b120005120049254700231100024a1200590b1200200b1200254302490b4a12002a03003243011700013545001b0b4a12002a030032430117000135491100024a12005a11000143014911000142050000233a3b011400020211021a110002110001430249110002120002140003050000235e3c01110003150013110002421101014a1200070b43013400010b17000235491100024a120004110001430149110002421100013400040b1200604a1200120b43014211000112006114000311000112006214000411000447002b1102024a1200010553616c740565645f5f0c000243014a12001511000443014a120015110003430145000311000317000235491100024a12001311020a43014211020a4a12001b110001430114000311000312000b1400040553616c741100040300132533000c0565645f5f110004030113253300391102024a1200011100044a120017030203044302430117000235491100044a1200290300030443024911000312000c03101911000307000c35491102194a1200010d1100030e00611100020e006243014205000024913b001400020211021a11000211000143024905000024a33c0411000215004d050000252f3c0411000215004e050000257c3c02110002150066110002421101014a12003d0b11000043023400010b421104014a12000311030144000b12002b11000443031400051100014a12004a11000311000543021400061100064a12002c110002430114000711000612002b1400081103194a1200010d1100070e00611100030e006311000812005d0e005d1100010e006411000812005b0e005b11000812005c0e005c1100061200250e00251100051200650e00604301421100021400051104014a12000311030144000b12002b11000443031400060b4a12006611000511000612006543021400051100014a12004c11000311000643024a12002c1100051200614301420700231100013a234700101100024a12001b1100010b43024500031100014211000414000511000534000f1102024a1200100308430117000535491102124a1200010d110002110003180e004343014a12004611000111000543021400061102024a12000111000612000b4a120017110002430103041100031a430214000703041100021a11000607000c35491102194a1200010d1100060e00631100070e005d1100050e0062430142050000265b3b001400020211021a110002110001430249050000266d3c0411000215004d05000026df3c0411000215004e110002421101014a12003d0b11000043023400010b421104014a12000311030144000b12002b11000443031400051100051200684a120067110003110001120043110001120050430314000611000612005d11000515005d11031b12004d4a1200070b11000111000211000612006311000543051400071100074a120004110006430149110007421100021400051104014a12000311030144000b12002b11000443031400060b4a12006611000511000612006543021400051100061200684a120067110003110001120043110001120050110005120062430414000711000712005d11000615005d11031b12004e4a1200070b11000111000511000712006311000643054205000027b53b001400020211021a11000211000143024911000212000214000305000027c73c0011000315002f0500002a123c021100031500560500002a353c021100031500580500002ac03c0811000315006d110002421101014a12003d0b11000043023400010b420b1200693300090b12006a0b1200482547000208420b1200480b15006a0b12006a14000211000212000b14000311000212000c03041b1400041100040306180b15006903040b1200690301181a1400050c00000b15006b0b12006b1400060300140007110007110005274701211100071100042747001111000311000713110006110007354500f71100061100070301191317000135491100071100041c47005a11000403062933000a1100071100041c03042333004111031e11000103182d1303182b11031e11000103102d0400ff2e1303102b2f11031e11000103082d0400ff2e1303082b2f11031e0400ff1100012e132f1700013545006d11000103082b11000103182d2f170001354911031e11000103182d1303182b11031e11000103102d0400ff2e1303102b2f11031e11000103082d0400ff2e1303082b2f11031e0400ff1100012e132f17000135491100011103321100071100041b03002f1303182b3117000135491100061100071100041913110001311100061100073549110007030118170007354945fed50c00000b15006c0b12006c14000803001400091100091100052747009e1100051100091914000a11000903041c47000a11000611000a1345000a11000611000a03041913170001354911000903042734000611000a03042847000611000145004411032411031e11000103182d131311032511031e11000103102d0400ff2e13133111032611031e11000103082d0400ff2e13133111032711031e0400ff1100012e1313311100081100093549110009030118170009354945ff5808420b4a12006d1100011100020b12006b11032011032111032211032311031e43084908421100011400031100031100020301181314000411000311000203031813110003110002030118354911000411000311000203031835490b4a12006d1100031100020b12006c11032411032511032611032711031f430849110003110002030118131700043549110003110002030318131100031100020301183549110004110003110002030318354908421100011400090b12006914000a110009110002131100030300133114000b110009110002030118131100030301133114000c110009110002030218131100030302133114000d110009110002030318131100030303133114000e030414000f030114001011001011000a2747015611000411000b03182d1311000511000c03102d0400ff2e133111000611000d03082d0400ff2e13311100070400ff11000e2e133111000311000f133114001111000f03011817000f354911000411000c03182d1311000511000d03102d0400ff2e133111000611000e03082d0400ff2e13311100070400ff11000b2e133111000311000f133114001211000f03011817000f354911000411000d03182d1311000511000e03102d0400ff2e133111000611000b03082d0400ff2e13311100070400ff11000c2e133111000311000f133114001311000f03011817000f354911000411000e03182d1311000511000b03102d0400ff2e133111000611000c03082d0400ff2e13311100070400ff11000d2e133111000311000f133114001411000f03011817000f354911001117000b354911001217000c354911001317000d354911001417000e3549110010030118170010354945fea011000811000b03182d1303182b11000811000c03102d0400ff2e1303102b2f11000811000d03082d0400ff2e1303082b2f1100080400ff11000e2e132f11000311000f133114001511000f03011817000f354911000811000c03182d1303182b11000811000d03102d0400ff2e1303102b2f11000811000e03082d0400ff2e1303082b2f1100080400ff11000b2e132f11000311000f133114001611000f03011817000f354911000811000d03182d1303182b11000811000e03102d0400ff2e1303102b2f11000811000b03082d0400ff2e1303082b2f1100080400ff11000c2e132f11000311000f133114001711000f03011817000f354911000811000e03182d1303182b11000811000b03102d0400ff2e1303102b2f11000811000c03082d0400ff2e1303082b2f1100080400ff11000d2e132f11000311000f133114001811000f03011817000f3549110015110009110002354911001611000911000203011835491100171100091100020302183549110018110009110002030318354908421101054a12001b11000243011400041101054a12001b110003430114000511010a4a12001b110001430114000611010a4a12001211000643011400071101344a12004e1100071100040d1100050e005d43034a1200131101054301420700231100013a234700591100014a12006e07006f430114000203021100021200002547003c1100020300131400031100034a120070031043011400040d1100040e005d1100041100034a120070030003104302180e00631100020301130e007142024202421102021100011200004401140002110203110002440114000303001400041100041100011200002747001b1100014a12001d110004430111000311000416170004214945ffd8110002421102024a120072110001430133000a110001120008170001354911020e12001c4a12003d0211020311000144014302421102031200021200174700121100014a120017110002110003430245001d1102031102001200021200174a12000711000111000211000343034401420500002fa33b021400011100011200021400020500002fb73c0211000215004e110001421100010b07007335491100020b070074354908420b1200734a12004e0d0700750e00760b1200740e005d11000211000143034211000112000a14000211000233001711021411000112000844014a12007711000203011943011400031100034700150211013711000103001100021100031943034500031100014205000030763b00140001110001120002140002050000312b3c01110002150080050000318a3c0011000215007e05000033e53c0111000215008405000036d13c0111000215008505000036f93c0311000215004e1100014203000301030203040308031003200340040080031b03360c000b0b070078354911030904010044011103090401004401110309040100440111030904010044010c00040b070079354911030904010044011103090401004401110309040100440111030904010044010c00040b07007a354911030904010044010b07007b354911030904010044010b07007c3549110309030044010b070063354903000b07007d354903000b07004335490b4a12007e43004908421104024a120072110001430133000a1100011200081700013549110414110001440114000211040903044401140003030014000411000403042747001e1100024a12007f03041100041a430111000311000416170004214945ffd9110003420b12007b1400010b12007c1400020b1200791400031100030300131400041100030301131400051100030302131400061100030303131400070b12007a14000811000803001314000911000803011314000a11000803021314000b11000803031314000c110409040100440114000d030014000e030014000f0300140010030017001035491100100401002747002c1100100400802747000911001003012b45000a11001003012b04011b3111000d11001016170010214945ffca030017001035491100100401002747018d11000f11000f03012b3111000f03022b3111000f03032b3111000f03042b3114001111001103082d0400ff1100112e31036331170011354911001111000111000e354911000e110002110011354911000d11000e1314001211000d1100121314001311000d1100131314001404010111000d110011131a05010101001100111a3114001511001503182b11001503082d2f11000411000e354911001503102b11001503102d2f11000511000e354911001503082b11001503182d2f11000611000e354911001511000711000e354905010101011100141a05000100011100131a310401011100121a31050101010011000e1a31170015354911001503182b11001503082d2f110009110011354911001503102b11001503102d2f11000a110011354911001503082b11001503182d2f11000b110011354911001511000c110011354911000e47003211001211000d11000d11000d110014110012311313133117000e354911000f11000d11000d11000f13133117000f3545000a030117000f3517000e3549170010214945fe6908420b4a120080110001430114000203003214000303001400041100041100021200002733000311000347001d110002110004130b12006311000413251700033549170004214945ffd011000347000208421100020b1500631100021200000b0700433514000503041100052633000603061100052633000603081100052647000d1104110700811100051844014003041100050306180301181a0b07007d3514000611040911000644010b0700823514000911040911000644010b0700833514000a0b12007b14000b0b12007814000c0b12007a14000d11000d03001314000e11000d03011314000f11000d03021314001011000d0303131400110300170007354911000711000627470122110007110005274700151100021100071311000911000735170012354500fa11001217001335491100071100051c03002347007011001303082b11001303182d2f170013354911000b11001303182d1303182b11000b11001303102d0400ff2e1303102b2f11000b11001303082d0400ff2e1303082b2f11000b0400ff1100132e132f170013354911001311000c1100071100051b03002f1303182b311700133545005711000503062933000a1100071100051c03042333004111000b11001303182d1303182b11000b11001303102d0400ff2e1303102b2f11000b11001303082d0400ff2e1303082b2f11000b0400ff1100132e132f170013354911000911000711000519131100133103002d170012351100091100073549170007214945fed403001700083549110008110006274700ac11000611000819170007354903031100082e47000a1100091100071345000a11000911000703041913170013354911000803042734000611000703042847000611001345004411000e11000b11001303182d131311000f11000b11001303102d0400ff2e13133111001011000b11001303082d0400ff2e13133111001111000b0400ff1100132e13133111000a110008354911000a1100081303002d11000a1100083549170008214945ff4a084211000103182b050000ff001100012e03082b2f0500ff00001100012e03082c2f11000103182d2f420b1200430306181400040b1200831400050b12007c1400060b12007a14000711000703001314000811000703011314000911000703021314000a11000703031314000b0b4a120080110003430114000c11000c03001314000d11000c03011314000e11000c03021314000f11000c030313140010110408110001440114001111040811001112000044011400120b120085140021110002110011120000274703a10211002111001111000213430117001b35490211002111001111000203011813430117001c35490211002111001111000203021813430117001d35490211002111001111000203031813430117001e354911001b11000503001331170017354911001e11000503011331170018354911001d11000503021331170019354911001c1100050303133117001a3549030417001f3549030117002035491100201100042747014011000811001703182d1311000911001803102c0400ff2e133111000a11001903082c0400ff2e133111000b0400ff11001a2e133111000511001f1331170013354911000811001803182d1311000911001903102c0400ff2e133111000a11001a03082c0400ff2e133111000b0400ff1100172e133111000511001f0301181331170014354911000811001903182d1311000911001a03102c0400ff2e133111000a11001703082c0400ff2e133111000b0400ff1100182e133111000511001f0302181331170015354911000811001a03182d1311000911001703102c0400ff2e133111000a11001803082c0400ff2e133111000b0400ff1100192e133111000511001f0303181331170016354911001317001735491100141700183549110015170019354911001617001a354911001f03041817001f3549170020214945feb611000611001703182d1303182b11000611001803102c0400ff2e1303102b3111000611001903082c0400ff2e1303082b311100060400ff11001a2e133111000511001f1331170013354911000611001803182d1303182b11000611001903102c0400ff2e1303102b3111000611001a03082c0400ff2e1303082b311100060400ff1100172e133111000511001f0301181331170014354911000611001903182d1303182b11000611001a03102c0400ff2e1303102b3111000611001703082c0400ff2e1303082b311100060400ff1100182e133111000511001f0302181331170015354911000611001a03182d1303182b11000611001703102c0400ff2e1303102b3111000611001803082c0400ff2e1303082b311100060400ff1100192e133111000511001f030318133117001635490211002111001311000d31430111001211000235490211002111001611000e31430111001211000203011835490211002111001511000f314301110012110002030218354902110021110014110010314301110012110002030318354911001b17000d354911001c17000e354911001d17000f354911001e1700103549110002030418170002354945fc52110012120008420500003b663b021400011100011200021400020500003b7a3c00110002150084110001421100010b07007335491100020b070063354908420b1200734a1200860700870b1200630d0700750e007603013207004d07004e0c00024305421102031100011200001100021200001844011400031100034a1200881100014301491100034a120088110002110001120000430249110003420500003c773b021400011100011200021400020500003d783c001100021500970500003d803c001100021500980500003dc13c001100021500220500003de63c01110002150099020500003e443b00430011000215004e0500003f433c0311000215009f02050000401b3b0043001100021500a2050000415d3c041100021500aa05000041833c011100021500a605000041d23c011100021500a411000142110002030038254700040d450003110002140003110003120089140004110004030038254700060300324500031100041400050300320b07008a3549020b0700733549020b07008b3549020b0700633549020b07008c3549020b07008d3549020b07008e3549020b07008f35491100010b07009035491100050b070089354911000547002f3e0004140007413d00251103151200911400061100063300141100061200733400061100061200920b0700733549410700931100011200943a2347002f030132110001120094263400040b1200733400181103164a1200950700964301490300320b1200900700943545000d0b120073320b120090070094354908420b120090120094420b12008f140001110001324700090b4a1200224300384211040311000144011400020b4a1200224300490b12008947000c02110339110002430145000311000242020b07008f3549020b07008e3549020b07008d35490b12008b330006020b07008b354908420211041e0211033611000143014301140002110002470024021103350211041d11000212007111000212006311000212005d4303430114000345001e1104024a1200721100014301470009110001120008450003110001140003110003420500003f353b03140002021103190211031843004a12009a0500003e6e3c0343014301140001110002420211051843004a12009b0500003e863c011101000b43034203014700a811000112009c11000107009d3503004800140304480062030548007f07009e4800794945007f0b1200901200943247000b030411000115009c4500690b4a12009f11070311020144011102021102034303490b4a12009843001402041100014a1200a00700a1110204470009110204120008450001024302421100014a1200a00700a10b4a1200a2110703110201440111020211020343034302421100014a1200a343004245ff5308421101014a12003d0b1100004302420b4a12009911000243011400040b12008e1400050b12008f1400060b12008d1400070b4a1200a40700a54301491100073300170211033d11000711000143021700013549020b07008d35490b4a1200a6110001430114000811000812000032470002024211000533000711000517000335490b12008b14000911000934000e11033a44000b07008b3517000935491100094a12008411000443014911000614000a1100094a12004e110008120008030011000343030b07008f35490211033711000803101d43021200080b07008e354911000a3400010242050000414f3b03140002021103190211031843004a12009a05000040453c0343014301140001110002420b1400040211051843004a12009b05000040613c011101000b430342030147009d11000112009c11000107009d35030048000f030248007907009e480073494500790b4a120099110202430117020535490b12007317020635491100014a1200a00700a10b120063110205253300040b12008c3400191102050b070063354911063b11020611020544020b07008c35490b12008c4a12008443004a1200a705000041053b0105000041393b0143024302421100014a1200a343004245ff5e0842110306324700121108174a1200a81108110700a9440143014211073811030611030344024a12004e1103011200081100014302421103044a1200aa1100011103011103051103034304421101014a12003d0b1100004302420300320b12009007009435490300320b07008a35490b4a12009f11000211000311000443034211000114000211000112000011000112000003101c1914000311000311000112000026330024021103371100010300110003430317000235490211033711000111000343020b07008d3549110002420b12008a3300080301320b07008a35490842050000420b3b011400011100011200021400020205000042193b00430011000215004e1100014211023e11000144010b1500ab084205000042e93b03140002021103190211031843004a12009a05000042433c0343014301140001110002420211051843004a12009b050000425b3c011101000b430342030147008711000112009c11000107009d35030048001903024800300305480049030648005907009e48005349450059030211000115009c0b1200ab4a12004e1102011102021102034303421100011200ac14020411020447000b030511000115009c4500230700ad401100014a1200a00700a111070311020444014302421100014a1200a343004245ff7408421101014a12003d0b1100004302420500001f0b3b031400150500002e073b0314011d0500002e633b0114011e0500002ec93b011400350500002f133b011400360500002f433b031400370500002fd63b011400390500003b9f3b0214003d0205000000003b0043001400010205000000ad3b0111000143011400020d05000004f93c010e001205000005893c010e001b1400030d05000005fd3c010e001205000006733c010e001b1400040d05000006de3c010e0012050000070d3c010e001b1400050205000007263b0111000143011400060205000008fd3b011100064301140007020500000a263b0111000143011400080500000c043c031400090d0500000cb43c010e00120500000df03c010e001b07003a0e003514000a0c000014000b030014000c11000c03402747003406000e11010c4a12003b11010c4a12003c11000c030118430143011a03002f11000b11000c1611000c03011817000c354945ffc30500000e983c0714000d0500000ece3c0714000e0500000f043c0714000f0500000f353c07140010020500000f673b011100074301140011020500001ba03b011100014301140012020500001ced3b01110006430114001303011100130700493549030211001307004b35490304110013070043354903041100130700503549020500001e873b011100014301140014020500001f783b011100144301140016020500001fa53b01110016430111001607005335490205000020373b01110016430111001607005435490d05000020cf3c020e005905000021553c010e005a1400170205000021893b0111001343011400180205000023093b0111000143011400190d05000023703c010e001205000023c83c010e001b14001a02050000244f3b01110001430114001b1101014a12000311000144000d11001a0e0065430211001b15002b0d050000259b3c040e006714001c0205000026263b0111001b430114001d1101014a12000311001b12002b0d11001c0e0068430211001d15002b0c000014001e0c000014001f0c00001400200c00001400210c00001400220c00001400230c00001400240c00001400250c00001400260c00001400270c00001400280300140029110029040100274700321100290400802747000911002903012b45000a11002903012b04011b3111002811002916110029030118170029354945ffc4030014002a030014002b030014002c11002c0401002747019711002b11002b03012b3111002b03022b3111002b03032b3111002b03042b3114002d11002d03082d0400ff11002d2e3103633117002d354911002d11001e11002a354911002a11001f11002d354911002811002a1314002e11002811002e1314002f11002811002f1314003004010111002811002d131a050101010011002d1a3114003111003103182b11003103082d2f11002011002a354911003103102b11003103102d2f11002111002a354911003103082b11003103182d2f11002211002a354911003111002311002a354905010101011100301a050001000111002f1a3104010111002e1a31050101010011002a1a31170031354911003103182b11003103082d2f11002411002d354911003103102b11003103102d2f11002511002d354911003103082b11003103182d2f11002611002d354911003111002711002d354911002a47003211002e11002811002811002811003011002e311313133117002a354911002b11002811002811002b13133117002b3545000e030117002b354911002b17002a354911002c03011817002c354945fe5f03000301030203040308031003200340040080031b03360c000b14003202050000275d3b01110018430114003303081100331500431100184a12002d1100334301140034020500002f7f3b00430014003802050000301e3b00430014003a020500003b423b00430014003b031014003c020500003bd83b00430014003e0205000041e43b00430014011c084200ae060108030a1905060e1f080c1908091d1f02190219141d08060c1e1e040a030500041524030b0e02031e191f180e19021f050e01020308040e0c0101060f180b0b081f0a0f141908220b0b1e08190a0f1419082108030a1905051a021f091e081e040a2f1419081e0a595f5459545b5a5f54580a595f5459545b5a5f545b035d4358061f0c03090200041d181e05091e191f04030a040b140819023e191f04030a050e010c001d060e02030e0c19040e080401051e01040e08040702040300061e180f1e191f051d0c1f1e080c0b1f02002e050c1f2e0209080a0e050c1f2e0209082c1914200c010b021f0008094d38392b40554d090c190c0e320004032f180b0b081f3e0417080532090c190c0b3203290c190c2f1419081e051f081e0819061e191f04030a07320c1d1d080309090f01020e063e04170803000c15030004030f3209023d1f020e081e1e2f01020e06061e1d01040e0808321d1f020e081e1e030e0b0a080b04030c010417080d320e1f080c19082508011d081f11320e1f080c190825000c0e2508011d081f083209023f081e081906181d090c19080b3209022b04030c010417080732050c1e05081f0532022608140532042608140432000c1d045d435a58060e050c1f2c190b321f081b081f1e08200c1d070403090815220b412c2f2e29282b2a25242726212023223d3c3f3e39383b3a3534370c0f0e09080b0a05040706010003021d1c1f1e19181b1a1514175d5c5f5e59585b5a5554464250030c0f1e031e0403050c1d1d01140a595d5f5e5f5e5e595c5a0a5f585b5f5e555e5c5d5f0532050c1e050a595f5a555f58585e5b5d050b0102021f070608143e04170806050c1e05081f0a0419081f0c190402031e070e02001d1819080a32150b021f002002090804320608140f3228232e32352b223f2032202229280f0e1f080c190828030e1f141d19021f0f3229282e32352b223f2032202229280f0e1f080c190829080e1f141d19021f0708030e1f141d190709080e1f141d19071d1f020e081e1e06041b3e04170807320e041d05081f0332041b0928030e1f141d19021f0929080e1f141d19021f0a321d1f081b2f01020e060c08030e1f141d192f01020e060c1d1f020e081e1e2f01020e060c09080e1f141d192f01020e06031d0c090518031d0c090400020908071d0c090904030a02041b0532000209080932320e1f080c19021f090b021f000c1919081f0a0e041d05081f19081519041e0c011903060814090c010a021f04190500060b021f000c1906321d0c1f1e08070815080e1819080306090b0832033f021803091e0e320608143d1f04021f3f081e08190c320608143e0e0508091801080f3204031b2608143e0e0508091801080d3209022e1f141d192f01020e06051e1d0104190157091e180f1e191f04030a0708030e290c190c06041e3b04081a061e180f190108050c081e243b072c283e402e2f2e04030c0008080a08193804031955041f0e0203061e180f2004150904031b3e180f200415041e2f02150704031b3e2f021506061e3f021a1e0904030419390c0f0108090a0819380403195e5f1818040319552c1f1f0c143902380403195e5f2c1f1f0c14321524031b0c0104094d0c081e4d0608144d1e041708500b0608143e0e0508091801080e04031b2608143e0e0508091801080908151d0c0309260814160308191a021f06390225021e19221f09081f3e1a0c1d0904001d021f19260814031f0c1a031e0819121f0800021b083d262e3e5a3d0c090904030a0a01020a28030c0f010809111e020b191a0c1f0829080e1f141d19081f0a0b0c1e192c081e2608140d1f08000c040309081f290c190c090e181f1f080319243b0d0e181f1f0803193f081e180119060e02030b040a060e1f141d19020c1a080f0604193e180f190108070f020201080c031108030c0f01083e020b191a0c1f082c283e0301020a4a2918084d19024d1905084d1e0419180c190402034d19050c194d08031b4d0902034a194d1e181d1d021f194d0e1f141d1902414d0b0c01010f0c0e064d19024d071e4d09080e1f141d1906041e3e14030e050b01181e05111d1f041b0c190826081429080e1f141d1904000c1f06041a1f0c1d0403081519041d1f081b030803090f1e020b191a0c1f0829080e1f141d19060c0f1f181d19061f0819181f03101a080f2e1f141d190229080e1f141d19041e19021d0701020a22030e080e273e4d2c283e4d09080e1f141d190d0a08193b0c0104092e051803060419050803061f0807080e191a1a080f4d0e1f141d19024d0302194d04030419040c01041708091002033a080f2e1f141d1902281f1f021f0a3209080e1f141d19081f041e0803190f09080e1f141d194d0b0c0401181f08",{0:Array,1:Object,2:ArrayBuffer,3:Uint8Array,4:Int8Array,5:Uint8ClampedArray,6:Int16Array,7:Uint16Array,8:Int32Array,9:Uint32Array,10:Float32Array,11:Float64Array,12:Math,13:parseInt,14:String,15:decodeURIComponent,get 16(){return escape},17:Error,get 18(){return unescape},19:encodeURIComponent,20:DataView,get 21(){return self},get 22(){return console},23:Promise,get 24(){return t},get 25(){return n},get 26(){return o},get 27(){return c},get 28(){return ek},set 28(e){ek=e},get 29(){return tk},set 29(e){tk=e},get 30(){return rk},set 30(e){rk=e}},globalThis);var Rk,Ok,Dk,Lk,Mk,Nk={exports:{}};Rk=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,Ok=/^(?=([^\/?#]*))\1([^]*)$/,Dk=/(?:\/|^)\.(?=\/)/g,Lk=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,Nk.exports=Mk={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var n=Mk.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=Mk.normalizePath(n.path),Mk.buildURLFromParts(n)}var i=Mk.parseURL(t);if(!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return r.alwaysNormalize?(i.path=Mk.normalizePath(i.path),Mk.buildURLFromParts(i)):t;var a=Mk.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var o=Ok.exec(a.path);a.netLoc=o[1],a.path=o[2]}a.netLoc&&!a.path&&(a.path="/");var s={scheme:a.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};if(!i.netLoc&&(s.netLoc=a.netLoc,"/"!==i.path[0]))if(i.path){var u=a.path,c=u.substring(0,u.lastIndexOf("/")+1)+i.path;s.path=Mk.normalizePath(c)}else s.path=a.path,i.params||(s.params=a.params,i.query||(s.query=a.query));return null===s.path&&(s.path=r.alwaysNormalize?Mk.normalizePath(i.path):i.path),Mk.buildURLFromParts(s)},parseURL:function(e){var t=Rk.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(Dk,"");e.length!==(e=e.replace(Lk,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};var Bk=Nk.exports,Uk=di,Gk=v,Vk=Ut.f;Uk({target:"Object",stat:!0,forced:Object.defineProperty!==Vk,sham:!Gk},{defineProperty:Vk});var Fk=di,jk=v,Hk=sl.f;Fk({target:"Object",stat:!0,forced:Object.defineProperties!==Hk,sham:!jk},{defineProperties:Hk});var Zk=jn,Wk=J,Kk=y,Xk=_i;di({target:"Object",stat:!0,sham:!v},{getOwnPropertyDescriptors:function(e){for(var t,r,n=Wk(e),i=Kk.f,a=Zk(n),o={},s=0;a.length>s;)void 0!==(r=i(n,t=a[s++]))&&Xk(o,t,r);return o}});var Yk={},zk=U,Jk=J,Qk=cn.f,qk=Td,eI="object"==("undefined"==typeof window?"undefined":_typeof$7(window))&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Yk.f=function(e){return eI&&"Window"==zk(e)?function(e){try{return Qk(e)}catch(EU){return qk(eI)}}(e):Qk(Jk(e))};var tI={},rI=ht;tI.f=rI;var nI=g,iI=ze,aI=tI,oI=Ut.f,sI=function(e){var t=nI.Symbol||(nI.Symbol={});iI(t,e)||oI(t,e,{value:aI.f(e)})},uI=E,cI=ae,lI=ht,dI=un,hI=di,fI=g,pI=E,gI=L,yI=v,mI=me,vI=m,_I=ze,bI=oe,AI=Ht,EI=J,SI=St,TI=Xc,wI=$,CI=xl,kI=ll,II=cn,$I=Yk,PI=Nn,xI=y,RI=Ut,OI=sl,DI=S,LI=un,MI=Ne.exports,NI=Cr,BI=tt,UI=ht,GI=tI,VI=sI,FI=function(){var e=cI("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,n=lI("toPrimitive");t&&!t[n]&&dI(t,n,(function(e){return uI(r,this)}),{arity:1})},jI=Ra,HI=Hr,ZI=hd.forEach,WI=wr("hidden"),KI="Symbol",XI=HI.set,YI=HI.getterFor(KI),zI=Object.prototype,JI=fI.Symbol,QI=JI&&JI.prototype,qI=fI.TypeError,e$=fI.QObject,t$=xI.f,r$=RI.f,n$=$I.f,i$=DI.f,a$=gI([].push),o$=MI("symbols"),s$=MI("op-symbols"),u$=MI("wks"),c$=!e$||!e$.prototype||!e$.prototype.findChild,l$=yI&&vI((function(){return 7!=CI(r$({},"a",{get:function(){return r$(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=t$(zI,t);n&&delete zI[t],r$(e,t,r),n&&e!==zI&&r$(zI,t,n)}:r$,d$=function(e,t){var r=o$[e]=CI(QI);return XI(r,{type:KI,tag:e,description:t}),yI||(r.description=t),r},h$=function e(t,r,n){t===zI&&e(s$,r,n),AI(t);var i=SI(r);return AI(n),_I(o$,i)?(n.enumerable?(_I(t,WI)&&t[WI][i]&&(t[WI][i]=!1),n=CI(n,{enumerable:wI(0,!1)})):(_I(t,WI)||r$(t,WI,wI(1,{})),t[WI][i]=!0),l$(t,i,n)):r$(t,i,n)},f$=function(e,t){AI(e);var r=EI(t),n=kI(r).concat(m$(r));return ZI(n,(function(t){yI&&!pI(p$,r,t)||h$(e,t,r[t])})),e},p$=function(e){var t=SI(e),r=pI(i$,this,t);return!(this===zI&&_I(o$,t)&&!_I(s$,t))&&(!(r||!_I(this,t)||!_I(o$,t)||_I(this,WI)&&this[WI][t])||r)},g$=function(e,t){var r=EI(e),n=SI(t);if(r!==zI||!_I(o$,n)||_I(s$,n)){var i=t$(r,n);return!i||!_I(o$,n)||_I(r,WI)&&r[WI][n]||(i.enumerable=!0),i}},y$=function(e){var t=n$(EI(e)),r=[];return ZI(t,(function(e){_I(o$,e)||_I(NI,e)||a$(r,e)})),r},m$=function(e){var t=e===zI,r=n$(t?s$:EI(e)),n=[];return ZI(r,(function(e){!_I(o$,e)||t&&!_I(zI,e)||a$(n,o$[e])})),n};mI||(JI=function(){if(bI(QI,this))throw qI("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?TI(arguments[0]):void 0,t=BI(e),r=function e(r){this===zI&&pI(e,s$,r),_I(this,WI)&&_I(this[WI],t)&&(this[WI][t]=!1),l$(this,t,wI(1,r))};return yI&&c$&&l$(zI,t,{configurable:!0,set:r}),d$(t,e)},LI(QI=JI.prototype,"toString",(function(){return YI(this).tag})),LI(JI,"withoutSetter",(function(e){return d$(BI(e),e)})),DI.f=p$,RI.f=h$,OI.f=f$,xI.f=g$,II.f=$I.f=y$,PI.f=m$,GI.f=function(e){return d$(UI(e),e)},yI&&(r$(QI,"description",{configurable:!0,get:function(){return YI(this).description}}),LI(zI,"propertyIsEnumerable",p$,{unsafe:!0}))),hI({global:!0,constructor:!0,wrap:!0,forced:!mI,sham:!mI},{Symbol:JI}),ZI(kI(u$),(function(e){VI(e)})),hI({target:KI,stat:!0,forced:!mI},{useSetter:function(){c$=!0},useSimple:function(){c$=!1}}),hI({target:"Object",stat:!0,forced:!mI,sham:!yI},{create:function(e,t){return void 0===t?CI(e):f$(CI(e),t)},defineProperty:h$,defineProperties:f$,getOwnPropertyDescriptor:g$}),hI({target:"Object",stat:!0,forced:!mI},{getOwnPropertyNames:y$}),FI(),jI(JI,KI),NI[WI]=!0;var v$=me&&!!Symbol.for&&!!Symbol.keyFor,_$=di,b$=ae,A$=ze,E$=Xc,S$=Ne.exports,T$=v$,w$=S$("string-to-symbol-registry"),C$=S$("symbol-to-string-registry");_$({target:"Symbol",stat:!0,forced:!T$},{for:function(e){var t=E$(e);if(A$(w$,t))return w$[t];var r=b$("Symbol")(t);return w$[t]=r,C$[r]=t,r}});var k$=di,I$=ze,$$=Se,P$=we,x$=v$,R$=(0,Ne.exports)("symbol-to-string-registry");k$({target:"Symbol",stat:!0,forced:!x$},{keyFor:function(e){if(!$$(e))throw TypeError(P$(e)+" is not a symbol");if(I$(R$,e))return R$[e]}});var O$=di,D$=ae,L$=eo,M$=E,N$=L,B$=m,U$=fi,G$=Q,V$=te,F$=Se,j$=oo,H$=me,Z$=D$("JSON","stringify"),W$=N$(/./.exec),K$=N$("".charAt),X$=N$("".charCodeAt),Y$=N$("".replace),z$=N$(1..toString),J$=/[\uD800-\uDFFF]/g,Q$=/^[\uD800-\uDBFF]$/,q$=/^[\uDC00-\uDFFF]$/,eP=!H$||B$((function(){var e=D$("Symbol")();return"[null]"!=Z$([e])||"{}"!=Z$({a:e})||"{}"!=Z$(Object(e))})),tP=B$((function(){return'"\\udf06\\ud834"'!==Z$("\udf06\ud834")||'"\\udead"'!==Z$("\udead")})),rP=function(e,t){var r=j$(arguments),n=t;if((V$(t)||void 0!==e)&&!F$(e))return U$(t)||(t=function(e,t){if(G$(n)&&(t=M$(n,this,e,t)),!F$(t))return t}),r[1]=t,L$(Z$,null,r)},nP=function(e,t,r){var n=K$(r,t-1),i=K$(r,t+1);return W$(Q$,e)&&!W$(q$,i)||W$(q$,e)&&!W$(Q$,n)?"\\u"+z$(X$(e,0),16):e};Z$&&O$({target:"JSON",stat:!0,arity:3,forced:eP||tP},{stringify:function(e,t,r){var n=j$(arguments),i=L$(eP?rP:Z$,null,n);return tP&&"string"==typeof i?Y$(i,J$,nP):i}});var iP=Nn,aP=Ke;di({target:"Object",stat:!0,forced:!me||m((function(){iP.f(1)}))},{getOwnPropertySymbols:function(e){var t=iP.f;return t?t(aP(e)):[]}});var oP=L,sP=$e,uP=te,cP=ze,lP=oo,dP=_,hP=Function,fP=oP([].concat),pP=oP([].join),gP={},yP=function(e,t,r){if(!cP(gP,t)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";gP[t]=hP("C,a","return new C("+pP(n,",")+")")}return gP[t](e,r)},mP=dP?hP.bind:function(e){var t=sP(this),r=t.prototype,n=lP(arguments,1),i=function r(){var i=fP(n,lP(arguments));return this instanceof r?yP(t,i.length,i):t.apply(e,i)};return uP(r)&&(i.prototype=r),i},vP=di,_P=eo,bP=mP,AP=Ha,EP=Ht,SP=te,TP=xl,wP=m,CP=ae("Reflect","construct"),kP=Object.prototype,IP=[].push,$P=wP((function(){function e(){}return!(CP((function(){}),[],e)instanceof e)})),PP=!wP((function(){CP((function(){}))})),xP=$P||PP;function RP(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(EU){return void r(EU)}s.done?t(u):Promise.resolve(u).then(n,i)}function OP(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){RP(a,n,i,o,s,"next",e)}function s(e){RP(a,n,i,o,s,"throw",e)}o(void 0)}))}}function DP(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function LP(e,t,r){return t&&DP(e.prototype,t),r&&DP(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function MP(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function NP(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function BP(e,t){return(BP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function UP(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&BP(e,t)}function GP(e){return(GP="function"==typeof Symbol&&"symbol"==_typeof$7(Symbol.iterator)?function(e){return _typeof$7(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof$7(e)})(e)}function VP(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function FP(e,t){if(t&&("object"===GP(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return VP(e)}function jP(e){return(jP=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function HP(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(DR){return!1}}function ZP(e,t,r){return(ZP=HP()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&BP(i,r.prototype),i}).apply(null,arguments)}function WP(e){var t="function"==typeof Map?new Map:void 0;return WP=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return ZP(e,arguments,jP(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),BP(n,e)},WP(e)}vP({target:"Reflect",stat:!0,forced:xP,sham:xP},{construct:function(e,t){AP(e),EP(t);var r=arguments.length<3?e:AP(arguments[2]);if(PP&&!$P)return CP(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return _P(IP,n,t),new(_P(bP,e,n))}var i=r.prototype,a=TP(SP(i)?i:kP),o=_P(e,a,t);return SP(o)?o:a}});var KP={exports:{}},XP={exports:{}};!function(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==_typeof$7(Symbol.iterator)?function(e){return _typeof$7(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof$7(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(XP),function(e){var t=XP.exports.default;function r(){e.exports=r=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var n={},i=Object.prototype,a=i.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch($){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i,a,o,s,u=t&&t.prototype instanceof p?t:p,c=Object.create(u.prototype),l=new C(n||[]);return c._invoke=(i=e,a=r,o=l,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return{value:void 0,done:!0}}for(o.method=e,o.arg=t;;){var r=o.delegate;if(r){var n=S(r,o);if(n){if(n===f)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===s)throw s="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s="executing";var u=h(i,a,o);if("normal"===u.type){if(s=o.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:o.done}}"throw"===u.type&&(s="completed",o.method="throw",o.arg=u.arg)}}),c}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch($){return{type:"throw",arg:$}}}n.wrap=d;var f={};function p(){}function g(){}function y(){}var m={};l(m,s,(function(){return this}));var v=Object.getPrototypeOf,_=v&&v(v(k([])));_&&_!==i&&a.call(_,s)&&(m=_);var b=y.prototype=p.prototype=Object.create(m);function A(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,r){function n(i,o,s,u){var c=h(e[i],e,o);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==t(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):r.resolve(d).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,u)}))}u(c.arg)}var i;this._invoke=function(e,t){function a(){return new r((function(r,i){n(e,t,r,i)}))}return i=i?i.then(a,a):a()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=h(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,f;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function k(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(a.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:I}}function I(){return{value:void 0,done:!0}}return g.prototype=y,l(b,"constructor",y),l(y,"constructor",g),g.displayName=l(y,c,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},n.awrap=function(e){return{__await:e}},A(E.prototype),l(E.prototype,u,(function(){return this})),n.AsyncIterator=E,n.async=function(e,t,r,i,a){void 0===a&&(a=Promise);var o=new E(d(e,t,r,i),a);return n.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},A(b),l(b,c,"Generator"),l(b,s,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},n.values=k,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;w(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:k(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},n}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}(KP);var YP=KP.exports(),zP=YP;try{regeneratorRuntime=YP}catch(SU){"object"==("undefined"==typeof globalThis?"undefined":_typeof$7(globalThis))?globalThis.regeneratorRuntime=YP:Function("r","regeneratorRuntime = r")(YP)}var JP=hd.forEach,QP=Rd("forEach")?[].forEach:function(e){return JP(this,e,arguments.length>1?arguments[1]:void 0)},qP=g,ex=np,tx=op,rx=QP,nx=ir,ix=function(e){if(e&&e.forEach!==rx)try{nx(e,"forEach",rx)}catch(EU){e.forEach=rx}};for(var ax in ex)ex[ax]&&ix(qP[ax]&&qP[ax].prototype);function ox(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return r.used=!1,r.resolve=function(){return r.used=!0,e.apply(void 0,arguments)},r.reject=function(){return r.used=!0,t.apply(void 0,arguments)},r}ix(tx);var sx,ux=function(){function e(){NP(this,e)}return LP(e,null,[{key:"start",value:function(e){return e&&e.length?1===e.length&&e.end(0)-e.start(0)<1e-6||1===e.length&&e.start(0)<0?0:e.start(0):0}},{key:"end",value:function(e){return e&&e.length?1===e.length&&e.end(0)-e.start(0)<1e-6?0:e.end(e.length-1):0}},{key:"get",value:function(e){if(e)try{return e.buffered}catch(EU){}}},{key:"buffers",value:function(e,t){if(!e||!e.length)return[];for(var r=[],n=0,i=e.length;n<i;n++){var a=r.length;if(a&&t){var o=r[a-1],s=o[1];if(e.start(n)-s<=t){var u=e.end(n);u>s&&(o[1]=u)}else r.push([e.start(n),e.end(n)])}else r.push([e.start(n),e.end(n)])}return r}},{key:"length",value:function(e){return e&&e.length?e.reduce((function(e,t){return e+(t[1]-t[0])}),0):0}},{key:"info",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!t||!t.length)return{start:0,end:0,buffers:[]};for(var i=0,a=0,o=0,s=0,u=0,c=0,l=0,d=e.buffers(t,n),h=0,f=d.length;h<f;h++){var p=d[h];if(r+n>=p[0]&&r<p[1])i=p[0],a=p[1],o=h;else{if(r+n<p[0]){s=p[0],u=p[1];break}r+n>p[1]&&(c=p[0],l=p[1])}}return{start:i,end:a,index:o,buffers:d,nextStart:s,nextEnd:u,prevStart:c,prevEnd:l,currentTime:r,behind:r-i,remaining:a?a-r:0,length:e.length&&e.length(d)}}}]),e}();function cx(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=jP(e);if(t){var i=jP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return FP(this,r)}}var lx="manifest",dx="network",hx="network_timeout",fx="demux",px="remux",gx="media",yx="other",mx={FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",OPTION:"OPTION"},vx=(MP(sx={},lx,{HLS:1100}),MP(sx,dx,2100),MP(sx,hx,2101),MP(sx,fx,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400}),MP(sx,px,{FMP4:4100,MP4:4200}),MP(sx,gx,{MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202}),MP(sx,yx,8e3),sx),_x=function(e){UP(r,e);var t=cx(r);function r(e,n,i,a,o){var s;return NP(this,r),(s=t.call(this,o||(null==i?void 0:i.message))).errorType=e===hx?dx:e,s.originError=i,s.ext=a,s.errorCode=vx[e][n]||vx[e],s.errorMessage=s.message,s.errorCode||(s.errorType=yx,s.errorCode=vx[s.errorType]),s}return LP(r,null,[{key:"create",value:function(e,t,n,i,a){return e instanceof r?e:(e instanceof Error&&(n=e,e=""),e||(e=yx),new r(e,t,n,i,a))}},{key:"network",value:function(e){var t;return new r(null!=e&&e.isTimeout?hx:dx,e,null,{url:null==e?void 0:e.url,response:null==e?void 0:e.response,httpCode:null==e||null===(t=e.response)||void 0===t?void 0:t.status})}}]),r}(WP(Error)),bx="undefined"!=typeof window?window.MediaSource||window.WebKitMediaSource:null,Ax=function(){function e(t){var r=this;NP(this,e),MP(this,"media",null),MP(this,"mediaSource",null),MP(this,"_openPromise",ox()),MP(this,"_queue",Object.create(null)),MP(this,"_sourceBuffer",Object.create(null)),MP(this,"_onSBUpdateEnd",(function(e){var t=r._queue[e];if(t){var n=t.shift();n&&(n.promise.resolve(),r._startQueue(e))}})),MP(this,"_onSBUpdateError",(function(e,t){var n=r._queue[e];if(n){var i=n[0];i&&i.promise.reject(new _x(gx,mx.MSE_APPEND_BUFFER,t))}})),t&&this.bindMedia(t)}var t,r,n;return LP(e,[{key:"isOpened",get:function(){var e;return"open"===(null===(e=this.mediaSource)||void 0===e?void 0:e.readyState)}},{key:"duration",get:function(){var e;return(null===(e=this.mediaSource)||void 0===e?void 0:e.duration)||-1}},{key:"updateDuration",value:function(e){var t=this;return this._enqueueBlockingOp((function(){t.mediaSource&&(t.mediaSource.duration=e)}))}},{key:"open",value:function(){var e=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var t=this.mediaSource;t.addEventListener("sourceopen",(function r(){t.removeEventListener("sourceopen",r),e._openPromise.resolve()})),this._openPromise=ox()}return this._openPromise}},{key:"bindMedia",value:(n=OP(zP.mark((function e(t){var r,n,i=this;return zP.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mediaSource&&!this.media){e.next=3;break}return e.next=3,this.unbindMedia();case 3:if(t&&bx){e.next=5;break}throw new Error("Param media or MediaSource does not exist");case 5:return this.media=t,r=this.mediaSource=new bx,t.src=URL.createObjectURL(r),n=function e(){r.removeEventListener("sourceopen",e),URL.revokeObjectURL(t.src),i._openPromise.resolve()},r.addEventListener("sourceopen",n),e.abrupt("return",this._openPromise);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"unbindMedia",value:(r=OP(zP.mark((function e(){var t,r=this;return zP.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._openPromise.used||this._openPromise.resolve(),t=this.mediaSource){if(Object.keys(this._queue).forEach((function(e){var t=r._queue[e];t&&t.forEach((function(e){return e.promise.resolve}))})),"open"===t.readyState)try{t.endOfStream()}catch(EU){}Object.keys(this._sourceBuffer).forEach((function(e){try{t.removeSourceBuffer(r._sourceBuffer[e])}catch(EU){}}))}if(this.media){this.media.removeAttribute("src");try{this.media.load()}catch(EU){}this.media=null}this.mediaSource=null,this._openPromise=ox(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"createSource",value:function(e,t){if(!this._sourceBuffer[e]&&this.mediaSource){var r;try{r=this._sourceBuffer[e]=this.mediaSource.addSourceBuffer(t)}catch(EU){throw new _x(gx,mx.MSE_ADD_SB,EU)}r.mimeType=t,r.addEventListener("updateend",this._onSBUpdateEnd.bind(this,e)),r.addEventListener("error",this._onSBUpdateError.bind(this,e))}}},{key:"changeType",value:function(e,t){var r=this._sourceBuffer[e];return this.mediaSource&&r&&r.mimeType!==t&&"function"==typeof r.changeType?this._enqueueOp((function(){r.changeType(t)})):Promise.resolve()}},{key:"createOrChangeSource",value:function(e,t){return this.createSource(e,t),this.changeType(e,t)}},{key:"append",value:function(e,t){var r=this;return t&&t.byteLength&&this._sourceBuffer[e]?this._enqueueOp(e,(function(){r.mediaSource&&r._sourceBuffer[e].appendBuffer(t)})):Promise.resolve()}},{key:"remove",value:function(e,t,r){var n=this;if(1!==Object.keys(this._sourceBuffer).length)return this._enqueueOp(e,(function(){if(n.mediaSource){var i=n._sourceBuffer[e];t>=r||!i?n._onSBUpdateEnd(e):i.remove(t,r)}}))}},{key:"clearBuffer",value:function(e,t){var r,n=this;return Object.keys(this._sourceBuffer).forEach((function(i){r=n._enqueueOp(i,(function(){n.mediaSource&&n._sourceBuffer[i].remove(e,t)}))})),r}},{key:"clearAllBuffer",value:function(){var e,t=this;return Object.keys(this._sourceBuffer).forEach((function(r){e=t._enqueueOp(r,(function(){if(t.mediaSource){var e=t._sourceBuffer[r];e.remove(0,ux.end(ux.get(e)))}}))})),e}},{key:"endOfStream",value:function(e){var t=this;return this.mediaSource&&"open"===this.mediaSource.readyState?this._enqueueBlockingOp((function(){var r=t.mediaSource;r&&"open"===r.readyState&&(e?r.endOfStream(e):r.endOfStream())})):Promise.resolve()}},{key:"setLiveSeekableRange",value:function(e,t){var r=this.mediaSource;e<0||t<e||null==r||!r.setLiveSeekableRange||"open"!==r.readyState||r.setLiveSeekableRange(e,t)}},{key:"buffered",value:function(e){return ux.get(this._sourceBuffer[e])}},{key:"bufferStart",value:function(e){return ux.start(this.buffered(e))}},{key:"bufferEnd",value:function(e){return ux.end(this.buffered(e))}},{key:"_enqueueOp",value:function(e,t){if(!this.mediaSource)return Promise.resolve();var r=this._queue[e]=this._queue[e]||[],n={exec:t,promise:ox()};return r.push(n),1===r.length&&this._startQueue(e),n.promise}},{key:"_enqueueBlockingOp",value:(t=OP(zP.mark((function e(t){var r,n,i=this;return zP.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mediaSource){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if((r=Object.keys(this._sourceBuffer)).length){e.next=5;break}return e.abrupt("return",t());case 5:return n=[],r.forEach((function(e){var t=i._queue[e],r=ox();n.push(r),t.push({exec:function(){return r.resolve()},promise:r}),1===t.length&&i._startQueue(e)})),e.abrupt("return",Promise.all(n).then((function(){try{return t()}finally{r.forEach((function(e){var t=i._queue[e],r=i._sourceBuffer[e];null==t||t.shift(),r&&r.updating||i._startQueue(e)}))}})));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_startQueue",value:function(e){var t=this._queue[e];if(t){var r=t[0];if(r)try{r.exec()}catch(EU){r.promise.reject(new _x(gx,mx.MSE_OTHER,EU)),t.shift(),this._startQueue(e)}}}}],[{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if(!bx)return!1;try{return bx.isTypeSupported(e)}catch(EU){return!1}}}]),e}();MP(Ax,"VIDEO","video"),MP(Ax,"AUDIO","audio");var Ex=di,Sx=ps,Tx=m,wx=ae,Cx=Q,kx=Ya,Ix=Fc,$x=un,Px=Sx&&Sx.prototype;if(Ex({target:"Promise",proto:!0,real:!0,forced:!!Sx&&Tx((function(){Px.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=kx(this,wx("Promise")),r=Cx(e);return this.then(r?function(r){return Ix(t,e()).then((function(){return r}))}:e,r?function(r){return Ix(t,e()).then((function(){throw r}))}:e)}}),Cx(Sx)){var xx=wx("Promise").prototype.finally;Px.finally!==xx&&$x(Px,"finally",xx,{unsafe:!0})}var Rx="fetch",Ox="xhr",Dx="arraybuffer",Lx="text",Mx="json";function Nx(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=jP(e);if(t){var i=jP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return FP(this,r)}}var Bx=function(e){UP(r,e);var t=Nx(r);function r(e,n,i,a){var o;return NP(this,r),MP(VP(o=t.call(this,a)),"retryCount",0),MP(VP(o),"isTimeout",!1),MP(VP(o),"loaderType",Rx),MP(VP(o),"startTime",0),MP(VP(o),"endTime",0),o.url=e,o.request=n,o.response=i,o}return r}(WP(Error)),Ux=hd.filter;di({target:"Array",proto:!0,forced:!qi("filter")},{filter:function(e){return Ux(this,e,arguments.length>1?arguments[1]:void 0)}});var Gx=Ke,Vx=Wh,Fx=Bh;di({target:"Object",stat:!0,forced:m((function(){Vx(1)})),sham:!Fx},{getPrototypeOf:function(e){return Vx(Gx(e))}});var jx=Object.prototype.toString;function Hx(e){if("[object Object]"!==jx.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function Zx(e){if(e&&null!=e[0]&&(0!==e[0]||null!=e[1])){var t="bytes="+e[0]+"-";return e[1]&&(t+=e[1]),t}}function Wx(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Kx(e,t){if(e){if(!t)return e;var r,n=Object.keys(t).map((function(e){if(null!=(r=t[e]))return Array.isArray(r)?e+="[]":r=[r],r.map((function(t){var r,n;return r=t,"[object Date]"===jx.call(r)?t=t.toISOString():null!==(n=t)&&"object"===GP(n)&&(t=JSON.stringify(t)),"".concat(Wx(e),"=").concat(Wx(t))})).join("&")})).filter(Boolean).join("&");if(n){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}}function Xx(e,t,r,n,i,a){return n=null!=n?parseFloat(n):null,r=parseInt(r||"0",10),isNaN(r)&&(r=0),{data:e,response:t,contentLength:r,age:n,startTime:i,firstByteTime:a,endTime:Date.now()}}var Yx=function(){function e(){NP(this,e),MP(this,"_abortController",null),MP(this,"_timeoutTimer",null),MP(this,"_reader",null),MP(this,"_response",null),MP(this,"_aborted",!1)}var t;return LP(e,[{key:"load",value:function(e){var t,r=this,n=e.url,i=e.timeout,a=e.responseType,o=e.onProgress,s=e.onTimeout,u=e.range,c=e.transformResponse,l=e.request,d=e.params,h=e.method,f=e.headers,p=e.body,g=e.mode,y=e.credentials,m=e.cache,v=e.redirect,_=e.referrer,b=e.referrerPolicy;this._aborted=!1,this._abortController="undefined"!=typeof AbortController&&new AbortController;var A={method:h,headers:f,body:p,mode:g,credentials:y,cache:m,redirect:v,referrer:_,referrerPolicy:b,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal},E=!1;clearTimeout(this._timeoutTimer),n=Kx(n,d);var S=Zx(u);S&&((f=l?l.headers:A.headers=A.headers||new Headers)instanceof Headers?f.append("Range",S):f.Range=S),i&&(this._timeoutTimer=setTimeout((function(){if(E=!0,r.cancel(),s){var e=new Bx(n,A);e.isTimeout=!0,s(e)}}),i));var T,w=Date.now();return fetch(l||n,l?void 0:A).then((T=OP(zP.mark((function e(t){var i,s;return zP.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(clearTimeout(r._timeoutTimer),r._response=t,!r._aborted){e.next=4;break}return e.abrupt("return");case 4:if(c&&(t=c(t,n)||t),t.ok){e.next=7;break}throw new Bx(n,A,t,"bad network response");case 7:if(i=Date.now(),a!==Lx){e.next=14;break}return e.next=11,t.text();case 11:s=e.sent,e.next=28;break;case 14:if(a!==Mx){e.next=20;break}return e.next=17,t.json();case 17:s=e.sent,e.next=28;break;case 20:if(!o){e.next=24;break}r._loadChunk(t,o),e.next=28;break;case 24:return e.next=26,t.arrayBuffer();case 26:s=e.sent,s=new Uint8Array(s);case 28:return e.abrupt("return",Xx(s,t,t.headers.get("Content-Length"),t.headers.get("age"),w,i));case 29:case"end":return e.stop()}}),e)}))),function(e){return T.apply(this,arguments)})).catch((function(e){if(clearTimeout(r._timeoutTimer),!r._aborted||E)throw(e=e instanceof Bx?e:new Bx(n,A)).startTime=w,e.endTime=Date.now(),e.isTimeout=E,e}))}},{key:"cancel",value:(t=OP(zP.mark((function e(){return zP.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,!this._response){e.next=13;break}if(e.prev=4,!this._reader){e.next=8;break}return e.next=8,this._reader.cancel();case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(4);case 12:this._response=this._reader=null;case 13:if(this._abortController){try{this._abortController.abort()}catch(EU){}this._abortController=null}case 14:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(){return t.apply(this,arguments)})},{key:"_loadChunk",value:function(e,t){var r,n,i,a,o=this,s=this._reader=e.body.getReader(),u=(a=OP(zP.mark((function a(){return zP.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=Date.now(),a.prev=1,a.next=4,s.read();case 4:r=a.sent,i=Date.now(),a.next=13;break;case 8:return a.prev=8,a.t0=a.catch(1),i=Date.now(),t(void 0,!0,{startTime:n,endTime:i},e),a.abrupt("return");case 13:if(!o._aborted){a.next=16;break}return t(void 0,!0,{startTime:n,endTime:i},e),a.abrupt("return");case 16:t(r.value,r.done,{startTime:n,endTime:i},e),r.done||u();case 18:case"end":return a.stop()}}),a,null,[[1,8]])}))),function(){return a.apply(this,arguments)});u()}}],[{key:"isSupported",value:function(){return!("undefined"==typeof fetch)}}]),e}(),zx=di,Jx=m,Qx=J,qx=y.f,eR=v,tR=Jx((function(){qx(1)}));function rR(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function nR(e){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rR(Object(r),!0).forEach((function(t){MP(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rR(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({loaderType:Rx,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:Lx,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0},e)}function iR(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}zx({target:"Object",stat:!0,forced:!eR||tR,sham:!eR},{getOwnPropertyDescriptor:function(e,t){return qx(Qx(e),t)}});var aR=v,oR=dr.EXISTS,sR=L,uR=Ut.f,cR=Function.prototype,lR=sR(cR.toString),dR=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,hR=sR(dR.exec);aR&&!oR&&uR(cR,"name",{configurable:!0,get:function(){try{return hR(dR,lR(this))[1]}catch(EU){return""}}});var fR=zp;di({target:"Array",stat:!0,forced:!yc((function(e){Array.from(e)}))},{from:fR});var pR=di,gR=v,yR=g,mR=L,vR=ze,_R=Q,bR=oe,AR=Xc,ER=Ut.f,SR=Xn,TR=yR.Symbol,wR=TR&&TR.prototype;if(gR&&_R(TR)&&(!("description"in wR)||void 0!==TR().description)){var CR={},kR=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:AR(arguments[0]),t=bR(wR,this)?new TR(e):void 0===e?TR():TR(e);return""===e&&(CR[t]=!0),t};SR(kR,TR),kR.prototype=wR,wR.constructor=kR;var IR="Symbol(test)"==String(TR("test")),$R=mR(wR.valueOf),PR=mR(wR.toString),xR=/^Symbol\((.*)\)[^)]+$/,RR=mR("".replace),OR=mR("".slice);ER(wR,"description",{configurable:!0,get:function(){var e=$R(this);if(vR(CR,e))return"";var t=PR(e),r=IR?OR(t,7,-1):RR(t,xR,"$1");return""===r?void 0:r}}),pR({global:!0,constructor:!0,forced:!0},{Symbol:kR})}sI("iterator");var DR,LR=dr.PROPER,MR=m,NR=A_,BR=$_.trim;function UR(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return GR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?GR(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function GR(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}di({target:"String",proto:!0,forced:(DR="trim",MR((function(){return!!NR[DR]()||"â€‹Â…á Ž"!=="â€‹Â…á Ž"[DR]()||LR&&NR[DR].name!==DR})))},{trim:function(){return BR(this)}});var VR=function(){function e(){NP(this,e),MP(this,"_xhr",null),MP(this,"_aborted",!1),MP(this,"_timeoutTimer",null)}return LP(e,[{key:"load",value:function(e){var t=this;clearTimeout(this._timeoutTimer);var r=e.url,n=e.params,i=e.timeout,a=e.responseType,o=e.onTimeout,s=e.transformResponse,u=e.onProgress,c=e.method,l=e.credentials,d=e.body,h=e.headers,f=e.range,p=e.request,g=!1;r=Kx(r,n);var y=Date.now();return new Promise((function(e,n){var m=t._xhr=new XMLHttpRequest;m.open(c||"GET",r,!0),m.responseType=a,m.withCredentials="include"===l||"same-origin"===l;var v=Zx(f);v&&((h=h||{}).Range=v),h&&Object.keys(h).forEach((function(e){m.setRequestHeader(e,h[e])})),i&&(t._timeoutTimer=setTimeout((function(){if(g=!0,t.cancel(),o){var e=new Bx(r,p);e.isTimeout=!0,o(e)}}),i)),m.onerror=function(e){return n(e)},m.onreadystatechange=function(){if(m.readyState>=2){clearTimeout(t._timeoutTimer);var i=Date.now();if(4===m.readyState){if(m.onreadystatechange=null,t._aborted)return;var a=m.status,o={ok:a>=200&&a<300,status:a,statusText:m.statusText,url:m.responseURL,headers:t._getHeaders(m),body:m.response};if(s&&(o=s(o,r)||o),!o.ok)return n(new Bx(r,p,o,"bad network response"));var c=m.responseType===Dx,l=c?new Uint8Array(m.response):m.response;u&&u(c?l:void 0,!0,{startTime:y,endTime:Date.now()},o),e(Xx(l,o,o.headers["content-length"],o.headers.age,y,i))}}},m.send(d)})).catch((function(e){if(clearTimeout(t._timeoutTimer),!t._aborted||g)throw(e=e instanceof Bx?e:new Bx(r,p)).startTime=y,e.endTime=Date.now(),e.isTimeout=g,e}))}},{key:"cancel",value:function(){if(!this._aborted)return this._aborted=!0,this._xhr?this._xhr.cancel():void 0}},{key:"_getHeaders",value:function(e){var t,r={},n=UR(e.getAllResponseHeaders().trim().split("\r\n"));try{for(n.s();!(t=n.n()).done;){var i=t.value.split(": ");r[i[0].toLowerCase()]=i.slice(1).join(": ")}}catch(a){n.e(a)}finally{n.f()}return r}}],[{key:"isSupported",value:function(){return"undefined"!=typeof XMLHttpRequest}}]),e}(),FR=["retry","retryDelay","onRetryError","transformError"],jR=function(){function e(t,r){NP(this,e),this.promise=ox(),this.alive=!!r.onProgress,this._loaderType=t,this._loader=t===Rx?new Yx:new VR,this._config=r,this._retryCount=0,this._retryTimer=null,this._canceled=!1}var t;return LP(e,[{key:"exec",value:function(){var e,t=this,r=this._config,n=r.retry,i=r.retryDelay,a=r.onRetryError,o=r.transformError,s=iR(r,FR),u=(e=OP(zP.mark((function e(){var r,c;return zP.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t._loader.load(s);case 3:r=e.sent,t.promise.resolve(r),e.next=22;break;case 7:if(e.prev=7,e.t0=e.catch(0),!t._canceled){e.next=11;break}return e.abrupt("return");case 11:if(e.t0.loaderType=t._loaderType,e.t0.retryCount=t._retryCount,c=e.t0,o&&(c=o(c)||c),a&&t._retryCount>0&&a(c,t._retryCount,n),t._retryCount++,!(t._retryCount<=n)){e.next=21;break}return clearTimeout(t._retryTimer),t._retryTimer=setTimeout(u,i),e.abrupt("return");case 21:t.promise.reject(c);case 22:case"end":return e.stop()}}),e,null,[[0,7]])}))),function(){return e.apply(this,arguments)});return u(),this.promise}},{key:"cancel",value:(t=OP(zP.mark((function e(){return zP.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,e.abrupt("return",this._loader.cancel());case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function HR(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if((t=t.filter(Boolean)).length<2)return t[0];var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){n.set(e,i),i+=e.byteLength})),n}function ZR(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))}var WR=function(){function e(t){NP(this,e),MP(this,"type",Rx),MP(this,"_queue",[]),MP(this,"_alive",[]),MP(this,"_currentTask",null),this._config=nR(t),this._config.loaderType!==Ox&&Yx.isSupported()||(this.type=Ox)}var t;return LP(e,[{key:"isFetch",value:function(){return this.type===Rx}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"!=typeof e&&e?t=e:t.url=e||t.url||this._config.url,(t=Object.assign({},this._config,t)).params&&(t.params=Object.assign({},t.params)),t.headers&&Hx(t.headers)&&(t.headers=Object.assign({},t.headers)),t.body&&Hx(t.body)&&(t.body=Object.assign({},t.body)),t.transformRequest&&(t=t.transformRequest(t)||t);var r=new jR(this.type,t);return this._queue.push(r),1===this._queue.length&&this._processTask(),r.promise}},{key:"cancel",value:(t=OP(zP.mark((function e(){var t;return zP.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._queue.map((function(e){return e.cancel()})).concat(this._alive.map((function(e){return e.cancel()}))),this._currentTask&&t.push(this._currentTask.cancel()),this._queue=[],this._alive=[],e.next=6,Promise.all(t);case 6:return e.next=8,ZR();case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_processTask",value:function(){var e=this;this._currentTask=this._queue.shift(),this._currentTask&&(this._currentTask.alive&&this._alive.push(this._currentTask),this._currentTask.exec().catch((function(){})).finally((function(){e._processTask()})))}}],[{key:"isFetchSupport",value:function(){return Yx.isSupported()}}]),e}(),KR={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT"},XR=function(){function e(t){NP(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return LP(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).debug.apply(t,[this._prefix].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,[this._prefix].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).error.apply(t,[this._prefix].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();MP(XR,"disabled",!0);var YR=function(){function e(){NP(this,e),MP(this,"_prevCurrentTime",0)}return LP(e,[{key:"do",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(e){var i=e.currentTime,a=0;if(this._prevCurrentTime===i){var o=ux.info(ux.get(e),i);if(!o.buffers.length)return;r&&o.nextStart||o.nextStart&&o.nextStart-i<t?a=o.nextStart+.1:o.end&&o.end-i>n&&!e.seeking&&(a=i+.1)}this._prevCurrentTime=i,a&&i!==a&&(e.currentTime=a)}}}]),e}(),zR={exports:{}},JR=m((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),QR=m,qR=te,eO=U,tO=JR,rO=Object.isExtensible,nO=QR((function(){rO(1)}))||tO?function(e){return!!qR(e)&&(!tO||"ArrayBuffer"!=eO(e))&&(!rO||rO(e))}:rO,iO=!m((function(){return Object.isExtensible(Object.preventExtensions({}))})),aO=di,oO=L,sO=Cr,uO=te,cO=ze,lO=Ut.f,dO=cn,hO=Yk,fO=nO,pO=iO,gO=!1,yO=tt("meta"),mO=0,vO=function(e){lO(e,yO,{value:{objectID:"O"+mO++,weakData:{}}})},_O=zR.exports={enable:function(){_O.enable=function(){},gO=!0;var e=dO.f,t=oO([].splice),r={};r[yO]=1,e(r).length&&(dO.f=function(r){for(var n=e(r),i=0,a=n.length;i<a;i++)if(n[i]===yO){t(n,i,1);break}return n},aO({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:hO.f}))},fastKey:function(e,t){if(!uO(e))return"symbol"==_typeof$7(e)?e:("string"==typeof e?"S":"P")+e;if(!cO(e,yO)){if(!fO(e))return"F";if(!t)return"E";vO(e)}return e[yO].objectID},getWeakData:function(e,t){if(!cO(e,yO)){if(!fO(e))return!0;if(!t)return!1;vO(e)}return e[yO].weakData},onFreeze:function(e){return pO&&gO&&fO(e)&&!cO(e,yO)&&vO(e),e}};sO[yO]=!0;var bO=di,AO=g,EO=L,SO=ni,TO=un,wO=zR.exports,CO=dc,kO=Ga,IO=Q,$O=Z,PO=te,xO=m,RO=yc,OO=Ra,DO=DE,LO=Ut.f,MO=xl,NO=yg,BO=io,UO=Ga,GO=Z,VO=dc,FO=If,jO=Na,HO=v,ZO=zR.exports.fastKey,WO=Hr.set,KO=Hr.getterFor,XO={getConstructor:function(e,t,r,n){var i=e((function(e,i){UO(e,a),WO(e,{type:t,index:MO(null),first:void 0,last:void 0,size:0}),HO||(e.size=0),GO(i)||VO(i,e[n],{that:e,AS_ENTRIES:r})})),a=i.prototype,o=KO(t),s=function(e,t,r){var n,i,a=o(e),s=u(e,t);return s?s.value=r:(a.last=s={index:i=ZO(t,!0),key:t,value:r,previous:n=a.last,next:void 0,removed:!1},a.first||(a.first=s),n&&(n.next=s),HO?a.size++:e.size++,"F"!==i&&(a.index[i]=s)),e},u=function(e,t){var r,n=o(e),i=ZO(t);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key==t)return r};return NO(a,{clear:function(){for(var e=o(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,HO?e.size=0:this.size=0},delete:function(e){var t=this,r=o(t),n=u(t,e);if(n){var i=n.next,a=n.previous;delete r.index[n.index],n.removed=!0,a&&(a.next=i),i&&(i.previous=a),r.first==n&&(r.first=i),r.last==n&&(r.last=a),HO?r.size--:t.size--}return!!n},forEach:function(e){for(var t,r=o(this),n=BO(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!u(this,e)}}),NO(a,r?{get:function(e){var t=u(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),HO&&LO(a,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,r){var n=t+" Iterator",i=KO(t),a=KO(n);FO(e,t,(function(e,t){WO(this,{type:n,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=a(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?"keys"==t?{value:r.key,done:!1}:"values"==t?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),jO(t)}};!function(e,t,r){var n=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),a=n?"set":"add",o=AO[e],s=o&&o.prototype,u=o,c={},l=function(e){var t=EO(s[e]);TO(s,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!PO(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return i&&!PO(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!PO(e))&&t(this,0===e?0:e)}:function(e,r){return t(this,0===e?0:e,r),this})};if(SO(e,!IO(o)||!(i||s.forEach&&!xO((function(){(new o).entries().next()})))))u=r.getConstructor(t,e,n,a),wO.enable();else if(SO(e,!0)){var d=new u,h=d[a](i?{}:-0,1)!=d,f=xO((function(){d.has(1)})),p=RO((function(e){new o(e)})),g=!i&&xO((function(){for(var e=new o,t=5;t--;)e[a](t,t);return!e.has(-0)}));p||((u=t((function(e,t){kO(e,s);var r=DO(new o,e,u);return $O(t)||CO(t,r[a],{that:r,AS_ENTRIES:n}),r}))).prototype=s,s.constructor=u),(f||g)&&(l("delete"),l("has"),n&&l("get")),(g||h)&&l(a),i&&s.clear&&delete s.clear}c[e]=u,bO({global:!0,constructor:!0,forced:u!=o},c),OO(u,e),i||r.setStrong(u,e,n)}("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),XO);var YO=function(){function e(t){var r=this;NP(this,e),MP(this,"_seiSet",new Set),this.emitter=t,t.on(KR.SEI,(function(e){e&&r._seiSet.add(e)}))}return LP(e,[{key:"throw",value:function(e){var t=this;if(null!=e&&this._seiSet.size){var r=e-.2,n=e+.2,i=[];this._seiSet.forEach((function(e){e.time>=r&&e.time<=n&&i.push(e)})),i.forEach((function(e){t._seiSet.delete(e),t.emitter.emit(KR.SEI_IN_TIME,e)}))}}},{key:"reset",value:function(){this._seiSet.clear()}}]),e}(),zO=function(){function e(){NP(this,e),MP(this,"_chunkSpeeds",[]),MP(this,"_speeds",[])}return LP(e,[{key:"addRecord",value:function(e,t){e&&t&&(this._speeds.push(8e3*e/t),this._speeds=this._speeds.slice(-3))}},{key:"addChunkRecord",value:function(e,t){e&&t&&(this._chunkSpeeds.push(8e3*e/t),this._chunkSpeeds=this._chunkSpeeds.slice(-10))}},{key:"getAvgSpeed",value:function(){return this._chunkSpeeds.length||this._speeds.length?this._speeds.length?this._speeds.reduce((function(e,t){return e+t}))/this._speeds.length:this._chunkSpeeds.reduce((function(e,t){return e+t}))/this._chunkSpeeds.length:0}},{key:"getLatestSpeed",value:function(){return this._chunkSpeeds.length||this._speeds.length?this._speeds.length?this._speeds[this._speeds.length-1]:this._chunkSpeeds[this._chunkSpeeds.length-1]:0}},{key:"reset",value:function(){this._chunkSpeeds=[],this._speeds=[]}}]),e}(),JO=di,QO=hd.find,qO=Nh,eD="find",tD=!0;eD in[]&&Array(1).find((function(){tD=!1})),JO({target:"Array",proto:!0,forced:tD},{find:function(e){return QO(this,e,arguments.length>1?arguments[1]:void 0)}}),qO(eD);var rD={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,n,a,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,a||e,o),u=r?r+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,a=n.length,o=new Array(a);i<a;i++)o[i]=n[i].fn;return o},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,a,o){var s=r?r+e:e;if(!this._events[s])return!1;var u,c,l=this._events[s],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,i),!0;case 5:return l.fn.call(l.context,t,n,i,a),!0;case 6:return l.fn.call(l.context,t,n,i,a,o),!0}for(c=1,u=new Array(d-1);c<d;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var h,f=l.length;for(c=0;c<f;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),d){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,n);break;case 4:l[c].fn.call(l[c].context,t,n,i);break;default:if(!u)for(h=1,u=new Array(d-1);h<d;h++)u[h-1]=arguments[h];l[c].fn.apply(l[c].context,u)}}return!0},s.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||o(this,a);else{for(var u=0,c=[],l=s.length;u<l;u++)(s[u].fn!==t||i&&!s[u].once||n&&s[u].context!==n)&&c.push(s[u]);c.length?this._events[a]=1===c.length?c[0]:c:o(this,a)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}(rD);var nD=rD.exports,iD=kn.includes,aD=Nh;di({target:"Array",proto:!0,forced:m((function(){return!Array(1).includes()}))},{includes:function(e){return iD(this,e,arguments.length>1?arguments[1]:void 0)}}),aD("includes");var oD=ok,sD=TypeError,uD=ht("match"),cD=di,lD=function(e){if(oD(e))throw sD("The method doesn't accept regular expressions");return e},dD=X,hD=Xc,fD=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[uD]=!1,"/./"[e](t)}catch(n){}}return!1},pD=L("".indexOf);cD({target:"String",proto:!0,forced:!fD("includes")},{includes:function(e){return!!~pD(hD(dD(this)),hD(lD(e)),arguments.length>1?arguments[1]:void 0)}});var gD=g.isFinite;di({target:"Number",stat:!0},{isFinite:Number.isFinite||function(e){return"number"==typeof e&&gD(e)}});var yD=L(1..valueOf),mD=v,vD=g,_D=L,bD=ni,AD=un,ED=ze,SD=DE,TD=oe,wD=Se,CD=bt,kD=m,ID=cn.f,$D=y.f,PD=Ut.f,xD=yD,RD=$_.trim,OD="Number",DD=vD.Number,LD=DD.prototype,MD=vD.TypeError,ND=_D("".slice),BD=_D("".charCodeAt),UD=function(e){var t=CD(e,"number");return"bigint"==typeof t?t:GD(t)},GD=function(e){var t,r,n,i,a,o,s,u,c=CD(e,"number");if(wD(c))throw MD("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=RD(c),43===(t=BD(c,0))||45===t){if(88===(r=BD(c,2))||120===r)return NaN}else if(48===t){switch(BD(c,1)){case 66:case 98:n=2,i=49;break;case 79:case 111:n=8,i=55;break;default:return+c}for(o=(a=ND(c,2)).length,s=0;s<o;s++)if((u=BD(a,s))<48||u>i)return NaN;return parseInt(a,n)}return+c};if(bD(OD,!DD(" 0o1")||!DD("0b1")||DD("+0x1"))){for(var VD,FD=function e(t){var r=arguments.length<1?0:DD(UD(t)),n=this;return TD(LD,n)&&kD((function(){xD(n)}))?SD(Object(r),n,e):r},jD=mD?ID(DD):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),HD=0;jD.length>HD;HD++)ED(DD,VD=jD[HD])&&!ED(FD,VD)&&PD(FD,VD,$D(DD,VD));FD.prototype=LD,LD.constructor=FD,AD(vD,OD,FD,{constructor:!0})}var ZD="video",WD="audio",KD="metadata",XD="avc",YD="hevc",zD="aac",JD="g7110a",QD="g7110m",qD="LARGE_AV_SHIFT",eL="LARGE_VIDEO_GAP",tL="LARGE_VIDEO_GAP_BETWEEN_CHUNK",rL="LARGE_AUDIO_GAP",nL="AUDIO_FILLED",iL="AUDIO_DROPPED",aL="undefined"!=typeof window,oL=aL&&navigator.userAgent.toLocaleLowerCase(),sL=aL&&/^((?!chrome|android).)*safari/.test(oL),uL=aL&&oL.includes("firefox"),cL=aL&&oL.includes("android"),lL=function(){function e(){NP(this,e)}return LP(e,null,[{key:"getRateIndexByRate",value:function(t){return e.FREQ.indexOf(t)}},{key:"parseADTS",value:function(t,r){for(var n=t.length,i=0;i+2<n&&(255!==t[i]||240!=(246&t[i+1]));)i++;if(!(i>=n)){var a=i,o=[],s=(60&t[i+2])>>>2,u=e.FREQ[s];if(!u)throw new Error("Invalid sampling index: ".concat(s));for(var c,l,d=1+((192&t[i+2])>>>6),h=(1&t[i+2])<<2|(192&t[i+3])>>>6,f=e._getConfig(s,h,d),p=f.config,g=f.codec,y=0,m=e.getFrameDuration(u);i+7<n;)if(255===t[i]&&240==(246&t[i+1])){if(n-i<(l=(3&t[i+3])<<11|t[i+4]<<3|(224&t[i+5])>>5))break;c=2*(1&~t[i+1]),o.push({pts:r+y*m,data:t.subarray(i+7+c,i+l)}),y++,i+=l}else i++;return{skip:a,remaining:i>=n?void 0:t.subarray(i),frames:o,samplingFrequencyIndex:s,sampleRate:u,objectType:d,channelCount:h,codec:g,config:p,originCodec:"mp4a.40.".concat(d)}}}},{key:"parseAudioSpecificConfig",value:function(t){if(t.length){var r=t[0]>>>3,n=(7&t[0])<<1|t[1]>>>7,i=(120&t[1])>>>3,a=e.FREQ[n];if(!a)throw new Error("Invalid sampling index: ".concat(n));var o=e._getConfig(n,i,r);return{samplingFrequencyIndex:n,sampleRate:a,objectType:r,channelCount:i,config:o.config,codec:o.codec,originCodec:"mp4a.40.".concat(r)}}}},{key:"getFrameDuration",value:function(e){return 1024*(arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4)/e}},{key:"_getConfig",value:function(e,t,r){var n,i,a=[];return uL?e>=6?(n=5,i=e-3):(n=2,i=e):cL?(n=2,i=e):(n=2===r||5===r?r:5,i=e,e>=6?i=e-3:1===t&&(n=2,i=e)),a[0]=n<<3,a[0]|=(14&e)>>1,a[1]=(1&e)<<7,a[1]|=t<<3,5===n&&(a[1]|=(14&i)>>1,a[2]=(1&i)<<7,a[2]|=8,a[3]=0),{config:a,codec:"mp4a.40.".concat(n)}}},{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}]),e}();MP(lL,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var dL=function e(t,r,n){NP(this,e),MP(this,"duration",1024),MP(this,"flag",{dependsOn:2,isNonSyncSample:0}),this.originPts=this.pts=this.dts=t,this.data=r,this.size=r.byteLength,n&&(this.duration=n)};function hL(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=t.filter(Boolean);var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){n.set(e,i),i+=e.byteLength})),n}var fL=Math.pow(2,32);function pL(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<8)+(e[t+1]||0)}function gL(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<24>>>0)+(e[t+1]<<16)+(e[t+2]<<8)+(e[t+3]||0)}function yL(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return gL(e,t)*fL+gL(e,t+4)}function mL(e){for(var t,r="avc1.",n=0;n<3;n++)(t=e[n].toString(16)).length<2&&(t="0".concat(t)),r+=t;return r}var vL=function(){function e(t){NP(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return LP(e,[{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();MP(vL,"disabled",!0);var _L=function(){function e(){NP(this,e)}return LP(e,null,[{key:"parseAnnexB",value:function(e){for(var t=e.length,r=2,n=0;null!=e[r]&&1!==e[r];)r++;if((n=2+ ++r)>=t)return[];for(var i=[];n<t;)switch(e[n]){case 0:if(0!==e[n-1]){n+=2;break}if(0!==e[n-2]){n++;break}r!==n-2&&i.push(e.subarray(r,n-2));do{n++}while(1!==e[n]&&n<t);n=(r=n+1)+2;break;case 1:if(0!==e[n-1]||0!==e[n-2]){n+=3;break}r!==n-2&&i.push(e.subarray(r,n-2)),n=(r=n+1)+2;break;default:n+=3}return r<t&&i.push(e.subarray(r)),i}},{key:"parseAvcC",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(!(e.length<4)){for(var r,n=e.length,i=[],a=0;a+t<n;)if(r=gL(e,a),3===t&&(r>>>=8),a+=t,r){if(a+r>n)break;i.push(e.subarray(a,a+r)),a+=r}return i}}},{key:"parseSEI",value:function(e){for(var t=e.length,r=1,n=0,i=0,a="";255===e[r];)n+=255,r++;for(n+=e[r++];255===e[r];)i+=255,r++;if(i+=e[r++],5===n&&t>r+16)for(var o=0;o<16;o++)a+=e[r].toString(16),r++;return{payload:e.subarray(r),type:n,size:i,uuid:a}}},{key:"removeEPB",value:function(e){for(var t=e.byteLength,r=[],n=1;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(!r.length)return e;var i=t-r.length,a=new Uint8Array(i),o=0;for(n=0;n<i;o++,n++)o===r[0]&&(o++,r.shift()),a[n]=e[o];return a}}]),e}(),bL=function(){function e(t){if(NP(this,e),MP(this,"_bytesAvailable",void 0),MP(this,"_bitsAvailable",0),MP(this,"_word",0),!t)throw new Error("ExpGolomb data params is required");this._data=t,this._bytesAvailable=t.byteLength,this._bytesAvailable&&this._loadWord()}return LP(e,[{key:"_loadWord",value:function(){var e=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(0===t)throw new Error("No bytes available");var r=new Uint8Array(4);r.set(this._data.subarray(e,e+t)),this._word=new DataView(r.buffer).getUint32(0),this._bitsAvailable=8*t,this._bytesAvailable-=t}},{key:"skipBits",value:function(e){if(this._bitsAvailable>e)this._word<<=e,this._bitsAvailable-=e;else{e-=this._bitsAvailable;var t=Math.floor(e/8);e-=8*t,this._bytesAvailable-=t,this._loadWord(),this._word<<=e,this._bitsAvailable-=e}}},{key:"readBits",value:function(e){if(e>32)throw new Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,e),r=this._word>>>32-t;return this._bitsAvailable-=t,this._bitsAvailable>0?this._word<<=t:this._bytesAvailable>0&&this._loadWord(),(t=e-t)>0&&this._bitsAvailable?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this._bitsAvailable;++e)if(0!=(this._word&2147483648>>>e))return this._word<<=e,this._bitsAvailable-=e,e;return this._loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(e){for(var t=8,r=8,n=0;n<e;n++)0!==r&&(r=(t+this.readEG()+256)%256),t=0===r?t:r}}]),e}(),AL=function(){function e(){NP(this,e)}return LP(e,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(t.length<23)){r=r||{};for(var n,i,a,o,s,u=1+(3&t[21]),c=[],l=[],d=[],h=23,f=t[22],p=0;p<f;p++){a=63&t[h],o=t[h+1]<<8|t[h+2],h+=3;for(var g=0;g<o;g++)if(s=t[h]<<8|t[h+1],h+=2,s){switch(a){case 32:var y=t.subarray(h,h+s);n||(n=e.parseVPS(_L.removeEPB(y),r)),d.push(y);break;case 33:var m=t.subarray(h,h+s);i||(i=e.parseSPS(_L.removeEPB(m),r)),c.push(m);break;case 34:l.push(t.subarray(h,h+s))}h+=s}}return{hvcC:r,sps:i,spsArr:c,ppsArr:l,vpsArr:d,nalUnitSize:u}}}},{key:"parseVPS",value:function(t,r){r=r||{};var n=new bL(t);n.readUByte(),n.readUByte(),n.readBits(12);var i=n.readBits(3);return r.numTemporalLayers=Math.max(r.numTemporalLayers||0,i+1),n.readBits(17),e._parseProfileTierLevel(n,i,r),r}},{key:"parseSPS",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r=r||{};var n=new bL(t);n.readUByte(),n.readUByte(),n.readBits(4);var i=n.readBits(3);r.numTemporalLayers=Math.max(i+1,r.numTemporalLayers||0),r.temporalIdNested=n.readBits(1),e._parseProfileTierLevel(n,i,r),n.readUEG();var a=r.chromaFormatIdc=n.readUEG(),o=420;a<=3&&(o=[0,420,422,444][a]);var s=0;3===a&&(s=n.readBits(1));var u,c,l,d,h=n.readUEG(),f=n.readUEG(),p=n.readBits(1);return 1===p&&(u=n.readUEG(),c=n.readUEG(),l=n.readUEG(),d=n.readUEG()),r.bitDepthLumaMinus8=n.readUEG(),r.bitDepthChromaMinus8=n.readUEG(),1===p&&(h-=(1!==a&&2!==a||0!==s?1:2)*(c+u),f-=(1===a&&0===s?2:1)*(d+l)),{codec:"hev1.1.6.L93.B0",width:h,height:f,chromaFormat:o,hvcC:r}}},{key:"_parseProfileTierLevel",value:function(e,t,r){var n=r.generalTierFlag||0;r.generalProfileSpace=e.readBits(2),r.generalTierFlag=Math.max(e.readBits(1),n),r.generalProfileIdc=Math.max(e.readBits(5),r.generalProfileIdc||0),r.generalProfileCompatibilityFlags=e.readBits(32),r.generalConstraintIndicatorFlags=[e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8)];var i=e.readBits(8);n<r.generalTierFlag?r.generalLevelIdc=i:r.generalLevelIdc=Math.max(i,r.generalLevelIdc||0);for(var a=[],o=[],s=0;s<t;s++)a[s]=e.readBits(1),o[s]=e.readBits(1);t>0&&e.readBits(2*(8-t));for(var u=0;u<t;u++)0!==a[u]&&(e.readBits(2),e.readBits(1),e.readBits(5),e.readBits(16),e.readBits(16),e.readBits(4),e.readBits(16),e.readBits(16),e.readBits(12)),0!==o[u]&&e.readBits(8)}}]),e}(),EL=function(){function e(){NP(this,e)}return LP(e,null,[{key:"parseAVCDecoderConfigurationRecord",value:function(t){if(!(t.length<7)){for(var r,n,i=1+(3&t[4]),a=[],o=[],s=6,u=31&t[5],c=0;c<u;c++)if(n=t[s]<<8|t[s+1],s+=2,n){var l=t.subarray(s,s+n);s+=n,a.push(l),r||(r=e.parseSPS(_L.removeEPB(l)))}var d,h=t[s];s++;for(var f=0;f<h;f++)d=t[s]<<8|t[s+1],s+=2,d&&(o.push(t.subarray(s,s+d)),s+=d);return{sps:r,spsArr:a,ppsArr:o,nalUnitSize:i}}}},{key:"parseSPS",value:function(e){var t=new bL(e);t.readUByte();var r=t.readUByte(),n=t.readUByte(),i=t.readUByte();t.skipUEG();var a=420;if(100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r){var o=t.readUEG();if(o<=3&&(a=[0,420,422,444][o]),3===o&&t.skipBits(1),t.skipUEG(),t.skipUEG(),t.skipBits(1),t.readBool())for(var s=3!==o?8:12,u=0;u<s;u++)t.readBool()&&(u<6?t.skipScalingList(16):t.skipScalingList(64))}t.skipUEG();var c=t.readUEG();if(0===c)t.readUEG();else if(1===c){t.skipBits(1),t.skipUEG(),t.skipUEG();for(var l=t.readUEG(),d=0;d<l;d++)t.skipUEG()}t.skipUEG(),t.skipBits(1);var h=t.readUEG(),f=t.readUEG(),p=t.readBits(1);0===p&&t.skipBits(1),t.skipBits(1);var g,y,m,v,_,b=0,A=0,E=0,S=0;if(t.readBool()&&(b=t.readUEG(),A=t.readUEG(),E=t.readUEG(),S=t.readUEG()),t.readBool()){if(t.readBool())switch(t.readUByte()){case 1:g=[1,1];break;case 2:g=[12,11];break;case 3:g=[10,11];break;case 4:g=[16,11];break;case 5:g=[40,33];break;case 6:g=[24,11];break;case 7:g=[20,11];break;case 8:g=[32,11];break;case 9:g=[80,33];break;case 10:g=[18,11];break;case 11:g=[15,11];break;case 12:g=[64,33];break;case 13:g=[160,99];break;case 14:g=[4,3];break;case 15:g=[3,2];break;case 16:g=[2,1];break;case 255:g=[t.readUByte()<<8|t.readUByte(),t.readUByte()<<8|t.readUByte()]}if(t.readBool()&&t.readBool(),t.readBool()&&(t.readBits(4),t.readBool()&&t.readBits(24)),t.readBool()&&(t.readUEG(),t.readUEG()),t.readBool()){var T=t.readBits(32),w=t.readBits(32);y=t.readBool(),_=(m=w)/(v=2*T)}}return{codec:mL(e.subarray(1,4)),profileIdc:r,profileCompatibility:n,levelIdc:i,chromaFormat:a,width:Math.ceil(16*(h+1)-2*(b+A)),height:(2-p)*(f+1)*16-(p?2:4)*(E+S),sarRatio:g,fpsNum:m,fpsDen:v,fps:_,fixedFrame:y}}}]),e}(),SL=function(){function e(t,r,n){NP(this,e),MP(this,"flag",{}),MP(this,"keyframe",!1),MP(this,"gopId",0),MP(this,"duration",0),MP(this,"size",0),MP(this,"units",[]),MP(this,"chromaFormat",420),this.originPts=this.pts=t,this.originDts=this.dts=r,n&&(this.units=n)}return LP(e,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),e}();function TL(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=jP(e);if(t){var i=jP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return FP(this,r)}}var wL=function(e){UP(r,e);var t=TL(r);function r(){return NP(this,r),t.apply(this,arguments)}return r}((function e(t,r){NP(this,e),MP(this,"time",0),this.data=t,this.originPts=this.pts=r})),CL=function(){function e(){NP(this,e),MP(this,"id",3),MP(this,"type",KD),MP(this,"timescale",0),MP(this,"flvScriptSamples",[]),MP(this,"seiSamples",[])}return LP(e,[{key:"exist",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length||!this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length)}}]),e}(),kL=function(){function e(){NP(this,e),MP(this,"id",1),MP(this,"type",ZD),MP(this,"codecType",XD),MP(this,"pid",-1),MP(this,"hvcC",void 0),MP(this,"codec",""),MP(this,"timescale",0),MP(this,"formatTimescale",0),MP(this,"sequenceNumber",0),MP(this,"baseMediaDecodeTime",0),MP(this,"baseDts",0),MP(this,"duration",0),MP(this,"warnings",[]),MP(this,"samples",[]),MP(this,"pps",[]),MP(this,"sps",[]),MP(this,"vps",[]),MP(this,"fpsNum",0),MP(this,"fpsDen",0),MP(this,"sarRatio",[]),MP(this,"width",0),MP(this,"height",0),MP(this,"nalUnitSize",4),MP(this,"present",!1),MP(this,"ext",void 0)}return LP(e,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"exist",value:function(){return!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}}]),e}(),IL=function(){function e(){NP(this,e),MP(this,"id",2),MP(this,"type",WD),MP(this,"codecType",zD),MP(this,"pid",-1),MP(this,"codec",""),MP(this,"sequenceNumber",0),MP(this,"sampleDuration",0),MP(this,"timescale",0),MP(this,"formatTimescale",0),MP(this,"baseMediaDecodeTime",0),MP(this,"duration",0),MP(this,"warnings",[]),MP(this,"samples",[]),MP(this,"baseDts",0),MP(this,"sampleSize",16),MP(this,"sampleRate",0),MP(this,"channelCount",0),MP(this,"objectType",0),MP(this,"sampleRateIndex",0),MP(this,"config",[]),MP(this,"present",!1),MP(this,"ext",void 0)}return LP(e,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec&&this.codecType===zD)}},{key:"hasSample",value:function(){return!!this.samples.length}}]),e}();function $L(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function PL(e,t){if(e){if("string"==typeof e)return $L(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?$L(e,t):void 0}}function xL(e){return function(e){if(Array.isArray(e))return $L(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||PL(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var RL=9e4,OL=45e4,DL=9e4,LL=function(){function e(t,r,n){NP(this,e),this.videoTrack=t,this.audioTrack=r,this.metadataTrack=n,this._baseDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=!1,this._videoTimestampBreak=!1,this._lastAudioExceptionGapDot=0,this._lastAudioExceptionOverlapDot=0,this._lastAudioExceptionLargeGapDot=0}return LP(e,[{key:"fix",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t=Math.round(9e4*t);var i=this.videoTrack,a=this.audioTrack,o=i.samples,s=a.samples;if(o.length||s.length){var u=o[0],c=s[0],l=0;if(o.length&&s.length&&(l=u.dts-c.pts),this._baseDtsInited||this._calculateBaseDts(this.audioTrack,this.videoTrack),r&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=t),!n){this._videoNextDts=l>0?t+l:t,this._audioNextPts=l>0?t:t-l;var d=u?u.dts-this._baseDts-this._videoNextDts:0,h=c?c.pts-this._baseDts-this._audioNextPts:0;Math.abs(d||h)>DL&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=t)}if(this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(a),this._fixVideo(i),this.metadataTrack.exist()){var f=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach((function(t){t.pts=t.originPts-e._baseDts,t.time=Math.max(0,t.pts)/f}))}i.samples.length&&(i.baseMediaDecodeTime=i.samples[0].dts),a.samples.length&&(a.baseMediaDecodeTime=a.samples[0].pts*a.timescale/9e4)}}},{key:"_fixVideo",value:function(e){var t=this,r=e.samples;if(r.length){if(r.forEach((function(e){e.dts-=t._baseDts,e.pts-=t._baseDts})),void 0===this._videoNextDts){var n=r[0];this._videoNextDts=n.dts}var i,a,o=r.length,s=0,u=r[0],c=r[1],l=this._videoNextDts-u.dts;if(Math.abs(l)>45e3&&(u.dts+=l,u.pts+=l,this._videoNextDts-=l,e.warnings.push({type:tL,nextDts:this._videoNextDts,firstSampleDts:u.dts,nextSampleDts:null===(i=r[1])||void 0===i?void 0:i.dts,sampleDuration:l}),c&&Math.abs(c.dts-u.dts)>DL&&(this._videoTimestampBreak=!0,r.forEach((function(e,t){0!==t&&(e.dts+=l,e.pts+=l)})))),e.fpsNum&&e.fpsDen)a=e.timescale*(e.fpsDen/e.fpsNum);else{var d=e.samples[0],h=e.samples[o-1];a=1===o?9e3:Math.floor((h.dts-d.dts)/(o-1))}for(var f=0;f<o;f++){var p=r[f].dts,g=r[f+1];if((s=f<o-1?g.dts-p:r[f-1]?p-r[f-1].dts:a)>DL||s<0){this._videoTimestampBreak=!0,s=this._audioTimestampBreak?a:s;var y=this._audioNextPts||0;g&&g.dts>y&&(s=a),e.warnings.push({type:eL,time:p/e.timescale,dts:p,originDts:r[f].originDts,nextDts:this._videoNextDts,sampleDuration:s,refSampleDuration:a})}r[f].duration=s,this._videoNextDts+=s}}}},{key:"_fixAudio",value:function(e){var t=this,r=e.samples;r.length&&(r.forEach((function(e){e.pts-=t._baseDts,e.dts=e.pts})),this._doFixAudioInternal(e,r,9e4))}},{key:"_calculateBaseDts",value:function(e,t){var r=e.samples,n=t.samples;if(!r.length&&!n.length)return!1;var i=1/0,a=1/0;r.length&&(e.baseDts=i=r[0].pts),n.length&&(t.baseDts=a=n[0].dts),this._baseDts=Math.min(i,a);var o=a-i;return Number.isFinite(o)&&Math.abs(o)>45e3&&t.warnings.push({type:qD,videoBaseDts:a,audioBasePts:i,baseDts:this._baseDts,delta:o}),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){if(this._baseDtsInited&&this._videoTimestampBreak&&this._audioTimestampBreak){if(!this._calculateBaseDts(this.audioTrack,this.videoTrack))return;this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts),this._audioLastSample=null,this._videoLastSample=null,this._videoTimestampBreak=!1,this._audioTimestampBreak=!1}}},{key:"_doFixAudioInternal",value:function(e,t,r){e.sampleDuration||(e.sampleDuration=lL.getFrameDuration(e.timescale,r));var n=e.sampleDuration;if(void 0===this._audioNextPts){var i=t[0];this._audioNextPts=i.pts}for(var a=0;a<t.length;a++){var o=this._audioNextPts,s=t[a],u=s.pts-o;if(!this._audioTimestampBreak&&u>=3*n&&u<=RL&&!sL){var c=lL.getSilentFrame(e.codec,e.channelCount)||t[0].data.subarray(),l=Math.floor(u/n);Math.abs(s.pts-this._lastAudioExceptionGapDot)>OL&&(this._lastAudioExceptionGapDot=s.pts),e.warnings.push({type:nL,pts:s.pts,originPts:s.originPts,count:l,nextPts:o,refSampleDuration:n});for(var d=0;d<l;d++){var h=new dL(Math.floor(o),c);h.originPts=Math.floor(this._baseDts+o),t.splice(a,0,h),this._audioNextPts+=n,a++}a--}else u<=-3*n&&u>=-9e4?(Math.abs(s.pts-this._lastAudioExceptionOverlapDot)>OL&&(this._lastAudioExceptionOverlapDot=s.pts,e.warnings.push({type:iL,pts:s.pts,originPts:s.originPts,nextPts:o,refSampleDuration:n})),t.splice(a,1),a--):(Math.abs(u)>=RL&&(this._audioTimestampBreak=!0,Math.abs(s.pts-this._lastAudioExceptionLargeGapDot)>OL&&(this._lastAudioExceptionLargeGapDot=s.pts,e.warnings.push({type:rL,time:s.pts/1e3,pts:s.pts,originPts:s.originPts,nextPts:o,sampleDuration:u,refSampleDuration:n}))),s.dts=s.pts=o,this._audioNextPts+=n)}}}]),e}(),ML=new vL("TsDemuxer"),NL=function(){function e(t,r,n){NP(this,e),MP(this,"_pmtId",-1),MP(this,"_remainingPacketData",null),MP(this,"_videoPesData",[]),MP(this,"_audioPesData",[]),MP(this,"_gopId",0),this.videoTrack=t||new kL,this.audioTrack=r||new IL,this.metadataTrack=n||new CL,this._fixer=new LL(this.videoTrack,this.audioTrack,this.metadataTrack)}return LP(e,[{key:"demux",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.audioTrack,i=this.videoTrack,a=this.metadataTrack;t&&(this._pmtId=-1,i.reset(),n.reset(),a.reset()),!r||t?(this._remainingPacketData=null,this._videoPesData=[],this._audioPesData=[]):(i.samples=[],n.samples=[],a.seiSamples=[],i.warnings=[],n.warnings=[],this._remainingPacketData&&(e=hL(this._remainingPacketData,e),this._remainingPacketData=null));var o=e.length,s=o%188;s&&(this._remainingPacketData=e.subarray(o-s),o-=s);for(var u=i.pid,c=n.pid,l=0;l<o;l+=188){if(71!==e[l])throw new Error("TS packet did not start with 0x47");var d=!!(64&e[l+1]),h=((31&e[l+1])<<8)+e[l+2],f=void 0;if((48&e[l+3])>>4>1){if((f=l+5+e[l+4])===l+188)continue}else f=l+4;switch(h){case 0:d&&(f+=e[f]+1),this._pmtId=(31&e[f+10])<<8|e[f+11];break;case this._pmtId:d&&(f+=e[f]+1);var p=f+3+((15&e[f+1])<<8|e[f+2])-4;for(f+=12+((15&e[f+10])<<8|e[f+11]);f<p;){var g=(31&e[f+1])<<8|e[f+2];switch(e[f]){case 15:n.pid=c=g;break;case 27:if(-1!==u)break;i.codecType=XD,i.pid=u=g;break;case 36:if(-1!==u)break;i.codecType=YD,i.pid=u=g;break;default:ML.warn("Unsupported stream. type: ".concat(e[f],", pid: ").concat(g))}f+=5+((15&e[f+3])<<8|e[f+4])}break;case u:d&&this._videoPesData.length&&this._parseVideoData(),this._videoPesData.push(e.subarray(f,l+188));break;case c:d&&this._audioPesData.length&&this._parseAudioData(),this._audioPesData.push(e.subarray(f,l+188));break;case 17:case 8191:break;default:ML.warn("Unknown pid: ".concat(h))}}return this._parseVideoData(),this._parseAudioData(),n.formatTimescale=i.formatTimescale=i.timescale=a.timescale=9e4,n.timescale=n.sampleRate||0,{videoTrack:i,audioTrack:n,metadataTrack:a}}},{key:"fix",value:function(e,t,r){return this._fixer.fix(e,t,r),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(e,t,r,n){return this.demux(e,t,r),this.fix(n,t,r)}},{key:"_parseVideoData",value:function(){if(this._videoPesData.length){var t=e._parsePES(hL.apply(void 0,xL(this._videoPesData)));if(t){var r=_L.parseAnnexB(t.data);r?this._createVideoSample(r,t.pts,t.dts):ML.warn("Cannot parse avc units",t),this._videoPesData=[]}else ML.warn("Cannot parse video pes",this._videoPesData)}}},{key:"_createVideoSample",value:function(e,t,r){var n=this;if(e.length){var i=this.videoTrack,a=i.codecType===YD,o=new SL(t,r);e.forEach((function(e){var s=a?e[0]>>>1&63:31&e[0];switch(s){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!a&&5!==s||a&&5===s)break;o.setToKeyframe(),n._gopId++;break;case 6:case 39:case 40:if(!a&&6!==s||a&&6===s)break;return void n.metadataTrack.seiSamples.push(new wL(_L.parseSEI(_L.removeEPB(e)),t));case 32:if(!a)break;if(!i.vps.length){var u=AL.parseVPS(_L.removeEPB(e),i.hvcC);i.hvcC=i.hvcC||u,i.vps=[e]}break;case 7:case 33:if(!a&&7!==s||a&&7===s)break;if(!i.sps.length){var c=_L.removeEPB(e),l=a?AL.parseSPS(c,i.hvcC):EL.parseSPS(c);i.sps=[e],i.hvcC=i.hvcC||l.hvcC,i.codec=l.codec,i.width=l.width,i.height=l.height,i.sarRatio=l.sarRatio,i.fpsNum=l.fpsNum,i.fpsDen=l.fpsDen}break;case 8:case 34:if(!a&&8!==s||a&&8===s)break;i.pps.length||(i.pps=[e]);break;case 9:case 35:if(!a&&9!==s||a&&9===s)break;o.gopId=n._gopId,o.units.length&&(n._pushVideoSample(i,o),o=n.prevAvcSample=new SL(t,r))}o.units.push(e)})),o.gopId=this._gopId,this._pushVideoSample(i,o)}}},{key:"_pushVideoSample",value:function(e,t){if(t.units.length){if(null==t.pts){ML.warn("Video sample no pts",t);var r=e.samples[e.samples.length-1];r?(t.pts=r.pts,t.dts=r.dts):ML.warn("Drop video sample",t)}null!=t.pts&&e.samples.push(t)}}},{key:"_parseAudioData",value:function(){if(this._audioPesData.length){var t=e._parsePES(hL.apply(void 0,xL(this._audioPesData)));t?(this._parseAacData(t),this._audioPesData=[]):ML.warn("Cannot parse audio pes",this._audioPesData)}}},{key:"_parseAacData",value:function(e){var t=this.audioTrack,r=e.pts;if(null==r){if(ML.warn("AAC pes not pts",t),!t.samples.length||!t.sampleRate)return;r=t.samples[t.samples.length-1].pts+lL.getFrameDuration(t.sampleRate)}var n,i=lL.parseADTS(e.data,r);i?(t.codec=i.codec,t.channelCount=i.channelCount,t.sampleRate=i.sampleRate,t.objectType=i.objectType,t.sampleRateIndex=i.samplingFrequencyIndex,t.config=i.config,(n=t.samples).push.apply(n,xL(i.frames.map((function(e){return new dL(e.pts,e.data)})))),i.skip&&ML.warn("Skip aac adts ".concat(i.skip," bits")),i.remaining&&ML.warn("Remaining aac adts ".concat(i.remaining," bits"))):ML.warn("Cannot parse aac adts",e)}}],[{key:"probe",value:function(e){return!!e.length&&71===e[0]&&71===e[188]&&71===e[376]}},{key:"_parsePES",value:function(e){var t=e[8];if(!(null==t||e.length<t+9)&&1==(e[0]<<16|e[1]<<8|e[2])){var r=(e[4]<<8)+e[5];if(!(r&&r>e.length-6)){var n,i,a=e[7];return 192&a&&(n=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&a?n-(i=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)>54e5&&(n=i):i=n),{data:e.subarray(9+t),pts:n,dts:i}}}}}]),e}(),BL=L,UL=bn,GL=Xc,VL=X,FL=BL(qc),jL=BL("".slice),HL=Math.ceil,ZL=function(e){return function(t,r,n){var i,a,o=GL(VL(t)),s=UL(r),u=o.length,c=void 0===n?" ":GL(n);return s<=u||""==c?o:((a=FL(c,HL((i=s-u)/c.length))).length>i&&(a=jL(a,0,i)),e?o+a:a+o)}},WL={start:ZL(!1),end:ZL(!0)},KL=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(se),XL=WL.start;di({target:"String",proto:!0,forced:KL},{padStart:function(e){return XL(this,e,arguments.length>1?arguments[1]:void 0)}});var YL=v,zL=Sp,JL=tl,QL=m,qL=g.RegExp,eM=qL.prototype;YL&&QL((function(){var e=!0;try{qL(".","d")}catch(EU){e=!1}var t={},r="",n=e?"dgimsy":"gimsy",i=function(e,n){Object.defineProperty(t,e,{get:function(){return r+=n,!0}})},a={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var o in e&&(a.hasIndices="d"),a)i(o,a[o]);return Object.getOwnPropertyDescriptor(eM,"flags").get.call(t)!==n||r!==n}))&&zL(eM,"flags",{configurable:!0,get:JL});var tM=function(){function e(){NP(this,e)}return LP(e,null,[{key:"findBox",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=[];if(!t)return i;for(var a=0,o="",s=0;t.length>7;){if(a=gL(t),o=String.fromCharCode.apply(null,t.subarray(4,8)),s=8,1===a?(a=yL(t,8),s+=8):a||(a=t.length),!r[0]||o===r[0]){var u=t.subarray(0,a);if(!(r.length<2))return e.findBox(u.subarray(s),r.slice(1),n+s);i.push({start:n,size:a,headerSize:s,type:o,data:u})}n+=a,t=t.subarray(a)}return i}},{key:"moov",value:function(t){return aM(t,!1,(function(t,r,n){t.mvhd=e.mvhd(e.findBox(r,["mvhd"],n)[0]),t.trak=e.findBox(r,["trak"],n).map((function(t){return e.trak(t)}))}))}},{key:"mvhd",value:function(e){return aM(e,!0,(function(e,t){var r=0;1===e.version?(e.timescale=gL(t,16),e.duration=yL(t,20),r+=28):(e.timescale=gL(t,8),e.duration=gL(t,12),r+=16),e.nextTrackId=gL(t,r+76)}))}},{key:"trak",value:function(t){return aM(t,!1,(function(t,r,n){t.tkhd=e.tkhd(e.findBox(r,["tkhd"],n)[0]),t.mdia=e.mdia(e.findBox(r,["mdia"],n)[0])}))}},{key:"tkhd",value:function(e){return aM(e,!0,(function(e,t){var r=0;1===e.version?(e.trackId=gL(t,16),e.duration=yL(t,24),r+=32):(e.trackId=gL(t,8),e.duration=gL(t,16),r+=20),e.width=gL(t,r+52),e.height=gL(t,r+56)}))}},{key:"mdia",value:function(t){return aM(t,!1,(function(t,r,n){t.mdhd=e.mdhd(e.findBox(r,["mdhd"],n)[0]),t.hdlr=e.hdlr(e.findBox(r,["hdlr"],n)[0]),t.minf=e.minf(e.findBox(r,["minf"],n)[0])}))}},{key:"mdhd",value:function(e){return aM(e,!0,(function(e,t){var r=0;1===e.version?(e.timescale=gL(t,16),e.duration=yL(t,20),r+=28):(e.timescale=gL(t,8),e.duration=gL(t,12),r+=16);var n=pL(t,r);e.language=String.fromCharCode(96+(n>>10&31),96+(n>>5&31),96+(31&n))}))}},{key:"hdlr",value:function(e){return aM(e,!0,(function(e,t){0===e.version&&(e.handlerType=String.fromCharCode.apply(null,t.subarray(4,8)))}))}},{key:"minf",value:function(t){return aM(t,!1,(function(t,r,n){t.vmhd=e.vmhd(e.findBox(r,["vmhd"],n)[0]),t.smhd=e.smhd(e.findBox(r,["smhd"],n)[0]),t.stbl=e.stbl(e.findBox(r,["stbl"],n)[0])}))}},{key:"vmhd",value:function(e){return aM(e,!0,(function(e,t){e.graphicsmode=pL(t),e.opcolor=[pL(t,2),pL(t,4),pL(t,6)]}))}},{key:"smhd",value:function(e){return aM(e,!0,(function(e,t){e.balance=pL(t)}))}},{key:"stbl",value:function(t){return aM(t,!1,(function(t,r,n){t.stsd=e.stsd(e.findBox(r,["stsd"],n)[0]),t.stts=e.stts(e.findBox(r,["stts"],n)[0]),t.ctts=e.ctts(e.findBox(r,["ctts"],n)[0]),t.stsc=e.stsc(e.findBox(r,["stsc"],n)[0]),t.stsz=e.stsz(e.findBox(r,["stsz"],n)[0]),t.stco=e.stco(e.findBox(r,["stco"],n)[0]),t.stss=e.stss(e.findBox(r,["stss"],n)[0])}))}},{key:"stsd",value:function(t){return aM(t,!0,(function(t,r,n){t.entryCount=gL(r),t.entries=e.findBox(r.subarray(4),[],n+4).map((function(t){switch(t.type){case"avc1":case"avc2":case"avc3":case"avc4":return e.avc1(t);case"hvc1":case"hev1":return e.hvc1(t);case"mp4a":return e.mp4a(t);case"alaw":case"ulaw":return e.alaw(t)}})).filter(Boolean)}))}},{key:"avc1",value:function(t){return aM(t,!1,(function(t,r,n){var i=nM(t,r),a=r.subarray(i);n+=i,t.avcC=e.avcC(e.findBox(a,["avcC"],n)[0]),t.pasp=e.pasp(e.findBox(a,["pasp"],n)[0])}))}},{key:"avcC",value:function(e){return aM(e,!1,(function(e,t){e.configurationVersion=t[0],e.AVCProfileIndication=t[1],e.profileCompatibility=t[2],e.AVCLevelIndication=t[3],e.codec=mL([t[1],t[2],t[3]]),e.lengthSizeMinusOne=3&t[4],e.spsLength=31&t[5],e.sps=[];for(var r=6,n=0;n<e.spsLength;n++){var i=pL(t,r);r+=2,e.sps.push(t.subarray(r,r+i)),r+=i}e.ppsLength=t[r],r+=1,e.pps=[];for(var a=0;a<e.ppsLength;a++){var o=pL(t,r);r+=2,e.pps.push(t.subarray(r,r+=o)),r+=o}}))}},{key:"hvc1",value:function(t){return aM(t,!1,(function(t,r,n){var i=nM(t,r),a=r.subarray(i);n+=i,t.hvcC=e.hvcC(e.findBox(a,["hvcC"],n)[0]),t.pasp=e.pasp(e.findBox(a,["pasp"],n)[0])}))}},{key:"hvcC",value:function(e){return aM(e,!1,(function(t,r){t.data=e.data,t.codec="hev1.1.6.L93.B0",t.configurationVersion=r[0];var n=r[1];t.generalProfileSpace=n>>6,t.generalTierFlag=(32&n)>>5,t.generalProfileIdc=31&n,t.generalProfileCompatibility=gL(r,2),t.generalConstraintIndicatorFlags=r.subarray(6,12),t.generalLevelIdc=r[12],t.avgFrameRate=pL(r,19),t.numOfArrays=r[22],t.vps=[],t.sps=[],t.pps=[];for(var i=23,a=0,o=0,s=0,u=0;u<t.numOfArrays;u++){a=63&r[i],o=pL(r,i+1),i+=3;for(var c,l=[],d=0;d<o;d++)s=pL(r,i),i+=2,l.push(r.subarray(i,i+s)),i+=s;if(32===a)(c=t.vps).push.apply(c,l);else if(33===a){var h;(h=t.sps).push.apply(h,l)}else if(34===a){var f;(f=t.pps).push.apply(f,l)}}}))}},{key:"pasp",value:function(e){return aM(e,!1,(function(e,t){e.hSpacing=gL(t),e.vSpacing=gL(t,4)}))}},{key:"mp4a",value:function(t){return aM(t,!1,(function(t,r,n){var i=iM(t,r);t.esds=e.esds(e.findBox(r.subarray(i),["esds"],n+i)[0])}))}},{key:"esds",value:function(e){return aM(e,!0,(function(e,t){e.codec="mp4a.";for(var r=0,n=0,i=0,a=0;t.length;){for(a=t[r=0],n=t[r+1],r+=2;128&n;)i=(127&n)<<7,n=t[r],r+=1;if(i+=127&n,3===a)t=t.subarray(r+3);else{if(4!==a){if(5===a){var o=e.config=t.subarray(r,r+i),s=(248&o[0])>>3;return 31===s&&o.length>=2&&(s=32+((7&o[0])<<3)+((224&o[1])>>5)),e.objectType=s,void(e.codec+=s.toString(16))}return}e.codec+=(t[r].toString(16)+".").padStart(3,"0"),t=t.subarray(r+13)}}}))}},{key:"alaw",value:function(e){return aM(e,!1,(function(e,t){iM(e,t)}))}},{key:"stts",value:function(e){return aM(e,!0,(function(e,t){for(var r=gL(t),n=[],i=4,a=0;a<r;a++)n.push({count:gL(t,i),delta:gL(t,i+4)}),i+=8;e.entryCount=r,e.entries=n}))}},{key:"ctts",value:function(e){return aM(e,!0,(function(e,t){var r=gL(t),n=[],i=4;if(1===e.version)for(var a=0;a<r;a++)n.push({count:gL(t,i),offset:gL(t,i+4)}),i+=8;else for(var o=0;o<r;o++)n.push({count:gL(t,i),offset:-(1+~gL(t,i+4))}),i+=8;e.entryCount=r,e.entries=n}))}},{key:"stsc",value:function(e){return aM(e,!0,(function(e,t){for(var r=gL(t),n=[],i=4,a=0;a<r;a++)n.push({firstChunk:gL(t,i),samplesPerChunk:gL(t,i+4),sampleDescriptionIndex:gL(t,i+8)}),i+=12;e.entryCount=r,e.entries=n}))}},{key:"stsz",value:function(e){return aM(e,!0,(function(e,t){var r=gL(t),n=gL(t,4),i=[];if(!r)for(var a=8,o=0;o<n;o++)i.push(gL(t,a)),a+=4;e.sampleSize=r,e.sampleCount=n,e.entrySizes=i}))}},{key:"stco",value:function(e){return aM(e,!0,(function(e,t){for(var r=gL(t),n=[],i=4,a=0;a<r;a++)n.push(gL(t,i)),i+=4;e.entryCount=r,e.entries=n}))}},{key:"stss",value:function(e){return aM(e,!0,(function(e,t){for(var r=gL(t),n=[],i=4,a=0;a<r;a++)n.push(gL(t,i)),i+=4;e.entryCount=r,e.entries=n}))}},{key:"moof",value:function(t){return aM(t,!1,(function(t,r,n){t.mfhd=e.mfhd(e.findBox(r,["mfhd"],n)[0]),t.traf=e.findBox(r,["traf"],n).map((function(t){return e.traf(t)}))}))}},{key:"mfhd",value:function(e){return aM(e,!0,(function(e,t){e.sequenceNumber=gL(t)}))}},{key:"traf",value:function(t){return aM(t,!1,(function(t,r,n){t.tfhd=e.tfhd(e.findBox(r,["tfhd"],n)[0]),t.tfdt=e.tfdt(e.findBox(r,["tfdt"],n)[0]),t.trun=e.trun(e.findBox(r,["trun"],n)[0])}))}},{key:"tfhd",value:function(e){return aM(e,!0,(function(e,t){var r=e.flags,n=t.length;e.trackId=gL(t);var i=4;n>i&&1&r&&(e.baseDataOffset=yL(t,i),i+=8),n>i&&2&r&&(e.sampleDescriptionIndex=gL(t,i),i+=4),n>i&&8&r&&(e.defaultSampleDuration=gL(t,i),i+=4),n>i&&10&r&&(e.defaultSampleSize=gL(t,i),i+=4),n>i&&32&r&&(e.defaultSampleFlags=gL(t,i),i+=4)}))}},{key:"trun",value:function(e){return aM(e,!0,(function(e,t){var r=e.version,n=e.flags,i=t.length,a=e.sampleCount=gL(t),o=4;if(i>o&&1&n&&(e.dataOffset=-(1+~gL(t,o)),o+=4),i>o&&4&n&&(e.firstSampleFlags=gL(t,o),o+=4),e.samples=[],i>o)for(var s,u=0;u<a;u++)s={},256&n&&(s.duration=gL(t,o),o+=4),512&n&&(s.size=gL(t,o),o+=4),1024&n&&(s.flags=gL(t,o),o+=4),2048&n&&(s.cts=r?-(1+~gL(t,o+4)):gL(t,o),o+=4),e.samples.push(s)}))}},{key:"tfdt",value:function(e){return aM(e,!0,(function(e,t){1===e.version?e.baseMediaDecodeTime=yL(t):e.baseMediaDecodeTime=gL(t)}))}},{key:"probe",value:function(t){return!!e.findBox(t,["ftyp"])}},{key:"moovToTrack",value:function(e,t,r){var n,i,a=e.trak;if(a&&a.length){var o=a.find((function(e){var t,r;return"vide"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),s=a.find((function(e){var t,r;return"soun"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)}));if(o&&t){var u,c=t;null!=(null===(u=o.tkhd)||void 0===u?void 0:u.trackId)&&(c.id=o.tkhd.trackId),c.timescale=c.formatTimescale=o.mdia.mdhd.timescale,c.duration=o.mdia.mdhd.duration;var l=o.mdia.minf.stbl.stsd.entries[0];if(c.width=l.width,c.height=l.height,l.pasp&&(c.sarRatio=[l.pasp.hSpacing,l.pasp.vSpacing]),l.hvcC)c.codecType=YD,c.codec=l.hvcC.codec,c.vps=l.hvcC.vps,c.sps=l.hvcC.sps,c.pps=l.hvcC.pps,c.hvcC=l.hvcC.data;else{if(!l.avcC)throw new Error("unknown video stsd entry");c.codec=l.avcC.codec,c.sps=l.avcC.sps,c.pps=l.avcC.pps}c.present=!0}if(s&&r){var d,h=r;null!=(null===(d=s.tkhd)||void 0===d?void 0:d.trackId)&&(h.id=s.tkhd.trackId),h.timescale=h.formatTimescale=s.mdia.mdhd.timescale,h.duration=s.mdia.mdhd.duration;var f=s.mdia.minf.stbl.stsd.entries[0];switch(h.sampleSize=f.sampleSize,h.sampleRate=f.sampleRate,h.channelCount=f.channelCount,h.present=!0,f.type){case"alaw":h.codecType=h.codec=JD,h.sampleRate=8e3;break;case"ulaw":h.codecType=h.codec=QD,h.sampleRate=8e3;break;default:h.sampleDuration=lL.getFrameDuration(h.sampleRate,h.timescale),h.sampleRateIndex=lL.getRateIndexByRate(h.sampleRate),h.objectType=(null===(n=f.esds)||void 0===n?void 0:n.objectType)||2,f.esds&&(h.config=Array.from(f.esds.config)),h.codec=(null===(i=f.esds)||void 0===i?void 0:i.codec)||"mp4a.40.2"}}return{videoTrack:t,audioTrack:r}}}},{key:"evaluateDefaultDuration",value:function(e,t,r){var n,i=null==t||null===(n=t.samples)||void 0===n?void 0:n.length;return i?1024*i/t.timescale*e.timescale/r:1024}},{key:"moofToSamples",value:function(t,r,n){var i={};return t.mfhd&&(r&&(r.sequenceNumber=t.mfhd.sequenceNumber),n&&(n.sequenceNumber=t.mfhd.sequenceNumber)),t.traf.forEach((function(t){var a=t.tfhd,o=t.tfdt,s=t.trun;if(a&&s){o&&(r&&r.id===a.trackId&&(r.baseMediaDecodeTime=o.baseMediaDecodeTime),n&&n.id===a.trackId&&(n.baseMediaDecodeTime=o.baseMediaDecodeTime));var u=a.defaultSampleSize||0,c=a.defaultSampleDuration||e.evaluateDefaultDuration(r,n,s.samples.length||s.sampleCount),l=s.dataOffset||0,d=0,h=-1;if(!s.samples.length&&s.sampleCount){i[a.trackId]=[];for(var f=0;f<s.sampleCount;f++)i[a.trackId].push({offset:l,dts:d,duration:c,size:u}),d+=c,l+=u}else i[a.trackId]=s.samples.map((function(e,t){return(e={offset:l,dts:d,pts:d+(e.cts||0),duration:e.duration||c,size:e.size||u,gopId:h,keyframe:0===t||null!=e.flags&&(65536&e.flags)>>>0!=65536}).keyframe&&(h++,e.gopId=h),d+=e.duration,l+=e.size,e}))}})),i}},{key:"moovToSamples",value:function(e){var t=e.trak;if(t&&t.length){var r=t.find((function(e){var t,r;return"vide"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),n=t.find((function(e){var t,r;return"soun"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)}));if(r||n){var i,a;if(r){var o,s,u=null===(o=r.mdia)||void 0===o||null===(s=o.minf)||void 0===s?void 0:s.stbl;if(!u)return;var c=u.stts,l=u.stsc,d=u.stsz,h=u.stco,f=u.stss,p=u.ctts;if(!(c&&l&&d&&h&&f))return;i=rM(c,l,d,h,p,f)}if(n){var g,y,m,v=null===(g=n.mdia)||void 0===g||null===(y=g.minf)||void 0===y?void 0:y.stbl;if(!v)return;var _=null===(m=n.mdia.mdhd)||void 0===m?void 0:m.timescale,b=v.stts,A=v.stsc,E=v.stsz,S=v.stco;if(!(_&&b&&A&&E&&S))return;a=rM(b,A,E,S)}return{videoSamples:i,audioSamples:a}}}}}]),e}();function rM(e,t,r,n,i,a){var o,s,u,c=[],l=null==i?void 0:i.entries,d=t.entries,h=n.entries,f=r.entrySizes,p=null==a?void 0:a.entries;p&&(o={},p.forEach((function(e){o[e-1]=!0}))),l&&(s=[],l.forEach((function(e){for(var t=e.count,r=e.offset,n=0;n<t;n++)s.push(r)})));var g=-1,y=0,m=0,v=0,_=0,b=0,A=d[0].samplesPerChunk,E=d[1]?d[1].firstChunk-1:1/0;return e.entries.forEach((function(e){for(var t=e.count,n=e.delta,i=0;i<t;i++)u={dts:y,duration:n,size:f[m]||r.sampleSize,offset:h[v]+b,index:m},p&&(u.keyframe=o[m],u.keyframe&&g++,u.gopId=g),s&&s[m]&&(u.pts=u.dts+s[m]),c.push(u),y+=n,++m<A?b+=u.size:(v++,b=0,v>=E&&(_++,E=d[_+1]?d[_+1].firstChunk-1:1/0),A+=d[_].samplesPerChunk)})),c}function nM(e,t){return e.dataReferenceIndex=pL(t,6),e.width=pL(t,24),e.height=pL(t,26),e.horizresolution=gL(t,28),e.vertresolution=gL(t,32),e.frameCount=pL(t,40),e.depth=pL(t,74),78}function iM(e,t){return e.dataReferenceIndex=pL(t,6),e.channelCount=pL(t,16),e.sampleSize=pL(t,18),e.sampleRate=gL(t,24)/65536,28}function aM(e,t,r){if(e){if(e.size!==e.data.length)throw new Error("box ".concat(e.type," size !== data.length"));var n={start:e.start,size:e.size,headerSize:e.headerSize,type:e.type};return t&&(n.version=e.data[e.headerSize],n.flags=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<16)+(e[t+1]<<8)+(e[t+2]||0)}(e.data,e.headerSize+1),n.headerSize+=4),r(n,e.data.subarray(n.headerSize),n.start+n.headerSize),n}}var oM=function(){function e(t,r,n){NP(this,e),this.videoTrack=t||new kL,this.audioTrack=r||new IL,this.metadataTrack=n||new CL}return LP(e,[{key:"demux",value:function(e,t){var r=this.videoTrack,n=this.audioTrack,i=r.exist(),a=n.exist();if(r.samples=[],n.samples=[],t){if(!a){var o=tM.findBox(t,["moov"])[0];if(!o)throw new Error("cannot found moov box");tM.moovToTrack(tM.moov(o),null,n)}var s=tM.findBox(t,["moof"])[0];if(s){var u=tM.moofToSamples(tM.moof(s),null,n)[n.id],c=n.baseMediaDecodeTime;if(u){var l=s.start;u.map((function(e){e.offset+=l;var r=t.subarray(e.offset,e.offset+e.size);n.samples.push(new dL(e.dts+c,r,e.duration))}))}}}if(e){if(!i&&!a){var d=tM.findBox(e,["moov"])[0];if(!d)throw new Error("cannot found moov box");tM.moovToTrack(tM.moov(d),r,n)}var h=tM.findBox(e,["moof"])[0];if(h){var f,p=tM.moofToSamples(tM.moof(h),r,n),g=r.baseMediaDecodeTime,y=n.baseMediaDecodeTime,m=h.start;Object.keys(p).forEach((function(t){r.id==t?p[t].map((function(t){t.offset+=m;var n=new SL((t.pts||t.dts)+g,t.dts+g);n.duration=t.duration,n.gopId=t.gopId,t.keyframe&&n.setToKeyframe();for(var i=e.subarray(t.offset,t.offset+t.size),a=0,o=i.length-1;a<o;)f=gL(i,a),a+=4,n.units.push(i.subarray(a,a+f)),a+=f;r.samples.push(n)})):n.id==t&&p[t].map((function(t){t.offset+=m;var r=e.subarray(t.offset,t.offset+t.size);n.samples.push(new dL(t.dts+y,r,t.duration))}))}))}}return{videoTrack:r,audioTrack:n,metadataTrack:this.metadataTrack}}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}}],[{key:"probe",value:function(e){return tM.probe(e)}}]),e}();function sM(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(u){s=!0,i=u}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(e,t)||PL(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var uM=Math.pow(2,32)-1,cM=function(){function e(){NP(this,e)}return LP(e,null,[{key:"box",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=8+(r=r.filter(Boolean)).reduce((function(e,t){return e+t.byteLength}),0),a=new Uint8Array(i);a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(e,4);var o=8;return r.forEach((function(e){a.set(e,o),o+=e.byteLength})),a}},{key:"ftyp",value:function(t){return t.find((function(e){return e.type===ZD&&e.codecType===YD}))?e.FTYPHEV1:e.FTYPAVC1}},{key:"initSegment",value:function(t){return hL(e.ftyp(t),e.moov(t))}},{key:"moov",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat(xL(t.map((function(t){return e.trak(t)}))),[e.mvex(t)]))}},{key:"mvhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdia(t))}},{key:"tkhd",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minf(t))}},{key:"mdhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,85,196,0,0]))}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"minf",value:function(t){return e.box(e.types.minf,t.type===ZD?e.VMHD:e.SMHD,e.DINF,e.stbl(t))}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.STTS,e.STSC,e.STSZ,e.STCO)}},{key:"stsd",value:function(t){return e.box(e.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),t.type===ZD?e.avc1hev1(t):e.mp4a(t))}},{key:"avc1hev1",value:function(t){var r=t.codecType===YD,n=r?e.types.hvc1:e.types.avc1,i=r?e.hvcC(t):e.avcC(t),a=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i];return t.sarRatio&&t.sarRatio.length>1&&a.push(e.pasp(t.sarRatio)),e.box.apply(e,[n].concat(a))}},{key:"avcC",value:function(t){var r,n=[],i=[];return t.sps.forEach((function(e){r=e.byteLength,n.push(r>>>8&255),n.push(255&r),n.push.apply(n,xL(e))})),t.pps.forEach((function(e){r=e.byteLength,i.push(r>>>8&255),i.push(255&r),i.push.apply(i,xL(e))})),e.box(e.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|t.sps.length].concat(n).concat([t.pps.length]).concat(i)))}},{key:"hvcC",value:function(t){var r=t.hvcC;if(r instanceof ArrayBuffer)return r;var n,i=t.vps,a=t.sps,o=t.pps;if(r){var s=r.generalProfileCompatibilityFlags,u=r.generalConstraintIndicatorFlags,c=(i.length&&1)+(a.length&&1)+(o.length&&1);n=[1,r.generalProfileSpace<<6|r.generalTierFlag<<5|r.generalProfileIdc,s>>>24,s>>>16,s>>>8,s,u[0],u[1],u[2],u[3],u[4],u[5],r.generalLevelIdc,240,0,252,252|r.chromaFormatIdc,248|r.bitDepthLumaMinus8,248|r.bitDepthChromaMinus8,0,0,r.numTemporalLayers<<3|r.temporalIdNested<<2|3,c];var l=function(e){var t;n.push(e.length>>8,e.length),(t=n).push.apply(t,xL(e))};i.length&&(n.push(160,0,i.length),i.forEach(l)),a.length&&(n.push(161,0,a.length),a.forEach(l)),o.length&&(n.push(162,0,o.length),o.forEach(l))}else n=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return e.box(e.types.hvcC,new Uint8Array(n))}},{key:"pasp",value:function(t){var r=sM(t,2),n=r[0],i=r[1];return e.box(e.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i]))}},{key:"mp4a",value:function(t){return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,255&t.sampleRate,0,0]),t.config.length?e.esds(t.config):void 0)}},{key:"esds",value:function(t){var r=t.length;return e.box(e.types.esds,new Uint8Array([0,0,0,0,3,23+r,0,0,0,4,15+r,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([r]).concat(t).concat([6,1,2])))}},{key:"mvex",value:function(t){return e.box.apply(e,[e.types.mvex].concat(xL(t.map((function(t){return e.trex(t.id)})))))}},{key:"trex",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"moof",value:function(t,r){return e.box.apply(e,[e.types.moof,e.mfhd(t)].concat(xL(r.map((function(t){return e.traf(t)})))))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"traf",value:function(t){return e.box(e.types.traf,e.tfhd(t.id),e.tfdt(t.baseMediaDecodeTime),e.trun(t.samples,76))}},{key:"tfhd",value:function(t){return e.box(e.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"tfdt",value:function(t){var r=Math.floor(t/(uM+1)),n=Math.floor(t%(uM+1));return e.box(e.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n]))}},{key:"trun",value:function(t,r){var n=t.length,i=12+16*n;r+=8+i;var a=new Uint8Array(i);a.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0);for(var o=0;o<n;o++){var s=t[o],u=s.duration,c=s.size,l=s.flag,d=void 0===l?{}:l,h=s.cts,f=void 0===h?0:h;a.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,c>>>24&255,c>>>16&255,c>>>8&255,255&c,d.isLeading<<2|(null==d.dependsOn?1:d.dependsOn),d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|(null==d.isNonSyncSample?1:d.isNonSyncSample),61440&d.degradationPriority,15&d.degradationPriority,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*o)}return e.box(e.types.trun,a)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"moovMP4",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat(xL(t.map((function(t){return e.trackMP4(t)})))))}},{key:"trackMP4",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdiaMP4(t))}},{key:"mdiaMP4",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minfMP4(t))}},{key:"minfMP4",value:function(t){return e.box(e.types.minf,t.type===ZD?e.VMHD:e.SMHD,e.DINF,e.stblMP4(t))}},{key:"stblMP4",value:function(t){var r=t.ext,n=[e.stsd(t),e.stts(r.stts),e.stsc(r.stsc),e.stsz(r.stsz),e.stco(r.stco)];return r.stss.length&&n.push(e.stss(r.stss)),r.ctts.length&&n.push(e.ctts(r.ctts)),e.box.apply(e,[e.types.stbl].concat(n))}},{key:"stts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.stts,hL(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsc",value:function(t){var r=t.length,n=new Uint8Array(12*r),i=0;return t.forEach((function(e){var t=e.firstChunk,r=e.samplesPerChunk,a=e.sampleDescIndex;n.set([t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a],i),i+=12})),e.box(e.types.stsc,hL(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsz",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stsz,hL(new Uint8Array([0,0,0,0,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stco",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stco,hL(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stss",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stss,hL(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"ctts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.ctts,hL(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}}]),e}();MP(cM,"types",["avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trun","trex","tkhd","vmhd","smhd","ctts","stss"].reduce((function(e,t){return e[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)],e}),Object.create(null))),MP(cM,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])}),MP(cM,"FTYPAVC1",cM.box(cM.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))),MP(cM,"FTYPHEV1",cM.box(cM.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49]))),MP(cM,"DINF",cM.box(cM.types.dinf,cM.box(cM.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])))),MP(cM,"VMHD",cM.box(cM.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))),MP(cM,"SMHD",cM.box(cM.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0]))),MP(cM,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0])),MP(cM,"STTS",cM.box(cM.types.stts,cM.StblTable)),MP(cM,"STSC",cM.box(cM.types.stsc,cM.StblTable)),MP(cM,"STSZ",cM.box(cM.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]))),MP(cM,"STCO",cM.box(cM.types.stco,cM.StblTable));var lM,dM=/Chrome\/([^.]+)/.exec(navigator.userAgent),hM=dM&&Number(dM[1])<50,fM=function(){function e(t,r){NP(this,e),this.videoTrack=t,this.audioTrack=r}return LP(e,[{key:"remux",value:function(){var e,t,r,n,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=this.videoTrack,o=this.audioTrack,s=a.exist(),u=o.exist();return i&&(s&&(e=cM.initSegment([this.videoTrack])),u&&(t=cM.initSegment([this.audioTrack]))),s&&a.hasSample()&&(r=this._remuxVideo()),u&&o.hasSample()&&(n=this._remuxAudio()),a.samples=[],o.samples=[],{videoInitSegment:e,audioInitSegment:t,videoSegment:r,audioSegment:n}}},{key:"_remuxVideo",value:function(){var e=this.videoTrack,t=e.samples;hM&&(t[0].flag={dependsOn:2,isNonSyncSample:0});var r=0;t.forEach((function(e){r+=e.units.reduce((function(e,t){return e+t.byteLength}),0),r+=4*e.units.length}));for(var n,i=new Uint8Array(r),a=new DataView(i.buffer),o=function(e,r,o,s){s=t[e];var u=0;s.units.forEach((function(e){a.setUint32(o,e.byteLength),o+=4,i.set(e,o),o+=e.byteLength,u+=4+e.byteLength})),s.size=u,c=o,n=s},s=0,u=t.length,c=0;s<u;s++)o(s,0,c,n);return hL(cM.moof(this.videoTrack.sequenceNumber++,[e]),cM.mdat(i))}},{key:"_remuxAudio",value:function(){var e=this.audioTrack,t=cM.moof(this.audioTrack.sequenceNumber++,[e]),r=new Uint8Array(e.samples.reduce((function(e,t){return e+t.size}),0));return e.samples.reduce((function(e,t){return r.set(t.data,e),e+t.size}),0),hL(t,cM.mdat(r))}}]),e}(),pM=Object.defineProperty,gM=Object.defineProperties,yM=Object.getOwnPropertyDescriptors,mM=Object.getOwnPropertySymbols,vM=Object.prototype.hasOwnProperty,_M=Object.prototype.propertyIsEnumerable,bM=function(e,t,r){return t in e?pM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},AM=(lM=function(e,t){for(var r in t||(t={}))vM.call(t,r)&&bM(e,r,t[r]);if(mM)for(var n,i=h(mM(t));!(n=i()).done;)r=n.value,_M.call(t,r)&&bM(e,r,t[r]);return e}({},KR),gM(lM,yM({STREAM_PARSED:"core.streamparsed"}))),EM=Object.defineProperty,SM=Object.defineProperties,TM=Object.getOwnPropertyDescriptors,wM=Object.getOwnPropertySymbols,CM=Object.prototype.hasOwnProperty,kM=Object.prototype.propertyIsEnumerable,IM=function(e,t,r){return t in e?EM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r};function $M(e){var t,r=(null==e?void 0:e.media)||document.createElement("video");return t=function(e,t){for(var r in t||(t={}))CM.call(t,r)&&IM(e,r,t[r]);if(wM)for(var n,i=h(wM(t));!(n=i()).done;)r=n.value,kM.call(t,r)&&IM(e,r,t[r]);return e}({maxPlaylistSize:50,retryCount:3,retryDelay:1e3,loadTimeout:1e4,preloadTime:30,softDecode:!1,bufferBehind:10,maxJumpDistance:3,startTime:0},e),SM(t,TM({media:r}))}function PM(e,t,r){return Math.min(Math.max(e,t),r)}var xM=uw.left,RM=pe,OM=Aa;di({target:"Array",proto:!0,forced:!Rd("reduce")||!OM&&RM>79&&RM<83},{reduce:function(e){var t=arguments.length;return xM(this,e,t,t>1?arguments[1]:void 0)}});var DM=di,LM=hd.findIndex,MM=Nh,NM="findIndex",BM=!0;NM in[]&&Array(1).findIndex((function(){BM=!1})),DM({target:"Array",proto:!0,forced:BM},{findIndex:function(e){return LM(this,e,arguments.length>1?arguments[1]:void 0)}}),MM(NM);var UM=Object.defineProperty,GM=function(e,t,r){return n=e,i="symbol"!=_typeof$7(t)?t+"":t,a=r,i in n?UM(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a,r;var n,i,a},VM=function(){function e(e,t){GM(this,"live"),GM(this,"id",0),GM(this,"bitrate",0),GM(this,"width",0),GM(this,"height",0),GM(this,"name",""),GM(this,"url",""),GM(this,"audioCodec",""),GM(this,"videoCodec",""),GM(this,"textCodec",""),GM(this,"startCC",0),GM(this,"endCC",0),GM(this,"startSN",0),GM(this,"endSN",-1),GM(this,"totalDuration",0),GM(this,"targetDuration",0),GM(this,"snDiff",null),GM(this,"segments",[]),GM(this,"audioStreams",[]),GM(this,"currentAudioStream",null),this.update(e,t)}var t=e.prototype;return t.clearOldSegment=function(e,t){return this.currentAudioStream&&this._clearSegments(this.currentAudioStream,e,t),this._clearSegments(this,e,t)},t.getAudioSegment=function(e){if(e&&this.currentAudioStream){var t=e.sn-this.snDiff;return this.currentAudioStream.segments.find((function(e){return e.sn===t}))}},t.update=function(e,t){this.url=e.url,Array.isArray(e.segments)?(null==this.live&&(this.live=e.live),this._updateSegments(e,this),this.startCC=e.startCC,this.endCC=e.endCC,this.startSN=e.startSN,this.endSN=e.endSN||-1,this.totalDuration=e.totalDuration,this.targetDuration=e.targetDuration,this.live=e.live,t&&this.currentAudioStream&&Array.isArray(t.segments)&&(this._updateSegments(t,this.currentAudioStream),null==this.snDiff&&e.segments.length&&t.segments.length&&(this.snDiff=e.segments[0].sn-t.segments[0].sn))):(this.id=e.id,this.bitrate=e.bitrate,this.width=e.width,this.height=e.height,this.name=e.name,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.textCodec=e.textCodec,this.audioStreams=e.audioStreams,!this.currentAudioStream&&this.audioStreams.length&&(this.currentAudioStream=this.audioStreams.find((function(e){return e.default}))||this.audioStreams[0]))},t._clearSegments=function(e,t){for(var r=0,n=this.segments,i=0,a=n.length;i<a;i++)if(n[i].end>=e){r=i;break}return r>t&&(r=t),r&&(this.segments=this.segments.slice(r),this.currentAudioStream&&(this.currentAudioStream.segments=this.currentAudioStream.segments.slice(r))),t-r},t._updateSegments=function(e,t){var r=t.segments;if(this.live){var n=r[r.length-1],i=(null==n?void 0:n.sn)||-1;if(i<e.endSN&&e.segments.length){var a=e.segments.findIndex((function(e){return e.sn===i})),o=a<0?e.segments:e.segments.slice(a+1);if(r.length&&o.length){var s=n.end;o.forEach((function(e){e.start=s,s=e.end}));var u=(null==n?void 0:n.cc)||-1;u>o[0].cc&&o.forEach((function(e){return e.cc+=u}))}t.segments=r.concat(o)}}else t.segments=e.segments},a(e,[{key:"lastSegment",get:function(){if(this.segments.length)return this.segments[this.segments.length-1]}},{key:"segmentDuration",get:function(){var e;return this.targetDuration||(null==(e=this.segments[0])?void 0:e.duration)||0}},{key:"liveEdge",get:function(){return this.endTime}},{key:"endTime",get:function(){var e;return(null==(e=this.lastSegment)?void 0:e.end)||0}}]),e}(),FM=Object.defineProperty,jM=function(e,t,r){return n=e,i="symbol"!=_typeof$7(t)?t+"":t,a=r,i in n?FM(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a,r;var n,i,a},HM=function(){function e(e){jM(this,"streams",[]),jM(this,"currentStream",null),jM(this,"dvrWindow",0),jM(this,"_segmentPointer",-1),this.hls=e}var t=e.prototype;return t.getAudioSegment=function(e){var t;return null==(t=this.currentStream)?void 0:t.getAudioSegment(e)},t.moveSegmentPointer=function(e){var t;null==e&&(e=this._segmentPointer+1),this._segmentPointer=PM(e,-1,null==(t=this.currentSegments)?void 0:t.length)},t.reset=function(){this.streams=[],this.currentStream=null,this.dvrWindow=0,this._segmentPointer=-1},t.getSegmentByIndex=function(e){var t;return null==(t=this.currentSegments)?void 0:t[e]},t.setNextSegmentByIndex=function(e){void 0===e&&(e=0),this._segmentPointer=e-1},t.findSegmentIndexByTime=function(e){var t=this.currentSegments;if(t){for(var r,n=0,i=t.length;n<i;n++)if(e>=(r=t[n]).start&&e<r.end)return n;var a=t[t.length-1];if(Math.abs(e-a.end)<.2)return t.length-1}},t.upsertPlaylist=function(e,t){var r=this;if(e){if(e.isMaster)this.streams.length=e.streams.length,e.streams.filter((function(e){return e.url})).forEach((function(e,t){r.streams[t]?r.streams[t].update(e):r.streams[t]=new VM(e)})),this.currentStream=this.streams[0];else if(Array.isArray(e.segments)){var n=this.currentStream;n?n.update(e,t):(this.reset(),this.currentStream=this.streams[0]=new VM(e,t))}this.currentStream&&this.hls.isLive&&!this.dvrWindow&&(this.dvrWindow=this.currentSegments.reduce((function(e,t){return e+t.duration}),0))}},t.clearOldSegment=function(e){void 0===e&&(e=50);var t=this.currentStream;if(this.dvrWindow&&t){var r=t.endTime-this.dvrWindow;r<=0||t.segments.length<=e||(this._segmentPointer=t.clearOldSegment(r,this._segmentPointer))}},a(e,[{key:"lastSegment",get:function(){var e;return null==(e=this.currentStream)?void 0:e.lastSegment}},{key:"currentSegment",get:function(){var e;return null==(e=this.currentSegments)?void 0:e[this._segmentPointer]}},{key:"nextSegment",get:function(){var e;return null==(e=this.currentSegments)?void 0:e[this._segmentPointer+1]}},{key:"currentSegments",get:function(){var e;return null==(e=this.currentStream)?void 0:e.segments}},{key:"liveEdge",get:function(){var e;return null==(e=this.currentStream)?void 0:e.liveEdge}},{key:"seekRange",get:function(){var e=this.currentSegments;if(e&&e.length)return[e[0].start,e[e.length-1].end]}},{key:"isEmpty",get:function(){var e;return!(null==(e=this.currentSegments)?void 0:e.length)}},{key:"isLive",get:function(){var e;return null==(e=this.currentStream)?void 0:e.live}}]),e}(),ZM=function(){function e(){var e=window.crypto||window.msCrypto;this.subtle=e&&(e.subtle||e.webkitSubtle),this.externalDecryptor=null}var r,i=e.prototype;return i.decrypt=function(e,t){if(e||t){var r=[];return e&&(r[0]=this._decryptSegment(e)),t&&(r[1]=this._decryptSegment(t)),Promise.all(r)}},i._decryptSegment=(r=n(t().mark((function e(r){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.data,!r.key){e.next=5;break}return e.next=4,this._decryptData(r.data,r.key,r.keyIv);case 4:n=e.sent;case 5:if(r.map){e.next=7;break}return e.abrupt("return",n);case 7:return e.abrupt("return",HR(r.map,n));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)}),i._decryptData=function(){var e=n(t().mark((function e(r,n,i){var a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.externalDecryptor){e.next=6;break}return e.next=3,this.externalDecryptor.decrypt(r,n,i);case 3:return e.abrupt("return",e.sent);case 6:if(this.subtle){e.next=8;break}throw new Error("crypto is not defined");case 8:return e.next=10,this.subtle.importKey("raw",n,{name:"AES-CBC"},!1,["encrypt","decrypt"]);case 10:return a=e.sent,e.t0=Uint8Array,e.next=14,this.subtle.decrypt({name:"AES-CBC",iv:i},a,r);case 14:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),e}(),WM=Object.defineProperty,KM=Object.defineProperties,XM=Object.getOwnPropertyDescriptors,YM=Object.getOwnPropertySymbols,zM=Object.prototype.hasOwnProperty,JM=Object.prototype.propertyIsEnumerable,QM=function(e,t,r){return t in e?WM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},qM=function(e,t){for(var r in t||(t={}))zM.call(t,r)&&QM(e,r,t[r]);if(YM)for(var n,i=h(YM(t));!(n=i()).done;)r=n.value,JM.call(t,r)&&QM(e,r,t[r]);return e},eN=function(e,t){return KM(e,XM(t))},tN=new XR("Transmuxer"),rN=function(){function e(e,t,r){this.hls=e,this._demuxer=t?new oM:new NL,this._isMP4=t,r&&(this._remuxer=new fM(this._demuxer.videoTrack,this._demuxer.audioTrack))}var t=e.prototype;return t.transmux=function(e,t,r,n,i,a){var o=this._demuxer;try{this._isMP4?o.demux(e,t):o.demuxAndFix(HR(e,t),r,n,i)}catch(EU){throw new _x(fx,mx.HLS,EU)}var s=o.videoTrack,u=o.audioTrack,c=o.metadataTrack;if(this._fireEvents(s,u,c,r),!this._remuxer)return[s,u];try{var l=this._remuxer.remux(a),d=l.videoInitSegment,h=l.videoSegment,f=l.audioInitSegment,p=l.audioSegment,g=HR(d,h),y=HR(f,p);return[g?{codec:s.codec,data:g}:void 0,y?{codec:u.codec,data:y}:void 0]}catch(EU){throw new _x(px,mx.FMP4,EU)}},t._fireEvents=function(e,t,r,n){var i=this;tN.debug(e.samples,t.samples),n&&(e.exist()&&this.hls.emit(AM.METADATA_PARSED,{type:"video",meta:{codec:e.codec,timescale:e.timescale,width:e.width,height:e.height,sarRatio:e.sarRatio,baseDts:e.baseDts}}),t.exist()&&this.hls.emit(AM.METADATA_PARSED,{type:"audio",meta:{codec:t.codec,channelCount:t.channelCount,sampleRate:t.sampleRate,timescale:t.timescale,baseDts:t.baseDts}}),tN.debug("discontinuity",e,t)),e.warnings.forEach((function(e){var t;switch(e.type){case qD:t=AM.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case eL:t=AM.LARGE_VIDEO_DTS_GAP_DETECT;break;case tL:t=AM.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT}t&&i.hls.emit(AM.STREAM_EXCEPTION,eN(qM({},e),{type:t})),tN.warn("video exception",e)})),t.warnings.forEach((function(e){var t;switch(e.type){case rL:t=AM.LARGE_AUDIO_DTS_GAP_DETECT;break;case nL:t=AM.AUDIO_GAP_DETECT;break;case iL:t=AM.AUDIO_OVERLAP_DETECT}t&&i.hls.emit(AM.STREAM_EXCEPTION,eN(qM({},e),{type:t})),tN.warn("audio exception",e)})),e.samples.forEach((function(e){e.keyframe&&i.hls.emit(AM.KEYFRAME,{pts:e.pts})})),r.seiSamples.forEach((function(e){i.hls.emit(AM.SEI,eN(qM({},e),{originPts:e.originPts/90,sei:{code:e.data.type,content:e.data.payload,dts:e.pts}}))}))},e}(),nN=Object.defineProperty,iN=function(e,t,r){return n=e,i="symbol"!=_typeof$7(t)?t+"":t,a=r,i in n?nN(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a,r;var n,i,a},aN=new XR("BufferService"),oN=function(){function e(e){iN(this,"_decryptor",new ZM),iN(this,"_transmuxer",null),iN(this,"_mse",null),iN(this,"_softVideo",null),iN(this,"_sourceCreated",!1),iN(this,"_needInitSegment",!0),iN(this,"_directAppend",!1),this.hls=e,e.config.softDecode?this._softVideo=e.media:(this._mse=new Ax,this._mse.bindMedia(e.media)),e.config.decryptor&&(this._decryptor.externalDecryptor=e.config.decryptor)}var r,i=e.prototype;return i.updateDuration=(r=n(t().mark((function e(r){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(aN.debug("update duration",r),!this._mse){e.next=9;break}if(this._mse.isOpened){e.next=5;break}return e.next=5,this._mse.open();case 5:return e.next=7,this._mse.updateDuration(r);case 7:e.next=10;break;case 9:this._softVideo&&(this._softVideo.duration=r);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)}),i.createSource=function(e,t,r,n){if(!this._sourceCreated){var i=e||t;if(i){if(NL.probe(i))this._transmuxer||(this._transmuxer=new rN(this.hls,!1,!this._softVideo));else{if(!tM.probe(i))throw new _x(yx,null,null,null,"unsupported stream");if(this._softVideo)this._transmuxer||(this._transmuxer=new rN(this.hls,!0));else{this._directAppend=!0;var a=!1;e&&!r&&tM.findBox(e,["moov","trak"]).forEach((function(e){var t,i=tM.findBox(e.data,["trak","mdia","minf","stbl","stsd"])[0];if(i){var o=tM.stsd(i).entries[0];o&&(o.hvcC?r=o.hvcC.codec||"hev1.1.6.L93.B0":o.avcC?r=o.avcC.codec:(o.sampleRate||o.esds)&&(n=(null==(t=o.esds)?void 0:t.codec)||"mp4a.40.2",a=!0))}})),t&&!n&&tM.findBox(t,["moov","trak","mdia","minf","stbl","stsd"]).forEach((function(e){var t=tM.stsd(e).entries[0];t&&t.esds&&(n=t.esds.codec)})),e&&!r&&(r="avc1.42e01e"),t&&!n&&(n="mp4a.40.2"),a&&(r+=", "+n,n=""),this._createMseSource(r,n)}}this._softVideo&&(this._sourceCreated=!0)}}},i.appendBuffer=function(){var e=n(t().mark((function e(r,n,i,a,o){var s,u,c,l,d;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null==r?void 0:r.length)||(null==n?void 0:n.length)){e.next=2;break}return e.abrupt("return");case 2:if(!this._directAppend){e.next=7;break}return s=[],r&&s.push(this._mse.append(Ax.VIDEO,r)),n&&s.push(this._mse.append(Ax.AUDIO,n)),e.abrupt("return",Promise.all(s));case 7:if(u=this._transmuxer.transmux(r,n,i,a,o,this._needInitSegment||i),c=u[0],l=u[1],!this._softVideo){e.next=12;break}this._softVideo.appendBuffer(c,l),e.next=20;break;case 12:if(!this._mse){e.next=20;break}return this._sourceCreated||this._createMseSource(null==c?void 0:c.codec,null==l?void 0:l.codec),this._needInitSegment=!1,d=this._mse,s=[],c&&s.push(d.append(Ax.VIDEO,c.data)),l&&s.push(d.append(Ax.AUDIO,l.data)),e.abrupt("return",Promise.all(s));case 20:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}(),i.evictBuffer=function(){var e=n(t().mark((function e(r){var n,i,a,o=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.hls.media,this._mse&&n&&r&&!(r<0)){e.next=3;break}return e.abrupt("return");case 3:if(i=n.currentTime,!((a=i-r)<=0)){e.next=7;break}return e.abrupt("return");case 7:if(!(ux.start(ux.get(n))+1>=a)){e.next=10;break}return e.abrupt("return");case 10:return e.abrupt("return",this._mse.clearBuffer(0,a).then((function(){return o.hls.emit(KR.REMOVE_BUFFER,{removeEnd:a})})));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),i.clearAllBuffer=function(){var e=n(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=2;break}return e.abrupt("return",this._mse.clearAllBuffer());case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i.decryptBuffer=function(e,t){return this._decryptor.decrypt(e,t)},i.reset=function(){var e=n(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=5;break}return e.next=3,this._mse.unbindMedia();case 3:return e.next=5,this._mse.bindMedia(this.hls.media);case 5:this._transmuxer=null,this._sourceCreated=!1,this._needInitSegment=!0,this._directAppend=!1;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i.endOfStream=function(){var e=n(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=5;break}if(!this._sourceCreated){e.next=5;break}return e.next=4,this._mse.endOfStream();case 4:this.hls.emit(KR.BUFFEREOS);case 5:this._softVideo&&this._softVideo.endOfStream();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i.setLiveSeekableRange=function(){var e=n(t().mark((function e(r,n){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._mse&&this._mse.setLiveSeekableRange(r,n);case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),i.destroy=function(){var e=n(t().mark((function e(){var r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._mse,this._mse=null,this._softVideo=null,!r){e.next=6;break}return e.next=6,r.unbindMedia();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i._createMseSource=function(e,t){aN.debug("create mse source, videoCodec="+e+", audioCodec="+t);var r=this._mse;r&&(e&&(r.createSource(Ax.VIDEO,"video/mp4;codecs="+e),this._sourceCreated=!0),t&&(r.createSource(Ax.AUDIO,"audio/mp4;codecs="+t),this._sourceCreated=!0),this.hls.emit(KR.SOURCEBUFFER_CREATED))},a(e,[{key:"baseDts",get:function(){var e,t,r;return null==(r=null==(t=null==(e=this._transmuxer)?void 0:e._demuxer)?void 0:t._fixer)?void 0:r._baseDts}}]),e}(),sN=Object.defineProperty,uN=function(e,t,r){return n=e,i="symbol"!=_typeof$7(t)?t+"":t,a=r,i in n?sN(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a,r;var n,i,a},cN=function(){uN(this,"version",0),uN(this,"streams",[]),uN(this,"isMaster",!0)},lN=function(){uN(this,"id",0),uN(this,"url",""),uN(this,"default",!1),uN(this,"group",""),uN(this,"name",""),uN(this,"lang",""),uN(this,"channels",0),uN(this,"segments",[])},dN=function(){uN(this,"id",0),uN(this,"bitrate",0),uN(this,"width",0),uN(this,"height",0),uN(this,"name",""),uN(this,"url",""),uN(this,"audioCodec",""),uN(this,"videoCodec",""),uN(this,"textCodec",""),uN(this,"audioGroup",""),uN(this,"audioStreams",[])},hN=function(){uN(this,"version",0),uN(this,"url",""),uN(this,"type",""),uN(this,"startCC",0),uN(this,"endCC",0),uN(this,"startSN",0),uN(this,"endSN",0),uN(this,"totalDuration",0),uN(this,"targetDuration",0),uN(this,"live",!0),uN(this,"segments",[])},fN=function(){function e(){uN(this,"sn",0),uN(this,"cc",0),uN(this,"url",""),uN(this,"title",""),uN(this,"start",0),uN(this,"duration",0),uN(this,"key",null),uN(this,"byteRange",null),uN(this,"isInitSegment",!1),uN(this,"initSegment",null),uN(this,"isLast",!1)}return e.prototype.setByteRange=function(e,t){this.byteRange=[0];var r=e.split("@");1===r.length&&t&&t.byteRange?(this.byteRange[0]=t.byteRange[1]||0,this.byteRange[0]&&(this.byteRange[0]+=1)):this.byteRange[0]=parseInt(r[1]),this.byteRange[1]=this.byteRange[0]+parseInt(r[0])-1},a(e,[{key:"end",get:function(){return this.start+this.duration}}]),e}(),pN=function(){function e(t){uN(this,"method",""),uN(this,"url",""),uN(this,"iv",null),uN(this,"keyFormat",""),uN(this,"keyFormatVersions",""),t instanceof e&&(this.method=t.method,this.url=t.url,this.keyFormat=t.keyFormat,this.keyFormatVersions=t.keyFormatVersions,t.iv&&(this.iv=new Uint8Array(t.iv)))}var t=e.prototype;return t.clone=function(t){var r=new e(this);return null!=t&&r.setIVFromSN(t),r},t.setIVFromSN=function(e){if(!this.iv&&"AES-128"===this.method&&"number"==typeof e&&this.url){this.iv=new Uint8Array(16);for(var t=12;t<16;t++)this.iv[t]=e>>8*(15-t)&255}},e}(),gN=/^#(EXT[^:]*)(?::(.*))?$/,yN=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g,mN=/^(?:[a-zA-Z0-9+\-.]+:)?\/\//,vN=/^((?:[a-zA-Z0-9+\-.]+:)?\/\/[^/?#]*)?([^?#]*\/)?/;function _N(e){var t=e.match(gN);if(t&&t[1])return[t[1].replace("EXT-X-",""),t[2]]}function bN(e){for(var t={},r=yN.exec(e);r;)t[r[1]]=r[2]||r[3],r=yN.exec(e);return t}function AN(e,t){if(!t||!e||mN.test(e))return e;var r=vN.exec(t);return r?"/"===e[0]?r[1]+e:r[1]+r[2]+e:e}var EN={audio:[/^mp4a/,/^vorbis$/,/^opus$/,/^flac$/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]};function SN(e,t){var r=EN[e];if(r&&t&&t.length)for(var n=0;n<r.length;n++)for(var i=0;i<t.length;i++)if(r[n].test(t[i]))return t[i]}var TN=g,wN=m,CN=Xc,kN=$_.trim,IN=L("".charAt),$N=TN.parseFloat,PN=TN.Symbol,xN=PN&&PN.iterator,RN=1/$N("\t\n\v\f\r Â áš€â€€â€â€‚â€ƒâ€„â€…â€†â€‡â€ˆâ€‰â€Šâ€¯âŸã€€\u2028\u2029\ufeff-0")!=-1/0||xN&&!wN((function(){$N(Object(xN))}))?function(e){var t=kN(CN(e)),r=$N(t);return 0===r&&"-"==IN(t,0)?-0:r}:$N;di({global:!0,forced:parseFloat!=RN},{parseFloat:RN});var ON=function(){function e(){}return e.parse=function(t,r){if(void 0===t&&(t=""),!t.includes("#EXTM3U"))throw new Error("Invalid m3u8 file");var n=t.split(/[\r\n]/).map((function(e){return e.trim()})).filter(Boolean);return e.isMediaPlaylist(t)?function(e,t){var r=new hN;r.url=t;for(var n,i=new fN,a=null,o=null,s=0,u=0,c=0,l=0;n=e[l++];)if("#"===n[0]){var d=_N(n);if(d){var h=d[0],f=d[1];switch(h){case"VERSION":r.version=parseInt(f);break;case"PLAYLIST-TYPE":r.type=null==f?void 0:f.toUpperCase();break;case"TARGETDURATION":r.targetDuration=parseFloat(f);break;case"ENDLIST":var p=r.segments[r.segments.length-1];p&&(p.isLast=!0),r.live=!1;break;case"MEDIA-SEQUENCE":u=r.startSN=parseInt(f);break;case"DISCONTINUITY-SEQUENCE":c=r.startCC=parseInt(f);break;case"DISCONTINUITY":c++;break;case"BYTERANGE":i.setByteRange(f,r.segments[r.segments.length-1]);break;case"EXTINF":var g=f.split(","),y=g[0],m=g[1];i.start=s,i.duration=parseFloat(y),s+=i.duration,i.title=m;break;case"KEY":var v=bN(f);if("NONE"===v.METHOD){o=null;break}if("AES-128"!==v.METHOD)throw new Error("encrypt "+v.METHOD+"/"+v.KEYFORMAT+" is not supported");if((o=new pN).method=v.METHOD,o.url=/^blob:/.test(v.URI)?v.URI:AN(v.URI,t),o.keyFormat=v.KEYFORMAT||"identity",o.keyFormatVersions=v.KEYFORMATVERSIONS,v.IV){var _=v.IV.slice(2);_=(1&_.length?"0":"")+_,o.iv=new Uint8Array(_.length/2);for(var b=0,A=_.length/2;b<A;b++)o.iv[b]=parseInt(_.slice(2*b,2*b+2),16)}break;case"MAP":var E=bN(f);i.url=AN(E.URI,t),E.BYTERANGE&&i.setByteRange(E.BYTERANGE),i.isInitSegment=!0,i.sn=0,o&&(i.key=o.clone(0)),a=i,i=new fN}}}else i.sn=u,i.cc=c,i.url=AN(n,t),o&&(i.key=o.clone(u)),a&&(i.initSegment=a),r.segments.push(i),i=new fN,u++;var S=r.segments[r.segments.length-1];return S&&(r.endSN=S.sn),r.totalDuration=s,r.endCC=c,r}(n,r):function(e,t){for(var r,n=new cN,i=0,a=[];r=e[i++];){var o=_N(r);if(o){var s=o[0],u=o[1];if("VERSION"===s)n.version=parseInt(u);else if("MEDIA"===s&&u){var c=bN(u);if("AUDIO"===c.TYPE&&c.URI){var l=new lN;l.url=AN(c.URI,t),l.default="YES"===c.DEFAULT,l.group=c["GROUP-ID"],l.name=c.NAME,l.lang=c.LANGUAGE,c.CHANNELS&&(l.channels=Number(c.CHANNELS.split("/")[0]),isNaN(l.channels)&&(l.channels=0)),a.push(l)}}else if("STREAM-INF"===s&&u){var d=new dN,h=bN(u);if(d.bitrate=parseInt(h["AVERAGE-BANDWIDTH"]||h.BANDWIDTH),d.name=h.NAME,d.url=AN(e[i++],t),h.RESOLUTION){var f=h.RESOLUTION.split("x"),p=f[0],g=f[1];d.width=parseInt(p),d.height=parseInt(g)}if(h.CODECS){var y=h.CODECS.split(/[ ,]+/).filter(Boolean);d.videoCodec=SN("video",y),d.audioCodec=SN("audio",y),d.textCodec=SN("text",y)}d.audioGroup=h.AUDIO,n.streams.push(d)}}}return n.streams.forEach((function(e,t){e.id=t})),a.length&&(a.forEach((function(e,t){e.id=t})),n.streams.forEach((function(e){e.audioGroup&&(e.audioStreams=a.filter((function(t){return t.group===e.audioGroup})))}))),n}(n,r)},e.isMediaPlaylist=function(e){return e.includes("#EXTINF:")||e.includes("#EXT-X-TARGETDURATION:")},e}(),DN=Object.defineProperty,LN=Object.defineProperties,MN=Object.getOwnPropertyDescriptors,NN=Object.getOwnPropertySymbols,BN=Object.prototype.hasOwnProperty,UN=Object.prototype.propertyIsEnumerable,GN=function(e,t,r){return t in e?DN(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},VN=function(e,t){for(var r in t||(t={}))BN.call(t,r)&&GN(e,r,t[r]);if(NN)for(var n,i=h(NN(t));!(n=i()).done;)r=n.value,UN.call(t,r)&&GN(e,r,t[r]);return e},FN=function(e,t){return LN(e,MN(t))},jN=function(){function e(e){var t,r=this;GN(this,"symbol"!=_typeof$7(t="_onLoaderRetry")?t+"":t,(function(e,t){r.hls.emit(AM.LOAD_RETRY,{error:_x.network(e),retryTime:t})})),this.hls=e,this._timer=null;var n=this.hls.config,i=n.retryCount,a=n.retryDelay,o=n.loadTimeout,s=n.fetchOptions;this._loader=new WR(FN(VN({},s),{responseType:"text",retry:i,retryDelay:a,timeout:o,onRetryError:this._onLoaderRetry})),this._audioLoader=new WR(FN(VN({},s),{responseType:"text",retry:i,retryDelay:a,timeout:o,onRetryError:this._onLoaderRetry}))}var r,i=e.prototype;return i.load=(r=n(t().mark((function e(r,n){var i,a,o,s,u,c,l,d,h;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=[this._loader.load(r)],n&&i.push(this._audioLoader.load(n)),e.prev=2,e.next=5,Promise.all(i);case 5:if(s=e.sent,u=s[0],c=s[1],u){e.next=10;break}return e.abrupt("return",[]);case 10:a=u.data,o=null==c?void 0:c.data,e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(2),_x.network(e.t0);case 17:l=this.hls.config.onPreM3U8Parse,e.prev=18,l&&(a=l(a)||a,o&&(o=l(o,!0)||o)),d=ON.parse(a,r),o&&(h=ON.parse(o,n)),e.next=27;break;case 24:throw e.prev=24,e.t1=e.catch(18),new _x(lx,mx.HLS);case 27:return d&&(d.isMaster?this.hls.emit(AM.HLS_MANIFEST_LOADED,{playlist:d}):this.hls.emit(AM.HLS_LEVEL_LOADED,{playlist:d})),e.abrupt("return",[d,h]);case 29:case"end":return e.stop()}}),e,this,[[2,14],[18,24]])}))),function(e,t){return r.apply(this,arguments)}),i.poll=function(e,r,i,a){var o=this;clearTimeout(this._timer),a=a||3e3;var s,u=(s=n(t().mark((function n(){var s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return clearTimeout(o._timer),t.next=3,o.load(e,r);case 3:if((s=t.sent)[0]){t.next=6;break}return t.abrupt("return");case 6:i(s[0],s[1]),o._timer=setTimeout(u,a);case 8:case"end":return t.stop()}}),n)}))),function(){return s.apply(this,arguments)});this._timer=setTimeout(u,a)},i.stopPoll=function(){return clearTimeout(this._timer),this.cancel()},i.cancel=function(){return Promise.all([this._loader.cancel(),this._audioLoader.cancel()])},e}(),HN=Object.defineProperty,ZN=Object.defineProperties,WN=Object.getOwnPropertyDescriptors,KN=Object.getOwnPropertySymbols,XN=Object.prototype.hasOwnProperty,YN=Object.prototype.propertyIsEnumerable,zN=function(e,t,r){return t in e?HN(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},JN=function(e,t){for(var r in t||(t={}))XN.call(t,r)&&zN(e,r,t[r]);if(KN)for(var n,i=h(KN(t));!(n=i()).done;)r=n.value,YN.call(t,r)&&zN(e,r,t[r]);return e},QN=function(e,t){return ZN(e,WN(t))},qN=function(e,t,r){return zN(e,"symbol"!=_typeof$7(t)?t+"":t,r),r},eB=function(){function e(e){var t=this;qN(this,"_emitOnLoaded",(function(e,r){var n=e.endTime-e.startTime;t._bandwidthService.addRecord(e.contentLength,n),t.hls.emit(KR.SPEED,{time:n,byteLength:e.contentLength,url:r}),t.hls.emit(KR.LOAD_COMPLETE,{url:r,elapsed:n||0});var i=e.response,a=e.firstByteTime,o=e.startTime;t.hls.emit(KR.TTFB,{url:r,responseUrl:i.url,elapsed:a-o}),t.hls.emit(KR.LOAD_RESPONSE_HEADERS,{headers:i.headers})})),qN(this,"_onLoaderRetry",(function(e,r){t.hls.emit(KR.LOAD_RETRY,{error:_x.network(e),retryTime:r})})),this.hls=e,this._bandwidthService=new zO,this._mapCache={},this._keyCache={};var r=this.hls.config,n=r.retryCount,i=r.retryDelay,a=r.loadTimeout,o=r.fetchOptions;this._segmentLoader=new WR(QN(JN({},o),{responseType:"arraybuffer",retry:n,retryDelay:i,timeout:a,onRetryError:this._onLoaderRetry})),this._audioSegmentLoader=new WR(QN(JN({},o),{responseType:"arraybuffer",retry:n,retryDelay:i,timeout:a,onRetryError:this._onLoaderRetry})),this._keyLoader=new WR(QN(JN({},o),{responseType:"arraybuffer",retry:n,retryDelay:i,timeout:a,onRetryError:this._onLoaderRetry}))}var r,i=e.prototype;return i.speedInfo=function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed()}},i.load=function(e,t,r,n){void 0===n&&(n=r);var i=[];return e&&(i[0]=this.loadVideoSegment(e,r)),t&&(i[1]=this.loadAudioSegment(t,n)),Promise.all(i)},i.loadVideoSegment=function(e,t){return this._loadSegment(this._segmentLoader,e,t)},i.loadAudioSegment=function(e,t){return this._loadSegment(this._audioSegmentLoader,e,t)},i._loadSegment=(r=n(t().mark((function e(r,n,i){var a,o,s,u,c,l,d,h,f,p,g,y,m,v,_=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f=[],this.hls.emit(KR.LOAD_START,{url:n.url}),f[0]=r.load(n.url),i&&n.initSegment&&(p=n.initSegment.url,(u=this._mapCache[p])||(this.hls.emit(KR.LOAD_START,{url:p}),f[1]=r.load(p).then((function(e){e&&(Object.keys(_._mapCache)>30&&(_._mapCache={}),u=_._mapCache[p]=e.data,_._emitOnLoaded(e,p))}))),(g=null==(a=n.initSegment.key)?void 0:a.url)&&(h=n.initSegment.key.iv,(d=this._keyCache[g])||(this.hls.emit(KR.LOAD_START,{url:g}),f[2]=this._keyLoader.load(g).then((function(e){e&&(d=_._keyCache[g]=e.data,_._emitOnLoaded(e,g))}))))),(y=null==(o=n.key)?void 0:o.url)&&(l=n.key.iv,(c=this._keyCache[y])||(this.hls.emit(KR.LOAD_START,{url:y}),f[3]=this._keyLoader.load(y).then((function(e){e&&(c=_._keyCache[y]=e.data,_._emitOnLoaded(e,y))})))),e.next=8,Promise.all(f);case 8:if(m=e.sent,v=m[0]){e.next=12;break}return e.abrupt("return");case 12:return s=v.data,this._emitOnLoaded(v,n.url),e.abrupt("return",{data:s,map:u,key:c,mapKey:d,keyIv:l,mapKeyIv:h});case 15:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)}),i.reset=function(){this._mapCache={},this._keyCache={},this._bandwidthService.reset()},i.cancel=function(){var e=n(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this._keyLoader.cancel(),this._segmentLoader.cancel(),this._audioSegmentLoader.cancel()]);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),e}(),tB=Object.defineProperty,rB=function(e,t,r){return n=e,i="symbol"!=_typeof$7(t)?t+"":t,a=r,i in n?tB(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a,r;var n,i,a},nB=new XR("hls"),iB=function(e){function r(i){var a,o;return a=e.call(this)||this,rB(l(a),"version",r.version),rB(l(a),"media",null),rB(l(a),"config",null),rB(l(a),"_manifestLoader",null),rB(l(a),"_segmentLoader",null),rB(l(a),"_playlist",null),rB(l(a),"_bufferService",null),rB(l(a),"_gapService",null),rB(l(a),"_seiService",null),rB(l(a),"_prevSegSn",null),rB(l(a),"_prevSegCc",null),rB(l(a),"_tickTimer",null),rB(l(a),"_tickInterval",500),rB(l(a),"_segmentProcessing",!1),rB(l(a),"_reloadOnPlay",!1),rB(l(a),"_loadM3U8",(o=n(t().mark((function e(r){var n,i,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=4,a._manifestLoader.load(r);case 4:i=e.sent,n=i[0],e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(0),a._emitError(_x.create(e.t0));case 11:if(n){e.next=13;break}return e.abrupt("return");case 13:if(a._playlist.upsertPlaylist(n),!n.isMaster){e.next=17;break}return e.next=17,a._refreshM3U8();case 17:if(a.emit(AM.STREAM_PARSED),!a.isLive){e.next=23;break}a._bufferService.setLiveSeekableRange(0,4294967295),n.isMaster||a._pollM3U8(r),e.next=27;break;case 23:return e.next=25,a._bufferService.updateDuration(a._playlist.currentStream.totalDuration);case 25:(o=a.config.startTime)&&(a.media.currentTime=o,a._playlist.setNextSegmentByIndex(a._playlist.findSegmentIndexByTime(o)||0));case 27:case"end":return e.stop()}}),e,null,[[0,8]])}))),function(e){return o.apply(this,arguments)})),rB(l(a),"_loadSegment",n(t().mark((function e(){var r,n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a._segmentProcessing&&a.media){e.next=2;break}return e.abrupt("return");case 2:if(r=a.media.currentTime,n=a._playlist.currentSegment,a._playlist.nextSegment&&!(n&&n.end-r>=a.config.preloadTime)){e.next=7;break}return e.abrupt("return");case 7:return e.abrupt("return",a._loadSegmentDirect());case 8:case"end":return e.stop()}}),e)})))),rB(l(a),"_onPlay",n(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(clearTimeout(a._disconnectTimer),!a._reloadOnPlay){e.next=6;break}a._reloadOnPlay=!1,a.replay(!0),e.next=9;break;case 6:return e.next=8,a._loadSegment();case 8:a._startTick();case 9:case"end":return e.stop()}}),e)})))),rB(l(a),"_onPause",(function(){if(a.isLive){if(!a._reloadOnPlay){var e=a.config.disconnectTime;if(null==e&&(e=a._playlist.dvrWindow),!isFinite(e))return;clearTimeout(a._disconnectTimer),a._disconnectTimer=setTimeout((function(){a._reloadOnPlay=!0,a._clear()}),e||0)}}else a._stopTick()})),rB(l(a),"_onSeeking",n(t().mark((function e(){var r,n,i,o,s,u,c;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.media){e.next=2;break}return e.abrupt("return");case 2:if(r=a.media.currentTime,!(n=a._playlist.seekRange)){e.next=9;break}if(i=PM(r,n[0]+.1,n[1]-.1),!(Math.abs(r-i)>=.1)){e.next=9;break}return a.media.currentTime=i,e.abrupt("return");case 9:if(!(o=a._playlist.currentSegment)){e.next=14;break}if(!((s=ux.info(ux.get(a.media),r,.1)).end&&s.end>=o.end)){e.next=14;break}return e.abrupt("return");case 14:if(u=a._playlist.findSegmentIndexByTime(r),c=a._playlist.getSegmentByIndex(u),null!=u&&c&&(!a._segmentProcessing||c!==a._playlist.nextSegment)){e.next=18;break}return e.abrupt("return");case 18:return nB.debug("seek to",r,c),a._playlist.setNextSegmentByIndex(u),a._stopTick(),e.next=23,a._segmentLoader.cancel();case 23:return e.next=25,a._loadSegmentDirect();case 25:a._startTick();case 26:case"end":return e.stop()}}),e)})))),rB(l(a),"_onTimeupdate",(function(){if(a.media){var e=a.config;if(e.isLive&&e.maxLatency&&e.targetLatency&&a.media){var t=a._playlist.liveEdge;if(!t)return;var r=t-a.media.currentTime;r>=e.maxLatency&&(nB.debug("latency jump",r),a.media.currentTime=t-e.targetLatency)}a._seiService.throw(a.media.currentTime)}})),rB(l(a),"_tick",(function(){if(a.media){a._startTick();var e=a.media;ux.end(ux.get(e))<.1||!e.readyState||(!(t=e)||t.paused||t.ended||0===t.playbackRate||0===t.readyState?e.readyState<2&&a._gapService&&a._gapService.do(e,a.config.maxJumpDistance,a.isLive):(a._loadSegment(),a._gapService&&a._gapService.do(e,a.config.maxJumpDistance,a.isLive)))}var t})),a.config=i=$M(i),a.media=a.config.media,a._manifestLoader=new jN(l(a)),a._segmentLoader=new eB(l(a)),a._playlist=new HM(l(a)),a._bufferService=new oN(l(a)),a._seiService=new YO(l(a)),i.softDecode||(a._gapService=new YR),a.media.addEventListener("play",a._onPlay),a.media.addEventListener("pause",a._onPause),a.media.addEventListener("seeking",a._onSeeking),a.media.addEventListener("timeupdate",a._onTimeupdate),a}o(r,e);var i,s=r.prototype;return s.speedInfo=function(){return this._segmentLoader.speedInfo()},s.bufferInfo=function(e){var t;return void 0===e&&(e=.1),ux.info(ux.get(this.media),null==(t=this.media)?void 0:t.currentTime,e)},s.playbackQuality=function(){return function(e){if(!e)return{};if("function"==typeof e.getVideoPlaybackQuality){var t=e.getVideoPlaybackQuality();return{droppedVideoFrames:t.droppedVideoFrames||t.corruptedVideoFrames,totalVideoFrames:t.totalVideoFrames,creationTime:t.creationTime}}return{droppedVideoFrames:e.webkitDroppedFrameCount,totalVideoFrames:e.webkitDecodedFrameCount,creationTime:performance.now()}}(this.media)},s.load=(i=n(t().mark((function e(r){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r&&(this.config.url=r),r=this.config.url,e.next=4,this._reset();case 4:if(r&&(r=r.trim()),r){e.next=7;break}throw this._emitError(new _x(yx,mx.OPTION,null,null,"m3u8 url is missing"));case 7:return e.next=9,this._loadM3U8(r);case 9:return e.next=11,this._loadSegment();case 11:this._startTick();case 12:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)}),s.replay=function(){var e=n(t().mark((function e(r){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config.startTime=0,!this.config.softDecode){e.next=5;break}this.load(),e.next=7;break;case 5:return e.next=7,this.load();case 7:return this._reloadOnPlay=!1,e.abrupt("return",this.media.play(!r));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),s.switchURL=function(){var e=n(t().mark((function e(r,n){var i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n=0),this.config.startTime=n,e.prev=2,!this.config.softDecode){e.next=7;break}e.t0=this.load(r),e.next=10;break;case 7:return e.next=9,this.load(r);case 9:e.t0=e.sent;case 10:i=e.t0,e.next=17;break;case 13:throw e.prev=13,e.t1=e.catch(2),this.emit(AM.SWITCH_URL_FAILED,e.t1),e.t1;case 17:return this._reloadOnPlay=!1,i&&this.emit(AM.SWITCH_URL_SUCCESS,{url:r}),e.abrupt("return",this.media.play(!0));case 20:case"end":return e.stop()}}),e,this,[[2,13]])})));return function(t,r){return e.apply(this,arguments)}}(),s.switchStream=function(){var e=n(t().mark((function e(r,n){var i,a,o,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n=!0),i=this.currentStream,a=this.streams,i&&i.id!==r&&a&&!(a.length<2)){e.next=5;break}return e.abrupt("return");case 5:if(o=a.find((function(e){return e.id===r}))){e.next=8;break}return e.abrupt("return");case 8:return e.prev=8,e.next=11,this._clear();case 11:if(!n){e.next=14;break}return e.next=14,this._bufferService.clearAllBuffer();case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(8),this._emitError(_x.create(e.t0));case 19:if(i.currentAudioStream&&o.audioStreams.length>2&&(s=i.currentAudioStream.id,o.currentAudioStream=o.audioStreams.find((function(e){return e.id===s}))||o.currentAudioStream),this._playlist.currentStream=o,e.prev=21,!this.isLive&&o.segments.length){e.next=25;break}return e.next=25,this._refreshM3U8();case 25:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,e.next=29,this._loadSegmentDirect();case 29:e.next=35;break;case 31:throw e.prev=31,e.t1=e.catch(21),this._playlist.currentStream=i,e.t1;case 35:return this._startTick(),e.abrupt("return",o);case 37:case"end":return e.stop()}}),e,this,[[8,16],[21,31]])})));return function(t,r){return e.apply(this,arguments)}}(),s.switchAudioStream=function(){var e=n(t().mark((function e(r,n){var i,a,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n=!0),i=this.currentStream){e.next=4;break}return e.abrupt("return");case 4:if((a=i.currentAudioStream)&&a.id!==r&&!(i.audioStreams.length<2)){e.next=7;break}return e.abrupt("return");case 7:if(o=i.audioStreams.find((function(e){return e.id===r}))){e.next=10;break}return e.abrupt("return");case 10:return e.prev=10,e.next=13,this._clear();case 13:if(!n){e.next=16;break}return e.next=16,this._bufferService.clearAllBuffer();case 16:e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(10),this._emitError(_x.create(e.t0));case 21:if(i.currentAudioStream=o,e.prev=22,!this.isLive&&o.segments.length){e.next=26;break}return e.next=26,this._refreshM3U8();case 26:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,e.next=30,this._loadSegmentDirect();case 30:e.next=36;break;case 32:throw e.prev=32,e.t1=e.catch(22),i.currentAudioStream=a,e.t1;case 36:return this._startTick(),e.abrupt("return",o);case 38:case"end":return e.stop()}}),e,this,[[10,18],[22,32]])})));return function(t,r){return e.apply(this,arguments)}}(),s.destroy=function(){var e=n(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.media){e.next=2;break}return e.abrupt("return");case 2:return this.removeAllListeners(),this._playlist.reset(),this._segmentLoader.reset(),this._seiService.reset(),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("pause",this._onPause),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),e.next=12,Promise.all([this._clear(),this._bufferService.destroy()]);case 12:this.media=null;case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.isSupported=function(){return Ax.isSupported()||!!WebAssembly},r.enableLogger=function(){XR.enable(),vL.enable()},r.disableLogger=function(){XR.disable(),vL.disable()},s._refreshM3U8=function(){var e,t=this,r=this._playlist.currentStream;if(!r||!r.url)throw this._emitError(_x.create(null,null,new Error("m3u8 url is not defined")));var n=r.url,i=null==(e=r.currentAudioStream)?void 0:e.url;return this._manifestLoader.load(n,i).then((function(e){var r=e[0],a=e[1];r&&(t._playlist.upsertPlaylist(r,a),t.isLive&&t._pollM3U8(n,i))})).catch((function(e){throw t._emitError(_x.create(e))}))},s._pollM3U8=function(e,t){var r,n=this,i=this._playlist.isEmpty;this._manifestLoader.poll(e,t,(function(e,t){n._playlist.upsertPlaylist(e,t),e&&i&&!n._playlist.isEmpty&&n._loadSegment(),i&&(i=n._playlist.isEmpty)}),1e3*((null==(r=this._playlist.lastSegment)?void 0:r.duration)||0))},s._loadSegmentDirect=function(){var e=n(t().mark((function e(){var r,n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._playlist.nextSegment){e.next=3;break}return e.abrupt("return");case 3:return n=!1,this._segmentProcessing=!0,e.prev=5,e.next=8,this._reqAndBufferSegment(r,this._playlist.getAudioSegment(r));case 8:n=e.sent,e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(5),this._emitError(_x.create(e.t0));case 14:return e.prev=14,this._segmentProcessing=!1,e.finish(14);case 17:return n&&(this._playlist.moveSegmentPointer(),r.isLast?this._end():this._loadSegment()),e.abrupt("return",n);case 19:case"end":return e.stop()}}),e,this,[[5,11,14,17]])})));return function(){return e.apply(this,arguments)}}(),s._reqAndBufferSegment=function(){var e=n(t().mark((function e(r,n){var i,a,o,s,u,c,l,d;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r?r.cc:n.cc,o=this._prevSegCc!==a,e.next=4,this._segmentLoader.load(r,n,o);case 4:if((s=e.sent)[0]){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,(i=this._bufferService).decryptBuffer.apply(i,s);case 9:if(u=e.sent){e.next=12;break}return e.abrupt("return");case 12:return c=r?r.sn:n.sn,l=r?r.start:n.start,d=this._playlist.currentStream,this._bufferService.createSource(u[0],u[1],null==d?void 0:d.videoCodec,null==d?void 0:d.audioCodec),e.next=18,this._bufferService.appendBuffer(u[0],u[1],o,this._prevSegSn===c-1,l);case 18:return e.next=20,this._bufferService.evictBuffer(this.config.bufferBehind);case 20:return this._prevSegCc=a,this._prevSegSn=c,e.abrupt("return",!0);case 23:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),s._clear=function(){var e=n(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._disconnectTimer),this._stopTick(),e.next=4,Promise.all([this._segmentLoader.cancel(),this._manifestLoader.stopPoll()]);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s._reset=function(){var e=n(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._reloadOnPlay=!1,this._prevSegSn=null,this._prevSegCc=null,this._playlist.reset(),this._segmentLoader.reset(),this._seiService.reset(),e.next=8,this._clear();case 8:return e.abrupt("return",this._bufferService.reset());case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s._end=function(){this._clear(),this._bufferService.endOfStream()},s._stopTick=function(){clearTimeout(this._tickTimer)},s._startTick=function(){this._stopTick(),this._tickTimer=setTimeout(this._tick,this._tickInterval)},s._emitError=function(e,t){var r;return void 0===t&&(t=!0),nB.table(e),nB.error(e),nB.error(null==(r=this.media)?void 0:r.error),this.emit(AM.ERROR,e),t&&this._end(),this._seiService.reset(),e},a(r,[{key:"isLive",get:function(){return this._playlist.isLive}},{key:"streams",get:function(){return this._playlist.streams}},{key:"currentStream",get:function(){return this._playlist.currentStream}},{key:"baseDts",get:function(){var e;return null==(e=this._bufferService)?void 0:e.baseDts}}]),r}(nD),aB=iB;rB(aB,"version","3.0.0-next.11");try{localStorage.getItem("xgd")?aB.enableLogger():aB.disableLogger()}catch(EU){}var oB=Object.defineProperty,sB=Object.defineProperties,uB=Object.getOwnPropertyDescriptors,cB=Object.getOwnPropertySymbols,lB=Object.prototype.hasOwnProperty,dB=Object.prototype.propertyIsEnumerable,hB=function(e,t,r){return t in e?oB(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},fB=function(e,t,r){return hB(e,"symbol"!=_typeof$7(t)?t+"":t,r),r},pB=function(){function e(e,t){var r=this;fB(this,"_opts",null),fB(this,"_plugin",null),fB(this,"_onLowDecode",(function(){var e,t,n,i,a,o,s=r._opts,u=s.media,c=s.innerDegrade;null==(t=null==(e=r._plugin)?void 0:e.player)||t.emit("lowdecode",u.degradeInfo),null==(i=null==(n=r._plugin)?void 0:n.player)||i.emit("core_event",(a=function(e,t){for(var r in t||(t={}))lB.call(t,r)&&hB(e,r,t[r]);if(cB)for(var n,i=h(cB(t));!(n=i()).done;)r=n.value,dB.call(t,r)&&hB(e,r,t[r]);return e}({},u.degradeInfo),o={eventName:AM.LOWDECODE},sB(a,uB(o)))),1===c&&r._degrade(u.src)})),fB(this,"_degrade",(function(e){var t=r._plugin.player,n=t.video;if(!n||"MVideo"===n.TAG){var i=t.video.degradeVideo;t.video=i,n.degrade(e),e&&(t.config.url=e);var a=t.root.firstChild;"MVideo"===a.TAG&&t.root.replaceChild(i,a);var o=r._plugin.constructor.pluginName.toLowerCase();t.unRegisterPlugin(o),t.once("canplay",(function(){t.play()}))}})),fB(this,"forceDegradeToVideo",(function(e){1===r._opts.innerDegrade&&r._degrade(e)})),this._opts=e,this._plugin=t,this._init()}var t=e.prototype;return t._init=function(){var e=this._opts,t=e.media,r=e.preloadTime,n=e.innerDegrade,i=e.isLive;t&&(i||!t.setPlayMode?(n&&t.setAttribute("innerdegrade",n),r&&t.setAttribute("preloadtime",r),this._bindEvents()):t.setPlayMode("VOD"))},t._bindEvents=function(){this._opts.media.addEventListener("lowdecode",this._onLowDecode)},t.destroy=function(){var e,t;null==(t=null==(e=this._opts)?void 0:e.media)||t.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null},e}(),gB=Object.defineProperty,yB=Object.defineProperties,mB=Object.getOwnPropertyDescriptors,vB=Object.getOwnPropertySymbols,_B=Object.prototype.hasOwnProperty,bB=Object.prototype.propertyIsEnumerable,AB=function(e,t,r){return t in e?gB(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},EB=function(e,t){for(var r in t||(t={}))_B.call(t,r)&&AB(e,r,t[r]);if(vB)for(var n,i=h(vB(t));!(n=i()).done;)r=n.value,bB.call(t,r)&&AB(e,r,t[r]);return e},SB=function(e,t,r){return AB(e,"symbol"!=_typeof$7(t)?t+"":t,r),r},TB=function(t){function r(){var e;return e=t.apply(this,arguments)||this,SB(l(e),"hls",null),SB(l(e),"pluginExtension",null),SB(l(e),"destroy",(function(){var t;e.hls&&(e.hls.destroy(),e.hls=null),null==(t=e.pluginExtension)||t.destroy(),e.pluginExtension=null})),SB(l(e),"_onSwitchURL",(function(t){e.hls&&(e.player.config.url=t,e.hls.switchURL(t).catch((function(e){})))})),SB(l(e),"_onDefinitionChange",(function(t){var r=t.to;e.hls&&e.hls.switchURL(r).catch((function(e){}))})),e}o(r,t);var n=r.prototype;return n.beforePlayerInit=function(){var t,r=this,n=this.player.config;this.hls&&this.hls.destroy(),this.player.switchURL=this._onSwitchURL;var i=n.hls||{};i.innerDegrade=i.innerDegrade||n.innerDegrade,null==i.disconnectTime&&(i.disconnectTime=0),this.hls=new aB(EB({softDecode:this.softDecode,isLive:n.isLive,media:this.player.video,startTime:n.startTime,url:n.url},i)),this.softDecode||e.BasePlugin.defineGetterOrSetter(this.player,{url:{get:function(){var e,t;return null==(t=null==(e=r.hls)?void 0:e.media)?void 0:t.src},configurable:!0}}),this.softDecode&&(this.pluginExtension=new pB(EB({isLive:n.isLive,media:this.player.video},i),this),this.player.forceDegradeToVideo=function(){var e,t;return null==(t=r.pluginExtension)?void 0:(e=t).forceDegradeToVideo.apply(e,arguments)}),n.isLive&&(null==(t=this.player)||t.useHooks("replay",(function(){var e;return null==(e=r.hls)?void 0:e.replay()}))),this.on(e.Events.URL_CHANGE,this._onSwitchURL),this.on(e.Events.DESTROY,this.destroy),this._transError(),this._transCoreEvent(KR.TTFB),this._transCoreEvent(KR.LOAD_START),this._transCoreEvent(KR.LOAD_RESPONSE_HEADERS),this._transCoreEvent(KR.LOAD_COMPLETE),this._transCoreEvent(KR.LOAD_RETRY),this._transCoreEvent(KR.SOURCEBUFFER_CREATED),this._transCoreEvent(KR.REMOVE_BUFFER),this._transCoreEvent(KR.BUFFEREOS),this._transCoreEvent(KR.KEYFRAME),this._transCoreEvent(KR.METADATA_PARSED),this._transCoreEvent(KR.SEI),this._transCoreEvent(KR.SEI_IN_TIME),this._transCoreEvent(KR.SPEED),this._transCoreEvent(KR.HLS_MANIFEST_LOADED),this._transCoreEvent(AM.STREAM_PARSED),this._transCoreEvent(KR.HLS_LEVEL_LOADED),this._transCoreEvent(KR.STREAM_EXCEPTION),this._transCoreEvent(KR.SWITCH_URL_SUCCESS),this._transCoreEvent(KR.SWITCH_URL_FAILED),n.url&&this.hls.load(n.url).catch((function(e){}))},r.isSupported=function(e){return aB.isSupported(e)},n._transError=function(){var t=this;this.hls.on(AM.ERROR,(function(r){t.player&&t.player.emit(e.Events.ERROR,new e.Errors(t.player,r))}))},n._transCoreEvent=function(e){var t=this;this.hls.on(e,(function(r){var n;t.player&&t.player.emit("core_event",(n=EB({},r),yB(n,mB({eventName:e}))))}))},a(r,[{key:"core",get:function(){return this.hls}},{key:"version",get:function(){var e;return null==(e=this.hls)?void 0:e.version}},{key:"softDecode",get:function(){var e,t,r=null==(t=null==(e=this.player)?void 0:e.config)?void 0:t.mediaType;return!!r&&"video"!==r}}],[{key:"pluginName",get:function(){return"hls"}}]),r}(e.BasePlugin);SB(TB,"Hls",aB),SB(TB,"EVENT",AM);var wB=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==_typeof$7(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=22)}([function(e,t,r){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,r){var n=r(12)("wks"),i=r(13),a=r(0).Symbol,o="function"==typeof a;(e.exports=function(e){return n[e]||(n[e]=o&&a[e]||(o?a:i)("Symbol."+e))}).store=n},function(e,t,r){var n=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=n)},function(e,t,r){var n=r(4);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){var n="function"==typeof Symbol&&"symbol"==_typeof$7(Symbol.iterator)?function(e){return _typeof$7(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof$7(e)};e.exports=function(e){return"object"===(void 0===e?"undefined":n(e))?null!==e:"function"==typeof e}},function(e,t,r){var n=r(6);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){e.exports=!r(15)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,r){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,r){var n=r(3),i=r(26),a=r(27),o=Object.defineProperty;t.f=r(7)?Object.defineProperty:function(e,t,r){if(n(e),t=a(t,!0),n(r),i)try{return o(e,t,r)}catch(s){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){e.exports=!1},function(e,t,r){var n=r(8),i=r(1)("toStringTag"),a="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,r,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(r){}}(t=Object(e),i))?r:a?n(t):"Object"==(o=n(t))&&"function"==typeof t.callee?"Arguments":o}},function(e,t,r){var n=r(2),i=r(0),a=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:r(10)?"pure":"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t,r){var n=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+i).toString(36))}},function(e,t,r){var n=r(9),i=r(28);e.exports=r(7)?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){e.exports=function(e){try{return!!e()}catch(t){return!0}}},function(e,t,r){var n=r(4),i=r(0).document,a=n(i)&&n(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t,r){var n=r(0),i=r(14),a=r(18),o=r(13)("src"),s=r(29),u=(""+s).split("toString");r(2).inspectSource=function(e){return s.call(e)},(e.exports=function(e,t,r,s){var c="function"==typeof r;c&&(a(r,"name")||i(r,"name",t)),e[t]!==r&&(c&&(a(r,o)||i(r,o,e[t]?""+e[t]:u.join(String(t)))),e===n?e[t]=r:s?e[t]?e[t]=r:i(e,t,r):(delete e[t],i(e,t,r)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[o]||s.call(this)}))},function(e,t,r){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,r){e.exports={}},function(e,t,r){var n,i,a,o=r(5),s=r(38),u=r(39),c=r(16),l=r(0),d=l.process,h=l.setImmediate,f=l.clearImmediate,p=l.MessageChannel,g=l.Dispatch,y=0,m={},v=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},_=function(e){v.call(e.data)};h&&f||(h=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return m[++y]=function(){s("function"==typeof e?e:Function(e),t)},n(y),y},f=function(e){delete m[e]},"process"==r(8)(d)?n=function(e){d.nextTick(o(v,e,1))}:g&&g.now?n=function(e){g.now(o(v,e,1))}:p?(a=(i=new p).port2,i.port1.onmessage=_,n=o(a.postMessage,a,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(n=function(e){l.postMessage(e+"","*")},l.addEventListener("message",_,!1)):n="onreadystatechange"in c("script")?function(e){u.appendChild(c("script")).onreadystatechange=function(){u.removeChild(this),v.call(e)}}:function(e){setTimeout(o(v,e,1),0)}),e.exports={set:h,clear:f}},function(e,t,r){var n=r(6);function i(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)}e.exports.f=function(e){return new i(e)}},function(e,t,r){e.exports=r(23)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),r(24);var n,i=(n=r(48))&&n.__esModule?n:{default:n};t.default={url:i.default},e.exports=t.default},function(e,t,r){var n,i,a,o,s=r(10),u=r(0),c=r(5),l=r(11),d=r(25),h=r(4),f=r(6),p=r(30),g=r(31),y=r(37),m=r(20).set,v=r(40)(),_=r(21),b=r(41),A=r(42),E=r(43),S=u.TypeError,T=u.process,w=T&&T.versions,C=w&&w.v8||"",k=u.Promise,I="process"==l(T),$=function(){},P=i=_.f,x=!!function(){try{var e=k.resolve(1),t=(e.constructor={})[r(1)("species")]=function(e){e($,$)};return(I||"function"==typeof PromiseRejectionEvent)&&e.then($)instanceof t&&0!==C.indexOf("6.6")&&-1===A.indexOf("Chrome/66")}catch(n){}}(),R=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},O=function(e,t){if(!e._n){e._n=!0;var r=e._c;v((function(){for(var n=e._v,i=1==e._s,a=0,o=function(t){var r,a,o,s=i?t.ok:t.fail,u=t.resolve,c=t.reject,l=t.domain;try{s?(i||(2==e._h&&M(e),e._h=1),!0===s?r=n:(l&&l.enter(),r=s(n),l&&(l.exit(),o=!0)),r===t.promise?c(S("Promise-chain cycle")):(a=R(r))?a.call(r,u,c):u(r)):c(n)}catch(d){l&&!o&&l.exit(),c(d)}};r.length>a;)o(r[a++]);e._c=[],e._n=!1,t&&!e._h&&D(e)}))}},D=function(e){m.call(u,(function(){var t,r,n,i=e._v,a=L(e);if(a&&(t=b((function(){I?T.emit("unhandledRejection",i,e):(r=u.onunhandledrejection)?r({promise:e,reason:i}):(n=u.console)&&n.error&&n.error("Unhandled promise rejection",i)})),e._h=I||L(e)?2:1),e._a=void 0,a&&t.e)throw t.v}))},L=function(e){return 1!==e._h&&0===(e._a||e._c).length},M=function(e){m.call(u,(function(){var t;I?T.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})}))},N=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),O(t,!0))},B=function e(t){var r,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw S("Promise can't be resolved itself");(r=R(t))?v((function(){var i={_w:n,_d:!1};try{r.call(t,c(e,i,1),c(N,i,1))}catch(a){N.call(i,a)}})):(n._v=t,n._s=1,O(n,!1))}catch(i){N.call({_w:n,_d:!1},i)}}};x||(k=function(e){p(this,k,"Promise","_h"),f(e),n.call(this);try{e(c(B,this,1),c(N,this,1))}catch(t){N.call(this,t)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(44)(k.prototype,{then:function(e,t){var r=P(y(this,k));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=I?T.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&O(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new n;this.promise=e,this.resolve=c(B,e,1),this.reject=c(N,e,1)},_.f=P=function(e){return e===k||e===o?new a(e):i(e)}),d(d.G+d.W+d.F*!x,{Promise:k}),r(45)(k,"Promise"),r(46)("Promise"),o=r(2).Promise,d(d.S+d.F*!x,"Promise",{reject:function(e){var t=P(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(s||!x),"Promise",{resolve:function(e){return E(s&&this===o?k:this,e)}}),d(d.S+d.F*!(x&&r(47)((function(e){k.all(e).catch($)}))),"Promise",{all:function(e){var t=this,r=P(t),n=r.resolve,i=r.reject,a=b((function(){var r=[],a=0,o=1;g(e,!1,(function(e){var s=a++,u=!1;r.push(void 0),o++,t.resolve(e).then((function(e){u||(u=!0,r[s]=e,--o||n(r))}),i)})),--o||n(r)}));return a.e&&i(a.v),r.promise},race:function(e){var t=this,r=P(t),n=r.reject,i=b((function(){g(e,!1,(function(e){t.resolve(e).then(r.resolve,n)}))}));return i.e&&n(i.v),r.promise}})},function(e,t,r){var n=r(0),i=r(2),a=r(14),o=r(17),s=r(5),u=function e(t,r,u){var c,l,d,h,f=t&e.F,p=t&e.G,g=t&e.P,y=t&e.B,m=p?n:t&e.S?n[r]||(n[r]={}):(n[r]||{}).prototype,v=p?i:i[r]||(i[r]={}),_=v.prototype||(v.prototype={});for(c in p&&(u=r),u)d=((l=!f&&m&&void 0!==m[c])?m:u)[c],h=y&&l?s(d,n):g&&"function"==typeof d?s(Function.call,d):d,m&&o(m,c,d,t&e.U),v[c]!=d&&a(v,c,h),g&&_[c]!=d&&(_[c]=d)};n.core=i,u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t,r){e.exports=!r(7)&&!r(15)((function(){return 7!=Object.defineProperty(r(16)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){var n=r(4);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){e.exports=r(12)("native-function-to-string",Function.toString)},function(e,t,r){e.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},function(e,t,r){var n=r(5),i=r(32),a=r(33),o=r(3),s=r(34),u=r(36),c={},l={},d=e.exports=function(e,t,r,d,h){var f,p,g,y,m=h?function(){return e}:u(e),v=n(r,d,t?2:1),_=0;if("function"!=typeof m)throw TypeError(e+" is not iterable!");if(a(m)){for(f=s(e.length);f>_;_++)if((y=t?v(o(p=e[_])[0],p[1]):v(e[_]))===c||y===l)return y}else for(g=m.call(e);!(p=g.next()).done;)if((y=i(g,v,p.value,t))===c||y===l)return y};d.BREAK=c,d.RETURN=l},function(e,t,r){var n=r(3);e.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(o){var a=e.return;throw void 0!==a&&n(a.call(e)),o}}},function(e,t,r){var n=r(19),i=r(1)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||a[i]===e)}},function(e,t,r){var n=r(35),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t,r){var n=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:n)(e)}},function(e,t,r){var n=r(11),i=r(1)("iterator"),a=r(19);e.exports=r(2).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||a[n(e)]}},function(e,t,r){var n=r(3),i=r(6),a=r(1)("species");e.exports=function(e,t){var r,o=n(e).constructor;return void 0===o||null==(r=n(o)[a])?t:i(r)}},function(e,t,r){e.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){var n=r(0).document;e.exports=n&&n.documentElement},function(e,t,r){var n=r(0),i=r(20).set,a=n.MutationObserver||n.WebKitMutationObserver,o=n.process,s=n.Promise,u="process"==r(8)(o);e.exports=function(){var e,t,r,c=function(){var n,i;for(u&&(n=o.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(a){throw e?r():t=void 0,a}}t=void 0,n&&n.enter()};if(u)r=function(){o.nextTick(c)};else if(!a||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var l=s.resolve(void 0);r=function(){l.then(c)}}else r=function(){i.call(n,c)};else{var d=!0,h=document.createTextNode("");new a(c).observe(h,{characterData:!0}),r=function(){h.data=d=!d}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}},function(e,t,r){e.exports=function(e){try{return{e:!1,v:e()}}catch(t){return{e:!0,v:t}}}},function(e,t,r){var n=r(0).navigator;e.exports=n&&n.userAgent||""},function(e,t,r){var n=r(3),i=r(4),a=r(21);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=a.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){var n=r(17);e.exports=function(e,t,r){for(var i in t)n(e,i,t[i],r);return e}},function(e,t,r){var n=r(9).f,i=r(18),a=r(1)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,a)&&n(e,a,{configurable:!0,value:t})}},function(e,t,r){var n=r(0),i=r(9),a=r(7),o=r(1)("species");e.exports=function(e){var t=n[e];a&&t&&!t[o]&&i.f(t,o,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(1)("iterator"),i=!1;try{var a=[7][n]();a.return=function(){i=!0},Array.from(a,(function(){throw 2}))}catch(o){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var a=[7],o=a[n]();o.next=function(){return{done:r=!0}},a[n]=function(){return o},e(a)}catch(s){}return r}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==_typeof$7(Symbol.iterator)?function(e){return _typeof$7(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof$7(e)};t.default=function(e,t,r){if(e&&t){var i=void 0;try{i=(0,a.getUri)(e,t,r)}catch(s){return Promise.reject(s.message)}return new o.default({type:"json",method:"GET",url:i}).then((function(e){return e&&e.response?"string"==typeof e.response?JSON.parse(e.response).Result:"object"===n(e.response)?e.response.Result:e.response:e}))}return Promise.reject("vid, host and token can't be empty")};var i,a=r(49),o=(i=r(51))&&i.__esModule?i:{default:i};e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getUri=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{e=JSON.parse((0,n.decode)(e))}catch(s){throw new Error("base64 decode error: "+s.message)}var i=[];for(var a in r)i.push(a+"="+r[a]);var o=(/^http/.test(t)?t:"//"+t)+"?"+e.GetPlayInfoToken+"&ssl=true";return i.length>0&&(o+="&"+i.join("&")),o};var n=r(50)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.decode=function(e){var t,r,n,i,a,o,s,u=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];for(o=e.length,a=0,s="";a<o;){do{t=u[255&e.charCodeAt(a++)]}while(a<o&&-1===t);if(-1===t)break;do{r=u[255&e.charCodeAt(a++)]}while(a<o&&-1===r);if(-1===r)break;s+=String.fromCharCode(t<<2|(48&r)>>4);do{if(61==(n=255&e.charCodeAt(a++)))return s;n=u[n]}while(a<o&&-1===n);if(-1===n)break;s+=String.fromCharCode((15&r)<<4|(60&n)>>2);do{if(61==(i=255&e.charCodeAt(a++)))return s;i=u[i]}while(a<o&&-1===i);if(-1===i)break;s+=String.fromCharCode((3&n)<<6|i)}return s}},function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.url,i=t.method,a=void 0===i?"GET":i,o=(t.type,t.data),s=void 0===o?{}:o,u=t.headers,c=void 0===u?{}:u;return n(this,e),new Promise((function(e,t){var n=new window.XMLHttpRequest,i=a.toUpperCase(),o=[];for(var u in s)o.push(u+"="+s[u]);if("GET"!==i)throw new Error("xhr "+i+" is not supported");for(var l in n.open(i,""+r,!0),n.responseType="",c)n.setRequestHeader(l,""+c[l]);n.send(),n.onload=function(){200===n.status||206===n.status?e(n):t(n)},n.onerror=function(){t(n)},n.ontimeout=function(){t(n)}}))},e.exports=t.default}]);function CB(e,t){return kB.apply(this,arguments)}function kB(){return(kB=n(t().mark((function e(r,n){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){wB.url(r,n).then((function(t){var r=[],n=t.Data||t;n&&n.PlayInfoList&&n.PlayInfoList.length>0?(r=n.PlayInfoList,e({videoList:r,rawData:t})):(console.error("HAS NO VIDEO INFORMATION CORRECTLY, PLEASE CHECK THE TOKEN."),e({videoList:[],rawData:t}))}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function IB(e){if(e.sort((function(e,t){return t.Bitrate-e.Bitrate})),e[0].Bitrate){var t=0;e.every((function(r,n){return e[0].Bitrate===r.Bitrate&&(t=n,!0)})),t>0&&e.splice(t)}return e}function $B(e,t,r){if(r||(r=[]),e.sort((function(e,t){return t.Bitrate-e.Bitrate})),e[0].Bitrate){var n=0;e.every((function(t,r){return e[0].Bitrate===t.Bitrate&&(n=r,!0)})),n>0&&e.splice(n)}e.map((function(e){var t,n,i={name:e.Definition||"æ ‡æ¸…",definition:e.Definition,url:e.MainPlayUrl||e.src,backupUrl:e.BackupPlayUrl,bitrate:e.Bitrate,size:e.size},a=function(e){for(var t=0;t<r.length;t++)if(e.Definition.toLocaleLowerCase()===r[t].definition.toLocaleLowerCase())return t;return-1}(e);return a>=0?(t=i,(n=r[a])||(n=t),Object.keys(t).map((function(e){n[e]=t[e]}))):r.push(i),{name:e.Definition||"æ ‡æ¸…",text:e.Definition,definition:e.Definition,url:e.MainPlayUrl||e.src,backupUrl:e.BackupPlayUrl,bitrate:e.Bitrate,size:e.size,selected:!1}}));var i=-1;if(t)for(var a=0;a<e.length;a++)e[a].Definition.toLocaleLowerCase()===t.toLocaleLowerCase()&&(i=a);return i<0&&(i=0),r[i]&&(r[i].selected=!0),{index:i,list:r}}var PB,xB={getBrowserVersion:function(){var e=navigator.userAgent;if(e.toLowerCase().indexOf("mobile")>-1)return"Unknown";if(e.indexOf("Firefox")>-1)return"Firefox "+e.match(/firefox\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("Edge")>-1)return"Edge "+e.match(/edge\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("rv:11")>-1)return"IE 11";if(e.indexOf("Opera")>-1||e.indexOf("OPR")>-1){if(e.indexOf("Opera")>-1)return"Opera "+e.match(/opera\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("OPR")>-1)return"Opera "+e.match(/opr\/[\d.]+/gi)[0].match(/[\d]+/)[0]}else{if(e.indexOf("Chrome")>-1)return"Chrome "+e.match(/chrome\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("Safari")>-1)return"Safari "+e.match(/safari\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(!(e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1))return"Unknown";if(e.indexOf("MSIE")>-1)return"IE "+e.match(/msie [\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("Trident")>-1){var t=e.match(/trident\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"IE "+(parseInt(t)+4)}}},parseUrl:function(e){var t=e.split("?")[1],r={};return t&&t.split("&").forEach((function(e){e=e.split("="),r[e[0]]=decodeURIComponent(e[1])})),r},isBase64:function(e){return/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)$/.test(e)},isRelativeURL:function(e){return!/^(?:[a-z]+:)?\/\//.test(e)},getAbsoluteURL:function(e){var t=new Image;return t.src=e,t.src},checkMediaSourceSupport:function(){var e=window.MediaSource=window.MediaSource||window.WebKitMediaSource;return e&&"function"==typeof e.isTypeSupported},offInDestroy:function(e,t,r,n){e.once(n,(function i(){e.off(t,r),e.off(n,i)}))},on:function(e,t,r,n){n?(e.on(t,r),xB.offInDestroy(e,t,r,n)):e.on(t,(function n(i){r(i),e.off(t,n)}))},once:function(e,t,r,n){n?(e.once(t,r),xB.offInDestroy(e,t,r,n)):e.once(t,(function n(i){r(i),e.off(t,n)}))},isMobile:function(){var e=!1;return navigator.userAgent.toLocaleLowerCase().indexOf("ipad")>-1?(navigator.userAgent.toLocaleLowerCase().indexOf("mobile")>-1&&"MacIntel"!==navigator.platform&&"Win32"!==navigator.platform||!xB.checkMediaSourceSupport())&&(e=!0):navigator.userAgent.toLocaleLowerCase().indexOf("mobile")>-1&&"MacIntel"!==navigator.platform&&"Win32"!==navigator.platform&&!xB.checkMediaSourceSupport()&&(e=!0),e}},RB=function(){function e(){this.timeID=null,this.func=null}var t=e.prototype;return t.repeat=function(e,t){var r=this;null===this.func&&(this.func=e),this.func===e&&(this.timeID=setTimeout((function(){e(),r.repeat(e,t)}),t))},t.clear=function(){clearTimeout(this.timeID)},e}(),OB=Ut.f,DB=v,LB=g,MB=L,NB=ni,BB=DE,UB=ir,GB=cn.f,VB=oe,FB=ok,jB=Xc,HB=EC,ZB=ol,WB=function(e,t,r){r in e||OB(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})},KB=un,XB=m,YB=ze,zB=Hr.enforce,JB=Na,QB=Dl,qB=Nl,eU=ht("match"),tU=LB.RegExp,rU=tU.prototype,nU=LB.SyntaxError,iU=MB(rU.exec),aU=MB("".charAt),oU=MB("".replace),sU=MB("".indexOf),uU=MB("".slice),cU=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,lU=/a/g,dU=/a/g,hU=new tU(lU)!==lU,fU=ZB.MISSED_STICKY,pU=ZB.UNSUPPORTED_Y,gU=DB&&(!hU||fU||QB||qB||XB((function(){return dU[eU]=!1,tU(lU)!=lU||tU(dU)==dU||"/a/i"!=tU(lU,"i")})));if(NB("RegExp",gU)){for(var yU=function e(t,r){var n,i,a,o,s,u,c=VB(rU,this),l=FB(t),d=void 0===r,h=[],f=t;if(!c&&l&&d&&t.constructor===e)return t;if((l||VB(rU,t))&&(t=t.source,d&&(r=HB(f))),t=void 0===t?"":jB(t),r=void 0===r?"":jB(r),f=t,QB&&"dotAll"in lU&&(i=!!r&&sU(r,"s")>-1)&&(r=oU(r,/s/g,"")),n=r,fU&&"sticky"in lU&&(a=!!r&&sU(r,"y")>-1)&&pU&&(r=oU(r,/y/g,"")),qB&&(t=(o=function(e){for(var t,r=e.length,n=0,i="",a=[],o={},s=!1,u=!1,c=0,l="";n<=r;n++){if("\\"===(t=aU(e,n)))t+=aU(e,++n);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:iU(cU,uU(e,n+1))&&(n+=2,u=!0),i+=t,c++;continue;case">"===t&&u:if(""===l||YB(o,l))throw new nU("Invalid capture group name");o[l]=!0,a[a.length]=[l,c],u=!1,l="";continue}u?l+=t:i+=t}return[i,a]}(t))[0],h=o[1]),s=BB(tU(t,r),c?this:rU,e),(i||a||h.length)&&(u=zB(s),i&&(u.dotAll=!0,u.raw=e(function(e){for(var t,r=e.length,n=0,i="",a=!1;n<=r;n++)"\\"!==(t=aU(e,n))?a||"."!==t?("["===t?a=!0:"]"===t&&(a=!1),i+=t):i+="[\\s\\S]":i+=t+aU(e,++n);return i}(t),n)),a&&(u.sticky=!0),h.length&&(u.groups=h)),t!==f)try{UB(s,"source",""===f?"(?:)":f)}catch(EU){}return s},mU=GB(tU),vU=0;mU.length>vU;)WB(yU,tU,mU[vU++]);rU.constructor=yU,yU.prototype=rU,KB(LB,"RegExp",yU,{constructor:!0})}JB("RegExp"),function(e,t,r){function n(e,t){var r=parseInt(e.slice(t,t+2),16);return r>>>7==0?[1,r]:r>>>6==2?(r=(63&r)<<8,[2,r+=parseInt(e.slice(t+2,t+4),16)]):(r=(63&r)<<16,[3,r+=parseInt(e.slice(t+2,t+6),16)])}var i,a=0,o=[],s=[],u=parseInt(e.slice(0,8),16),c=parseInt(e.slice(8,16),16);if(1213091658!==u||1077891651!==c)throw new Error("mhe");if(0!==parseInt(e.slice(16,18),16))throw new Error("ve");for(i=0;i<4;++i)a+=(3&parseInt(e.slice(24+2*i,26+2*i),16))<<2*i;var l=parseInt(e.slice(32,40),16),d=2*parseInt(e.slice(48,56),16);for(i=56;i<d+56;i+=2)o.push(parseInt(e.slice(i,i+2),16));var h=d+56,f=parseInt(e.slice(h,h+4),16);for(h+=4,i=0;i<f;++i){var p=n(e,h);h+=2*p[0];for(var g="",y=0;y<p[1];++y){var m=n(e,h);g+=String.fromCharCode(a^m[1]),h+=2*m[0]}s.push(g)}t.p=null,function e(t,r,n,i,a){var u,c,l,d,h,f=-1,p=[],g=null,y=[r];for(c=Math.min(r.length,n),l=0;l<c;++l)y.push(r[l]);y.p=i;for(var m=[];;)try{var v=o[t++];if(v<37)if(v<8)v<2?p[++f]=0===v:v<5?p[++f]=null:5===v?(u=((u=((u=o[t++])<<8)+o[t++])<<8)+o[t++],p[++f]=(u<<8)+o[t++]):(u=(o[t]<<8)+o[t+1],t+=2,p[++f]=s[u]);else if(v<18)if(8===v)p[++f]=void 0;else{for(c=o[t++],l=o[t++],d=y;c>0;--c)d=d.p;p[++f]=d[l]}else if(v<20)u=(o[t]<<8)+o[t+1],t+=2,c=s[u],p[f]=p[f][c];else if(20===v){for(c=o[t++],l=o[t++],d=y;c>0;--c)d=d.p;d[l]=p[f--]}else c=p[f--],p[f]+=c;else if(v<67)if(v<58)37===v?(c=p[f--],p[f]=p[f]===c):(u=(u=(o[t]<<8)+o[t+1])<<16>>16,t+=2,p[f]?--f:t+=u);else if(v<59)p[f]=_typeof$7(p[f]);else if(59===v)u=o[t++],c=p[f--],(l=function e(){var t=e._v;return(0,e._u)(t[0],arguments,t[1],t[2],this)})._v=[c,u,y],l._u=e,p[++f]=l;else{for(c=p[f--],l=null;d=m.pop();)if(2===d[0]||3===d[0]){l=d;break}if(l)t=l[2],l[0]=0,m.push(l);else{if(!g)return c;t=g[1],a=g[2],y=g[3],m=g[4],p[++f]=c,g=g[0]}}else if(v<69)if(67===v)f-=u=o[t++],l=p.slice(f+1,f+u+1),c=p[f--],d=p[f--],c._u===e?(c=c._v,g=[g,t,a,y,m],t=c[0],null==d&&(d=function(){return this}()),a=d,(y=[l].concat(l)).length=Math.min(c[1],u)+1,y.p=c[2],m=[]):p[++f]=c.apply(d,l);else{for(u=o[t++],d=[void 0],h=u;h>0;--h)d[h]=p[f--];l=p[f--],c=Function.bind.apply(l,d),p[++f]=new c}else v<71?t+=2+(u=(u=(o[t]<<8)+o[t+1])<<16>>16):71===v?(u=(u=(o[t]<<8)+o[t+1])<<16>>16,t+=2,(c=p[f--])||(t+=u)):(c=p[f],p[++f]=c)}catch(_){for(;(u=m.pop())&&!u[0];);if(!u){e:for(;g;){for(c=g[4];u=c.pop();)if(u[0])break e;g=g[0]}if(!g)throw _;t=g[1],a=g[2],y=g[3],m=g[4],g=g[0]}1===(c=u[0])?(t=u[2],u[0]=0,m.push(u),p[++f]=_):2===c?(t=u[2],u[0]=0,m.push(u)):(t=u[3],u[0]=2,m.push(u),p[++f]=_)}}(l,[],0,t,r)}("484e4f4a403f52430031142852d42249000000a9c0ecc79d000000cd001400021102024a12000211000143014700191100014a12000305000000993b021100024302140002450069021102030700040211020411010143014a120005110203070006070007440207000843024a120005110203070009070007440207000a43021807000b1843011400031100013a07000c254700181100034a12000d1101024a12000e1100014301430145000101140002110002421100013300090211030511000243014205000000003b011401051101001200001200011400011101011200001200011400020842000f0912100d160d161b120708160d3116100b0c05070b11231010031b06100706170107013c071007120e03010714394c48495d3c46191f4a4b1e393e3f3e4d3e3e3f0105033e46442f160d3116100b0c051e4a04170c01160b0d0c4b4c485d4a5d5f3e3e3e4a4b1e42040d10424c495d4a5d5f3e3e3e3f4b0546534c485d01460804170c01160b0d0c04160711160401030e0e",{0:Object,1:Function,2:Array,3:RegExp,4:String,get 5(){return PB},set 5(e){PB=e}},globalThis);var _U=function(e){var t=e.url,r=e.method,n=void 0===r?"GET":r,i=e.type,a=e.timeout,o=void 0===a?1e4:a,s=e.data,u=void 0===s?{}:s,c=e.xhrSetup,l=e.cache,d=void 0===l||l;return new Promise((function(e,r){var a=new window.XMLHttpRequest,s=n.toUpperCase(),l=[];if("GET"!==s&&"POST"!==s)throw new Error("XHR "+s+" is not allowed");for(var h in i&&(a.responseType=i),o&&(a.timeout=o),u)Object.prototype.hasOwnProperty(u,h)&&l.push("k="+u[h]);if(a.onload=function(){200===a.status||206===a.status?e(a):r(a)},a.onerror=function(){r(a)},a.ontimeout=function(){r(a)},a.onabort=function(){r(a)},"GET"===s&&!d){var f=/\?/gi.test(t)?"&":"?";t+=f+"_="+(new Date).getTime()}if(a.open(s,""+t,!0),c)try{c(a,t)}catch(p){console.error("xhr setup failure: "+(p.stack||p.message))}switch(s){case"POST":a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send(l.join("&"));break;case"GET":a.send()}}))};function bU(e,t,r){function n(e,t){var r=parseInt(e.slice(t,t+2),16);return r>>>7==0?[1,r]:r>>>6==2?(r=(63&r)<<8,[2,r+=parseInt(e.slice(t+2,t+4),16)]):(r=(63&r)<<16,[3,r+=parseInt(e.slice(t+2,t+6),16)])}var i,a=0,o=[],s=[],u=parseInt(e.slice(0,8),16),c=parseInt(e.slice(8,16),16);if(1213091658!==u||1077891651!==c)throw new Error("mhe");if(0!==parseInt(e.slice(16,18),16))throw new Error("ve");for(i=0;i<4;++i)a+=(3&parseInt(e.slice(24+2*i,26+2*i),16))<<2*i;var l=parseInt(e.slice(32,40),16),d=2*parseInt(e.slice(48,56),16);for(i=56;i<d+56;i+=2)o.push(parseInt(e.slice(i,i+2),16));var h=d+56,f=parseInt(e.slice(h,h+4),16);for(h+=4,i=0;i<f;++i){var p=n(e,h);h+=2*p[0];for(var g="",y=0;y<p[1];++y){var m=n(e,h);g+=String.fromCharCode(a^m[1]),h+=2*m[0]}s.push(g)}return t.p=null,function e(t,r,n,i,a){var u,c,l,d,h,f=-1,p=[],g=[0,null],y=null,m=[r];for(c=Math.min(r.length,n),l=0;l<c;++l)m.push(r[l]);m.p=i;for(var v=[];;)try{var _=o[t++];if(_<37)if(_<12)_<4?_<2?p[++f]=0===_:2===_?p[++f]=null:(u=o[t++],p[++f]=u<<24>>24):_<7?4===_?(u=(o[t]<<8)+o[t+1],t+=2,p[++f]=u<<16>>16):(u=((u=((u=o[t++])<<8)+o[t++])<<8)+o[t++],p[++f]=(u<<8)+o[t++]):_<8?(u=(o[t]<<8)+o[t+1],t+=2,p[++f]=s[u]):p[++f]=8===_?void 0:a;else if(_<18)if(_<14)12===_?(u=(o[t]<<8)+o[t+1],t+=2,f=f-u+1,c=p.slice(f,f+u),p[f]=c):p[++f]={};else if(14===_)u=(o[t]<<8)+o[t+1],t+=2,c=s[u],l=p[f--],p[f][c]=l;else{for(c=o[t++],l=o[t++],d=m;c>0;--c)d=d.p;p[++f]=d[l]}else if(_<20)18===_?(u=(o[t]<<8)+o[t+1],t+=2,c=s[u],p[f]=p[f][c]):(c=p[f--],p[f]=p[f][c]);else if(_<21){for(c=o[t++],l=o[t++],d=m;c>0;--c)d=d.p;d[l]=p[f--]}else 21===_?(u=(o[t]<<8)+o[t+1],t+=2,c=s[u],l=p[f--],d=p[f--],l[c]=d):(c=p[f--],p[f]+=c);else if(_<62)_<51?_<41?37===_?(c=p[f--],p[f]=p[f]===c):(c=p[f--],p[f]=p[f]!==c):41===_?(c=p[f--],p[f]=p[f]>c):p[f]=!p[f]:_<59?51===_?(u=(u=(o[t]<<8)+o[t+1])<<16>>16,t+=2,p[f]?--f:t+=u):(u=(u=(o[t]<<8)+o[t+1])<<16>>16,t+=2,p[f]?t+=u:--f):_<60?(u=o[t++],c=p[f--],(l=function e(){var t=e._v;return(0,e._u)(t[0],arguments,t[1],t[2],this)})._v=[c,u,m],l._u=e,p[++f]=l):60===_?(u=o[t++],c=p[f--],(d=[l=function e(){var t=e._v;return(0,e._u)(t[0],arguments,t[1],t[2],this)}]).p=m,l._v=[c,u,d],l._u=e,p[++f]=l):(u=(u=(o[t]<<8)+o[t+1])<<16>>16,t+=2,(c=v[v.length-1])[1]=t+u);else if(_<68)if(_<66)if(62===_)u=(u=(o[t]<<8)+o[t+1])<<16>>16,t+=2,(c=v[v.length-1])&&!c[1]?(c[0]=3,c.push(t)):v.push([1,0,t]),t+=u;else if(l=(c=v.pop())[0],d=g[0],1===l)t=c[1];else if(0===l)if(0===d)t=c[1];else{if(1!==d)throw g[1];if(!y)return g[1];t=y[1],a=y[2],m=y[3],v=y[4],p[++f]=g[1],g=[0,null],y=y[0]}else t=c[2],c[0]=0,v.push(c);else if(66===_){for(c=p[f--],l=null;d=v.pop();)if(2===d[0]||3===d[0]){l=d;break}if(l)g=[1,c],t=l[2],l[0]=0,v.push(l);else{if(!y)return c;t=y[1],a=y[2],m=y[3],v=y[4],p[++f]=c,g=[0,null],y=y[0]}}else f-=u=o[t++],l=p.slice(f+1,f+u+1),c=p[f--],d=p[f--],c._u===e?(c=c._v,y=[y,t,a,m,v],t=c[0],null==d&&(d=function(){return this}()),a=d,(m=[l].concat(l)).length=Math.min(c[1],u)+1,m.p=c[2],v=[]):p[++f]=c.apply(d,l);else if(_<71)if(68===_){for(u=o[t++],d=[void 0],h=u;h>0;--h)d[h]=p[f--];l=p[f--],c=Function.bind.apply(l,d),p[++f]=new c}else t+=2+(u=(u=(o[t]<<8)+o[t+1])<<16>>16);else _<73?(u=(u=(o[t]<<8)+o[t+1])<<16>>16,t+=2,(c=p[f--])||(t+=u)):73===_?--f:(c=p[f],p[++f]=c)}catch(b){for(g=[0,null];(u=v.pop())&&!u[0];);if(!u){e:for(;y;){for(c=y[4];u=c.pop();)if(u[0])break e;y=y[0]}if(!y)throw b;t=y[1],a=y[2],m=y[3],v=y[4],y=y[0]}1===(c=u[0])?(t=u[2],u[0]=0,v.push(u),p[++f]=b):2===c?(t=u[2],u[0]=0,v.push(u),g=[3,b]):(t=u[3],u[0]=2,v.push(u),p[++f]=b)}}(l,[],0,t,r)}var AU=function(r){function i(){for(var i,a,o=arguments.length,s=new Array(o),u=0;u<o;u++)s[u]=arguments[u];return(i=r.call.apply(r,[this].concat(s))||this)._onSwitchURL=(a=n(t().mark((function r(n){var a,o,s,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l(i),o=a.player,s=o.currentTime,u=o.paused,o.config.url=n,e.Util.addClass(o.root,"xgplayer-is-enter"),xB.once(o,"playing",(function(){e.Util.removeClass(o.root,"xgplayer-is-enter")})),xB.once(o,"canplay",(function(){o.currentTime=s,o.play()})),t.next=9,i._start(n);case 9:return t.abrupt("return",new Promise((function(t){var r=function(){o.currentTime=s,u?o.once("canplay",(function(){o.pause(),t()})):t()};xB.isMobile()&&(e.Sniffer.os.isAndroid?o.once("timeupdate",(function(){r()})):o.once("canplay",(function(){r()})),o.play())})));case 10:case"end":return t.stop()}}),r)}))),function(e){return a.apply(this,arguments)}),i}o(i,r);var s,u,c,d,h=i.prototype;return h.beforePlayerInit=function(){var e=this,t=this.config,n=this.player,i=n.config,a=xB.isMobile();this.__startInit=null,this.__playNext=null,this.onTimeupdate=this.onTimeupdate.bind(this),this.browser=xB.getBrowserVersion(),this.isNativeMode=!0,this._errReqCount=0,this._curDefinitionIndex=0,this.hls=null,this.getUrlTime=(new Date).getTime()/1e3,this.hlsOpts=t.hlsOpts||{},t.hlsLoadAsync=!1,i.hls||(i.hls={}),i.hls.fetchOptions||(i.hls.fetchOptions={}),a||void 0!==t.useHls&&!t.useHls||(this.isNativeMode=!1,this.register()),n.playNext=this.playNext.bind(this),this.isNativeMode||i.hls.decryptor||(i.hls.decryptor=new ek({enableSoftwareAES:this.hlsOpts.enableSoftwareAES})),t.netAllowCredentials&&(i.hls.fetchOptions.credentials="include"),t.checkHlsOffline&&xB.on(this,"timeupdate",this.onTimeupdate,"destroy"),this.hlsTimer=new RB,this.hlsTimer.repeat((function(){e.onRepeat()}),t.checkExpireInterval),this._proxyPlayerStartInit(),this._checkNativeCode()?r.prototype.beforePlayerInit.call(this):this.player.switchURL=this._onSwitchURL},h.destroy=function(){r.prototype.destroy.call(this),this.hlsTimer&&(this.hlsTimer.clear(),this.hlsTimer=null),this.player._startInit=this.__startInit,this.player.playNext=this.__playNext,this._playOriginalUrl=null},h.log=function(){var e;this.player.logInfo&&(e=this.player).logInfo.apply(e,arguments)},h._checkNativeCode=function(){var e=this.player,t=self.MediaSource||self.WebKitMediaSource,r=self.SourceBuffer,n=!1;if(t&&r){var i=[];r&&i.push(r),t&&i.push(t),PB(i)?n=!0:e.emit("error",{msg:"MediaSource or SourceBuffer hijack",errorCode:-9995})}return n},h._proxyPlayerStartInit=function(){var e=this;this.__startInit=this.player._startInit,this.__playNext=this.player.playNext,this.player._startInit=function(){e._start()}},h._start=(s=n(t().mark((function e(r){var n,i,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r&&(r=null),r){e.next=8;break}return e.next=4,this._getRawManifestUrl();case 4:if((n=e.sent).url){e.next=7;break}throw new Error("no service url");case 7:r=n.url;case 8:return this._playOriginalUrl=this.player.config.url=r,e.next=11,this._getTransformManifestUrl(r);case 11:i=e.sent,a=this.player.config.url=i.url,this.isNativeMode||this.hls.load(a),this.__startInit.call(this.player,a);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)}),h._getRawManifestUrl=(u=n(t().mark((function e(){var r,n,i,a,o,s,u,c,l=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.config,n=this.playerConfig,i=r.vid,a=r.playAuthToken,o=r.playDomain,s=r.testUrl,u=r.testUrlExpire,c={url:r.url||n.url,playAuthToken:a,vid:i,playDomain:o,testUrl:s,testUrlExpire:u},e.abrupt("return",new Promise((function(e,t){c.url&&(/\.(mp3|m4a)/.test(c.url)||/(mp3|m4a)/.test(c.type))||c.url?(l.emit("can_start"),e({url:c.url})):(a||c.vid)&&l._playByToken(a,o,e,t)})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)}),h._playByToken=(c=n(t().mark((function e(r,n,i,a){var o,s,u,c,l,d,h,f,p,g,y,m;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.player,s=this.config,e.next=3,CB(r,n);case 3:u=e.sent,c=u.videoList,l=u.rawData,this.emit("get_play_info",l),c&&c.length>0&&(c[0].MainPlayUrl||c[0].src)?(IB(c),this.getUrlTime=(new Date).getTime()/1e3,d=o.config.definition||{},h=d.defaultDefinition||o.config.defaultDefinition,c[0].Format,c[0].UrlExpire&&(this.urlExpireTimestamp=s.testUrlExpire||c[0].UrlExpire),f=$B(c,h,d.list),this._curDefinitionIndex=f.index,p=f.list[f.index],g=p.url,o.emit("resourceReady",f.list),c[0]&&c[0].type&&/(mp3|m4a|mp4)/.test(c[0].type),this.emit("can_start"),i({url:g})):(y=l||{ResponseMetadata:{Error:{CodeN:0,Message:""},RequestId:""}},this.emit("playInterfaceInfo",{code:y.ResponseMetadata.Error.CodeN,message:y.ResponseMetadata.Error.Message,logid:y.ResponseMetadata.RequestId}),m={msg:"HAS NO VIDEO INFORMATION CORRECTLY, PLEASE CHECK THE TOKEN.",errorCode:-9998},this.emit("error",m),a(m));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return c.apply(this,arguments)}),h._getTransformManifestUrl=(d=n(t().mark((function e(r){var n=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){n._loadSource(r,(function(t){if(t.length)e({url:t});else{var r=new FileReader;r.onload=function(){e({url:r.result})},r.readAsDataURL(t)}}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return d.apply(this,arguments)}),h.playNext=function(t){var r=this,n=this.player,i=n.paused;n.pause(),n.hasStart=!1,n._startInit=this.__startInit,n.playNext=this.__playNext,Object.keys(t).map((function(n){n.toLocaleLowerCase()===r.pluginName.toLocaleLowerCase()?"Object"===e.Util.typeOf(t[n])&&Object.keys(t[n]).map((function(e){r.config[e]=t[n][e]})):r.playerConfig[n]=t[n]})),t.url||(this.playerConfig.url=null),this._errReqCount=0,this._curDefinitionIndex=0,this.getUrlTime=(new Date).getTime()/1e3,this.playerConfig.autoplay="boolean"==typeof t.autoplay?t.autoplay:!i,this._start(null)},h._processRetData=function(e,t,r,n){if(e.sort((function(e,t){return t.Bitrate-e.Bitrate})),e[0].Bitrate){var i=0;e.every((function(t,r){return e[0].Bitrate===t.Bitrate&&(i=r,!0)})),i>0&&e.splice(i)}},h.onTimeupdate=function(){this.hls&&this.player.video&&!this.player.video.videoHeight?(this.hls.hlsOfflineCount=void 0===this.hls.hlsOfflineCount?1:this.hls.hlsOfflineCount+1,this.hls.hlsOfflineCount>3&&(this.pause(),this.emit("error",{msg:"OFFLINE",errorCode:-9997}),this.onError())):this.hls&&(this.hls.hlsOfflineCount=0)},h.onRepeat=function(){var e=this,t=this.config,r=this.player;t.expireDetectType.indexOf("getUrlTime")>-1&&this.getUrlTime&&r.duration&&(new Date).getTime()/1e3>this.getUrlTime+3300+r.duration&&(this.getUrlTime=0,this.emitExpireEvent()),t.expireDetectType.indexOf("xhrStatus")>-1&&this._playOriginalUrl&&Math.random()<1/7.5&&new _U({url:this._playOriginalUrl,xhrSetup:function(e,r){t.netAllowCredentials&&(e.withCredentials=!0)}}).catch((function(t){t&&void 0!==t.status&&(e.hls.hlsExpireCount=void 0===e.hls.hlsExpireCount?1:e.hls.hlsExpireCount+1,e.hls.hlsExpireCount>3&&(e.hls.hlsExpireCount=0,e.emitExpireEvent()))})),t.expireDetectType.indexOf("urlExpire")>-1&&this.urlExpireTimestamp&&(new Date).getTime()/1e3>=this.urlExpireTimestamp&&(this.urlExpireTimestamp=5e9,this.emitExpireEvent())},h.emitExpireEvent=function(){var e=this.player,t=(new Date).getTime()/1e3;e.emitExpireTimestamp?t-e.emitExpireTimestamp>300&&(e.emitExpireTimestamp=t,e.emit("MEDIA_EXPIRED")):(e.emitExpireTimestamp=t,e.emit("MEDIA_EXPIRED"))},h._updateM3U8=function e(t,r,n){return bU("484e4f4a403f5243001b0717f641e99d00000045ad3081810000022e11020a07001b44014a12001c11000443014700131100021100031807001d18110004184245001c1100021100031807001d181102054a12001e1101071100044302184208420b1200001400010b1200011200020700032647000f1101014a12000411010743011401073e004014000c11010112000534000611010112000634000611010112000714000311000344001400021100024a1200081101074301491100024a1200094300140002413d00161101021101070c00010d07000a0e000b4402140002411101034a12000c11000243011400041101084a12000d11010a07000e440107000f110004180700101843021401081101044a12001111000112000112001243014700151101044a12001311000112000112001243014500091100011200011200121400051100054a12001411010a070015440143013400030c000014000611000547001f11000612001603012947000d110006030113070017184500030700184500030700181400071101084a12000d11010a07001907001a440205000000003b0443021401083e004014000d11010112000534000611010112000634000611010112000714000911000944001400081100084a1200081101084301491100084a1200094300140008413d00161101021101080c00010d07001f0e000b4402140008411101044a120020430014000a11000a4700131101093300090211010911000843014945001f1101034a12000c110008430114000b1101093300090211010911000b4301490842002106263a372f332406353938303f310a3133221d332f022f26330302190604372239340b143a393414233f3a323324110133341d3f22143a393414233f3a3233240e1b392c143a393414233f3a3233240637262633383207313322143a39340922332e22793e223b3a04222f26330f35243337223319343c33352203041a072433263a3735330e7a03041f6b747e0d08740b7d7f74067a03041f6b7401740d3f2504333a37223f203303041a0323243a0e313322173425393a23223303041a053b3722353e207e7e3e2222262a3e222226257f6c690a790a79787d7f0a790a217d0a780a217d063a333831223e0179003a7e75130e021f18106c7f7e0a327d0a78690a327c7f7e696c7a7e696c0d080a242a0a380b7c7f7e696c0a242a0a387f7c7f7e787c7e6977757f7f0131147e3e2222262a3e222226257f690a6c690a790a790422332522027a5c1034233f3a32173425393a23223303041a153726263a3f3537223f3938792e7b3b26333103041a083f251b39343f3a33",{get 0(){return e},get 1(){return window},get 2(){return Blob},get 3(){return URL},get 4(){return xB},get 5(){return Bk},6:arguments,7:t,8:r,9:n,10:RegExp},this)},h._loadSource=function e(t,r){return bU("484e4f4a403f5243000c1f081b2e9ba50000034abf1ccd6d000003961102031200044700070011000115000508421100011200081400021100024a12000911020c07000a440143014700d41100024a12000911020c07000b440143010301131400031102024a12000c110003430114000411000433000611000412000d47008e11010312000e07000f254700561102024a12001011010312001143014700121102034a12001211010312001143014500061101031200111400050700131101031200143400030700151807001618110005180700171811000412000d1814000345002b1101031200183400030700150700191811000412000d1807001a18110103120011340003070015181400030d1100030e001b1100020e001c4245001611020b33000f0211020b11010212000112000343014908421100013234000711000112001b32470002084211000112001b14000211000112001c14000305000002183c0114000411010112000112001133002511010112000112000e07000f2547000c110101120001120014450009110101120001120018470073110101120026070027264700341102010d1100020e00030700280e0029010e002a44014a12000705000003063b0143014a12002b05000003123b0143014945002f11020844001400051100054a12002d07002e1100024302491100054a12002f43004905000003243b001100051500314500251101011200011200324700191101014a12002511010112000112003211000311020b43034908423e00351400090d1104024a120010110001120008430147000911000112000845000f1104034a12001d11000112000843010e001e140002413d009b1104044a12001f110001120008430114000211030112000112000e07000f2547001211000212002012002111000215001e45006611030447004b11000212001e14000302110405110003430114000411000412002214000511000412002314000611000412002414000702110406110005110006110007430314000811000811000215001e1104034a12001d11000212001e430111000215001e411103014a12002511000212001e11020311040b43034908420211010411000143014908421103074a12002c07002c11000143024908421101051200300400c82534000a1101051200300400ce2547000a0211010411010543014908420b1400010b1200001400020b1200011400030b1200021400041101010d11010a0e000305000000003c010e000644014a12000705000000123b0143014a120007050000011b3b0143014908420033060b171a021e09061814151d121c0c1208351a0f120d1e36141f1e030e091713151e0f3a1717140c38091e1f1e150f121a17080f0c120f1338091e1f1e150f121a170808031309281e0f0e0b040f131e150c091e080b1415081e2f1e030f05161a0f181315583e232f562356303e224153270c5046270c5052500e572e293246595320255926505259080b1a09081e2e0917021a100a1c1e0f301e022f020b1e032f342b081208391a081e4d4f08101e022f14101e15041a0f14190254540a0b171a023f14161a1215000144125d28140e09181e46111a090d12085d3a104609101e023f14161a12152254101f08541a0b12540d4854101e02084408140e09181e46111a090d12085d1a1046075d0f14101e154606101e022e091703180f0304190f141a041f1a0f1a050b1a09081e06291e080e170f09281e18091e0f301e02071e15183f1a0f1a03101e0202120d0b240e0b1f1a0f1e36482e43071909140c081e0905323e5b4a4a040f1e030f040f020b1e05181a18131e05181a0f1813051e0909140904140b1e15031c1e0f04081e151f06080f1a0f0e0806141517141a1f08101e022d1a170e1e",{get 0(){return e},get 1(){return _U},get 2(){return xB},get 3(){return window},4:JSON,get 5(){return rk},get 6(){return tk},get 7(){return console},get 8(){return XMLHttpRequest},9:arguments,10:t,11:r,12:RegExp},this)},h.register=function(){var e=this.player;e.once("playing",(function(){var t=!1,r=e.video.querySelector("track");r&&("hidden"===r.track.mode&&(t=!0),r.track.mode="hidden",e.video.removeChild(r)),e.config.textTrack&&e.config.textTrack.length>0&&e.config.textTrack.some((function(r){if(r.src&&r.label&&r.default){var n=document.createElement("track");return n.src=r.src,n.kind=r.kind,n.label=r.label,n.srclang=r.srclang,n.default=!0,e.video.appendChild(n),t&&(n.track.mode="hidden"),!0}}))}))},a(i,[{key:"versionNum",get:function(){return this.version&&this.version[0]&&parseInt(this.version[0])}}],[{key:"pluginName",get:function(){return"EncryptHlsPlugin"}},{key:"defaultConfig",get:function(){return{expireDetectType:[],hlsOpts:{},checkExpireInterval:400,type:"",playAuthToken:"",vid:"",checkHlsOffline:!1}}},{key:"version",get:function(){return"4.0.0"}}]),i}(TB);return AU.isSupported=function(e){e=e||navigator.userAgent.toLocaleLowerCase();var t=/(iphone)/.test(e)||/(ipad)/.test(e),r=/(android)/.test(e),n=/(windows phone)/.test(e),i=!(t||r||n),a=/(quark)/.test(e);return i||r?!(!window.MediaSource||!window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')):!!t&&!a&&!(e.indexOf("iphone os 11_4")>-1||e.indexOf("iphone os 11_2")>-1)},AU}(require$$0)}(index_min$1);var EncryptHlsPlugin=getDefaultExportFromCjs(index_min$1.exports);function asyncGeneratorStep$1(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(error){return void r(error)}s.done?t(u):Promise.resolve(u).then(n,i)}function _asyncToGenerator$1(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$1(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$1(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _isNativeReflectConstruct$k(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _construct(e,t,r){return(_construct=_isNativeReflectConstruct$k()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&_setPrototypeOf$4(i,r.prototype),i}).apply(null,arguments)}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct(e,arguments,_getPrototypeOf$4(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf$4(r,e)},_wrapNativeSuper(e)}var regeneratorRuntime$1={exports:{}},_typeof$1={exports:{}};!function(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(_typeof$1),function(e){var t=_typeof$1.exports.default;function r(){e.exports=r=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var n={},i=Object.prototype,a=i.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch($){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i,a,o,s,u=t&&t.prototype instanceof p?t:p,c=Object.create(u.prototype),l=new C(n||[]);return c._invoke=(i=e,a=r,o=l,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return{value:void 0,done:!0}}for(o.method=e,o.arg=t;;){var r=o.delegate;if(r){var n=S(r,o);if(n){if(n===f)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===s)throw s="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s="executing";var u=h(i,a,o);if("normal"===u.type){if(s=o.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:o.done}}"throw"===u.type&&(s="completed",o.method="throw",o.arg=u.arg)}}),c}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch($){return{type:"throw",arg:$}}}n.wrap=d;var f={};function p(){}function g(){}function y(){}var m={};l(m,s,(function(){return this}));var v=Object.getPrototypeOf,_=v&&v(v(k([])));_&&_!==i&&a.call(_,s)&&(m=_);var b=y.prototype=p.prototype=Object.create(m);function A(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,r){function n(i,o,s,u){var c=h(e[i],e,o);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==t(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):r.resolve(d).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,u)}))}u(c.arg)}var i;this._invoke=function(e,t){function a(){return new r((function(r,i){n(e,t,r,i)}))}return i=i?i.then(a,a):a()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=h(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,f;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function k(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(a.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:I}}function I(){return{value:void 0,done:!0}}return g.prototype=y,l(b,"constructor",y),l(y,"constructor",g),g.displayName=l(y,c,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},n.awrap=function(e){return{__await:e}},A(E.prototype),l(E.prototype,u,(function(){return this})),n.AsyncIterator=E,n.async=function(e,t,r,i,a){void 0===a&&(a=Promise);var o=new E(d(e,t,r,i),a);return n.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},A(b),l(b,c,"Generator"),l(b,s,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},n.values=k,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;w(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:k(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},n}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}(regeneratorRuntime$1);var runtime=regeneratorRuntime$1.exports(),regenerator=runtime,_ERR_CODE;try{regeneratorRuntime=runtime}catch(accidentalStrictMode){"object"===("undefined"==typeof globalThis?"undefined":_typeof$7(globalThis))?globalThis.regeneratorRuntime=runtime:Function("r","regeneratorRuntime = r")(runtime)}function createPublicPromise$1(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return r.used=!1,r.resolve=function(){return r.used=!0,e.apply(void 0,arguments)},r.reject=function(){return r.used=!0,t.apply(void 0,arguments)},r}function _createSuper$j(e){var t=_isNativeReflectConstruct$j();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$j(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ERR={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",SUB_TYPES:{FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",OPTION:"OPTION"}},ERR_CODE=(_ERR_CODE={},_defineProperty$5(_ERR_CODE,ERR.MANIFEST,{HLS:1100}),_defineProperty$5(_ERR_CODE,ERR.NETWORK,2100),_defineProperty$5(_ERR_CODE,ERR.NETWORK_TIMEOUT,2101),_defineProperty$5(_ERR_CODE,ERR.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400}),_defineProperty$5(_ERR_CODE,ERR.REMUX,{FMP4:4100,MP4:4200}),_defineProperty$5(_ERR_CODE,ERR.MEDIA,{MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202}),_defineProperty$5(_ERR_CODE,ERR.OTHER,8e3),_ERR_CODE),StreamingError=function(e){_inherits$4(r,e);var t=_createSuper$j(r);function r(e,n,i,a,o){var s;return _classCallCheck$4(this,r),(s=t.call(this,o||(null==i?void 0:i.message))).errorType=e===ERR.NETWORK_TIMEOUT?ERR.NETWORK:e,s.originError=i,s.ext=a,s.errorCode=ERR_CODE[e][n]||ERR_CODE[e],s.errorMessage=s.message,s.errorCode||(s.errorType=ERR.OTHER,s.errorCode=ERR_CODE[s.errorType]),s}return _createClass$5(r,null,[{key:"create",value:function(e,t,n,i,a){return e instanceof r?e:(e instanceof Error&&(n=e,e=""),e||(e=ERR.OTHER),new r(e,t,n,i,a))}},{key:"network",value:function(e){var t;return new r(null!=e&&e.isTimeout?ERR.NETWORK_TIMEOUT:ERR.NETWORK,e,null,{url:null==e?void 0:e.url,response:null==e?void 0:e.response,httpCode:null==e||null===(t=e.response)||void 0===t?void 0:t.status})}}]),r}(_wrapNativeSuper(Error)),LoaderType$1={FETCH:"fetch",XHR:"xhr"},ResponseType$1={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"};function _createSuper$i(e){var t=_isNativeReflectConstruct$i();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var NetError$1=function(e){_inherits$4(r,e);var t=_createSuper$i(r);function r(e,n,i,a){var o;return _classCallCheck$4(this,r),_defineProperty$5(_assertThisInitialized$4(o=t.call(this,a)),"retryCount",0),_defineProperty$5(_assertThisInitialized$4(o),"isTimeout",!1),_defineProperty$5(_assertThisInitialized$4(o),"loaderType",LoaderType$1.FETCH),_defineProperty$5(_assertThisInitialized$4(o),"startTime",0),_defineProperty$5(_assertThisInitialized$4(o),"endTime",0),o.url=e,o.request=n,o.response=i,o}return r}(_wrapNativeSuper(Error)),toString$2=Object.prototype.toString;function isObject$2(e){return null!==e&&"object"===_typeof$4(e)}function isPlainObject$1(e){if("[object Object]"!==toString$2.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function isDate$1(e){return"[object Date]"===toString$2.call(e)}function getRangeValue$1(e){if(e&&null!=e[0]&&(0!==e[0]||null!=e[1])){var t="bytes="+e[0]+"-";return e[1]&&(t+=e[1]),t}}function encode$1(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function setUrlParams$1(e,t){if(e){if(!t)return e;var r,n=Object.keys(t).map((function(e){if(null!=(r=t[e]))return Array.isArray(r)?e+="[]":r=[r],r.map((function(t){return isDate$1(t)?t=t.toISOString():isObject$2(t)&&(t=JSON.stringify(t)),"".concat(encode$1(e),"=").concat(encode$1(t))})).join("&")})).filter(Boolean).join("&");if(n){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}}function createResponse$1(e,t,r,n,i,a){return n=null!=n?parseFloat(n):null,r=parseInt(r||"0",10),isNaN(r)&&(r=0),{data:e,response:t,contentLength:r,age:n,startTime:i,firstByteTime:a,endTime:Date.now()}}var FetchLoader$1=function(){function e(){_classCallCheck$4(this,e),_defineProperty$5(this,"_abortController",null),_defineProperty$5(this,"_timeoutTimer",null),_defineProperty$5(this,"_reader",null),_defineProperty$5(this,"_response",null),_defineProperty$5(this,"_aborted",!1)}var t;return _createClass$5(e,[{key:"load",value:function(e){var t,r=this,n=e.url,i=e.timeout,a=e.responseType,o=e.onProgress,s=e.onTimeout,u=e.range,c=e.transformResponse,l=e.request,d=e.params,h=e.method,f=e.headers,p=e.body,g=e.mode,y=e.credentials,m=e.cache,v=e.redirect,_=e.referrer,b=e.referrerPolicy;this._aborted=!1,this._abortController="undefined"!=typeof AbortController&&new AbortController;var A={method:h,headers:f,body:p,mode:g,credentials:y,cache:m,redirect:v,referrer:_,referrerPolicy:b,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal},E=!1;clearTimeout(this._timeoutTimer),n=setUrlParams$1(n,d);var S=getRangeValue$1(u);S&&((f=l?l.headers:A.headers=A.headers||new Headers)instanceof Headers?f.append("Range",S):f.Range=S),i&&(this._timeoutTimer=setTimeout((function(){if(E=!0,r.cancel(),s){var e=new NetError$1(n,A);e.isTimeout=!0,s(e)}}),i));var T=Date.now();return fetch(l||n,l?void 0:A).then(function(){var e=_asyncToGenerator$1(regenerator.mark((function e(t){var i,s;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(clearTimeout(r._timeoutTimer),r._response=t,!r._aborted){e.next=4;break}return e.abrupt("return");case 4:if(c&&(t=c(t,n)||t),t.ok){e.next=7;break}throw new NetError$1(n,A,t,"bad network response");case 7:if(i=Date.now(),a!==ResponseType$1.TEXT){e.next=14;break}return e.next=11,t.text();case 11:s=e.sent,e.next=28;break;case 14:if(a!==ResponseType$1.JSON){e.next=20;break}return e.next=17,t.json();case 17:s=e.sent,e.next=28;break;case 20:if(!o){e.next=24;break}r._loadChunk(t,o),e.next=28;break;case 24:return e.next=26,t.arrayBuffer();case 26:s=e.sent,s=new Uint8Array(s);case 28:return e.abrupt("return",createResponse$1(s,t,t.headers.get("Content-Length"),t.headers.get("age"),T,i));case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){if(clearTimeout(r._timeoutTimer),!r._aborted||E)throw(e=e instanceof NetError$1?e:new NetError$1(n,A)).startTime=T,e.endTime=Date.now(),e.isTimeout=E,e}))}},{key:"cancel",value:(t=_asyncToGenerator$1(regenerator.mark((function e(){return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,!this._response){e.next=13;break}if(e.prev=4,!this._reader){e.next=8;break}return e.next=8,this._reader.cancel();case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(4);case 12:this._response=this._reader=null;case 13:if(this._abortController){try{this._abortController.abort()}catch(error){}this._abortController=null}case 14:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(){return t.apply(this,arguments)})},{key:"_loadChunk",value:function(e,t){var r,n,i,a=this,o=this._reader=e.body.getReader(),s=function(){var u=_asyncToGenerator$1(regenerator.mark((function u(){return regenerator.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return n=Date.now(),u.prev=1,u.next=4,o.read();case 4:r=u.sent,i=Date.now(),u.next=13;break;case 8:return u.prev=8,u.t0=u.catch(1),i=Date.now(),t(void 0,!0,{startTime:n,endTime:i},e),u.abrupt("return");case 13:if(!a._aborted){u.next=16;break}return t(void 0,!0,{startTime:n,endTime:i},e),u.abrupt("return");case 16:t(r.value,r.done,{startTime:n,endTime:i},e),r.done||s();case 18:case"end":return u.stop()}}),u,null,[[1,8]])})));return function(){return u.apply(this,arguments)}}();s()}}],[{key:"isSupported",value:function(){return!("undefined"==typeof fetch)}}]),e}();function ownKeys$a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$9(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$a(Object(r),!0).forEach((function(t){_defineProperty$5(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function getConfig$2(e){return _objectSpread$9({loaderType:LoaderType$1.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:ResponseType$1.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0},e)}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,i=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var defineWellKnownSymbol=wellKnownSymbolDefine;function _createForOfIteratorHelper$1(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$1(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray$1(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$1(e,t):void 0}}function _arrayLikeToArray$1(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}defineWellKnownSymbol("iterator");var XhrLoader$1=function(){function e(){_classCallCheck$4(this,e),_defineProperty$5(this,"_xhr",null),_defineProperty$5(this,"_aborted",!1),_defineProperty$5(this,"_timeoutTimer",null)}return _createClass$5(e,[{key:"load",value:function(e){var t=this;clearTimeout(this._timeoutTimer);var r=e.url,n=e.params,i=e.timeout,a=e.responseType,o=e.onTimeout,s=e.transformResponse,u=e.onProgress,c=e.method,l=e.credentials,d=e.body,h=e.headers,f=e.range,p=e.request,g=!1;r=setUrlParams$1(r,n);var y=Date.now();return new Promise((function(e,n){var m=t._xhr=new XMLHttpRequest;m.open(c||"GET",r,!0),m.responseType=a,m.withCredentials="include"===l||"same-origin"===l;var v=getRangeValue$1(f);v&&((h=h||{}).Range=v),h&&Object.keys(h).forEach((function(e){m.setRequestHeader(e,h[e])})),i&&(t._timeoutTimer=setTimeout((function(){if(g=!0,t.cancel(),o){var e=new NetError$1(r,p);e.isTimeout=!0,o(e)}}),i)),m.onerror=function(e){return n(e)},m.onreadystatechange=function(){if(m.readyState>=2){clearTimeout(t._timeoutTimer);var i=Date.now();if(4===m.readyState){if(m.onreadystatechange=null,t._aborted)return;var a=m.status,o={ok:a>=200&&a<300,status:a,statusText:m.statusText,url:m.responseURL,headers:t._getHeaders(m),body:m.response};if(s&&(o=s(o,r)||o),!o.ok)return n(new NetError$1(r,p,o,"bad network response"));var c=m.responseType===ResponseType$1.ARRAY_BUFFER,l=c?new Uint8Array(m.response):m.response;u&&u(c?l:void 0,!0,{startTime:y,endTime:Date.now()},o),e(createResponse$1(l,o,o.headers["content-length"],o.headers.age,y,i))}}},m.send(d)})).catch((function(e){if(clearTimeout(t._timeoutTimer),!t._aborted||g)throw(e=e instanceof NetError$1?e:new NetError$1(r,p)).startTime=y,e.endTime=Date.now(),e.isTimeout=g,e}))}},{key:"cancel",value:function(){if(!this._aborted)return this._aborted=!0,this._xhr?this._xhr.cancel():void 0}},{key:"_getHeaders",value:function(e){var t,r={},n=_createForOfIteratorHelper$1(e.getAllResponseHeaders().trim().split("\r\n"));try{for(n.s();!(t=n.n()).done;){var i=t.value.split(": ");r[i[0].toLowerCase()]=i.slice(1).join(": ")}}catch(a){n.e(a)}finally{n.f()}return r}}],[{key:"isSupported",value:function(){return"undefined"!=typeof XMLHttpRequest}}]),e}(),_excluded$3=["retry","retryDelay","onRetryError","transformError"],Task$1=function(){function e(t,r){_classCallCheck$4(this,e),this.promise=createPublicPromise$1(),this.alive=!!r.onProgress,this._loaderType=t,this._loader=t===LoaderType$1.FETCH?new FetchLoader$1:new XhrLoader$1,this._config=r,this._retryCount=0,this._retryTimer=null,this._canceled=!1}var t;return _createClass$5(e,[{key:"exec",value:function(){var e=this,t=this._config,r=t.retry,n=t.retryDelay,i=t.onRetryError,a=t.transformError,o=_objectWithoutProperties(t,_excluded$3),s=function(){var t=_asyncToGenerator$1(regenerator.mark((function t(){var u,c;return regenerator.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e._loader.load(o);case 3:u=t.sent,e.promise.resolve(u),t.next=22;break;case 7:if(t.prev=7,t.t0=t.catch(0),!e._canceled){t.next=11;break}return t.abrupt("return");case 11:if(t.t0.loaderType=e._loaderType,t.t0.retryCount=e._retryCount,c=t.t0,a&&(c=a(c)||c),i&&e._retryCount>0&&i(c,e._retryCount,r),e._retryCount++,!(e._retryCount<=r)){t.next=21;break}return clearTimeout(e._retryTimer),e._retryTimer=setTimeout(s,n),t.abrupt("return");case 21:e.promise.reject(c);case 22:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();return s(),this.promise}},{key:"cancel",value:(t=_asyncToGenerator$1(regenerator.mark((function e(){return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,e.abrupt("return",this._loader.cancel());case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function sleep(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))}var NetLoader$1=function(){function e(t){_classCallCheck$4(this,e),_defineProperty$5(this,"type",LoaderType$1.FETCH),_defineProperty$5(this,"_queue",[]),_defineProperty$5(this,"_alive",[]),_defineProperty$5(this,"_currentTask",null),this._config=getConfig$2(t),this._config.loaderType!==LoaderType$1.XHR&&FetchLoader$1.isSupported()||(this.type=LoaderType$1.XHR)}var t;return _createClass$5(e,[{key:"isFetch",value:function(){return this.type===LoaderType$1.FETCH}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"!=typeof e&&e?t=e:t.url=e||t.url||this._config.url,(t=Object.assign({},this._config,t)).params&&(t.params=Object.assign({},t.params)),t.headers&&isPlainObject$1(t.headers)&&(t.headers=Object.assign({},t.headers)),t.body&&isPlainObject$1(t.body)&&(t.body=Object.assign({},t.body)),t.transformRequest&&(t=t.transformRequest(t)||t);var r=new Task$1(this.type,t);return this._queue.push(r),1===this._queue.length&&this._processTask(),r.promise}},{key:"cancel",value:(t=_asyncToGenerator$1(regenerator.mark((function e(){var t;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._queue.map((function(e){return e.cancel()})).concat(this._alive.map((function(e){return e.cancel()}))),this._currentTask&&t.push(this._currentTask.cancel()),this._queue=[],this._alive=[],e.next=6,Promise.all(t);case 6:return e.next=8,sleep();case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_processTask",value:function(){var e=this;this._currentTask=this._queue.shift(),this._currentTask&&(this._currentTask.alive&&this._alive.push(this._currentTask),this._currentTask.exec().catch((function(){})).finally((function(){e._processTask()})))}}],[{key:"isFetchSupport",value:function(){return FetchLoader$1.isSupported()}}]),e}(),EVENT={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT"},Logger$3=function(){function e(t){_classCallCheck$4(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return _createClass$5(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).debug.apply(t,[this._prefix].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,[this._prefix].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).error.apply(t,[this._prefix].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();_defineProperty$5(Logger$3,"disabled",!0);var lib={},parser$1={},grammar$2={exports:{}},grammar$1=grammar$2.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(grammar$1).forEach((function(e){grammar$1[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))})),function(e){var t=function(e){return String(Number(e))===e?Number(e):e},r=function(e,r,n){var i=e.name&&e.names;e.push&&!r[e.push]?r[e.push]=[]:i&&!r[e.name]&&(r[e.name]={});var a=e.push?{}:i?r[e.name]:r;!function(e,r,n,i){if(i&&!n)r[i]=t(e[1]);else for(var a=0;a<n.length;a+=1)null!=e[a+1]&&(r[n[a]]=t(e[a+1]))}(n.match(e.reg),a,e.names,e.name),e.push&&r[e.push].push(a)},n=grammar$2.exports,i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},a=[],o=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach((function(e){var t=e[0],i=e.slice(2);"m"===t&&(a.push({rtp:[],fmtp:[]}),o=a[a.length-1]);for(var s=0;s<(n[t]||[]).length;s+=1){var u=n[t][s];if(u.reg.test(i))return r(u,o,i)}})),t.media=a,t};var a=function(e,r){var n=r.split(/=(.+)/,2);return 2===n.length?e[n[0]]=t(n[1]):1===n.length&&r.length>1&&(e[n[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var r=[],n=e.split(" ").map(t),i=0;i<n.length;i+=3)r.push({component:n[i],ip:n[i+1],port:n[i+2]});return r},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var r,n=!1;return"~"!==e[0]?r=t(e):(r=t(e.substring(1,e.length)),n=!0),{scid:r,paused:n}}))}))}}(parser$1);var grammar=grammar$2.exports,formatRegExp=/%[sdv%]/g,format=function(e){var t=1,r=arguments,n=r.length;return e.replace(formatRegExp,(function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},makeLine=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var a=t.names[i];t.name?n.push(r[t.name][a]):n.push(r[t.names[i]])}else n.push(r[t.name]);return format.apply(null,n)},defaultOuterOrder=["v","o","s","i","u","e","p","c","b","t","r","z","a"],defaultInnerOrder=["i","c","b","a"],writer$1=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||defaultOuterOrder,n=t.innerOrder||defaultInnerOrder,i=[];return r.forEach((function(t){grammar[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(makeLine(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(makeLine(t,r,e))}))}))})),e.media.forEach((function(e){i.push(makeLine("m",grammar.m[0],e)),n.forEach((function(t){grammar[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(makeLine(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(makeLine(t,r,e))}))}))}))})),i.join("\r\n")+"\r\n"},parser=parser$1,writer=writer$1;function ownKeys$9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$8(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$9(Object(r),!0).forEach((function(t){_defineProperty$5(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$9(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function getOption(e){return _objectSpread$8({retryCount:0,retryDelay:1e3,loadTimeout:5e3,stallInterval:300},e)}function _getStatByType(e,t,r){var n;return t.forEach((function(t){t.type!==e||r&&t.kind!==r||(n=t)})),n}function _getStats(e){var t;return e.forEach((function(r){"stream"===r.type&&(t=r.trackIds.map((function(t){var r=e.get(t),n=_getStatByType("inbound-rtp",e,r.kind),i=e.get(null==n?void 0:n.codecId);return{type:r.kind,track:r,inboundRtp:n,codec:i,transport:_getStatByType("transport",e),localCandidate:_getStatByType("local-candidate",e),remoteCandidate:_getStatByType("remote-candidate",e)}})))})),t}function getStats(e){return new Promise((function(t){var r;null===(r=e.getStats(null,(function(e){t(_getStats(e))})))||void 0===r||r.then((function(e){t(_getStats(e))}))})).catch((function(e){}))}function ownKeys$8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$7(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$8(Object(r),!0).forEach((function(t){_defineProperty$5(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$8(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _createSuper$h(e){var t=_isNativeReflectConstruct$h();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}lib.write=writer,lib.parse=parser.parse,lib.parseParams=parser.parseParams,lib.parseFmtpConfig=parser.parseFmtpConfig,lib.parsePayloads=parser.parsePayloads,lib.parseRemoteCandidates=parser.parseRemoteCandidates,lib.parseImageAttributes=parser.parseImageAttributes,lib.parseSimulcastStreamList=parser.parseSimulcastStreamList;var logger$1=new Logger$3("rts"),Rts=function(e){_inherits$4(n,e);var t,r=_createSuper$h(n);function n(e){var t;return _classCallCheck$4(this,n),_defineProperty$5(_assertThisInitialized$4(t=r.call(this)),"_url",""),_defineProperty$5(_assertThisInitialized$4(t),"_pc",null),_defineProperty$5(_assertThisInitialized$4(t),"_audioTransceicer",null),_defineProperty$5(_assertThisInitialized$4(t),"_videoTransceicer",null),_defineProperty$5(_assertThisInitialized$4(t),"_mediaStream",null),_defineProperty$5(_assertThisInitialized$4(t),"_media",null),_defineProperty$5(_assertThisInitialized$4(t),"_opts",null),_defineProperty$5(_assertThisInitialized$4(t),"_loader",null),_defineProperty$5(_assertThisInitialized$4(t),"_retry",0),_defineProperty$5(_assertThisInitialized$4(t),"_startPlayed",!1),_defineProperty$5(_assertThisInitialized$4(t),"_lastTimeupdateTs",0),_defineProperty$5(_assertThisInitialized$4(t),"_onTrack",(function(e){logger$1.log("addTrack: ",e.track),t["_".concat(e.track.kind)]=e.track,t._mediaStream||(t._mediaStream=new MediaStream,t._media.srcObject=t._mediaStream),t._mediaStream.addTrack(e.track)})),_defineProperty$5(_assertThisInitialized$4(t),"_mockWaitingByTimeupdate",(function(){var e;if("connected"===(null===(e=t._pc)||void 0===e?void 0:e.connectionState)){t._lastTimeupdateTs||getStats(t._pc).then((function(e){logger$1.log("tracks stats:",e),e.forEach((function(e){return t.emit(EVENT.METADATA_PARSED,e)}))})).catch((function(){}));var r=performance.now();t._lastTimeupdateTs||(t._lastTimeupdateTs=r),r-t._lastTimeupdateTs>t._opts.stallInterval&&t.emit("waiting"),t._lastTimeupdateTs=r}})),_defineProperty$5(_assertThisInitialized$4(t),"_onLoaderRetry",(function(e,r){t.emit(EVENT.LOAD_RETRY,{error:StreamingError.network(e),retryTime:r})})),t._opts=getOption(e),t._media=t._opts.media,t._loader=new NetLoader$1(_objectSpread$7(_objectSpread$7({},e.fetchOptions),{},{responseType:"json",method:"POST",retry:t._opts.retryCount,retryDelay:t._opts.retryDelay,timeout:t._opts.loadTimeout,onRetryError:t._onLoaderRetry})),t._retry=t._opts.retryCount,t._bindMediaEvent(),t}return _createClass$5(n,[{key:"pc",get:function(){return this._pc}},{key:"getStats",value:function(){return getStats(this._pc)}},{key:"load",value:function(e){this._disconnect(),this._lastTimeupdateTs=0,this._url=e,this._pc=new RTCPeerConnection,this._bindRTCEvents(),this._connect(e)}},{key:"switchURL",value:function(e){this._startPlayed=!0,this.load(e||this._url)}},{key:"_bindRTCEvents",value:function(){var e=this,t=this._pc;t.addEventListener("track",this._onTrack),t.addEventListener("connectionstatechange",(function(){if(logger$1.log("onconnectionstatechange:",t.connectionState),"disconnected"!==t.connectionState&&"failed"!==t.connectionState||e.emit("waiting"),"failed"===t.connectionState){if(0===e._retry)return void e._emitError(StreamingError.network(new Error("rtc connect failed")));e._retry--,e.load(e._url)}"connected"===t.connectionState&&e._startPlayed&&e._media.play()}))}},{key:"_bindMediaEvent",value:function(){this._media.addEventListener("timeupdate",this._mockWaitingByTimeupdate)}},{key:"_connect",value:(t=_asyncToGenerator$1(regenerator.mark((function e(){var t,r,n,i,a,o,s,u;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._pc,r=/Gecko/.test(navigator.userAgent)&&/Firefox/.test(navigator.userAgent),!t.addTransceiver){e.next=10;break}return this._audioTransceicer=t.addTransceiver("audio",{direction:"recvonly"}),this._videoTransceicer=t.addTransceiver("video",{direction:"recvonly"}),e.next=7,t.createOffer();case 7:n=e.sent,e.next=13;break;case 10:return e.next=12,t.createOffer({iceRestart:!0,offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 12:n=e.sent;case 13:return logger$1.log("local offer"),logger$1.log(n.sdp),(i=lib.parse(n.sdp)).media.filter((function(e){return"audio"===e.type})).forEach((function(e){var t;if(r){var n=null===(t=e.rtp.filter((function(e){return"opus"===e.codec}))[0])||void 0===t?void 0:t.payload;n&&e.fmtp.forEach((function(e){e.payload===n&&(e.config="minptime=10;useinbandfec=1")}))}})),n.sdp=lib.write(i),logger$1.log("local offer modified:\n",n.sdp),e.next=21,t.setLocalDescription(n);case 21:return e.prev=21,e.next=24,this._loader.load(this._url,{body:JSON.stringify({sessionId:"sessionId",version:"1.0-html",localSdp:n})});case 24:if(o=e.sent,200===(null==(s=null==o?void 0:o.data)?void 0:s.code)){e.next=28;break}throw new Error("code: ".concat(null==s?void 0:s.code,", message:").concat(null==s?void 0:s.message));case 28:logger$1.log("answer:"),logger$1.log(null===(a=s.remoteSdp)||void 0===a?void 0:a.sdp),(u=lib.parse(s.remoteSdp.sdp)).media.forEach((function(e){e.fingerprint.hash=e.fingerprint.hash.toUpperCase()})),s.remoteSdp.sdp=lib.write(u),logger$1.log("answer modified:\n",s.remoteSdp.sdp),this._pc.setRemoteDescription(s.remoteSdp),e.next=40;break;case 37:e.prev=37,e.t0=e.catch(21),this._emitError(StreamingError.network(e.t0));case 40:case"end":return e.stop()}}),e,this,[[21,37]])}))),function(){return t.apply(this,arguments)})},{key:"_disconnect",value:function(){var e;null===(e=this._pc)||void 0===e||e.close(),this._pc=null,this._audioTransceicer=null,this._videoTransceicer=null,this._mediaStream=null}},{key:"_emitError",value:function(e){this.emit(EVENT.ERROR,e)}},{key:"destroy",value:function(){var e;this._disconnect(),null===(e=this._media)||void 0===e||e.removeEventListener("timeupdate",this._mockWaitingByTimeupdate),this._media&&(this._media.srcObject=null),this._loader=null,this._media=null}}],[{key:"enableLogger",value:function(){Logger$3.enable()}},{key:"disableLogger",value:function(){Logger$3.disable()}}]),n}(EventEmitter$1);try{localStorage.getItem("xgd")?Rts.enableLogger():Rts.disableLogger()}catch(error){}function ownKeys$7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$6(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$7(Object(r),!0).forEach((function(t){_defineProperty$5(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$7(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _createSuper$g(e){var t=_isNativeReflectConstruct$g();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$g(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var RtsPlugin$1=function(t){_inherits$4(n,t);var r=_createSuper$g(n);function n(){var e;_classCallCheck$4(this,n);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return _defineProperty$5(_assertThisInitialized$4(e=r.call.apply(r,[this].concat(i))),"_rts",null),_defineProperty$5(_assertThisInitialized$4(e),"_rtsOpts",null),_defineProperty$5(_assertThisInitialized$4(e),"_init",(function(){var t;null===(t=e._rts)||void 0===t||t.destroy();var r=e.player.config,n=r.rts||{};e._rtsOpts=n,e._rts=new Rts(_objectSpread$6({media:e.player.video},n)),e._rts.load(r.url)})),_defineProperty$5(_assertThisInitialized$4(e),"_onSwitchURL",(function(t){e._rts&&(e.player.config.url=t,e._rts.switchURL(t))})),_defineProperty$5(_assertThisInitialized$4(e),"_onDefinitionChange",(function(t){var r=t.to;e._rts&&e._rts.switchURL(r)})),e}return _createClass$5(n,[{key:"pc",get:function(){var e;return null===(e=this._rts)||void 0===e?void 0:e.pc}},{key:"core",get:function(){return this._rts}},{key:"beforePlayerInit",value:function(){var t,r,n=this;this._init(),this.player.switchURL=this._onSwitchURL,null===(t=this.player)||void 0===t||t.useHooks("replay",(function(){var e;return null===(e=n._rts)||void 0===e?void 0:e.switchURL()})),null===(r=this.player)||void 0===r||r.useHooks("play",(function(){var e;return null===(e=n._rts)||void 0===e?void 0:e.switchURL()})),this.on(URL_CHANGE,this._onSwitchURL),this.on(DEFINITION_CHANGE,this._onDefinitionChange),this.on(DESTROY,this.destroy),this._transEvent(),this._transCoreEvent(EVENT.METADATA_PARSED);try{BasePlugin.defineGetterOrSetter(this.player,{__url:{get:function(){try{return URL.createObjectURL(new MediaSource)}catch(e){var t,r;null!==(t=n.player)&&void 0!==t&&null!==(r=t.video)&&void 0!==r&&r.srcObject||(n.player.video.srcObject=new MediaStream)}}}})}catch(e){}}},{key:"_transEvent",value:function(){var e=this;this._rts.on(EVENT.ERROR,(function(t){if(e.player){var r=e._rtsOpts,n=r.backupConstruct,i=r.backupURL;if(i){var a=e.player;a.emit("core_event",_objectSpread$6(_objectSpread$6({},{url:a.config.url,code:t.errorCode,message:t.errorMessage}),{},{eventName:"core.degrade"})),a.emit("degrade",{url:a.config.url,code:t.errorCode,message:t.errorMessage}),a.unRegisterPlugin("rts"),e._rts=null,a.rts=null,a.config.url=i,n?(a.registerPlugin(n).beforePlayerInit(),setTimeout((function(){a.video.src=a.url}))):a.video.src=i}else e.player.emit(ERROR$3,new Errors$1(e.player,t))}})),this._rts.on("waiting",(function(){var t;null===(t=e.player)||void 0===t||t.emit("waiting")}))}},{key:"_transCoreEvent",value:function(e){var t=this;this._rts.on(e,(function(r){t.player&&t.player.emit("core_event",_objectSpread$6(_objectSpread$6({},r),{},{eventName:e}))}))}},{key:"destroy",value:function(){var e;null===(e=this._rts)||void 0===e||e.destroy()}}],[{key:"pluginName",get:function(){return"rts"}}]),n}(BasePlugin),RtsPlugin=RtsPlugin$1,playerMap={flv:FlvPlugin,hls:HlsPlugin},RtmPlugin=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){return _classCallCheck$8(this,r),t.apply(this,arguments)}return _createClass$9(r,[{key:"beforeCreate",value:function(e){var t=(e.player.config.rtm||{}).backupStreamType;e.player.config.rts=assign$6({},e.player.config.rtm,{backupConstruct:playerMap[t]})}},{key:"afterCreate",value:function(){var e=this.player;e.on("degrade",(function(){e.unRegisterPlugin("rtm")}))}}],[{key:"pluginName",get:function(){return"rtm"}}]),r}(RtsPlugin),SDKEvents=function(e){return e.PLAYER_CREATED_FINISH="player_create_finish",e.PLAYER_REBUILD="player_rebuild",e}(SDKEvents||{}),PluginEvents=function(e){return e.DANMU_CHANGE="danmu_change",e.TIME_SHIFT_CHANGE="time_shift_change",e.AI_SUBTITLE_LANG_CHANGE="ai_subtitle_lang_change",e.AI_SUBTITLE_MATCH="ai_subtitle_match",e.CANCEL_UNMUTE="cancel_unmute",e.REFRESH_CLICK="refresh_click",e.PLAY_BACKUP_CHANGE="play_backup_change",e.PLAY_BACKUP_CHANGE_FINISH="play_backup_change_finish",e.PLAY_ERROR_BUTTON_CLICK="play_error_button_click",e.PlAY_URL_CHANGE="play_url_change",e.SHOW_PLAY_ERROR="show_play_error",e.PLAYER_EXTEND_BUTTON="player_extend_button",e.LONG_WAITING="long_waiting",e.OFTEN_WAITING="often_waiting",e.DEFINITION_DEMOTE="definition_demote",e.LARKWINDOW_CHANGE="larkWindow_change",e.PANEL_MODE_CHANGE="panel_mode_change",e.INNER_DEFINITION_CHANGE="inner_definition_change",e.LINE_CHANGE="line_change",e.GET_PLAY_URL_ERR="get_play_url_err",e.MEDIA_EXPIRED="MEDIA_EXPIRED",e.MIRROR_CHANGE="mirror_change",e}(PluginEvents||{}),Event$2=Object.freeze(Object.defineProperty({__proto__:null,SDKEvents:SDKEvents,PluginEvents:PluginEvents},Symbol.toStringTag,{value:"Module"})),CONTROL_ICON_INDEX={sdkDefinitionPlugin:3,DanmuPlugin:3,sdkMultilinePlugin:4,mirrorPlugin:5,Subtitle:6},MultilinePlugin=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),(n=t.call(this,e)).playerData=null,n.playerData=n.playerConfig.playerData,n}return _createClass$9(r,[{key:"beforeCreate",value:function(e){var t=e.player.config.playerData,r=t.getLineList(),n=t.current.lineId;Array.isArray(r)&&r.length>0&&(e.config.list=r.map((function(t){return t.text=e.player.i18n[t.lineTextKey]||t.lineTextKey,t}))),e.config.defaultLine=n}},{key:"afterCreate",value:function(){_get$2(_getPrototypeOf$8(r.prototype),"afterCreate",this).call(this),this.config.list.length<2&&this.hide()}},{key:"afterPlayerInit",value:function(){}},{key:"renderItemList",value:function(){var e=this,t=this.config,n=t.list,i=t.defaultLine,a=0,o=n.map((function(t,r){var n,o={lineId:t.lineId||"",showText:e.i18n[t.lineTextKey]||t.lineTextKey,isCurrent:!1,selected:!1};return util$2.isUndefined(t.lineId)||(null===(n=t.lineId)||void 0===n?void 0:n.toString())!==(null==i?void 0:i.toString())||(o.isCurrent=!0,o.selected=!0,a=r),o}));_get$2(_getPrototypeOf$8(r.prototype),"renderItemList",this).call(this,o,a)}},{key:"onItemClick",value:function(e,t){this.player.emit(PluginEvents.LINE_CHANGE,{from:this.playerData.current.lineId,to:t.to.lineId}),this.playerData.current.lineId=t.to.lineId,this.player.emit(SDKEvents.PLAYER_REBUILD)}}],[{key:"pluginName",get:function(){return"sdkMultilinePlugin"}},{key:"defaultConfig",get:function(){return{position:Plugin.POSITIONS.CONTROLS_RIGHT,index:CONTROL_ICON_INDEX.sdkMultilinePlugin,list:[],defaultLine:0,className:"xgplayer-multiline",hidePortrait:!1,isShowIcon:!0}}}]),r}(OptionsIcon),DefinitionPlugin=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),(n=t.call(this,e)).playerData=null,n.playerData=n.playerConfig.playerData,n.dataMonitoring(),n}return _createClass$9(r,[{key:"registerLanguageTexts",value:function(){return{switching:{jp:"ã«åˆ‡ã‚Šæ›¿ãˆã‚‹",en:"Switching to",zh:"æ­£åœ¨åˆ‡æ¢è‡³","zh-hk":"æ­£åœ¨åˆ‡æ›è‡³"}}}},{key:"beforeCreate",value:function(e){var t=this,r=e.player.config.playerData,n=r.current,i=n.lineId,a=n.definition,o=r.getDefinitionListByLineId(i);Array.isArray(o)&&o.length>0&&(e.config.list=o.map((function(r){return r.text||(r.text=t.getShowText(e.player.i18n,r)),r}))),e.config.defaultDefinition=a}},{key:"dataMonitoring",value:function(){var e=this;MyProxy$1.subscribeProperty(this.playerData.current,"definition",(function(t,r){if(t!==r&&e.player){var n,i,a=e.config.list,o=null===(n=(void 0===a?[]:a).filter((function(e){return e.definition===r})))||void 0===n||null===(i=n[0])||void 0===i?void 0:i.url;e.player.changeDefinition({definition:r,url:o}),e.player.emit(PluginEvents.INNER_DEFINITION_CHANGE,{from:t,to:r,url:o}),e.player.emit(PluginEvents.PlAY_URL_CHANGE,{url:o,from:PluginEvents.INNER_DEFINITION_CHANGE}),e.renderItemList(r),setTimeout((function(){e.player.paused&&e.player.play()}),1e3)}}))}},{key:"showToast",value:function(e){var t,r=null===(t=this.player)||void 0===t?void 0:t.getPlugin("sdkToastPlugin");if(r){var n=e.showText;r.add("".concat(this.langText.switching).concat(n,"..."),2e3,!0)}}},{key:"afterCreate",value:function(){_get$2(_getPrototypeOf$8(r.prototype),"afterCreate",this).call(this),this.config.list.length<2&&this.hide()}},{key:"afterPlayerInit",value:function(){}},{key:"getShowText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return e[t.definitionTextKey]||t.definitionTextKey||t.definition}},{key:"renderItemList",value:function(e){var t=this,n=this.config,i=n.list,a=n.defaultDefinition,o=0,s=i.map((function(r,n){var i={url:r.url,definition:r.definition||"",showText:t.getShowText(t.i18n,r),isCurrent:!1,selected:!1},s="string"==typeof e?r.definition===e:r.definition===a;return!util$2.isUndefined(r.definition)&&s&&(i.isCurrent=!0,i.selected=!0,o=n),i}));_get$2(_getPrototypeOf$8(r.prototype),"renderItemList",this).call(this,s,o)}},{key:"onItemClick",value:function(e,t){this.showToast(t.to),this.playerData.current.definition=t.to.definition}}],[{key:"pluginName",get:function(){return"sdkDefinitionPlugin"}},{key:"defaultConfig",get:function(){return{position:Plugin.POSITIONS.CONTROLS_RIGHT,index:CONTROL_ICON_INDEX.sdkDefinitionPlugin,list:[],defaultDefinition:"",hidePortrait:!1,className:"xgplayer-definition",isShowIcon:!0}}}]),r}(OptionsIcon),UnmutePlugin=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),(n=t.call(this,e)).state={isSupportAutoplay:!0,showUnmuteBt:!1},n}return _createClass$9(r,[{key:"beforePlayerInit",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"afterCreate",value:function(){(this.player.autoplay||this.player.config.autoplayMuted)&&this.initEvents()}},{key:"registerLanguageTexts",value:function(){return{unmute:{jp:"ãƒŸãƒ¥ãƒ¼ãƒˆã‚’è§£é™¤ã™ã‚‹",en:"Click to unmute",zh:"ç‚¹å‡»å–æ¶ˆé™éŸ³","zh-hk":"é»žæ“Šå–æ¶ˆéœéŸ³"}}}},{key:"updateLang",value:function(){this.renderUnmuteBt()}},{key:"initEvents",value:function(){this.player.once("autoplay_was_prevented",this.handleAutoplayPrevented.bind(this)),this.player.once("autoplay_started",this.handleAutoplayStart.bind(this)),this.player.once("volumechange",this.handleVolumechange.bind(this))}},{key:"handleAutoplayPrevented",value:function(){console.log("é™éŸ³è‡ªåŠ¨å¯æ’­å¤±è´¥"),this.state.isSupportAutoplay=!1,this.player.muted=!1}},{key:"handleAutoplayStart",value:function(){this.state.isSupportAutoplay?(this.state.showUnmuteBt=!0,this.renderUnmuteBt()):this.player.muted=!1}},{key:"handleVolumechange",value:function(){this.state.showUnmuteBt=!1,this.renderUnmuteBt(),this.player.paused&&this.player.play()}},{key:"renderUnmuteBt",value:function(){var e=this.root;if(e&&(e.innerHTML="",this.state.showUnmuteBt)){var t=this.langText.unmute,r=util$2.createDom("div",t,void 0,"xgplayer-unmute-bt");e.appendChild(r),this.bind(".xgplayer-unmute-bt","click",this.cancelUnmute.bind(this))}}},{key:"cancelUnmute",value:function(){this.player.muted=!1,this.state.showUnmuteBt=!1,this.renderUnmuteBt(),this.player.emit(PluginEvents.CANCEL_UNMUTE)}},{key:"destroy",value:function(){this.player.off("autoplay_was_prevented",this.handleAutoplayPrevented.bind(this)),this.player.off("autoplay_started",this.handleAutoplayStart.bind(this)),this.player.off("volumechange",this.handleVolumechange.bind(this))}},{key:"render",value:function(){return'<div class="xgplayer-unmute"></div>'}}],[{key:"pluginName",get:function(){return"sdkUnmutePlugin"}},{key:"defaultConfig",get:function(){return{position:Plugin.POSITIONS.ROOT}}}]),r}(Plugin);function refreshSVG$1(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10 2.488a7.48 7.48 0 00-4.154 1.253.908.908 0 101.005 1.512 5.695 5.695 0 018.844 4.746h-.908a.33.33 0 00-.264.528l1.816 2.422a.33.33 0 00.529 0l1.815-2.422A.33.33 0 0018.42 10h-.908A7.511 7.511 0 0010 2.49zM2.489 10a7.511 7.511 0 0011.665 6.26.908.908 0 00-1.005-1.513A5.695 5.695 0 014.305 10h.908a.33.33 0 00.264-.528L3.66 7.05a.33.33 0 00-.528 0L1.317 9.47a.33.33 0 00.264.53h.908z" fill="#fff"/></svg>',"image/svg+xml").firstChild}var POSITIONS$9=Plugin.POSITIONS,RefreshPlugin=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){return _classCallCheck$8(this,r),t.apply(this,arguments)}return _createClass$9(r,[{key:"afterCreate",value:function(){this.appendChild(".xgplayer-icon",this.icons.refresh),this.initEvents()}},{key:"registerIcons",value:function(){return{refresh:{icon:refreshSVG$1,class:"xgplayer-refresh-svg"}}}},{key:"registerLanguageTexts",value:function(){return{refresh:{jp:"ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥",en:"Refresh",zh:"åˆ·æ–°","zh-hk":"åˆ·æ–°"}}}},{key:"initEvents",value:function(){this.handleRefresh=debounce$2(this.handleRefresh.bind(this),200);var e="mobile"===sniffer$1.device?"touchend":"click";this.bind(e,this.handleRefresh),this.show()}},{key:"handleRefresh",value:function(e){var t=this.player;t&&(e.preventDefault(),e.stopPropagation(),t.addClass("xgplayer-is-enter"),t.pause(),t.emit(PluginEvents.REFRESH_CLICK),setTimeout((function(){t&&t.retry(),t.once("canplay",(function(){t.removeClass("xgplayer-is-enter")}))})))}},{key:"destroy",value:function(){this.unbind(["touchend","click"],this.handleRefresh)}},{key:"render",value:function(){return'\n    <xg-icon class="xgplayer-refresh">\n      <div class="xgplayer-icon">\n      </div>\n      <div class="xg-tips" lang-key="refresh">'.concat(this.langText.refresh,"</div>\n    </xg-icon>\n    ")}}],[{key:"pluginName",get:function(){return"refresh"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$9.CONTROLS_LEFT,index:1}}}]),r}(Plugin);function MoreIconSVG(){return(new DOMParser).parseFromString('<svg width="18" height="18" viewBox="0 0 23 22" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M5.75 11C5.75 11.9665 4.9665 12.75 4 12.75C3.0335 12.75 2.25 11.9665 2.25 11C2.25 10.0335 3.0335 9.25 4 9.25C4.9665 9.25 5.75 10.0335 5.75 11ZM13.25 11C13.25 11.9665 12.4665 12.75 11.5 12.75C10.5335 12.75 9.75 11.9665 9.75 11C9.75 10.0335 10.5335 9.25 11.5 9.25C12.4665 9.25 13.25 10.0335 13.25 11ZM19 12.75C19.9665 12.75 20.75 11.9665 20.75 11C20.75 10.0335 19.9665 9.25 19 9.25C18.0335 9.25 17.25 10.0335 17.25 11C17.25 11.9665 18.0335 12.75 19 12.75Z" fill="white"/>\n</svg>\n',"image/svg+xml").firstChild}var MoreButtonPlugin=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),(n=t.call(this,e)).panel=null,n.panelContainer=null,n}return _createClass$9(r,[{key:"beforePlayerInit",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"afterCreate",value:function(){this.renderMoreIcon()}},{key:"updateLang",value:function(e){if(this.panelContainer){var t=this.panelContainer.querySelectorAll(".panel-icon-bt-text"),r=this.getAndSplitList().extraList;t.forEach((function(t){var n,i,a=Number(t.getAttribute("plugin-index"));null!==(n=r[a])&&void 0!==n&&null!==(i=n.textTips)&&void 0!==i&&i[e]&&(t.innerHTML=r[a].textTips[e])}))}}},{key:"registerIcons",value:function(){return{more:{icon:MoreIconSVG,class:"xgplayer-more-svg"}}}},{key:"getAndSplitList",value:function(){var e,t,r,n,i,a=(null!==(e=this.player.config.ignores)&&void 0!==e?e:[]).map((function(e){return e.toLowerCase()})),o=this.config.iconPlugins.filter((function(e){return!a.includes(e.pluginName.toLowerCase())}));return o.length>this.config.maxShowNum+1?(n=o.slice(0,this.config.maxShowNum),i=o.slice(-(o.length-this.config.maxShowNum))):n=_toConsumableArray$3(o),{list:null!==(t=n)&&void 0!==t?t:[],extraList:null!==(r=i)&&void 0!==r?r:[]}}},{key:"children",value:function(){var e=this,t=this.getAndSplitList().list,r={};return t.forEach((function(t){r[t.pluginName]={plugin:t,options:{root:e.root}}})),r}},{key:"renderMoreIcon",value:function(){var e=this,t=this.getAndSplitList().extraList;if(0!==t.length){var r=this.root,n=util$2.createDom("div","",{},"xgplayer-icon");n.appendChild(this.icons.more),n.addEventListener("click",(function(){e.renderPanel(t)}));var i=util$2.createDom("xg-icon","",{"data-index":0},"xgplayer-more");i.appendChild(n),r.appendChild(i)}}},{key:"renderPanel",value:function(e){var t=this;this.panelContainer||(this.panelContainer=util$2.createDom("div","",{},"panel-content"),e.forEach((function(e,r){var n,i,a=util$2.createDom("div","",{},"panel-icon-bt"),o=util$2.createDom("div","",{},"panel-icon-svg");a.appendChild(o),t.registerExtraPlugin(e,o);var s="zh-cn"===t.player.lang?"zh":t.player.lang,u=null!==(n=null===(i=e.textTips)||void 0===i?void 0:i[s])&&void 0!==n?n:e.pluginName;a.appendChild(util$2.createDom("span",u,{"plugin-index":r},"panel-icon-bt-text")),t.panelContainer.appendChild(a)}))),this.player.panel.showPanel(this.panelContainer)}},{key:"registerExtraPlugin",value:function(e,t){this.player.registerPlugin({plugin:e,options:{root:t}})}},{key:"destroy",value:function(){}},{key:"render",value:function(){return'<div class="xgplayer-rightTop-iconList"></div>'}}],[{key:"pluginName",get:function(){return"MoreButtonPlugin"}},{key:"defaultConfig",get:function(){return{position:Plugin.POSITIONS.ROOT_TOP,iconPlugins:[],maxShowNum:2}}}]),r}(Plugin);function ErrorImg(){return(new DOMParser).parseFromString('<svg width="150" height="162" viewBox="0 0 150 162" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M127.718 112.831H6.13675C4.19663 112.831 2.25651 108.974 2.90322 104.475C3.54993 99.9761 8.07687 99.9761 13.8972 99.9761C11.9571 97.4052 9.37028 88.4069 15.8373 81.3369C22.3044 74.2668 25.5379 74.2668 34.5918 75.5526C33.9451 63.9837 47.526 34.4178 77.2744 35.0605C107.023 35.7032 116.077 54.3421 119.957 63.3404C129.011 62.6976 147.765 66.554 149.706 87.1214C151.258 103.575 135.694 111.117 127.718 112.831Z" fill="#F1F4F8"/>\n<path d="M44.9346 91.6022L43.6782 99.8032" stroke="#D0D6E0" stroke-width="2" stroke-linecap="round"/>\n<path d="M47.3545 125.695L48.6109 117.494" stroke="#D0D6E0" stroke-width="2" stroke-linecap="round"/>\n<path d="M31.5347 97.7378L38.7295 101.869" stroke="#D0D6E0" stroke-width="2" stroke-linecap="round"/>\n<path d="M60.7544 119.559L53.5595 115.428" stroke="#D0D6E0" stroke-width="2" stroke-linecap="round"/>\n<path d="M69.6755 44.5318L138.35 26.0209C139.115 25.8148 139.804 26.5367 139.563 27.2909L121.081 85.1146C120.982 85.4243 120.739 85.6665 120.429 85.7641L52.0645 107.28C51.2996 107.521 50.5766 106.809 50.8062 106.04L68.9776 45.2111C69.0768 44.879 69.3409 44.622 69.6755 44.5318Z" fill="#D0D6E0" stroke="#D0D6E0" stroke-width="4" stroke-linecap="round"/>\n<path d="M83.1285 52.7415C91.6454 54.3438 107.322 62.0019 101.894 79.8155" stroke="white" stroke-width="3" stroke-linecap="round"/>\n<path d="M84.138 62.3385C88.3894 63.1384 96.2148 66.9611 93.5053 75.8531" stroke="white" stroke-width="3" stroke-linecap="round"/>\n<ellipse cx="83.6417" cy="71.98" rx="3.08443" ry="3.07025" transform="rotate(12.6375 83.6417 71.98)" fill="white"/>\n<path d="M43.4699 110.358C39.5425 109.114 30.6316 108.203 26.4077 114.511C21.1278 122.397 36.5031 152.755 2.11053 160.141" stroke="#D0D6E0" stroke-width="2" stroke-linecap="round"/>\n</svg>\n',"image/svg+xml").firstChild}var ErrorPlugin=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),(n=t.call(this,e)).playerData=null,n.state={showError:!1,retryTimes:0,idx:0},n._errDetailList=[],n.playerData=e.player.config.playerData,n}return _createClass$9(r,[{key:"afterCreate",value:function(){this.initEvents()}},{key:"registerLanguageTexts",value:function(){return{clickButton:{jp:"ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥",en:"Refresh",zh:"åˆ·æ–°","zh-hk":"åˆ·æ–°"},errorTips:{jp:"å†ç”Ÿä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚[æ›´æ–°]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©¦ã—ã¦ãã ã•ã„",en:"An error occurred while playing, click refresh to try",zh:"æ’­æ”¾å‘ç”Ÿé”™è¯¯ï¼Œç‚¹å‡»åˆ·æ–°è¯•è¯•å§","zh-hk":"æ’­æ”¾ç™¼ç”ŸéŒ¯èª¤ï¼Œé»žæ“Šåˆ·æ–°è©¦è©¦å§"}}}},{key:"registerIcons",value:function(){return{errorImg:{icon:ErrorImg,class:"xgplayer-error-svg"}}}},{key:"updateLang",value:function(){if(this.$errorDom){var e=this.$errorDom.querySelector(".xgplayer-error-tips");if(e){var t,r,n=null!==(t=null===(r=this.config.errorTipsText)||void 0===r?void 0:r[this.lang])&&void 0!==t?t:this.langText.errorTips;e.innerHTML=n}var i=this.$errorDom.querySelector(".xgplayer-error-button");i&&(i.innerHTML=this.langText.clickButton)}}},{key:"initEvents",value:function(){this.player.on(ERROR$3,this.handleError.bind(this)),this.playerData.isLive&&(this.player.on(ENDED,this.handleEnd.bind(this)),this.player.on(PluginEvents.REFRESH_CLICK,this.closeError.bind(this)))}},{key:"handleError",value:function(){this.player&&this.player.pause(),this.config.isNeedDemoteBack?(this.state.showError=!1,this.changeMainOrBackup()):this.state.showError=!0,this.renderError()}},{key:"handleEnd",value:function(){this.player&&this.player.pause(),this.config.isNeedDemoteBack&&this.changeMainOrBackup()}},{key:"getRetryList",value:function(){var e,t=this.playerData.getCurrentStreams()[0];return[null==t?void 0:t.url].concat(_toConsumableArray$3(null!==(e=null==t?void 0:t.backUrlList)&&void 0!==e?e:[]))}},{key:"changeMainOrBackup",value:function(){var e=this;this.player.addClass(STATE_CLASS.ENTER);var t=this.getRetryList(),r=this.config.retryLoopNum*t.length,n=(t.indexOf(this.player.config.url)+1)%t.length;this.state.idx=n;var i=t[n];if(!i||this.state.retryTimes===r)return this.player.removeClass(STATE_CLASS.ENTER),this.state.retryTimes===r&&this.player.emit(PluginEvents.PLAY_BACKUP_CHANGE_FINISH),this.state.showError=!0,this.renderError(),void this.resetTimes();this.player.once("canplay",(function(){e.state.retryTimes=0})),console.log("é‡è¯•ç¬¬".concat(this.state.retryTimes,"æ¬¡"),i),this.player.emit(PluginEvents.PLAY_BACKUP_CHANGE,{currentUrl:this.player.config.url,nextUrl:i,retryTimes:this.state.retryTimes}),this.changeUrl(i),this.state.retryTimes=this.state.retryTimes+1}},{key:"changeUrl",value:function(e){this.player.config.url=e,this.player.switchURL(e,!1),this.player.emit(PluginEvents.PlAY_URL_CHANGE,{url:e,from:PluginEvents.PLAY_BACKUP_CHANGE})}},{key:"resetTimes",value:function(){this.state.retryTimes=0,this.state.idx=0}},{key:"renderError",value:function(){var e=this.root;e&&(e.innerHTML="",e.style.display="none",this.state.showError&&(this.player.emit(PluginEvents.SHOW_PLAY_ERROR),e.style.display="block",e.appendChild(this.getErrorDom())))}},{key:"addErrDetail",value:function(e){Array.isArray(e)?this._errDetailList=[].concat(_toConsumableArray$3(this._errDetailList),_toConsumableArray$3(e)):this._errDetailList.push(e)}},{key:"getErrorDom",value:function(){var e=this;if(!this.$errorDom){var t,r;if(this.$errorDom=util$2.createDom("div","",void 0,"xgplayer-error-cover"),this.config.errorImg){var n=util$2.createDom("div","",void 0,"xgplayer-error-img");n.appendChild(this.icons.errorImg),this.$errorDom.appendChild(n)}if(this.config.errorTips){var i,a,o=null!==(i=null===(a=this.config.errorTipsText)||void 0===a?void 0:a[this.lang])&&void 0!==i?i:this.langText.errorTips,s=util$2.createDom("div",o,void 0,"xgplayer-error-tips");this.$errorDom.appendChild(s)}if(this.config.isNeedRefreshButton){var u=util$2.createDom("div",this.langText.clickButton,void 0,"xgplayer-error-button");this.bind(".xgplayer-error-button","click",this.handleButtonClick.bind(this)),this.$errorDom.appendChild(u)}if(null!==(t=this._errDetailList)&&void 0!==t&&t.length)null===(r=this._errDetailList)||void 0===r||r.forEach((function(t){var r="function"==typeof t?t():t;if(r){var n=util$2.createDom("div","".concat(r.label,": ").concat(r.value),void 0,"xgplayer-error-detail-info");e.$errorDom.appendChild(n)}}));this.emit("sdkerrorplugin_render",this.$errorDom)}return this.$errorDom}},{key:"handleButtonClick",value:function(){var e,t;null===(e=this.player)||void 0===e||e.emit(PluginEvents.PLAY_ERROR_BUTTON_CLICK),null===(t=this.player)||void 0===t||t.retry(),this.closeError()}},{key:"closeError",value:function(){this.state.showError=!1,this.renderError()}},{key:"destroy",value:function(){this.player.off(ERROR$3,this.handleError.bind(this)),this.playerData.isLive&&this.player.off(ENDED,this.handleEnd.bind(this))}},{key:"render",value:function(){return'<xgplayer-error class="xgplayer-error"></xgplayer-error>'}}],[{key:"pluginName",get:function(){return"sdkErrorPlugin"}},{key:"defaultConfig",get:function(){return{errorImg:!0,errorTips:!0,isNeedRefreshButton:!0,isNeedDemoteBack:!1,retryLoopNum:1,errorTipsText:null,position:Plugin.POSITIONS.ROOT}}}]),r}(Plugin);function danmuActiveSVG$1(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16.5 4.106h-13a.3.3 0 00-.3.3v11.186a.3.3 0 00.3.3h7.111v1.7H3.5a2 2 0 01-2-2V4.406a2 2 0 012-2h13a2 2 0 012 2V10h-1.7V4.406a.3.3 0 00-.3-.3zM6 7.722c0-.42.34-.76.76-.76h6.58a.76.76 0 110 1.52H6.76a.76.76 0 01-.76-.76zm0 3.037c0-.42.34-.759.76-.759h3.543a.76.76 0 110 1.519H6.76a.76.76 0 01-.76-.76z" fill="#fff"/><circle cx="15.1" cy="14.201" r="3.4" fill="#3370FF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M13.185 13.756a.5.5 0 01.707 0l.866.866 1.78-1.78a.5.5 0 11.707.707l-2.133 2.134a.5.5 0 01-.707 0l-1.22-1.22a.5.5 0 010-.707z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function Default(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16.5 4.106h-13a.3.3 0 00-.3.3v11.186a.3.3 0 00.3.3h7.111v1.7H3.5a2 2 0 01-2-2V4.406a2 2 0 012-2h13a2 2 0 012 2V10h-1.7V4.406a.3.3 0 00-.3-.3zM6 7.722c0-.42.34-.76.76-.76h6.58a.76.76 0 110 1.52H6.76a.76.76 0 01-.76-.76zm0 3.037c0-.42.34-.759.76-.759h3.543a.76.76 0 110 1.519H6.759a.76.76 0 01-.759-.76zm7.202 2.303a2.2 2.2 0 003.011 3.011l-3.011-3.01zm3.915 1.992a2.2 2.2 0 00-2.896-2.896l2.896 2.896zm1.383-.879a3.4 3.4 0 11-6.8 0 3.4 3.4 0 016.8 0z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function resetIcon(){return(new DOMParser).parseFromString('<svg fill="none" stroke="currentColor" stroke-width="4" viewBox="0 0 48 48" width="1em" height="1em"\n    class="arco-icon arco-icon-refresh">\n    <path\n        d="M38.837 18C36.463 12.136 30.715 8 24 8 15.163 8 8 15.163 8 24s7.163 16 16 16c7.455 0 13.72-5.1 15.496-12M40 8v10H30">\n    </path>\n</svg>',"image/svg+xml").firstChild}function ownerDocument(e){return e&&e.ownerDocument||document}function activeElement(t){void 0===t&&(t=ownerDocument());try{var r=t.activeElement;return r&&r.nodeName?r:null}catch(e){return t.body}}function hasClass(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")}function addClass(e,t){e.classList?e.classList.add(t):hasClass(e,t)||("string"==typeof e.className?e.className=e.className+" "+t:e.setAttribute("class",(e.className&&e.className.baseVal||"")+" "+t))}var canUseDOM=!("undefined"==typeof window||!window.document||!window.document.createElement),optionsSupported=!1,onceSupported=!1;try{var options={get passive(){return optionsSupported=!0},get once(){return onceSupported=optionsSupported=!0}};canUseDOM&&(window.addEventListener("test",options,options),window.removeEventListener("test",options,!0))}catch(e){}function addEventListener(e,t,r,n){if(n&&"boolean"!=typeof n&&!onceSupported){var i=n.once,a=n.capture,o=r;!onceSupported&&i&&(o=r.__once||function e(n){this.removeEventListener(t,e,a),r.call(this,n)},r.__once=o),e.addEventListener(t,o,optionsSupported?n:a)}e.addEventListener(t,r,n)}function ownerWindow(e){var t=ownerDocument(e);return t&&t.defaultView||window}function getComputedStyle(e,t){return ownerWindow(e).getComputedStyle(e,t)}var rUpper=/([A-Z])/g;function hyphenate(e){return e.replace(rUpper,"-$1").toLowerCase()}var msPattern=/^ms-/;function hyphenateStyleName(e){return hyphenate(e).replace(msPattern,"-ms-")}var supportedTransforms=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;function isTransform(e){return!(!e||!supportedTransforms.test(e))}function style(e,t){var r="",n="";if("string"==typeof t)return e.style.getPropertyValue(hyphenateStyleName(t))||getComputedStyle(e).getPropertyValue(hyphenateStyleName(t));Object.keys(t).forEach((function(i){var a=t[i];a||0===a?isTransform(i)?n+=i+"("+a+") ":r+=hyphenateStyleName(i)+": "+a+";":e.style.removeProperty(hyphenateStyleName(i))})),n&&(r+="transform: "+n+";"),e.style.cssText+=";"+r}function removeEventListener(e,t,r,n){var i=n&&"boolean"!=typeof n?n.capture:n;e.removeEventListener(t,r,i),r.__once&&e.removeEventListener(t,r.__once,i)}function listen(e,t,r,n){return addEventListener(e,t,r,n),function(){removeEventListener(e,t,r,n)}}function triggerEvent(e,t,r,n){if(void 0===r&&(r=!1),void 0===n&&(n=!0),e){var i=document.createEvent("HTMLEvents");i.initEvent(t,r,n),e.dispatchEvent(i)}}function parseDuration(e){var t=style(e,"transitionDuration")||"",r=-1===t.indexOf("ms")?1e3:1;return parseFloat(t)*r}function emulateTransitionEnd(e,t,r){void 0===r&&(r=5);var n=!1,i=setTimeout((function(){n||triggerEvent(e,"transitionend",!0)}),t+r),a=listen(e,"transitionend",(function(){n=!0}),{once:!0});return function(){clearTimeout(i),a()}}function transitionEnd(e,t,r,n){null==r&&(r=parseDuration(e)||0);var i=emulateTransitionEnd(e,r,n),a=listen(e,"transitionend",t);return function(){i(),a()}}var reset={transition:"","transition-duration":"","transition-delay":"","transition-timing-function":""};function _animate(e){var t=e.node,r=e.properties,n=e.duration,i=void 0===n?200:n,a=e.easing,o=e.callback,s=[],u={},c="";Object.keys(r).forEach((function(e){var t=r[e];isTransform(e)?c+=e+"("+t+") ":(u[e]=t,s.push(hyphenate(e)))})),c&&(u.transform=c,s.push("transform")),i>0&&(u.transition=s.join(", "),u["transition-duration"]=i/1e3+"s",u["transition-delay"]="0s",u["transition-timing-function"]=a||"linear");var l=transitionEnd(t,(function(e){e.target===e.currentTarget&&(style(t,reset),o&&o.call(this,e))}),i);return t.clientLeft,style(t,u),{cancel:function(){l(),style(t,reset)}}}function animate(e,t,r,n,i){if(!("nodeType"in e))return _animate(e);if(!t)throw new Error("must include properties to animate");return"function"==typeof n&&(i=n,n=""),_animate({node:e,properties:t,duration:r,easing:n,callback:i})}var prev=(new Date).getTime();function fallback(e){var t=(new Date).getTime(),r=Math.max(0,16-(t-prev)),n=setTimeout(e,r);return prev=t,n}var vendors=["","webkit","moz","o","ms"],cancelMethod="clearTimeout",rafImpl=fallback,getKey=function(e,t){return e+(e?t[0].toUpperCase()+t.substr(1):t)+"AnimationFrame"};canUseDOM&&vendors.some((function(e){var t=getKey(e,"request");return t in window&&(cancelMethod=getKey(e,"cancel"),rafImpl=function(e){return window[t](e)}),!!rafImpl}));var cancel=function(e){"function"==typeof window[cancelMethod]&&window[cancelMethod](e)},request$1=rafImpl,matchesImpl;function attribute(e,t,r){if(e){if(void 0===r)return e.getAttribute(t);r||""===r?e.setAttribute(t,String(r)):e.removeAttribute(t)}}function childElements(e){return e?Array.from(e.children):[]}function clear(e){if(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}return null}function matches(e,t){if(!matchesImpl){var r=document.body,n=r.matches||r.matchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector;matchesImpl=function(e,t){return n.call(e,t)}}return matchesImpl(e,t)}function closest(e,t,r){e.closest&&!r&&e.closest(t);var n=e;do{if(matches(n,t))return n;n=n.parentElement}while(n&&n!==r&&n.nodeType===document.ELEMENT_NODE);return null}function contains(e,t){return e.contains?e.contains(t):e.compareDocumentPosition?e===t||!!(16&e.compareDocumentPosition(t)):void 0}var toArray$1=Function.prototype.bind.call(Function.prototype.call,[].slice);function childNodes(e){return e?toArray$1(e.childNodes):[]}var toArray=Function.prototype.bind.call(Function.prototype.call,[].slice);function qsa(e,t){return toArray(e.querySelectorAll(t))}function filterEvents(e,t){return function(r){var n=r.currentTarget,i=r.target;qsa(n,e).some((function(e){return contains(e,i)}))&&t.call(this,r)}}function isDocument(e){return"nodeType"in e&&e.nodeType===document.DOCUMENT_NODE}function isWindow(e){return"window"in e&&e.window===e?e:isDocument(e)&&e.defaultView||!1}function getscrollAccessor(e){var t="pageXOffset"===e?"scrollLeft":"scrollTop";return function(r,n){var i=isWindow(r);if(void 0===n)return i?i[e]:r[t];i?i.scrollTo(i[e],n):r[t]=n}}var scrollLeft=getscrollAccessor("pageXOffset"),scrollTop=getscrollAccessor("pageYOffset");function offset(e){var t=ownerDocument(e),r={top:0,left:0,height:0,width:0},n=t&&t.documentElement;return n&&contains(n,e)?(void 0!==e.getBoundingClientRect&&(r=e.getBoundingClientRect()),r={top:r.top+scrollTop(n)-(n.clientTop||0),left:r.left+scrollLeft(n)-(n.clientLeft||0),width:r.width,height:r.height}):r}function height(e,t){var r=isWindow(e);return r?r.innerHeight:t?e.clientHeight:offset(e).height}function insertAfter(e,t){return e&&t&&t.parentNode?(t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e),e):null}var regExpInputs=/^(?:input|select|textarea|button)$/i;function isInput(e){return!!e&&regExpInputs.test(e.nodeName)}function isVisible(e){return!!e&&!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}function collectSiblings(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null);for(var n=[];e;e=e.nextElementSibling)if(e!==t){if(r&&matches(e,r))break;n.push(e)}return n}function nextUntil(e,t){return collectSiblings(e,e,t)}var isHTMLElement=function(e){return!!e&&"offsetParent"in e};function offsetParent(e){for(var t=ownerDocument(e),r=e&&e.offsetParent;isHTMLElement(r)&&"HTML"!==r.nodeName&&"static"===style(r,"position");)r=r.offsetParent;return r||t.documentElement}function collectElements(e,t){var r=null,n=[];for(r=e?e[t]:null;r&&9!==r.nodeType;)n.push(r),r=r[t]||null;return n}function parents(e){return collectElements(e,"parentElement")}function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends.apply(this,arguments)}var nodeName=function(e){return e.nodeName&&e.nodeName.toLowerCase()},size;function position(e,t){var r,n={top:0,left:0};if("fixed"===style(e,"position"))r=e.getBoundingClientRect();else{var i=t||offsetParent(e);r=offset(e),"html"!==nodeName(i)&&(n=offset(i));var a=String(style(i,"borderTopWidth")||0);n.top+=parseInt(a,10)-scrollTop(i)||0;var o=String(style(i,"borderLeftWidth")||0);n.left+=parseInt(o,10)-scrollLeft(i)||0}var s=String(style(e,"marginTop")||0),u=String(style(e,"marginLeft")||0);return _extends({},r,{top:r.top-n.top-(parseInt(s,10)||0),left:r.left-n.left-(parseInt(u,10)||0)})}function prepend(e,t){return e&&t?(t.firstElementChild?t.insertBefore(e,t.firstElementChild):t.appendChild(e),e):null}function remove(e){return e&&e.parentNode?(e.parentNode.removeChild(e),e):null}function replaceClassName(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function removeClass(e,t){e.classList?e.classList.remove(t):"string"==typeof e.className?e.className=replaceClassName(e.className,t):e.setAttribute("class",replaceClassName(e.className&&e.className.baseVal||"",t))}function scrollbarSize(e){if((!size&&0!==size||e)&&canUseDOM){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),size=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return size}function scrollParent(e,t){var r=style(e,"position"),n="absolute"===r,i=e.ownerDocument;if("fixed"===r)return i||document;for(;(e=e.parentNode)&&!isDocument(e);){var a=n&&"static"===style(e,"position"),o=(style(e,"overflow")||"")+(style(e,"overflow-y")||"")+style(e,"overflow-x");if(!a&&(/(auto|scroll)/.test(o)&&(t||height(e)<e.scrollHeight)))return e}return i||document}function scrollTo(e,t){var r=offset(e),n={top:0,left:0};if(e){var i=t||scrollParent(e),a=isWindow(i),o=scrollTop(i),s=height(i,!0);a||(n=offset(i));var u=(r={top:r.top-n.top,left:r.left-n.left,height:r.height,width:r.width}).height,c=r.top+(a?0:o),l=c+u;o=o>c?c:l>o+s?l-s:o;var d=request$1((function(){return scrollTop(i,o)}));return function(){return cancel(d)}}}function siblings(e){return collectSiblings(e&&e.parentElement?e.parentElement.firstElementChild:null,e)}var regExpNbspEntity=/&nbsp;/gi,regExpNbspHex=/\xA0/g,regExpSpaces=/\s+([^\s])/gm;function text(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=!0);var n="";return e&&(n=(e.textContent||"").replace(regExpNbspEntity," ").replace(regExpNbspHex," "),t&&(n=n.trim()),r&&(n=n.replace(regExpSpaces," $1"))),n}function toggleClass(e,t){e.classList?e.classList.toggle(t):hasClass(e,t)?removeClass(e,t):addClass(e,t)}function getWidth(e,t){var r=isWindow(e);return r?r.innerWidth:t?e.clientWidth:offset(e).width}var helpers={addEventListener:addEventListener,removeEventListener:removeEventListener,triggerEvent:triggerEvent,animate:animate,filter:filterEvents,listen:listen,style:style,getComputedStyle:getComputedStyle,attribute:attribute,activeElement:activeElement,ownerDocument:ownerDocument,ownerWindow:ownerWindow,requestAnimationFrame:request$1,cancelAnimationFrame:cancel,matches:matches,height:height,width:getWidth,offset:offset,offsetParent:offsetParent,position:position,contains:contains,scrollbarSize:scrollbarSize,scrollLeft:scrollLeft,scrollParent:scrollParent,scrollTo:scrollTo,scrollTop:scrollTop,querySelectorAll:qsa,closest:closest,addClass:addClass,removeClass:removeClass,hasClass:hasClass,toggleClass:toggleClass,transitionEnd:transitionEnd,childNodes:childNodes,childElements:childElements,nextUntil:nextUntil,parents:parents,siblings:siblings,clear:clear,insertAfter:insertAfter,isInput:isInput,isVisible:isVisible,prepend:prepend,remove:remove,text:text},Slider=function(){function e(t,r){_classCallCheck$8(this,e),this.ticks=[],this.range=[0,100],this.currentValue=0,this.currentTick={name:"",val:0,renderVal:0},this.buttonStatus=1,this.startClientX=0,this.wrapperWidth=1,this.wrapperLeft=0,this.handleChange=function(){},this.parent=t,this.ticks=r.ticks,this.itemProps=r,this.sliderTitle=document.createElement("div"),this.sliderTitle.innerHTML=r.name,this.sliderContent=document.createElement("div"),this.sliderValue=document.createElement("div"),this.wrapper=document.createElement("div"),this.inner=document.createElement("div"),this.button=document.createElement("div"),helpers.addClass(this.wrapper,"wrapper"),helpers.addClass(this.parent,"xg-player-slider"),helpers.addClass(this.sliderContent,"line-slider"),helpers.addClass(this.sliderTitle,"line-title"),helpers.addClass(this.sliderValue,"line-value"),this.renderTicks(),this.rendInner(),this.parent.appendChild(this.sliderTitle),this.parent.appendChild(this.sliderContent),this.parent.appendChild(this.sliderValue),this.sliderContent.appendChild(this.wrapper),this.bindEvents(),this.setValue(r.defaultValue)}return _createClass$9(e,[{key:"renderTicks",value:function(){var e=this.wrapper,t=document.createElement("div");helpers.addClass(t,"ticks");for(var r=1;r<this.ticks.length-1;r++){var n=this.ticks[r],i=document.createElement("div");helpers.addClass(i,"tick"),helpers.style(i,{left:n.val+"%"}),t.appendChild(i)}e.appendChild(t)}},{key:"rendInner",value:function(){var e=this.wrapper,t=this.inner;helpers.addClass(t,"inner");var r=this.button;helpers.addClass(r,"button"),e.appendChild(t),e.appendChild(r)}},{key:"bindEvents",value:function(){helpers.addEventListener(this.wrapper,"click",this.onClick.bind(this)),helpers.addEventListener(this.button,"touchstart",this.onTouchStart.bind(this)),helpers.addEventListener(this.button,"touchmove",throttle(this.onTouchmove.bind(this),30)),helpers.addEventListener(this.button,"touchend",this.onTouchend.bind(this)),helpers.addEventListener(this.button,"touchcancel",this.onTouchend.bind(this))}},{key:"setValue",value:function(e){var t=this;if(e>this.range[1]||e<this.range[0])return!1;this.currentTick=this.getCurrentTick(e),this.currentValue=this.currentTick.val;var r=this.currentValue+"%";return setTimeout((function(){helpers.style(t.inner,{width:r}),helpers.style(t.button,{left:r})})),this.sliderValue.innerHTML=this.currentTick.name,this.handleChange(this.currentValue),!0}},{key:"renderText",value:function(e){var t=this;this.ticks=e.ticks,this.itemProps=e,this.sliderTitle.innerHTML=e.name,this.currentTick=this.ticks.filter((function(e){return e.val===t.currentValue}))[0],this.sliderValue.innerHTML=this.currentTick.name}},{key:"onChange",value:function(e){this.handleChange=e}},{key:"getCurrentTick",value:function(e){for(var t=0;t<this.ticks.length-1;t++)if(this.ticks[t].val<=e&&this.ticks[t+1].val>=e)return e-this.ticks[t].val>this.ticks[t+1].val-e?this.ticks[t+1]:this.ticks[t];return this.ticks[0]}},{key:"onMousedown",value:function(e){this.startClientX=e.clientX,this.onStart()}},{key:"onTouchStart",value:function(e){e.stopPropagation(),this.startClientX=e.touches[0].clientX,this.onStart()}},{key:"onStart",value:function(){this.buttonStatus=2;var e=helpers.offset(this.wrapper);this.wrapperWidth=e.width,this.wrapperLeft=e.left}},{key:"onMousemove",value:function(e){if(2===this.buttonStatus){var t=e.clientX-this.startClientX;this.onMove(t)}}},{key:"onTouchmove",value:function(e){e.stopPropagation();var t=e.touches[0].clientX-this.startClientX;this.onMove(t)}},{key:"onMove",value:function(e){var t=this.startClientX+e;if(!(t-this.wrapperLeft<0||t-this.wrapperLeft>this.wrapperWidth)){this.startClientX=this.startClientX+e;var r=(this.startClientX-this.wrapperLeft)*(this.range[1]-this.range[0])/this.wrapperWidth;helpers.style(this.inner,{width:r+"%"}),helpers.style(this.button,{left:r+"%"})}}},{key:"onMouseup",value:function(e){console.log("mouse up",e.clientX),this.onEnd()}},{key:"onTouchend",value:function(){this.onEnd()}},{key:"onEnd",value:function(){this.buttonStatus=3;var e=(this.startClientX-this.wrapperLeft)*(this.range[1]-this.range[0])/this.wrapperWidth;this.setValue(e)}},{key:"onClick",value:function(e){e.stopPropagation();var t=helpers.offset(this.wrapper);this.wrapperWidth=t.width,this.wrapperLeft=t.left;var r=(e.clientX-this.wrapperLeft)*(this.range[1]-this.range[0])/this.wrapperWidth;this.setValue(r)}}]),e}(),zh={danmuSwitch:"å¼¹å¹•å¼€å…³",danmuSetting:"å¼¹å¹•è®¾ç½®",openDanmu:"æ‰“å¼€å¼¹å¹•",reset:"é‡ç½®",opacity:"ä¸é€æ˜Žåº¦",area:"æ˜¾ç¤ºåŒºåŸŸ",speed:"å¼¹å¹•é€Ÿåº¦",fontSize:"å­—ä½“å¤§å°",danmuMask:"æ™ºèƒ½æŒ¡æ¿",screen0:"1/4å±",screen1:"åŠå±",screen2:"3/4å±",screen3:"å…¨å±",opacity0:"0",opacity1:"1/3",opacity2:"2/3",opacity3:"1",speed0:"0.25",speed1:"0.5",speed2:"æ­£å¸¸",speed3:"1.25",speed4:"1.5",speed5:"2",fontSize0:"æžå°",fontSize1:"é€‚ä¸­",fontSize2:"æžå¤§"},en={danmuSwitch:"Barrage switch",danmuSetting:"Barrage settings",openDanmu:"Open Barrage",reset:"Reset",opacity:"Opacity",area:"Display  area",speed:"Barrage speed",fontSize:"Font size",danmuMask:"Intelligent blocking",screen0:"1/4 screen",screen1:"Half screen",screen2:"3/4 screen",screen3:"Full screen",opacity0:"0",opacity1:"1/3",opacity2:"2/3",opacity3:"1",speed0:"0.25",speed1:"0.5",speed2:"Normal",speed3:"1.25",speed4:"1.5",speed5:"2",fontSize0:"Minimal",fontSize1:"Moderate",fontSize2:"Great"},jp=en,zhHK={danmuSwitch:"å½ˆå¹•é–‹é—œ",danmuSetting:"å½ˆå¹•è¨­ç½®",openDanmu:"æ‰“é–‹å½ˆå¹•",reset:"é‡ç½®",opacity:"ä¸é€æ˜Žåº¦",area:"é¡¯ç¤ºå€åŸŸ",speed:"å½ˆå¹•é€Ÿåº¦",fontSize:"å­—é«”å¤§å°",danmuMask:"æ™ºèƒ½æ“‹æ¿",screen0:"1/4å±",screen1:"åŠå±",screen2:"3/4å±",screen3:"å…¨å±",opacity0:"0",opacity1:"1/3",opacity2:"2/3",opacity3:"1",speed0:"0.25",speed1:"0.5",speed2:"æ­£å¸¸",speed3:"1.25",speed4:"1.5",speed5:"2",fontSize0:"æ¥µå°",fontSize1:"é©ä¸­",fontSize2:"æ¥µå¤§"},lang={zh:zh,"zh-cn":zh,en:en,jp:jp,"zh-hk":zhHK},State=function(){function e(t){_classCallCheck$8(this,e),this.curLang="en",this._defaultConfig={opacity:99,area:99,fontSize:50,speed:40,active:!1,usePanel:!0,danmuItems:[],maskConfig:{maskUrl:"",maskOffset:0,interval:200},maskActive:!1,external:[]},Object.assign(this._defaultConfig,t)}return _createClass$9(e,[{key:"updateLang",value:function(e){this.curLang=e,this.curLangMap=lang[e]||lang.en;var t=this.curLangMap;this.sliderItemsProps=[{key:"opacity",name:t.opacity,defaultValue:99,ticks:[{name:t.opacity0,val:0,renderVal:0},{name:t.opacity1,val:33,renderVal:.33},{name:t.opacity2,val:66,renderVal:.66},{name:t.opacity3,val:99,renderVal:1}]},{key:"area",name:t.area,defaultValue:99,ticks:[{name:t.screen0,val:0,renderVal:1/4},{name:t.screen1,val:33,renderVal:.5},{name:t.screen2,val:66,renderVal:3/4},{name:t.screen3,val:99,renderVal:1}]},{key:"speed",name:t.speed,defaultValue:40,ticks:[{name:t.speed0,val:0,renderVal:1/4},{name:t.speed1,val:20,renderVal:.5},{name:t.speed2,val:40,renderVal:1},{name:t.speed3,val:60,renderVal:5/4},{name:t.speed4,val:80,renderVal:1.5},{name:t.speed5,val:100,renderVal:2}]},{key:"fontSize",name:t.fontSize,defaultValue:50,ticks:[{name:t.fontSize0,val:0,renderVal:14},{name:t.fontSize1,val:50,renderVal:16},{name:t.fontSize2,val:100,renderVal:20}]}],this._defaultConfig.external.forEach((function(t){t.name=t.lang[e]||t.lang.en}))}},{key:"getConfig",value:function(){return this._defaultConfig}},{key:"updateConfig",value:function(e){Object.assign(this._defaultConfig,e)}},{key:"updateComments",value:function(e){this._defaultConfig.danmuItems=e}},{key:"getRenderVal",value:function(e,t){var r=this.sliderItemsProps.find((function(t){return t.key===e}))||this.sliderItemsProps[0];return(r.ticks.find((function(e){return e.val===t}))||r.ticks[0]).renderVal}}]),e}(),dist$2={exports:{}};!function(e,t){window,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==_typeof$7(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n={createDom:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=document.createElement(e);return i.className=n,i.innerHTML=t,Object.keys(r).forEach((function(t){var n=t,a=r[t];"video"===e||"audio"===e?a&&i.setAttribute(n,a):i.setAttribute(n,a)})),i},hasClass:function(e,t){return e.classList?Array.prototype.some.call(e.classList,(function(e){return e===t})):!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,t){e.classList?t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(t){t&&e.classList.add(t)})):n.hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){e.classList?t.split(/\s+/g).forEach((function(t){e.classList.remove(t)})):n.hasClass(e,t)&&t.split(/\s+/g).forEach((function(t){var r=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(r," ")}))},toggleClass:function(e,t){t.split(/\s+/g).forEach((function(t){n.hasClass(e,t)?n.removeClass(e,t):n.addClass(e,t)}))},findDom:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,t=arguments[1],r=void 0;try{r=e.querySelector(t)}catch(n){t.startsWith("#")&&(r=e.getElementById(t.slice(1)))}return r},deepCopy:function(e,t){if("Object"===n.typeOf(t)&&"Object"===n.typeOf(e))return Object.keys(t).forEach((function(r){"Object"!==n.typeOf(t[r])||t[r]instanceof Node?"Array"===n.typeOf(t[r])?e[r]="Array"===n.typeOf(e[r])?e[r].concat(t[r]):t[r]:e[r]=t[r]:e[r]?n.deepCopy(e[r],t[r]):e[r]=t[r]})),e},typeOf:function(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]},copyDom:function(e){if(e&&1===e.nodeType){var t=document.createElement(e.tagName);return Array.prototype.forEach.call(e.attributes,(function(e){t.setAttribute(e.name,e.value)})),e.innerHTML&&(t.innerHTML=e.innerHTML),t}return""},formatTime:function(e){var t=Math.floor(e);return 1e3*t+(e-t)},offInDestroy:function(e,t,r,n){e.once(n,(function i(){e.off(t,r),e.off(n,i)}))},on:function(e,t,r,i){i?(e.on(t,r),n.offInDestroy(e,t,r,i)):e.on(t,(function n(i){r(i),e.off(t,n)}))},style:function(e,t,r){var n=e.style;try{n[t]=r}catch(i){n.setProperty(t,r)}}};t.default=n,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(n=r(26))&&n.__esModule?n:{default:n},o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"setLogger",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.logger=new a.default(e+".js")}}]),e}();t.default=o,e.exports=t.default},function(e,t,r){var n=r(19)();e.exports=function(e){return e!==n&&null!==e}},function(e,t,r){e.exports=function(e){return null!=e}},function(e,t,r){e.exports=r(5)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=r(6))&&n.__esModule?n:{default:n};r(34),t.default=i.default,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=d(r(7)),a=d(r(1)),o=d(r(27)),s=d(r(31)),u=d(r(0)),c=r(32),l=r(33);function d(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$7(t)&&"function"!=typeof t?e:t}var f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.setLogger("danmu"),r.logger&&r.logger.info("danmu.js version: "+c.version);var n=r;if(n.config=u.default.deepCopy({overlap:!1,area:{start:0,end:1},live:!1,comments:[],direction:"r2l",needResizeObserver:!1},e),n.hideArr=[],n.domObj=new s.default,(0,i.default)(n),n.config.comments.forEach((function(e){e.duration=e.duration?e.duration:5e3,e.mode||(e.mode="scroll")})),!n.config.container||1!==n.config.container.nodeType)return n.emit("error","container id can't be empty"),h(r,!1);if(n.container=n.config.container,n.config.containerStyle){var a=n.config.containerStyle;Object.keys(a).forEach((function(e){n.container.style[e]=a[e]}))}return n.live=n.config.live,n.player=n.config.player,n.direction=n.config.direction,u.default.addClass(n.container,"danmu"),n.bulletBtn=new o.default(n),n.isReady=!0,n.emit("ready"),r.logger&&r.logger.info("ready"),r.addResizeObserver(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$7(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"addResizeObserver",value:function(){var e=this;this.config.needResizeObserver&&(0,l.addObserver)(this.container,(function(){e.logger&&e.logger.info("needResizeObserver"),e.resize()}))}},{key:"start",value:function(){this.logger&&this.logger.info("start"),this.bulletBtn.main.start()}},{key:"pause",value:function(){this.logger&&this.logger.info("pause"),this.bulletBtn.main.pause()}},{key:"play",value:function(){this.logger&&this.logger.info("play"),this.bulletBtn.main.play()}},{key:"stop",value:function(){this.logger&&this.logger.info("stop"),this.bulletBtn.main.stop()}},{key:"clear",value:function(){this.logger&&this.logger.info("clear"),this.bulletBtn.main.clear()}},{key:"destroy",value:function(){for(var e in(0,l.unObserver)(this.container),this.logger&&this.logger.info("destroy"),this.stop(),this.bulletBtn.destroy(),this.domObj.destroy(),this)delete this[e];this.emit("destroy")}},{key:"sendComment",value:function(e){this.logger&&this.logger.info("sendComment: "+(e.txt||"[DOM Element]")),e.duration||(e.duration=15e3),e&&e.id&&e.duration&&(e.el||e.txt)&&(e.duration=e.duration?e.duration:5e3,e.style||(e.style={opacity:void 0,fontSize:void 0}),e.style&&(this.opacity&&this.opacity!==e.style.opacity&&(e.style.opacity=this.opacity),this.fontSize&&this.fontSize!==e.style.fontSize&&(e.style.fontSize=this.fontSize)),e.prior||e.realTime?(this.bulletBtn.main.data.unshift(e),e.realTime&&(this.bulletBtn.main.readData(),this.bulletBtn.main.dataHandle())):this.bulletBtn.main.data.push(e))}},{key:"setCommentID",value:function(e,t){var r=this;this.logger&&this.logger.info("setCommentID: oldID "+e+" newID "+t);var n=this.container.getBoundingClientRect();e&&t&&(this.bulletBtn.main.data.some((function(r){return r.id===e&&(r.id=t,!0)})),this.bulletBtn.main.queue.some((function(i){return i.id===e&&(i.id=t,i.pauseMove(n),"paused"!==r.bulletBtn.main.status&&i.startMove(n),!0)})))}},{key:"setCommentDuration",value:function(e,t){var r=this;this.logger&&this.logger.info("setCommentDuration: id "+e+" duration "+t);var n=this.container.getBoundingClientRect();e&&t&&(t=t||5e3,this.bulletBtn.main.data.some((function(r){return r.id===e&&(r.duration=t,!0)})),this.bulletBtn.main.queue.some((function(i){return i.id===e&&(i.duration=t,i.pauseMove(n),"paused"!==r.bulletBtn.main.status&&i.startMove(n),!0)})))}},{key:"setCommentLike",value:function(e,t){this.logger&&this.logger.info("setCommentLike: id "+e+" like "+t);var r=this.container.getBoundingClientRect();e&&t&&(this.bulletBtn.main.data.some((function(r){return r.id===e&&(r.like=t,!0)})),this.bulletBtn.main.queue.some((function(n){return n.id===e&&(n.pauseMove(r),n.setLikeDom(t.el,t.style),"paused"!==n.danmu.bulletBtn.main.status&&n.startMove(r),!0)})))}},{key:"restartComment",value:function(e){this.logger&&this.logger.info("restartComment: id "+e),this.mouseControl=!1;var t=this.container.getBoundingClientRect();e&&this.bulletBtn.main.queue.some((function(r){return r.id===e&&("paused"!==r.danmu.bulletBtn.main.status?r.startMove(t,!0):r.status="paused",!0)}))}},{key:"freezeComment",value:function(e){this.logger&&this.logger.info("freezeComment: id "+e),this.mouseControl=!0;var t=this.container.getBoundingClientRect();e&&this.bulletBtn.main.queue.some((function(r){return r.id===e&&(r.status="forcedPause",r.pauseMove(t),r.el&&r.el.style&&u.default.style(r.el,"zIndex",10),!0)}))}},{key:"removeComment",value:function(e){this.logger&&this.logger.info("removeComment: id "+e),e&&(this.bulletBtn.main.queue.some((function(t){return t.id===e&&(t.remove(),!0)})),this.bulletBtn.main.data=this.bulletBtn.main.data.filter((function(t){return t.id!==e})))}},{key:"updateComments",value:function(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&(this.bulletBtn.main.data=[]),this.bulletBtn.main.data=this.bulletBtn.main.data.concat(e)}},{key:"setAllDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",t=arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.logger&&this.logger.info("setAllDuration: mode "+e+" duration "+t+" force "+r);var n=this.container.getBoundingClientRect();t&&(t=t||5e3,r&&(this.bulletBtn.main.forceDuration=t),this.bulletBtn.main.data.forEach((function(r){e===r.mode&&(r.duration=t)})),this.bulletBtn.main.queue.forEach((function(r){e===r.mode&&(r.duration=t,r.pauseMove(n),"paused"!==r.danmu.bulletBtn.main.status&&r.startMove(n))})))}},{key:"setOpacity",value:function(e){this.logger&&this.logger.info("setOpacity: opacity "+e),this.container.style.opacity=e}},{key:"setFontSize",value:function(e,t){var r=this;this.logger&&this.logger.info("setFontSize: size "+e+" channelSize "+t),this.fontSize=e+"px",e&&(this.bulletBtn.main.data.forEach((function(e){e.style&&(e.style.fontSize=r.fontSize)})),this.bulletBtn.main.queue.forEach((function(e){e.options.style||(e.options.style={}),e.options.style.fontSize=r.fontSize,e.setFontSize(r.fontSize),t&&(e.top=e.channel_id[0]*t,e.topInit())}))),t&&(this.config.channelSize=t,this.bulletBtn.main.channel.resize(!0))}},{key:"setArea",value:function(e){this.logger&&this.logger.info("setArea: area "+e),this.config.area=e,this.bulletBtn.main.channel.resize(!0)}},{key:"hide",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";this.logger&&this.logger.info("hide: mode "+e),this.hideArr.indexOf(e)<0&&this.hideArr.push(e),this.bulletBtn.main.queue.filter((function(t){return e===t.mode||"color"===e&&t.color})).forEach((function(e){return e.remove()}))}},{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";this.logger&&this.logger.info("show: mode "+e);var t=this.hideArr.indexOf(e);t>-1&&this.hideArr.splice(t,1)}},{key:"setDirection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"r2l";this.logger&&this.logger.info("setDirection: direction "+e),this.emit("changeDirection",e)}},{key:"resize",value:function(){this.logger&&this.logger.info("resize"),this.emit("channel_resize")}}]),t}(a.default);t.default=f,e.exports=t.default},function(e,t,r){var n,i,a,o,s,u,c,l=r(8),d=r(25),h=Function.prototype.apply,f=Function.prototype.call,p=Object.create,g=Object.defineProperty,y=Object.defineProperties,m=Object.prototype.hasOwnProperty,v={configurable:!0,enumerable:!1,writable:!0};i=function(e,t){var r,i;return d(t),i=this,n.call(this,e,r=function(){a.call(i,e,r),h.call(t,this,arguments)}),r.__eeOnceListener__=t,this},s={on:n=function(e,t){var r;return d(t),m.call(this,"__ee__")?r=this.__ee__:(r=v.value=p(null),g(this,"__ee__",v),v.value=null),r[e]?"object"==_typeof$7(r[e])?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},once:i,off:a=function(e,t){var r,n,i,a;if(d(t),!m.call(this,"__ee__"))return this;if(!(r=this.__ee__)[e])return this;if("object"==_typeof$7(n=r[e]))for(a=0;i=n[a];++a)i!==t&&i.__eeOnceListener__!==t||(2===n.length?r[e]=n[a?0:1]:n.splice(a,1));else n!==t&&n.__eeOnceListener__!==t||delete r[e];return this},emit:o=function(e){var t,r,n,i,a;if(m.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==_typeof$7(i)){for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];for(i=i.slice(),t=0;n=i[t];++t)h.call(n,this,a)}else switch(arguments.length){case 1:f.call(i,this);break;case 2:f.call(i,this,arguments[1]);break;case 3:f.call(i,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];h.call(i,this,a)}}},u={on:l(n),once:l(i),off:l(a),emit:l(o)},c=y({},u),e.exports=t=function(e){return null==e?p(c):y(Object(e),u)},t.methods=s},function(e,t,r){var n=r(3),i=r(9),a=r(13),o=r(21),s=r(22);(e.exports=function(e,t){var r,i,u,c,l;return arguments.length<2||"string"!=typeof e?(c=t,t=e,e=null):c=arguments[2],n(e)?(r=s.call(e,"c"),i=s.call(e,"e"),u=s.call(e,"w")):(r=u=!0,i=!1),l={value:t,configurable:r,enumerable:i,writable:u},c?a(o(c),l):l}).gs=function(e,t,r){var u,c,l,d;return"string"!=typeof e?(l=r,r=t,t=e,e=null):l=arguments[3],n(t)?i(t)?n(r)?i(r)||(l=r,r=void 0):r=void 0:(l=t,t=r=void 0):t=void 0,n(e)?(u=s.call(e,"c"),c=s.call(e,"e")):(u=!0,c=!1),d={get:t,set:r,configurable:u,enumerable:c},l?a(o(l),d):d}},function(e,t,r){var n=r(10),i=/^\s*class[\s{/}]/,a=Function.prototype.toString;e.exports=function(e){return!!n(e)&&!i.test(a.call(e))}},function(e,t,r){var n=r(11);e.exports=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(t){return!1}return!n(e)}},function(e,t,r){var n=r(12);e.exports=function(e){if(!n(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(t){return!1}}},function(e,t,r){var n=r(3),i={object:!0,function:!0,undefined:!0};e.exports=function(e){return!!n(e)&&hasOwnProperty.call(i,_typeof$7(e))}},function(e,t,r){e.exports=r(14)()?Object.assign:r(15)},function(e,t,r){e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,r){var n=r(16),i=r(20),a=Math.max;e.exports=function(e,t){var r,o,s,u=a(arguments.length,2);for(e=Object(i(e)),s=function(n){try{e[n]=t[n]}catch(i){r||(r=i)}},o=1;o<u;++o)n(t=arguments[o]).forEach(s);if(void 0!==r)throw r;return e}},function(e,t,r){e.exports=r(17)()?Object.keys:r(18)},function(e,t,r){e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t,r){var n=r(2),i=Object.keys;e.exports=function(e){return i(n(e)?Object(e):e)}},function(e,t,r){e.exports=function(){}},function(e,t,r){var n=r(2);e.exports=function(e){if(!n(e))throw new TypeError("Cannot use null or undefined");return e}},function(e,t,r){var n=r(2),i=Array.prototype.forEach,a=Object.create,o=function(e,t){var r;for(r in e)t[r]=e[r]};e.exports=function(e){var t=a(null);return i.call(arguments,(function(e){n(e)&&o(Object(e),t)})),t}},function(e,t,r){e.exports=r(23)()?String.prototype.contains:r(24)},function(e,t,r){var n="razdwatrzy";e.exports=function(){return"function"==typeof n.contains&&!0===n.contains("dwa")&&!1===n.contains("foo")}},function(e,t,r){var n=String.prototype.indexOf;e.exports=function(e){return n.call(this,e,arguments[1])>-1}},function(e,t,r){e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i="undefined"!=typeof window&&window.location.href.indexOf("danmu-debug")>-1,a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.constructorName=t||""}return n(e,[{key:"info",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];i&&(t=console).log.apply(t,["[Danmu Log]["+this.constructorName+"]",e].concat(n))}}]),e}();t.default=a,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=s(r(1)),a=s(r(0)),o=s(r(28));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$7(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.setLogger("control"),r.danmu=e,r.main=new o.default(e),e.config.defaultOff||r.main.start(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$7(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"createSwitch",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.logger&&this.logger.info("createSwitch"),this.switchBtn=a.default.createDom("dk-switch",'<span class="txt">å¼¹</span>',{},"danmu-switch "+(e?"danmu-switch-active":"")),this.switchBtn}},{key:"destroy",value:function(){for(var e in this.logger&&this.logger.info("destroy"),this.main.destroy(),this)delete this[e]}}]),t}(i.default);t.default=u,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=u(r(1)),a=u(r(29)),o=u(r(30)),s=u(r(0));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$7(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.setLogger("main"),r.danmu=e,r.container=e.container,r.channel=new a.default(e),r.data=[].concat(e.config.comments),r.playedData=[],r.queue=[],r.timer=null,r.retryTimer=null,r.retryStatus="normal",r.interval=e.config.interval||2e3,r.status="idle",s.default.on(e,"bullet_remove",r.updateQueue.bind(r),"destroy");var n=r;return s.default.on(r.danmu,"changeDirection",(function(e){n.danmu.direction=e}),"destroy"),r.nums=0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$7(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"destroy",value:function(){for(var e in this.logger&&this.logger.info("destroy"),clearTimeout(this.dataHandleTimer),this.channel.destroy(),this.data=[],this)delete this[e]}},{key:"updateQueue",value:function(e){this.logger&&this.logger.info("updateQueue");var t=this;t.queue.some((function(r,n){return r.id===e.bullet.id&&(t.queue.splice(n,1),!0)})),t.data.some((function(t,r){return t.id===e.bullet.id&&(t.hasAttached=!1,!0)}))}},{key:"init",value:function(e,t){t.logger&&t.logger.info("init"),t||(t=this),t.retryStatus="normal",t.data.sort((function(e,t){return e.start-t.start})),t.retryTimer||function e(){"closed"===t.status&&"stop"===t.retryStatus||("playing"===t.status&&(t.readData(),t.dataHandle()),"stop"===t.retryStatus&&"paused"!==t.status||(t.dataHandleTimer=setTimeout((function(){e()}),t.interval-1e3)))}()}},{key:"start",value:function(){this.logger&&this.logger.info("start"),this.status="playing",this.queue=[],this.container.innerHTML="",this.channel.resetWithCb(this.init,this)}},{key:"stop",value:function(){this.logger&&this.logger.info("stop"),this.status="closed",this.retryTimer=null,this.retryStatus="stop",this.channel.reset(),this.queue=[],this.container.innerHTML=""}},{key:"clear",value:function(){this.logger&&this.logger.info("clear"),this.channel.reset(),this.data=[],this.queue=[],this.container.innerHTML=""}},{key:"play",value:function(){var e=this;this.logger&&this.logger.info("play"),this.status="playing";var t=this.channel.channels,r=this.danmu.container.getBoundingClientRect();t&&t.length>0&&["scroll","top","bottom"].forEach((function(n){e.queue.forEach((function(e){e.startMove(r),e.resized=!0}));for(var i=0;i<t.length;i++)t[i].queue[n].forEach((function(e){e.resized=!1}))}))}},{key:"pause",value:function(){this.logger&&this.logger.info("pause"),this.status="paused";var e=this.channel.channels,t=this.danmu.container.getBoundingClientRect();e&&e.length>0&&this.queue.forEach((function(e){e.pauseMove(t)}))}},{key:"dataHandle",value:function(){var e=this;"paused"!==this.status&&"closed"!==this.status&&e.queue.length&&e.queue.forEach((function(t){"waiting"===t.status&&t.startMove(e.channel.containerPos)}))}},{key:"readData",value:function(){var e=this,t=this.danmu;if(t.isReady){var r=0;t.player&&t.player.currentTime&&(r=s.default.formatTime(t.player.currentTime));var n=void 0,i=e.interval,a=e.channel,u=void 0;t.player?(u=e.data.filter((function(t){return!t.start&&e.danmu.hideArr.indexOf(t.mode)<0&&(!t.color||e.danmu.hideArr.indexOf("color")<0)&&(t.start=r),e.danmu.hideArr.indexOf(t.mode)<0&&(!t.color||e.danmu.hideArr.indexOf("color")<0)&&t.start-i<=r&&r<=t.start+i})),t.live&&(e.data=[])):0===(u=e.data.splice(0,1)).length&&(u=e.playedData.splice(0,1)),u.length>0&&u.forEach((function(r){if(e.forceDuration&&e.forceDuration!=r.duration&&(r.duration=e.forceDuration),(n=new o.default(t,r))&&!n.bulletCreateFail)if(r.hasAttached){for(var i in n.detach(),n)delete n[i];n=null,r.hasAttached=!1,r.noDiscard&&(r.prior?e.data.unshift(r):e.data.push(r))}else if(n.attach(),r.hasAttached=!0,a.addBullet(n).result)e.queue.push(n),e.nums++,n.topInit();else{for(var s in n.detach(),n)delete n[s];n=null,r.hasAttached=!1,r.noDiscard&&(r.prior?e.data.unshift(r):e.data.push(r))}}))}}}]),t}(i.default);t.default=c,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=o(r(1)),a=o(r(0));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$7(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.setLogger("channel"),r.danmu=e,r.reset(!0);var n=r;return a.default.on(r.danmu,"bullet_remove",(function(e){n.removeBullet(e.bullet)}),"destroy"),r.direction=e.direction,a.default.on(r.danmu,"changeDirection",(function(e){n.direction=e}),"destroy"),r.containerPos=r.danmu.container.getBoundingClientRect(),r.containerWidth=r.containerPos.width,r.containerHeight=r.containerPos.height,r.containerLeft=r.containerPos.left,r.containerRight=r.containerPos.right,a.default.on(r.danmu,"channel_resize",(function(){n.containerPos=n.danmu.container.getBoundingClientRect(),n.resizing||(n.containerWidth=n.containerPos.width,n.containerHeight=n.containerPos.height,n.containerLeft=n.containerPos.left,n.containerRight=n.containerPos.right,n.resize(!0))}),"destroy"),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$7(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"destroy",value:function(){for(var e in this.logger&&this.logger.info("destroy"),clearTimeout(this.resizeTimer),this.channels=[],this)delete this[e]}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.logger&&this.logger.info("resize");var t=this.danmu.container,r=this;r.resizing||(r.resizing=!0,this.resizeTimer=setTimeout((function(){r.danmu.bulletBtn.main.data&&r.danmu.bulletBtn.main.data.forEach((function(e){e.bookChannelId&&(delete e.bookChannelId,r.logger&&r.logger.info("resizeå¯¼è‡´"+e.id+"å·ä¼˜å…ˆå¼¹å¹•é¢„å®šå–æ¶ˆ"))})),r.logger&&r.logger.info("resizeå¯¼è‡´æ‰€æœ‰è½¨é“æ¢å¤æ­£å¸¸ä½¿ç”¨");var n=t.getBoundingClientRect();r.width=n.width,r.height=n.height,r.danmu.config.area&&r.danmu.config.area.start>=0&&r.danmu.config.area.end>=r.danmu.config.area.start&&("b2t"===r.direction?r.width=r.width*(r.danmu.config.area.end-r.danmu.config.area.start):r.height=r.height*(r.danmu.config.area.end-r.danmu.config.area.start)),r.container=t;var i=r.danmu.config.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12),a=void 0;a="b2t"===r.direction?Math.floor(r.width/i):Math.floor(r.height/i);for(var o=[],s=0;s<a;s++)o[s]={id:s,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};if(r.channels&&r.channels.length<=o.length){for(var u=function(t){o[t]={id:t,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}},["scroll","top"].forEach((function(n){r.channels[t].queue[n].forEach((function(i){i.el&&(o[t].queue[n].push(i),i.resized||(i.pauseMove(r.containerPos,e),"paused"!==i.danmu.bulletBtn.main.status&&i.startMove(r.containerPos),i.resized=!0))}))})),r.channels[t].queue.bottom.forEach((function(n){if(n.el){if(o[t+o.length-r.channels.length].queue.bottom.push(n),n.channel_id[0]+n.channel_id[1]-1===t){var a=[].concat(n.channel_id);n.channel_id=[a[0]-r.channels.length+o.length,a[1]],n.top=n.channel_id[0]*i,r.danmu.config.area&&r.danmu.config.area.start&&(n.top+=r.containerHeight*r.danmu.config.area.start),n.topInit()}n.resized||(n.pauseMove(r.containerPos,e),"paused"!==n.danmu.bulletBtn.main.status&&n.startMove(r.containerPos),n.resized=!0)}}))},c=0;c<r.channels.length;c++)u(c);for(var l=function(e){["scroll","top","bottom"].forEach((function(t){o[e].queue[t].forEach((function(e){e.resized=!1}))}))},d=0;d<o.length;d++)l(d);r.channels=o,"b2t"===r.direction?r.channelWidth=i:r.channelHeight=i}else if(r.channels&&r.channels.length>o.length){for(var h=function(t){o[t]={id:t,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}},["scroll","top","bottom"].forEach((function(n){if("top"===n&&t>Math.floor(o.length/2));else if("bottom"===n&&t<=Math.floor(o.length/2));else{var a="bottom"===n?t-o.length+r.channels.length:t;r.channels[a].queue[n].forEach((function(s,u){if(s.el){if(o[t].queue[n].push(s),"bottom"===n&&s.channel_id[0]+s.channel_id[1]-1===a){var c=[].concat(s.channel_id);s.channel_id=[c[0]-r.channels.length+o.length,c[1]],s.top=s.channel_id[0]*i,r.danmu.config.area&&r.danmu.config.area.start&&(s.top+=r.containerHeight*r.danmu.config.area.start),s.topInit()}s.pauseMove(r.containerPos,e),"paused"!==s.danmu.bulletBtn.main.status&&s.startMove(r.containerPos),s.resized||(s.resized=!0)}r.channels[a].queue[n].splice(u,1)}))}}))},f=0;f<o.length;f++)h(f);for(var p=function(e){["scroll","top","bottom"].forEach((function(t){o[e].queue[t].forEach((function(e){e.resized=!1}))}))},g=0;g<o.length;g++)p(g);r.channels=o,"b2t"===r.direction?r.channelWidth=i:r.channelHeight=i}r.resizing=!1}),10))}},{key:"addBullet",value:function(e){var t=this,r=this.danmu,n=this.channels,i=void 0,a=void 0,o=void 0;if("b2t"===t.direction?(a=this.channelWidth,o=Math.ceil(e.width/a)):(i=this.channelHeight,o=Math.ceil(e.height/i)),o>n.length)return{result:!1,message:"exceed channels.length, occupy="+o+",channelsSize="+n.length};for(var s=!0,u=void 0,c=-1,l=0,d=n.length;l<d;l++)if(n[l].queue[e.mode].some((function(t){return t.id===e.id})))return{result:!1,message:"exsited, channelOrder="+l+",danmu_id="+e.id};if("scroll"===e.mode)for(var h=0,f=n.length-o;h<=f;h++){s=!0;for(var p=h;p<h+o;p++){if((u=n[p]).operating.scroll){s=!1;break}if(u.bookId.scroll&&u.bookId.scroll!==e.id){s=!1;break}u.operating.scroll=!0;var g=u.queue.scroll[0];if(g){var y=g.el.getBoundingClientRect();if("b2t"===t.direction){if(y.bottom>t.containerPos.bottom){s=!1,u.operating.scroll=!1;break}}else if(y.right>t.containerPos.right){s=!1,u.operating.scroll=!1;break}var m,v=void 0,_=void 0,b=void 0,A=void 0;if("b2t"===t.direction?(_=(y.top-t.containerPos.top+y.height)/(v=(t.containerPos.height+y.height)/g.duration),b=t.containerPos.height,A=(t.containerPos.height+e.height)/e.duration):(_=(y.left-t.containerPos.left+y.width)/(v=(t.containerPos.width+y.width)/g.duration),b=t.containerPos.width,A=(t.containerPos.width+e.width)/e.duration),m=b/A,r.config.bOffset||(r.config.bOffset=0),v<A&&_+r.config.bOffset>m){s=!1,u.operating.scroll=!1;break}}u.operating.scroll=!1}if(s){c=h;break}}else if("top"===e.mode)for(var E=0,S=n.length-o;E<=S;E++){s=!0;for(var T=E;T<E+o;T++){if(T>Math.floor(n.length/2)){s=!1;break}if((u=n[T]).operating[e.mode]){s=!1;break}if((u.bookId[e.mode]||e.prior)&&u.bookId[e.mode]!==e.id){s=!1;break}if(u.operating[e.mode]=!0,u.queue[e.mode].length>0){s=!1,u.operating[e.mode]=!1;break}u.operating[e.mode]=!1}if(s){c=E;break}}else if("bottom"===e.mode)for(var w=n.length-o;w>=0;w--){s=!0;for(var C=w;C<w+o;C++){if(C<=Math.floor(n.length/2)){s=!1;break}if((u=n[C]).operating[e.mode]){s=!1;break}if((u.bookId[e.mode]||e.prior)&&u.bookId[e.mode]!==e.id){s=!1;break}if(u.operating[e.mode]=!0,u.queue[e.mode].length>0){s=!1,u.operating[e.mode]=!1;break}u.operating[e.mode]=!1}if(s){c=w;break}}if(-1!==c){for(var k=c,I=c+o;k<I;k++)(u=n[k]).operating[e.mode]=!0,u.queue[e.mode].unshift(e),e.prior&&(delete u.bookId[e.mode],t.logger&&t.logger.info(k+"å·è½¨é“æ¢å¤æ­£å¸¸ä½¿ç”¨")),u.operating[e.mode]=!1;return e.prior&&(t.logger&&t.logger.info(e.id+"å·ä¼˜å…ˆå¼¹å¹•è¿è¡Œå®Œæ¯•"),delete e.bookChannelId,r.player&&r.bulletBtn.main.data.some((function(t){return t.id===e.id&&(delete t.bookChannelId,!0)}))),e.channel_id=[c,o],"b2t"===t.direction?(e.top=c*a,t.danmu.config.area&&t.danmu.config.area.start&&(e.top+=t.containerWidth*t.danmu.config.area.start)):(e.top=c*i,t.danmu.config.area&&t.danmu.config.area.start&&(e.top+=t.containerHeight*t.danmu.config.area.start)),{result:e,message:"success"}}if(e.options.realTime){var $=0,P=-1,x=null;if(t.danmu.bulletBtn.main.queue.forEach((function(e,r){!e.prior&&!e.options.realTime&&e.el&&e.el.getBoundingClientRect().left>t.containerPos.right&&e.start>=$&&($=e.start,P=r,x=e)})),x){x.remove(),t.removeBullet(x),t.danmu.bulletBtn.main.queue.splice(P,1),e.channel_id=x.channel_id;for(var R=x.channel_id[0],O=x.channel_id[0]+x.channel_id[1];R<O;R++)(u=n[R]).operating[e.mode]=!0,u.queue[e.mode].unshift(e),e.prior&&delete u.bookId[e.mode],u.operating[e.mode]=!1;return e.top=x.top,t.danmu.config.area&&t.danmu.config.area.start&&(e.top+=t.containerHeight*t.danmu.config.area.start),{result:e,message:"success"}}}if(e.prior)if(e.bookChannelId||t.danmu.live)r.player&&r.bulletBtn.main.data.some((function(r){return r.id===e.id&&(t.logger&&t.logger.info(e.id+"å·ä¼˜å…ˆå¼¹å¹•å°†äºŽ2ç§’åŽå†æ¬¡è¯·æ±‚æ³¨å†Œ"),r.start+=2e3,!0)}));else{c=-1;for(var D=0,L=n.length-o;D<=L;D++){s=!0;for(var M=D;M<D+o;M++)if(n[M].bookId[e.mode]){s=!1;break}if(s){c=D;break}}if(-1!==c){for(var N=c;N<c+o;N++)n[N].bookId[e.mode]=e.id,t.logger&&t.logger.info(N+"å·è½¨é“è¢«"+e.id+"å·ä¼˜å…ˆå¼¹å¹•é¢„å®š");r.player&&r.bulletBtn.main.data.some((function(r){return r.id===e.id&&(t.logger&&t.logger.info(e.id+"å·ä¼˜å…ˆå¼¹å¹•å°†äºŽ2ç§’åŽå†æ¬¡è¯·æ±‚æ³¨å†Œ"),r.start+=2e3,r.bookChannelId=[c,o],t.logger&&t.logger.info(e.id+"å·ä¼˜å…ˆå¼¹å¹•é¢„å®šäº†"+c+"~"+(c+o-1)+"å·è½¨é“"),!0)}))}}return{result:!1,message:"no surplus will right"}}},{key:"removeBullet",value:function(e){this.logger&&this.logger.info("removeBullet "+(e.options.txt||"[DOM Element]"));for(var t=this.channels,r=e.channel_id,n=void 0,i=r[0],a=r[0]+r[1];i<a;i++)if(n=t[i]){n.operating[e.mode]=!0;var o=-1;n.queue[e.mode].some((function(t,r){return t.id===e.id&&(o=r,!0)})),o>-1&&n.queue[e.mode].splice(o,1),n.operating[e.mode]=!1}e.options.loop&&this.danmu.bulletBtn.main.playedData.push(e.options)}},{key:"resetArea",value:function(){this.logger&&this.logger.info("resetArea");var e=this.danmu.container,t=this,r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.danmu.config.area&&t.danmu.config.area.start>=0&&t.danmu.config.area.end>=t.danmu.config.area.start&&("b2t"===t.direction?t.width=t.width*(t.danmu.config.area.end-t.danmu.config.area.start):t.height=t.height*(t.danmu.config.area.end-t.danmu.config.area.start)),t.container=e;var n=t.danmu.config.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12),i=void 0;i="b2t"===t.direction?Math.floor(t.width/n):Math.floor(t.height/n);for(var a=[],o=0;o<i;o++)a[o]={id:o,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};if(t.channels&&t.channels.length<=a.length){for(var s=function(e){a[e]={id:e,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}},["scroll","top"].forEach((function(r){t.channels[e].queue[r].forEach((function(n){n.el&&(a[e].queue[r].push(n),n.resized||(n.pauseMove(t.containerPos,!1),n.startMove(t.containerPos),n.resized=!0))}))})),t.channels[e].queue.bottom.forEach((function(r){if(r.el){if(a[e+a.length-t.channels.length].queue.bottom.push(r),r.channel_id[0]+r.channel_id[1]-1===e){var i=[].concat(r.channel_id);r.channel_id=[i[0]-t.channels.length+a.length,i[1]],r.top=r.channel_id[0]*n,t.danmu.config.area&&t.danmu.config.area.start&&(r.top+=t.containerHeight*t.danmu.config.area.start),r.topInit()}r.resized||(r.pauseMove(t.containerPos,!1),r.startMove(t.containerPos),r.resized=!0)}}))},u=0;u<t.channels.length;u++)s(u);for(var c=function(e){["scroll","top","bottom"].forEach((function(t){a[e].queue[t].forEach((function(e){e.resized=!1}))}))},l=0;l<a.length;l++)c(l);t.channels=a,"b2t"===t.direction?t.channelWidth=n:t.channelHeight=n}else if(t.channels&&t.channels.length>a.length){for(var d=function(e){a[e]={id:e,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}},["scroll","top","bottom"].forEach((function(r){if("top"===r&&e>Math.floor(a.length/2));else if("bottom"===r&&e<=Math.floor(a.length/2));else{var i="bottom"===r?e-a.length+t.channels.length:e;t.channels[i].queue[r].forEach((function(o,s){if(o.el){if(a[e].queue[r].push(o),"bottom"===r&&o.channel_id[0]+o.channel_id[1]-1===i){var u=[].concat(o.channel_id);o.channel_id=[u[0]-t.channels.length+a.length,u[1]],o.top=o.channel_id[0]*n,t.danmu.config.area&&t.danmu.config.area.start&&(o.top+=t.containerHeight*t.danmu.config.area.start),o.topInit()}o.resized||(o.pauseMove(t.containerPos,!1),o.startMove(t.containerPos),o.resized=!0)}t.channels[i].queue[r].splice(s,1)}))}}))},h=0;h<a.length;h++)d(h);for(var f=function(e){["scroll","top","bottom"].forEach((function(t){a[e].queue[t].forEach((function(e){e.resized=!1}))}))},p=0;p<a.length;p++)f(p);t.channels=a,"b2t"===t.direction?t.channelWidth=n:t.channelHeight=n}}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.logger&&this.logger.info("reset");var t=this.danmu.container,r=this;function n(){var e=t.getBoundingClientRect();r.width=e.width,r.height=e.height,r.danmu.config.area&&r.danmu.config.area.start>=0&&r.danmu.config.area.end>=r.danmu.config.area.start&&("b2t"===r.direction?r.width=r.width*(r.danmu.config.area.end-r.danmu.config.area.start):r.height=r.height*(r.danmu.config.area.end-r.danmu.config.area.start)),r.container=t;var n=r.danmu.config.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12),i=void 0;i="b2t"===r.direction?Math.floor(r.width/n):Math.floor(r.height/n);for(var a=[],o=0;o<i;o++)a[o]={id:o,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};r.channels=a,"b2t"===r.direction?r.channelWidth=n:r.channelHeight=n}r.danmu.bulletBtn&&r.danmu.bulletBtn.main&&r.danmu.bulletBtn.main.queue.forEach((function(e){e.pauseMove(r.containerPos),e.remove()})),r.channels&&r.channels.length>0&&["scroll","top","bottom"].forEach((function(e){for(var t=0;t<r.channels.length;t++)r.channels[t].queue[e].forEach((function(e){e.pauseMove(r.containerPos),e.remove()}))})),r.danmu.bulletBtn&&r.danmu.bulletBtn.main&&r.danmu.bulletBtn.main.data&&r.danmu.bulletBtn.main.data.forEach((function(e){e.hasAttached=!1})),e?this.resetTimer=setTimeout(n,200):n()}},{key:"resetWithCb",value:function(e,t){this.logger&&this.logger.info("resetWithCb");var r=this.danmu.container,n=this;n.channels&&n.channels.length>0&&["scroll","top","bottom"].forEach((function(e){for(var t=0;t<n.channels.length;t++)n.channels[t].queue[e].forEach((function(e){e.pauseMove(n.containerPos),e.remove()}))}));var i=r.getBoundingClientRect();n.width=i.width,n.height=i.height,n.danmu.config.area&&n.danmu.config.area.start>=0&&n.danmu.config.area.end>=n.danmu.config.area.start&&("b2t"===n.direction?n.width=n.width*(n.danmu.config.area.end-n.danmu.config.area.start):n.height=n.height*(n.danmu.config.area.end-n.danmu.config.area.start)),n.container=r;var a=n.danmu.config.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12),o=void 0;o="b2t"===n.direction?Math.floor(n.width/a):Math.floor(n.height/a);for(var s=[],u=0;u<o;u++)s[u]={id:u,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};n.channels=s,n.channelHeight=a,e&&e(!0,t)}}]),t}(i.default);t.default=s,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=o(r(1)),a=o(r(0));function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$7(t)&&"function"!=typeof t?e:t}var u=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));n.setLogger("bullet"),n.danmu=e,n.options=r,n.duration=r.duration,n.moveV=r.moveV,n.id=r.id,n.container=e.container,n.start=r.start,n.prior=r.prior,n.color=r.color,n.bookChannelId=r.bookChannelId,n.direction=e.direction,n.reuseDOM=!0;var i=n,o=void 0;if(n.domObj=e.domObj,r.el&&1===r.el.nodeType){if(r.el.parentNode)return s(n,{bulletCreateFail:!0});if(e.config.disableCopyDOM)o=r.el,n.reuseDOM=!1;else{o=n.domObj.use();var u=a.default.copyDom(r.el);r.eventListeners&&r.eventListeners.length>0&&r.eventListeners.forEach((function(e){u.addEventListener(e.event,e.listener,e.useCapture||!1)})),o.appendChild(u)}}else(o=n.domObj.use()).textContent=r.txt;if(n.onChangeDirection=function(e){i.direction=e},n.danmu.on("changeDirection",n.onChangeDirection),r.style){var c=r.style;Object.keys(c).forEach((function(e){a.default.style(o,e,c[e])}))}"top"===r.mode||"bottom"===r.mode?n.mode=r.mode:n.mode="scroll",n.el=o,r.like&&r.like.el&&n.setLikeDom(r.like.el,r.like.style),n.status="waiting";var l=n.container.getBoundingClientRect(),d=Math.floor(Math.random()*(l.width/10>100?200:l.width/10));r.realTime&&(d=0);var h=l.width+d+"px";return a.default.style(n.el,"left",h),n.containerPos=l,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$7(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"attach",value:function(){if(this.container.appendChild(this.el),this.elPos=this.el.getBoundingClientRect(),"b2t"===this.direction?(this.width=this.elPos.height,this.height=this.elPos.width):(this.width=this.elPos.width,this.height=this.elPos.height),this.moveV){var e=this.containerPos;this.duration=(e.width+this.width)/this.moveV*1e3}this.danmu.config&&this.danmu.config.mouseControl&&(this.mouseoverFunWrapper=this.mouseoverFun.bind(this),this.el.addEventListener("mouseover",this.mouseoverFunWrapper,!1)),this.danmu.config&&this.danmu.config.mouseEnterControl&&(this.mouseEnterFunWrapper=this.mouseoverFun.bind(this),this.el.addEventListener("mouseenter",this.mouseEnterFunWrapper,!1))}},{key:"mouseoverFun",value:function(e){this.danmu&&this.danmu.mouseControl&&this.danmu.config.mouseControlPause||"waiting"===this.status||"end"===this.status||this.danmu&&this.danmu.emit("bullet_hover",{bullet:this,event:e})}},{key:"detach",value:function(){this.el&&(this.danmu.config&&this.danmu.config.mouseControl&&this.el.removeEventListener("mouseover",this.mouseoverFunWrapper,!1),this.danmu.config&&this.danmu.config.mouseEnterControl&&this.el.removeEventListener("mouseenter",this.mouseEnterFunWrapper,!1),this.el.parentNode&&this.el.parentNode.removeChild(this.el),this.reuseDOM&&this.domObj.unuse(this.el),this.el=null),this.danmu.off("changeDirection",this.onChangeDirection)}},{key:"topInit",value:function(){if(this.logger&&this.logger.info("topInit #"+(this.options.txt||"[DOM Element]")+"#"),"b2t"===this.direction){var e=this.containerPos;a.default.style(this.el,"transformOrigin","left top"),a.default.style(this.el,"transform","translateX(-"+this.top+"px) translateY("+e.height+"px) translateZ(0px) rotate(90deg)"),a.default.style(this.el,"transition","transform 0s linear 0s")}else a.default.style(this.el,"top",this.top+"px")}},{key:"pauseMove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.logger&&this.logger.info("pauseMove #"+(this.options.txt||"[DOM Element]")+"#");var r=this;if("paused"!==this.status&&("forcedPause"!==r.status&&(this.status="paused"),clearTimeout(r.removeTimer),this.el))if(a.default.style(this.el,"willChange","auto"),"scroll"===this.mode){if(t){var n=((new Date).getTime()-r.moveTime)/1e3*this.moveV,i=0;i=r.moveMoreS-n>=0?"b2t"===this.direction?(r.moveMoreS-n)/r.moveContainerHeight*e.height:(r.moveMoreS-n)/r.moveContainerWidth*e.width:r.moveMoreS-n,"b2t"===this.direction?a.default.style(this.el,"transform","translateX(-"+this.top+"px) translateY("+i+"px) translateZ(0px) rotate(90deg)"):a.default.style(this.el,"left",i+"px")}else"b2t"===this.direction?a.default.style(this.el,"transform","translateX(-"+this.top+"px) translateY("+(this.el.getBoundingClientRect().top-e.top)+"px) translateZ(0px) rotate(90deg)"):a.default.style(this.el,"left",this.el.getBoundingClientRect().left-e.left+"px");"b2t"===this.direction||a.default.style(this.el,"transform","translateX(0px) translateY(0px) translateZ(0px)"),a.default.style(this.el,"transition","transform 0s linear 0s")}else this.pastDuration&&this.startTime?this.pastDuration=this.pastDuration+(new Date).getTime()-this.startTime:this.pastDuration=1}},{key:"startMove",value:function(e,t){this.logger&&this.logger.info("startMove #"+(this.options.txt||"[DOM Element]")+"#");var r=this;if(r.hasMove||(r.danmu.emit("bullet_start",r),r.hasMove=!0),("forcedPause"!==r.status||t)&&this.el&&"start"!==this.status)if(this.status="start",a.default.style(this.el,"willChange","transform"),"scroll"===this.mode)if("b2t"===this.direction){this.moveV=(e.height+this.height)/this.duration*1e3;var n=(r.el.getBoundingClientRect().bottom-e.top)/this.moveV;a.default.style(this.el,"transition","transform "+n+"s linear 0s"),this.startMoveTimer=setTimeout((function(){r.el&&(a.default.style(r.el,"transform","translateX(-"+r.top+"px) translateY(-"+r.height+"px) translateZ(0px) rotate(90deg)"),r.moveTime=(new Date).getTime(),r.moveMoreS=r.el.getBoundingClientRect().top-e.top,r.moveContainerHeight=e.height,r.removeTimer=setTimeout(u,1e3*n))}),20)}else{var i=this.el.getBoundingClientRect();this.moveV=(e.width+this.width)/this.duration*1e3;var o=(i.right-e.left)/this.moveV;a.default.style(this.el,"transition","transform "+o+"s linear 0s"),this.startMoveTimer=setTimeout((function(){if(r.el){var t=r.el.getBoundingClientRect(),n=(t.right-e.left)/o;t.right>e.left&&n>r.moveV-1&&n<r.moveV+1?(a.default.style(r.el,"transform","translateX(-"+(t.right-e.left)+"px) translateY(0px) translateZ(0px)"),r.moveTime=(new Date).getTime(),r.moveMoreS=t.left-e.left,r.moveContainerWidth=e.width,r.removeTimer=setTimeout(u,1e3*o)):(r.status="end",r.remove())}}),0)}else{a.default.style(this.el,"left","50%"),a.default.style(this.el,"margin","0 0 0 -"+this.width/2+"px"),this.pastDuration||(this.pastDuration=1);var s=this.duration>=this.pastDuration?this.duration-this.pastDuration:0;this.removeTimer=setTimeout(u,s),this.startTime=(new Date).getTime()}function u(){if(r.el)if("scroll"===r.mode){var e=r.containerPos,t=r.el.getBoundingClientRect();"b2t"===r.direction?t&&t.bottom<=e.top+100?(r.status="end",r.remove()):(r.pauseMove(e),"paused"!==r.danmu.bulletBtn.main.status&&r.startMove(e)):t&&t.right<=e.left+100?(r.status="end",r.remove()):(r.pauseMove(e),"paused"!==r.danmu.bulletBtn.main.status&&r.startMove(e))}else r.status="end",r.remove()}}},{key:"remove",value:function(){this.logger&&this.logger.info("remove #"+(this.options.txt||"[DOM Element]")+"#"),this.removeTimer&&clearTimeout(this.removeTimer),this.startMoveTimer&&clearTimeout(this.startMoveTimer),this.el&&this.el.parentNode&&(a.default.style(this.el,"willChange","auto"),this.detach(),this.options.el&&1===this.options.el.nodeType&&this.danmu.config.disableCopyDOM&&a.default.style(this.options.el,"transform","none"),this.danmu.emit("bullet_remove",{bullet:this}))}},{key:"setFontSize",value:function(e){this.el&&(this.el.style.fontSize=e)}},{key:"setLikeDom",value:function(e,t){if(e&&(Object.keys(t).forEach((function(r){e.style[r]=t[r]})),e.className="danmu-like",this.el)){var r=this.el.querySelector(".danmu-like");r&&this.el.removeChild(r),this.el.innerHTML=""+this.el.innerHTML+e.outerHTML}return e}}]),t}(i.default);t.default=u,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(n=r(0))&&n.__esModule?n:{default:n},o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t={initDOM:function(){return document.createElement("div")},initSize:10},this.init(t)}return i(e,[{key:"init",value:function(e){this.idleList=[],this.usingList=[],this._id=0,this.options=e,this._expand(e.initSize)}},{key:"use",value:function(){this.idleList.length||this._expand(1);var e=this.idleList.shift();return this.usingList.push(e),e}},{key:"unuse",value:function(e){var t=this.usingList.indexOf(e);t<0||(this.usingList.splice(t,1),e.innerHTML="",e.textcontent="",this.clearElementStyle(e),this.idleList.push(e))}},{key:"_expand",value:function(e){for(var t=0;t<e;t++)this.idleList.push(this.options.initDOM(this._id++))}},{key:"destroy",value:function(){for(var e=0;e<this.idleList.length;e++)this.idleList[e].innerHTML="",this.idleList[e].textcontent="",this.clearElementStyle(this.idleList[e]);for(var t=0;t<this.usingList.length;t++)this.usingList[t].innerHTML="",this.usingList[t].textcontent="",this.clearElementStyle(this.usingList[t]);for(var r in this)delete this[r]}},{key:"clearElementStyle",value:function(e){var t="undefined"!=typeof window?window.navigator.userAgent:null;t&&(t.indexOf("MSIE ")>-1||t.indexOf("Trident/")>-1?a.default.style(e,"transform","none"):e.setAttribute("style",""))}}]),e}();t.default=o,e.exports=t.default},function(e){e.exports=JSON.parse('{"version":"0.6.3"}')},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=new(function(){function e(){var t=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.__handlers=[],window.ResizeObserver)try{this.observer=new window.ResizeObserver((function(e){var r=(new Date).getTime();r-t.timeStampe<200||(t.timeStampe=r,t.__trigger(e))})),this.timeStampe=(new Date).getTime()}catch(r){}}return n(e,[{key:"addObserver",value:function(e,t){if(this.observer){this.observer&&this.observer.observe(e);for(var r=this.__handlers,n=-1,i=0;i<r.length;i++)r[i]&&e===r[i].target&&(n=i);n>-1?this.__handlers[n].handler.push(t):this.__handlers.push({target:e,handler:[t]})}}},{key:"unObserver",value:function(e){var t=-1;this.__handlers.map((function(r,n){e===r.target&&(t=n)})),this.observer&&this.observer.unobserve(e),t>-1&&this.__handlers.splice(t,1)}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(e){for(var t=this.__handlers,r=0;r<t.length;r++)if(t[r]&&e===t[r].target){t[r].handler&&t[r].handler.map((function(e){try{e()}catch(t){console.error(t)}}));break}}},{key:"__trigger",value:function(e){var t=this;e.map((function(e){t.__runHandler(e.target)}))}}]),e}());t.addObserver=function(e,t){i.addObserver(e,t)},t.unObserver=function(e,t){i.unObserver(e,t)},t.destroyObserver=function(e,t){i.destroyObserver(e,t)}},function(e,t,r){var n=r(35);"string"==typeof n&&(n=[[e.i,n,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};r(37)(n,i),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(36)(!1)).push([e.i,".danmu{overflow:hidden;-webkit-user-select:none;-moz-user-select:none;user-select:none;-ms-user-select:none}.danmu>*{position:absolute;white-space:nowrap}.danmu-switch{width:32px;height:20px;border-radius:100px;background-color:#ccc;-webkit-box-sizing:border-box;box-sizing:border-box;outline:none;cursor:pointer;position:relative;text-align:center;margin:10px auto}.danmu-switch.danmu-switch-active{padding-left:12px;background-color:#f85959}.danmu-switch span.txt{width:20px;height:20px;line-height:20px;text-align:center;display:block;border-radius:100px;background-color:#ffffff;-webkit-box-shadow:-2px 0 0 0 rgba(0, 0, 0, .04);box-shadow:-2px 0 0 0 rgba(0, 0, 0, .04);font-family:PingFangSC;font-size:10px;font-weight:500;color:#f44336}\n",""])},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r=function(e,t){var r,n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var a=(r=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),o=i.sources.map((function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"}));return[n].concat(o).concat([a]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+r+"}":r})).join("")},t.i=function(e,r){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},i=0;i<this.length;i++){var a=this[i][0];"number"==typeof a&&(n[a]=!0)}for(i=0;i<e.length;i++){var o=e[i];"number"==typeof o[0]&&n[o[0]]||(r&&!o[2]?o[2]=r:r&&(o[2]="("+o[2]+") and ("+r+")"),t.push(o))}},t}},function(e,t,r){var n,i,a,o={},s=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===i&&(i=n.apply(this,arguments)),i}),u=function(e){return document.querySelector(e)},c=(a={},function(e){if("function"==typeof e)return e();if(void 0===a[e]){var t=u.call(this,e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(r){t=null}a[e]=t}return a[e]}),l=null,d=0,h=[],f=r(38);function p(e,t){for(var r=0;r<e.length;r++){var n=e[r],i=o[n.id];if(i){i.refs++;for(var a=0;a<i.parts.length;a++)i.parts[a](n.parts[a]);for(;a<n.parts.length;a++)i.parts.push(b(n.parts[a],t))}else{var s=[];for(a=0;a<n.parts.length;a++)s.push(b(n.parts[a],t));o[n.id]={id:n.id,refs:1,parts:s}}}}function g(e,t){for(var r=[],n={},i=0;i<e.length;i++){var a=e[i],o=t.base?a[0]+t.base:a[0],s={css:a[1],media:a[2],sourceMap:a[3]};n[o]?n[o].parts.push(s):r.push(n[o]={id:o,parts:[s]})}return r}function y(e,t){var r=c(e.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=h[h.length-1];if("top"===e.insertAt)n?n.nextSibling?r.insertBefore(t,n.nextSibling):r.appendChild(t):r.insertBefore(t,r.firstChild),h.push(t);else if("bottom"===e.insertAt)r.appendChild(t);else{if("object"!=_typeof$7(e.insertAt)||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=c(e.insertInto+" "+e.insertAt.before);r.insertBefore(t,i)}}function m(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=h.indexOf(e);t>=0&&h.splice(t,1)}function v(e){var t=document.createElement("style");return void 0===e.attrs.type&&(e.attrs.type="text/css"),_(t,e.attrs),y(e,t),t}function _(e,t){Object.keys(t).forEach((function(r){e.setAttribute(r,t[r])}))}function b(e,t){var r,n,i,a,o,s;if(t.transform&&e.css){if(!(a=t.transform(e.css)))return function(){};e.css=a}if(t.singleton){var u=d++;r=l||(l=v(t)),n=S.bind(null,r,u,!1),i=S.bind(null,r,u,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(o=t,s=document.createElement("link"),void 0===o.attrs.type&&(o.attrs.type="text/css"),o.attrs.rel="stylesheet",_(s,o.attrs),y(o,s),r=s,n=w.bind(null,r,t),i=function(){m(r),r.href&&URL.revokeObjectURL(r.href)}):(r=v(t),n=T.bind(null,r),i=function(){m(r)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else i()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=("undefined"==typeof document?"undefined":_typeof$7(document)))throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==_typeof$7(t.attrs)?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=s()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var r=g(e,t);return p(r,t),function(e){for(var n=[],i=0;i<r.length;i++){var a=r[i];(s=o[a.id]).refs--,n.push(s)}for(e&&p(g(e,t),t),i=0;i<n.length;i++){var s;if(0===(s=n[i]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete o[s.id]}}}};var A,E=(A=[],function(e,t){return A[e]=t,A.filter(Boolean).join("\n")});function S(e,t,r,n){var i=r?"":n.css;if(e.styleSheet)e.styleSheet.cssText=E(t,i);else{var a=document.createTextNode(i),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(a,o[t]):e.appendChild(a)}}function T(e,t){var r=t.css,n=t.media;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}function w(e,t,r){var n=r.css,i=r.sourceMap,a=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||a)&&(n=f(n)),i&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var o=new Blob([n],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(o),s&&URL.revokeObjectURL(s)}},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var r=t.protocol+"//"+t.host,n=r+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var i,a=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(a)?e:(i=0===a.indexOf("//")?a:0===a.indexOf("/")?r+a:n+a.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")}))}}])}(dist$2);var DanmuJs=getDefaultExportFromCjs(dist$2.exports),NormalSpeed=1e4,Container=function(){function e(t){_classCallCheck$8(this,e),this.state=t,this.root=util$2.createDom("xg-danmu"),helpers.addClass(this.root,"xgplayer-danmu-container")}var t;return _createClass$9(e,[{key:"initDanmuContainer",value:function(){var e=this.state.getConfig(),t=e.opacity,r=void 0===t?1:t,n=e.fontSize,i=void 0===n?16:n,a=e.area,o=void 0===a?1:a,s=e.danmuItems,u=void 0===s?[]:s,c=e.active,l=e.speed,d=void 0===l?40:l,h=(c?u:[]).map((function(e){return!e.style&&(e.style={}),e})),f={container:this.root,comments:h,live:!1,area:{start:0,end:this.state.getRenderVal("area",o)}};this.danmuJs=new DanmuJs(f),this.setOpacity(this.state.getRenderVal("opacity",r)),this.setFontSize(this.state.getRenderVal("fontSize",i)),this.setSpeed(this.state.getRenderVal("speed",d))}},{key:"start",value:function(){this.danmuJs.start()}},{key:"pause",value:function(){this.danmuJs.pause()}},{key:"play",value:function(){this.danmuJs.play()}},{key:"stop",value:function(){this.danmuJs.stop()}},{key:"resize",value:function(){this.danmuJs.resize()}},{key:"sendDanmu",value:function(e){this.state.getConfig().active&&this.danmuJs.sendComment(e)}},{key:"clear",value:function(){this.danmuJs.clear()}},{key:"setProperty",value:function(e,t){return"opacity"===e?this.setOpacity(this.state.getRenderVal(e,t)):"area"===e?this.setArea(this.state.getRenderVal(e,t)):"speed"===e?this.setSpeed(this.state.getRenderVal(e,t)):"fontSize"===e?this.setFontSize(this.state.getRenderVal(e,t)):void 0}},{key:"setOpacity",value:function(e){this.danmuJs.setOpacity(e)}},{key:"setFontSize",value:function(e){this.danmuJs.setFontSize(e)}},{key:"setArea",value:function(e){this.danmuJs.setArea({start:0,end:this.state.getRenderVal("area",e)})}},{key:"setSpeed",value:function(e){this.danmuJs.setAllDuration("scroll",NormalSpeed/e)}},{key:"destroy",value:(t=_asyncToGenerator$7(_regeneratorRuntime$5().mark((function e(){return _regeneratorRuntime$5().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.danmuJs){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.danmuJs.stop();case 4:return e.next=6,this.danmuJs.destroy();case 6:this.danmuJs=null,this.root.parentNode.removeChild(this.root),this.root=null;case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),Panel=function(){function e(t){_classCallCheck$8(this,e),this.state=t,this.root=document.createElement("div"),helpers.addClass(this.root,"panel-box"),helpers.addEventListener(this.root,"click",(function(e){e.stopPropagation()}))}return _createClass$9(e,[{key:"destroy",value:function(){this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.root=null}}]),e}(),Switch=function(){function e(t){_classCallCheck$8(this,e),this.callback=function(){},this.key=t.key,this.name=t.name,this.value=t.value,this.root=document.createElement("div"),helpers.addClass(this.root,"xg-player-switch-wrapper"),this.render()}return _createClass$9(e,[{key:"render",value:function(){var e=this;if(!this.root.childNodes.length){var t=document.createElement("div");this.$left=t,helpers.addClass(t,"left"),t.innerHTML=this.name;var r=document.createElement("div");this.$right=r,helpers.addClass(r,"right"),r.innerHTML='<label class="switch">\n    <input type="checkbox">\n    <span class="slider round"></span>\n  </label>',this.root.appendChild(t),this.root.appendChild(r);var n=this.$right.querySelector("input");helpers.addEventListener(this.$right,"click",debounce$2((function(t){t.stopPropagation(),e.value=!e.value,e.value?null==n||n.setAttribute("checked","checked"):null==n||n.removeAttribute("checked"),e.callback(e.value)}),50))}var i=this.$right.querySelector("input");this.value?null==i||i.setAttribute("checked","checked"):i.removeAttribute("checked"),i.checked=this.value}},{key:"renderName",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$left.innerHTML=e}},{key:"onChange",value:function(e){this.callback=e}}]),e}(),dist$1={exports:{}};!function(e,t){window,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==_typeof$7(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=10)}([function(e,t,r){var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=_typeof$7(r))throw new TypeError(r+"must be non-object");for(var n in r)i(r,n)&&(e[n]=r[n])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){var t,r,n,i,a,o;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(o=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)a=e[t],o.set(a,i),i+=a.length;return o}},o={arraySet:function(e,t,r,n,i){for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(n)},function(e,t,r){var n=r(23)();e.exports=function(e){return e!==n&&null!==e}},function(e,t,r){e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,r){var n,i,a,o,s,u,c,l=r(12),d=r(29),h=Function.prototype.apply,f=Function.prototype.call,p=Object.create,g=Object.defineProperty,y=Object.defineProperties,m=Object.prototype.hasOwnProperty,v={configurable:!0,enumerable:!1,writable:!0};i=function(e,t){var r,i;return d(t),i=this,n.call(this,e,r=function(){a.call(i,e,r),h.call(t,this,arguments)}),r.__eeOnceListener__=t,this},s={on:n=function(e,t){var r;return d(t),m.call(this,"__ee__")?r=this.__ee__:(r=v.value=p(null),g(this,"__ee__",v),v.value=null),r[e]?"object"==_typeof$7(r[e])?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},once:i,off:a=function(e,t){var r,n,i,a;if(d(t),!m.call(this,"__ee__"))return this;if(!(r=this.__ee__)[e])return this;if("object"==_typeof$7(n=r[e]))for(a=0;i=n[a];++a)i!==t&&i.__eeOnceListener__!==t||(2===n.length?r[e]=n[a?0:1]:n.splice(a,1));else n!==t&&n.__eeOnceListener__!==t||delete r[e];return this},emit:o=function(e){var t,r,n,i,a;if(m.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==_typeof$7(i)){for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];for(i=i.slice(),t=0;n=i[t];++t)h.call(n,this,a)}else switch(arguments.length){case 1:f.call(i,this);break;case 2:f.call(i,this,arguments[1]);break;case 3:f.call(i,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];h.call(i,this,a)}}},u={on:l(n),once:l(i),off:l(a),emit:l(o)},c=y({},u),e.exports=t=function(e){return null==e?p(c):y(Object(e),u)},t.methods=s},function(e,t,r){e.exports=function(e){return null!=e}},function(e,t,r){e.exports=function(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{a=a+(i=i+t[n++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},function(e,t,r){var n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();e.exports=function(e,t,r,i){var a=n,o=i+r;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},function(e,t,r){var n=r(0),i=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(c){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(c){a=!1}for(var o=new n.Buf8(256),s=0;s<256;s++)o[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function u(e,t){if(t<65534&&(e.subarray&&a||!e.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var r="",o=0;o<t;o++)r+=String.fromCharCode(e[o]);return r}o[254]=o[254]=1,t.string2buf=function(e){var t,r,i,a,o,s=e.length,u=0;for(a=0;a<s;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(i=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(i-56320),a++),u+=r<128?1:r<2048?2:r<65536?3:4;for(t=new n.Buf8(u),o=0,a=0;o<u;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(i=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(i-56320),a++),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},t.buf2binstring=function(e){return u(e,e.length)},t.binstring2buf=function(e){for(var t=new n.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t},t.buf2string=function(e,t){var r,n,i,a,s=t||e.length,c=new Array(2*s);for(n=0,r=0;r<s;)if((i=e[r++])<128)c[n++]=i;else if((a=o[i])>4)c[n++]=65533,r+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&r<s;)i=i<<6|63&e[r++],a--;a>1?c[n++]=65533:i<65536?c[n++]=i:(i-=65536,c[n++]=55296|i>>10&1023,c[n++]=56320|1023&i)}return u(c,n)},t.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+o[e[r]]>t?r:t}},function(e,t,r){e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,r){e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,r){e.exports=r(11)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=f(r(3)),a=f(r(30)),o=f(r(31)),s=f(r(32)),u=r(33),c=f(r(34)),l=f(r(43)),d=f(r(44)),h=r(46);function f(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(0,i.default)(this),this.url=t.url,this.player=t.player,this.aheadTime=parseFloat(localStorage.getItem("danmuMaskAheadTime"))||t.aheadTime||0,this.originStart=parseFloat(t.originStart)||0,this.interval=parseFloat(localStorage.getItem("danmuMaskInterval"))||t.interval||o.default.DEFAULT_INTERVAL,this.metaDataAreaLength=o.default.VERSION_LENGTH+o.default.INDEX_LENGTH+o.default.RESERVE_LENGTH,(0,u.log)("DanmuMask NPM Version: ",h.version),(0,u.log)("DanmuMask Config: ",t),this.searchFrameWorker=new d.default,this.searchFrameWorker.onmessage=function(e){if("searchResult"===e.data.method){var t=e.data.args;r.setDanmuMask(t.svgData||"")}else if("getData"===e.data.method){var n=e.data.args;r.getData(r.url,n.range).then((function(e){r.parseSvgData(n.index,e),r.searchFrameWorker.postMessage({method:"updateDataListItem",args:{index:n.index,key:"download",value:!0}})}))}}}return n(e,[{key:"init",value:function(){var e=this;(0,u.log)("DanmuMask init");var t=this;this.dataList=[],this.danmuEl=this.player.root.querySelector("xg-danmu"),this.danmuEl||(this.danmuEl=this.player.root.querySelector("xg-bullet")),this.danmuEl.style["-webkit-mask-position"]="center",this.danmuEl.style["-webkit-box-direction"]="normal",this.danmuEl.style["-webkit-mask-size"]="100% 100%";var r=this.player.root.getBoundingClientRect();this.containerWidth=r.width,this.containerHeight=r.height,this.getData(this.url,[0,this.metaDataAreaLength-1]).then((function(r){var n=new s.default(r);e.protocolVersion=n.readUint8(),e.indexAreaByteLength=n.readBigEnd(4),(0,u.log)("DanmuMask this.protocolVersion: ",e.protocolVersion),(0,u.log)("DanmuMask this.indexAreaByteLength: ",e.indexAreaByteLength),e.dataAreaBase=0,e.getData(e.url,[e.metaDataAreaLength,e.metaDataAreaLength+e.indexAreaByteLength-1]).then((function(r){var n=new s.default(r);e.indexByteStep=8,e.indexCount=e.indexAreaByteLength/e.indexByteStep;for(var i=n.readBigEnd(8)+e.dataAreaBase,a=void 0,c=0;c<e.indexCount;c++)a=c<e.indexCount-1?n.readBigEnd(8)+e.dataAreaBase:0,e.dataList.push({idx:c,timeStart:c*o.default.DURATION_STEP,timeEnd:(c+1)*o.default.DURATION_STEP,dataStart:i,dataEnd:a-1,download:!1,currentFrame:-1}),i=a;e.searchFrameWorker.postMessage({method:"updateData",args:{dataList:e.dataList,indexCount:e.indexCount}}),e.player.stopDanmuMaskTimer=function(){(0,u.log)("DanmuMask stopDanmuMaskTimer"),t.timer&&(t.timer.clear(),t.timer=null)},e.player.startDanmuMaskTimer=function(){(0,u.log)("DanmuMask startDanmuMaskTimer"),t.timer||(t.timer=new l.default,t.timer.repeat(t.timeupdateFunc.bind(t),t.interval))},e.player.onDanmuMaskSeeked=function(){e.searchFrameWorker.postMessage({method:"onDanmuMaskSeeked"})},t.player.startDanmuMaskTimer(),["ended","pause","error"].forEach((function(r){e.player.on(r,t.player.stopDanmuMaskTimer)})),["play","playing"].forEach((function(r){e.player.on(r,t.player.startDanmuMaskTimer)})),e.player.on("seeked",t.player.onDanmuMaskSeeked)}))}))}},{key:"timeupdateFunc",value:function(){var e=this.player.currentTime+this.originStart-this.aheadTime;this.searchFrameWorker.postMessage({method:"searchFrame",args:{currentTime:e}})}},{key:"getData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=this;return new Promise((function(n){var i=new a.default(e,t,n);i.once("error",(function(e){r.player.emit("error",e)})),i.once("progress_event",(function(e){r.player.emit("progress_event",e)}))}))}},{key:"setContainerSize",value:function(e,t){(0,u.log)("DanmuMask setContainerSize: ",e,t),this.containerWidth=e,this.containerHeight=t}},{key:"setDanmuMask",value:function(e){if((0,u.log)("DanmuMask setDanmuMask"),e){var t=this.player.video;this.containerWidth/this.containerHeight>=t.videoWidth/t.videoHeight?(this.topRatio=0,this.bottomRatio=100,this.leftRatio=100*(1-t.videoWidth*this.containerHeight/t.videoHeight/this.containerWidth)/2,this.rightRatio=100-this.leftRatio):(this.topRatio=100*(1-t.videoHeight*this.containerWidth/t.videoWidth/this.containerHeight)/2,this.bottomRatio=100-this.topRatio,this.leftRatio=0,this.rightRatio=100);var r="linear-gradient(rgb(0, 0, 0), rgb(0, 0, 0) "+this.topRatio+"%, rgba(0, 0, 0, 0) "+this.topRatio+"%), linear-gradient(rgba(0, 0, 0, 0) "+this.bottomRatio+"%, rgb(0, 0, 0) "+this.bottomRatio+"%, rgb(0, 0, 0)), linear-gradient(to right, rgb(0, 0, 0), rgb(0, 0, 0) "+this.leftRatio+"%, rgba(0, 0, 0, 0) "+this.leftRatio+"%), linear-gradient(to right, rgba(0, 0, 0, 0) "+this.rightRatio+"%, rgb(0, 0, 0) "+this.rightRatio+'%, rgb(0, 0, 0)),url("data:image/svg+xml;base64,'+e+'")';this.danmuEl.style["-webkit-mask-image"]=r,this.danmuEl.style["mask-image"]=r}else{var n="linear-gradient(rgb(0, 0, 0), rgb(0, 0, 0) 0%, rgba(0, 0, 0) 0%), linear-gradient(rgba(0, 0, 0) 100%, rgb(0, 0, 0) 100%, rgb(0, 0, 0)), linear-gradient(to right, rgb(0, 0, 0), rgb(0, 0, 0) 0%, rgba(0, 0, 0) 0%), linear-gradient(to right, rgba(0, 0, 0) 100%, rgb(0, 0, 0) 100%, rgb(0, 0, 0))";this.danmuEl.style["-webkit-mask-image"]=n,this.danmuEl.style["mask-image"]=n}}},{key:"parseSvgData",value:function(e,t){try{var r=c.default.inflate(t);(0,u.log)("DanmuMask output: ",r);for(var n=new s.default(r.buffer),i=[];n.position<r.byteLength-1;){var a={};a.dataPts=n.readBigEnd(8),a.dataSvgLength=n.readBigEnd(4),a.dataSvgBase64="";for(var o=0;o<a.dataSvgLength;o++)a.dataSvgBase64+=String.fromCharCode(n.readUint8());a.dataSvgBase64=window.btoa(a.dataSvgBase64),i.push(a)}this.searchFrameWorker.postMessage({method:"updateDataListItem",args:{index:e,key:"data",value:r}}),this.searchFrameWorker.postMessage({method:"updateDataListItem",args:{index:e,key:"frameList",value:i}}),(0,u.log)("DanmuMask frameList: ",i)}catch(l){(0,u.log)("DanmuMask zlib inflate error: ",l)}}},{key:"destroy",value:function(){var e=this;(0,u.log)("DanmuMask destroy"),this.player&&"function"==typeof this.player.off&&(["ended","pause","error"].forEach((function(t){e.player.stopDanmuMaskTimer&&e.player.off(t,e.player.stopDanmuMaskTimer)})),["play","playing"].forEach((function(t){e.player.startDanmuMaskTimer&&e.player.off(t,e.player.startDanmuMaskTimer)})),this.player.onDanmuMaskSeeked&&this.player.off("seeked",this.player.onDanmuMaskSeeked)),this.timer&&this.timer.clear(),this.searchFrameWorker&&this.searchFrameWorker.terminate(),this.setDanmuMask()}}]),e}();t.default=p,e.exports=t.default},function(e,t,r){var n=r(4),i=r(13),a=r(17),o=r(25),s=r(26);(e.exports=function(e,t){var r,i,u,c,l;return arguments.length<2||"string"!=typeof e?(c=t,t=e,e=null):c=arguments[2],n(e)?(r=s.call(e,"c"),i=s.call(e,"e"),u=s.call(e,"w")):(r=u=!0,i=!1),l={value:t,configurable:r,enumerable:i,writable:u},c?a(o(c),l):l}).gs=function(e,t,r){var u,c,l,d;return"string"!=typeof e?(l=r,r=t,t=e,e=null):l=arguments[3],n(t)?i(t)?n(r)?i(r)||(l=r,r=void 0):r=void 0:(l=t,t=r=void 0):t=void 0,n(e)?(u=s.call(e,"c"),c=s.call(e,"e")):(u=!0,c=!1),d={get:t,set:r,configurable:u,enumerable:c},l?a(o(l),d):d}},function(e,t,r){var n=r(14),i=/^\s*class[\s{/}]/,a=Function.prototype.toString;e.exports=function(e){return!!n(e)&&!i.test(a.call(e))}},function(e,t,r){var n=r(15);e.exports=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(t){return!1}return!n(e)}},function(e,t,r){var n=r(16);e.exports=function(e){if(!n(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(t){return!1}}},function(e,t,r){var n=r(4),i={object:!0,function:!0,undefined:!0};e.exports=function(e){return!!n(e)&&hasOwnProperty.call(i,_typeof$7(e))}},function(e,t,r){e.exports=r(18)()?Object.assign:r(19)},function(e,t,r){e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,r){var n=r(20),i=r(24),a=Math.max;e.exports=function(e,t){var r,o,s,u=a(arguments.length,2);for(e=Object(i(e)),s=function(n){try{e[n]=t[n]}catch(i){r||(r=i)}},o=1;o<u;++o)n(t=arguments[o]).forEach(s);if(void 0!==r)throw r;return e}},function(e,t,r){e.exports=r(21)()?Object.keys:r(22)},function(e,t,r){e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t,r){var n=r(1),i=Object.keys;e.exports=function(e){return i(n(e)?Object(e):e)}},function(e,t,r){e.exports=function(){}},function(e,t,r){var n=r(1);e.exports=function(e){if(!n(e))throw new TypeError("Cannot use null or undefined");return e}},function(e,t,r){var n=r(1),i=Array.prototype.forEach,a=Object.create,o=function(e,t){var r;for(r in e)t[r]=e[r]};e.exports=function(e){var t=a(null);return i.call(arguments,(function(e){n(e)&&o(Object(e),t)})),t}},function(e,t,r){e.exports=r(27)()?String.prototype.contains:r(28)},function(e,t,r){var n="razdwatrzy";e.exports=function(){return"function"==typeof n.contains&&!0===n.contains("dwa")&&!1===n.contains("foo")}},function(e,t,r){var n=String.prototype.indexOf;e.exports=function(e){return n.call(this,e,arguments[1])>-1}},function(e,t,r){e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(n=r(3))&&n.__esModule?n:{default:n};function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2];o(this,e),(0,a.default)(this);var i=this;if(i.url=t,i.on=!1,i.range=r,e.queue.some((function(e){return e.url===t&&JSON.stringify(e.range)===JSON.stringify(r)})))n("repeat");else{var s=new XMLHttpRequest;s.target=i,s.responseType="arraybuffer",s.open("get",t),r&&r.length>1&&(i.range=r,i.id=r.join("-"),s.setRequestHeader("Range","bytes="+r[0]+"-"+(r[1]||""))),s.onload=function(){200===s.status||206===s.status?n&&n instanceof Function&&n(s.response):n&&n instanceof Function?n("Not Found"):i.emit("error"),s.target.remove()},s.onerror=function(){n(!1),s.target.remove()},s.onabort=function(){s.target.remove()},i.xhr=s,e.queue.push(i),i.update()}}return i(e,[{key:"cancel",value:function(){this.xhr.abort()}},{key:"remove",value:function(){var t=this;e.queue.filter((function(r,n){return r.url===t.url&&JSON.stringify(r.range)===JSON.stringify(t.range)&&(e.queue.splice(n,1),!0)})),this.update()}},{key:"update",value:function(){var t=e.queue,r=t.filter((function(e){return e.on})),n=t.filter((function(e){return!e.on})),i=e.limit-r.length;n.forEach((function(e,t){t<i&&e.run()}))}},{key:"run",value:function(){1===this.xhr.readyState?(this.on=!0,this.xhr.send()):this.remove()}}],[{key:"clear",value:function(){e.queue.forEach((function(e){e.on&&e.cancel()})),e.queue.length=0}}]),e}();s.queue=[],s.limit=4,window.Task=s,t.default=s,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return n(e,[{key:"init",value:function(){this.VERSION_LENGTH=1,this.INDEX_LENGTH=4,this.RESERVE_LENGTH=4,this.DURATION_STEP=10,this.DEFAULT_INTERVAL=30}}]),e}());t.default=i,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t instanceof ArrayBuffer&&(this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0)}return n(e,[{key:"skip",value:function(t){for(var r=Math.floor(t/4),n=t%4,i=0;i<r;i++)e.readByte(this.dataview,4);n>0&&e.readByte(this.dataview,n)}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return e.readByte(this.dataview,2)}},{key:"readUint32",value:function(){return e.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return e.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this.dataview,4,!0)}},{key:"readLittleEnd",value:function(t){for(var r=0,n=0;n<t;n++)r+=Math.pow(256,n)*e.readByte(this.dataview,1);return r}},{key:"readBigEnd",value:function(t){for(var r=0,n=0;n<t;n++)r+=Math.pow(256,t-n-1)*e.readByte(this.dataview,1);return r}},{key:"position",set:function(e){this.dataview.position=e},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(e,t,r){var n=void 0;switch(t){case 1:n=r?e.getInt8(e.position):e.getUint8(e.position);break;case 2:n=r?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(r)throw"not supported for readByte 3";n=e.getUint8(e.position)<<16,n|=e.getUint8(e.position+1)<<8,n|=e.getUint8(e.position+2);break;case 4:n=r?e.getInt32(e.position):e.getUint32(e.position);break;case 8:n=e.getUint32(e.position)<<32,n|=e.getUint32(e.position+4);break;default:n=""}return e.position+=t,n}}]),e}();t.default=i,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.log=function(e){var t;if(n){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];console&&(t=console).log.apply(t,[e].concat(i))}};var n=t.LOGOPEN=window.location.search.indexOf("log=true")>-1},function(e,t,r){var n={};(0,r(0).assign)(n,r(35),r(38),r(9)),e.exports=n},function(e,t,r){var n=r(36),i=r(0),a=r(7),o=r(2),s=r(8),u=Object.prototype.toString;function c(e){if(!(this instanceof c))return new c(e);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var r=n.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==r)throw new Error(o[r]);if(t.header&&n.deflateSetHeader(this.strm,t.header),t.dictionary){var l;if(l="string"==typeof t.dictionary?a.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(r=n.deflateSetDictionary(this.strm,l)))throw new Error(o[r]);this._dict_set=!0}}function l(e,t){var r=new c(t);if(r.push(e,!0),r.err)throw r.msg||o[r.err];return r.result}c.prototype.push=function(e,t){var r,o,s=this.strm,c=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=a.string2buf(e):"[object ArrayBuffer]"===u.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(c),s.next_out=0,s.avail_out=c),1!==(r=n.deflate(s,o))&&0!==r)return this.onEnd(r),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(a.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==r);return 4===o?(r=n.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r):2!==o||(this.onEnd(0),s.avail_out=0,!0)},c.prototype.onData=function(e){this.chunks.push(e)},c.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=c,t.deflate=l,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,l(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,l(e,t)}},function(e,t,r){var n,i=r(0),a=r(37),o=r(5),s=r(6),u=r(2);function c(e,t){return e.msg=u[t],t}function l(e){return(e<<1)-(e>4?9:0)}function d(e){for(var t=e.length;--t>=0;)e[t]=0}function h(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(i.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function f(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,h(e.strm)}function p(e,t){e.pending_buf[e.pending++]=t}function g(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function y(e,t){var r,n,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,u=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,c=e.window,l=e.w_mask,d=e.prev,h=e.strstart+258,f=c[a+o-1],p=c[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(r=t)+o]===p&&c[r+o-1]===f&&c[r]===c[a]&&c[++r]===c[a+1]){a+=2,r++;do{}while(c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&a<h);if(n=258-(h-a),a=h-258,n>o){if(e.match_start=t,o=n,n>=s)break;f=c[a+o-1],p=c[a+o]}}}while((t=d[t&l])>u&&0!=--i);return o<=e.lookahead?o:e.lookahead}function m(e){var t,r,n,a,u,c,l,d,h,f,p=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-262)){i.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=p?n-p:0}while(--r);t=r=p;do{n=e.prev[--t],e.prev[t]=n>=p?n-p:0}while(--r);a+=p}if(0===e.strm.avail_in)break;if(c=e.strm,l=e.window,d=e.strstart+e.lookahead,h=a,f=void 0,(f=c.avail_in)>h&&(f=h),r=0===f?0:(c.avail_in-=f,i.arraySet(l,c.input,c.next_in,f,d),1===c.state.wrap?c.adler=o(c.adler,l,f,d):2===c.state.wrap&&(c.adler=s(c.adler,l,f,d)),c.next_in+=f,c.total_in+=f,f),e.lookahead+=r,e.lookahead+e.insert>=3)for(u=e.strstart-e.insert,e.ins_h=e.window[u],e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+3-1])&e.hash_mask,e.prev[u&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=u,u++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function v(e,t){for(var r,n;;){if(e.lookahead<262){if(m(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-262&&(e.match_length=y(e,r)),e.match_length>=3)if(n=a._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function _(e,t){for(var r,n,i;;){if(e.lookahead<262){if(m(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-262&&(e.match_length=y(e,r),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(f(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((n=a._tr_tally(e,0,e.window[e.strstart-1]))&&f(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function b(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function A(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),d(this.dyn_ltree),d(this.dyn_dtree),d(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),d(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),d(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function E(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,a._tr_init(t),0):c(e,-2)}function S(e){var t,r=E(e);return 0===r&&((t=e.state).window_size=2*t.w_size,d(t.head),t.max_lazy_match=n[t.level].max_lazy,t.good_match=n[t.level].good_length,t.nice_match=n[t.level].nice_length,t.max_chain_length=n[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),r}function T(e,t,r,n,a,o){if(!e)return-2;var s=1;if(-1===t&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),a<1||a>9||8!==r||n<8||n>15||t<0||t>9||o<0||o>4)return c(e,-2);8===n&&(n=9);var u=new A;return e.state=u,u.strm=e,u.wrap=s,u.gzhead=null,u.w_bits=n,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=a+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new i.Buf8(2*u.w_size),u.head=new i.Buf16(u.hash_size),u.prev=new i.Buf16(u.w_size),u.lit_bufsize=1<<a+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new i.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=t,u.strategy=o,u.method=r,S(e)}n=[new b(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(m(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,f(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(f(e,!1),e.strm.avail_out),1)})),new b(4,4,8,4,v),new b(4,5,16,8,v),new b(4,6,32,32,v),new b(4,4,16,16,_),new b(8,16,32,32,_),new b(8,16,128,128,_),new b(8,32,128,256,_),new b(32,128,258,1024,_),new b(32,258,258,4096,_)],t.deflateInit=function(e,t){return T(e,t,8,15,8,0)},t.deflateInit2=T,t.deflateReset=S,t.deflateResetKeep=E,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},t.deflate=function(e,t){var r,i,o,u;if(!e||!e.state||t>5||t<0)return e?c(e,-2):-2;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return c(e,0===e.avail_out?-5:-2);if(i.strm=e,r=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,p(i,31),p(i,139),p(i,8),i.gzhead?(p(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),p(i,255&i.gzhead.time),p(i,i.gzhead.time>>8&255),p(i,i.gzhead.time>>16&255),p(i,i.gzhead.time>>24&255),p(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),p(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(p(i,255&i.gzhead.extra.length),p(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(p(i,0),p(i,0),p(i,0),p(i,0),p(i,0),p(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),p(i,3),i.status=113);else{var y=8+(i.w_bits-8<<4)<<8;y|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(y|=32),y+=31-y%31,i.status=113,g(i,y),0!==i.strstart&&(g(i,e.adler>>>16),g(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),h(e),o=i.pending,i.pending!==i.pending_buf_size));)p(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),h(e),o=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,p(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===u&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),h(e),o=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,p(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===u&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&h(e),i.pending+2<=i.pending_buf_size&&(p(i,255&e.adler),p(i,e.adler>>8&255),e.adler=0,i.status=113)):i.status=113),0!==i.pending){if(h(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&l(t)<=l(r)&&4!==t)return c(e,-5);if(666===i.status&&0!==e.avail_in)return c(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&666!==i.status){var v=2===i.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(m(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var r,n,i,o,s=e.window;;){if(e.lookahead<=258){if(m(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=s[i=e.strstart-1])===s[++i]&&n===s[++i]&&n===s[++i]){o=e.strstart+258;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<o);e.match_length=258-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=a._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(i,t):n[i.level].func(i,t);if(3!==v&&4!==v||(i.status=666),1===v||3===v)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===v&&(1===t?a._tr_align(i):5!==t&&(a._tr_stored_block(i,0,0,!1),3===t&&(d(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),h(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(p(i,255&e.adler),p(i,e.adler>>8&255),p(i,e.adler>>16&255),p(i,e.adler>>24&255),p(i,255&e.total_in),p(i,e.total_in>>8&255),p(i,e.total_in>>16&255),p(i,e.total_in>>24&255)):(g(i,e.adler>>>16),g(i,65535&e.adler)),h(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?c(e,-2):(e.state=null,113===t?c(e,-3):0):-2},t.deflateSetDictionary=function(e,t){var r,n,a,s,u,c,l,h,f=t.length;if(!e||!e.state)return-2;if(2===(s=(r=e.state).wrap)||1===s&&42!==r.status||r.lookahead)return-2;for(1===s&&(e.adler=o(e.adler,t,f,0)),r.wrap=0,f>=r.w_size&&(0===s&&(d(r.head),r.strstart=0,r.block_start=0,r.insert=0),h=new i.Buf8(r.w_size),i.arraySet(h,t,f-r.w_size,r.w_size,0),t=h,f=r.w_size),u=e.avail_in,c=e.next_in,l=e.input,e.avail_in=f,e.next_in=0,e.input=t,m(r);r.lookahead>=3;){n=r.strstart,a=r.lookahead-2;do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+3-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--a);r.strstart=n,r.lookahead=2,m(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=c,e.input=l,e.avail_in=u,r.wrap=s,0},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,r){var n=r(0);function i(e){for(var t=e.length;--t>=0;)e[t]=0}var a=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],o=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],u=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],c=new Array(576);i(c);var l=new Array(60);i(l);var d=new Array(512);i(d);var h=new Array(256);i(h);var f=new Array(29);i(f);var p,g,y,m=new Array(30);function v(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function _(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function b(e){return e<256?d[e]:d[256+(e>>>7)]}function A(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function E(e,t,r){e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,A(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function S(e,t,r){E(e,r[2*t],r[2*t+1])}function T(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function w(e,t,r){var n,i,a=new Array(16),o=0;for(n=1;n<=15;n++)a[n]=o=o+r[n-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=T(a[s]++,s))}}function C(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function k(e){e.bi_valid>8?A(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function I(e,t,r,n){var i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]}function $(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&I(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!I(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function P(e,t,r){var n,i,s,u,c=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],i=e.pending_buf[e.l_buf+c],c++,0===n?S(e,i,t):(S(e,(s=h[i])+256+1,t),0!==(u=a[s])&&E(e,i-=f[s],u),S(e,s=b(--n),r),0!==(u=o[s])&&E(e,n-=m[s],u))}while(c<e.last_lit);S(e,256,t)}function x(e,t){var r,n,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,u=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<u;r++)0!==a[2*r]?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=c,r=e.heap_len>>1;r>=1;r--)$(e,a,r);i=u;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],$(e,a,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,a[2*i]=a[2*r]+a[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,a[2*r+1]=a[2*n+1]=i,e.heap[1]=i++,$(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,a,o,s,u=t.dyn_tree,c=t.max_code,l=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,g=0;for(a=0;a<=15;a++)e.bl_count[a]=0;for(u[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<573;r++)(a=u[2*u[2*(n=e.heap[r])+1]+1]+1)>p&&(a=p,g++),u[2*n+1]=a,n>c||(e.bl_count[a]++,o=0,n>=f&&(o=h[n-f]),s=u[2*n],e.opt_len+=s*(a+o),d&&(e.static_len+=s*(l[2*n+1]+o)));if(0!==g){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,g-=2}while(g>0);for(a=p;0!==a;a--)for(n=e.bl_count[a];0!==n;)(i=e.heap[--r])>c||(u[2*i+1]!==a&&(e.opt_len+=(a-u[2*i+1])*u[2*i],u[2*i+1]=a),n--)}}(e,t),w(a,c,e.bl_count)}function R(e,t,r){var n,i,a=-1,o=t[1],s=0,u=7,c=4;for(0===o&&(u=138,c=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=o,o=t[2*(n+1)+1],++s<u&&i===o||(s<c?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=i,0===o?(u=138,c=3):i===o?(u=6,c=3):(u=7,c=4))}function O(e,t,r){var n,i,a=-1,o=t[1],s=0,u=7,c=4;for(0===o&&(u=138,c=3),n=0;n<=r;n++)if(i=o,o=t[2*(n+1)+1],!(++s<u&&i===o)){if(s<c)do{S(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(S(e,i,e.bl_tree),s--),S(e,16,e.bl_tree),E(e,s-3,2)):s<=10?(S(e,17,e.bl_tree),E(e,s-3,3)):(S(e,18,e.bl_tree),E(e,s-11,7));s=0,a=i,0===o?(u=138,c=3):i===o?(u=6,c=3):(u=7,c=4)}}i(m);var D=!1;function L(e,t,r,i){var a,o,s,u;E(e,0+(i?1:0),3),o=t,s=r,u=!0,k(a=e),u&&(A(a,s),A(a,~s)),n.arraySet(a.pending_buf,a.window,o,s,a.pending),a.pending+=s}t._tr_init=function(e){D||(function(){var e,t,r,n,i,u=new Array(16);for(r=0,n=0;n<28;n++)for(f[n]=r,e=0;e<1<<a[n];e++)h[r++]=n;for(h[r-1]=n,i=0,n=0;n<16;n++)for(m[n]=i,e=0;e<1<<o[n];e++)d[i++]=n;for(i>>=7;n<30;n++)for(m[n]=i<<7,e=0;e<1<<o[n]-7;e++)d[256+i++]=n;for(t=0;t<=15;t++)u[t]=0;for(e=0;e<=143;)c[2*e+1]=8,e++,u[8]++;for(;e<=255;)c[2*e+1]=9,e++,u[9]++;for(;e<=279;)c[2*e+1]=7,e++,u[7]++;for(;e<=287;)c[2*e+1]=8,e++,u[8]++;for(w(c,287,u),e=0;e<30;e++)l[2*e+1]=5,l[2*e]=T(e,5);p=new v(c,a,257,286,15),g=new v(l,o,0,30,15),y=new v(new Array(0),s,0,19,7)}(),D=!0),e.l_desc=new _(e.dyn_ltree,p),e.d_desc=new _(e.dyn_dtree,g),e.bl_desc=new _(e.bl_tree,y),e.bi_buf=0,e.bi_valid=0,C(e)},t._tr_stored_block=L,t._tr_flush_block=function(e,t,r,n){var i,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),x(e,e.l_desc),x(e,e.d_desc),o=function(e){var t;for(R(e,e.dyn_ltree,e.l_desc.max_code),R(e,e.dyn_dtree,e.d_desc.max_code),x(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*u[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=r+5,r+4<=i&&-1!==t?L(e,t,r,n):4===e.strategy||a===i?(E(e,2+(n?1:0),3),P(e,c,l)):(E(e,4+(n?1:0),3),function(e,t,r,n){var i;for(E(e,t-257,5),E(e,r-1,5),E(e,n-4,4),i=0;i<n;i++)E(e,e.bl_tree[2*u[i]+1],3);O(e,e.dyn_ltree,t-1),O(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),P(e,e.dyn_ltree,e.dyn_dtree)),C(e),n&&k(e)},t._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(h[r]+256+1)]++,e.dyn_dtree[2*b(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){var t;E(e,2,3),S(e,256,c),16===(t=e).bi_valid?(A(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}},function(e,t,r){var n=r(39),i=r(0),a=r(7),o=r(9),s=r(2),u=r(8),c=r(42),l=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,t.windowBits);if(r!==o.Z_OK)throw new Error(s[r]);if(this.header=new c,n.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=a.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=n.inflateSetDictionary(this.strm,t.dictionary))!==o.Z_OK))throw new Error(s[r])}function h(e,t){var r=new d(t);if(r.push(e,!0),r.err)throw r.msg||s[r.err];return r.result}d.prototype.push=function(e,t){var r,s,u,c,d,h=this.strm,f=this.options.chunkSize,p=this.options.dictionary,g=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?h.input=a.binstring2buf(e):"[object ArrayBuffer]"===l.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new i.Buf8(f),h.next_out=0,h.avail_out=f),(r=n.inflate(h,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&p&&(r=n.inflateSetDictionary(this.strm,p)),r===o.Z_BUF_ERROR&&!0===g&&(r=o.Z_OK,g=!1),r!==o.Z_STREAM_END&&r!==o.Z_OK)return this.onEnd(r),this.ended=!0,!1;h.next_out&&(0!==h.avail_out&&r!==o.Z_STREAM_END&&(0!==h.avail_in||s!==o.Z_FINISH&&s!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(u=a.utf8border(h.output,h.next_out),c=h.next_out-u,d=a.buf2string(h.output,u),h.next_out=c,h.avail_out=f-c,c&&i.arraySet(h.output,h.output,u,c,0),this.onData(d)):this.onData(i.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(g=!0)}while((h.avail_in>0||0===h.avail_out)&&r!==o.Z_STREAM_END);return r===o.Z_STREAM_END&&(s=o.Z_FINISH),s===o.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===o.Z_OK):s!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),h.avail_out=0,!0)},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=d,t.inflate=h,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},t.ungzip=h},function(e,t,r){var n=r(0),i=r(5),a=r(6),o=r(40),s=r(41);function u(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function c(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function l(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(852),t.distcode=t.distdyn=new n.Buf32(592),t.sane=1,t.back=-1,0):-2}function d(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,l(e)):-2}function h(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,d(e))):-2}function f(e,t){var r,n;return e?(n=new c,e.state=n,n.window=null,0!==(r=h(e,t))&&(e.state=null),r):-2}var p,g,y=!0;function m(e){if(y){var t;for(p=new n.Buf32(512),g=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(1,e.lens,0,288,p,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(2,e.lens,0,32,g,0,e.work,{bits:5}),y=!1}e.lencode=p,e.lenbits=9,e.distcode=g,e.distbits=5}function v(e,t,r,i){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new n.Buf8(o.wsize)),i>=o.wsize?(n.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>i&&(a=i),n.arraySet(o.window,t,r-i,a,o.wnext),(i-=a)?(n.arraySet(o.window,t,r-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}t.inflateReset=d,t.inflateReset2=h,t.inflateResetKeep=l,t.inflateInit=function(e){return f(e,15)},t.inflateInit2=f,t.inflate=function(e,t){var r,c,l,d,h,f,p,g,y,_,b,A,E,S,T,w,C,k,I,$,P,x,R,O,D=0,L=new n.Buf8(4),M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(r=e.state).mode&&(r.mode=13),h=e.next_out,l=e.output,p=e.avail_out,d=e.next_in,c=e.input,f=e.avail_in,g=r.hold,y=r.bits,_=f,b=p,x=0;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;y<16;){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}if(2&r.wrap&&35615===g){r.check=0,L[0]=255&g,L[1]=g>>>8&255,r.check=a(r.check,L,2,0),g=0,y=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&g)<<8)+(g>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&g)){e.msg="unknown compression method",r.mode=30;break}if(y-=4,P=8+(15&(g>>>=4)),0===r.wbits)r.wbits=P;else if(P>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<P,e.adler=r.check=1,r.mode=512&g?10:12,g=0,y=0;break;case 2:for(;y<16;){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}if(r.flags=g,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=g>>8&1),512&r.flags&&(L[0]=255&g,L[1]=g>>>8&255,r.check=a(r.check,L,2,0)),g=0,y=0,r.mode=3;case 3:for(;y<32;){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}r.head&&(r.head.time=g),512&r.flags&&(L[0]=255&g,L[1]=g>>>8&255,L[2]=g>>>16&255,L[3]=g>>>24&255,r.check=a(r.check,L,4,0)),g=0,y=0,r.mode=4;case 4:for(;y<16;){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}r.head&&(r.head.xflags=255&g,r.head.os=g>>8),512&r.flags&&(L[0]=255&g,L[1]=g>>>8&255,r.check=a(r.check,L,2,0)),g=0,y=0,r.mode=5;case 5:if(1024&r.flags){for(;y<16;){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}r.length=g,r.head&&(r.head.extra_len=g),512&r.flags&&(L[0]=255&g,L[1]=g>>>8&255,r.check=a(r.check,L,2,0)),g=0,y=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((A=r.length)>f&&(A=f),A&&(r.head&&(P=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,c,d,A,P)),512&r.flags&&(r.check=a(r.check,c,A,d)),f-=A,d+=A,r.length-=A),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===f)break e;A=0;do{P=c[d+A++],r.head&&P&&r.length<65536&&(r.head.name+=String.fromCharCode(P))}while(P&&A<f);if(512&r.flags&&(r.check=a(r.check,c,A,d)),f-=A,d+=A,P)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===f)break e;A=0;do{P=c[d+A++],r.head&&P&&r.length<65536&&(r.head.comment+=String.fromCharCode(P))}while(P&&A<f);if(512&r.flags&&(r.check=a(r.check,c,A,d)),f-=A,d+=A,P)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;y<16;){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}if(g!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}g=0,y=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;y<32;){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}e.adler=r.check=u(g),g=0,y=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=h,e.avail_out=p,e.next_in=d,e.avail_in=f,r.hold=g,r.bits=y,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){g>>>=7&y,y-=7&y,r.mode=27;break}for(;y<3;){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}switch(r.last=1&g,y-=1,3&(g>>>=1)){case 0:r.mode=14;break;case 1:if(m(r),r.mode=20,6===t){g>>>=2,y-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}g>>>=2,y-=2;break;case 14:for(g>>>=7&y,y-=7&y;y<32;){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}if((65535&g)!=(g>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&g,g=0,y=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(A=r.length){if(A>f&&(A=f),A>p&&(A=p),0===A)break e;n.arraySet(l,c,d,A,h),f-=A,d+=A,p-=A,h+=A,r.length-=A;break}r.mode=12;break;case 17:for(;y<14;){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}if(r.nlen=257+(31&g),g>>>=5,y-=5,r.ndist=1+(31&g),g>>>=5,y-=5,r.ncode=4+(15&g),g>>>=4,y-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;y<3;){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}r.lens[M[r.have++]]=7&g,g>>>=3,y-=3}for(;r.have<19;)r.lens[M[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,R={bits:r.lenbits},x=s(0,r.lens,0,19,r.lencode,0,r.work,R),r.lenbits=R.bits,x){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;w=(D=r.lencode[g&(1<<r.lenbits)-1])>>>16&255,C=65535&D,!((T=D>>>24)<=y);){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}if(C<16)g>>>=T,y-=T,r.lens[r.have++]=C;else{if(16===C){for(O=T+2;y<O;){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}if(g>>>=T,y-=T,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}P=r.lens[r.have-1],A=3+(3&g),g>>>=2,y-=2}else if(17===C){for(O=T+3;y<O;){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}y-=T,P=0,A=3+(7&(g>>>=T)),g>>>=3,y-=3}else{for(O=T+7;y<O;){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}y-=T,P=0,A=11+(127&(g>>>=T)),g>>>=7,y-=7}if(r.have+A>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;A--;)r.lens[r.have++]=P}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,R={bits:r.lenbits},x=s(1,r.lens,0,r.nlen,r.lencode,0,r.work,R),r.lenbits=R.bits,x){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,R={bits:r.distbits},x=s(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,R),r.distbits=R.bits,x){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(f>=6&&p>=258){e.next_out=h,e.avail_out=p,e.next_in=d,e.avail_in=f,r.hold=g,r.bits=y,o(e,b),h=e.next_out,l=e.output,p=e.avail_out,d=e.next_in,c=e.input,f=e.avail_in,g=r.hold,y=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;w=(D=r.lencode[g&(1<<r.lenbits)-1])>>>16&255,C=65535&D,!((T=D>>>24)<=y);){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}if(w&&0==(240&w)){for(k=T,I=w,$=C;w=(D=r.lencode[$+((g&(1<<k+I)-1)>>k)])>>>16&255,C=65535&D,!(k+(T=D>>>24)<=y);){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}g>>>=k,y-=k,r.back+=k}if(g>>>=T,y-=T,r.back+=T,r.length=C,0===w){r.mode=26;break}if(32&w){r.back=-1,r.mode=12;break}if(64&w){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&w,r.mode=22;case 22:if(r.extra){for(O=r.extra;y<O;){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}r.length+=g&(1<<r.extra)-1,g>>>=r.extra,y-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;w=(D=r.distcode[g&(1<<r.distbits)-1])>>>16&255,C=65535&D,!((T=D>>>24)<=y);){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}if(0==(240&w)){for(k=T,I=w,$=C;w=(D=r.distcode[$+((g&(1<<k+I)-1)>>k)])>>>16&255,C=65535&D,!(k+(T=D>>>24)<=y);){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}g>>>=k,y-=k,r.back+=k}if(g>>>=T,y-=T,r.back+=T,64&w){e.msg="invalid distance code",r.mode=30;break}r.offset=C,r.extra=15&w,r.mode=24;case 24:if(r.extra){for(O=r.extra;y<O;){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}r.offset+=g&(1<<r.extra)-1,g>>>=r.extra,y-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===p)break e;if(A=b-p,r.offset>A){if((A=r.offset-A)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}A>r.wnext?(A-=r.wnext,E=r.wsize-A):E=r.wnext-A,A>r.length&&(A=r.length),S=r.window}else S=l,E=h-r.offset,A=r.length;A>p&&(A=p),p-=A,r.length-=A;do{l[h++]=S[E++]}while(--A);0===r.length&&(r.mode=21);break;case 26:if(0===p)break e;l[h++]=r.length,p--,r.mode=21;break;case 27:if(r.wrap){for(;y<32;){if(0===f)break e;f--,g|=c[d++]<<y,y+=8}if(b-=p,e.total_out+=b,r.total+=b,b&&(e.adler=r.check=r.flags?a(r.check,l,b,h-b):i(r.check,l,b,h-b)),b=p,(r.flags?g:u(g))!==r.check){e.msg="incorrect data check",r.mode=30;break}g=0,y=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;y<32;){if(0===f)break e;f--,g+=c[d++]<<y,y+=8}if(g!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}g=0,y=0}r.mode=29;case 29:x=1;break e;case 30:x=-3;break e;case 31:return-4;default:return-2}return e.next_out=h,e.avail_out=p,e.next_in=d,e.avail_in=f,r.hold=g,r.bits=y,(r.wsize||b!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&v(e,e.output,e.next_out,b-e.avail_out)?(r.mode=31,-4):(_-=e.avail_in,b-=e.avail_out,e.total_in+=_,e.total_out+=b,r.total+=b,r.wrap&&b&&(e.adler=r.check=r.flags?a(r.check,l,b,e.next_out-b):i(r.check,l,b,e.next_out-b)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0===_&&0===b||4===t)&&0===x&&(x=-5),x)},t.inflateEnd=function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?-2:(r.head=t,t.done=!1,0):-2},t.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?-2:11===r.mode&&i(1,t,n,0)!==r.check?-3:v(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,0):-2},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,r){e.exports=function(e,t){var r,n,i,a,o,s,u,c,l,d,h,f,p,g,y,m,v,_,b,A,E,S,T,w,C;r=e.state,n=e.next_in,w=e.input,i=n+(e.avail_in-5),a=e.next_out,C=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),u=r.dmax,c=r.wsize,l=r.whave,d=r.wnext,h=r.window,f=r.hold,p=r.bits,g=r.lencode,y=r.distcode,m=(1<<r.lenbits)-1,v=(1<<r.distbits)-1;e:do{p<15&&(f+=w[n++]<<p,p+=8,f+=w[n++]<<p,p+=8),_=g[f&m];t:for(;;){if(f>>>=b=_>>>24,p-=b,0==(b=_>>>16&255))C[a++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=g[(65535&_)+(f&(1<<b)-1)];continue t}if(32&b){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}A=65535&_,(b&=15)&&(p<b&&(f+=w[n++]<<p,p+=8),A+=f&(1<<b)-1,f>>>=b,p-=b),p<15&&(f+=w[n++]<<p,p+=8,f+=w[n++]<<p,p+=8),_=y[f&v];r:for(;;){if(f>>>=b=_>>>24,p-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=y[(65535&_)+(f&(1<<b)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(E=65535&_,p<(b&=15)&&(f+=w[n++]<<p,(p+=8)<b&&(f+=w[n++]<<p,p+=8)),(E+=f&(1<<b)-1)>u){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=b,p-=b,E>(b=a-o)){if((b=E-b)>l&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(S=0,T=h,0===d){if(S+=c-b,b<A){A-=b;do{C[a++]=h[S++]}while(--b);S=a-E,T=C}}else if(d<b){if(S+=c+d-b,(b-=d)<A){A-=b;do{C[a++]=h[S++]}while(--b);if(S=0,d<A){A-=b=d;do{C[a++]=h[S++]}while(--b);S=a-E,T=C}}}else if(S+=d-b,b<A){A-=b;do{C[a++]=h[S++]}while(--b);S=a-E,T=C}for(;A>2;)C[a++]=T[S++],C[a++]=T[S++],C[a++]=T[S++],A-=3;A&&(C[a++]=T[S++],A>1&&(C[a++]=T[S++]))}else{S=a-E;do{C[a++]=C[S++],C[a++]=C[S++],C[a++]=C[S++],A-=3}while(A>2);A&&(C[a++]=C[S++],A>1&&(C[a++]=C[S++]))}break}}break}}while(n<i&&a<s);n-=A=p>>3,f&=(1<<(p-=A<<3))-1,e.next_in=n,e.next_out=a,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=a<s?s-a+257:257-(a-s),r.hold=f,r.bits=p}},function(e,t,r){var n=r(0),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,r,u,c,l,d,h){var f,p,g,y,m,v,_,b,A,E=h.bits,S=0,T=0,w=0,C=0,k=0,I=0,$=0,P=0,x=0,R=0,O=null,D=0,L=new n.Buf16(16),M=new n.Buf16(16),N=null,B=0;for(S=0;S<=15;S++)L[S]=0;for(T=0;T<u;T++)L[t[r+T]]++;for(k=E,C=15;C>=1&&0===L[C];C--);if(k>C&&(k=C),0===C)return c[l++]=20971520,c[l++]=20971520,h.bits=1,0;for(w=1;w<C&&0===L[w];w++);for(k<w&&(k=w),P=1,S=1;S<=15;S++)if(P<<=1,(P-=L[S])<0)return-1;if(P>0&&(0===e||1!==C))return-1;for(M[1]=0,S=1;S<15;S++)M[S+1]=M[S]+L[S];for(T=0;T<u;T++)0!==t[r+T]&&(d[M[t[r+T]]++]=T);if(0===e?(O=N=d,v=19):1===e?(O=i,D-=257,N=a,B-=257,v=256):(O=o,N=s,v=-1),R=0,T=0,S=w,m=l,I=k,$=0,g=-1,y=(x=1<<k)-1,1===e&&x>852||2===e&&x>592)return 1;for(;;){_=S-$,d[T]<v?(b=0,A=d[T]):d[T]>v?(b=N[B+d[T]],A=O[D+d[T]]):(b=96,A=0),f=1<<S-$,w=p=1<<I;do{c[m+(R>>$)+(p-=f)]=_<<24|b<<16|A|0}while(0!==p);for(f=1<<S-1;R&f;)f>>=1;if(0!==f?(R&=f-1,R+=f):R=0,T++,0==--L[S]){if(S===C)break;S=t[r+d[T]]}if(S>k&&(R&y)!==g){for(0===$&&($=k),m+=w,P=1<<(I=S-$);I+$<C&&!((P-=L[I+$])<=0);)I++,P<<=1;if(x+=1<<I,1===e&&x>852||2===e&&x>592)return 1;c[g=R&y]=k<<24|I<<16|m-l|0}}return 0!==R&&(c[m+R]=S-$<<24|64<<16|0),h.bits=k,0}},function(e,t,r){e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.timeID=null,this.func=null}return n(e,[{key:"repeat",value:function(e,t){var r=this;null===this.func&&(this.func=e),this.func===e&&(this.timeID=setTimeout((function(){e(),r.repeat(e,t)}),t))}},{key:"clear",value:function(){clearTimeout(this.timeID)}}]),e}();t.default=i,e.exports=t.default},function(e,t,r){e.exports=function(){return r(45)('!function(e){var t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){"use strict";var r,n=a(1),o=(r=n)&&r.__esModule?r:{default:r};var i=[],s=-1,u=0,d=function(e){for(var t=new o.default,a=s<0?u-1:s+1,r=null,n=s<0?0:s;n<=a;n++)if(i[n]&&e>=i[n].timeStart&&e<i[n].timeEnd){if(s=n,i[n].download){if(!i[n].frameList)break;if(i[n].currentFrame<0)for(var d=i[n].frameList,f=0,l=d.length-1;f<=l;){var c=Math.ceil(f+(l-f)*(1e3*e-d[f].dataPts)/(d[l].dataPts-d[f].dataPts));if(1e3*e>=d[c=Math.min(c,l)].dataPts){if(!(c<d.length-1)){r={svgData:d[c].dataSvgBase64};break}if(1e3*e<d[c+1].dataPts){r={svgData:d[c].dataSvgBase64};break}f=c+1}else{if(!(c>0)){r={svgData:d[c].dataSvgBase64};break}if(1e3*e>=d[c-1].dataPts){r={svgData:d[c].dataSvgBase64};break}l=c-1}}else for(var v=i[n].currentFrame;v<i[n].frameList.length-1;v++){var g=i[n].frameList[v],m=i[n].frameList[v+1];if(1e3*e>=g.dataPts&&1e3*e<m.dataPts){r={svgData:(1e3*e-g.dataPts<=m.dataPts-1e3*e?g:m).dataSvgBase64};break}}}else r={range:[i[n].dataStart,i[n].dataEnd],index:n};n+1<u&&!i[n+1].download&&(r={range:[i[n+1].dataStart,i[n+1].dataEnd],index:n+1});break}return t.resolve(r),t};onmessage=function(e){var t=this;if("searchFrame"===e.data.method){var a=e.data.args;d(a.currentTime||0).then((function(e){e&&(void 0!==e.svgData?t.postMessage({method:"searchResult",args:{svgData:e.svgData}}):e.range&&t.postMessage({method:"getData",args:{range:e.range,index:e.index}}))}))}else if("updateData"===e.data.method){var r=e.data.args;i=r.dataList,u=r.indexCount}else if("updateDataListItem"===e.data.method){var n=e.data.args;i[n.index][n.key]=n.value}else"onDanmuMaskSeeked"===e.data.method&&(s=-1,i&&i.forEach((function(e){e.currentFrame=-1})))}},function(e,t,a){"use strict";a.r(t);var r=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=void 0,a=void 0,r=new Promise((function(e,r){t=e,a=r}));return r.resolve=t,r.reject=a,r}return r(e,[{key:"resolve",value:function(e){}},{key:"reject",value:function(e){}}]),e}();t.default=n}]);\n//# sourceMappingURL=4fb552b0780015bcf95a.worker.js.map',"/4fb552b0780015bcf95a.worker.js")}},function(e,t,r){var n=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),r=r.getBlob()}catch(i){r=new Blob([e])}return new Worker(n.createObjectURL(r))}catch(i){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(a){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}},function(e){e.exports=JSON.parse('{"version":"0.3.6"}')}])}(dist$1);var DanmuMask=getDefaultExportFromCjs(dist$1.exports),isPC="pc"===sniffer$1.device,MIN_INTERVAL=300,POSITIONS$8=Plugin.POSITIONS,DanmuPlugin=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),(n=t.call(this,e)).seekCost=window.performance.now(),n.eventBus=new EventEmitter$1,n.state=new State(e.config),n.state.updateLang(n.player.lang),n.iconWrap=document.createElement("div"),helpers.addClass(n.iconWrap,"icon-warp"),n.tipsWrap=document.createElement("div"),helpers.addClass(n.tipsWrap,"tips-wrap"),n.container=new Container(n.state),n.panel=new Panel(n.state),n}return _createClass$9(r,[{key:"afterCreate",value:function(){var e;null===(e=this.player.root)||void 0===e||e.appendChild(this.container.root),this.renderIcon(),this.renderBox(),this.root.appendChild(this.iconWrap),isPC&&(this.state.getConfig().usePanel&&this.root.appendChild(this.panel.root),this.renderTips(),helpers.addClass(this.panel.root,"pc-panel"),this.root.appendChild(this.tipsWrap)),this.initEvents(),this.container.initDanmuContainer()}},{key:"afterPlayerInit",value:function(){this.initDanmuMask()}},{key:"updateLang",value:function(e){this.state.updateLang(this.player.lang),this.eventBus.emit("updateLang")}},{key:"registerIcons",value:function(){return{open:{icon:danmuActiveSVG$1,class:"xgplayer-danmu-open-svg"},close:{icon:Default,class:"xgplayer-danmu-close-svg"},reset:{icon:resetIcon,class:"xgplayer-danmu-reset-svg"}}}},{key:"initEvents",value:function(){isPC?this.bindPCEvent():this.bindMobileEvent(),this.bindPlayerEvent()}},{key:"bindPlayerEvent",value:function(){var e=this;this.once(TIME_UPDATE,(function(){e.container.start()})),this.on(PAUSE,(function(){e.container.pause()})),this.on(PLAY,(function(){e.container.play()})),this.on(SEEKING,(function(){e.seekCost=window.performance.now(),e.container.stop()})),this.on(SEEKED,debounce$2((function(){e.container.start()}),MIN_INTERVAL)),this.on([FULLSCREEN_CHANGE,CSS_FULLSCREEN_CHANGE,MINI_STATE_CHANGE],(function(){e.container.resize(),e.handleResize()})),this.on(PIP_CHANGE,this.handlePIP.bind(this))}},{key:"bindPCEvent",value:function(){var e=this;helpers.addEventListener(this.root,"click",this.onClick.bind(this)),helpers.addEventListener(this.root,"mouseenter",(function(){e.state.getConfig().active?(helpers.style(e.panel.root,{display:"block"}),helpers.style(e.tipsWrap,{display:"none"})):(helpers.style(e.panel.root,{display:"none"}),helpers.style(e.tipsWrap,{display:"block"}))})),helpers.addEventListener(this.root,"mouseleave",(function(){helpers.style(e.panel.root,{display:"none"}),helpers.style(e.tipsWrap,{display:"none"})}))}},{key:"bindMobileEvent",value:function(){var e=this;helpers.addEventListener(this.root,"click",(function(){e.state.getConfig().usePanel?e.player.panel.showPanel(e.panel.root):e.onClick()}))}},{key:"onClick",value:function(){this.toggleDanmu(),this.renderIcon()}},{key:"toggleDanmu",value:function(){var e=this.state.getConfig(),t=e.active,r=e.maskActive,n=!t;n?(this.state.updateConfig({active:n}),r&&this.initMask()):(null==this||this.container.clear(),this.destroyMask(),this.state.updateConfig({active:n})),this.player.emit(PluginEvents.DANMU_CHANGE,{active:n}),this.danmuSwitchInSettingPanel&&(this.danmuSwitchInSettingPanel.value=n,this.danmuSwitchInSettingPanel.render())}},{key:"renderIcon",value:function(){this.iconWrap.innerHTML="",this.state.getConfig().active?this.iconWrap.appendChild(this.icons.open):this.iconWrap.appendChild(this.icons.close)}},{key:"renderTips",value:function(){this.tipsWrap.innerHTML=this.state.curLangMap.openDanmu}},{key:"renderBox",value:function(){var e=this;this.panel.root.innerHTML="";var t=document.createElement("div");helpers.addClass(t,"box-header"),t.innerHTML='<div class="header-setting">'+this.state.curLangMap.danmuSetting+'</div> <div class="header-reset"></div>';var r=t.querySelector(".header-reset");r.appendChild(this.icons.reset),helpers.addEventListener(r,"click",(function(t){t.stopPropagation(),e.eventBus.emit("reset")}),{capture:!0});var n=document.createElement("span");n.innerHTML=this.state.curLangMap.reset,r.appendChild(n),this.eventBus.on("updateLang",(function(){n.innerHTML=e.state.curLangMap.reset,t.querySelector(".header-setting").innerHTML=e.state.curLangMap.danmuSetting})),this.panel.root.appendChild(t),isPC||this.renderTurnOff(),this.renderSliders(),this.renderSwitches()}},{key:"renderTurnOff",value:function(){var e=this,t={name:this.state.curLangMap.danmuSwitch,key:"active",value:this.state.getConfig().active||!1},r=new Switch(t);this.danmuSwitchInSettingPanel=r,this.panel.root.appendChild(r.root),r.onChange((function(t){e.toggleDanmu(),e.renderIcon()})),this.eventBus.on("updateLang",(function(){r.renderName(e.state.curLangMap.danmuSwitch)}))}},{key:"renderSwitches",value:function(){var e,t=this;null===(e=this.state.getConfig().external)||void 0===e||e.forEach((function(e){var r=new Switch(e);t.panel.root.appendChild(r.root),t.eventBus.on("updateLang",(function(){r.renderName(e.name)})),r.onChange((function(r){var n=t.state.getConfig().external||[];n.forEach((function(t){t.key===e.key&&(t.value=r)})),t.state.updateConfig({external:n}),t.player.emit(PluginEvents.DANMU_CHANGE,{external:n})}))}))}},{key:"renderSliders",value:function(){var e=this;this.state.sliderItemsProps.forEach((function(t,r){var n,i,a=document.createElement("div"),o=new Slider(a,t);null!=(null===(n=e.state.getConfig())||void 0===n?void 0:n[t.key])&&o.setValue(null===(i=e.state.getConfig())||void 0===i?void 0:i[t.key]);o.onChange((function(r){e.state.updateConfig(_defineProperty$9({},t.key,r)),console.log("val",e.state.getConfig()),e.player.emit(PluginEvents.DANMU_CHANGE,_defineProperty$9({},t.key,r)),e.container.setProperty(t.key,r)})),e.eventBus.on("reset",(function(){o.setValue(t.defaultValue)})),e.eventBus.on("updateLang",(function(){o.renderText(e.state.sliderItemsProps[r])})),e.panel.root.appendChild(a)}))}},{key:"sendDanmu",value:function(e){return this.container.sendDanmu(e)}},{key:"updateConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.state.updateConfig(e)}},{key:"getConfig",value:function(){return this.state.getConfig()}},{key:"initDanmuMask",value:function(){if(this.player){var e=this.state.getConfig(),t=e.maskConfig,r=e.active,n=e.maskActive;t.maskUrl&&(this.renderDanmuMaskTurnOff(),r&&n&&this.initMask())}}},{key:"renderDanmuMaskTurnOff",value:function(){var e=this,t={name:this.state.curLangMap.danmuMask,key:"maskActive",value:this.state.getConfig().maskActive||!1},r=new Switch(t);this.panel.root.appendChild(r.root),r.onChange((function(t){e.state.updateConfig({maskActive:t}),t?e.initMask():e.destroyMask(),e.renderIcon()})),this.eventBus.on("updateLang",(function(){r.renderName(e.state.curLangMap.danmuMask)}))}},{key:"initMask",value:function(){this.destroyMask();var e=this.state.getConfig(),t=e.maskConfig,r=e.maskActive,n=e.active;t.maskUrl&&r&&n&&(this.mask=new DanmuMask({player:this.player,url:t.maskUrl,originStart:t.maskOffset,interval:t.interval}),this.mask.init())}},{key:"destroyMask",value:function(){this.mask&&(this.mask.destroy(),this.mask=null)}},{key:"handleResize",value:function(){var e,t,r,n;if(this.mask){var i=this.player;this.mask.setContainerSize(null!==(e=null==i||null===(t=i.root)||void 0===t?void 0:t.offsetWidth)&&void 0!==e?e:0,null!==(r=null==i||null===(n=i.root)||void 0===n?void 0:n.offsetHeight)&&void 0!==r?r:0)}}},{key:"handlePIP",value:function(e){e?this.destroyMask():this.initMask()}},{key:"destroy",value:function(){this.destroyMask(),this.container.destroy(),this.panel.destroy()}},{key:"render",value:function(){return'<div class="xgplayer-danmu"></div>'}}],[{key:"pluginName",get:function(){return"DanmuPlugin"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$8.CONTROLS_RIGHT,index:CONTROL_ICON_INDEX.DanmuPlugin}}}]),r}(Plugin),CONTENT_TYPES={VIDEO:"video",AUDIO:"audio"},ERROR_TYPES$1={MSE_OP_FAIL:"MS_OP_FAIL",MSE_DESTROY:"MSE_DESTROY",QuotaExceededError:"QuotaExceededError"},MSE=function(){function t(e,r){_classCallCheck$4(this,t),this.mediaSource=new window.MediaSource(e),this.url=window.URL.createObjectURL(this.mediaSource),this.queue=[],this._hasDestroyed=!1,this._sourceOpenPromise=new ProxyPromise$1,this._onSourceOpen=this._onSourceOpen.bind(this),this._onSourceBufferError=this._onSourceBufferError.bind(this),this._onSourceBufferUpdateEnd=this._onSourceBufferUpdateEnd.bind(this),this.mediaSource.addEventListener("sourceopen",this._onSourceOpen),this.opQueues={},this.sourceBuffers={},this.updateHanders={},this.errorHandlers={},this.logger=r||function(){},this._sourceOpenDonePromise=new ProxyPromise$1}return _createClass$5(t,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_defineProperty$5({},CONTENT_TYPES.VIDEO,{mimeType:"video/mp4",codec:'video/mp4; codecs="avc1.64001E, mp4a.40.5"'});this.contentTypes=t;var r=Object.keys(this.contentTypes);return this._sourceOpenPromise.then((function(){for(var t=0;t<r.length;t++)try{!function(){var n=r[t],i=e.contentTypes[n].codec,a=e.mediaSource.addSourceBuffer(i),o=function(){return e._onSourceBufferError(n)};a.addEventListener("error",o);var s=function(){return e._onSourceBufferUpdateEnd(n)};a.addEventListener("updateend",s),e.updateHanders={},e.sourceBuffers[n]=a,e.opQueues[n]=[],e.updateHanders[n]=s,e.errorHandlers[n]=o}()}catch(error){e._sourceOpenDonePromise.reject(error)}e.logger("[debug mse] mse init ready, readyState",e.mediaSource.readyState),e._sourceOpenDonePromise.resolve()})),this._sourceOpenDonePromise}},{key:"sourceOpenPromise",value:function(){return this._sourceOpenPromise}},{key:"_onSourceOpen",value:function(){this.mediaSource.removeEventListener("sourceopen",this._onSourceOpen),this._sourceOpenPromise.resolve()}},{key:"_onSourceBufferError",value:function(e){this._hasDestroyed||(this.logger("[debug mse] sourceBuffer error, contentType",e,"readyState",this.mediaSource.readyState),this.opQueues[e][0].p.reject(new Error(ERROR_TYPES$1.MSE_OP_FAIL)))}},{key:"_onSourceBufferUpdateEnd",value:function(e){if(!this._hasDestroyed){var t=this.opQueues[e][0];t&&(t.p.resolve(),this.pop(e))}}},{key:"state",get:function(){return this.mediaSource.readyState}},{key:"duration",get:function(){return this.mediaSource.duration}},{key:"setDuration",value:function(e){var t=this;return this.mediaSource.duration>e?Promise.resolve():this.enqueueBlockOp((function(){t.ended()?t.logger("[debug mse] setDuration ended"):(t.logger("[debug mse] setDuration"),t.mediaSource.duration=e)}),"setDuration")}},{key:"appendBuffer",value:function(e,t){var r=this;return this.enqueueOp(e,(function(){return r._append(e,t)}),"appendBuffer")}},{key:"_append",value:function(e,t){this.logger("[real append], len = ",t.byteLength),this.sourceBuffers[e].appendBuffer(t)}},{key:"enqueueOp",value:function(e,t,r){var n=this;if(this._hasDestroyed)return Promise.reject(new Error(ERROR_TYPES$1.MSE_DESTROY)).catch((function(){}));var i={handler:t,p:new ProxyPromise$1,name:r};return this._sourceOpenDonePromise.then((function(){if(n._hasDestroyed)return i.p.reject(new Error(ERROR_TYPES$1.MSE_DESTROY)).catch((function(){}));n.opQueues[e]||(n.opQueues[e]=[]),n.opQueues[e].push(i),1===n.opQueues[e].length&&n.handleOp(e)})),i.p}},{key:"enqueueBlockOp",value:function(t,r){var n=this;if(this._hasDestroyed)return Promise.reject(new Error(ERROR_TYPES$1.MSE_DESTROY));var i=new ProxyPromise$1;return this._sourceOpenDonePromise.then((function(){if(n._hasDestroyed)return i.reject(new Error(ERROR_TYPES$1.MSE_DESTROY));for(var a=[],o=Object.keys(n.contentTypes),s=function(e){var t=o[e],i=new ProxyPromise$1,s={handler:function(){return i.resolve()},p:i,name:r};n.opQueues[t]||(n.opQueues[t]=[]),n.opQueues[t].push(s),a.push(i),1===n.opQueues[t].length&&s.handler()},u=0;u<o.length;u++)s(u);Promise.all(a).then((function(){try{t()}catch(e){console.log(e)}finally{for(var r=0;r<o.length;r++){var a=o[r];n.pop(a)}i.resolve()}})).catch((function(e){console.log("waiting cath",e)}))})),i}},{key:"handleOp",value:function(e){if(!this._hasDestroyed){var t=this.opQueues[e][0];if(t)try{t.handler()}catch(error){t.p.reject(new Error(error.name)),this.pop(e)}}}},{key:"pop",value:function(e){this._hasDestroyed||(this.opQueues[e].shift(),this.handleOp(e))}},{key:"clearEnqueAndRemoveBuffer",value:function(e,t,r){r<=t?this._onSourceBufferUpdateEnd(e):(this.opQueues[e]=this.opQueues[e].slice(0,1),this.removeBuffer(e,t,r))}},{key:"removeBuffer",value:function(e,t,r){var n=this;return this.enqueueOp(e,(function(){return n._remove(e,t,r)}),"removeBuffer")}},{key:"_remove",value:function(e,t,r){r<=t?this._onSourceBufferUpdateEnd(e):this.sourceBuffers[e].remove(t,r)}},{key:"endOfStream",value:function(){var e=this;return this.enqueueBlockOp((function(){e.ended()||e._hasDestroyed||e.mediaSource.endOfStream()}),"endOfStream")}},{key:"ended",value:function(){return!this.mediaSource||"ended"===this.mediaSource.readyState}},{key:"isMediaSourceOpen",value:function(){return!!this.mediaSource&&"open"===this.mediaSource.readyState}},{key:"abort",value:function(e){var t=this;return this.isMediaSourceOpen()?this.enqueueOp(e,(function(){t.sourceBuffers[e].abort(),t._onSourceBufferUpdateEnd(e)}),"abort"):Promise.resolve()}},{key:"reuse",value:function(e,t){for(var r=Object.keys(this.contentTypes),n=0;n<r.length;n++){var i=r[n];this.removeBuffer(i,e,t)}}},{key:"_forceAbort",value:function(){try{for(var e=Object.keys(this.contentTypes),t=0;t<e.length;t++){var r=e[t];this.sourceBuffers[r].abort()}}catch(error){console.log("forceAbort error")}}},{key:"destroy",value:function(){if(this.logger("[debug mse] destroy execute"),!this._hasDestroyed){this._forceAbort(),this._hasDestroyed=!0,window.URL.revokeObjectURL(this.url),this.mediaSource&&(this.mediaSource.removeEventListener("sourceclose",this._onMediaSourceClose),this.mediaSource.removeEventListener("sourceopen",this._onSourceOpen));for(var e=Object.keys(this.contentTypes),t=0;t<e.length;t++){var r=e[t],n=this.sourceBuffers[r];if(n){var i=this.errorHandlers[r];n.removeEventListener("error",i);var a=this.updateHanders[r];n.removeEventListener("updateend",a)}}this.opQueues={},this.sourceBuffers={}}}},{key:"buffered",value:function(e){return this.sourceBuffers[e]&&this.sourceBuffers[e].buffered}},{key:"sourceBuffer",value:function(e){return this.sourceBuffers[e]}},{key:"removeSourceBuffer",value:function(e){var t=this.sourceBuffer(e);if(t){this.mediaSource.removeSourceBuffer(t);var r=this.errorHandlers[e];t.removeEventListener("error",r);var n=this.updateHanders[e];t.removeEventListener("updateend",n),delete this.errorHandlers[e],delete this.sourceBuffers[e],delete this.updateHanders[e]}}},{key:"setTimeoffset",value:function(e,t){var r=this;return this.enqueueOp(e,(function(){t<0&&(t+=.001),r.sourceBuffers[e].timestampOffset=t,r._onSourceBufferUpdateEnd(e)}),"setTimeoffset")}}],[{key:"isSupported",value:function(e){return window.MediaSource&&window.MediaSource.isTypeSupported(e)}}]),t}(),MSE$1=MSE,TrackType$1={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},VideoCodecType$1={AVC:"avc",HEVC:"hevc"},AudioCodecType={AAC:"aac",G711PCMA:"g7110a",G711PCMU:"g7110m"},isBrowser="undefined"!=typeof window,ua=isBrowser&&navigator.userAgent.toLocaleLowerCase();isBrowser&&/^((?!chrome|android).)*safari/.test(ua);var isFirefox=isBrowser&&ua.includes("firefox"),isAndroid=isBrowser&&ua.includes("android"),AAC=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"getRateIndexByRate",value:function(t){return e.FREQ.indexOf(t)}},{key:"parseADTS",value:function(t,r){for(var n=t.length,i=0;i+2<n&&(255!==t[i]||240!=(246&t[i+1]));)i++;if(!(i>=n)){var a=i,o=[],s=(60&t[i+2])>>>2,u=e.FREQ[s];if(!u)throw new Error("Invalid sampling index: ".concat(s));for(var c,l,d=1+((192&t[i+2])>>>6),h=(1&t[i+2])<<2|(192&t[i+3])>>>6,f=e._getConfig(s,h,d),p=f.config,g=f.codec,y=0,m=e.getFrameDuration(u);i+7<n;)if(255===t[i]&&240==(246&t[i+1])){if(n-i<(l=(3&t[i+3])<<11|t[i+4]<<3|(224&t[i+5])>>5))break;c=2*(1&~t[i+1]),o.push({pts:r+y*m,data:t.subarray(i+7+c,i+l)}),y++,i+=l}else i++;return{skip:a,remaining:i>=n?void 0:t.subarray(i),frames:o,samplingFrequencyIndex:s,sampleRate:u,objectType:d,channelCount:h,codec:g,config:p,originCodec:"mp4a.40.".concat(d)}}}},{key:"parseAudioSpecificConfig",value:function(t){if(t.length){var r=t[0]>>>3,n=(7&t[0])<<1|t[1]>>>7,i=(120&t[1])>>>3,a=e.FREQ[n];if(!a)throw new Error("Invalid sampling index: ".concat(n));var o=e._getConfig(n,i,r);return{samplingFrequencyIndex:n,sampleRate:a,objectType:r,channelCount:i,config:o.config,codec:o.codec,originCodec:"mp4a.40.".concat(r)}}}},{key:"getFrameDuration",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return 1024*t/e}},{key:"_getConfig",value:function(e,t,r){var n,i,a=[];return isFirefox?e>=6?(n=5,i=e-3):(n=2,i=e):isAndroid?(n=2,i=e):(n=r,i=e,e>=6?i=e-3:1===t&&(n=2,i=e)),a[0]=n<<3,a[0]|=(14&e)>>1,a[1]=(1&e)<<7,a[1]|=t<<3,5===n&&(a[1]|=(14&i)>>1,a[2]=(1&i)<<7,a[2]|=8,a[3]=0),{config:a,codec:"mp4a.40.".concat(n)}}},{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}]),e}();_defineProperty$5(AAC,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var AudioSample=_createClass$5((function e(t,r,n,i){_classCallCheck$4(this,e),_defineProperty$5(this,"duration",1024),_defineProperty$5(this,"flag",{dependsOn:2,isNonSyncSample:0}),_defineProperty$5(this,"keyframe",!0),this.originPts=this.pts=this.dts=t,this.data=r,this.size=r.byteLength,this.sampleOffset=i,n&&(this.duration=n)}));function concatUint8Array$2(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=t.filter(Boolean);var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){n.set(e,i),i+=e.byteLength})),n}var MAX_SIZE=Math.pow(2,32);function readBig16(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<8)+(e[t+1]||0)}function readBig24(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<16)+(e[t+1]<<8)+(e[t+2]||0)}function readBig32(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<24>>>0)+(e[t+1]<<16)+(e[t+2]<<8)+(e[t+3]||0)}function readBig64(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return readBig32(e,t)*MAX_SIZE+readBig32(e,t+4)}function getAvcCodec(e){for(var t,r="avc1.",n=0;n<3;n++)(t=e[n].toString(16)).length<2&&(t="0".concat(t)),r+=t;return r}function formatIV(e){var t="";if(e.forEach((function(e){t+=bufferToString(e)})),t.length<=32)for(var r=32-t.length,n=0;n<r;n++)t+="0";return t}function parse(e){if(!Array.isArray(e)){for(var t=[],r="",n=0;n<e.length;n++)n%2&&(r=e[n-1]+e[n],t.push(parseInt(r,16)),r="");return t}return e.map((function(e){return parseInt(e,16)}))}function bufferToString(e){return("0"+Number(e).toString(16)).slice(-2).toUpperCase()}var VideoSample=function(){function e(t,r,n){_classCallCheck$4(this,e),_defineProperty$5(this,"flag",{}),_defineProperty$5(this,"keyframe",!1),_defineProperty$5(this,"gopId",0),_defineProperty$5(this,"duration",0),_defineProperty$5(this,"size",0),_defineProperty$5(this,"units",[]),_defineProperty$5(this,"chromaFormat",420),this.originPts=this.pts=t,this.originDts=this.dts=r,n&&(this.units=n)}return _createClass$5(e,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),e}(),MetadataTrack=function(){function e(){_classCallCheck$4(this,e),_defineProperty$5(this,"id",3),_defineProperty$5(this,"type",TrackType$1.METADATA),_defineProperty$5(this,"timescale",0),_defineProperty$5(this,"flvScriptSamples",[]),_defineProperty$5(this,"seiSamples",[])}return _createClass$5(e,[{key:"exist",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length||!this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length)}}]),e}(),VideoTrack=function(){function e(){_classCallCheck$4(this,e),_defineProperty$5(this,"id",1),_defineProperty$5(this,"type",TrackType$1.VIDEO),_defineProperty$5(this,"codecType",VideoCodecType$1.AVC),_defineProperty$5(this,"pid",-1),_defineProperty$5(this,"hvcC",null),_defineProperty$5(this,"codec",""),_defineProperty$5(this,"timescale",0),_defineProperty$5(this,"formatTimescale",0),_defineProperty$5(this,"sequenceNumber",0),_defineProperty$5(this,"baseMediaDecodeTime",0),_defineProperty$5(this,"baseDts",0),_defineProperty$5(this,"duration",0),_defineProperty$5(this,"warnings",[]),_defineProperty$5(this,"samples",[]),_defineProperty$5(this,"pps",[]),_defineProperty$5(this,"sps",[]),_defineProperty$5(this,"vps",[]),_defineProperty$5(this,"fpsNum",0),_defineProperty$5(this,"fpsDen",0),_defineProperty$5(this,"sarRatio",[]),_defineProperty$5(this,"width",0),_defineProperty$5(this,"height",0),_defineProperty$5(this,"nalUnitSize",4),_defineProperty$5(this,"present",!1),_defineProperty$5(this,"isVideoEncryption",!1),_defineProperty$5(this,"isAudioEncryption",!1),_defineProperty$5(this,"default_KID",null),_defineProperty$5(this,"kid",null),_defineProperty$5(this,"pssh",null),_defineProperty$5(this,"ext",void 0)}return _createClass$5(e,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"exist",value:function(){return!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}}]),e}(),AudioTrack=function(){function e(){_classCallCheck$4(this,e),_defineProperty$5(this,"id",2),_defineProperty$5(this,"type",TrackType$1.AUDIO),_defineProperty$5(this,"codecType",AudioCodecType.AAC),_defineProperty$5(this,"pid",-1),_defineProperty$5(this,"codec",""),_defineProperty$5(this,"sequenceNumber",0),_defineProperty$5(this,"sampleDuration",0),_defineProperty$5(this,"timescale",0),_defineProperty$5(this,"formatTimescale",0),_defineProperty$5(this,"baseMediaDecodeTime",0),_defineProperty$5(this,"duration",0),_defineProperty$5(this,"warnings",[]),_defineProperty$5(this,"samples",[]),_defineProperty$5(this,"baseDts",0),_defineProperty$5(this,"sampleSize",16),_defineProperty$5(this,"sampleRate",0),_defineProperty$5(this,"channelCount",0),_defineProperty$5(this,"objectType",0),_defineProperty$5(this,"sampleRateIndex",0),_defineProperty$5(this,"config",[]),_defineProperty$5(this,"present",!1),_defineProperty$5(this,"isVideoEncryption",!1),_defineProperty$5(this,"isAudioEncryption",!1),_defineProperty$5(this,"default_KID",null),_defineProperty$5(this,"kid",null),_defineProperty$5(this,"ext",void 0)}return _createClass$5(e,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}}]),e}(),Buffer=function(){function e(){_classCallCheck$4(this,e),this.buffer=new Uint8Array(0)}return _createClass$5(e,[{key:"write",value:function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r.forEach((function(t){t?e.buffer=lib$1(Uint8Array,e.buffer,t):window.console.warn(t)}))}}],[{key:"writeUint16",value:function(e){return new Uint8Array([e>>8&255,255&e])}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}}]),e}(),Buffer$1=Buffer,UINT32_MAX$1=Math.pow(2,32)-1,MP4$2=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"box",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=8+(r=r.filter(Boolean)).reduce((function(e,t){return e+t.byteLength}),0),a=new Uint8Array(i);a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(e,4);var o=8;return r.forEach((function(e){a.set(e,o),o+=e.byteLength})),a}},{key:"ftyp",value:function(t){return t.find((function(e){return e.type===TrackType$1.VIDEO&&e.codecType===VideoCodecType$1.HEVC}))?e.FTYPHEV1:e.FTYPAVC1}},{key:"initSegment",value:function(t){return concatUint8Array$2(e.ftyp(t),e.moov(t))}},{key:"pssh",value:function(t){var r=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],parse(t.kid),[0,0,0,0]));return e.box(e.types.pssh,r)}},{key:"moov",value:function(t){if(t[0].useEME&&(t[0].encv||t[0].enca)){t[0].pssh||(t[0].pssh={kid:t[0].kid});var r=this.pssh(t[0].pssh);return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion,t[0].mvhdTimecale),e.mvex(t)].concat(_toConsumableArray$1(t.map((function(t){return e.trak(t)}))),[r]))}return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion,t[0].mvhdTimecale),e.mvex(t)].concat(_toConsumableArray$1(t.map((function(t){return e.trak(t)})))))}},{key:"mvhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,n=e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3]));return n}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.tkhdDuration,t.width,t.height),e.mdia(t))}},{key:"tkhd",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=e.box(e.types.tkhd,new Uint8Array([0,0,0,3,0,0,0,0,217,172,236,86,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1===t?1:0,2===t?1:0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]));return a}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minf(t))}},{key:"mdhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,n=e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,217,20,37,90,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,21,199,0,0]));return n}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"minf",value:function(t){return e.box(e.types.minf,t.type===TrackType$1.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stbl(t))}},{key:"stbl",value:function(t){var r=[];return t&&t.ext&&t.ext.stss&&r.push(e.stss(t.ext.stss.entries)),e.box(e.types.stbl,e.stsd(t),e.STTS,r[0],e.STSC,e.STSZ,e.STCO)}},{key:"stsd",value:function(t){var r;return r="audio"===t.type?t.useEME&&t.enca?e.enca(t):e.mp4a(t):t.useEME&&t.encv?e.encv(t):e.avc1hev1(t),e.box(e.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),r)}},{key:"enca",value:function(t){var r=t.enca.channelCount,n=t.enca.sampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,n>>8&255,255&n,0,0]),a=e.esds(t.config),o=e.sinf(t.enca);return e.box(e.types.enca,i,a,o)}},{key:"encv",value:function(t){var r,n,i=t.sps.length>0?t.sps[0]:[],a=t.pps.length>0?t.pps[0]:[],o=t.width,s=t.height,u=t.sarRatio[0],c=t.sarRatio[1],l=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,s>>8&255,255&s,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d=new Uint8Array((r=(n=[1,i[1],i[2],i[3],255,225,i.length>>>8&255,255&i.length]).concat.apply(n,_toConsumableArray$1(i)).concat([1,a.length>>>8&255,255&a.length])).concat.apply(r,_toConsumableArray$1(a))),h=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),f=e.sinf(t.encv),p=new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,c>>24,c>>16&255,c>>8&255,255&c]);return e.box(e.types.encv,l,e.box(e.types.avcC,d),e.box(e.types.btrt,h),f,e.box(e.types.pasp,p))}},{key:"schi",value:function(t){var r=new Uint8Array([]),n=e.tenc(t);return e.box(e.types.schi,r,n)}},{key:"tenc",value:function(t){var r=new Uint8Array([0,0,0,0,0,0,255&t.default_IsEncrypted,255&t.default_IV_size].concat(parse(t.default_KID)));return e.box(e.types.tenc,r)}},{key:"sinf",value:function(t){var r=new Uint8Array([]),n=new Uint8Array([t.data_format.charCodeAt(0),t.data_format.charCodeAt(1),t.data_format.charCodeAt(2),t.data_format.charCodeAt(3)]),i=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),a=e.schi(t);return e.box(e.types.sinf,r,e.box(e.types.frma,n),e.box(e.types.schm,i),a)}},{key:"avc1hev1",value:function(t){var r=t.codecType===VideoCodecType$1.HEVC,n=r?e.types.hvc1:e.types.avc1,i=r?t.hvcC?t.hvcC:e.hvcC():e.avcC(t),a=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),i];return r?a.push(e.box(e.types.fiel,new Uint8Array([1,0]))):t.sarRatio&&t.sarRatio.length>1&&a.push(e.pasp(t.sarRatio)),e.box.apply(e,[n].concat(a))}},{key:"avcC",value:function(t){var r,n,i,a=[],o=[];return t.sps.forEach((function(e){i=e.byteLength,a.push(i>>>8&255),a.push(255&i),a.push.apply(a,_toConsumableArray$1(e))})),t.pps.forEach((function(e){i=e.byteLength,o.push(i>>>8&255),o.push(255&i),o.push.apply(o,_toConsumableArray$1(e))})),e.box(e.types.avcC,new Uint8Array((r=(n=[1,a[3],a[4],a[5],255,224|t.sps.length]).concat.apply(n,a).concat([t.pps.length])).concat.apply(r,o)))}},{key:"hvcC",value:function(){return e.box(e.types.hvcC,new Uint8Array([1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64]))}},{key:"pasp",value:function(t){var r=_slicedToArray$1(t,2),n=r[0],i=r[1];return e.box(e.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i]))}},{key:"mp4a",value:function(t){return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,255&t.sampleRate,0,0]),t.config.length?e.esds(t.config):void 0)}},{key:"esds",value:function(t){var r=t.length;return e.box(e.types.esds,new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(t).concat([6,1,2])))}},{key:"mvex",value:function(t){var r=e.box(e.types.mehd,this.extension(0,0),Buffer$1.writeUint32(t[0].tkhdDuration));return e.box(e.types.mvex,r,e.trex1(1),e.trex2(2))}},{key:"trex",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trex1",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]))}},{key:"trex2",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]))}},{key:"moof",value:function(t){return e.box.apply(e,[e.types.moof,e.mfhd(t[0].gopId)].concat(_toConsumableArray$1(t.map((function(t){return e.traf(t)})))))}},{key:"mfhd",value:function(t){return t+=1,e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"traf",value:function(t){var r=e.tfhd(t.id),n=e.tfdt(t,t.baseMediaDecodeTime);if(t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)){if(t.isVideoEncryption){if(1===t.id){var i=e.saiz(t),a=e.saio(t),o=e.trun1(t),s=e.senc(t);return e.box(e.types.traf,r,n,i,a,o,s)}if(t.isAudioEncryption){var u=e.sbgp(),c=e.saiz(t),l=e.saio(t),d=e.senc(t),h=e.trun1(t);return e.box(e.types.traf,r,n,u,c,l,d,h)}var f=e.sbgp(),p=e.trun1(t);return e.box(e.types.traf,r,n,f,p)}if(1===t.id){var g=e.trun1(t);return e.box(e.types.traf,r,n,g)}var y=e.sbgp(),m=e.saiz(t),v=e.saio(t),_=e.senc(t),b=e.trun1(t);return e.box(e.types.traf,r,n,y,m,v,_,b)}var A=e.sdtp(t);return e.box(e.types.traf,r,n,A,e.trun(t.samples,A.byteLength+76))}},{key:"sdtp",value:function(t){var r=new Buffer$1;return t.samples.forEach((function(e){r.write(new Uint8Array(1===t.id?[e.keyframe?32:16]:[16]))})),e.box(e.types.sdtp,this.extension(0,0),r.buffer)}},{key:"trun1",value:function(t){var r=new Buffer$1,n=Buffer$1.writeUint32(t.samples.length),i=null;if(1===t.id){var a=t.videoSencLength;i=Buffer$1.writeUint32(16*t.samples.length+a+149),!t.isVideoEncryption&&t.isAudioEncryption&&(i=Buffer$1.writeUint32(16*t.samples.length+92))}else{var o=12*t.samples.length+124;t.isAudioEncryption&&(o=12*t.samples.length+8*t.audioSenc.length+177),i=Buffer$1.writeUint32(o)}return t.samples.forEach((function(e){r.write(Buffer$1.writeUint32(e.duration)),r.write(Buffer$1.writeUint32(e.size)),r.write(Buffer$1.writeUint32(e.keyframe?33554432:65536)),1===t.id&&r.write(Buffer$1.writeUint32(e.cts?e.cts:0))})),e.box(e.types.trun,this.extension(0,t.flags),n,i,r.buffer)}},{key:"senc",value:function(t){var r=new Buffer$1,n=t.samples.length,i=1===t.id?16:8,a=1===t.id?2:0,o=[],s=0;return 1===t.id?(o=t.videoSenc,s=t.videoSencLength):o=t.audioSenc,s=s||i*n,r.write(Buffer$1.writeUint32(16+s),e.types.senc,this.extension(0,a)),r.write(Buffer$1.writeUint32(n)),o.forEach((function(e){for(var t=0;t<e.InitializationVector.length;t++)r.write(new Uint8Array([e.InitializationVector[t]]));e.subsamples&&e.subsamples.length&&(r.write(Buffer$1.writeUint16(e.subsamples.length)),e.subsamples.forEach((function(e){r.write(Buffer$1.writeUint16(e.BytesOfClearData)),r.write(Buffer$1.writeUint32(e.BytesOfProtectedData))})))})),r.buffer}},{key:"saio",value:function(t){var r=12*t.samples.length+141;2===t.id&&t.isAudioEncryption&&(r=149);var n=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r]);return e.box(e.types.saio,n)}},{key:"saiz",value:function(t){var r=t.samples.length,n=new Uint8Array([0,0,0,0,16,r>>24&255,r>>16&255,r>>8&255,255&r]);return e.box(e.types.saiz,n)}},{key:"sbgp",value:function(){var t=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return e.box(e.types.sbgp,this.extension(0,0),t)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"tfhd",value:function(t){return e.box(e.types.tfhd,new Uint8Array([0,2,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"tfdt",value:function(t,r){var n=Math.floor(r/(UINT32_MAX$1+1)),i=Math.floor(r%(UINT32_MAX$1+1));return t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)?e.box(e.types.tfdt,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])):e.box(e.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i]))}},{key:"trun",value:function(t,r){var n=t.length,i=12+16*n;r+=8+i;var a=new Uint8Array(i);a.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0);for(var o=0;o<n;o++){var s=t[o],u=s.duration,c=s.size,l=s.flag,d=void 0===l?{}:l,h=s.cts,f=void 0===h?0:h;a.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,c>>>24&255,c>>>16&255,c>>>8&255,255&c,d.isLeading<<2|(null==d.dependsOn?1:d.dependsOn),d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|(null==d.isNonSyncSample?1:d.isNonSyncSample),61440&d.degradationPriority,15&d.degradationPriority,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*o)}return e.box(e.types.trun,a)}},{key:"moovMP4",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat(_toConsumableArray$1(t.map((function(t){return e.trackMP4(t)})))))}},{key:"trackMP4",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdiaMP4(t))}},{key:"mdiaMP4",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minfMP4(t))}},{key:"minfMP4",value:function(t){return e.box(e.types.minf,t.type===TrackType$1.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stblMP4(t))}},{key:"stblMP4",value:function(t){var r=t.ext,n=[e.stsd(t),e.stts(r.stts),e.stsc(r.stsc),e.stsz(r.stsz),e.stco(r.stco)];return r.stss.length&&n.push(e.stss(r.stss.entries)),r.ctts.length,e.box.apply(e,[e.types.stbl].concat(n))}},{key:"stts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.stts,concatUint8Array$2(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsc",value:function(t){var r=t.length,n=new Uint8Array(12*r),i=0;return t.forEach((function(e){var t=e.firstChunk,r=e.samplesPerChunk,a=e.sampleDescIndex;n.set([t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a],i),i+=12})),e.box(e.types.stsc,concatUint8Array$2(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsz",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stsz,concatUint8Array$2(new Uint8Array([0,0,0,0,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stco",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stco,concatUint8Array$2(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stss",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stss,concatUint8Array$2(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"ctts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.ctts,concatUint8Array$2(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"styp",value:function(){return e.box(e.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(t){var r=t.timescale,n=t.samples[0].duration,i=n*t.samples.length,a=t.samples[0].sampleOffset*n,o=8;t.samples.forEach((function(e){o+=e.size}));var s=0;if(1===t.id){var u,c=0;t.videoSenc&&(u=t.videoSenc),1===t.id&&u.forEach((function(e){c+=8,e.subsamples&&e.subsamples.length&&(c+=2,c+=6*e.subsamples.length)})),t.videoSencLength=c,s=o+141+16*t.samples.length+c,t.useEME&&t.isAudioEncryption&&!t.isVideoEncryption&&(s=o+16*t.samples.length+84)}else s=o+116+12*t.samples.length,t.useEME&&t.isAudioEncryption&&(s=o+169+12*t.samples.length+8*t.audioSenc.length);var l=new Uint8Array([0,0,0,0,0,0,0,255&t.id,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,1,0,s>>16&255,s>>8&255,255&s,i>>24&255,i>>16&255,i>>8&255,255&i,144,0,0,0]);return e.box(e.types.sidx,l)}},{key:"mdat",value:function(t){for(var r,n=new Buffer$1,i=0,a=t.samples.length;i<a;i++)r=t.samples[i],n.write(r.data);return t.useEME,e.box(e.types.mdat,n.buffer)}}]),e}();_defineProperty$5(MP4$2,"types",["avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp"].reduce((function(e,t){return e[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)],e}),Object.create(null))),_defineProperty$5(MP4$2,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])}),_defineProperty$5(MP4$2,"FTYPAVC1",MP4$2.box(MP4$2.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))),_defineProperty$5(MP4$2,"FTYPHEV1",MP4$2.box(MP4$2.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49]))),_defineProperty$5(MP4$2,"DINF",MP4$2.box(MP4$2.types.dinf,MP4$2.box(MP4$2.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])))),_defineProperty$5(MP4$2,"VMHD",MP4$2.box(MP4$2.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))),_defineProperty$5(MP4$2,"SMHD",MP4$2.box(MP4$2.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0]))),_defineProperty$5(MP4$2,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0])),_defineProperty$5(MP4$2,"STTS",MP4$2.box(MP4$2.types.stts,MP4$2.StblTable)),_defineProperty$5(MP4$2,"STSC",MP4$2.box(MP4$2.types.stsc,MP4$2.StblTable)),_defineProperty$5(MP4$2,"STSZ",MP4$2.box(MP4$2.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]))),_defineProperty$5(MP4$2,"STCO",MP4$2.box(MP4$2.types.stco,MP4$2.StblTable));var Logger$2=function(){function e(t,r){_classCallCheck$4(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]"),e.disabled=r}return _createClass$5(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).debug.apply(t,[this._prefix].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,[this._prefix].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).error.apply(t,[this._prefix].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();_defineProperty$5(Logger$2,"disabled",!0);var FMP4Remuxer=function(){function e(t,r,n){_classCallCheck$4(this,e),this.videoTrack=t,this.audioTrack=r,this.log=new Logger$2("FMP4Remuxer",!n||!n.openLog||!n.openLog)}return _createClass$5(e,[{key:"remux",value:function(){var e,t,r,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this.videoTrack,o=this.audioTrack,s=a.exist(),u=o.exist();a.duration=a.duration||4294967295,o.duration=o.duration||4294967295;var c,l,d=[];return n&&(i&&i.initMerge?(s&&d.push(this.videoTrack),u&&d.push(this.audioTrack),r=MP4$2.initSegment(d)):(s&&(e=MP4$2.initSegment([this.videoTrack])),u&&(t=MP4$2.initSegment([this.audioTrack])))),s&&a.hasSample()&&(c=this._remuxVideo()),u&&o.hasSample()&&(l=this._remuxAudio()),a.samples=[],o.samples=[],{initSegment:r,videoInitSegment:e,audioInitSegment:t,videoSegment:c,audioSegment:l}}},{key:"_remuxVideo",value:function(){var e=this.videoTrack;return e.isVideoEncryption||e.isAudioEncryption?concatUint8Array$2(MP4$2.styp(),MP4$2.sidx(e),MP4$2.moof([e]),MP4$2.mdat(e)):concatUint8Array$2(MP4$2.moof([e]),MP4$2.mdat(e))}},{key:"_remuxAudio",value:function(){var e=this.audioTrack;return e.useEME||e.isVideoEncryption||e.isAudioEncryption?concatUint8Array$2(MP4$2.styp(),MP4$2.sidx(e),MP4$2.moof([e]),MP4$2.mdat(e)):concatUint8Array$2(MP4$2.moof([e]),MP4$2.mdat(e))}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}]),e}(),MP4Parser=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"findBox",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=[];if(!t)return i;for(var a=0,o="",s=0;t.length>7;){if(a=readBig32(t),o=String.fromCharCode.apply(null,t.subarray(4,8)),s=8,1===a?(a=readBig64(t,8),s+=8):a||(a=t.length),!r[0]||o===r[0]){var u=t.subarray(0,a);if(!(r.length<2))return e.findBox(u.subarray(s),r.slice(1),n+s);i.push({start:n,size:a,headerSize:s,type:o,data:u})}n+=a,t=t.subarray(a)}return i}},{key:"moof",value:function(t){return parseBox(t,!1,(function(t,r,n){t.mfhd=e.mfhd(e.findBox(r,["mfhd"])[0]),t.traf=[],e.findBox(r,["traf"]).map((function(r){t.traf.push(e.traf(r))}))}))}},{key:"traf",value:function(t){return parseBox(t,!1,(function(t,r){t.tfhd=e.tfhd(e.findBox(r,["tfhd"])[0]),t.tfdt=e.tfdt(e.findBox(r,["tfdt"])[0]),t.trun=e.trun(e.findBox(r,["trun"])[0])}))}},{key:"mfhd",value:function(e){return parseBox(e,!0,(function(e,t){e.sequence_number=readBig32(t)}))}},{key:"trun",value:function(e){var t=this;return parseBox(e,!0,(function(e,r){e.samples=[];var n,i=1&e.flags,a=4&e.flags,o=256&e.flags,s=512&e.flags,u=1024&e.flags,c=2048&e.flags,l=readBig32(r),d=4;for(i&&(e.dataOffset=readBig32(r,d),d+=4),a&&l&&(n={flags:t.parseSampleFlags([r[d],r[d+1],r[d+2],r[d+3]])},d+=4,o&&(n.duration=readBig32(r,d),d+=4),s&&(n.size=readBig32(r,d),d+=4),c&&(n.compositionTimeOffset=readBig32(r,d),d+=4),e.samples.push(n),l--);l--;)n={},o&&(n.duration=readBig32(r,d),d+=4),s&&(n.size=readBig32(r,d),d+=4),u&&(n.flags=t.parseSampleFlags([r[d],r[d+1],r[d+2],r[d+3]]),d+=4),c&&(n.compositionTimeOffset=readBig32(r,d),d+=4),e.samples.push(n)}))}},{key:"tfdt",value:function(e){return parseBox(e,!0,(function(e,t){1===e.version?e.baseMediaDecodeTime=readBig64(t):e.baseMediaDecodeTime=readBig32(t)}))}},{key:"tfhd",value:function(e){return parseBox(e,!0,(function(e,t){e.track_id=readBig32(t);var r=4,n=1&e.flags,i=2&e.flags,a=8&e.flags,o=16&e.flags,s=32&e.flags;n&&(r+=4,e.baseDataOffset=readBig32(t,r),r+=4),i&&(e.sampleDescriptionIndex=readBig32(t,r),r+=4),a&&(e.defaultSampleDuration=readBig32(t,r),r+=4),o&&(e.defaultSampleSize=readBig32(t,r),r+=4),s&&(e.defaultSampleFlags=readBig32(t,r))}))}},{key:"sidx",value:function(e){return parseBox(e,!0,(function(e,t){var r=0;e.reference_ID=readBig32(t,r),r+=4,e.timescale=readBig32(t,r),r+=4,0===e.version?(e.earliest_presentation_time=readBig32(t,r),r+=4,e.first_offset=readBig32(t,r),r+=4):(e.earliest_presentation_time=readBig64(t,r),r+=8,e.first_offset=readBig64(t,r),r+=8),r+=2,e.references=[];var n=readBig16(t,r);r+=2;for(var i=0;i<n;i++){var a={};e.references.push(a);var o=readBig32(t,r);r+=4,a.reference_type=o>>31&1,a.referenced_size=2147483647&o,a.subsegment_duration=readBig32(t,r),o=readBig32(t,r+=4),r+=4,a.starts_with_SAP=o>>31&1,a.SAP_type=o>>28&7,a.SAP_delta_time=268435455&o}}))}},{key:"moov",value:function(t){return parseBox(t,!1,(function(t,r,n){t.mvhd=e.mvhd(e.findBox(r,["mvhd"],n)[0]),t.trak=e.findBox(r,["trak"],n).map((function(t){return e.trak(t)})),t.pssh=e.pssh(e.findBox(r,["pssh"],n)[0])}))}},{key:"mvhd",value:function(e){return parseBox(e,!0,(function(e,t){var r=0;1===e.version?(e.timescale=readBig32(t,16),e.duration=readBig64(t,20),r+=28):(e.timescale=readBig32(t,8),e.duration=readBig32(t,12),r+=16),e.nextTrackId=readBig32(t,r+76)}))}},{key:"trak",value:function(t){return parseBox(t,!1,(function(t,r,n){t.tkhd=e.tkhd(e.findBox(r,["tkhd"],n)[0]),t.mdia=e.mdia(e.findBox(r,["mdia"],n)[0])}))}},{key:"tkhd",value:function(e){return parseBox(e,!0,(function(e,t){var r=0;1===e.version?(e.trackId=readBig32(t,16),e.duration=readBig64(t,24),r+=32):(e.trackId=readBig32(t,8),e.duration=readBig32(t,16),r+=20),e.width=readBig32(t,r+52),e.height=readBig32(t,r+56)}))}},{key:"mdia",value:function(t){return parseBox(t,!1,(function(t,r,n){t.mdhd=e.mdhd(e.findBox(r,["mdhd"],n)[0]),t.hdlr=e.hdlr(e.findBox(r,["hdlr"],n)[0]),t.minf=e.minf(e.findBox(r,["minf"],n)[0])}))}},{key:"mdhd",value:function(e){return parseBox(e,!0,(function(e,t){var r=0;1===e.version?(e.timescale=readBig32(t,16),e.duration=readBig64(t,20),r+=28):(e.timescale=readBig32(t,8),e.duration=readBig32(t,12),r+=16);var n=readBig16(t,r);e.language=String.fromCharCode(96+(n>>10&31),96+(n>>5&31),96+(31&n))}))}},{key:"hdlr",value:function(e){return parseBox(e,!0,(function(e,t){0===e.version&&(e.handlerType=String.fromCharCode.apply(null,t.subarray(4,8)))}))}},{key:"minf",value:function(t){return parseBox(t,!1,(function(t,r,n){t.vmhd=e.vmhd(e.findBox(r,["vmhd"],n)[0]),t.smhd=e.smhd(e.findBox(r,["smhd"],n)[0]),t.stbl=e.stbl(e.findBox(r,["stbl"],n)[0])}))}},{key:"vmhd",value:function(e){return parseBox(e,!0,(function(e,t){e.graphicsmode=readBig16(t),e.opcolor=[readBig16(t,2),readBig16(t,4),readBig16(t,6)]}))}},{key:"smhd",value:function(e){return parseBox(e,!0,(function(e,t){e.balance=readBig16(t)}))}},{key:"stbl",value:function(t){return parseBox(t,!1,(function(t,r,n){t.stsd=e.stsd(e.findBox(r,["stsd"],n)[0]),t.stts=e.stts(e.findBox(r,["stts"],n)[0]),t.ctts=e.ctts(e.findBox(r,["ctts"],n)[0]),t.stsc=e.stsc(e.findBox(r,["stsc"],n)[0]),t.stsz=e.stsz(e.findBox(r,["stsz"],n)[0]),t.stco=e.stco(e.findBox(r,["stco"],n)[0]),t.stss=e.stss(e.findBox(r,["stss"],n)[0]),t.senc=e.senc(e.findBox(r,["senc"],n)[0])}))}},{key:"senc",value:function(e){return parseBox(e,!0,(function(e,t){var r=0,n=readBig32(t,r);r+=4,e.samples=[];for(var i=0;i<n;i++){var a={};if(a.InitializationVector=[t[r],t[r+1],t[r+2],t[r+3],t[r+4],t[r+5],t[r+6],t[r+7]],r+=8,2&e.flags){a.subsamples=[];var o=readBig16(t,r);r+=2;for(var s=0;s<o;s++){var u={};u.BytesOfClearData=readBig16(t,r),r+=2,u.BytesOfProtectedData=readBig32(t,r),r+=4,a.subsamples.push(u)}}e.samples.push(a)}}))}},{key:"pssh",value:function(e){return parseBox(e,!0,(function(e,t,r){for(var n=[],i=[],a=0;a<16;a++)i.push(toHex(t[r+a]));if(r+=16,e.version>0)for(var o=readBig32(t,r),s=0;s<(""+o).length;s++)for(var u=0;u<16;u++){var c=t[r];r+=1,n.push(toHex(c))}var l=readBig32();e.data_size=l,r+=l,e.kid=n,e.system_id=i,e.buffer=t}))}},{key:"stsd",value:function(t){return parseBox(t,!0,(function(t,r,n){t.entryCount=readBig32(r),t.entries=e.findBox(r.subarray(4),[],n+4).map((function(t){switch(t.type){case"avc1":case"avc2":case"avc3":case"avc4":return e.avc1(t);case"hvc1":case"hev1":return e.hvc1(t);case"mp4a":return e.mp4a(t);case"enca":return parseBox(t,!1,(function(t,r,n){t.channelCount=readBig16(r,16),t.samplesize=readBig16(r,18),t.sampleRate=readBig32(r,24)/65536,r=r.subarray(28),t.sinf=e.sinf(e.findBox(r,["sinf"],n)[0]),t.esds=e.esds(e.findBox(r,["esds"],n)[0])}));case"encv":return parseBox(t,!1,(function(t,r,n){t.width=readBig16(r,24),t.height=readBig16(r,26),t.horizresolution=readBig32(r,28),t.vertresolution=readBig32(r,32),r=r.subarray(78),t.sinf=e.sinf(e.findBox(r,["sinf"],n)[0]),t.avcC=e.avcC(e.findBox(r,["avcC"],n)[0]),t.hvcC=e.hvcC(e.findBox(r,["hvcC"],n)[0]),t.pasp=e.pasp(e.findBox(r,["pasp"],n)[0])}))}})).filter(Boolean)}))}},{key:"tenc",value:function(e){return parseBox(e,!1,(function(e,t){var r=6;e.default_IsEncrypted=t[r],r+=1,e.default_IV_size=t[r],r+=1,e.default_KID=[];for(var n=0;n<16;n++)e.default_KID.push(toHex(t[r])),r+=1}))}},{key:"schi",value:function(t){return parseBox(t,!1,(function(t,r,n){t.tenc=e.tenc(e.findBox(r,["tenc"],n)[0])}))}},{key:"sinf",value:function(t){return parseBox(t,!1,(function(t,r,n){t.schi=e.schi(e.findBox(r,["schi"],n)[0]),t.frma=e.frma(e.findBox(r,["frma"],n)[0])}))}},{key:"frma",value:function(e){return parseBox(e,!1,(function(e,t){e.data_format="";for(var r=0;r<4;r++)e.data_format+=String.fromCharCode(t[r])}))}},{key:"avc1",value:function(t){return parseBox(t,!1,(function(t,r,n){var i=parseVisualSampleEntry(t,r),a=r.subarray(i);n+=i,t.avcC=e.avcC(e.findBox(a,["avcC"],n)[0]),t.pasp=e.pasp(e.findBox(a,["pasp"],n)[0])}))}},{key:"avcC",value:function(e){return parseBox(e,!1,(function(e,t){e.configurationVersion=t[0],e.AVCProfileIndication=t[1],e.profileCompatibility=t[2],e.AVCLevelIndication=t[3],e.codec=getAvcCodec([t[1],t[2],t[3]]),e.lengthSizeMinusOne=3&t[4],e.spsLength=31&t[5],e.sps=[];for(var r=6,n=0;n<e.spsLength;n++){var i=readBig16(t,r);r+=2,e.sps.push(t.subarray(r,r+i)),r+=i}e.ppsLength=t[r],r+=1,e.pps=[];for(var a=0;a<e.ppsLength;a++){var o=readBig16(t,r);r+=2,e.pps.push(t.subarray(r,r+=o)),r+=o}}))}},{key:"hvc1",value:function(t){return parseBox(t,!1,(function(t,r,n){var i=parseVisualSampleEntry(t,r),a=r.subarray(i);n+=i,t.hvcC=e.hvcC(e.findBox(a,["hvcC"],n)[0]),t.pasp=e.pasp(e.findBox(a,["pasp"],n)[0])}))}},{key:"hvcC",value:function(e){return parseBox(e,!1,(function(t,r){t.data=e.data,t.codec="hev1.1.6.L93.B0",t.configurationVersion=r[0];var n=r[1];t.generalProfileSpace=n>>6,t.generalTierFlag=(32&n)>>5,t.generalProfileIdc=31&n,t.generalProfileCompatibility=readBig32(r,2),t.generalConstraintIndicatorFlags=r.subarray(6,12),t.generalLevelIdc=r[12],t.avgFrameRate=readBig16(r,19),t.numOfArrays=r[22],t.vps=[],t.sps=[],t.pps=[];for(var i=23,a=0,o=0,s=0,u=0;u<t.numOfArrays;u++){a=63&r[i],o=readBig16(r,i+1),i+=3;for(var c,l=[],d=0;d<o;d++)s=readBig16(r,i),i+=2,l.push(r.subarray(i,i+s)),i+=s;if(32===a)(c=t.vps).push.apply(c,l);else if(33===a){var h;(h=t.sps).push.apply(h,l)}else if(34===a){var f;(f=t.pps).push.apply(f,l)}}}))}},{key:"pasp",value:function(e){return parseBox(e,!1,(function(e,t){e.hSpacing=readBig32(t),e.vSpacing=readBig32(t,4)}))}},{key:"mp4a",value:function(t){return parseBox(t,!1,(function(t,r,n){var i=parseAudioSampleEntry(t,r);t.esds=e.esds(e.findBox(r.subarray(i),["esds"],n+i)[0])}))}},{key:"esds",value:function(e){return parseBox(e,!0,(function(e,t){e.codec="mp4a.";for(var r=0,n=0,i=0,a=0;t.length;){for(a=t[r=0],n=t[r+1],r+=2;128&n;)i=(127&n)<<7,n=t[r],r+=1;if(i+=127&n,3===a)t=t.subarray(r+3);else{if(4!==a){if(5===a){var o=e.config=t.subarray(r,r+i),s=(248&o[0])>>3;return 31===s&&o.length>=2&&(s=32+((7&o[0])<<3)+((224&o[1])>>5)),e.objectType=s,e.codec+=s.toString(16),void("."===e.codec[e.codec.length-1]&&(e.codec=e.codec.substring(0,e.codec.length-1)))}return void("."===e.codec[e.codec.length-1]&&(e.codec=e.codec.substring(0,e.codec.length-1)))}e.codec+=(t[r].toString(16)+".").padStart(3,"0"),t=t.subarray(r+13)}}}))}},{key:"stts",value:function(e){return parseBox(e,!0,(function(e,t){for(var r=readBig32(t),n=[],i=4,a=0;a<r;a++)n.push({count:readBig32(t,i),delta:readBig32(t,i+4)}),i+=8;e.entryCount=r,e.entries=n}))}},{key:"ctts",value:function(e){return parseBox(e,!0,(function(e,t){var r=readBig32(t),n=[],i=4;if(1===e.version)for(var a=0;a<r;a++)n.push({count:readBig32(t,i),offset:readBig32(t,i+4)}),i+=8;else for(var o=0;o<r;o++)n.push({count:readBig32(t,i),offset:-(1+~readBig32(t,i+4))}),i+=8;e.entryCount=r,e.entries=n}))}},{key:"stsc",value:function(e){return parseBox(e,!0,(function(e,t){for(var r=readBig32(t),n=[],i=4,a=0;a<r;a++)n.push({firstChunk:readBig32(t,i),samplesPerChunk:readBig32(t,i+4),sampleDescriptionIndex:readBig32(t,i+8)}),i+=12;e.entryCount=r,e.entries=n}))}},{key:"stsz",value:function(e){return parseBox(e,!0,(function(e,t){var r=readBig32(t),n=readBig32(t,4),i=[];if(!r)for(var a=8,o=0;o<n;o++)i.push(readBig32(t,a)),a+=4;e.sampleSize=r,e.sampleCount=n,e.entrySizes=i}))}},{key:"stco",value:function(e){return parseBox(e,!0,(function(e,t){for(var r=readBig32(t),n=[],i=4,a=0;a<r;a++)n.push(readBig32(t,i)),i+=4;e.entryCount=r,e.entries=n}))}},{key:"stss",value:function(e){return parseBox(e,!0,(function(e,t){for(var r=readBig32(t),n=[],i=4,a=0;a<r;a++)n.push(readBig32(t,i)),i+=4;e.entryCount=r,e.entries=n}))}},{key:"parseSampleFlags",value:function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}}},{key:"moovToTrack",value:function(e,t,r){var n=e.trak;if(n&&n.length){var i=n.find((function(e){var t,r;return"vide"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),a=n.find((function(e){var t,r;return"soun"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)}));if(i&&t){var o,s,u,c,l,d,h=t;h.tkhdDuration=i.tkhd.duration,h.mvhdDurtion=e.mvhd.duration,h.mvhdTimecale=e.mvhd.timescale,h.timescale=h.formatTimescale=i.mdia.mdhd.timescale,h.duration=i.mdia.mdhd.duration;var f,p,g,y,m,v,_,b,A=i.mdia.minf.stbl.stsd.entries[0];if(h.width=A.width,h.height=A.height,A.pasp&&(h.sarRatio=[A.pasp.hSpacing,A.pasp.vSpacing]),A.hvcC)h.codecType=VideoCodecType$1.HEVC,h.codec=A.hvcC.codec,h.vps=A.hvcC.vps,h.sps=A.hvcC.sps,h.pps=A.hvcC.pps,h.hvcC=A.hvcC.data;else{if(!A.avcC)throw new Error("unknown video stsd entry");h.codec=A.avcC.codec,h.sps=A.avcC.sps,h.pps=A.avcC.pps}if(h.present=!0,h.ext={},h.ext.stss=null===(o=i.mdia)||void 0===o||null===(s=o.minf)||void 0===s||null===(u=s.stbl)||void 0===u?void 0:u.stss,h.ext.ctts=null===(c=i.mdia)||void 0===c||null===(l=c.minf)||void 0===l||null===(d=l.stbl)||void 0===d?void 0:d.ctts,A&&"encv"===A.type)h.isVideoEncryption=!0,A.default_KID=null===(f=A.sinf)||void 0===f||null===(p=f.schi)||void 0===p?void 0:p.tenc.default_KID,A.default_IsEncrypted=null===(g=A.sinf)||void 0===g||null===(y=g.schi)||void 0===y?void 0:y.tenc.default_IsEncrypted,A.default_IV_size=null===(m=A.sinf)||void 0===m||null===(v=m.schi)||void 0===v?void 0:v.tenc.default_IV_size,h.videoSenc=i.mdia.minf.stbl.senc.samples,A.data_format=null===(_=A.sinf)||void 0===_||null===(b=_.frma)||void 0===b?void 0:b.data_format,h.useEME=e.useEME,h.kidValue=e.kidValue,h.pssh=e.pssh,h.encv=A}if(a&&r){var E,S,T,w,C,k,I,$,P=r;P.tkhdDuration=a.tkhd.duration,P.mvhdDurtion=e.mvhd.duration,P.mvhdTimecale=e.mvhd.timescale,P.timescale=P.formatTimescale=a.mdia.mdhd.timescale,P.duration=a.mdia.mdhd.duration;var x,R,O,D,L,M,N,B,U=a.mdia.minf.stbl.stsd.entries[0];if(P.sampleSize=U.sampleSize,P.sampleRate=U.sampleRate,P.channelCount=U.channelCount,P.sampleDuration=AAC.getFrameDuration(P.sampleRate,P.timescale),P.objectType=(null===(E=U.esds)||void 0===E?void 0:E.objectType)||2,U.esds&&(U.esds.config?P.config=Array.from(U.esds.config):console.warn("esds config is null")),P.codec=(null===(S=U.esds)||void 0===S?void 0:S.codec)||"mp4a.40.2",P.sampleRateIndex=AAC.getRateIndexByRate(P.sampleRate),P.ext={},P.ext.stss=null===(T=a.mdia)||void 0===T||null===(w=T.minf)||void 0===w||null===(C=w.stbl)||void 0===C?void 0:C.stss,P.ext.ctts=null===(k=a.mdia)||void 0===k||null===(I=k.minf)||void 0===I||null===($=I.stbl)||void 0===$?void 0:$.ctts,P.present=!0,U&&"enca"===U.type)r.isAudioEncryption=!0,r.isVideoEncryption=t.isVideoEncryption,t.isAudioEncryption=r.isAudioEncryption,P.isAudioEncryption=!0,U.data_format=null===(x=U.sinf)||void 0===x||null===(R=x.frma)||void 0===R?void 0:R.data_format,U.default_KID=null===(O=U.sinf)||void 0===O||null===(D=O.schi)||void 0===D?void 0:D.tenc.default_KID,U.default_IsEncrypted=null===(L=U.sinf)||void 0===L||null===(M=L.schi)||void 0===M?void 0:M.tenc.default_IsEncrypted,U.default_IV_size=null===(N=U.sinf)||void 0===N||null===(B=N.schi)||void 0===B?void 0:B.tenc.default_IV_size,P.audioSenc=a.mdia.minf.stbl.senc.samples,P.useEME=e.useEME,P.kidValue=e.kidValue,P.enca=U}return t.isVideoEncryption=r.isVideoEncryption,(t.encv||r.enca)&&(t.kid=(t.encv.default_KID||r.enca.default_KID).join(""),r.kid=t.kid),t.flags=3841,r.flags=1793,{videoTrack:t,audioTrack:r}}}},{key:"moovToSamples",value:function(e){var t=e.trak;if(t&&t.length){var r=t.find((function(e){var t,r;return"vide"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),n=t.find((function(e){var t,r;return"soun"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)}));if(r||n){var i,a,o=[];if(r){var s,u,c,l=null===(s=r.mdia)||void 0===s||null===(u=s.minf)||void 0===u?void 0:u.stbl;if(!l)return;var d=l.stts,h=l.stsc,f=l.stsz,p=l.stco,g=l.stss,y=l.ctts;if(!(d&&h&&f&&p&&g))return;var m=null===(c=r.mdia.mdhd)||void 0===c?void 0:c.timescale;i=getSamples(d,h,f,p,y,g);for(var v=0,_=0;_<i.length;_++)i[_].keyframe&&o.push(v/m),v+=i[_].duration}if(n){var b,A,E,S=null===(b=n.mdia)||void 0===b||null===(A=b.minf)||void 0===A?void 0:A.stbl;if(!S)return;var T=null===(E=n.mdia.mdhd)||void 0===E?void 0:E.timescale,w=S.stts,C=S.stsc,k=S.stsz,I=S.stco;if(!(T&&w&&C&&k&&I))return;a=getSamples(w,C,k,I);for(var $=0,P=0,x=0;x<a.length;x++)$+=a[x].duration,a[x].gopId=P,$/T>=o[P+1]&&P<o.length-1&&(P+=1)}return{videoSamples:i,audioSamples:a}}}}}]),e}();function getSamples(e,t,r,n,i,a){var o,s,u,c=[],l=null==i?void 0:i.entries,d=t.entries,h=n.entries,f=r.entrySizes,p=null==a?void 0:a.entries;p&&(o={},p.forEach((function(e){o[e-1]=!0}))),l&&(s=[],l.forEach((function(e){for(var t=e.count,r=e.offset,n=0;n<t;n++)s.push(r)})));var g=-1,y=0,m=0,v=0,_=0,b=0,A=d[0].samplesPerChunk,E=d[1]?d[1].firstChunk-1:1/0;return e.entries.forEach((function(e){for(var t=e.count,n=e.delta,i=0;i<t;i++)u={dts:y,duration:n,size:f[m]||r.sampleSize,offset:h[v]+b,index:m},p&&(u.keyframe=o[m],u.keyframe&&g++,u.gopId=g),s&&m<s.length&&(u.pts=u.dts+s[m]),c.push(u),y+=n,++m<A?b+=u.size:(v++,b=0,v>=E&&(_++,E=d[_+1]?d[_+1].firstChunk-1:1/0),A+=d[_].samplesPerChunk)})),c}function parseVisualSampleEntry(e,t){return e.dataReferenceIndex=readBig16(t,6),e.width=readBig16(t,24),e.height=readBig16(t,26),e.horizresolution=readBig32(t,28),e.vertresolution=readBig32(t,32),e.frameCount=readBig16(t,40),e.depth=readBig16(t,74),78}function parseAudioSampleEntry(e,t){return e.dataReferenceIndex=readBig16(t,6),e.channelCount=readBig16(t,16),e.sampleSize=readBig16(t,18),e.sampleRate=readBig32(t,24)/65536,28}function parseBox(e,t,r){if(e){if(e.size!==e.data.length)throw new Error("box ".concat(e.type," size !== data.length"));var n={start:e.start,size:e.size,headerSize:e.headerSize,type:e.type};return t&&(n.version=e.data[e.headerSize],n.flags=readBig24(e.data,e.headerSize+1),n.headerSize+=4),r(n,e.data.subarray(n.headerSize),n.start+n.headerSize),n}}for(var padStart=function(e,t,r){for(var n=String(r),i=t>>0,a=Math.ceil(i/n.length),o=[],s=String(e);a--;)o.push(n);return o.join("").substring(0,i-s.length)+s},toHex=function(){for(var e=[],t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach((function(t){e.push(padStart(Number(t).toString(16),2,0))})),e[0]},Base=function(){function e(){_classCallCheck$8(this,e)}return _createClass$9(e,[{key:"mixIn",value:function(e){return Object.assign(this,e)}},{key:"clone",value:function(){var e=new this.constructor;return Object.assign(e,this),e}}],[{key:"create",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return _construct$4(this,t)}}]),e}(),WordArray=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4*n.length;_classCallCheck$8(this,r),e=t.call(this);var a=n;if(a instanceof ArrayBuffer&&(a=new Uint8Array(a)),(a instanceof Int8Array||a instanceof Uint8ClampedArray||a instanceof Int16Array||a instanceof Uint16Array||a instanceof Int32Array||a instanceof Uint32Array||a instanceof Float32Array||a instanceof Float64Array)&&(a=new Uint8Array(a.buffer,a.byteOffset,a.byteLength)),a instanceof Uint8Array){for(var o=a.byteLength,s=[],u=0;u<o;u+=1)s[u>>>2]|=a[u]<<24-u%4*8;e.words=s,e.sigBytes=o}else e.words=n,e.sigBytes=i;return e}return _createClass$9(r,[{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Hex;return e.stringify(this)}},{key:"concat",value:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var a=0;a<i;a+=1){var o=r[a>>>2]>>>24-a%4*8&255;t[n+a>>>2]|=o<<24-(n+a)%4*8}else for(var s=0;s<i;s+=4)t[n+s>>>2]=r[s>>>2];return this.sigBytes+=i,this}},{key:"clamp",value:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=Math.ceil(t/4)}},{key:"clone",value:function(){var e=_get$2(_getPrototypeOf$8(r.prototype),"clone",this).call(this);return e.words=this.words.slice(0),e}}],[{key:"random",value:function(e){for(var t,n=[],i=function(e){var t=e,r=987654321,n=4294967295;return function(){var e=((r=36969*(65535&r)+(r>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return e/=4294967296,(e+=.5)*(Math.random()>.5?1:-1)}},a=0;a<e;a+=4){var o=i(4294967296*(t||Math.random()));t=987654071*o(),n.push(4294967296*o()|0)}return new r(n,e)}}]),r}(Base),Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i+=1){var a=t[i>>>2]>>>24-i%4*8&255;n.push((a>>>4).toString(16)),n.push((15&a).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new WordArray(r,t/2)}},Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i+=1){var a=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(a))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=1)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new WordArray(r,t)}},Utf8={stringify:function(t){try{return decodeURIComponent(escape(Latin1.stringify(t)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return Latin1.parse(unescape(encodeURIComponent(e)))}},BufferedBlockAlgorithm=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){var e;return _classCallCheck$8(this,r),(e=t.call(this))._minBufferSize=0,e}return _createClass$9(r,[{key:"reset",value:function(){this._data=new WordArray,this._nDataBytes=0}},{key:"_append",value:function(e){var t=e;"string"==typeof t&&(t=Utf8.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}},{key:"_process",value:function(e){var t,r=this._data,n=this.blockSize,i=r.words,a=r.sigBytes,o=a/(4*n),s=(o=e?Math.ceil(o):Math.max((0|o)-this._minBufferSize,0))*n,u=Math.min(4*s,a);if(s){for(var c=0;c<s;c+=n)this._doProcessBlock(i,c);t=i.splice(0,s),r.sigBytes-=u}return new WordArray(t,u)}},{key:"clone",value:function(){var e=_get$2(_getPrototypeOf$8(r.prototype),"clone",this).call(this);return e._data=this._data.clone(),e}}]),r}(Base),Hasher=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),(n=t.call(this)).blockSize=16,n.cfg=Object.assign(new Base,e),n.reset(),n}return _createClass$9(r,[{key:"reset",value:function(){_get$2(_getPrototypeOf$8(r.prototype),"reset",this).call(this),this._doReset()}},{key:"update",value:function(e){return this._append(e),this._process(),this}},{key:"finalize",value:function(e){return e&&this._append(e),this._doFinalize()}}],[{key:"_createHelper",value:function(e){return function(t,r){return new e(r).finalize(t)}}},{key:"_createHmacHelper",value:function(e){return function(t,r){return new HMAC(e,r).finalize(t)}}}]),r}(BufferedBlockAlgorithm),HMAC=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e,n){var i;_classCallCheck$8(this,r),i=t.call(this);var a=new e;i._hasher=a;var o=n;"string"==typeof o&&(o=Utf8.parse(o));var s=a.blockSize,u=4*s;o.sigBytes>u&&(o=a.finalize(n)),o.clamp();var c=o.clone();i._oKey=c;var l=o.clone();i._iKey=l;for(var d=c.words,h=l.words,f=0;f<s;f+=1)d[f]^=1549556828,h[f]^=909522486;return c.sigBytes=u,l.sigBytes=u,i.reset(),i}return _createClass$9(r,[{key:"reset",value:function(){var e=this._hasher;e.reset(),e.update(this._iKey)}},{key:"update",value:function(e){return this._hasher.update(e),this}},{key:"finalize",value:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}}]),r}(Base),parseLoop=function(e,t,r){for(var n=[],i=0,a=0;a<t;a+=1)if(a%4){var o=r[e.charCodeAt(a-1)]<<a%4*2|r[e.charCodeAt(a)]>>>6-a%4*2;n[i>>>2]|=o<<24-i%4*8,i+=1}return WordArray.create(n,i)},Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],a=0;a<r;a+=3)for(var o=(t[a>>>2]>>>24-a%4*8&255)<<16|(t[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|t[a+2>>>2]>>>24-(a+2)%4*8&255,s=0;s<4&&a+.75*s<r;s+=1)i.push(n.charAt(o>>>6*(3-s)&63));var u=n.charAt(64);if(u)for(;i.length%4;)i.push(u);return i.join("")},parse:function(e){var t=e.length,r=this._map,n=this._reverseMap;if(!n){this._reverseMap=[],n=this._reverseMap;for(var i=0;i<r.length;i+=1)n[r.charCodeAt(i)]=i}var a=r.charAt(64);if(a){var o=e.indexOf(a);-1!==o&&(t=o)}return parseLoop(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},T=[],i$1=0;i$1<64;i$1+=1)T[i$1]=4294967296*Math.abs(Math.sin(i$1+1))|0;var FF=function(e,t,r,n,i,a,o){var s=e+(t&r|~t&n)+i+o;return(s<<a|s>>>32-a)+t},GG=function(e,t,r,n,i,a,o){var s=e+(t&n|r&~n)+i+o;return(s<<a|s>>>32-a)+t},HH=function(e,t,r,n,i,a,o){var s=e+(t^r^n)+i+o;return(s<<a|s>>>32-a)+t},II=function(e,t,r,n,i,a,o){var s=e+(r^(t|~n))+i+o;return(s<<a|s>>>32-a)+t},MD5Algo=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){return _classCallCheck$8(this,r),t.apply(this,arguments)}return _createClass$9(r,[{key:"_doReset",value:function(){this._hash=new WordArray([1732584193,4023233417,2562383102,271733878])}},{key:"_doProcessBlock",value:function(e,t){for(var r=e,n=0;n<16;n+=1){var i=t+n,a=e[i];r[i]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}var o=this._hash.words,s=r[t+0],u=r[t+1],c=r[t+2],l=r[t+3],d=r[t+4],h=r[t+5],f=r[t+6],p=r[t+7],g=r[t+8],y=r[t+9],m=r[t+10],v=r[t+11],_=r[t+12],b=r[t+13],A=r[t+14],E=r[t+15],S=o[0],w=o[1],C=o[2],k=o[3];S=FF(S,w,C,k,s,7,T[0]),k=FF(k,S,w,C,u,12,T[1]),C=FF(C,k,S,w,c,17,T[2]),w=FF(w,C,k,S,l,22,T[3]),S=FF(S,w,C,k,d,7,T[4]),k=FF(k,S,w,C,h,12,T[5]),C=FF(C,k,S,w,f,17,T[6]),w=FF(w,C,k,S,p,22,T[7]),S=FF(S,w,C,k,g,7,T[8]),k=FF(k,S,w,C,y,12,T[9]),C=FF(C,k,S,w,m,17,T[10]),w=FF(w,C,k,S,v,22,T[11]),S=FF(S,w,C,k,_,7,T[12]),k=FF(k,S,w,C,b,12,T[13]),C=FF(C,k,S,w,A,17,T[14]),w=FF(w,C,k,S,E,22,T[15]),S=GG(S,w,C,k,u,5,T[16]),k=GG(k,S,w,C,f,9,T[17]),C=GG(C,k,S,w,v,14,T[18]),w=GG(w,C,k,S,s,20,T[19]),S=GG(S,w,C,k,h,5,T[20]),k=GG(k,S,w,C,m,9,T[21]),C=GG(C,k,S,w,E,14,T[22]),w=GG(w,C,k,S,d,20,T[23]),S=GG(S,w,C,k,y,5,T[24]),k=GG(k,S,w,C,A,9,T[25]),C=GG(C,k,S,w,l,14,T[26]),w=GG(w,C,k,S,g,20,T[27]),S=GG(S,w,C,k,b,5,T[28]),k=GG(k,S,w,C,c,9,T[29]),C=GG(C,k,S,w,p,14,T[30]),w=GG(w,C,k,S,_,20,T[31]),S=HH(S,w,C,k,h,4,T[32]),k=HH(k,S,w,C,g,11,T[33]),C=HH(C,k,S,w,v,16,T[34]),w=HH(w,C,k,S,A,23,T[35]),S=HH(S,w,C,k,u,4,T[36]),k=HH(k,S,w,C,d,11,T[37]),C=HH(C,k,S,w,p,16,T[38]),w=HH(w,C,k,S,m,23,T[39]),S=HH(S,w,C,k,b,4,T[40]),k=HH(k,S,w,C,s,11,T[41]),C=HH(C,k,S,w,l,16,T[42]),w=HH(w,C,k,S,f,23,T[43]),S=HH(S,w,C,k,y,4,T[44]),k=HH(k,S,w,C,_,11,T[45]),C=HH(C,k,S,w,E,16,T[46]),w=HH(w,C,k,S,c,23,T[47]),S=II(S,w,C,k,s,6,T[48]),k=II(k,S,w,C,p,10,T[49]),C=II(C,k,S,w,A,15,T[50]),w=II(w,C,k,S,h,21,T[51]),S=II(S,w,C,k,_,6,T[52]),k=II(k,S,w,C,l,10,T[53]),C=II(C,k,S,w,m,15,T[54]),w=II(w,C,k,S,u,21,T[55]),S=II(S,w,C,k,g,6,T[56]),k=II(k,S,w,C,E,10,T[57]),C=II(C,k,S,w,f,15,T[58]),w=II(w,C,k,S,b,21,T[59]),S=II(S,w,C,k,d,6,T[60]),k=II(k,S,w,C,v,10,T[61]),C=II(C,k,S,w,c,15,T[62]),w=II(w,C,k,S,y,21,T[63]),o[0]=o[0]+S|0,o[1]=o[1]+w|0,o[2]=o[2]+C|0,o[3]=o[3]+k|0}},{key:"_doFinalize",value:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;t[n>>>5]|=128<<24-n%32;var i=Math.floor(r/4294967296),a=r;t[15+(n+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t[14+(n+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),e.sigBytes=4*(t.length+1),this._process();for(var o=this._hash,s=o.words,u=0;u<4;u+=1){var c=s[u];s[u]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return o}},{key:"clone",value:function(){var e=_get$2(_getPrototypeOf$8(r.prototype),"clone",this).call(this);return e._hash=this._hash.clone(),e}}]),r}(Hasher);Hasher._createHelper(MD5Algo),Hasher._createHmacHelper(MD5Algo);var EvpKDFAlgo=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),(n=t.call(this)).cfg=Object.assign(new Base,{keySize:4,hasher:MD5Algo,iterations:1},e),n}return _createClass$9(r,[{key:"compute",value:function(e,t){for(var r,n=this.cfg,i=n.hasher.create(),a=WordArray.create(),o=a.words,s=n.keySize,u=n.iterations;o.length<s;){r&&i.update(r),r=i.update(e).finalize(t),i.reset();for(var c=1;c<u;c+=1)r=i.finalize(r),i.reset();a.concat(r)}return a.sigBytes=4*s,a}}]),r}(Base),Cipher=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e,n,i){var a;return _classCallCheck$8(this,r),(a=t.call(this)).cfg=Object.assign(new Base,i),a._xformMode=e,a._key=n,a.reset(),a}return _createClass$9(r,[{key:"reset",value:function(){_get$2(_getPrototypeOf$8(r.prototype),"reset",this).call(this),this._doReset()}},{key:"process",value:function(e){return this._append(e),this._process()}},{key:"finalize",value:function(e){return e&&this._append(e),this._doFinalize()}}],[{key:"createEncryptor",value:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)}},{key:"createDecryptor",value:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)}},{key:"_createHelper",value:function(e){var t=function(e){return"string"==typeof e?PasswordBasedCipher:SerializableCipher};return{encrypt:function(r,n,i){return t(n).encrypt(e,r,n,i)},decrypt:function(r,n,i){return t(n).decrypt(e,r,n,i)}}}}]),r}(BufferedBlockAlgorithm);Cipher._ENC_XFORM_MODE=1,Cipher._DEC_XFORM_MODE=2,Cipher.keySize=4,Cipher.ivSize=4;var BlockCipherMode=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e,n){var i;return _classCallCheck$8(this,r),(i=t.call(this))._cipher=e,i._iv=n,i}return _createClass$9(r,null,[{key:"createEncryptor",value:function(e,t){return this.Encryptor.create(e,t)}},{key:"createDecryptor",value:function(e,t){return this.Decryptor.create(e,t)}}]),r}(Base);function xorBlock(e,t,r){var n,i=e,a=this._iv;a?(n=a,this._iv=void 0):n=this._prevBlock;for(var o=0;o<r;o+=1)i[t+o]^=n[o]}var CBC=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){return _classCallCheck$8(this,r),t.apply(this,arguments)}return _createClass$9(r)}(BlockCipherMode);CBC.Encryptor=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){return _classCallCheck$8(this,r),t.apply(this,arguments)}return _createClass$9(r,[{key:"processBlock",value:function(e,t){var r=this._cipher,n=r.blockSize;xorBlock.call(this,e,t,n),r.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}}]),r}(CBC),CBC.Decryptor=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){return _classCallCheck$8(this,r),t.apply(this,arguments)}return _createClass$9(r,[{key:"processBlock",value:function(e,t){var r=this._cipher,n=r.blockSize,i=e.slice(t,t+n);r.decryptBlock(e,t),xorBlock.call(this,e,t,n),this._prevBlock=i}}]),r}(CBC);var Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,i=n<<24|n<<16|n<<8|n,a=[],o=0;o<n;o+=4)a.push(i);var s=WordArray.create(a,n);e.concat(s)},unpad:function(e){var t=e,r=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=r}},BlockCipher=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e,n,i){var a;return _classCallCheck$8(this,r),(a=t.call(this,e,n,Object.assign({mode:CBC,padding:Pkcs7},i))).blockSize=4,a}return _createClass$9(r,[{key:"reset",value:function(){var e;_get$2(_getPrototypeOf$8(r.prototype),"reset",this).call(this);var t=this.cfg,n=t.iv,i=t.mode;this._xformMode===this.constructor._ENC_XFORM_MODE?e=i.createEncryptor:(e=i.createDecryptor,this._minBufferSize=1),this._mode=e.call(i,this,n&&n.words),this._mode.__creator=e}},{key:"_doProcessBlock",value:function(e,t){this._mode.processBlock(e,t)}},{key:"_doFinalize",value:function(){var e,t=this.cfg.padding;return this._xformMode===this.constructor._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e}}]),r}(Cipher),CipherParams=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),(n=t.call(this)).mixIn(e),n}return _createClass$9(r,[{key:"toString",value:function(e){return(e||this.formatter).stringify(this)}}]),r}(Base),OpenSSLFormatter={stringify:function(e){var t=e.ciphertext,r=e.salt;return(r?WordArray.create([1398893684,1701076831]).concat(r).concat(t):t).toString(Base64)},parse:function(e){var t,r=Base64.parse(e),n=r.words;return 1398893684===n[0]&&1701076831===n[1]&&(t=WordArray.create(n.slice(2,4)),n.splice(0,4),r.sigBytes-=16),CipherParams.create({ciphertext:r,salt:t})}},SerializableCipher=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){return _classCallCheck$8(this,r),t.apply(this,arguments)}return _createClass$9(r,null,[{key:"encrypt",value:function(e,t,r,n){var i=Object.assign(new Base,this.cfg,n),a=e.createEncryptor(r,i),o=a.finalize(t),s=a.cfg;return CipherParams.create({ciphertext:o,key:r,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:a.blockSize,formatter:i.format})}},{key:"decrypt",value:function(e,t,r,n){var i=t,a=Object.assign(new Base,this.cfg,n);return i=this._parse(i,a.format),e.createDecryptor(r,a).finalize(i.ciphertext)}},{key:"_parse",value:function(e,t){return"string"==typeof e?t.parse(e,this):e}}]),r}(Base);SerializableCipher.cfg=Object.assign(new Base,{format:OpenSSLFormatter});var OpenSSLKdf={execute:function(e,t,r,n){var i=n;i||(i=WordArray.random(8));var a=EvpKDFAlgo.create({keySize:t+r}).compute(e,i),o=WordArray.create(a.words.slice(t),4*r);return a.sigBytes=4*t,CipherParams.create({key:a,iv:o,salt:i})}},PasswordBasedCipher=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){return _classCallCheck$8(this,r),t.apply(this,arguments)}return _createClass$9(r,null,[{key:"encrypt",value:function(e,t,r,n){var i=Object.assign(new Base,this.cfg,n),a=i.kdf.execute(r,e.keySize,e.ivSize);i.iv=a.iv;var o=SerializableCipher.encrypt.call(this,e,t,a.key,i);return o.mixIn(a),o}},{key:"decrypt",value:function(e,t,r,n){var i=t,a=Object.assign(new Base,this.cfg,n);i=this._parse(i,a.format);var o=a.kdf.execute(r,e.keySize,e.ivSize,i.salt);return a.iv=o.iv,SerializableCipher.decrypt.call(this,e,i,o.key,a)}}]),r}(SerializableCipher);PasswordBasedCipher.cfg=Object.assign(SerializableCipher.cfg,{kdf:OpenSSLKdf});for(var _SBOX=[],INV_SBOX=[],_SUB_MIX_0=[],_SUB_MIX_1=[],_SUB_MIX_2=[],_SUB_MIX_3=[],INV_SUB_MIX_0=[],INV_SUB_MIX_1=[],INV_SUB_MIX_2=[],INV_SUB_MIX_3=[],d=[],i=0;i<256;i+=1)d[i]=i<128?i<<1:i<<1^283;for(var x=0,xi=0,_i=0;_i<256;_i+=1){var sx=xi^xi<<1^xi<<2^xi<<3^xi<<4;sx=sx>>>8^255&sx^99,_SBOX[x]=sx,INV_SBOX[sx]=x;var x2=d[x],x4=d[x2],x8=d[x4],t$1=257*d[sx]^16843008*sx;_SUB_MIX_0[x]=t$1<<24|t$1>>>8,_SUB_MIX_1[x]=t$1<<16|t$1>>>16,_SUB_MIX_2[x]=t$1<<8|t$1>>>24,_SUB_MIX_3[x]=t$1,t$1=16843009*x8^65537*x4^257*x2^16843008*x,INV_SUB_MIX_0[sx]=t$1<<24|t$1>>>8,INV_SUB_MIX_1[sx]=t$1<<16|t$1>>>16,INV_SUB_MIX_2[sx]=t$1<<8|t$1>>>24,INV_SUB_MIX_3[sx]=t$1,x?(x=x2^d[d[d[x8^x2]]],xi^=d[d[xi]]):(xi=1,x=xi)}var RCON=[0,1,2,4,8,16,32,64,128,27,54],AESAlgo=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){return _classCallCheck$8(this,r),t.apply(this,arguments)}return _createClass$9(r,[{key:"_doReset",value:function(){var e;if(!this._nRounds||this._keyPriorReset!==this._key){this._keyPriorReset=this._key;var t=this._keyPriorReset,r=t.words,n=t.sigBytes/4;this._nRounds=n+6;var i=4*(this._nRounds+1);this._keySchedule=[];for(var a=this._keySchedule,o=0;o<i;o+=1)o<n?a[o]=r[o]:(e=a[o-1],o%n?n>6&&o%n==4&&(e=_SBOX[e>>>24]<<24|_SBOX[e>>>16&255]<<16|_SBOX[e>>>8&255]<<8|_SBOX[255&e]):(e=_SBOX[(e=e<<8|e>>>24)>>>24]<<24|_SBOX[e>>>16&255]<<16|_SBOX[e>>>8&255]<<8|_SBOX[255&e],e^=RCON[o/n|0]<<24),a[o]=a[o-n]^e);this._invKeySchedule=[];for(var s=this._invKeySchedule,u=0;u<i;u+=1){var c=i-u;e=u%4?a[c]:a[c-4],s[u]=u<4||c<=4?e:INV_SUB_MIX_0[_SBOX[e>>>24]]^INV_SUB_MIX_1[_SBOX[e>>>16&255]]^INV_SUB_MIX_2[_SBOX[e>>>8&255]]^INV_SUB_MIX_3[_SBOX[255&e]]}}}},{key:"encryptBlock",value:function(e,t){this._doCryptBlock(e,t,this._keySchedule,_SUB_MIX_0,_SUB_MIX_1,_SUB_MIX_2,_SUB_MIX_3,_SBOX)}},{key:"decryptBlock",value:function(e,t){var r=e,n=r[t+1];r[t+1]=r[t+3],r[t+3]=n,this._doCryptBlock(r,t,this._invKeySchedule,INV_SUB_MIX_0,INV_SUB_MIX_1,INV_SUB_MIX_2,INV_SUB_MIX_3,INV_SBOX),n=r[t+1],r[t+1]=r[t+3],r[t+3]=n}},{key:"_doCryptBlock",value:function(e,t,r,n,i,a,o,s){for(var u=e,c=this._nRounds,l=u[t]^r[0],d=u[t+1]^r[1],h=u[t+2]^r[2],f=u[t+3]^r[3],p=4,g=1;g<c;g+=1){var y=n[l>>>24]^i[d>>>16&255]^a[h>>>8&255]^o[255&f]^r[p];p+=1;var m=n[d>>>24]^i[h>>>16&255]^a[f>>>8&255]^o[255&l]^r[p];p+=1;var v=n[h>>>24]^i[f>>>16&255]^a[l>>>8&255]^o[255&d]^r[p];p+=1;var _=n[f>>>24]^i[l>>>16&255]^a[d>>>8&255]^o[255&h]^r[p];p+=1,l=y,d=m,h=v,f=_}var b=(s[l>>>24]<<24|s[d>>>16&255]<<16|s[h>>>8&255]<<8|s[255&f])^r[p];p+=1;var A=(s[d>>>24]<<24|s[h>>>16&255]<<16|s[f>>>8&255]<<8|s[255&l])^r[p];p+=1;var E=(s[h>>>24]<<24|s[f>>>16&255]<<16|s[l>>>8&255]<<8|s[255&d])^r[p];p+=1;var S=(s[f>>>24]<<24|s[l>>>16&255]<<16|s[d>>>8&255]<<8|s[255&h])^r[p];p+=1,u[t]=b,u[t+1]=A,u[t+2]=E,u[t+3]=S}}]),r}(BlockCipher);AESAlgo.keySize=8;var AES=BlockCipher._createHelper(AESAlgo),CTR=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){return _classCallCheck$8(this,r),t.apply(this,arguments)}return _createClass$9(r)}(BlockCipherMode);CTR.Encryptor=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){return _classCallCheck$8(this,r),t.apply(this,arguments)}return _createClass$9(r,[{key:"processBlock",value:function(e,t){var r=e,n=this._cipher,i=n.blockSize,a=this._iv,o=this._counter;a&&(this._counter=a.slice(0),o=this._counter,this._iv=void 0);var s=o.slice(0);n.encryptBlock(s,0),o[i-1]=o[i-1]+1|0;for(var u=0;u<i;u+=1)r[t+u]^=s[u]}}]),r}(CTR),CTR.Decryptor=CTR.Encryptor;var NoPadding={pad:function(){},unpad:function(){}},Crypto={decryptWordArray:function(e,t,r){var n=Hex.parse(t),i=Hex.parse(formatIV(r)),a=WordArray.create(new Uint8Array(e)),o=AES.decrypt(CipherParams.create({ciphertext:a}),n,{iv:i,mode:CTR,padding:NoPadding});return Crypto.wordArrayToUint8Array(o)},wordArrayToUint8Array:function(e){for(var t=e.sigBytes,r=e.words,n=new Uint8Array(t),i=0,a=0;i!==t;){var o=r[a++];if(n[i++]=(4278190080&o)>>>24,i===t)break;if(n[i++]=(16711680&o)>>>16,i===t)break;if(n[i++]=(65280&o)>>>8,i===t)break;n[i++]=255&o}return n}},Crypto$1=Crypto,NEW_ARRAY_MAX_CNT=20,MP4Demuxer=function(){function t(e,r,n,i){_classCallCheck$4(this,t),_defineProperty$5(this,"_videoSamples",[]),_defineProperty$5(this,"_audioSamples",[]),_defineProperty$5(this,"_lastRemainBuffer",[]),_defineProperty$5(this,"_lastRemainBufferStartPos",0),this.videoTrack=e||new VideoTrack,this.audioTrack=r||new AudioTrack,this.metadataTrack=n||new MetadataTrack,this.log=new Logger$2("MP4Demuxer",!i||!i.openLog||!i.openLog)}return _createClass$5(t,[{key:"parseSamples",value:function(e){var t=this;if(!this._audioSamples.length&&!this._videoSamples.length){if(!e)throw new Error("moov is required");MP4Parser.moovToTrack(e,this.videoTrack,this.audioTrack),this.videoSenc=this.videoTrack.videoSenc,this.audioSenc=this.audioTrack.audioSenc;var r=MP4Parser.moovToSamples(e);if(!r)throw new Error("cannot parse samples from moov box");this._videoSamples=r.videoSamples||[],this._audioSamples=r.audioSamples||[],this.videoSegmentIdxRangeMap=new Map,this.audioSegmentIdxRangeMap=new Map,this._videoSamples.map((function(e,r){e.keyframe&&t.videoSegmentIdxRangeMap.set(e.gopId,r)}));var n=-1;this._audioSamples.map((function(e,r){e.gopId!==n&&(t.audioSegmentIdxRangeMap.set(e.gopId,r),n=e.gopId)}))}}},{key:"demux",value:function(e,t,r,n,i){this._audioSamples.length||this._videoSamples.length||this.parseSamples(i);var a,o,s,u=this.videoTrack,c=this.audioTrack;if(u.samples=[],c.samples=[],r){for(var l,d=0,h=r[0],f=r[1];h<=f;h++){if(!(a=this._videoSamples[h]))throw new Error("cannot found video frame #".concat(h));s=a.offset-t,o=e.subarray(s,s+a.size),(l=new VideoSample(a.pts||a.dts,a.dts)).duration=a.duration,l.gopId=a.gopId,a.keyframe&&l.setToKeyframe();for(var p=0,g=o.length-1;p<g;)d=readBig32(o,p),p+=4,l.units.push(o.subarray(p,p+d)),p+=d;u.samples.push(l)}u.baseMediaDecodeTime=u.samples[0].dts}if(n){for(var y=n[0],m=n[1];y<=m;y++){if(!(a=this._audioSamples[y]))throw new Error("cannot found video frame #".concat(y));s=a.offset-t,o=e.subarray(s,s+a.size),c.samples.push(new AudioSample(a.dts,o,a.duration))}c.baseMediaDecodeTime=c.samples[0].dts}return{videoTrack:u,audioTrack:c,metadataTrack:this.metadataTrack}}},{key:"demuxPart",value:function(t,r,n,i,a,o){if(this._audioSamples.length||this._videoSamples.length||this.parseSamples(i),this.videoTrack.useEME=a,this.audioTrack.useEME=a,this._lastRemainBuffer&&this._lastRemainBuffer.byteLength>0&&r>this._lastRemainBufferStartPos&&r<=this._lastRemainBufferStartPos+this._lastRemainBuffer.byteLength)for(var s=0;s<NEW_ARRAY_MAX_CNT;)try{var u=this._lastRemainBuffer.subarray(0,r-this._lastRemainBufferStartPos),c=new Uint8Array(t.byteLength+u.byteLength);c.set(u,0),c.set(new Uint8Array(t),u.byteLength),t=c,r-=u.byteLength,this._lastRemainBuffer=null,this._lastRemainBufferStartPos=0;break}catch(e){if(!(s<NEW_ARRAY_MAX_CNT))throw new Error("new Uint8Array error:,"+e.errorMessage);s++}var l,d,h,f=this.videoTrack,p=this.audioTrack;f.samples=[],p.samples=[],f.videoSenc=null,p.audioSenc=null;var g=0,y=0;if(this._videoSamples){for(var m,v=t.byteLength+r,_=this.videoSegmentIdxRangeMap.get(n),b=this.videoSegmentIdxRangeMap.get(n+1)||this._videoSamples.length,A=_;A<b;A++){if(!(l=this._videoSamples[A]))throw new Error("cannot found video frame #".concat(A));l.offset>=r&&l.offset+l.size<=v&&(g=(h=l.offset-r)+l.size,d=t.subarray(h,g),(m=new VideoSample(l.pts||l.dts,l.dts)).duration=l.duration,m.gopId=l.gopId,m.sampleOffset=A,l.keyframe&&m.setToKeyframe(),m.data=d,m.size=l.size,f.samples.push(m))}f.samples.length>0&&(f.gopId=f.samples[0].gopId,f.baseMediaDecodeTime=f.samples[0].dts,f.startPts=f.samples[0].pts/f.timescale,f.endPts=f.samples[f.samples.length-1].pts/f.timescale,this.videoSenc&&(f.videoSenc=this.videoSenc.slice(f.samples[0].sampleOffset,f.samples[0].sampleOffset+f.samples.length),f.kidValue=o))}if(this._audioSamples){for(var E=this.audioSegmentIdxRangeMap.get(n),S=this.audioSegmentIdxRangeMap.get(n+1)||this._audioSamples.length,T=E;T<S;T++){if(!(l=this._audioSamples[T]))throw new Error("cannot found video frame #".concat(T));l.offset>=r&&l.offset+l.size<=t.byteLength+r&&(y=(h=l.offset-r)+l.size,d=t.subarray(h,y),p.samples.push(new AudioSample(l.dts,d,l.duration,T)))}p.samples.length>0&&(p.gopId=p.samples[0].gopId||f.gopId,p.baseMediaDecodeTime=p.samples[0].dts,p.startPts=p.samples[0].pts/p.timescale,p.endPts=p.samples[p.samples.length-1].pts/p.timescale,this.audioSenc&&(p.audioSenc=this.audioSenc.slice(p.samples[0].sampleOffset,p.samples[0].sampleOffset+p.samples.length),p.kidValue=o))}this.decoderData(f,p);for(var w=0,C=0;C<f.samples.length;C++)for(var k=0,I=f.samples[C].data,$=I.length-1;k<$;)w=readBig32(I,k),k+=4,f.samples[C].units.push(I.subarray(k,k+w)),k+=w;return this._lastRemainBuffer=t.subarray(Math.max(g,y)),this._lastRemainBuffer.byteLength>0?this._lastRemainBufferStartPos=r+t.byteLength-this._lastRemainBuffer.byteLength:this._lastRemainBufferStartPos=0,{videoTrack:f,audioTrack:p,metadataTrack:this.metadataTrack}}},{key:"reset",value:function(){this._videoSamples=[],this._audioSamples=[],this._lastRemainBuffer=null,this._lastRemainBufferStartPos=0,this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}},{key:"decoderData",value:function(e,t){if(!e.useEME&&!t.useEME){if(e.videoSenc&&1===e.id){var r=e.kidValue,n=e.videoSenc;e.samples.forEach((function(t,i){var a=n[i],o=t.data,s=[],u=[],c=a.InitializationVector;if(a.subsamples&&a.subsamples.length)a.subsamples.forEach((function(e){var t=e.BytesOfClearData+e.BytesOfProtectedData,r=o.slice(0,t);s.push(r.slice(0,e.BytesOfClearData)),u.push(r.slice(e.BytesOfClearData)),o=o.slice(t)}));else{var l=t.size;s.push(o.slice(0,0)),u.push(o.slice(0,l)),o=o.slice(l)}var d=new Buffer$1;d.write.apply(d,u);var h=Crypto$1.decryptWordArray(d.buffer,r,c),f=new Buffer$1;s.forEach((function(e,t){var r=u[t].length,n=h.slice(0,r);f.write(e),f.write(n),h=h.slice(r)})),e.samples[i].data=f.buffer}))}if(t.audioSenc&&2===t.id){var i=t.kidValue,a=t.audioSenc;t.samples.forEach((function(e,r){var n=a[r],o=Crypto$1.decryptWordArray(e.data,i,n.InitializationVector);t.samples[r].data=o}))}}}}],[{key:"probe",value:function(e){return!!MP4Parser.findBox(e,["ftyp"])}}]),t}(),version$1=JSON.parse('"3.0.0-alpha.31-29-28"'),ERROR_CODES={416:-499899,401:-499898,403:-499897,404:-499896,timeout:-499895,"4xx":-499894,"5xx":-499893,networkError:-499892,contentError:-499891,mse:-499971,mseOpen:-499972,mseAppend:-499973,boxsError:-499980,moovError:-499981,notH264:-499982,mdatError:-499983,mdhdError:-499984,noneURL:-499988,h265Error:-499985,other:-499989,waitTimeout:-499791},ERROR_TYPES={network:1003,format:1005,runtime:1002,other:9999,demux:1006,remux:1007};function getErrorCodeByHttpCode(e){var t=0;switch(e){case 0:t=0;break;case-1:t=ERROR_CODES.networkError;break;case-2:t=ERROR_CODES.timeout;break;case-3:t=ERROR_CODES.contentError;break;default:t=e<500?ERROR_CODES[e]||e["4xx"]:ERROR_CODES[e]||e["5xx"]}return t}var NetWorkError=_createClass$5((function e(t,r,n){_classCallCheck$4(this,e);var i=0,a=0;n&&n.range&&n.range.length>1&&(i=n.range[0],a=n.range[1]);var o=getErrorCodeByHttpCode(r);return{errorCode:o,errorType:t,errorTypeCode:ERROR_TYPES[t],errorMessage:n.httpText||n.message,url:n.url,httpCode:r,version:version$1,rangeStart:i,rangeEnd:a,ext:n,mediaError:{code:o,message:n.httpText||n.message}}}));function createPublicPromise(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return r.used=!1,r.resolve=function(){return r.used=!0,e.apply(void 0,arguments)},r.reject=function(){return r.used=!0,t.apply(void 0,arguments)},r}var LoaderType={FETCH:"fetch",XHR:"xhr"},ResponseType={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"};function _createSuper$f(e){var t=_isNativeReflectConstruct$f();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var NetError=function(e){_inherits$4(r,e);var t=_createSuper$f(r);function r(e,n,i,a){var o;return _classCallCheck$4(this,r),_defineProperty$5(_assertThisInitialized$4(o=t.call(this,a)),"retryCount",0),_defineProperty$5(_assertThisInitialized$4(o),"isTimeout",!1),_defineProperty$5(_assertThisInitialized$4(o),"loaderType",LoaderType.FETCH),_defineProperty$5(_assertThisInitialized$4(o),"startTime",0),_defineProperty$5(_assertThisInitialized$4(o),"endTime",0),o.url=e,o.request=n,o.response=i,o}return _createClass$5(r)}(_wrapNativeSuper(Error)),toString$1=Object.prototype.toString;function isObject$1(e){return null!==e&&"object"===_typeof$4(e)}function isPlainObject(e){if("[object Object]"!==toString$1.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function isDate(e){return"[object Date]"===toString$1.call(e)}function getRangeValue(e){if(e&&null!=e[0]&&(0!==e[0]||null!=e[1])){var t="bytes="+e[0]+"-";return e[1]&&(t+=e[1]),t}}function encode(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function setUrlParams(e,t){if(e){if(!t)return e;var r,n=Object.keys(t).map((function(e){if(null!=(r=t[e]))return Array.isArray(r)?e+="[]":r=[r],r.map((function(t){return isDate(t)?t=t.toISOString():isObject$1(t)&&(t=JSON.stringify(t)),"".concat(encode(e),"=").concat(encode(t))})).join("&")})).filter(Boolean).join("&");if(n){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}}function createResponse(e,t,r,n,i,a,o,s,u,c){return i=null!=i?parseFloat(i):null,n=parseInt(n||"0",10),isNaN(n)&&(n=0),{data:e,done:t,option:{range:u,vid:c,index:s,contentLength:n,age:i,startTime:a,firstByteTime:o,endTime:Date.now()},response:r}}var MaxQueueCapacity=10,INVALID_SPEED=0,SpeedSampler=function(){function e(){_classCallCheck$4(this,e),this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,this._realTimeSpeed=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return _createClass$5(e,[{key:"reset",value:function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0}},{key:"addBytes",value:function(e){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=e,this._totalBytes+=e):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=e,this._totalBytes+=e):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=e,this._totalBytes+=e,this._lastCheckpoint=this._now())}},{key:"currentKBps",get:function(){this.addBytes(0);var e=(this._now()-this._lastCheckpoint)/1e3;return 0==e&&(e=1),this._intervalBytes/e/1024}},{key:"lastSecondKBps",get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0}}],[{key:"getSpeed",value:function(){var e=INVALID_SPEED;if(this._netRecords.length<1)return e;var t=[];this._netRecords.map((function(e){t.push(e)})),t.sort((function(e,t){return e.mSpeedInbPS-t.mSpeedInbPS}));for(var r=t.length,n=0,i=0;i<r;i++)n+=t[i].mBytes;n/=2;for(var a=0;a<r;a++)if((n-=t[a].mBytes)<=0){e=t[a].mSpeedInbPS;break}return e<0?INVALID_SPEED:e}},{key:"getRealTimeSpeed",value:function(){return this._realTimeSpeed}},{key:"getRTT",value:function(){if(this._netRecords.length<1)return 0;var e=[];this._netRecords.map((function(t){e.push(t.mRTT)})),e.sort((function(e,t){return e-t}));var t=e.length;return t%2==0?(e[t/2-1]+e[t/2])/2:e[Math.floor(t/2)]}},{key:"netSampling",value:function(e){this._netRecords.push(e),this._realTimeSpeed=e.mSpeedInbPS,this._netRecords.length>MaxQueueCapacity&&this._netRecords.splice(0,1)}}]),e}();_defineProperty$5(SpeedSampler,"_netRecords",[]);var SpeedSampler$1=SpeedSampler,FetchLoader=function(){function t(){_classCallCheck$4(this,t),_defineProperty$5(this,"_abortController",null),_defineProperty$5(this,"_timeoutTimer",null),_defineProperty$5(this,"_reader",null),_defineProperty$5(this,"_response",null),_defineProperty$5(this,"_aborted",!1),_defineProperty$5(this,"_index",-1),_defineProperty$5(this,"_range",null),_defineProperty$5(this,"_receivedLength",0),_defineProperty$5(this,"_running",!1),_defineProperty$5(this,"_logger",null),_defineProperty$5(this,"_vid","")}var r;return _createClass$5(t,[{key:"load",value:function(e){var t=this,r=e.url,n=e.vid,i=e.timeout,a=e.responseType,o=e.onProgress,s=e.index,u=e.onTimeout,c=e.range,l=e.transformResponse,d=e.request,h=e.params,f=e.logger,p=e.method,g=e.headers,y=e.body,m=e.mode,v=e.credentials,_=e.cache,b=e.redirect,A=e.referrer,E=e.referrerPolicy,S=e.integrity;this._logger=f,this._aborted=!1,this._running=!0,this._abortController=new AbortController,this._index=s,this._range=c||[0,0],this._vid=n||r,this._logger.debug("ã€fetchLoader taskã€‘, range",this._range);var T={method:p,headers:g,body:y,mode:m,credentials:v,cache:_,redirect:b,referrer:A,referrerPolicy:E,integrity:S,signal:this._abortController.signal},w=!1;clearTimeout(this._timeoutTimer),r=setUrlParams(r,h);var C=getRangeValue(c);C&&((g=d?d.headers:T.headers=T.headers||new Headers)instanceof Headers?g.append("Range",C):g.Range=C),i&&(this._timeoutTimer=setTimeout((function(){if(w=!0,t.cancel(),u){var e=new NetError(r,T);e.isTimeout=!0,u(e)}}),i));var k=Date.now();return this._logger.debug("[fetch load start], index,",s,",range,",c),fetch(d||r,d?void 0:T).then(function(){var e=_asyncToGenerator$1(regenerator.mark((function e(n){var i,u,d;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(clearTimeout(t._timeoutTimer),t._response=n,!t._aborted){e.next=4;break}return e.abrupt("return");case 4:if(l&&(n=l(n,r)||n),n.ok){e.next=8;break}throw t._running=!1,new NetError(r,T,n,"bad network response");case 8:if(i=Date.now(),a!==ResponseType.TEXT){e.next=16;break}return e.next=12,n.text();case 12:u=e.sent,t._running=!1,e.next=35;break;case 16:if(a!==ResponseType.JSON){e.next=23;break}return e.next=19,n.json();case 19:u=e.sent,t._running=!1,e.next=35;break;case 23:if(!o){e.next=27;break}t._loadChunk(n,o,k,i),e.next=35;break;case 27:return e.next=29,n.arrayBuffer();case 29:u=e.sent,u=new Uint8Array(u),t._running=!1,t._logger.debug("[fetch load end], index,",s,",range,",c),d=Date.now()-k,SpeedSampler$1.netSampling({mTime:d,mBytes:u.byteLength,mSpeedInbPS:8*u.byteLength/(d/1e3),mRTT:i-k});case 35:return e.abrupt("return",createResponse(u,!0,n,n.headers.get("Content-Length"),n.headers.get("age"),k,i,s,c,t._vid));case 36:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){if(clearTimeout(t._timeoutTimer),t._running=!1,!t._aborted||w)throw(e=e instanceof NetError?e:new NetError(r,T)).startTime=k,e.endTime=Date.now(),e.isTimeout=w,e}))}},{key:"cancel",value:(r=_asyncToGenerator$1(regenerator.mark((function e(){return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){e.next=16;break}return e.prev=5,e.next=8,this._response.body.cancel();case 8:if(!this._reader){e.next=11;break}return e.next=11,this._reader.cancel();case 11:e.next=15;break;case 13:e.prev=13,e.t0=e.catch(5);case 15:this._response=this._reader=null;case 16:if(this._abortController){try{this._abortController.abort()}catch(error){}this._abortController=null}case 17:case"end":return e.stop()}}),e,this,[[5,13]])}))),function(){return r.apply(this,arguments)})},{key:"_loadChunk",value:function(e,t,r,n){var i=this;if(!e.body||!e.body.getReader)throw new NetError(e.url,"",e,"onProgress of bad response.body.getReader");var a,o,s,u=this._reader=e.body.getReader(),c=function(){var l=_asyncToGenerator$1(regenerator.mark((function l(){var d,h,f,p;return regenerator.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:return o=Date.now(),l.prev=1,l.next=4,u.read();case 4:a=l.sent,s=Date.now(),l.next=15;break;case 8:return l.prev=8,l.t0=l.catch(1),s=Date.now(),d=i._range[0]+i._receivedLength,h=i._aborted?null:l.t0,t(void 0,!1,{range:[d,d],vid:i._vid,index:i._index,startTime:o,endTime:s,err:h},e),l.abrupt("return");case 15:if(f=i._range[0]+i._receivedLength,!i._aborted){l.next=19;break}return t(void 0,!1,{range:[f,f],vid:i._vid,index:i._index,startTime:o,endTime:s},e),l.abrupt("return");case 19:i._receivedLength+=a.value?a.value.byteLength:0,i._logger.debug("ã€fetchLoader,onProgress callã€‘,task,",i._range,", start,",f,", end,",i._range[0]+i._receivedLength,", done,",a.done),t(a.value,a.done,{range:[f,i._range[0]+i._receivedLength],vid:i._vid,index:i._index,startTime:o,endTime:s},e),p=Date.now()-r,i._logger.debug("[fetchLoader SPEED], fetch speed(b/s),",8*i._receivedLength/(p/1e3)),SpeedSampler$1.netSampling({mTime:p,mBytes:i._receivedLength,mSpeedInbPS:8*i._receivedLength/(p/1e3),mRTT:n-r}),a.done?(i._running=!1,i._logger.debug("[fetchLoader onProgress end],task,",i._range,",done,",a.done)):c();case 26:case"end":return l.stop()}}),l,null,[[1,8]])})));return function(){return l.apply(this,arguments)}}();c()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){if("undefined"==typeof ReadableStream)return!1;try{new ReadableStream({})}catch(e){return!1}return!("undefined"==typeof fetch||"undefined"==typeof AbortController)}}]),t}();function ownKeys$6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$5(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$6(Object(r),!0).forEach((function(t){_defineProperty$5(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$6(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function getConfig$1(e){return _objectSpread$5({loaderType:LoaderType.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:ResponseType.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0},e)}function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ownKeys$5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$4(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$5(Object(r),!0).forEach((function(t){_defineProperty$5(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$5(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var SubRangeStartTime=-1,FirstRtt=-1,XhrLoader=function(){function e(){_classCallCheck$4(this,e),_defineProperty$5(this,"_xhr",null),_defineProperty$5(this,"_aborted",!1),_defineProperty$5(this,"_timeoutTimer",null),_defineProperty$5(this,"_range",null),_defineProperty$5(this,"_receivedLength",0),_defineProperty$5(this,"_url",null),_defineProperty$5(this,"_onProgress",null),_defineProperty$5(this,"_index",-1),_defineProperty$5(this,"_headers",null),_defineProperty$5(this,"_chunkSizeKBList",[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192]),_defineProperty$5(this,"_currentChunkSizeKB",384),_defineProperty$5(this,"_currentSpeedNormalized",0),_defineProperty$5(this,"_zeroSpeedChunkCount",0),_defineProperty$5(this,"_timeout",null),_defineProperty$5(this,"_xhr",null),_defineProperty$5(this,"_withCredentials",null),_defineProperty$5(this,"_startTime",-1),_defineProperty$5(this,"_firstByteTime",-1),_defineProperty$5(this,"_speedSampler",new SpeedSampler$1),_defineProperty$5(this,"_loadCompleteResolve",null),_defineProperty$5(this,"_loadCompleteReject",null),_defineProperty$5(this,"_runing",!1),_defineProperty$5(this,"_logger",!1),_defineProperty$5(this,"_vid","")}return _createClass$5(e,[{key:"load",value:function(e){var t=this;clearTimeout(this._timeoutTimer),this._logger=e.logger,this._range=e.range||[0,0],this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials="include"===e.credentials||"same-origin"===e.credentials,this._logger.debug("ã€xhrLoader taskã€‘, range",this._range);var r=e.url,n=e.params,i=e.timeout,a=e.responseType,o=e.onTimeout,s=e.transformResponse,u=e.onProgress,c=e.method,l=e.credentials,d=e.body,h=e.index,f=e.range,p=e.request,g=!1;this._timeout=i||null,this._runing=!0,this._vid=e.vid||r,this._url=setUrlParams(r,n);var y=Date.now();return this._onProgress&&f.length>1&&f[1]&&f[1]-f[0]>1024*this._currentChunkSizeKB?(this._logger.debug("ã€xhrLoaderã€‘, task",this._range,", need to sub range"),SubRangeStartTime=y,new Promise((function(e,r){t._loadCompleteResolve=e,t._loadCompleteReject=r,t._openSubRange()})).catch((function(e){if(clearTimeout(t._timeoutTimer),t._runing=!1,!t._aborted)throw(e=e instanceof NetError?e:new NetError(r,p)).startTime=y,e.endTime=Date.now(),e}))):new Promise((function(e,n){var m=t._xhr=new XMLHttpRequest;m.open(c||"GET",r,!0),m.responseType=a,m.withCredentials="include"===l||"same-origin"===l;var v=getRangeValue(f),_=null;v&&((_=t._headers||{}).Range=v),_&&Object.keys(_).forEach((function(e){m.setRequestHeader(e,_[e])})),i&&(t._timeoutTimer=setTimeout((function(){if(g=!0,t.cancel(),o){var e=new NetError(r,p);e.isTimeout=!0,o(e)}}),i)),m.onerror=function(e){return n(e)},m.onreadystatechange=function(){if(m.readyState>=2){clearTimeout(t._timeoutTimer);var i=Date.now();if(FirstRtt<0&&(FirstRtt=i),4===m.readyState){if(m.onreadystatechange=null,t._aborted)return;var a=m.status,o={ok:a>=200&&a<300,status:a,statusText:m.statusText,url:m.responseURL,headers:t._getHeaders(m),body:m.response};if(s&&(o=s(o,r)||o),!o.ok)return n(new NetError(r,p,o,"bad network response"));var c=m.responseType===ResponseType.ARRAY_BUFFER,l=c?new Uint8Array(m.response):m.response;if(c){var d=Date.now()-y;SpeedSampler$1.netSampling({mTime:d,mBytes:l.byteLength,mSpeedInbPS:8*l.byteLength/(d/1e3),mRTT:FirstRtt-y})}u&&u(c?l:void 0,!0,{range:t._range,index:t._index,startTime:y,endTime:Date.now()},o),t._runing=!1,e(createResponse(l,!0,o,o.headers["content-length"],o.headers.age,y,i,h,t._range,t._vid))}}},m.send(d)})).catch((function(e){if(clearTimeout(t._timeoutTimer),t._runing=!1,!t._aborted||g)throw(e=e instanceof NetError?e:new NetError(r,p)).startTime=y,e.endTime=Date.now(),e.isTimeout=g,e}))}},{key:"_openSubRange",value:function(){var e=1024*this._currentChunkSizeKB,t=this._range[0]+this._receivedLength;this._logger.debug("[xhr_loader->] ,tast: ",this._range,",subRangeFrom ",t,", currentReceivedLength, ",this._receivedLength);var r=this._range[1];e<this._range[1]-t&&(r=t+e);var n=[t,r];this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",n),this._internalOpen(this._url,n)}},{key:"_internalOpen",value:function(e,t){var r=this;try{this._startTime=Date.now();var n=this._xhr=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",this._timeout&&(n.timeout=this._timeout),n.withCredentials=this._withCredentials,n.onload=this._onLoad.bind(this),n.onreadystatechange=this._onReadyStatechange.bind(this),n.onerror=function(e){r._running=!1,r._loadCompleteReject(e)},n.ontimeout=function(e){r._running=!1,r._loadCompleteReject(e)};var i=getRangeValue(t),a=null;i&&((a=this._headers||{}).Range=i),a&&Object.keys(a).forEach((function(e){n.setRequestHeader(e,a[e])})),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",t),n.send()}catch(error){throw error}}},{key:"_onReadyStatechange",value:function(e){2===e.target.readyState&&FirstRtt<0&&(FirstRtt=Date.now())}},{key:"_onLoad",value:function(e){var t=e.target.status;if(t<200||t>299)return this._loadCompleteReject(new NetError(this._url,null,_objectSpread$4(_objectSpread$4({},e.target.response),{},{status:t}),"bad response,status:"+t));var r=this._speedSampler.lastSecondKBps;if(0===r&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(r=this._speedSampler.currentKBps)),0!==r){var n=this._normalizeSpeed(r);this._currentSpeedNormalized!==n&&(this._currentSpeedNormalized=n,this._currentChunkSizeKB=n)}var i=new Uint8Array(e.target.response);this._firstByteTime&&(this._firstByteTime=Date.now());var a,o=this._range[0]+this._receivedLength;if(this._receivedLength+=i?i.byteLength:0,this._logger.debug("[xhr load done->], tast :",this._range,", from",o,"end ",this._range[0]+this._receivedLength,",dataLen,",i?i.byteLength:0,",receivedLength",this._receivedLength),a=!(this._range.length>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]),this._onProgress&&(this._logger.debug("[xhr onDataArrivalCall],tast :",this._range,",start, ",o,",end, ",this._range[0]+this._receivedLength,",index,",this._index),this._onProgress(i,a,{index:this._index,vid:this._vid,range:[o,this._range[0]+this._receivedLength],startTime:this._startTime,endTime:Date.now()},null)),i&&i.byteLength>0){var s=Date.now()-SubRangeStartTime;SpeedSampler$1.netSampling({mTime:s,mBytes:this._receivedLength,mSpeedInbPS:8*this._receivedLength/(s/1e3),mRTT:FirstRtt-SubRangeStartTime})}if(a){this._runing=!1;var u={ok:t>=200&&t<300,status:t,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._loadCompleteResolve&&this._loadCompleteResolve(createResponse(null,!0,u,u.headers["content-length"],u.headers.age,this._startTime,this._firstByteTime,this._index,this._range,this._vid))}else this._speedSampler.addBytes(i.byteLength),this._openSubRange()}},{key:"_normalizeSpeed",value:function(e){var t=this._chunkSizeKBList,r=t.length-1,n=0,i=0,a=r;if(e<t[0])return t[0];for(;i<=a;){if((n=i+Math.floor((a-i)/2))===r||e>=t[n]&&e<t[n+1])return t[n];t[n]<e?i=n+1:a=n-1}}},{key:"cancel",value:function(){if(!this._aborted)return this._aborted=!0,this._runing=!1,this._xhr?this._xhr.abort():void 0}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}},{key:"_getHeaders",value:function(e){var t,r={},n=_createForOfIteratorHelper(e.getAllResponseHeaders().trim().split("\r\n"));try{for(n.s();!(t=n.n()).done;){var i=t.value.split(": ");r[i[0].toLowerCase()]=i.slice(1).join(": ")}}catch(a){n.e(a)}finally{n.f()}return r}}],[{key:"isSupported",value:function(){return"undefined"!=typeof XMLHttpRequest}}]),e}(),_excluded$2=["retry","retryDelay","onRetryError","transformError"],Task=function(){function e(t,r){_classCallCheck$4(this,e),this.promise=createPublicPromise(),this.alive=!!r.onProgress,this._loaderType=t,this._loader=t===LoaderType.FETCH?new FetchLoader:new XhrLoader,this._config=r,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._logger=r.logger}var t;return _createClass$5(e,[{key:"exec",value:function(){var e=this,t=this._config,r=t.retry,n=t.retryDelay,i=t.onRetryError,a=t.transformError,o=_objectWithoutProperties(t,_excluded$2),s=function(){var t=_asyncToGenerator$1(regenerator.mark((function t(){var u,c;return regenerator.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e._logger.debug("[task request ready to load]",o.range),t.next=4,e._loader.load(o);case 4:u=t.sent,e.promise.resolve(u),t.next=29;break;case 8:if(t.prev=8,t.t0=t.catch(0),e._loader.running=!1,e._logger.debug("[task request catch err]",t.t0),!e._canceled){t.next=14;break}return t.abrupt("return");case 14:if(!(t.t0.response&&t.t0.response.status>=400&&t.t0.response.status<=599)){t.next=17;break}return e.promise.reject(t.t0),t.abrupt("return");case 17:if(t.t0.loaderType=e._loaderType,t.t0.retryCount=e._retryCount,c=t.t0,a&&(c=a(c)||c),i&&e._retryCount>0&&i(c,e._retryCount,r),e._retryCount++,!(e._retryCount<=r)){t.next=28;break}return clearTimeout(e._retryTimer),e._logger.debug("[task request setTimeout],retry",e._retryCount,",retry range,",o.range),e._retryTimer=setTimeout(s,n),t.abrupt("return");case 28:e.promise.reject(c);case 29:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(){return t.apply(this,arguments)}}();return this._logger.debug("[task request start]",this._config.range),s(),this.promise}},{key:"cancel",value:(t=_asyncToGenerator$1(regenerator.mark((function e(){return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,e.abrupt("return",this._loader.cancel());case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"running",get:function(){return this._loader&&this._loader.running}}]),e}(),NetLoader=function(){function e(t){_classCallCheck$4(this,e),_defineProperty$5(this,"type",LoaderType.FETCH),_defineProperty$5(this,"_queue",[]),_defineProperty$5(this,"_alive",[]),_defineProperty$5(this,"_currentTask",null),this._config=getConfig$1(t),this._config.loaderType!==LoaderType.XHR&&FetchLoader.isSupported()||(this.type=LoaderType.XHR),this.log=t.logger}return _createClass$5(e,[{key:"isFetch",value:function(){return this.type===LoaderType.FETCH}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"!=typeof e&&e?t=e:t.url=e||t.url||this._config.url,(t=Object.assign({},this._config,t)).params&&(t.params=Object.assign({},t.params)),t.headers&&isPlainObject(t.headers)&&(t.headers=Object.assign({},t.headers)),t.body&&isPlainObject(t.body)&&(t.body=Object.assign({},t.body)),t.transformRequest&&(t=t.transformRequest(t)||t),t.logger=this.log;var r=new Task(this.type,t);return this._queue.push(r),1!==this._queue.length||this._currentTask&&this._currentTask.running||this._processTask(),r.promise}},{key:"cancel",value:function(){var e=this._queue.map((function(e){return e.cancel()})).concat(this._alive.map((function(e){return e.cancel()})));return this._currentTask&&e.push(this._currentTask.cancel()),this._queue=[],this._alive=[],Promise.all(e)}},{key:"_processTask",value:function(){var e=this;this._currentTask=this._queue.shift(),this._currentTask&&(this._currentTask.alive&&this._alive.push(this._currentTask),this._currentTask.exec().finally((function(){e._processTask()})))}}],[{key:"isFetchSupport",value:function(){return FetchLoader.isSupported()}},{key:"getSpeed",value:function(){return SpeedSampler$1.getSpeed()}},{key:"getRealTimeSpeed",value:function(){return SpeedSampler$1.getRealTimeSpeed()}},{key:"getRTT",value:function(){return SpeedSampler$1.getRTT()}}]),e}();function concatUint8Array$1(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=t.filter(Boolean);var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){n.set(e,i),i+=e.byteLength})),n}var Logger$1=function(){function e(t){_classCallCheck$4(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return _createClass$5(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).debug.apply(t,[this._prefix].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,[this._prefix].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).error.apply(t,[this._prefix].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();function ownKeys$4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$3(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$4(Object(r),!0).forEach((function(t){_defineProperty$5(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$4(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function getConfig(e){return _objectSpread$3(_objectSpread$3({vid:"",moovEnd:8e3,segmentDuration:0,maxDownloadInfoSize:30,cache:null},e),{},{responseType:"arraybuffer"})}_defineProperty$5(Logger$1,"disabled",!0);var MediaError=_createClass$5((function e(t,r){_classCallCheck$4(this,e),this.type="file",this.message=t,this.data=r})),Cache=function(){function e(){_classCallCheck$4(this,e),_defineProperty$5(this,"_data",Object.create(null))}return _createClass$5(e,[{key:"set",value:function(e,t){this._data[e]=t}},{key:"get",value:function(e){return this._data[e]}},{key:"clear",value:function(){this._data=Object.create(null)}}]),e}();function moovToSegments(e,t){var r=e.trak;if(r&&r.length){var n=r.find((function(e){var t,r;return"vide"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),i=r.find((function(e){var t,r;return"soun"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)}));if(n||i){var a,o=[],s=[];if(n){var u,c,l,d=null===(u=n.mdia)||void 0===u||null===(c=u.minf)||void 0===c?void 0:c.stbl;if(!d)return;var h=null===(l=n.mdia.mdhd)||void 0===l?void 0:l.timescale,f=d.stts,p=d.stsc,g=d.stsz,y=d.stco,m=d.stss;if(!(h&&f&&p&&g&&y&&m))return;a=(o=getSegments(t,h,f,p,g,y,m)).map((function(e){return e.duration}))}if(i){var v,_,b,A=null===(v=i.mdia)||void 0===v||null===(_=v.minf)||void 0===_?void 0:_.stbl;if(!A)return;var E=null===(b=i.mdia.mdhd)||void 0===b?void 0:b.timescale,S=A.stts,T=A.stsc,w=A.stsz,C=A.stco;if(!(E&&S&&T&&w&&C))return;s=getSegments(t,E,S,T,w,C,null,a)}return{videoSegments:o,audioSegments:s}}}}function getSegments(e,t,r,n,i,a,o,s){var u,c,l,d=[],h=[],f=[],p=n.entries,g=a.entries,y=i.entrySizes,m=null==o?void 0:o.entries;m&&(u={},m.forEach((function(e){u[e-1]=!0})));var v=0,_=0,b=0,A=0,E=0,S=p[0].samplesPerChunk,T=p[1]?p[1].firstChunk-1:1/0;r.entries.forEach((function(e){var t=e.count,r=e.delta;l=r;for(var n=0;n<t;n++)c={startTime:v,duration:l,size:y[_]||i.sampleSize,offset:g[b]+E,index:_},m&&(c.keyframe=u[_],c.keyframe?(h.push([c]),f.push(c.duration)):(h[h.length-1].push(c),f[h.length-1]+=c.duration)),d.push(c),v+=l,++_<S?E+=c.size:(b++,E=0,b>=T&&(A++,T=p[A+1]?p[A+1].firstChunk-1:1/0),S+=p[A].samplesPerChunk)}));var w=d.length;if(w&&(!o||d[0].keyframe)){var C,k=[],I=[],$=0,P=function(e){var r;C=I[I.length-1],k.push({index:k.length,startTime:(null===(r=k[k.length-1])||void 0===r?void 0:r.endTime)||I[0].startTime/t,endTime:(C.startTime+C.duration)/t,duration:e,range:[I[0].offset,C.offset+C.size],frames:I}),$=0,I=[]};if(o)for(var x=0,R=0,O=h.length;R<O;R++){var D,L;if($+=f[R],(D=I).push.apply(D,_toConsumableArray$1(h[R])),R+1<O){if((x=$+f[R+1])>=e)if(x-e<Math.abs(e-$))(L=I).push.apply(L,_toConsumableArray$1(h[R+1])),$+=f[R+1],P((f[R]+f[R+1])/t),R++;else P(f[R]/t)}else P(f[R]/t)}else for(var M=(s=s||[])[0]||e,N=0;N<w;N++)I.push(d[N]),$+=d[N].duration,(N+1>=w||$/t>=M)&&(P($/t),M=s[k.length]||e);return k}}function moovToMeta(e){var t="",r="",n=0,i=0,a=0,o=0,s=0;e.mvhd&&(s=e.mvhd.duration/e.mvhd.timescale);var u=e.trak;if(u){var c,l,d,h,f,p,g,y,m,v,_,b,A,E=u.find((function(e){var t,r;return"vide"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),S=u.find((function(e){var t,r;return"soun"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),T=null;if(E)if(T=null===(l=E.mdia)||void 0===l||null===(d=l.minf)||void 0===d||null===(h=d.stbl)||void 0===h?void 0:h.stsd.entries[0])if(n=T.width,i=T.height,t=null===(f=T.avcC||T.hvcC)||void 0===f?void 0:f.codec,"encv"===T.type)c=null===(p=T.sinf)||void 0===p||null===(g=p.schi)||void 0===g?void 0:g.tenc.default_KID;if(S)if(T=null===(y=S.mdia)||void 0===y||null===(m=y.minf)||void 0===m||null===(v=m.stbl)||void 0===v?void 0:v.stsd.entries[0])if(a=T.channelCount,o=T.sampleRate,r=null===(_=T.esds)||void 0===_?void 0:_.codec,"enca"===T.type)c=c||(null===(b=T.sinf)||void 0===b||null===(A=b.schi)||void 0===A?void 0:A.tenc.default_KID);return{kid:c?c.join(""):null,videoCodec:t,audioCodec:r,width:n,height:i,audioChannelCount:a,audioSampleRate:o,duration:s,moov:e}}}function isNumber$1(e){return"number"==typeof e&&!isNaN(e)}var _excluded$1=["vid","moovEnd","segmentDuration","cache","maxDownloadInfoSize"];function ownKeys$3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$3(Object(r),!0).forEach((function(t){_defineProperty$5(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$3(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var MP4Loader$1=function(){function e(t){_classCallCheck$4(this,e),_defineProperty$5(this,"vid",""),_defineProperty$5(this,"url",""),_defineProperty$5(this,"meta",{}),_defineProperty$5(this,"downloadInfo",[]),_defineProperty$5(this,"videoSegments",[]),_defineProperty$5(this,"audioSegments",[]),_defineProperty$5(this,"cache",null),_defineProperty$5(this,"_currentSegmentIndex",-1),_defineProperty$5(this,"_currentLoadingSegmentIndex",-1),_defineProperty$5(this,"_transformError",(function(e){return e})),this._config=getConfig(t);var r=this._config,n=r.vid;r.moovEnd,r.segmentDuration;var i=r.cache;r.maxDownloadInfoSize;var a=_objectWithoutProperties(r,_excluded$1);this.cache=i||new Cache,this.vid=n||a.url,this.url=a.url,a.transformError=this._transformError,this.logger=new Logger$1("MP4Loader_"+this.vid),t.openLog&&Logger$1.enable(),a.logger=this.logger,this._loader=new NetLoader(a)}var t,r,n,i,a,o,s,u,c,l;return _createClass$5(e,[{key:"isMetaLoaded",get:function(){return this.videoSegments.length||this.audioSegments.length}},{key:"setCurrentSegment",value:function(e){isNumber$1(e)&&(this._currentSegmentIndex=e)}},{key:"isLastSegment",value:function(e){var t,r;return!!isNumber$1(e)&&e===((null===(t=this.videoSegments[this.videoSegments.length-1])||void 0===t?void 0:t.index)||(null===(r=this.audioSegments[this.audioSegments.length-1])||void 0===r?void 0:r.index)||0)}},{key:"isSegmentLoading",value:function(e){return e===this._currentLoadingSegmentIndex}},{key:"changeUrl",value:(l=_asyncToGenerator$1(regenerator.mark((function e(t){var r,n,i,a=arguments;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:t,n=a.length>2?a[2]:void 0,i=a.length>3?a[3]:void 0,e.next=5,this.reset(i);case 5:t&&(this.url=t),r&&(this.vid=r),n&&(this._config.moovEnd=n);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"getOrLoadMeta",value:(c=_asyncToGenerator$1(regenerator.mark((function e(t){return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isMetaLoaded){e.next=3;break}return e.next=3,this.loadMeta(t);case 3:return e.abrupt("return",this.meta);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"loadMeta",value:(u=_asyncToGenerator$1(regenerator.mark((function e(t,r){var n,i,a,o,s,u,c,l,d;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],this.logger.debug("[loadMeta start]"),e.next=4,this.loadData([0,r||this._config.moovEnd],t);case 4:if(i=e.sent){e.next=7;break}return e.abrupt("return");case 7:if(n.push(i),a=MP4Parser.findBox(i.data,["moov"])[0]){e.next=23;break}if(o=MP4Parser.findBox(i.data,["mdat"])[0]){e.next=13;break}throw new MediaError("cannot find moov or mdat box",i.data);case 13:return s=o.start+o.size,e.next=16,this.loadData([s],t);case 16:if(i=e.sent){e.next=19;break}return e.abrupt("return");case 19:if(n.push(i),a=MP4Parser.findBox(i.data,["moov"],s)[0]){e.next=23;break}throw new MediaError("cannot find moov box",i.data);case 23:if(!(a.size>a.data.length)){e.next=31;break}return e.next=26,this.loadData([i.data.length,a.start+a.size-1],t);case 26:if(i=e.sent){e.next=29;break}return e.abrupt("return");case 29:n.push(i),a.data=concatUint8Array$1(a.data,i.data);case 31:if(u=MP4Parser.moov(a)){e.next=34;break}throw new MediaError("cannot parse moov box",a.data);case 34:if(c=moovToSegments(u,this._config.segmentDuration)){e.next=37;break}throw new MediaError("cannot parse segments",a.data);case 37:return this.meta=moovToMeta(u),l=c.videoSegments,d=c.audioSegments,this.videoSegments=l,this.audioSegments=d,this.logger.debug("[load moov end!!!!!]"),e.abrupt("return",{meta:this.meta,videoSegments:l,audioSegments:d,responses:n});case 43:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"getSegmentByTime",value:function(e){var t,r;return this.videoSegments.length?(t=this.videoSegments.find((function(t){return t.startTime<=e&&t.endTime>e})))&&(r=this.audioSegments[t.index]):r=this.audioSegments.find((function(t){return t.startTime<=e&&t.endTime>e})),{video:t,audio:r}}},{key:"loadSegmentByTime",value:(s=_asyncToGenerator$1(regenerator.mark((function e(t,r){var n,i,a,o,s,u=arguments;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(u.length>2&&void 0!==u[2])||u[2],i=u.length>3&&void 0!==u[3]?u[3]:{},this.isMetaLoaded){e.next=5;break}return e.next=5,this.loadMeta(r);case 5:return a=this.getSegmentByTime(t),o=a.video,s=a.audio,e.abrupt("return",this._loadSegment(o,s,r,n,i));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"loadNextSegment",value:(o=_asyncToGenerator$1(regenerator.mark((function e(t){var r,n,i,a,o=arguments;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(o.length>1&&void 0!==o[1])||o[1],n=o.length>2&&void 0!==o[2]?o[2]:{},this.isMetaLoaded){e.next=5;break}return e.next=5,this.loadMeta();case 5:return i=this.videoSegments[this._currentSegmentIndex+1],a=this.audioSegments[this._currentSegmentIndex+1],e.abrupt("return",this._loadSegment(i,a,t,r,n));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"preload",value:(a=_asyncToGenerator$1(regenerator.mark((function e(t){var r,n,i,a,o,s,u,c=this;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isMetaLoaded){e.next=3;break}return e.next=3,this.loadMeta(!0);case 3:if(t&&!(t<0)){e.next=5;break}return e.abrupt("return");case 5:if(r=this.getSegmentByTime(t),n=r.video,i=r.audio,a=Math.max((null==n?void 0:n.index)||0,(null==i?void 0:i.index)||0)){e.next=9;break}return e.abrupt("return");case 9:return o=this.videoSegments.slice(0,a),s=this.audioSegments.slice(0,a),u=function(){var e=_asyncToGenerator$1(regenerator.mark((function e(t){return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t>a)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,c._loadSegment(o[t],s[t],!0,!1);case 4:return e.next=6,u(t+1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=14,u(0);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"cancel",value:function(){return this._loader.cancel()}},{key:"reset",value:(i=_asyncToGenerator$1(regenerator.mark((function e(){var t=arguments;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length>0&&void 0!==t[0]&&t[0]){e.next=5;break}return this.logger.debug("[MP4loader reset func call loader.cancel]"),e.next=5,this._loader.cancel();case 5:this.vid=this.url="",this.meta={},this.downloadInfo=[],this.videoSegments=[],this.audioSegments=[],this._currentSegmentIndex=-1,this._currentLoadingSegmentIndex=-1;case 12:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"destroy",value:(n=_asyncToGenerator$1(regenerator.mark((function e(){return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cancel();case 2:this.cache.clear();case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_loadSegment",value:(r=_asyncToGenerator$1(regenerator.mark((function e(t,r,n,i,a){var o,s;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||r){e.next=2;break}return e.abrupt("return");case 2:return o=(null==t?void 0:t.index)||(null==r?void 0:r.index)||0,this._currentLoadingSegmentIndex=o,e.prev=4,e.next=7,this.loadData([Math.min((null==t?void 0:t.range[0])||1/0,(null==r?void 0:r.range[0])||1/0),Math.max((null==t?void 0:t.range[1])||0,(null==r?void 0:r.range[1])||0)],n,a);case 7:s=e.sent;case 8:return e.prev=8,this._currentLoadingSegmentIndex=-1,e.finish(8);case 11:if(s){e.next=13;break}return e.abrupt("return");case 13:return i&&(this._currentSegmentIndex=o),s.video=t,s.audio=r,e.abrupt("return",s);case 17:case"end":return e.stop()}}),e,this,[[4,,8,11]])}))),function(e,t,n,i,a){return r.apply(this,arguments)})},{key:"loadData",value:(t=_asyncToGenerator$1(regenerator.mark((function e(t,r,n){var i,a,o;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this._getCacheKey(t),e.next=3,this.cache.get(i);case 3:if(a=e.sent){e.next=10;break}return e.next=7,this._loader.load(this.url,_objectSpread$2({range:t,vid:this.vid},n));case 7:o=e.sent,e.next=11;break;case 10:o={data:a,state:!0,options:{fromCache:!0,range:t,vid:this.vid}};case 11:if(o){e.next=13;break}return e.abrupt("return");case 13:return a||(o.data&&this.downloadInfo.push({startTime:o.startTime,endTime:o.endTime,size:o.data.byteLength,range:t}),this.downloadInfo&&this.downloadInfo.length>this._config.maxDownloadInfoSize&&(this.downloadInfo=this.downloadInfo.slice(-this._config.maxDownloadInfoSize))),e.abrupt("return",o);case 16:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})},{key:"_getCacheKey",value:function(e){return(this.vid||this.url)+":"+e}}],[{key:"speed",value:function(){return NetLoader.getSpeed()}},{key:"realTimeSpeed",value:function(){return NetLoader.getRealTimeSpeed()}},{key:"RTT",value:function(){return NetLoader.getRTT()}}]),e}(),MP4Loader=MP4Loader$1,isSupport=_isLocalStorageUsable(),openLog=checkOpenLog();function probeSupport(){try{return"undefined"!=typeof localStorage&&"setItem"in window.localStorage&&!!window.localStorage.setItem}catch(e){return!1}}function checkIfLocalStorageThrows(){var t="_localstorage_support_test";try{return window.localStorage.setItem(t,!0),window.localStorage.removeItem(t),!1}catch(e){return!0}}function checkOpenLog(){if(isSupport)try{return!!window.localStorage.getItem("playerlog")}catch(e){return!1}return!1}function _isLocalStorageUsable(){return probeSupport()&&!checkIfLocalStorageThrows()}function log(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];openLog&&console.log&&(t=console).log.apply(t,["[logger]",e].concat(n))}var MONITOR_HEADERS={"x-cache":"x_cache","x-response-sinfo":"server_ip","x-response-cinfo":"x-response-cinfo"};function transformHeaders(e){var t={};return Object.keys(MONITOR_HEADERS).forEach((function(r){var n=MONITOR_HEADERS[r];e&&e.get(r)&&(t[n]=e.get(r))})),t}function getFileSize(e){var t="",r=(t=e.get?e.get("content-range"):e["content-range"]||"")?t.split("/"):[];return r.length>1?parseInt(r[1],10):0}function ownKeys$2(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$1(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$2(Object(r),!0).forEach((function(t){_defineProperty$5(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$2(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var MP4_EVENTS={ERROR:"error",META_READY:"metaReady",MOOV_READY:"moovReady",TASK_PROGRESS:"progress_event",FRAGMENT:"fragment"},MP4$1=function(){function t(e,r,n,i){var a=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[];_classCallCheck$4(this,t),EventEmitter(this),this.url=e,this.backUrl=u||[],this._bitRate=r,this.options=t.getDefaultConfig(),Object.keys(n).map((function(e){void 0!==n[e]&&null!==n[e]&&(a.options[e]=n[e])})),this.timeRange=[],this.CHUNK_SIZE=this.options.chunkSize,this.player=i,this.bufferLoaded=new Uint8Array(0),this.meta=null,this.preloadCacheBuffer=[],this.preloadBuffer=null,this.preloader=o||this.player&&this.player.preloader,this.videoTrak=null,this.audioTrak=null,this.canDownload=!0,this._loadSuccessCallBack=null,this._loadErrCallBack=null,this._isPending=!1,this._loadingMoov=!1,this.MP4Loader=new MP4Loader({segmentDuration:0,url:e,vid:n.vid,retry:n.retryCount||2,retryDelay:n.retryDelay||1e3,openLog:checkOpenLog()}),this.MP4Demuxer=new MP4Demuxer(null,null,null,{openLog:checkOpenLog()}),this.FMP4Remuxer=null,this._needInitSegment=!0,this._bitRateInfoMap=new Map,this._switchBitRate=!1,this.init(s),this._segmentToBitRateMap=new Map,this._seekIdxWhenLoadingMoov=-1}var r,n,i,a,o,s,u,c;return _createClass$5(t,[{key:"changeBitRate",value:function(e){e.bitrate!==this._bitRate&&(this.url=e.url,this._bitRate=e.bitrate,this.backUrl=e.backupURL,this._switchBitRate=!0,this.MP4Loader.changeUrl(this.url,this.vid+"-"+this._bitRate,this.CHUNK_SIZE))}},{key:"_getByPreload",value:function(t,r,n,i){try{if(t&&t.byteLength>=r){var a={endTime:(new Date).getTime(),startTime:(new Date).getTime(),index:i,range:[],vid:this.options.vid,from:"local"};if(n<=t.byteLength){var o=t.slice(r,n);return a.range=[r,n],a.state=!0,{buffer:o,context:a,state:!0}}var s=t.byteLength-1,u=t.slice(r,s);return a.range=[r,s],{context:a,buffer:u,state:!1}}return null}catch(e){return console.error("[MP4] _getByPreload",r,n,e),null}}},{key:"log",value:function(e){for(var t=this.options,r=t&&t.vid?"[MP4]".concat(t.vid," ").concat(e):"[MP4] ".concat(e),n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];log.apply(void 0,[r].concat(i))}},{key:"errorHandler",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=e.response,i=e.message,a=this.options.vid,o=null;if(this._isPending=!0,n){var s=transformHeaders(n.headers);if(o=new NetWorkError("network",n.status,{httpText:n.httpText,message:i,url:n.url,headers:s}),console.log("[MP4] [".concat(a,"] errorHandler error state:[").concat(t,"], _isPending:[").concat(this._isPending,"] "),o),this.backUrl&&this.backUrl.length>0){console.log("[MP4] [".concat(a,"] errorHandler start backUpUrl retry"),this.backUrl.length,this.backUrl);var u=this.backUrl[0];if(this.backUrl.splice(0,1),this.update(u),this.MP4Loader&&this.MP4Loader.changeUrl(this.url,this.url+"-"+this._bitRate,this.CHUNK_SIZE),this.emit(MP4_EVENTS.TASK_PROGRESS,{type:"error",error:e}),"getMetaInfo"===t)return void this.getMetaInfo();if("loadFragment"===t){var c=r.index,l=r.range;if(c&&l)return void this.loadFragment(c,l)}}console.log("[MP4] [".concat(a,"] errorHandler backUpUrl is null emit error")),this.emit("error",o)}else console.log("[MP4] [".concat(a,"] errorHandler,"),e),o=e,this.emit("error",o)}},{key:"init",value:(c=_asyncToGenerator$1(regenerator.mark((function e(t){var r,n,i,a=this;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.url){e.next=3;break}return e.next=3,this.MP4Loader.changeUrl(this.url,this.options.vid+"-"+this._bitRate,this.CHUNK_SIZE);case 3:if(this.meta=null,this.preloadCacheBuffer=[],r=t.meta,n=t.mediaSegList,(i=t.buffer)?this.preloadBuffer=i:n&&n.length&&(this.meta=r,this.preloadCacheBuffer=n||[]),!this.meta||!this.meta.ext){e.next=14;break}this.videoTrak=this.meta.ext.videoTrak,this.audioTrak=this.meta.ext.audioTrak,this.timeRange=this.getTimeRange(),setTimeout((function(){a.emit("metaReady",a.meta)})),e.next=16;break;case 14:return e.next=16,this.getMetaInfo();case 16:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"getTimeRange",value:function(){for(var e=[],t=null,r=0;this.videoTrak&&r<this.videoTrak.length;r++)t={startTime:this.videoTrak[r].startTime,endTime:this.videoTrak[r].endTime,downloaded:!1,isLoading:!1},e.push(t);if(this.audioTrak&&this.audioTrak.length>e.length)for(var n=e.length;n<this.audioTrak.length;n++)t={startTime:Math.max(this.audioTrak[n].startTime,t?t.endTime:0),endTime:Math.max(this.audioTrak[n].endTime,t?t.endTime:0),downloaded:!1,isLoading:!1},e.push(t);return e}},{key:"getMetaInfo",value:(u=_asyncToGenerator$1(regenerator.mark((function e(){var t,r,n,i,a,o=arguments;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(o.length>0&&void 0!==o[0])||o[0],e.prev=1,this._loadingMoov=!0,this.log("[ABR], getMetaInfo start, bitRate,",this._bitRate),e.next=6,this.MP4Loader.loadMeta(this.MP4Loader.cache,this.CHUNK_SIZE);case 6:if(r=e.sent){for(this.videoTrak=r.videoSegments,this.audioTrak=r.audioSegments,this.timeRange=this.getTimeRange(),this.meta=_objectSpread$1(_objectSpread$1({},r.meta),{},{ext:{videoTrak:this.videoTrak,audioTrak:this.audioTrak}}),n=0,this.bufferLoaded=new Uint8Array(0),i=0;i<r.responses.length;i++)(a=r.responses)[i].option.range[0]===n&&(this.bufferLoaded=lib$1(Uint8Array,this.bufferLoaded,new Uint8Array(a[i].data)),n+=a[i].data.byteLength);r.bufferLoaded=this.bufferLoaded,t&&this.emit("metaReady",this.meta),this._loadingMoov=!1,this._bitRateInfoMap.set(this._bitRate,r),this.log("[ABR], getMetaInfo end, bitRate,",this._bitRate)}else this._loadingMoov=!1,console.log("[MP4]  getMetaInfo cancle ,so return null");e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.log("[MP4] trigger errorHandler getMetaInfo",e.t0),this.errorHandler(e.t0,"getMetaInfo");case 14:case"end":return e.stop()}}),e,this,[[1,10]])}))),function(){return u.apply(this,arguments)})},{key:"getFragmentIdx",value:function(e){var t=null,r=null;if(this.videoTrak||this.videoTrak.length)return(t=this.videoTrak.find((function(t){return t.startTime<=e&&t.endTime>e})))?t.index:r?r.index:-1;r=this.audioTrak.find((function(t){return t.startTime<=e&&t.endTime>e}))}},{key:"_checkHasMeta",value:(s=_asyncToGenerator$1(regenerator.mark((function e(){var t;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._bitRateInfoMap.get(this._bitRate)){e.next=10;break}return this.log("[ABR], need load InitSegment, bitRate, ",this._bitRate),e.next=5,this.getMetaInfo(!1);case 5:if(this._bitRateInfoMap.get(this._bitRate)){e.next=7;break}return e.abrupt("return",!1);case 7:return e.abrupt("return",!0);case 10:return this.log("[ABR], not need load InitSegment, bitRate, ",this._bitRate),this.videoTrak=t.videoSegments,this.audioTrak=t.audioSegments,this.meta=t.meta,this.timeRange=this.getTimeRange(),this.bufferLoaded=t.bufferLoaded,e.abrupt("return",!0);case 17:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"resetFragmentLoadState",value:function(e){for(var t=0;t<this.timeRange.length;t++)t<e?(this.timeRange[t].downloaded=!0,this.timeRange[t].isLoading=!0):(this.timeRange[t].downloaded=!1,this.timeRange[t].isLoading=!1)}},{key:"getFragRange",value:function(e){var t=e<this.videoTrak.length?this.videoTrak[e]:null,r=e<this.audioTrak.length?this.audioTrak[e]:null,n=0,i=0;e===this.videoTrak.length-1&&(n=-1),e===this.audioTrak.length-1&&(i=-1);var a=[Math.min((null==t?void 0:t.range[0])||1/0,(null==r?void 0:r.range[0])||1/0),Math.max((null==t?void 0:t.range[1])+n||0,(null==r?void 0:r.range[1])+i||0)];return this.timeRange[e].range=a,a}},{key:"load",value:(o=_asyncToGenerator$1(regenerator.mark((function e(t,r,n){var i,a,o,s,u;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loadSuccessCallBack=r,this._loadErrCallBack=n,i=-1,0===t||(!this.timeRange[t].isLoading||this.timeRange[t].downloaded)&&this.timeRange[t-1].downloaded){e.next=6;break}return this.log("[ABR], before  fragIndex is not loaded, wait!!!!!!!!!!!"),e.abrupt("return");case 6:if(!this._switchBitRate||this._loadingMoov){e.next=19;break}return this._switchBitRate=!1,e.next=10,this._checkHasMeta();case 10:if(e.sent){e.next=13;break}return e.abrupt("return");case 13:this._needInitSegment=!0,this.MP4Demuxer&&this.MP4Demuxer.reset(),this.FMP4Remuxer&&this.FMP4Remuxer.reset(),this._seekIdxWhenLoadingMoov>0&&(t=this._seekIdxWhenLoadingMoov,this._seekIdxWhenLoadingMoov=-1,this.log("[ABR], when loading moov, seek jump index,",t)),this.resetFragmentLoadState(t),this.log("[ABR], switch bitRate start load, bitRate,",this._bitRate,", time,",this.videoTrak[t].startTime,", fragIndex,",t);case 19:if(!this._loadingMoov){e.next=22;break}return this.log("[ABR], moov not end, wait !!!!!!!!!!!"),e.abrupt("return");case 22:if(this.preloadCacheBuffer)for(a=0;a<this.preloadCacheBuffer.length;a++)this.preloadCacheBuffer[a].index===t&&(i=a);if(o=this.getFragRange(t),!(i>-1)){e.next=36;break}if(!((s=this.preloadCacheBuffer[i]).range[1]>=o[1]&&s.buffer.byteLength>=o[1]-o[0])){e.next=32;break}this.timeRange[t].downloaded=!0,u=[this.timeRange[t].startTime,this.timeRange[t].endTime],this._loadSuccessCallBack&&this._loadSuccessCallBack({buffer:s.buffer,context:{range:o,fragIndex:t,state:!0,timeRange:[u[0],u[1]]}}),e.next=34;break;case 32:return e.next=34,this.loadFragment(t,o);case 34:e.next=39;break;case 36:return this.log("[ABR], loadFragment,",t,",bitRate,",this._bitRate,",range,",o),e.next=39,this.loadFragment(t,o);case 39:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return o.apply(this,arguments)})},{key:"onprogressDataArrive",value:(a=_asyncToGenerator$1(regenerator.mark((function e(t,r,n){var i;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&t.byteLength>0&&((i=this.timeRange[n.index].range)&&n.range[1]>=i[1]&&!r&&(r=!0),this.log("[mp4.loadFragment onprogressDataArrive ] receive data, >>> index,",n.index,",range,",n.range,", dataLen,",t.byteLength),this._mux(t,n.range[0],n.index,r)),r&&(this.timeRange[n.index].downloaded=!0,this.log("[FragLoadDowned],fragmentIdx,",n.index,",rangeEnd,",n.range[1]));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return a.apply(this,arguments)})},{key:"_concatData",value:function(e,t){var r=[];e&&r.push(e),t&&r.push(t);var n=0;r.every((function(e){return e&&(n+=e.byteLength),!0}));var i=new Uint8Array(n),a=0;return r.every((function(e){return e&&(i.set(e,a),a+=e.byteLength),!0})),i}},{key:"_mux",value:function(t,r,n,i,a){try{var o=this.MP4Demuxer.demuxPart(t,r,n,this.meta.moov,this.useEME,this.kidValue);this.FMP4Remuxer||(this.FMP4Remuxer=new FMP4Remuxer(this.MP4Demuxer.videoTrack,this.MP4Demuxer.audioTrack,{openLog:checkOpenLog()}));var s=this.FMP4Remuxer.remux(this._needInitSegment,{initMerge:!0});this._needInitSegment=!1;var u=this._concatData(s.videoSegment,s.audioSegment),c=[r,r+t.byteLength],l={buffer:u,range:c,state:i,context:{range:c,fragIndex:n,startPts:Math.min(o.videoTrack.startPts,o.audioTrack.startPts),endPts:Math.max(o.videoTrack.endPts,o.audioTrack.endPts)},initSeg:s.initSegment};a?a(l):this._loadSuccessCallBack&&this._loadSuccessCallBack(l)}catch(e){console.error("mux err:",e),this.errorHandler(e,"mux",{fragIndex:n,range:[r,r+t.byteLength]})}}},{key:"loadFragment",value:(i=_asyncToGenerator$1(regenerator.mark((function e(t,r){var n,i,a;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isPending&&r!==[0,0]&&!this.timeRange[t].isLoading){e.next=2;break}return e.abrupt("return");case 2:if(this.log("[MP4.loadFragment] ,fragIndex,",t,",range ",r,",len ,",r[1]-r[0]),this._segmentToBitRateMap.set(t,this._bitRate),!(r.length>=2&&r[1]&&r[1]>0&&r[1]<=this.bufferLoaded.byteLength)){e.next=12;break}this.timeRange[t].isLoading=!0,n=new Uint8Array(this.bufferLoaded.slice(r[0],r[1])),this.log("[mp4.loadFragment] has data: ",r[0],r[1]),this.timeRange[t].downloaded=!0,this._mux(n,r[0],t,!0),e.next=39;break;case 12:if(!(r.length>=2&&r[0]&&r[0]<=this.bufferLoaded.byteLength)){e.next=29;break}if(this.timeRange[t].isLoading){e.next=27;break}return this.timeRange[t].isLoading=!0,i=r[0],a=new Uint8Array(this.bufferLoaded.slice(i,this.bufferLoaded.byteLength)),this._mux(a,i,t,!1),this.log("[mp4.loadFragment] ready to load part data >>> ",this.bufferLoaded.byteLength,r[1]),e.prev=19,e.next=22,this.MP4Loader.loadData([this.bufferLoaded.byteLength,r[1]],this.MP4Loader.cache,{index:t,onProgress:this.onprogressDataArrive.bind(this)});case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(19),this.errorHandler(e.t0,"MP4Loader.loadData",{range:[this.bufferLoaded.byteLength,r[1]],fragIndex:t});case 27:e.next=39;break;case 29:return this.log("[mp4.loadFragment],ready to load all data ,segmentIdx, ",t,",range >>> ",r),this.timeRange[t].isLoading=!0,e.prev=31,e.next=34,this.MP4Loader.loadData(r,this.MP4Loader.cache,{index:t,onProgress:this.onprogressDataArrive.bind(this)});case 34:e.next=39;break;case 36:e.prev=36,e.t1=e.catch(31),this.errorHandler(e.t1,"MP4Loader.loadData",{range:r,fragIndex:t});case 39:case"end":return e.stop()}}),e,this,[[19,24],[31,36]])}))),function(e,t){return i.apply(this,arguments)})},{key:"_loadFragmentData",value:(n=_asyncToGenerator$1(regenerator.mark((function e(t,r){var n,i,a,o,s;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.MP4Loader){e.next=2;break}return e.abrupt("return");case 2:if(!(n=this._getByPreload(this.preloadBuffer,r[0],r[1],t))||!n.buffer){e.next=12;break}if(i=n.context,a=n.state,o=i.range,this.onprogressDataArrive(n.buffer,a,i),a){e.next=11;break}r[0]=o[1],e.next=12;break;case 11:return e.abrupt("return");case 12:return e.prev=12,e.next=15,this.MP4Loader.loadData(r,this.MP4Loader.cache,{index:t,onProgress:this.onprogressDataArrive});case 15:return s=e.sent,e.abrupt("return",s);case 19:e.prev=19,e.t0=e.catch(12),this.timeRange[t].isLoading=!1,this.errorHandler(e.t0,"loadFragment",{index:t,range:r});case 23:case"end":return e.stop()}}),e,this,[[12,19]])}))),function(e,t){return n.apply(this,arguments)})},{key:"loadAllFragmentData",value:(r=_asyncToGenerator$1(regenerator.mark((function e(t,r,n){var i,a,o;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasDestroyed){e.next=2;break}return e.abrupt("return");case 2:return i=this.getFragRange(t),e.prev=3,e.next=6,this.MP4Loader.loadData(i,this.MP4Loader.cache,{index:t});case 6:if((a=e.sent)&&a.data){e.next=9;break}return e.abrupt("return");case 9:o=a.data,this._mux(o,i[0],t,!0,r),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(3),console.error("[MP4] loadAllFragmentData error",e.t0),n(e.t0);case 17:case"end":return e.stop()}}),e,this,[[3,13]])}))),function(e,t,n){return r.apply(this,arguments)})},{key:"update",value:function(e){this.url=e}},{key:"getDataBitRate",value:function(e){return this._segmentToBitRateMap.get(e)}},{key:"destroy",value:function(){if(!this.hasDestroyed){for(var e in this.MP4Demuxer&&this.MP4Demuxer.reset(),this.FMP4Remuxer&&this.FMP4Remuxer.reset(),this.MP4Loader&&(this.MP4Loader.cancel(),this.MP4Loader.destroy()),this)delete this[e];this.hasDestroyed=!0}}}],[{key:"speed",get:function(){return MP4Loader.speed()}},{key:"realTimeSpeed",get:function(){return MP4Loader.realTimeSpeed()}},{key:"getDefaultConfig",value:function(){return{xhrSetup:null,chunkSize:8e5,loadSize:800,isCache:!1,playerId:"",vid:"",ext:{}}}}]),t}(),$$6=_export,isArray$1=isArray$8;$$6({target:"Array",stat:!0},{isArray:isArray$1});var util={findBox:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(e.type!==t){if(e&&e.subBox){var n=e.subBox.filter((function(e){return e.type===t}));n.length?n.forEach((function(e){return r.push(e)})):e.subBox.forEach((function(e){return util.findBox(e,t,r)}))}}else r.push(e);return(r=[].concat(r)).length>1?r:r[0]},padStart:function(e,t,r){for(var n=String(r),i=t>>0,a=Math.ceil(i/n.length),o=[],s=String(e);a--;)o.push(n);return o.join("").substring(0,i-s.length)+s},toHex:function(){for(var e=[],t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach((function(t){e.push(util.padStart(Number(t).toString(16),2,0))})),e},sum:function(){for(var e=0,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach((function(t){e+=t})),e},stscOffset:function(e,t,r){var n=r[t];if(n){var i=Math.floor((t-n.first_sample)/n.samples_per_chunk),a=n.first_sample+i*n.samples_per_chunk;return{chunk_index:n.first_chunk+i,samples_offset:[a,t]}}var o=e.entries.pop();e.entries.push(o);var s=Math.floor((t-o.first_sample)/o.samples_per_chunk);return{chunk_index:o.first_chunk+s,samples_offset:[o.first_sample+o.samples_per_chunk*s,t]}},seekSampleOffset:function(e,t,r,n,i,a){var o=util.stscOffset(e,n+1,a),s=t.entries[o.chunk_index-1]+util.sum.apply(null,r.entries.slice(o.samples_offset[0]-1,o.samples_offset[1]-1))-i;if(void 0===s)throw new Error("result=".concat(s,",stco.length=").concat(t.entries.length,",sum=").concat(util.sum.apply(null,r.entries.slice(0,n))));if(s<0)throw new Error("result=".concat(s,",stco.length=").concat(t.entries.length,",sum=").concat(util.sum.apply(null,r.entries.slice(0,n))));return s},seekSampleTime:function(e,t,r){var n,i,a=0,o=0,s=0;return e.entry.every((function(e){return i=e.sampleDuration,r<a+e.sampleCount?(n=o+(r-a)*e.sampleDuration,!1):(a+=e.sampleCount,o+=e.sampleCount*i,!0)})),t&&t[r]&&(s=t[r]),n||(n=o+(r-a)*i),{time:n,duration:i,offset:s}},seekOrderSampleByTime:function(e,t,r){var n,i=0,a=0,o=0;return e.every((function(e,s){return n=e.sampleCount*e.sampleDuration/t,r<=i+n?(a=o+Math.ceil((r-i)*t/e.sampleDuration),i+=Math.ceil((r-i)*t/e.sampleDuration)*e.sampleDuration/t,!1):(i+=n,o+=e.sampleCount,!0)})),0===a&&o>0&&(a=o-1),{order:a,startTime:i}},seekTrakDuration:function(e,t){var r=util.findBox(e,"stts"),n=0;return r.entry.forEach((function(e){n+=e.sampleCount*e.sampleDuration})),Number(n/t).toFixed(4)},StringToArrayBuffer:function(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t},fromHex:function(e){for(var t=new Uint8Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=window.parseInt(e.substr(r,2),16);return t},fromCharCode:function(e){for(var t="",r=0;r<e.length;r+=16e3){var n=e.subarray(r,r+16e3);t+=String.fromCharCode.apply(null,n)}return t},ArrayBufferToString:function(e){for(var t="",r=new Uint8Array(e),n=0;n<r.length;n++)t+=String.fromCharCode(r[n]);return t},Base64ToHex:function(e){for(var t=window.atob(e.replace(/-/g,"+").replace(/_/g,"/")),r="",n=0;n<t.length;n++)r+=("0"+t.charCodeAt(n).toString(16)).substr(-2);return r},toBase64:function(e,t){var r=util.fromCharCode(e);t=void 0===t||t;var n=window.btoa(r).replace(/\+/g,"-").replace(/\//g,"_");return t?n:n.replace(/=*$/,"")},toUTF8:function(e){for(var t=encodeURIComponent(e),r=unescape(t),n=new Uint8Array(r.length),i=0;i<r.length;++i)n[i]=r.charCodeAt(i);return n.buffer},bufferToString:function(e){return("0"+Number(e).toString(16)).slice(-2).toUpperCase()},strToBuf:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e[r]+e[r+1],16));return new Uint8Array(t)},formatIV:function(e){var t="";if(e.forEach((function(e){t+=util.bufferToString(e)})),t.length<=32)for(var r=32-t.length,n=0;n<r;n++)t+="0";return t},str2hex:function(e){if(""===e)return"";for(var t=[],r=0;r<e.length;r++)t.push(e.charCodeAt(r));return t},parse:function(e){if(!Array.isArray(e)){for(var t=[],r="",n=0;n<e.length;n++)n%2&&(r=e[n-1]+e[n],t.push(parseInt(r,16)),r="");return t}return e.map((function(e){return parseInt(e,16)}))},generateUniqueKey:function(e){var t=e.vid;e.start,e.end;var r=e.mediaType,n=e.definition;return e.preloadTime,r=r||"video",n=n||"0",t?"".concat(t,"#").concat(r,"#").concat(n,"#mp4"):null},validateFragment:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(t instanceof ArrayBuffer){try{if(2===r.length){var n=r[1]-r[0]+1;if(!(t.byteLength===n))return}}catch(e){return console.error(e),!1}return!0}return!1},typeOf:function(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]},getBufferSplits:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e5,n=t-e;if(n-r<r/2||!t)return[[e,t]];for(var i=[];e<t;){var a=e+r;(a>t||t-a<r/2)&&(a=t),i.push([e,a]),e=a+1}return i},nowTime:function(){try{return parseInt(performance.now(),10)}catch(e){return(new Date).getTime()}},extUrl:function(t,r){try{var n=t.indexOf("?");return n<0?Object.keys(r).map((function(e,n){t+=0===n?"?".concat(e,"=").concat(r[e]):"&".concat(e,"=").concat(r[e])})):Object.keys(r).map((function(e,i){n===t.length-1?t+="".concat(e,"=").concat(r[e]):t+="&".concat(e,"=").concat(r[e])})),t}catch(e){return t}},getFileSize:function(t,r){try{return t&&r?parseInt(r*t/8,10):0}catch(e){return 0}},hashVal:function(e){var t,r=0;if(0===e.length)return r;for(t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return r}},ProxyPromise=function(){function e(){var t,r;_classCallCheck$4(this,e);var n=new Promise((function(e,n){t=e,r=n}));return n.resolve=function(e){t(e),n.state="fulfilled"},n.reject=function(e){r(e),n.state="rejected",n.isBreak="DESTROYED"===e},n.state="pending",n}return _createClass$5(e,[{key:"resolve",value:function(e){}},{key:"reject",value:function(e){}}]),e}(),XHR=_createClass$5((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.url,n=t.method,i=void 0===n?"GET":n,a=t.type,o=void 0===a?"arraybuffer":a,s=t.data,u=void 0===s?{}:s;return _classCallCheck$4(this,e),new Promise((function(e,t){var n=new window.XMLHttpRequest,a=i.toUpperCase(),s=[];for(var c in o&&(n.responseType=o),u)s.push("k=".concat(u[c]));if("GET"===a)n.open(a,"".concat(r,"?").concat(s.join("&"))),n.send();else{if("POST"!==a)throw new Error("xhr ".concat(a," is not supported"));n.open(a,r,!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(u))}n.onload=function(){200===n.status||206===n.status?e(n):t(n)},n.onerror=function(){t(n)}}))}));function getPlayLicenses(e,t,r){var n=new ProxyPromise;return new XHR({type:"json",method:"POST",url:r,data:{drm_type:"22",license_request:[{vid:e,kids:[].concat(t)}]}}).then((function(r){var i=r.response;if(i){var a=i.play_licenses[e][t];n.resolve(a)}else n.reject()})).catch((function(){n.reject()})),n}function getKeyValue(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=new ProxyPromise;if(r){log("[getKeyValue]>before openBox");var a=n.awManager.openBox(r);if(log("[getKeyValue]>after openBox: ",a),t){var o={clearKeys:{}};o.clearKeys[t]=a,i.resolve(o)}else i.resolve(a)}else{var s=getPlayLicenses(e,t,n.config.getLicenseUrl);s.id="requestPromise",n._addPendingPromise(s),s.then((function(e){if(n._removePendingPromise(s),n.awManager){log("[getKeyValue]>before openBox");var r=n.awManager.openBox(e);log("[getKeyValue]>after openBox: ",r);var a={clearKeys:{}};a.clearKeys[t]=r,i.resolve(a)}else log("[getKeyValue]>awManager not exist, player destroyed")})).catch((function(e){throw log("[getKeyValue]>requestPromise reject"),e}))}return i}var userGestureEventMiddleware={playBtnClick:function(e,t,r,n){e.paused||e.waitingMoreBuffer&&(e.waitingMoreBuffer=!1),n.call(e,t,r)}},videoEventMiddleware={waiting:function(e,t){var r=e.player,n=e.eventName;r.waitingMoreBuffer=!0,t(n,e)},play:function(e,t){var r=e.player,n=e.eventName;r.waitingMoreBuffer||t(n,e)},pause:function(e,t){var r=e.player,n=e.eventName;r.waitingMoreBuffer||t(n,e)},seeking:function(e,t){var r=e.player,n=e.eventName;r.isSeekingStart=!0,t(n,e)},progress:function(e,t){log(">>>>progress");var r=e.player,n=e.eventName;if(r.waitingMoreBuffer){var i=r.getBufferedRange(r.buffered2);0===i[0]&&0===i[1]||(void 0===r.inWaitingStart||r.isSeekingStart?(log("progress èµ·æ’­æˆ–seekç»“æŸ"),i[1]-r.currentTime>=(r.config.canplayWaterLevel||1)||i[1]>r.duration-1?(log("progress å‡ºèµ·æ’­æ°´ä½"),r.play()):(log("progress æœªå‡ºèµ·æ’­æ°´ä½"),r.emit("waiting"))):(log("progress videoå¡é¡¿ç»“æŸ"),i[1]-r.currentTime>=(r.config.bufferWaterLevel||5)||i[1]>r.duration-1?(log("progress å‡ºå¡é¡¿æ°´ä½"),r.play()):(log("progress æœªå‡ºå¡é¡¿æ°´ä½"),r.emit("waiting"))))}t(n,e)},playing:function(e,t){var r=e.player,n=e.eventName;log("playing");var i=r.getBufferedRange(r.buffered2);if(0===i[0]&&0===i[1])return log("playing å½“å‰æ’­æ”¾æ—¶åˆ»æ²¡æœ‰ç¼“å­˜ æœªå‡ºæ°´ä½"),r.waitingMoreBuffer=!0,r.pause(),void t.call("waiting",e);void 0===r.inWaitingStart||r.isSeekingStart?(log("playing èµ·æ’­æˆ–seekç»“æŸ"),i[1]-r.currentTime>=(r.config.canplayWaterLevel||1)||i[1]>r.duration-1?(log("playing å‡ºèµ·æ’­æ°´ä½"),r.waitingMoreBuffer=!1,r.isSeekingStart=!1,t(n,e)):(log("playing æœªå‡ºèµ·æ’­æ°´ä½"),r.waitingMoreBuffer=!0,r.pause(),t.call("waiting",e))):(log("playing videoå¡é¡¿ç»“æŸ"),i[1]-r.currentTime>=(r.config.bufferWaterLevel||5)||i[1]>r.duration-1?(log("playing å‡ºå¡é¡¿æ°´ä½"),r.waitingMoreBuffer=!1,t(n,e)):(log("playing æœªå‡ºå¡é¡¿æ°´ä½"),r.waitingMoreBuffer=!0,r.pause(),t.call("waiting",e)))}};function offInDestroy(e,t,r,n){e.once(n,(function i(){e.off(t,r),e.off(n,i)}))}function on(e,t,r,n){if(n)e.on(t,r),offInDestroy(e,t,r,n);else{e.on(t,(function n(i){r(i),e.off(t,n)}))}}var EME=function(){function e(t){_classCallCheck$4(this,e),this.drm=t,this.KEYSYSTEM_TYPE="",this.keys={},this.drm.clearKeys&&(this.KEYSYSTEM_TYPE="org.w3.clearkey",this.keys=this.drm.clearKeys),this.options=[],this.ensurePromise=void 0,EventEmitter(this)}return _createClass$5(e,[{key:"setOptions",value:function(){var e=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],t={videoCapabilities:e},r={videoCapabilities:e,persistentState:"required",sessionTypes:["persistent-license"]};this.options=[r,t]}},{key:"bail",value:function(e){}},{key:"UpdateSessionFunc",value:function(e){var t=this;return function(r){var n=[],i=[];Object.keys(e).forEach((function(t){var r=e[t],a=util.fromHex(t),o=util.fromHex(r),s={kty:"oct",kid:util.toBase64(a,!1),k:util.toBase64(o,!1)};n.push(s),i.push(s.kid)}));var a={keys:n},o=JSON.stringify(a);r.target.update(util.StringToArrayBuffer(o)).then((function(){}),t.bail(" MediaKeySession update failed"))}}},{key:"KeysChange",value:function(e){}},{key:"EnsureMediaKeysCreated",value:function(e,t,r){return this.ensurePromise||(this.ensurePromise=navigator.requestMediaKeySystemAccess(t,r).then((function(e){return e.createMediaKeys()}),this.bail(" Failed to request key system access.")).then((function(t){return e.setMediaKeys(t)}),this.bail(" failed to create MediaKeys object"))),this.ensurePromise}},{key:"SetupEME",value:function(e,t){var r=this;e.sessions=[],on(this,"encrypted",(function(){var t=JSON.stringify({kids:["0123456789abcdef0123456789abcdef"]}),n=new Uint8Array(util.toUTF8(t));r.EnsureMediaKeysCreated(e,r.KEYSYSTEM_TYPE,r.options).then((function(){var t=e.mediaKeys.createSession();return e.sessions.push(t),t.addEventListener("message",r.UpdateSessionFunc(r.keys)),t.addEventListener("keystatuseschange",r.KeysChange),t.generateRequest("keyids",n.buffer)}),r.bail(" failed to ensure MediaKeys on HTMLMediaElement")).then((function(){}),r.bail(" Failed to generate request."))}))}}]),e}(),WasmManager=function(){function e(){_classCallCheck$4(this,e),this.queue=[]}return _createClass$5(e,[{key:"push",value:function(e){this.queue.push(e)}},{key:"startup",value:function(){return Promise.all(this.queue)}},{key:"destroy",value:function(){this.queue=[]}}]),e}(),aw$1={exports:{}};!function(t,r){var n=function(){var t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return function(r){var n,i=void 0!==(r=r||{})?r:{},a={};for(n in i)i.hasOwnProperty(n)&&(a[n]=i[n]);if(i.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -s ENVIRONMENT=web or -s ENVIRONMENT=node)");var o="";if(document.currentScript&&(o=document.currentScript.src),t&&(o=t),o=0!==o.indexOf("blob:")?o.substr(0,o.lastIndexOf("/")+1):"","object"!==("undefined"==typeof window?"undefined":_typeof$4(window))&&"function"!=typeof importScripts)throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");var s,u=i.print||console.log.bind(console),c=i.printErr||console.warn.bind(console);for(n in a)a.hasOwnProperty(n)&&(i[n]=a[n]);function l(e){l.shown||(l.shown={}),l.shown[e]||(l.shown[e]=1,c(e))}a=null,i.arguments,Object.getOwnPropertyDescriptor(i,"arguments")||Object.defineProperty(i,"arguments",{configurable:!0,get:function(){V("Module.arguments has been replaced with plain arguments_")}}),i.thisProgram,Object.getOwnPropertyDescriptor(i,"thisProgram")||Object.defineProperty(i,"thisProgram",{configurable:!0,get:function(){V("Module.thisProgram has been replaced with plain thisProgram")}}),i.quit,Object.getOwnPropertyDescriptor(i,"quit")||Object.defineProperty(i,"quit",{configurable:!0,get:function(){V("Module.quit has been replaced with plain quit_")}}),g(void 0===i.memoryInitializerPrefixURL,"Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),g(void 0===i.pthreadMainPrefixURL,"Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),g(void 0===i.cdInitializerPrefixURL,"Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),g(void 0===i.filePackagePrefixURL,"Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),g(void 0===i.read,"Module.read option was removed (modify read_ in JS)"),g(void 0===i.readAsync,"Module.readAsync option was removed (modify readAsync in JS)"),g(void 0===i.readBinary,"Module.readBinary option was removed (modify readBinary in JS)"),g(void 0===i.setWindowTitle,"Module.setWindowTitle option was removed (modify setWindowTitle in JS)"),Object.getOwnPropertyDescriptor(i,"read")||Object.defineProperty(i,"read",{configurable:!0,get:function(){V("Module.read has been replaced with plain read_")}}),Object.getOwnPropertyDescriptor(i,"readAsync")||Object.defineProperty(i,"readAsync",{configurable:!0,get:function(){V("Module.readAsync has been replaced with plain readAsync")}}),Object.getOwnPropertyDescriptor(i,"readBinary")||Object.defineProperty(i,"readBinary",{configurable:!0,get:function(){V("Module.readBinary has been replaced with plain readBinary")}}),le=function(){V("cannot use the stack before compiled code is ready to run, and has provided stack access")},i.wasmBinary&&(s=i.wasmBinary),Object.getOwnPropertyDescriptor(i,"wasmBinary")||Object.defineProperty(i,"wasmBinary",{configurable:!0,get:function(){V("Module.wasmBinary has been replaced with plain wasmBinary")}}),i.noExitRuntime,Object.getOwnPropertyDescriptor(i,"noExitRuntime")||Object.defineProperty(i,"noExitRuntime",{configurable:!0,get:function(){V("Module.noExitRuntime has been replaced with plain noExitRuntime")}});var d,h={Memory:function(e){return{buffer:new ArrayBuffer(65536*e.initial),grow:function(e){var t=this.buffer,r=he(e);return g(this.buffer!==t),r}}},Table:function(e){var t=new Array(e.initial);return t.grow=function(e){t.length>=1&&V("Unable to grow wasm table. Use a higher value for RESERVED_FUNCTION_POINTERS or set ALLOW_TABLE_GROWTH."),t.push(null)},t.set=function(e,r){t[e]=r},t.get=function(e){return t[e]},t},Module:function(e){return{}},Instance:function(e,t){var r,n=(r=f,function(e,t,n){var i=t.memory,a=r,o=new e.Int8Array(n);new e.Int16Array(n);var s=new e.Int32Array(n),u=new e.Uint8Array(n);new e.Uint16Array(n);var c=new e.Uint32Array(n);new e.Float32Array(n),new e.Float64Array(n);var l=e.Math.imul;e.Math.fround,e.Math.abs,e.Math.clz32,e.Math.min,e.Math.max,e.Math.floor,e.Math.ceil,e.Math.sqrt,t.abort,e.NaN,e.Infinity;var d=t.emscripten_memcpy_big,h=t.emscripten_resize_heap,f=t.__unlock,p=t.__lock,g=9744;function y(e){var t,r=0;return t=E(),(e=(r=s[388])+e|0)>>>0<=t<<16>>>0||h(0|e)?(s[388]=e,r):(s[256]=48,-1)}function m(e){var t,r=0,n=0,i=0,a=0,o=0,l=0,d=0,h=0,f=0,p=0,m=0,v=0;g=t=g-16|0;e:{t:{r:{n:{i:{a:{o:{s:{u:{c:{l:{if((e|=0)>>>0<=244){if(3&(r=(o=s[261])>>>(e=(l=e>>>0<11?16:e+11&-8)>>>3))){e=(r=s[1092+(a=(n=e+(1&(-1^r))|0)<<3)>>2])+8|0,(0|(i=s[r+8>>2]))!=(0|(a=a+1084|0))?(s[i+12>>2]=a,s[a+8>>2]=i):(m=1044,v=A(n)&o,s[m>>2]=v),n<<=3,s[r+4>>2]=3|n,s[4+(r=r+n|0)>>2]=1|s[r+4>>2];break e}if(l>>>0<=(h=s[263])>>>0)break l;if(r){n=r=(e=(0-(e=(0-(n=2<<e)|n)&r<<e)&e)-1|0)>>>12&16,n|=r=(e>>>=r)>>>5&8,n|=r=(e>>>=r)>>>2&4,r=s[1092+(i=(n=((n|=r=(e>>>=r)>>>1&2)|(r=(e>>>=r)>>>1&1))+(e>>>r)|0)<<3)>>2],(0|(e=s[r+8>>2]))!=(0|(i=i+1084|0))?(s[e+12>>2]=i,s[i+8>>2]=e):(o=A(n)&o,s[261]=o),e=r+8|0,s[r+4>>2]=3|l,a=(n<<=3)-l|0,s[4+(d=r+l|0)>>2]=1|a,s[r+n>>2]=a,h&&(r=1084+((n=h>>>3)<<3)|0,i=s[266],(n=1<<n)&o?n=s[r+8>>2]:(s[261]=n|o,n=r),s[r+8>>2]=i,s[n+12>>2]=i,s[i+12>>2]=r,s[i+8>>2]=n),s[266]=d,s[263]=a;break e}if(!(p=s[262]))break l;for(n=r=(e=(p&0-p)-1|0)>>>12&16,n|=r=(e>>>=r)>>>5&8,n|=r=(e>>>=r)>>>2&4,r=s[1348+(((n|=r=(e>>>=r)>>>1&2)|(r=(e>>>=r)>>>1&1))+(e>>>r)<<2)>>2],i=(-8&s[r+4>>2])-l|0,n=r;(e=s[n+16>>2])||(e=s[n+20>>2]);)i=(n=(a=(-8&s[e+4>>2])-l|0)>>>0<i>>>0)?a:i,r=n?e:r,n=e;if(f=s[r+24>>2],(0|(a=s[r+12>>2]))!=(0|r)){e=s[r+8>>2],s[e+12>>2]=a,s[a+8>>2]=e;break t}if(!(e=s[(n=r+20|0)>>2])){if(!(e=s[r+16>>2]))break c;n=r+16|0}for(;d=n,a=e,(e=s[(n=e+20|0)>>2])||(n=a+16|0,e=s[a+16>>2]););s[d>>2]=0;break t}if(l=-1,!(e>>>0>4294967231)&&(l=-8&(r=e+11|0),h=s[262])){n=0-l|0,o=0,(r>>>=8)&&(o=31,l>>>0>16777215||(o=28+((e=((o=(r<<=i=r+1048320>>>16&8)<<(e=r+520192>>>16&4))<<(r=o+245760>>>16&2)>>>15)-(r|e|i)|0)<<1|l>>>e+21&1)|0));d:{h:{if(i=s[1348+(o<<2)>>2])for(r=l<<(31==(0|o)?0:25-(o>>>1)|0),e=0;;){if(!((d=(-8&s[i+4>>2])-l|0)>>>0>=n>>>0||(a=i,n=d))){n=0,e=i;break h}if(d=s[i+20>>2],i=s[16+((r>>>29&4)+i|0)>>2],e=d?(0|d)==(0|i)?e:d:e,r<<=0!=(0|i),!i)break}else e=0;if(!(e|a)){if(!(e=(0-(e=2<<o)|e)&h))break l;i=r=(e=(e&0-e)-1|0)>>>12&16,i|=r=(e>>>=r)>>>5&8,i|=r=(e>>>=r)>>>2&4,e=s[1348+(((i|=r=(e>>>=r)>>>1&2)|(r=(e>>>=r)>>>1&1))+(e>>>r)<<2)>>2]}if(!e)break d}for(;n=(r=(i=(-8&s[e+4>>2])-l|0)>>>0<n>>>0)?i:n,a=r?e:a,e=(r=s[e+16>>2])||s[e+20>>2];);}if(!(!a|n>>>0>=s[263]-l>>>0)){if(d=s[a+24>>2],(0|a)!=(0|(r=s[a+12>>2]))){e=s[a+8>>2],s[e+12>>2]=r,s[r+8>>2]=e;break r}if(!(e=s[(i=a+20|0)>>2])){if(!(e=s[a+16>>2]))break u;i=a+16|0}for(;o=i,r=e,(e=s[(i=e+20|0)>>2])||(i=r+16|0,e=s[r+16>>2]););s[o>>2]=0;break r}}}if((r=s[263])>>>0>=l>>>0){e=s[266],(n=r-l|0)>>>0>=16?(s[263]=n,i=e+l|0,s[266]=i,s[i+4>>2]=1|n,s[e+r>>2]=n,s[e+4>>2]=3|l):(s[266]=0,s[263]=0,s[e+4>>2]=3|r,s[4+(r=e+r|0)>>2]=1|s[r+4>>2]),e=e+8|0;break e}if((i=s[264])>>>0>l>>>0){r=i-l|0,s[264]=r,n=(e=s[267])+l|0,s[267]=n,s[n+4>>2]=1|r,s[e+4>>2]=3|l,e=e+8|0;break e}if(e=0,n=a=l+47|0,s[379]?r=s[381]:(s[382]=-1,s[383]=-1,s[380]=4096,s[381]=4096,s[379]=t+12&-16^1431655768,s[384]=0,s[372]=0,r=4096),(n=(o=n+r|0)&(d=0-r|0))>>>0<=l>>>0)break e;if((r=s[371])&&(f=(h=s[369])+n|0)>>>0<=h>>>0|f>>>0>r>>>0)break e;if(4&u[1488])break a;l:{d:{if(r=s[267])for(e=1492;;){if((h=s[e>>2])+s[e+4>>2]>>>0>r>>>0&&h>>>0<=r>>>0)break d;if(!(e=s[e+8>>2]))break}if(-1==(0|(r=y(0))))break o;if(o=n,(i=(e=s[380])+-1|0)&r&&(o=(n-r|0)+(r+i&0-e)|0),o>>>0<=l>>>0|o>>>0>2147483646)break o;if((e=s[371])&&(d=(i=s[369])+o|0)>>>0<=i>>>0|d>>>0>e>>>0)break o;if((0|r)!=(0|(e=y(o))))break l;break i}if((o=d&o-i)>>>0>2147483646)break o;if((0|(r=y(o)))==(s[e>>2]+s[e+4>>2]|0))break s;e=r}if(r=e,!(l+48>>>0<=o>>>0|o>>>0>2147483646|-1==(0|e))){if((e=(e=s[381])+(a-o|0)&0-e)>>>0>2147483646)break i;if(-1!=(0|y(e))){o=e+o|0;break i}y(0-o|0);break o}if(-1!=(0|r))break i;break o}a=0;break t}r=0;break r}if(-1!=(0|r))break i}s[372]=4|s[372]}if(n>>>0>2147483646)break n;if((r=y(n))>>>0>=(e=y(0))>>>0|-1==(0|r)|-1==(0|e))break n;if((o=e-r|0)>>>0<=l+40>>>0)break n}e=s[369]+o|0,s[369]=e,e>>>0>c[370]&&(s[370]=e);i:{a:{o:{if(n=s[267]){for(e=1492;;){if(((i=s[e>>2])+(a=s[e+4>>2])|0)==(0|r))break o;if(!(e=s[e+8>>2]))break}break a}for(r>>>0>=(e=s[265])>>>0&&e||(s[265]=r),e=0,s[374]=o,s[373]=r,s[269]=-1,s[270]=s[379],s[376]=0;i=1084+(n=e<<3)|0,s[n+1092>>2]=i,s[n+1096>>2]=i,32!=(0|(e=e+1|0)););i=(e=o+-40|0)-(n=r+8&7?-8-r&7:0)|0,s[264]=i,n=r+n|0,s[267]=n,s[n+4>>2]=1|i,s[4+(e+r|0)>>2]=40,s[268]=s[383];break i}if(!(8&u[e+12|0]|r>>>0<=n>>>0|i>>>0>n>>>0)){s[e+4>>2]=a+o,r=(e=n+8&7?-8-n&7:0)+n|0,s[267]=r,e=(i=s[264]+o|0)-e|0,s[264]=e,s[r+4>>2]=1|e,s[4+(n+i|0)>>2]=40,s[268]=s[383];break i}}r>>>0<(a=s[265])>>>0&&(s[265]=r,a=0),i=r+o|0,e=1492;a:{o:{s:{u:{c:{l:{for(;;){if((0|i)!=s[e>>2]){if(e=s[e+8>>2])continue;break l}break}if(!(8&u[e+12|0]))break c}for(e=1492;;){if((i=s[e>>2])>>>0<=n>>>0&&(a=i+s[e+4>>2]|0)>>>0>n>>>0)break u;e=s[e+8>>2]}}if(s[e>>2]=r,s[e+4>>2]=s[e+4>>2]+o,s[4+(f=(r+8&7?-8-r&7:0)+r|0)>>2]=3|l,e=((r=i+(i+8&7?-8-i&7:0)|0)-f|0)-l|0,d=l+f|0,(0|r)==(0|n)){s[267]=d,e=s[264]+e|0,s[264]=e,s[d+4>>2]=1|e;break o}if(s[266]==(0|r)){s[266]=d,e=s[263]+e|0,s[263]=e,s[d+4>>2]=1|e,s[e+d>>2]=e;break o}if(1==(3&(n=s[r+4>>2]))){p=-8&n;c:if(n>>>0<=255){if(a=n>>>3,n=s[r+8>>2],(0|(i=s[r+12>>2]))==(0|n)){m=1044,v=s[261]&A(a),s[m>>2]=v;break c}s[n+12>>2]=i,s[i+8>>2]=n}else{if(h=s[r+24>>2],(0|(o=s[r+12>>2]))==(0|r))if((l=s[(i=r+20|0)>>2])||(l=s[(i=r+16|0)>>2])){for(;n=i,o=l,(l=s[(i=l+20|0)>>2])||(i=o+16|0,l=s[o+16>>2]););s[n>>2]=0}else o=0;else n=s[r+8>>2],s[n+12>>2]=o,s[o+8>>2]=n;if(h){n=s[r+28>>2];l:{if(s[(i=1348+(n<<2)|0)>>2]==(0|r)){if(s[i>>2]=o,o)break l;m=1048,v=s[262]&A(n),s[m>>2]=v;break c}if(s[h+(s[h+16>>2]==(0|r)?16:20)>>2]=o,!o)break c}s[o+24>>2]=h,(n=s[r+16>>2])&&(s[o+16>>2]=n,s[n+24>>2]=o),(n=s[r+20>>2])&&(s[o+20>>2]=n,s[n+24>>2]=o)}}r=r+p|0,e=e+p|0}if(s[r+4>>2]=-2&s[r+4>>2],s[d+4>>2]=1|e,s[e+d>>2]=e,e>>>0<=255){e=1084+((r=e>>>3)<<3)|0,(n=s[261])&(r=1<<r)?r=s[e+8>>2]:(s[261]=r|n,r=e),s[e+8>>2]=d,s[r+12>>2]=d,s[d+12>>2]=e,s[d+8>>2]=r;break o}if(r=0,(i=e>>>8)&&(r=31,e>>>0>16777215||(r=28+((r=((l=(i<<=a=i+1048320>>>16&8)<<(r=i+520192>>>16&4))<<(i=l+245760>>>16&2)>>>15)-(i|r|a)|0)<<1|e>>>r+21&1)|0)),s[(n=d)+28>>2]=r,s[d+16>>2]=0,s[d+20>>2]=0,n=1348+(r<<2)|0,(i=s[262])&(a=1<<r)){for(i=e<<(31==(0|r)?0:25-(r>>>1)|0),r=s[n>>2];;){if(n=r,(-8&s[r+4>>2])==(0|e))break s;if(r=i>>>29,i<<=1,!(r=s[16+(a=(4&r)+n|0)>>2]))break}s[a+16>>2]=d}else s[262]=i|a,s[n>>2]=d;s[d+24>>2]=n,s[d+12>>2]=d,s[d+8>>2]=d;break o}for(d=(e=o+-40|0)-(i=r+8&7?-8-r&7:0)|0,s[264]=d,i=r+i|0,s[267]=i,s[i+4>>2]=1|d,s[4+(e+r|0)>>2]=40,s[268]=s[383],s[(i=(e=(a+(a+-39&7?39-a&7:0)|0)-47|0)>>>0<n+16>>>0?n:e)+4>>2]=27,e=s[376],s[i+16>>2]=s[375],s[i+20>>2]=e,e=s[374],s[i+8>>2]=s[373],s[i+12>>2]=e,s[375]=i+8,s[374]=o,s[373]=r,s[376]=0,e=i+24|0;s[e+4>>2]=7,r=e+8|0,e=e+4|0,r>>>0<a>>>0;);if((0|n)==(0|i))break i;if(s[i+4>>2]=-2&s[i+4>>2],a=i-n|0,s[n+4>>2]=1|a,s[i>>2]=a,a>>>0<=255){e=1084+((r=a>>>3)<<3)|0,(i=s[261])&(r=1<<r)?r=s[e+8>>2]:(s[261]=r|i,r=e),s[e+8>>2]=n,s[r+12>>2]=n,s[n+12>>2]=e,s[n+8>>2]=r;break i}if(s[n+16>>2]=0,s[n+20>>2]=0,e=0,(i=a>>>8)&&(e=31,a>>>0>16777215||(e=28+((e=((d=(i<<=o=i+1048320>>>16&8)<<(e=i+520192>>>16&4))<<(i=d+245760>>>16&2)>>>15)-(i|e|o)|0)<<1|a>>>e+21&1)|0)),s[(r=n)+28>>2]=e,r=1348+(e<<2)|0,(i=s[262])&(o=1<<e)){for(e=a<<(31==(0|e)?0:25-(e>>>1)|0),r=s[r>>2];;){if(i=r,(0|a)==(-8&s[r+4>>2]))break a;if(r=e>>>29,e<<=1,!(r=s[16+(o=i+(4&r)|0)>>2]))break}s[o+16>>2]=n,s[n+24>>2]=i}else s[262]=i|o,s[r>>2]=n,s[n+24>>2]=r;s[n+12>>2]=n,s[n+8>>2]=n;break i}e=s[n+8>>2],s[e+12>>2]=d,s[n+8>>2]=d,s[d+24>>2]=0,s[d+12>>2]=n,s[d+8>>2]=e}e=f+8|0;break e}e=s[i+8>>2],s[e+12>>2]=n,s[i+8>>2]=n,s[n+24>>2]=0,s[n+12>>2]=i,s[n+8>>2]=e}if(!((e=s[264])>>>0<=l>>>0)){r=e-l|0,s[264]=r,n=(e=s[267])+l|0,s[267]=n,s[n+4>>2]=1|r,s[e+4>>2]=3|l,e=e+8|0;break e}}s[256]=48,e=0;break e}r:if(d){e=s[a+28>>2];n:{if(s[(i=1348+(e<<2)|0)>>2]==(0|a)){if(s[i>>2]=r,r)break n;h=A(e)&h,s[262]=h;break r}if(s[d+(s[d+16>>2]==(0|a)?16:20)>>2]=r,!r)break r}s[r+24>>2]=d,(e=s[a+16>>2])&&(s[r+16>>2]=e,s[e+24>>2]=r),(e=s[a+20>>2])&&(s[r+20>>2]=e,s[e+24>>2]=r)}r:if(n>>>0<=15)e=n+l|0,s[a+4>>2]=3|e,s[4+(e=e+a|0)>>2]=1|s[e+4>>2];else if(s[a+4>>2]=3|l,s[4+(i=a+l|0)>>2]=1|n,s[n+i>>2]=n,n>>>0<=255)e=1084+((r=n>>>3)<<3)|0,(n=s[261])&(r=1<<r)?r=s[e+8>>2]:(s[261]=r|n,r=e),s[e+8>>2]=i,s[r+12>>2]=i,s[i+12>>2]=e,s[i+8>>2]=r;else{e=0,(l=n>>>8)&&(e=31,n>>>0>16777215||(e=28+((e=((d=(l<<=o=l+1048320>>>16&8)<<(e=l+520192>>>16&4))<<(l=d+245760>>>16&2)>>>15)-(l|e|o)|0)<<1|n>>>e+21&1)|0)),s[(r=i)+28>>2]=e,s[i+16>>2]=0,s[i+20>>2]=0,r=1348+(e<<2)|0;n:{if((l=1<<e)&h){for(e=n<<(31==(0|e)?0:25-(e>>>1)|0),l=s[r>>2];;){if((-8&s[(r=l)+4>>2])==(0|n))break n;if(l=e>>>29,e<<=1,!(l=s[16+(o=(4&l)+r|0)>>2]))break}s[o+16>>2]=i}else s[262]=l|h,s[r>>2]=i;s[i+24>>2]=r,s[i+12>>2]=i,s[i+8>>2]=i;break r}e=s[r+8>>2],s[e+12>>2]=i,s[r+8>>2]=i,s[i+24>>2]=0,s[i+12>>2]=r,s[i+8>>2]=e}e=a+8|0;break e}t:if(f){e=s[r+28>>2];r:{if(s[(n=1348+(e<<2)|0)>>2]==(0|r)){if(s[n>>2]=a,a)break r;m=1048,v=A(e)&p,s[m>>2]=v;break t}if(s[f+(s[f+16>>2]==(0|r)?16:20)>>2]=a,!a)break t}s[a+24>>2]=f,(e=s[r+16>>2])&&(s[a+16>>2]=e,s[e+24>>2]=a),(e=s[r+20>>2])&&(s[a+20>>2]=e,s[e+24>>2]=a)}i>>>0<=15?(e=i+l|0,s[r+4>>2]=3|e,s[4+(e=e+r|0)>>2]=1|s[e+4>>2]):(s[r+4>>2]=3|l,s[4+(l=r+l|0)>>2]=1|i,s[i+l>>2]=i,h&&(e=1084+((n=h>>>3)<<3)|0,a=s[266],(n=1<<n)&o?n=s[e+8>>2]:(s[261]=n|o,n=e),s[e+8>>2]=a,s[n+12>>2]=a,s[a+12>>2]=e,s[a+8>>2]=n),s[266]=l,s[263]=i),e=r+8|0}return g=t+16|0,0|e}function v(e){var t=0,r=0,n=0,i=0,a=0,o=0,u=0,l=0,d=0;e:if(e|=0){a=(n=e+-8|0)+(e=-8&(r=s[e+-4>>2]))|0;t:if(!(1&r)){if(!(3&r))break e;if((n=n-(r=s[n>>2])|0)>>>0<c[265])break e;if(e=e+r|0,s[266]==(0|n)){if(3==(3&(r=s[a+4>>2])))return s[263]=e,s[a+4>>2]=-2&r,s[n+4>>2]=1|e,void(s[e+n>>2]=e)}else{if(r>>>0<=255){if(i=s[n+8>>2],r>>>=3,(0|(t=s[n+12>>2]))==(0|i)){l=1044,d=s[261]&A(r),s[l>>2]=d;break t}s[i+12>>2]=t,s[t+8>>2]=i;break t}if(u=s[n+24>>2],(0|n)==(0|(r=s[n+12>>2])))if((t=s[(i=n+20|0)>>2])||(t=s[(i=n+16|0)>>2])){for(;o=i,(t=s[(i=(r=t)+20|0)>>2])||(i=r+16|0,t=s[r+16>>2]););s[o>>2]=0}else r=0;else t=s[n+8>>2],s[t+12>>2]=r,s[r+8>>2]=t;if(!u)break t;i=s[n+28>>2];r:{if(s[(t=1348+(i<<2)|0)>>2]==(0|n)){if(s[t>>2]=r,r)break r;l=1048,d=s[262]&A(i),s[l>>2]=d;break t}if(s[u+(s[u+16>>2]==(0|n)?16:20)>>2]=r,!r)break t}if(s[r+24>>2]=u,(t=s[n+16>>2])&&(s[r+16>>2]=t,s[t+24>>2]=r),!(t=s[n+20>>2]))break t;s[r+20>>2]=t,s[t+24>>2]=r}}if(!(a>>>0<=n>>>0)&&1&(r=s[a+4>>2])){t:{if(!(2&r)){if(s[267]==(0|a)){if(s[267]=n,e=s[264]+e|0,s[264]=e,s[n+4>>2]=1|e,s[266]!=(0|n))break e;return s[263]=0,void(s[266]=0)}if(s[266]==(0|a))return s[266]=n,e=s[263]+e|0,s[263]=e,s[n+4>>2]=1|e,void(s[e+n>>2]=e);e=(-8&r)+e|0;r:if(r>>>0<=255){if(r>>>=3,(0|(t=s[a+8>>2]))==(0|(i=s[a+12>>2]))){l=1044,d=s[261]&A(r),s[l>>2]=d;break r}s[t+12>>2]=i,s[i+8>>2]=t}else{if(u=s[a+24>>2],(0|a)==(0|(r=s[a+12>>2])))if((t=s[(i=a+20|0)>>2])||(t=s[(i=a+16|0)>>2])){for(;o=i,(t=s[(i=(r=t)+20|0)>>2])||(i=r+16|0,t=s[r+16>>2]););s[o>>2]=0}else r=0;else t=s[a+8>>2],s[t+12>>2]=r,s[r+8>>2]=t;if(u){i=s[a+28>>2];n:{if(s[(t=1348+(i<<2)|0)>>2]==(0|a)){if(s[t>>2]=r,r)break n;l=1048,d=s[262]&A(i),s[l>>2]=d;break r}if(s[u+(s[u+16>>2]==(0|a)?16:20)>>2]=r,!r)break r}s[r+24>>2]=u,(t=s[a+16>>2])&&(s[r+16>>2]=t,s[t+24>>2]=r),(t=s[a+20>>2])&&(s[r+20>>2]=t,s[t+24>>2]=r)}}if(s[n+4>>2]=1|e,s[e+n>>2]=e,s[266]!=(0|n))break t;return void(s[263]=e)}s[a+4>>2]=-2&r,s[n+4>>2]=1|e,s[e+n>>2]=e}if(e>>>0<=255)return r=1084+((e>>>=3)<<3)|0,(t=s[261])&(e=1<<e)?e=s[r+8>>2]:(s[261]=e|t,e=r),s[r+8>>2]=n,s[e+12>>2]=n,s[n+12>>2]=r,void(s[n+8>>2]=e);s[n+16>>2]=0,s[n+20>>2]=0,t=0,(i=e>>>8)&&(t=31,e>>>0>16777215||(t=i,t<<=i=i+1048320>>>16&8,t=28+((t=((t<<=u=t+520192>>>16&4)<<(o=t+245760>>>16&2)>>>15)-(o|i|u)|0)<<1|e>>>t+21&1)|0)),s[(r=n)+28>>2]=t,o=1348+(t<<2)|0;t:if((i=s[262])&(r=1<<t)){i=e<<(31==(0|t)?0:25-(t>>>1)|0),r=s[o>>2];r:{for(;;){if(t=r,(-8&s[r+4>>2])==(0|e))break r;if(r=i>>>29,i<<=1,!(r=s[16+(o=t+(4&r)|0)>>2]))break}s[o+16>>2]=n,s[n+12>>2]=n,s[n+24>>2]=t,s[n+8>>2]=n;break t}e=s[t+8>>2],s[e+12>>2]=n,s[t+8>>2]=n,s[n+24>>2]=0,s[n+12>>2]=t,s[n+8>>2]=e}else s[262]=r|i,s[o>>2]=n,s[n+12>>2]=n,s[n+24>>2]=o,s[n+8>>2]=n;if(e=s[269]+-1|0,s[269]=e,!e){for(n=1500;n=(e=s[n>>2])+8|0,e;);s[269]=-1}}}}function _(e){var t,r=0;return c[e+20>>2]<=c[e+28>>2]||(a[s[e+36>>2]](e,0,0),s[e+20>>2])?((r=s[e+4>>2])>>>0<(t=s[e+8>>2])>>>0&&(r=r-t|0,a[s[e+40>>2]](e,r,r>>31,1)),s[e+28>>2]=0,s[e+16>>2]=0,s[e+20>>2]=0,s[e+4>>2]=0,s[e+8>>2]=0,0):-1}function b(e){for(var t=0,r=0;r=t,e;)e&=e-1,t=t+1|0;return r}function A(e){var t;return(-1>>>(t=31&e)&-2)<<t|(-1<<(e=0-e&31)&-2)>>>e}function E(){return n.byteLength/65536|0}return{__wasm_call_ctors:function(){},malloc:m,openBox:function(e,t){e|=0,t|=0;var r,n,i,a=0;return g=r=g-16|0,s[r+12>>2]=0,s[r+8>>2]=0,s[r+4>>2]=0,s[r>>2]=0,function(e,t,r,n,i,a){var c=0,l=0,d=0,h=0,f=0,p=0;if(c=(u[e+2|0]^u[e+1|0]^u[0|e])<<24>>24,s[a>>2]=c+-48,c=47+(t-c|0)|0,s[n>>2]=c,f=r,p=m(c),s[f>>2]=p,l=s[a>>2],d=m(l),s[i>>2]=d,(0|l)>0)for(c=l;;){if(d=(l-c|0)+d|0,l=(t-l|0)+e|0,o[0|d]=u[(t-c|0)+e|0]^u[l+-1|0]^u[l+-2|0],(0|(c=c+-1|0))<1){c=s[n>>2];break}d=s[i>>2],l=s[a>>2]}if((0|c)>0)for(;t=s[r>>2]+h|0,h=h+1|0,o[0|t]=u[h+e|0],(0|h)<s[n>>2];);}(e,t,r+12|0,r+4|0,r+8|0,r),function(e,t){var r=0,n=0,i=0,a=0,s=0,c=0,l=0;if((0|t)>=1)for(i=85,a=250;n=b(r),s=u[0|(c=e+r|0)],l=n,n=1&r,o[0|c]=l+(21+((s^(n?i:a))<<24>>24)|0),a=n?a:s,i=n?s:i,(0|(r=r+1|0))!=(0|t););}(e=s[r+12>>2],t=s[r+4>>2]),n=function(e){var t=0;return(255&(t=e+-48|0))>>>0<=9?t<<24>>24:((e+-97&255)>>>0<26?e+-87|0:-1)<<24>>24}(o[0|e]),s[r>>2]=n,i=m(a=t-n|0),o[i+(a=a+-1|0)|0]=0,(0|a)>=1&&function(e,t,r){var n,i=0;if(r>>>0>=8192)d(0|e,0|t,0|r);else{n=e+r|0;e:if(3&(e^t))if(n>>>0<4)r=e;else if((i=n+-4|0)>>>0<e>>>0)r=e;else for(r=e;o[0|r]=u[0|t],o[r+1|0]=u[t+1|0],o[r+2|0]=u[t+2|0],o[r+3|0]=u[t+3|0],t=t+4|0,(r=r+4|0)>>>0<=i>>>0;);else{t:if((0|r)<1)r=e;else if(3&e)for(r=e;;){if(o[0|r]=u[0|t],t=t+1|0,(r=r+1|0)>>>0>=n>>>0)break t;if(!(3&r))break}else r=e;if(!((e=-4&n)>>>0<64||r>>>0>(i=e+-64|0)>>>0))for(;s[r>>2]=s[t>>2],s[r+4>>2]=s[t+4>>2],s[r+8>>2]=s[t+8>>2],s[r+12>>2]=s[t+12>>2],s[r+16>>2]=s[t+16>>2],s[r+20>>2]=s[t+20>>2],s[r+24>>2]=s[t+24>>2],s[r+28>>2]=s[t+28>>2],s[r+32>>2]=s[t+32>>2],s[r+36>>2]=s[t+36>>2],s[r+40>>2]=s[t+40>>2],s[r+44>>2]=s[t+44>>2],s[r+48>>2]=s[t+48>>2],s[r+52>>2]=s[t+52>>2],s[r+56>>2]=s[t+56>>2],s[r+60>>2]=s[t+60>>2],t=t- -64|0,(r=r- -64|0)>>>0<=i>>>0;);if(r>>>0>=e>>>0)break e;for(;s[r>>2]=s[t>>2],t=t+4|0,(r=r+4|0)>>>0<e>>>0;);}if(r>>>0<n>>>0)for(;o[0|r]=u[0|t],t=t+1|0,(0|n)!=(0|(r=r+1|0)););}}(i,e+1|0,t+(-1^n)|0),v(e),v(s[r+8>>2]),g=r+16|0,0|i},free:v,__errno_location:function(){return 1024},fflush:function e(t){var r=0;if(t|=0)return s[t+76>>2],0|_(t);if(s[260]&&(r=e(s[260])),p(1028),t=s[259])for(;c[t+20>>2]>c[t+28>>2]&&(r=_(t)|r),t=s[t+56>>2];);return f(1028),0|r},setThrew:function(e,t){e|=0,t|=0,s[385]||(s[386]=t,s[385]=e)},stackSave:function(){return 0|g},stackAlloc:function(e){return g=e=g-(e|=0)&-16,0|e},stackRestore:function(e){g=e|=0},__growWasmMemory:function(t){return 0|function(t){t|=0;var r=0|E(),a=r+t|0;if(r<a&&a<65536){var d=new ArrayBuffer(l(a,65536)),h=new e.Int8Array(d);h.set(o),o=h,o=new e.Int8Array(d),new e.Int16Array(d),s=new e.Int32Array(d),u=new e.Uint8Array(d),new e.Uint16Array(d),c=new e.Uint32Array(d),new e.Float32Array(d),new e.Float64Array(d),n=d,i.buffer=d}return r}(0|(t|=0))}}}({Int8Array:Int8Array,Int16Array:Int16Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array,NaN:NaN,Infinity:1/0,Math:Math},Y,d.buffer));return{exports:n}},instantiate:function(e,t){return{then:function(r,n){r({instance:new h.Instance(new h.Module(e,t))})}}},RuntimeError:Error};s=[],"object"!==_typeof$4(h)&&V("No WebAssembly support found. Build with -s WASM=0 to target JavaScript instead.");var f=new h.Table({initial:1,maximum:1,element:"anyfunc"}),p=!1;function g(e,t){e||V("Assertion failed: "+t)}var y="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function m(e,t,r,n){if(!(n>0))return 0;for(var i=r,a=r+n-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343)s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o);if(s<=127){if(r>=a)break;t[r++]=s}else if(s<=2047){if(r+1>=a)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=a)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+3>=a)break;s>=2097152&&l("Invalid Unicode code point 0x"+s.toString(16)+" encountered when serializing a JS string to an UTF-8 string on the asm.js/wasm heap! (Valid unicode code points should be in range 0-0x1FFFFF)."),t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-i}function v(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),n<=127?++t:t+=n<=2047?2:n<=65535?3:4}return t}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var _,b,A,E,S;function T(e,t){return e%t>0&&(e+=t-e%t),e}function w(e){_=e,i.HEAP8=b=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=E=new Int32Array(e),i.HEAPU8=A=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=S=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}var C=1712;g(!0,"stack must start aligned"),g(!0,"heap must start aligned");var k=8192;i.TOTAL_STACK&&g(k===i.TOTAL_STACK,"the stack size can no longer be determined at runtime");var I=i.TOTAL_MEMORY||65536;function $(){g(!0),S[429]=34821223,S[430]=2310721022,E[0]=1668509029}function P(){var e=S[429],t=S[430];34821223==e&&2310721022==t||V("Stack overflow! Stack cookie has been overwritten, expected hex dwords 0x89BACDFE and 0x02135467, but received 0x"+t.toString(16)+" "+e.toString(16)),1668509029!==E[0]&&V("Runtime error: The application has corrupted its heap memory area (address zero)!")}function x(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?i.dynCall_v(r):i.dynCall_vi(r,t.arg):r(void 0===t.arg?null:t.arg)}else t()}}Object.getOwnPropertyDescriptor(i,"TOTAL_MEMORY")||Object.defineProperty(i,"TOTAL_MEMORY",{configurable:!0,get:function(){V("Module.TOTAL_MEMORY has been replaced with plain INITIAL_TOTAL_MEMORY")}}),g(I>=k,"TOTAL_MEMORY should be larger than TOTAL_STACK, was "+I+"! (TOTAL_STACK="+"8192)"),g("undefined"!=typeof Int32Array&&"undefined"!=typeof Float64Array&&void 0!==Int32Array.prototype.subarray&&void 0!==Int32Array.prototype.set,"JS engine does not provide full typed array support"),(d=i.wasmMemory?i.wasmMemory:new h.Memory({initial:I/65536}))&&(_=d.buffer),g((I=_.byteLength)%65536==0),w(_),E[388]=9904,function(){var e=new Int16Array(1),t=new Int8Array(e.buffer);if(e[0]=25459,115!==t[0]||99!==t[1])throw"Runtime error: expected the system to be little-endian!"}();var R=[],O=[],D=[],L=[],M=!1;g(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),g(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),g(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),g(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var N=0,B=null,U=null,G={};function V(t){i.onAbort&&i.onAbort(t),u(t+=""),c(t),p=!0;var r="abort("+t+") at "+function(){var t=function(){var t=new Error;if(!t.stack){try{throw new Error(0)}catch(e){t=e}if(!t.stack)return"(no stack trace available)"}return t.stack.toString()}();i.extraStackTrace&&(t+="\n"+i.extraStackTrace());return r=t,n=/\b_Z[\w\d_]+/g,r.replace(n,(function(e){var t,r=(t=e,l("warning: build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),t);return e===r?e:r+" ["+e+"]"}));var r,n}();throw t=r,new h.RuntimeError(t)}i.preloadedImages={},i.preloadedAudios={};var F={error:function(){V("Filesystem support (FS) was not included. The problem is that you are using files from JS, but files were not used from C/C++, so filesystem support was not auto-included. You can force-include filesystem support with  -s FORCE_FILESYSTEM=1")},init:function(){F.error()},createDataFile:function(){F.error()},createPreloadedFile:function(){F.error()},createLazyFile:function(){F.error()},open:function(){F.error()},mkdev:function(){F.error()},registerDevice:function(){F.error()},analyzePath:function(){F.error()},loadFilesFromDB:function(){F.error()},ErrnoError:function(){F.error()}};i.FS_createDataFile=F.createDataFile,i.FS_createPreloadedFile=F.createPreloadedFile;var j="data:application/octet-stream;base64,";function H(e){return String.prototype.startsWith?e.startsWith(j):0===e.indexOf(j)}var Z,W="aw.wasm";function K(){try{if(s)return new Uint8Array(s);var e=function(e){if(!H(e))return;return function(e){try{for(var t=X(e),r=new Uint8Array(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}catch(i){throw new Error("Converting base64 string to bytes failed.")}}(e.slice(j.length))}(W);if(e)return e;throw"both async and sync fetching of the wasm failed"}catch(t){V(t)}}H(W)||(Z=W,W=i.locateFile?i.locateFile(Z,o):o+Z),O.push({func:function(){ue()}});var X="function"==typeof atob?atob:function(e){var t,r,n,i,a,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",c=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=s.indexOf(e.charAt(c++))<<2|(i=s.indexOf(e.charAt(c++)))>>4,r=(15&i)<<4|(a=s.indexOf(e.charAt(c++)))>>2,n=(3&a)<<6|(o=s.indexOf(e.charAt(c++))),u+=String.fromCharCode(t),64!==a&&(u+=String.fromCharCode(r)),64!==o&&(u+=String.fromCharCode(n))}while(c<e.length);return u};var Y={__lock:function(){},__unlock:function(){},emscripten_memcpy_big:function(e,t,r){A.set(A.subarray(t,t+r),e)},emscripten_resize_heap:function(t){var r=b.length;g(t>r);var n=65536,i=2147418112;if(t>i)return c("Cannot enlarge memory, asked to go up to "+t+" bytes, but the limit is "+i+" bytes!"),!1;for(var a=Math.max(r,16777216);a<t;)(a=a<=536870912?T(2*a,n):Math.min(T((3*a+2147483648)/4,n),i))===r&&l("Cannot ask for more memory since we reached the practical limit in browsers (which is just below 2GB), so the request would have failed. Requesting only "+b.length);var o=function(t){try{return d.grow(t-_.byteLength+65535>>16),w(d.buffer),1}catch(e){console.error("emscripten_realloc_buffer: Attempted to grow heap from "+_.byteLength+" bytes to "+t+" bytes, but got error: "+e)}}(a);return o?(c("Warning: Enlarging memory arrays, this is not fast! "+[r,a]),!0):(c("Failed to grow the heap from "+r+" bytes to "+a+" bytes, not enough memory!"),!1)},memory:d,table:f},z=function(){var t,r={env:Y,wasi_unstable:Y};function n(e,t){var r=e.exports;i.asm=r,function(e){if(N--,i.monitorRunDependencies&&i.monitorRunDependencies(N),e?(g(G[e]),delete G[e]):c("warning: run dependency removed without ID"),0==N&&(null!==B&&(clearInterval(B),B=null),U)){var t=U;U=null,t()}}("wasm-instantiate")}t="wasm-instantiate",N++,i.monitorRunDependencies&&i.monitorRunDependencies(N),t?(g(!G[t]),G[t]=1,null===B&&"undefined"!=typeof setInterval&&(B=setInterval((function(){if(p)return clearInterval(B),void(B=null);var e=!1;for(var t in G)e||(e=!0,c("still waiting on run dependencies:")),c("dependency: "+t);e&&c("(end of list)")}),1e4))):c("warning: run dependency added without ID");var a=i;function o(e){g(i===a,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),a=null,n(e.instance)}function u(e){return(s||"function"!=typeof fetch?new Promise((function(e,t){e(K())})):fetch(W,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+W+"'";return e.arrayBuffer()})).catch((function(){return K()}))).then((function(e){return h.instantiate(e,r)})).then(e,(function(e){c("failed to asynchronously prepare wasm: "+e),V(e)}))}if(i.instantiateWasm)try{return i.instantiateWasm(r,n)}catch(e){return c("Module.instantiateWasm callback failed with error: "+e),!1}return function(){if(s||"function"!=typeof h.instantiateStreaming||H(W)||"function"!=typeof fetch)return u(o);fetch(W,{credentials:"same-origin"}).then((function(e){return h.instantiateStreaming(e,r).then(o,(function(e){c("wasm streaming compile failed: "+e),c("falling back to ArrayBuffer instantiation"),u(o)}))}))}(),{}}(),J=z.__wasm_call_ctors;z.__wasm_call_ctors=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),J.apply(null,arguments)};var Q=z.malloc;z.malloc=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),Q.apply(null,arguments)};var q=z.openBox;z.openBox=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),q.apply(null,arguments)};var ee=z.free;z.free=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),ee.apply(null,arguments)};var te=z.__errno_location;z.__errno_location=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),te.apply(null,arguments)};var re=z.fflush;z.fflush=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),re.apply(null,arguments)};var ne=z.setThrew;z.setThrew=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),ne.apply(null,arguments)};var ie=z.stackSave;z.stackSave=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),ie.apply(null,arguments)};var ae=z.stackAlloc;z.stackAlloc=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),ae.apply(null,arguments)};var oe=z.stackRestore;z.stackRestore=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),oe.apply(null,arguments)};var se=z.__growWasmMemory;z.__growWasmMemory=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),se.apply(null,arguments)},i.asm=z;var ue=i.___wasm_call_ctors=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.__wasm_call_ctors.apply(null,arguments)},ce=i._malloc=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.malloc.apply(null,arguments)};i._openBox=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.openBox.apply(null,arguments)},i._free=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.free.apply(null,arguments)},i.___errno_location=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.__errno_location.apply(null,arguments)},i._fflush=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.fflush.apply(null,arguments)},i._setThrew=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.setThrew.apply(null,arguments)};var le=i.stackSave=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.stackSave.apply(null,arguments)};i.stackAlloc=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.stackAlloc.apply(null,arguments)},i.stackRestore=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.stackRestore.apply(null,arguments)};var de,he=i.__growWasmMemory=function(){return g(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),g(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.__growWasmMemory.apply(null,arguments)};function fe(e){function t(){de||(de=!0,p||(P(),g(!M),M=!0,x(O),P(),x(D),i.onRuntimeInitialized&&i.onRuntimeInitialized(),g(!i._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),function(){if(P(),i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),L.unshift(e);var e;x(L)}()))}N>0||($(),function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),R.unshift(e);var e;x(R)}(),N>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t(),P()))}if(i.asm=z,i.intArrayFromString=function(e,t,r){var n=r>0?r:v(e)+1,i=new Array(n),a=m(e,i,0,i.length);return t&&(i.length=a),i},Object.getOwnPropertyDescriptor(i,"intArrayToString")||(i.intArrayToString=function(){V("'intArrayToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"ccall")||(i.ccall=function(){V("'ccall' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"cwrap")||(i.cwrap=function(){V("'cwrap' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"setValue")||(i.setValue=function(){V("'setValue' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"getValue")||(i.getValue=function(){V("'getValue' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"allocate")||(i.allocate=function(){V("'allocate' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"getMemory")||(i.getMemory=function(){V("'getMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"AsciiToString")||(i.AsciiToString=function(){V("'AsciiToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"stringToAscii")||(i.stringToAscii=function(){V("'stringToAscii' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"UTF8ArrayToString")||(i.UTF8ArrayToString=function(){V("'UTF8ArrayToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),i.UTF8ToString=function(e,t){return e?function(e,t,r){for(var n=t+r,i=t;e[i]&&!(i>=n);)++i;if(i-t>16&&e.subarray&&y)return y.decode(e.subarray(t,i));for(var a="";t<i;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var u=63&e[t++];if(224==(240&o)?o=(15&o)<<12|s<<6|u:(240!=(248&o)&&l("Invalid UTF-8 leading byte 0x"+o.toString(16)+" encountered when deserializing a UTF-8 string on the asm.js/wasm heap to a JS string!"),o=(7&o)<<18|s<<12|u<<6|63&e[t++]),o<65536)a+=String.fromCharCode(o);else{var c=o-65536;a+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else a+=String.fromCharCode((31&o)<<6|s)}else a+=String.fromCharCode(o)}return a}(A,e,t):""},Object.getOwnPropertyDescriptor(i,"stringToUTF8Array")||(i.stringToUTF8Array=function(){V("'stringToUTF8Array' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"stringToUTF8")||(i.stringToUTF8=function(){V("'stringToUTF8' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"lengthBytesUTF8")||(i.lengthBytesUTF8=function(){V("'lengthBytesUTF8' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"UTF16ToString")||(i.UTF16ToString=function(){V("'UTF16ToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"stringToUTF16")||(i.stringToUTF16=function(){V("'stringToUTF16' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"lengthBytesUTF16")||(i.lengthBytesUTF16=function(){V("'lengthBytesUTF16' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"UTF32ToString")||(i.UTF32ToString=function(){V("'UTF32ToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"stringToUTF32")||(i.stringToUTF32=function(){V("'stringToUTF32' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"lengthBytesUTF32")||(i.lengthBytesUTF32=function(){V("'lengthBytesUTF32' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),i.allocateUTF8=function(e){var t=v(e)+1,r=ce(t);return r&&m(e,b,r,t),r},Object.getOwnPropertyDescriptor(i,"stackTrace")||(i.stackTrace=function(){V("'stackTrace' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"addOnPreRun")||(i.addOnPreRun=function(){V("'addOnPreRun' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"addOnInit")||(i.addOnInit=function(){V("'addOnInit' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"addOnPreMain")||(i.addOnPreMain=function(){V("'addOnPreMain' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"addOnExit")||(i.addOnExit=function(){V("'addOnExit' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"addOnPostRun")||(i.addOnPostRun=function(){V("'addOnPostRun' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"writeStringToMemory")||(i.writeStringToMemory=function(){V("'writeStringToMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"writeArrayToMemory")||(i.writeArrayToMemory=function(){V("'writeArrayToMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"writeAsciiToMemory")||(i.writeAsciiToMemory=function(){V("'writeAsciiToMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"addRunDependency")||(i.addRunDependency=function(){V("'addRunDependency' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"removeRunDependency")||(i.removeRunDependency=function(){V("'removeRunDependency' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"ENV")||(i.ENV=function(){V("'ENV' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"FS")||(i.FS=function(){V("'FS' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"FS_createFolder")||(i.FS_createFolder=function(){V("'FS_createFolder' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"FS_createPath")||(i.FS_createPath=function(){V("'FS_createPath' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"FS_createDataFile")||(i.FS_createDataFile=function(){V("'FS_createDataFile' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"FS_createPreloadedFile")||(i.FS_createPreloadedFile=function(){V("'FS_createPreloadedFile' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"FS_createLazyFile")||(i.FS_createLazyFile=function(){V("'FS_createLazyFile' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"FS_createLink")||(i.FS_createLink=function(){V("'FS_createLink' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"FS_createDevice")||(i.FS_createDevice=function(){V("'FS_createDevice' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"FS_unlink")||(i.FS_unlink=function(){V("'FS_unlink' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"GL")||(i.GL=function(){V("'GL' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"dynamicAlloc")||(i.dynamicAlloc=function(){V("'dynamicAlloc' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"loadDynamicLibrary")||(i.loadDynamicLibrary=function(){V("'loadDynamicLibrary' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"loadWebAssemblyModule")||(i.loadWebAssemblyModule=function(){V("'loadWebAssemblyModule' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"getLEB")||(i.getLEB=function(){V("'getLEB' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"getFunctionTables")||(i.getFunctionTables=function(){V("'getFunctionTables' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"alignFunctionTables")||(i.alignFunctionTables=function(){V("'alignFunctionTables' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"registerFunctions")||(i.registerFunctions=function(){V("'registerFunctions' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"addFunction")||(i.addFunction=function(){V("'addFunction' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"removeFunction")||(i.removeFunction=function(){V("'removeFunction' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"getFuncWrapper")||(i.getFuncWrapper=function(){V("'getFuncWrapper' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"prettyPrint")||(i.prettyPrint=function(){V("'prettyPrint' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"makeBigInt")||(i.makeBigInt=function(){V("'makeBigInt' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"dynCall")||(i.dynCall=function(){V("'dynCall' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"getCompilerSetting")||(i.getCompilerSetting=function(){V("'getCompilerSetting' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"stackSave")||(i.stackSave=function(){V("'stackSave' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"stackRestore")||(i.stackRestore=function(){V("'stackRestore' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"stackAlloc")||(i.stackAlloc=function(){V("'stackAlloc' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"establishStackSpace")||(i.establishStackSpace=function(){V("'establishStackSpace' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"print")||(i.print=function(){V("'print' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"printErr")||(i.printErr=function(){V("'printErr' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"getTempRet0")||(i.getTempRet0=function(){V("'getTempRet0' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"setTempRet0")||(i.setTempRet0=function(){V("'setTempRet0' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"callMain")||(i.callMain=function(){V("'callMain' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"abort")||(i.abort=function(){V("'abort' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),i.Pointer_stringify=function(e,t){V("this function has been removed - you should use UTF8ToString(ptr, maxBytesToRead) instead!")},Object.getOwnPropertyDescriptor(i,"warnOnce")||(i.warnOnce=function(){V("'warnOnce' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),i.writeStackCookie=$,i.checkStackCookie=P,i.abortStackOverflow=function(e){V("Stack overflow! Attempted to allocate "+e+" bytes on the stack, but stack has only "+(C-le()+e)+" bytes available!")},Object.getOwnPropertyDescriptor(i,"intArrayFromBase64")||(i.intArrayFromBase64=function(){V("'intArrayFromBase64' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"tryParseAsDataURI")||(i.tryParseAsDataURI=function(){V("'tryParseAsDataURI' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"ALLOC_NORMAL")||Object.defineProperty(i,"ALLOC_NORMAL",{configurable:!0,get:function(){V("'ALLOC_NORMAL' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(i,"ALLOC_STACK")||Object.defineProperty(i,"ALLOC_STACK",{configurable:!0,get:function(){V("'ALLOC_STACK' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(i,"ALLOC_DYNAMIC")||Object.defineProperty(i,"ALLOC_DYNAMIC",{configurable:!0,get:function(){V("'ALLOC_DYNAMIC' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(i,"ALLOC_NONE")||Object.defineProperty(i,"ALLOC_NONE",{configurable:!0,get:function(){V("'ALLOC_NONE' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(i,"calledRun")||Object.defineProperty(i,"calledRun",{configurable:!0,get:function(){V("'calledRun' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}}),i.then=function(e){if(de)e(i);else{var t=i.onRuntimeInitialized;i.onRuntimeInitialized=function(){t&&t(),e(i)}}return i},U=function e(){de||fe(),de||(U=e)},i.run=fe,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return fe(),r}}();t.exports=n}(aw$1);var aw=aw$1.exports,AW_ERRORS={FETCH_ERROR:"FETCH_ERROR"},AwManager=function(){function e(t,r){_classCallCheck$4(this,e),this.cdnHost=t,this.cdnBucket=r}return _createClass$5(e,[{key:"init",value:function(){var e=new ProxyPromise;this.module={onRuntimeInitialized:function(){e.resolve()},onAbort:function(t){e.reject(t)}},this.cdnHost&&(this.module.cdnHost=this.cdnHost);var t=this.cdnBucket?"-".concat(this.cdnBucket):"";return this.module.cdnBucket="media-fe".concat(t),aw(this.module),e}},{key:"openBox",value:function(e){try{var t=window.atob(e),r=util.str2hex(t),n=this.module._malloc(Number(r.length));this.module.HEAP8.set(r,n);var i=this.module._openBox(Number(n),r.length),a=this.module.UTF8ToString(i);return this.module._free(n),a}catch(error){}}},{key:"destroy",value:function(){this.module=null}}]),e}();function isMSBrowser(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),r=e.indexOf("Trident/");return t>0||r>0}function checkIsQihuBrowser(){var e=navigator.mimeTypes,t=navigator.userAgent,r=!1;return e&&t.indexOf("Chrome")>1&&(r=Object.keys(e).some((function(t){return!!(e[t].type&&e[t].type.indexOf("360")>-1)||(!!(e[t].type&&e[t].type.indexOf("application/vnd.chromium.remoting-viewer")>-1)||!!(e[t].description&&e[t].description.indexOf("360")>-1))}))),r}function isEMESupported(){var e,t,r,n,i;return!(!navigator.requestMediaKeySystemAccess||(e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),t=isMSBrowser(),r=checkIsQihuBrowser(),n=navigator.userAgent.indexOf("Firefox")>0,i=navigator.userAgent.indexOf("Edge")>0,e||t||r||n||i))}function isWebAssemblySupported(){try{if("object"===("undefined"==typeof WebAssembly?"undefined":_typeof$4(WebAssembly))&&"function"==typeof WebAssembly.instantiate){var t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(e){console.log(e)}return!1}function isMediaSourceSupported(){var e=window.MediaSource=window.MediaSource||window.WebKitMediaSource;return e&&"function"==typeof e.isTypeSupported}function isSupported(){return isMediaSourceSupported()&&isWebAssemblySupported()&&!isMSBrowser()}function isSupportedWithXgmse(){return isWebAssemblySupported()&&!isMSBrowser()}var Timer=function(){function e(t){_classCallCheck$4(this,e),this.onTick_=t,this.cancelPending_=null}return _createClass$5(e,[{key:"tickAfter",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.stop();var n=!0,i=null;this.cancelPending_=function(){window.clearTimeout(i),n=!1};var a=function(){n&&(t.onTick_(),r&&r())};return i=window.setTimeout(a,1e3*e),this}},{key:"tickEvery",value:function(e){var t=this;this.tickAfter(e,(function(){t.tickEvery(e)}))}},{key:"stop",value:function(){this.cancelPending_&&(this.cancelPending_(),this.cancelPending_=null)}}]),e}(),PRELOAD_NEXT="PRELOAD_NEXT",PRELOAD_SEG_DONE="PRELOAD_SEG_DONE",STATES$1={PREPARE:"PREPARE",IDLE:"IDLE",PRELOADING:"PRELOADING",FINISH:"FINISH"},ONE_STEP_DONE="ONE_STEP_DONE",PRELOAD_TYPES$1={DURATION:0,SIZE:1},CACHE_TYPES={INDEXDB:0,MEMORY:1},DOWN_STATES={FAIL:-1,SUCCESS:0,DOWNLOADING:1},VTYPES$1={MP4:"MP4",DASH:"DASH",HLS:"HLS"},RETRY_MAX=10,PRELOADER=function(){function e(t,r,n,i,a){_classCallCheck$4(this,e),EventEmitter(this),this.state=STATES$1.PREPARE,this.options=t||{},this.logger=t.logger||function(){},this._preloadManager=r,this.player=r.player;var o=n.handlers,s=n.predictInst,u=n.readyPromise;this._predictInst=s,this._handlers=o,this._predictInstReadyPromise=u,this._toLoadList=[],this.retryCount=0,this._cachedHandler=i,this._cachedDataHanlder=a}return _createClass$5(e,[{key:"start",value:function(){var e=this,t=new ProxyPromise$1;return this._handlers.start(this.options).then((function(r){r.onObtain().then((function(n){e._predictInstReadyPromise.then((function(){e._predictInst.updateMediaInfos(n);var i=e._predictInst.preloadPredict(e.options),a=e._predictInst.cachedData;e._cachedDataHanlder(Object.assign({vid:e.options.vid},{data:a}));var o=Object.assign(i,e.options);r.onTransform(o).then((function(r){e._toLoadList=r,t.resolve(r)}))}))}))})).catch((function(e){t.reject(new Error("preload unit start error"))})),t}},{key:"preloadSeg",value:function(){var e=this;if(0===this._toLoadList.length)return this.state=STATES$1.FINISH,void this.emit(PRELOAD_SEG_DONE,!0);this.state="PRELOADING";var t=this._toLoadList.shift();this._handlers.onRequest(t,(function(r){var n=Object.assign({},t.extData,r);e._cachedHandler(n)})).then((function(){e.state=STATES$1.IDLE,e.emit(PRELOAD_SEG_DONE)})).catch((function(t){e.requestError(),e.emit(PRELOAD_SEG_DONE,!1)}))}},{key:"requestError",value:function(){this.retryCount++,this.state=STATES$1.IDLE,this.retryCount>=RETRY_MAX&&(this.state=STATES$1.FINISH),this.emit(ONE_STEP_DONE),this.logger("preload request error")}},{key:"cancelLoading",value:function(){this._toLoadList=[]}}]),e}();function getIDB(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){}}var idb=getIDB(),idb$1=idb;function isIndexedDBValid(){try{if(!idb$1||!idb$1.open)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),r="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||r)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function executeCallback(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function executeTwoCallbacks(e,t,r){"function"==typeof t&&e.then(t),"function"==typeof r&&e.catch(r)}function normalizeKey(e){return"string"!=typeof e&&(console.warn("".concat(e," used as a key, but it is not a string.")),e=String(e)),e}var dbContexts={},READ_ONLY="readonly",READ_WRITE="readwrite";function _deferReadiness(e){var t=dbContexts[e.name],r={};r.promise=new Promise((function(e,t){r.resolve=e,r.reject=t})),t.deferredOperations.push(r),t.dbReady?t.dbReady=t.dbReady.then((function(){return r.promise})):t.dbReady=r.promise}function _advanceReadiness(e){var t=dbContexts[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function _rejectReadiness(e,t){var r=dbContexts[e.name].deferredOperations.pop();if(r)return r.reject(t),r.promise}function _getConnection(e,t){return new Promise((function(r,n){if(dbContexts[e.name]=dbContexts[e.name]||createDbContext(),e.db){if(!t)return r(e.db);_deferReadiness(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var a=idb$1.open.apply(idb$1,i);t&&(a.onupgradeneeded=function(t){var r=a.result;try{r.createObjectStore(e.storeName)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),n(a.error)},a.onsuccess=function(){r(a.result),_advanceReadiness(e)}}))}function _getOriginalConnection(e){return _getConnection(e,!1)}function _getUpgradedConnection(e){return _getConnection(e,!0)}function _isUpgradeNeeded(e,t){if(!e.db)return!0;var r=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,i=e.version>e.db.version;if(n&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||r){if(r){var a=e.db.version+1;a>e.version&&(e.version=a)}return!0}return!1}function _tryReconnect(e){_deferReadiness(e);for(var t=dbContexts[e.name],r=t.forages,n=0;n<r.length;n++){var i=r[n];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,_getOriginalConnection(e).then((function(t){return e.db=t,_isUpgradeNeeded(e)?_getUpgradedConnection(e):t})).then((function(n){e.db=t.db=n;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=n})).catch((function(t){throw _rejectReadiness(e,t),t}))}function createTransaction(e,t,r,n){void 0===n&&(n=1);try{var i=e.db.transaction(e.storeName,t);r(null,i)}catch(a){if(n>0&&(!e.db||"InvalidStateError"===a.name||"NotFoundError"===a.name))return Promise.resolve().then((function(){if(!e.db||"NotFoundError"===a.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),_getUpgradedConnection(e)})).then((function(){return _tryReconnect(e).then((function(){createTransaction(e,t,r,n-1)}))})).catch(r);r(a)}}function createDbContext(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}var AsyncStorage=function(){function t(){_classCallCheck$4(this,t)}return _createClass$5(t,[{key:"ready",value:function(){return this._ready}},{key:"_initStorage",value:function(e){var t=this;t._defaultConfig=e;var r={db:null};if(e)for(var n in e)r[n]=e[n];var i=dbContexts[r.name];i||(i=createDbContext(),dbContexts[r.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=t._fullyReady);var a=[];function o(){return Promise.resolve()}for(var s=0;s<i.forages.length;s++){var u=i.forages[s];u!==t&&a.push(u._initReady().catch(o))}var c=i.forages.slice(0);return t._ready=Promise.all(a).then((function(){return r.db=i.db,_getOriginalConnection(r)})).then((function(e){return r.db=e,_isUpgradeNeeded(r,t._defaultConfig.version)?_getUpgradedConnection(r):e})).then((function(e){r.db=i.db=e,t._dbInfo=r;for(var n=0;n<c.length;n++){var a=c[n];a!==t&&(a._dbInfo.db=r.db,a._dbInfo.version=r.version)}})),t._ready}},{key:"probeSupport",get:function(){return isIndexedDBValid()}},{key:"getItem",value:function(t,r){var n=this;t=normalizeKey(t);var i=new Promise((function(r,i){n.ready().then((function(){createTransaction(n._dbInfo,READ_ONLY,(function(a,o){if(a)return i(a);try{var s=o.objectStore(n._dbInfo.storeName).get(t);s.onsuccess=function(){var e=s.result;void 0===e&&(e=null),r(e)},s.onerror=function(){i(s.error)}}catch(e){i(e)}}))})).catch(i)}));return executeCallback(i,r),i}},{key:"setItem",value:function(t,r,n){var i=this;t=normalizeKey(t);var a=new Promise((function(n,a){i.ready().then((function(){return r})).then((function(r){createTransaction(i._dbInfo,READ_WRITE,(function(o,s){if(o)return a(o);try{var u=s.objectStore(i._dbInfo.storeName);null===r&&(r=void 0);var c=u.put(r,t);s.oncomplete=function(){void 0===r&&(r=null),n(r)},s.onabort=s.onerror=function(){var e=c.error?c.error:c.transaction.error;a(e)}}catch(e){a(e)}}))})).catch(a)}));return executeCallback(a,n),a}},{key:"removeItem",value:function(t,r){var n=this;t=normalizeKey(t);var i=new Promise((function(r,i){n.ready().then((function(){createTransaction(n._dbInfo,READ_WRITE,(function(a,o){if(a)return i(a);try{var s=o.objectStore(n._dbInfo.storeName).delete(t);o.oncomplete=function(){r()},o.onerror=function(){i(s.error)},o.onabort=function(){var e=s.error?s.error:s.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return executeCallback(i,r),i}},{key:"clear",value:function(t){var r=this,n=new Promise((function(t,n){r.ready().then((function(){createTransaction(r._dbInfo,READ_WRITE,(function(i,a){if(i)return n(i);try{var o=a.objectStore(r._dbInfo.storeName).clear();a.oncomplete=function(){t()},a.onabort=a.onerror=function(){var e=o.error?o.error:o.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return executeCallback(n,t),n}},{key:"length",value:function(t){var r=this,n=new Promise((function(t,n){r.ready().then((function(){createTransaction(r._dbInfo,READ_ONLY,(function(i,a){if(i)return n(i);try{var o=a.objectStore(r._dbInfo.storeName).count();o.onsuccess=function(){t(o.result)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return executeCallback(n,t),n}},{key:"all",value:function(t){var r=this,n=new Promise((function(t,n){r.ready().then((function(){createTransaction(r._dbInfo,READ_ONLY,(function(i,a){if(i)return n(i);try{var o=a.objectStore(r._dbInfo.storeName).openCursor(),s=[];o.onsuccess=function(){var e=o.result;e?(s.push({key:e.key,value:e.value}),e.continue()):t(s)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return executeCallback(n,t),n}},{key:"_fullyReady",value:function(e){var t=this,r=t._initReady().then((function(){var e=dbContexts[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return executeTwoCallbacks(r,e,e),r}}]),t}(),IndexedDB=AsyncStorage,MemoryCache=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,[{key:"_initStorage",value:function(e){var t=e.name+"_"+e.storeName;return this.key=t,window[t]&&"object"===_typeof$4(window[t])||(window[t]={}),this.store=window[t],Promise.resolve()}},{key:"getItem",value:function(e,t){var r=this.store[e];return void 0===r&&(r=null),this._internalPromise(t,r)}},{key:"setItem",value:function(e,t,r){return this.store[e]=t,this._internalPromise(r)}},{key:"removeItem",value:function(e,t){return delete this.store[e],this._internalPromise(t)}},{key:"clear",value:function(e){return this.store={},window[this.key]={},this._internalPromise(e)}},{key:"length",value:function(e){var t=Object.keys(this.store).length;return this._internalPromise(e,t)}},{key:"_internalPromise",value:function(e,t){var r=t?Promise.resolve(t):Promise.resolve();return executeCallback(r,e),r}},{key:"all",value:function(e){for(var t=[],r=Object.keys(this.store),n=0;n<r.length;n++){var i=r[n];t.push({key:i,value:this.store[i]})}return this._internalPromise(e,t)}},{key:"probeSupport",value:function(){return!0}}]),e}(),MemoryCache$1=MemoryCache,DefaultConfig={description:"",name:"__PRE_CACHE__",storeName:"keyvaluepairs",version:1},SPLIT="|",SESSION_KEY="__PRE_CACHE__KEYS",TIMESPLIT="$",MAX_CACHE=200,PreloadCache=function(){function e(t,r){_classCallCheck$4(this,e);var n=r===CACHE_TYPES.MEMORY?MemoryCache$1:IndexedDB;this._driver=new n,this._driver._initStorage(DefaultConfig).catch((function(){})),this._hasIdbForbidden=!1,this._maxCache=!t||t<=0?MAX_CACHE:t,this.setMaxCache(this._maxCache),this._allCachedKeys={},this._allCachedTimeKeys={},this.getCachedKeysFromLocal(),this._readyPromise=new ProxyPromise$1,this.init()}return _createClass$5(e,[{key:"getCachedKeysFromLocal",value:function(){var e=proxyLocalStorage$1.getItem(SESSION_KEY);if(e)for(var t=e.split(SPLIT),r=0;r<t.length;r++){var n=t[r],i=this._getCacheKeyInfos(n),a=i.time,o=i.cachedKey;this._allCachedKeys[o]=1,this._allCachedTimeKeys[o]=a}}},{key:"_getCacheKeyInfos",value:function(e){var t,r=e.split(TIMESPLIT);return 2===r.length&&(t=r[0],e=r[1]),{time:t,cachedKey:e}}},{key:"writeCachedKeysToLocal",value:function(e){var t=[];this._allCachedKeys={},this._allCachedTimeKeys={};for(var r=0;r<e.length;r++){var n=e[r].key,i=this._getCacheKeyInfos(n),a=i.time,o=i.cachedKey;this._allCachedKeys[o]=1,this._allCachedTimeKeys[o]=a,t.push(n)}var s=t.join(SPLIT);proxyLocalStorage$1.setItem(SESSION_KEY,s)}},{key:"init",value:function(){var e=this;this._driver.setItem("test","test").then((function(){})).catch((function(){e._hasIdbForbidden=!0})).finally((function(){e._driver.removeItem("test").catch((function(){})),e._hasIdbForbidden&&(e._driver=new MemoryCache$1,e._driver._initStorage(DefaultConfig)),e._getAll(),e._readyPromise.resolve()}))}},{key:"_getAll",value:function(){var e=this;this._driver.all().then((function(t){e._cachedLength=t.length;var r=t.length-e._maxCache,n=t;if(r>0){var i=t.slice(0,r);n=t.slice(r);for(var a=0;a<i.length;a++)e.removeItem(i[a].key).then((function(){}))}e.writeCachedKeysToLocal(n)})).catch((function(){}))}},{key:"getItem",value:function(e,t){if(!this.hasItem(e))return Promise.resolve(!1);var r=this._getTimeKey(e).timeKey;return this._driver.getItem(r,t)}},{key:"setItem",value:function(e,t,r){var n=this;this._getTimeKey(e).timeKey&&this.removeItem(e);var i=(new Date).getTime();this._allCachedKeys[e]=1,this._allCachedTimeKeys[e]=i;var a=this._genTimeKey(e,i);return r=r?function(){n._getAll(),r()}:function(){n._getAll()},this._driver.setItem(a,t,r)}},{key:"_getTimeKey",value:function(e){var t=this._allCachedTimeKeys[e],r=e;return t&&(r=this._genTimeKey(e,t)),{timeKey:r,time:t}}},{key:"_genTimeKey",value:function(e,t){return"".concat(t).concat(TIMESPLIT).concat(e)}},{key:"removeItem",value:function(e,t){var r=this._getTimeKey(e).timeKey,n=this._driver.removeItem(r,t);return delete this._allCachedKeys[e],delete this._allCachedTimeKeys[e],n}},{key:"hasItem",value:function(e){return!!this._allCachedKeys[e]}},{key:"clear",value:function(e){return this._driver.clear(e)}},{key:"length",value:function(e){return this._driver.length(e)}},{key:"setMaxCache",value:function(e){"number"==typeof e&&e>0&&(this._maxCache=e)}}]),e}(),PreloadCache$1=PreloadCache,PRELOADER_KEY="DEFAULT",PreloaderManager=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck$4(this,e),EventEmitter(this),this._preloadDataList=[],this._currentPreloadInst=null,this._dashPreloadList=[],this.autoPreload=t.autoPreload||!1,this._onPreloadNext=this.onPreloadNextReady.bind(this),this.on(PRELOAD_NEXT,this._onPreloadNext),this._preloaderConfigs={},this.update(t,r,n),this._cacheInst=new PreloadCache$1(t.preloadMaxCacheCount,t.preloadCacheType),this._preloadCacheProgress={},this._ptag_=!0,this._cachedDatas={}}return _createClass$5(e,[{key:"_getProloaderKey",value:function(e){return e.vtype?e.vtype:PRELOADER_KEY}},{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!r)throw new Error("PreloaderManager predictInst is null");var n=this._getProloaderKey(e);this._preloaderConfigs[n]={predictInst:r,readyPromise:r.init(e),handlers:t}}},{key:"cachedDatas",get:function(){return this._cachedDatas}},{key:"onCacheSegment",value:function(e){var t=e.vid,r=e.format,n=e.cacheKey,i=e.total,a=e.loaded,o=e.isInitSegment,s=e.mediaType,u=this.getProgressCacheKey(t,r,s),c=this._preloadCacheProgress[u];c||(c=this._preloadCacheProgress[u]={}),c[n]={total:i,loaded:a,isInitSegment:o}}},{key:"onCachePredict",value:function(e){var t=e.vid,r=e.data;t&&r&&(this._cachedDatas[t]=r)}},{key:"getProgressCacheKey",value:function(e,t,r){return"".concat(e,"-").concat(t,"-").concat(r)}},{key:"onPreloadNextReady",value:function(){this.onPreloadNext()}},{key:"onPreloadSegDone",value:function(){this.autoPreload&&this.emit(PRELOAD_NEXT)}},{key:"onPreloadNext",value:function(){var e=this;if(null==this._currentPreloadInst&&this._preloadDataList.length>0){if(this._preloadDataList.length>0){var t=this._preloadDataList.shift().data;if(t.payload){var r=this._getProloaderKey(t),n=this._preloaderConfigs[r];if(!n)return void console.warn("need to set vtype, no preloader",t);this._currentPreloadInst=new PRELOADER(t,this,n,(function(t){e.onCacheSegment(t)}),(function(t){e.onCachePredict(t)})),this._currentPreloadInst.on(PRELOAD_SEG_DONE,this.onPreloadSegDone.bind(this)),this._currentPreloadInst.start().then((function(){e._currentPreloadInst.preloadSeg()})).catch((function(){e._currentPreloadInst=null}))}}}else null!=this._currentPreloadInst&&(this._currentPreloadInst.state===STATES$1.IDLE?this._currentPreloadInst.preloadSeg():this._currentPreloadInst.state===STATES$1.FINISH&&(this._currentPreloadInst=null))}},{key:"addDashPreloader",value:function(e){e&&e.data&&(this._preloadDataList.push(e),this.sort(this._preloadDataList),this.autoPreload&&this.emit(PRELOAD_NEXT))}},{key:"_addDashPreloader",value:function(e){e&&e.data&&this._preloadDataList.push(e)}},{key:"addDashPreloaderList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.sort(e);for(var t=0;t<e.length;t++)this._addDashPreloader(e[t])}},{key:"sort",value:function(e){e.sort((function(e,t){return void 0===e.order&&void 0===e.order||e.order<t.order?-1:1}))}},{key:"destroy",value:function(){this.off(PRELOAD_NEXT,this._onPreloadNext)}},{key:"cancelLoading",value:function(){this._currentPreloadInst&&(this._currentPreloadInst.cancelLoading(),this._currentPreloadInst=null),this._preloadDataList=[]}},{key:"preloadCacheProgress",value:function(e){var t=e.vid,r=e.format,n=e.mediaType,i=e.prelaodType,a=e.bitrate,o=e.set_duration,s=e.set_size,u=e.media_type,c=e.start_time,l=this.getProgressCacheKey(t,r,n),d=this._preloadCacheProgress[l];if(d){for(var h=Object.values(d),f=0,p=0,g=0,y=0,m=0,v=0;v<h.length;v++){var _=h[v];_.isInitSegment&&(f=_.total,g=_.loaded,y=_.loaded===_.total?DOWN_STATES.SUCCESS:DOWN_STATES.DOWNLOADING),p+=_.total,m+=_.loaded}return{media_type:u,preload_type:i,stream_bitrate:a,header_size:f,content_total_size:p,start_time:c||-1,state_info:{set_duration:o,set_size:s,current_header_download_size:g,current_content_download_size:m,header_download_state:y,content_download_state:m===p?DOWN_STATES.SUCCESS:DOWN_STATES.DOWNLOADING}}}return null}},{key:"getPreloadTaskInfos",value:function(){}},{key:"getItem",value:function(e,t){return this._cacheInst.getItem(e,t)}},{key:"setItem",value:function(e,t,r){return this._cacheInst.setItem(e,t,r)}},{key:"removeItem",value:function(e,t){return this.removeItem(e,t)}}],[{key:"getInstance",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.GLOBAL_KEY+(t.globalKey?t.globalKey:""),a=window[i];if(a&&a._ptag_)return a.update(t,r,n),a;var o=new e(t,r,n);return window[i]=o,o}}]),e}();PreloaderManager.GLOBAL_KEY="__preloadcontext__";var PreloaderManager$1=PreloaderManager,PreloaderBase=function(){function t(e){_classCallCheck$4(this,t),EventEmitter(this),this.options=e,this.promisePolyfill(),this.before(),this.check(),this._preloadManager=PreloaderManager$1.getInstance(e,this.handlers,this.predictInst),this.loadingTasks=[]}return _createClass$5(t,[{key:"promisePolyfill",value:function(){Promise.prototype.finally||(Promise.prototype.finally={finally:function(e){var t=function(t){return Promise.resolve(e()).then(t)};return this.then((function(e){return t((function(){return e}))}),(function(e){return t((function(){return Promise.reject(e)}))}))}}.finally)}},{key:"before",value:function(){throw new Error("need")}},{key:"check",value:function(){if(!this.handlers)throw new Error("handlers null");if(!this.handlers.start||!this.handlers.onRequest)throw new Error("handlers callback null");if(!this.predictInst)throw new Error("predictInst null");if(!this.predictInst.__p__)throw new Error("predictInst need extends predictbase")}},{key:"preloadNext",value:function(){this._preloadManager.emit(PRELOAD_NEXT)}},{key:"preloadManager",get:function(){return this._preloadManager}},{key:"start",value:function(e){throw new Error("start need implment, return Promise")}},{key:"cancelLoading",value:function(){for(var t=0;t<this.loadingTasks.length;t++)try{var r=this.loadingTasks[t];"function"==typeof r.cancel&&r.cancel()}catch(e){}this.loadingTasks=[],this._preloadManager.cancelLoading()}},{key:"addTasker",value:function(e){this.loadingTasks.push(e)}},{key:"removeTasker",value:function(e){var t=this;setTimeout((function(){for(var r=t.loadingTasks.length-1;r>-1;r--)if(t.loadingTasks[r]===e){t.loadingTasks.splice(r,1);break}}))}},{key:"addDashPreloader",value:function(e){this._preloadManager.addDashPreloader(e)}},{key:"addDashPreloaderList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._preloadManager.addDashPreloaderList(e)}}]),t}(),PredictBase=function(){function e(){_classCallCheck$4(this,e),this.bandwidth2item={},this._mediaInfos=null,this.__p__=!0}return _createClass$5(e,[{key:"init",value:function(){throw new Error("init func not implement, return promise")}},{key:"preloadPredict",value:function(e){throw new Error("preloadPredict error",e)}},{key:"updateMediaInfos",value:function(e){if(this._mediaInfos=e,this.bandwidth2item={},this.dynamic_video=e&&e.dynamic_video_list,this.dynamic_video&&this.dynamic_video.length>0)for(var t=0;t<this.dynamic_video.length;t++){var r=this.dynamic_video[t];this.bandwidth2item[r.bitrate||r.bandwidth]=r}}},{key:"getIdx",value:function(e,t){var r=0;return e.forEach((function(e,n){e.definition===t&&(r=n)})),r}},{key:"cachedData",get:function(){return null}}]),e}(),VTYPES=VTYPES$1;function ownKeys$1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$1(Object(r),!0).forEach((function(t){_defineProperty$5(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$1(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _createSuper$e(e){var t=_isNativeReflectConstruct$e();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$e(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var MAX_LOADING_COUNT=1,PRELOAD_TYPES=PRELOAD_TYPES$1,_BITRATE_SELECTOR=null,Predict=function(e){_inherits$4(r,e);var t=_createSuper$e(r);function r(){return _classCallCheck$4(this,r),t.apply(this,arguments)}return _createClass$5(r,[{key:"init",value:function(){return Promise.resolve()}},{key:"preloadPredict",value:function(e){return e}}]),r}(PredictBase),Mp4Preloader=function(e){_inherits$4(a,e);var t,r,n,i=_createSuper$e(a);function a(e,t){var r;return _classCallCheck$4(this,a),e.vtype=VTYPES.MP4,(r=i.call(this,e)).player=t,r.loadingCount=0,r._mp4=null,r._loader=null,r._pendingPromise=null,r.playerId=t.playerId,r}return _createClass$5(a,[{key:"log",value:function(e){for(var t="[Preloader] ".concat(e),r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];log.apply(void 0,[t].concat(n))}},{key:"before",value:function(){var e=this;this.handlers={start:function(t){var r=t.payload||[];if(0===r.length)return Promise.reject();var n=t.vid,i=t.vtype||"MP4",o=t.codecType||"h264",s=e.player.config.userSelectDefinition,u=e.checkCacheKey(n,r,s,i,o);if(console.log("[Preloader] ".concat(n," codecType:").concat(o," vtype:").concat(i," hasCache:").concat(u)),u||"MP3"===i||"h265"===o)return Promise.reject();var c=e.getInitDefinition(r,e.options.definition,s);if(console.log("[Preloader] ".concat(n," getInitDefinition"),c),!c)return Promise.reject();var l=c.definition,d=t.preloadTime||e.options.preloadTime,h=t.preloadSize||e.options.preloadSize||Math.pow(25,4)-1,f=a.generateUniqueKey({vid:n,definition:l,vtype:i,codecType:o});log("".concat(n," start duration:").concat(c.duration," cacheKey:").concat(f));var p=_objectSpread({vid:n,definition:l,preloadTime:d,preloadSize:h,cacheKey:f,codecType:o,vtype:i},c);return e.loadingCount++,e.start(p)},onRequest:function(t,r){var n=t.url,i=t.range,a=t.extData;return console.log(">>>onRequest"),e.getData(n,i,a,r)}},this.loggerConfig={logger:function(){},openLog:!1},this.predictInst=new Predict(this.loggerConfig)}},{key:"start",value:function(e){var t=this,r={mediaInfos:{dynamic_video_list:[],dynamic_audio_list:[]},onObtain:function(){var e=new ProxyPromise;return e.resolve(r.mediaInfos),e},onTransform:function(r){var n=new ProxyPromise;return t._pendingPromise=n,e.preloadTime?t.loadByPreloadTime(e,n):t.loadByChunkSize(e,n),n}};return Promise.resolve(r)}},{key:"getInitDefinition",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=null;if(a.BitRateAdapter)n=a.BitRateAdapter.getSuitableBitrate(e,r),console.log("Mp4Preloader.BitRateAdapter",n);else{for(var i=0,o=0;o<e.length;o++){var s=e[o];if(s.definition===t){i=o;break}}n=e[i]}return n||(n=e[0]),n}},{key:"getPreLoadData",value:function(e){var t=new ProxyPromise;return this.getItemSameVid(e).then((function(e){if(console.log("[Preloader] getPreLoadData",e.value),e.value){var r=e.value,n=r.mediaSegList,i=r.meta,a=r.type,o=r.buffer,s=r.preloadTime,u=r.vid,c=r.cacheKey,l=r.definition,d=r.byteLength,h=r.duration,f=r.fileSize,p=r.from,g={vid:u,type:a,vtype:r.vtype,codecType:r.codecType,definition:l,cacheKey:c,duration:h||0,byteLength:d,from:p};a===PRELOAD_TYPES.SIZE?(g.buffer=o,g.fileSize=f||0):(g.meta=i,g.mediaSegList=n,g.preloadTime=s),t.resolve(g)}else t.resolve(null)})).catch((function(e){t.reject(e)})),t}},{key:"setPreLoadData",value:(n=_asyncToGenerator$1(regenerator.mark((function e(t,r){var n,i,a,o,s,u,c,l,d,h,f,p,g,y,m,v,_=this;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ProxyPromise,i=r.mediaSegList,a=r.meta,o=r.vid,s=r.definition,u=r.type,c=r.buffer,l=r.duration,d=r.byteLength,h=r.preloadTime,f=r.preloadSize,p=r.fileSize,g=r.from,y=r.vtype,m=r.codecType,v={codecType:m,vtype:y,vid:o,definition:s,cacheKey:t,type:u,from:g},u===PRELOAD_TYPES.SIZE?(v.buffer=c,v.byteLength=d||0,v.preloadSize=f||0,v.fileSize=p,v.buffer&&v.buffer.byteLength>0&&(this.setItem(t,v),n.resolve(!0))):(v.mediaSegList=i||[],v.meta=a,v.duration=l,v.byteLength=d||0,v.preloadTime=h||0,a&&0===i.length?(this.log("setPreLoadData",t,(new Date).getTime()),this.setItem(t,v),n.resolve(!0)):(i.every((function(e){return!!e.buffer&&e.state}))||n.resolve(!1),this.log("setPreLoadData1",t,(new Date).getTime()),this.setItem(t,v).then((function(){_.log("setPreLoadData1 success",t,(new Date).getTime())})),n.resolve(!0))),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"getInitCacheData",value:function(e,t){var r=null;return r=e===PRELOAD_TYPES.DURATION?{type:e,mediaSegList:[],meta:null,duration:0,byteLength:0,fileSize:0}:{type:e,buffer:null,byteLength:0,fileSize:0},Object.keys(t).map((function(e){r[e]=t[e]})),r}},{key:"updatePreCacheData",value:function(e,t,r,n,i,a,o){var s=e.mediaSegList;if(e.type===PRELOAD_TYPES.SIZE||-1===i)return e.buffer=lib$1(Uint8Array,e.buffer.buffer||[],new Uint8Array(t)),e;for(var u=-1,c=0;c<s.length;c++)if(s[c].index===i){u=c;break}var l=a||[0,0];return u>-1?(t&&(s[u].buffer=lib$1(Uint8Array,s[u].buffer||[],new Uint8Array(t))),r.length>1&&(s[u].range.length>1?s[u].range[1]=r[1]:s[u].range=r),-1!==o[1]&&(n=s[u].range[1]>=o[1]),s[u].state=n):(e.duration=l[1],s.push({buffer:t,range:r||[],index:i,totalRange:o||[],timeRange:[l[0],l[1]],state:n})),n&&(e.byteLength=r[1]),n}},{key:"checkCacheKey",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"MP4",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"h264";if(r){var o=a.generateUniqueKey({vid:e,definition:r,vtype:n,codecType:i});return this.hasItemSameVid(o)?o:null}for(var s=0;s<t.length;s++){var u=a.generateUniqueKey({vid:e,definition:t[s].definition,vtype:n,codecType:i}),c=this.hasItemSameVid(u);if(c)return u}return null}},{key:"checkCanPreloadNext",value:function(){var e=!0;return this.loadingCount>=MAX_LOADING_COUNT&&(e=!1),e&&this.preloadNext(),e}},{key:"loadByPreloadTime",value:function(e,t){var r=this,n=e.vid,i=e.cacheKey,a=e.preloadTime,o=e.definition,s=e.duration,u=e.bitrate,c=e.codecType,l=null;if(l="Array"===util.typeOf(e.url)?e.url.length>1?e.url[1].src:e.url[0].src:e.url){l=util.extUrl(l,{__vid:n}),console.log("[Preloader] loadByPreloadTime",e.cacheKey,e.definition),this.log("loadByPreloadTime",e.cacheKey,e);var d=util.getFileSize(u,s);this._mp4=new MP4$1(l,u,{xhrSetup:e.xhrSetup,chunkSize:this.options.preloadSize,vid:n,duration:s||0,fileSize:d||0,cacheKey:i,useUrlRange:e.useUrlRange},null,null,{},[],{},"[Preloader]");var h=this.getInitCacheData(PRELOAD_TYPES.DURATION,{vid:n,preloadTime:a,definition:o,cacheKey:i,codecType:c});console.log("preCacheInfo",h),this._mp4.once("metaReady",(function(a){r.log("".concat(n," metaReady this._pendingPromise"),r._pendingPromise.state),h.meta=a,h.from=2,r.setPreLoadData(i,h),r.startLoadByFragments(h,e,t)})),this._mp4.on("error",(function(e){console.error("[Preloader] ".concat(n," loadByPreloadTime error"),e),r._endLoadFragments()})),this._mp4.init({})}else this._endLoadFragments()}},{key:"loadByChunkSize",value:(r=_asyncToGenerator$1(regenerator.mark((function e(t){var r,n,i,a,o,s,u,c,l,d,h,f,p;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.vid,n=t.cacheKey,i=t.definition,a=t.codecType,o=t.vtype,console.log("[Preloader] ".concat(r," loadByChunkSize")),s=this.options,u=t.preloadSize||this.options.preloadSize,c="Array"===util.typeOf(t.url)?t.url[0].src:t.url){e.next=8;break}return this._endLoadChunk(),e.abrupt("return");case 8:return c=util.extUrl(c,{__vid:r}),l=this.getInitCacheData(PRELOAD_TYPES.SIZE,{vid:r,definition:i,cacheKey:n,codecType:a,vtype:o}),this.MP4Loader=new MP4Loader({url:c,retry:s.retry||2,retryDelay:s.retryDelay||1e3}),e.prev=11,e.next=14,this.MP4Loader.loadData([0,u],this.MP4Loader.cache,{});case 14:d=e.sent,h=d.response,f=d.data,this.log("".concat(r," loadByChunkSize"),h),f?(this._endLoadChunk(),h&&h.headers&&(p=getFileSize(h.headers),l.fileSize=p),l.buffer=f,l.byteLength=f.byteLength,this.log("".concat(r,"  loadByChunkSize ret"),n,u,l),l.from=4,this.setPreLoadData(n,l)):this._endLoadChunk(),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(11),console.error("[Preloader] ".concat(r," loadByChunkSize error"),e.t0),this._endLoadChunk();case 24:case"end":return e.stop()}}),e,this,[[11,20]])}))),function(e){return r.apply(this,arguments)})},{key:"_endLoadChunk",value:function(){this.log("_endLoadChunk loadingCount:".concat(this.loadingCount),this._pendingPromise?this._pendingPromise.state:null),this._pendingPromise&&(this._pendingPromise.resolve(),this._pendingPromise=null),this.loadingCount--,this.MP4Loader&&(this.MP4Loader.destroy(),this.MP4Loader=null)}},{key:"startLoadByFragments",value:(t=_asyncToGenerator$1(regenerator.mark((function e(t,r,n){var i,a,o,s,u,c,l=this;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=r.preloadTime,a=r.vid,console.log("[Preloader] ".concat(a," startLoadByFragments")),o=[],s=0;s<this._mp4.timeRange.length;s++)this._mp4.timeRange[s][0]<i&&o.push(s);return u=function(e){l._endLoadFragments()},c=function(){var e=_asyncToGenerator$1(regenerator.mark((function e(r){var n,i,a,s,d,h,f,p;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l._mp4){e.next=2;break}return e.abrupt("return");case 2:if(n=r.buffer,i=r.context,a=i.state,s=i.fragIndex,d=i.range,h=i.timeRange,f=l._mp4.getFragRange(s),p=l.updatePreCacheData(t,n,d,a,s,h,f),l.log("".concat(t.cacheKey," _successCallback"),s,a,p,d,h,f),t.from=3,!p){e.next=19;break}return e.next=11,l.setPreLoadData(t.cacheKey,t);case 11:if(!(s>=o.length-1)){e.next=16;break}l.log("".concat(t.cacheKey," mp4.load end"),s),l._endLoadFragments(),e.next=19;break;case 16:return l.log("".concat(t.cacheKey," mp4.load start"),s+1),e.next=19,l._mp4.loadAllFragmentData(s+1,c,u);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=8,this._mp4.loadAllFragmentData(0,c,u);case 8:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})},{key:"_endLoadFragments",value:function(){this.log("_endLoadFragments loadingCount:".concat(this.loadingCount),this._pendingPromise?this._pendingPromise.state:null),this._pendingPromise&&(this._pendingPromise.resolve(),this._pendingPromise=null),this.loadingCount--,this._mp4&&(this._mp4.destroy(),this._mp4=null)}},{key:"getFragment",value:function(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=new ProxyPromise;return this.getData(e,t,a,!1).then((function(e){n.createFragment(new Uint8Array(e.res),t[0]-n.mdatStart,r,{range:t,context:e.context}).then((function(e){o.resolve(e)}))})),o}},{key:"getPreloadUrl",value:function(e){var t=e.url,r=e.range,n=e.definition,i=e.vid;return[{url:t,range:r,extData:{cacheKey:a.generateUniqueKey({vid:i,start:r[0],end:r[1],definition:n}),vid:i,format:"mp4"}}]}},{key:"getRangeList",value:function(e){var t=this.allCachedKeys,r={timeRange:[],contentRange:[]};for(var n in t)if(t.hasOwnProperty(n)&&n.indexOf(e)>-1){var i=n.split("#");0===i[2].indexOf("pretime")?r.timeRange.push([0,parseFloat(i[2].slice(7))]):r.contentRange.push([parseInt(i[2]),parseInt(i[3])])}return r}},{key:"hasItemSameVid",value:function(e){if(!e)return!1;var t=this.allCachedKeys;for(var r in t)if(t.hasOwnProperty(r)){if(r===e)return r;var n=r.split("#"),i=e.split("#");if(n.length>=4&&i.length>=4&&n[0]===i[0]){if(0===n[2].indexOf("pretime")&&0===i[2].indexOf("pretime"))return r;var a=[parseInt(n[2]),parseInt(n[3])],o=[parseInt(i[2]),parseInt(i[3])];if(o[0]>=a[0]&&o[1]>o[0]&&o[1]<=a[1])return r}}return!1}},{key:"removeOthers",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=this.allCachedKeys;for(var n in r)r.hasOwnProperty(n)&&n.split("#").length>=1&&function(){var r=n.split("#")[0];t.every((function(e){return e.split("#").length>=1&&e.split("#")[0]!==r}))&&(e.log("remove cache:".concat(n)),e.cacheInst.removeItem(n))}()}},{key:"getItemSameVid",value:function(e,t){var r=this.hasItemSameVid(e);return this.log("getItemSameVid: key:".concat(e," checkResult:").concat(r)),r?this.cacheInst.getItem(r,t).then((function(e){return{value:e,key:r}})):Promise.resolve({})}},{key:"setItem",value:function(e,t){return this.cacheInst.setItem(e,t)}},{key:"allCachedKeys",get:function(){return this.cacheInst._allCachedKeys}},{key:"cacheInst",get:function(){return this._preloadManager._cacheInst}},{key:"cancelPreloadByVid",value:function(e){if(e){for(var t=this._preloadManager._preloadDataList,r=[],n=0;n<t.length;n++){t[n].data.vid!==e?r.push(t[n]):this.log("cancelPreloadByVid",e)}this._preloadManager._preloadDataList=r}}},{key:"cancelLoading",value:function(e){this._mp4&&(this._mp4.destroy(),this._pendingPromise&&this._pendingPromise.resolve());var t=this._preloadManager;if(t._currentPreloadInst){var r=t._currentPreloadInst._toLoadList,n=[];r.map((function(t){return t.playerId!==e&&n.push(t),t})),t._currentPreloadInst._toLoadList=n}var i=[],a=[];t._preloadDataList.map((function(t){return t.playerId!==e?i.push(t):a.push(t.data.vid),t})),this.log("cancelLoading",e,a.join(",")),t._preloadDataList=i}},{key:"checkIfExistInList",value:function(e){for(var t=this._preloadManager._preloadDataList,r=0;r<t.length;r++)if(e===t[r].data.vid)return!0;return!1}},{key:"addPreloader",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(e.data){e.data.vtype||(e.data.vtype=VTYPES.MP4);var n=e.data.vid,i=this.checkIfExistInList(n);console.log("[Preloader] addPreloader checkIfExistInList",n,i),r&&n===r||i||(e.playerId=t,this.addDashPreloader(e))}}},{key:"addPreloaderList",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=[],n=0;n<e.length;n++){var i=e[n].data,a=i.vid,o=i.vtype,s=this.checkIfExistInList(a);console.log("[Preloader] addPreloaderList checkIfExistInList",a,a===t,s),t&&a===t||s||(o||(e[n].data.vtype=VTYPES.MP4),r.push(e[n]))}console.log("[Preloader] addPreloaderList length is ".concat(r.length)),this.addDashPreloaderList(r)}},{key:"destroy",value:function(){this._endLoadFragments(),this._endLoadChunk(),this.cancelLoading(this.playerId)}}],[{key:"PRELOAD_TYPES",get:function(){return PRELOAD_TYPES}},{key:"BitRateAdapter",get:function(){return _BITRATE_SELECTOR},set:function(e){_BITRATE_SELECTOR=e}},{key:"generateUniqueKey",value:function(e){var t=e.vid,r=e.mediaType,n=e.definition,i=e.codecType,a=e.vtype;return r=r||"video",n=n||"-1",i=i||"h264",a=a||"mp4",t?"".concat(t,"#").concat(r,"#").concat(i,"#").concat(a,"#").concat(n):null}}]),a}(PreloaderBase),CUSTOM_EVENTS={MEDIA_EXPIRED:"MEDIA_EXPIRED",INIT_FAIL:"INIT_FAIL",PARSE_ERROR:"PARSE_ERROR",PLAYER_LOG:"PLAYER_LOG",BUFFERED_RESET:"BUFFERED_RESET"},BUFFER_BREAK=15e3,IntervalTimer=function(){function e(){_classCallCheck$4(this,e),this.timeID=null,this.func=null}return _createClass$5(e,[{key:"repeat",value:function(e,t){this.timeID=1,this.repeatInterval(e,t)}},{key:"repeatInterval",value:function(e,t){var r=this;this.timeID&&(null===this.func&&(this.func=e),this.func===e&&(this.timeID&&clearTimeout(this.timeID),this.timeID=null,this.timeID=setTimeout((function(){e(),r.repeatInterval(e,t)}),t)))}},{key:"clear",value:function(){clearTimeout(this.timeID),this.timeID=null}}]),e}(),IntervalTimer$1=IntervalTimer,GapJump=function(){function e(t,r){_classCallCheck$4(this,e),this.player=t,this.mediaElem=t.video,this.config=r,this.timer=new IntervalTimer$1,this.prevReadyState=this.mediaElem.readyState,this.didFireLargeGap=!1,this.seekingEventReceived=!1,this.segmentAppended=!1,this.onWaitFunc=this._onWaiting.bind(this),this.onPlayFunc=this._onPlay.bind(this),this.isSafari=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),!1!==this.config.useGapJump&&this._start(),this.hasPlayed=!1}return _createClass$5(e,[{key:"_onWaiting",value:function(){this.onGapJump()}},{key:"_onPlay",value:function(){this.hasPlayed=!0}},{key:"_start",value:function(){var e=this;this.mediaElem.addEventListener("waiting",this.onWaitFunc),this.mediaElem.addEventListener("play",this.onPlayFunc),this.timer.repeat((function(){e.onGapJump()}),250)}},{key:"onSegmentAppend",value:function(e){if(this.segmentAppended=!0,this.config.enableCheckBufferDiff&&this.mediaElem){var t=e.reduce((function(e,t){return e+t.downloaded?t[1]-t[0]:0}),0);this._getBuffered(this.mediaElem.buffered).reduce((function(e,t){return e+(t.end-t.start)}),0)/t<.8&&(log("onSegmentAppend detectGap"),this.player&&this.player.emit("detectGap"))}this.onGapJump()}},{key:"onSeeking",value:function(){this.seekingEventReceived=!0,this.segmentAppended=!1,this.didFireLargeGap=!1}},{key:"onGapJump",value:function(){if(this.mediaElem.readyState!==HTMLMediaElement.HAVE_NOTHING){if(this.mediaElem.seeking){if(!this.seekingEventReceived)return}else this.seekingEventReceived=!1;if(!this.mediaElem.paused||0===this.mediaElem.currentTime||!this.hasPlayed){this.mediaElem.readyState!==this.prevReadyState&&(this.didFireLargeGap=!1,this.prevReadyState=this.mediaElem.readyState);var t=this.mediaElem.buffered,r=this.config.smallGapLimit||.5,n=this.config.gapDetectionThreshold||.1,i=this.mediaElem.currentTime,a=this._getIndex(t,i,n);if(null!==a&&(0!==a||this.segmentAppended)){var o=t.start(a)+.1;if(!(o>this.mediaElem.duration)){var s=o-i,u=s<=r;s<e.BROWSER_GAP_TOLERANCE||u&&(!0!==this.config.disableGapSetPosition&&(log("onGapJump this.mediaElem.currentTime"),this.mediaElem.currentTime=this.isSafari?o+.1:o),this.player&&this.player.emit("detectGap"),log("gapJump gapIndex",a,"isGapSamll",u,"jumpLargeGap",!1,"currentTime",this.mediaElem.currentTime),.08!==o&&this.player&&this.player.emit("log",{type:"oneevent",end_type:"gap",vid:this.player.config.vid,ext:{video_postion:Math.floor(1e3*o)}}))}}}}}},{key:"_getIndex",value:function(e,t,r){if(!e||!e.length)return null;if(1===e.length&&e.end(0)-e.start(0)<1e-6)return null;for(var n=this._getBuffered(e),i=null,a=0;a<n.length;a++){if(n[a].start>t&&(0===a||n[a-1].end-t<=r)){i=a;break}}return i}},{key:"_getBuffered",value:function(e){if(!e)return[];for(var t=[],r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}},{key:"destroy",value:function(){this.mediaElem.removeEventListener("waiting",this.onWaitFunc),this.mediaElem.removeEventListener("play",this.onPlayFunc),this.timer.clear(),this.timer=null}}]),e}();GapJump.BROWSER_GAP_TOLERANCE=.001;var START_TYPES={FIXED:"FIXED",AUTO:"AUTO"},AbrService=function(){function e(t,r){var n=this;_classCallCheck$4(this,e),_defineProperty$5(this,"_onAbrChange",(function(e,t,r,i){var a=n._pluginInst.player,o=n.bitrateMap[e],s=n.bitrateMap[t],u=o.definition,c=s&&s.definition?s.definition:u;console.log("[ABR] _onAbrChange ",u,c),u!==c&&(n._abrSwitchHandler(s),a.emit("ABR_CHANGE",{prev:u,cur:c,prevName:o.definitionName,curName:s.definitionName,abrInfo:i}))})),_defineProperty$5(this,"_onAutoDescChange",(function(e){var t=e.definition,r=e.reset,i=e.fps,a=e.item;n.updateAutoDefiDesc(t,r,i,a)})),this._pluginInst=t;var i=this._pluginInst.config.autoBitrateOpts||{};this.isPlayAutoDefi=ABR.getIsPlayAutoDefi(i),this.isOpenAutoDefi=!!i.isOpenAutoDefi,this.isCurrentAutoDefi=this.isOpenAutoDefi&&this.isPlayAutoDefi,this.bitrateMap={},this.defiIdMap={},this._abrSwitchHandler=r}var t;return _createClass$5(e,[{key:"_destroyAbr",value:function(){var e=this._pluginInst.player;this.abrInstance&&(e&&e.off(ABR_EVENTS.UPDATE_AUTO_DESC,this._onAutoDescChange),this.abrInstance.destroy(),this.abrInstance=null)}},{key:"init",value:(t=_asyncToGenerator$1(regenerator.mark((function e(t){var r,n,i,a;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isOpenAutoDefi){e.next=2;break}return e.abrupt("return",{type:START_TYPES.FIXED});case 2:return r=this._pluginInst,n=r.player,i=r.playerConfig,a=r.config,n.on(ABR_EVENTS.UPDATE_AUTO_DESC,this._onAutoDescChange),this.bitrateMap={},this.defiIdMap={},this.abrInstance=new ABR(n,a,0,{dynamic_video_list:i.definition.list.concat()},5e3,{logger:log,openLog:openLog}),e.next=9,this.abrInstance.init(t);case 9:n.on(ABR_EVENTS.ABR_CHANGE,this._onAbrChange),this.abrInstance.isCurrentInAbr=this.isCurrentAutoDefi;case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"execute",value:function(){var e=this.abrInstance.execute();return{bitrate:e,type:-1===e?START_TYPES.FIXED:START_TYPES.AUTO}}},{key:"updateBitrate",value:function(e){this.abrInstance&&this.abrInstance.updateBitrate(e)}},{key:"enable",value:function(){console.log("[ARB] open!!!!!!!!!"),this.abrInstance.start(),this.isCurrentAutoDefi=!0,this.abrInstance.isCurrentInAbr=!0,this.abrInstance._onTimeUpdate(null,!0)}},{key:"disable",value:function(){console.log("[ARB] close!!!!!!!!!!!"),this.abrInstance&&(this.updateAutoDefiDesc("",!0),this.isCurrentAutoDefi=!1,this.abrInstance.isCurrentInAbr=!1,this.abrInstance.stop(!0))}},{key:"isCurrentInAbr",value:function(){return!!this.abrInstance&&this.abrInstance.isCurrentInAbr}},{key:"updateAutoDefiDesc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=this._pluginInst,a=i.player,o=i.config,s=o.autoBitrateOpts||{},u=s.autoDefiText||"auto";a.emit("ABR_AUTO_DESC_CHANGE",u,t?void 0:e,r,n)}},{key:"updateAbrCacheData",value:function(){var e=this,t=this._pluginInst,r=t.player,n=t.config,i=t.playerConfig,a=n.autoBitrateOpts||{};if(i.definition.list.forEach((function(t){e.bitrateMap[t.bitrate]={url:t.url,definition:t.definition,definitionName:t.text},e.defiIdMap[t.definition]={bitrate:t.bitrate,definition:t.definition}})),this.isOpenAutoDefi,this.isOpenAutoDefi){var o=a.autoDefiText||"auto",s={definition:"è‡ªåŠ¨",bitrate:r.curDefinition.bitrate,text:o,url:"__auto__",selected:this.isPlayAutoDefi,name:"è‡ªåŠ¨",vwidth:r.curDefinition.vwidth,vheight:r.curDefinition.vheight};i.definition.list.push(s)}}},{key:"destroy",value:function(){this._pluginInst.player.off(ABR_EVENTS.ABR_CHANGE,this._onAbrChange),this._destroyAbr()}}]),e}();function _createSuper$d(e){var t=_isNativeReflectConstruct$d();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$d(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var STATES={INIT:0,AW_OK:11,AW_ERROR:12,LICENSE_OK:21,LICENSE_ERROR:22,PRELOAD_OK:31,CHECK_PRELOAD:32,PRELOAD_ERROR:33,META_OK:41,META_ERROR:42,MSE_OPEN:51,MSE_INIT:52,MSE_OPEN_ERROR:53,MSE_INIT_ERROR:54,MSE_ERROR:53,CORE_START:60,PLAY_INIT_CATCH:71,PLAY_INIT_OK:72},DESTROYED="DESTROYED",_playerPlayNext=null,_playerStartInit=null,_playerChangeDefinition=null,_playerSwitchUrl=null,Mp4EncryptPlayer=function(t){_inherits$4(a,t);var r,n,i=_createSuper$d(a);function a(t){var r;return _classCallCheck$4(this,a),_defineProperty$5(_assertThisInitialized$4(r=i.call(this,t)),"_replayHook",(function(e){"xgmse-video"===r.player.config.mediaType?r._onReplay():r.useVideoLoad||(r._startProgress(),r.player.currentTime=0,r._curLoadSegmentIdx=0,r.log("replay start load, segmentIdx",r._curLoadSegmentIdx),r._loadData(0,0),r.player.play())})),_defineProperty$5(_assertThisInitialized$4(r),"_retryHook",(function(){r.useVideoLoad=!0})),_defineProperty$5(_assertThisInitialized$4(r),"_playHook",(function(e){r._usePaused=!1})),_defineProperty$5(_assertThisInitialized$4(r),"_pauseHook",(function(e){r._usePaused=!0})),_defineProperty$5(_assertThisInitialized$4(r),"abrSwitchURL",function(){var e=_asyncToGenerator$1(regenerator.mark((function e(t){var n,i,a,o,s,u;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=_assertThisInitialized$4(r),i=n.playerConfig,a=i.definition.list,o=0,s=0;case 4:if(!(s<a.length)){e.next=11;break}if(t.definition!==a[s].definition){e.next=8;break}return o=s,e.abrupt("break",11);case 8:s++,e.next=4;break;case 11:u=r.player.curDefinition,r.changeDefinition(a[o],u,!0);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),_defineProperty$5(_assertThisInitialized$4(r),"_onMp4MetaReady",(function(t){var n=r.playerConfig.vid,i=r.preLoadData||{},a=r._checkCodecH265(t);if(r.changeState(STATES.META_OK,{is265:a?1:0}),!a&&t)try{r._initEME(r.mp4,t),r._initMse(r.mp4,t,i),r._initPromise.resolve()}catch(e){console.error("[Index] ".concat(n," _initMse error"),e),r._initPromise.reject(e)}else r._initPromise.reject(a)})),_defineProperty$5(_assertThisInitialized$4(r),"_onMp4Error",(function(e){var t=r.playerConfig.vid;r._initPromise?(r._initPromise.reject(e),r.changeState(STATES.META_ERROR,{c:e.errorCode})):(console.error("[Index] _errorHandle3",t,e),r._errorHandler(e))})),_defineProperty$5(_assertThisInitialized$4(r),"_onMp4Progress",(function(e){r.emit("progress_event",e)})),_defineProperty$5(_assertThisInitialized$4(r),"_onVideoTimeUpdate",(function(){r.useVideoLoad||null!==r._requestTimer||r._startProgress(),r.useVideoLoad&&r.checkIfCanPreload()})),_defineProperty$5(_assertThisInitialized$4(r),"_onBufferedReset",(function(e){r.mp4&&r.mp4.timeRange&&r.mp4.timeRange.forEach((function(e){e.downloaded=!1,e.isLoading=!1}))})),_defineProperty$5(_assertThisInitialized$4(r),"_onOnlineHandler",(function(){var e=_assertThisInitialized$4(r).config;r.log("online hasInit:",r._hasInited),r._hasInited?(r._hasStartProgressBack&&r._startProgress(),r._hasStartProgressBack=!1):r.src=e._mainURL})),_defineProperty$5(_assertThisInitialized$4(r),"_onOfflineHandler",(function(){r.log("offline"),r._hasStartProgress&&(r._stopProgress(),r._hasStartProgressBack=!0)})),_defineProperty$5(_assertThisInitialized$4(r),"_loadDataSuccess",(function(t){if(!r.isDestroy&&r.mse)try{t.initSeg&&(r.log("[player appendBuffer initSeg start] ,len, ",t.initSeg.byteLength),r.mse.appendBuffer(CONTENT_TYPES.VIDEO,t.initSeg).then((function(){r.log("player init seg updateend initSeg len,",t.initSeg.byteLength),r.changeState(STATES.MSE_INIT);var e=r.player.curDefinition,n={width:e.width||e.vwidth,height:e.height||e.vheight};r.player.emit("RESOLUTION_UPDATE",n),r.player.emit("initialUrl",e.url),r.mp4.useEME&&r.eme&&r.eme.emit("encrypted"),r.log("player appendBuffer initSeg end")}))),r.log("[loadFragment] loadDataSucccess ",t.context.range);var n=t.buffer,i=t.state,a=t.context;if(n&&r.mse&&n&&n.byteLength>0){r._appendBuffer(CONTENT_TYPES.VIDEO,n,a,i);var o=r.getDataBitRate(a.fragIndex);r.player.emit("addVideoBufferEnd",{start:Math.floor(a.startPts),end:a.endPts,bandwidth:o.bitrate})}}catch(e){r.changeState(STATES.MSE_INIT_ERROR),r.log("appendBuffer error",e);var s=new Errors$1(r.player,{errorType:"runtime",errorTypeCode:1002,errorCode:ERROR_CODES.mse,vid:r.player.config.vid,errorMessage:e.message,mediaError:{code:ERROR_CODES.mse,message:e.message}});r._errorHandler(s)}})),_defineProperty$5(_assertThisInitialized$4(r),"_loadDataFail",(function(e){r.isDestroy||(r.log("_errorHandle5",e),r._errorHandler(e))})),_defineProperty$5(_assertThisInitialized$4(r),"_onWaiting",(function(){var e=_assertThisInitialized$4(r).player;if(r.mp4){var t=e.currentTime;r.log("[onWaiting], currentTime, ",t)}})),_defineProperty$5(_assertThisInitialized$4(r),"_onEnded",(function(){r.log("[player.onEnded], stopProgress"),r.player&&r.off("waiting",r._onWaiting),r._stopProgress()})),_defineProperty$5(_assertThisInitialized$4(r),"_onReplay",(function(){var e=_assertThisInitialized$4(r),t=e.playerConfig,n=e.player;r._reset(),r._init(t.url).then((function(e){var t=e[0],i=e[1];n.video.src=i.url,r._startProgress(),r.mp4=t,r.mse=i,r.log("_replay play"),r.once("canplay",(function(){n.play(),r.on("waiting",r._onWaiting)}))}),(function(e){r.log("_errorHandler6",e),r._errorHandler(e)}))})),_defineProperty$5(_assertThisInitialized$4(r),"_onSeeking",(function(){var e=_assertThisInitialized$4(r).player,t=e.currentTime;if(r.log("[seekTime], curTime,",t),r.mp4&&r.mp4.meta){r.endofstream=!1;var n,i=e.bufferedPoint;i.end>0?(n=r.mp4.getFragmentIdx(i.end),r.log("[seeking in buffered range], seekTime ",t,",bufferRange,",i.start,"-",i.end)):(n=r.mp4.getFragmentIdx(t),r.log("[seekTime out buffer range], curTime,",t,", Idx,",n)),n<0&&(n=r._curLoadSegmentIdx),r.mp4._loadingMoov?r.mp4._seekIdxWhenLoadingMoov=n:r.mp4.MP4Loader&&r.mp4.MP4Loader.cancel(),r.mp4.resetFragmentLoadState(n),r._curLoadSegmentIdx=n,r._onTimeUpdate(),r._isEnded()}})),_defineProperty$5(_assertThisInitialized$4(r),"_onMp4Init",(function(){var e=_assertThisInitialized$4(r),t=e.player;e.config.mp4Init&&t.pause()})),r._pendingPromises=[],r._allInitPromise=new ProxyPromise,r._isInit=!1,r._isEventInit=!1,r.playerId=r.player._pluginInfoId,r.preloader=null,r.gapJumpInst=null,r.log("playerId",r.playerId),r._tickInSeconds=r.config.tickInSeconds,r.awManager=null,r._hasInited=!1,r._useVideoLoad=!1,r.mse=null,r.mp4=null,r.eme=null,r._isMseInit=!1,r._awPromise=null,r._corePromise=null,r._initPromise=null,r._hasStartProgress=!1,r._hasStartProgressBack=!1,r._maxBufferLength=r.config.maxBufferLength,r._minBufferLength=r.config.minBufferLength,r._maxPausedBufferLength=r.config.maxPausedBufferLength,r._curLoadSegmentIdx=0,r._abrService=null,r._finalError=null,r._checkRemoveBufferLastTime=util.nowTime(),r.states=[],r.preLoadData=null,r.forPreloadTimeCache=null,r._usePaused=!1,r.endofstream=!1,r.bufferEndTime=-1,window&&window.location.href.indexOf("playerInstance=true")>-1&&(void 0===window.mp4PlayerInstanceList&&(window.mp4PlayerInstanceList=[]),window.mp4PlayerInstanceList.push(r.player)),r}return _createClass$5(a,[{key:"afterCreate",value:function(){var e=this.playerConfig,t=this.config,r=this.player;t.width=e.width||0,t.height=e.height||0,e.vid=e.vid||t.vid,MSE$1.isSupported('video/mp4; codecs="avc1.64001E, mp4a.40.5"')&&(isEMESupported()||(t.useEME=!1),this.checkConfig(),t.onlyInit&&(e.autoplay=!1,e.videoInit=!1,this._hasStartProgress=!1,this._hasStartProgressBack=!1),e.useWaterLevel&&(!e.userGestureEventMiddleware&&(e.userGestureEventMiddleware=userGestureEventMiddleware),!e.videoEventMiddleware&&r.setEventsMiddleware(videoEventMiddleware)),this.gapJumpInst=new GapJump(this.player,this.playerConfig),this.preloader=new Mp4Preloader(this.config,this,this.bitRateAdapter),r.preloader=this.preloader,this._proxyPlayer(),this.initAwManager(),r.useHooks("replay",this._replayHook),r.useHooks("play",this._playHook),r.useHooks("pause",this._pauseHook),r.useHooks("retry",this._retryHook),r.video.addEventListener(CUSTOM_EVENTS.BUFFERED_RESET,this._onBufferedReset),this._bindNetworkStateChange(),this.on(TIME_UPDATE,this._onVideoTimeUpdate),this._startBufferCheck(),this._startUrlExpiredCheck(),r.mp4MseFlag=!0)}},{key:"_startUrlExpiredCheck",value:function(){var e=this,t=this.player.config;t.definition&&t.definition.list&&t.definition.list.length>0&&(this.urlExpireTimestamp=t.definition.list[0].url_expire||0,this.urlExpireTimestamp>0&&(this._urlExpireTimer=setInterval((function(){e._handleUrlExpire()}),1e3)))}},{key:"_startBufferCheck",value:function(){var e=this,t=this.player;this._bufferCheckTimer=setInterval((function(){if(t.video){for(var r=[],n=0,i=t.video.buffered.length;n<i;n++)r.push([t.video.buffered.start(n),t.video.buffered.end(n)]);r.toString()!==e.lastBuffer&&(e.lastBuffer=r.toString(),e._onBufferReachThreshold())}}),200)}},{key:"_onBufferReachThreshold",value:function(){var e=this.player,t=this.config;if(e.video){for(var r=e.video.buffered,n=0,i=0,a=0;a<r.length&&(n=r.start(a),i=r.end(a),!(n<=e.video.currentTime&&e.video.currentTime<=i));a++);i-e.video.currentTime>=t.bufferThreshold&&!this._hasTriggerBufferThreshold&&(this._hasTriggerBufferThreshold=!0,e.emit("BUFFER_THRESHOLD",i-e.video.currentTime))}}},{key:"checkConfig",value:function(){var e=this.playerConfig,t=this.config,r=e.defaultDefinition,n=e.defaultBitrate;if(!r){var i=this.playerConfig.definition;r=i&&i.defaultDefinition?i.defaultDefinition:t.definition}!n&&t.bitrate&&(n=t.bitrate),e.defaultDefinition=r,e.defaultBitrate=n}},{key:"beforePlayerInit",value:function(){var e=this.player,t=this;this._isInit||(BasePlugin.defineGetterOrSetter(e,{__url:{get:function(){return t.mse?t.mse.url:e.config.url},configurable:!0},downloadSpeed:{get:function(){return MP4$1.realTimeSpeed/8/1024},configurable:!0},playerVersion:{get:function(){return version$1},configurable:!0},menuCodeType:{get:function(){return t.mp4&&t.mp4.meta?t.mp4.meta.videoCodec:"avc"},configurable:!0},playerType:{get:function(){return"MP4"},configurable:!0},supportMenus:{get:function(){return{speed:e.mp4MseFlag,cdn:e.mp4MseFlag,resolution:e.mp4MseFlag}},configurable:!0},CDNUrl:{get:function(){return t.CDNUrl},configurable:!0},abrInstance:{get:function(){return t.abrInstance},configurable:!0}}),this._isInit=!0)}},{key:"destroy",value:function(){var e=this.player;this.preloader.cancelLoading(this.playerId),this._reset(),this._onDestroyWasm(),this.bitRateAdapter&&(this.bitRateAdapter.destroy(),this.bitRateAdapter=null),this.player.playNext=_playerPlayNext,this.player._startInit=_playerStartInit,this.player.changeDefinition=_playerChangeDefinition,this.player.switchURL=_playerSwitchUrl,this._unbindNetworkStateChange(),e.video&&e.video.removeEventListener(CUSTOM_EVENTS.BUFFERED_RESET,this._onBufferedReset),this._urlExpireTimer&&clearInterval(this._urlExpireTimer),this._bufferCheckTimer&&clearInterval(this._bufferCheckTimer)}},{key:"initAwManager",value:function(){var e=this,t=this.config;this.awManager||(this.awManager=new AwManager(t.cdnHost,t.cdnBucket));var r=new ProxyPromise;if(r.id="aw",this._awPromise=r,t.isEncrypt){var n=new WasmManager;n.push(this.awManager.init()),n.startup().then((function(){n.destroy(),r.resolve()})).catch((function(t){n.destroy(),t===AW_ERRORS.FETCH_ERROR?e._hasInited=!1:e._emitInitFail(t),r.reject()}))}else r.resolve()}},{key:"_proxyPlayer",value:function(){var e=this;"function"==typeof this.player.playNext&&(_playerPlayNext=this.player.playNext),this.player.playNext=function(){e.playNext.apply(e,arguments)},_playerStartInit=this.player._startInit,_playerSwitchUrl=this.player.switchURL,_playerChangeDefinition=this.player.changeDefinition,this.player._startInit=this.playerStartInit.bind(this),this.player.switchURL=this.switchURL.bind(this),this.player.changeDefinition=this.changeDefinition.bind(this)}},{key:"getInitBitrate",value:function(){var e=this,t=this.player,r=this.config,n=this.playerConfig,i=null;return t.definitionList&&t.definitionList.length>0&&(t.definitionList.map((function(t){var r=Mp4Preloader.generateUniqueKey({vid:n.vid,definition:t.definition||"",vtype:n.vtype,codecType:n.codecType});t.cacheKey=r,r&&!i&&e.preloader&&e.preloader.hasItemSameVid(r)&&((i=t).type="preload")})),i&&n.userSelectDefinition&&r.focusUserDefinition&&(console.log("[Index] getInitBitrate","preloadDefinition: ".concat(i.definition," userSelectDefinition:").concat(n.userSelectDefinition)),n.userSelectDefinition!==i.definition&&(i=null)),!i&&this.bitRateAdapter&&(i=this.getDefinitonFromAdapter(t.definitionList,n.userSelectDefinition))&&(i.type="bitRateAdapter")),i&&i.url||(i={url:n.url,definition:n.defaultDefinition,bitrate:n.defaultBitrate||0,type:"default",duration:n.duration||this.config.duration||0}),"default"!==i.type&&(this.playerConfig.url=i.url),i.networkSpeed=MP4$1.speed,i.fileSize=util.getFileSize(i.bitrate,n.duration),t.curDefinition=i,i}},{key:"_setPlayerSrc",value:function(e){var t=this.player;this._removeVideoSource(),"Array"===util$2.typeOf(e)?(t.video.removeAttribute("src"),!t._detachSourceEvents&&e.forEach((function(e){t.video.appendChild(util$2.createDom("source","",{src:"".concat(e.src),type:"".concat(e.type||"")}))})),t._attachSourceEvents(t.video,e),t.play()):(t.video.src=e,t.play()),t.mp4MseFlag=!1,t.emit("playertypechange")}},{key:"_removeVideoSource",value:function(e){var t=this.player,r=t.video.children;if(r.length>0)for(t._detachSourceEvents(t.video);r.length>0;)t.video.removeChild(r[0])}},{key:"_getBitrateByDefition",value:function(e){for(var t=this.playerConfig,r=0,n=0;n<t.definition.list.length;n++){var i=t.definition.list[n];i.definition===e&&(r=i.bitrate)}return r}},{key:"_getDefinitionItem",value:function(e){for(var t=this.playerConfig,r=0;r<t.definition.list.length;r++){var n=t.definition.list[r];if(n.definition===e)return n}return null}},{key:"_initDatas",value:function(){var e=this.player,t=this.playerConfig;if(t.definition.list.length>0&&(e.curDefinition||(e.curDefinition=t.definition.list[0]),e.curDefinition.vwidth||Object.assign(e.curDefinition,this._getDefinitionItem(e.curDefinition.definition)),this._abrService.updateAbrCacheData()),this._abrService&&this._abrService.isCurrentAutoDefi){var r=t.definition.list.length;e.curDefinition=t.definition.list[r-1]}for(var n=0;n<t.definition.list.length;n++){var i=t.definition.list[n];e.curDefinition.definition===i.definition?i.selected=!0:i.selected=!1}this.player.emit("resourceReady",t.definition.list);var a=e.curDefinition.bitrate;if(!a)for(var o=0;o<t.definition.list.length;o++){var s=t.definition.list[o];s.definition===e.curDefinition.definition&&(a=s.bitrate)}this._abrService.updateBitrate(a)}},{key:"_initAbrService",value:(n=_asyncToGenerator$1(regenerator.mark((function e(){var t;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.playerConfig,this._abrService=new AbrService(this,this.abrSwitchURL),e.next=4,this._abrService.init({video:t.definition.list.concat()});case 4:this._initDatas();case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_initMp4Kernel",value:function(){var t=this,r=this.playerConfig,n=this.config,i=new ProxyPromise;try{var a=this.getInitBitrate();if(this._initAbrService(),this.log("curDefinition",a),this.log("[_initMp4Kernel] ".concat(r.vid," curDefinition"),a),!this._handlerUrl(r.url))return i.reject(new Error("emptyUrl")),i;var o=[];o.push(this._getLicense()),o.push(this._checkPreloader()),Promise.all(o).then((function(e){t.isDestroy&&i.reject(new Error("destroy"));var r=null;if(e&&e.length>0&&e[1]&&(r=e[1].data),!r&&n.needPreloadCheck)t.useVideoLoad=!0,i.reject(new Error("no_preload"));else{var a=n._mainURL;t._initMp4(a,r)}})).catch((function(e){console.error(e),t.changeState(STATES.LICENSE_ERROR,{d:a.definition}),i.reject(e)}))}catch(e){i.reject(e)}return i}},{key:"playerStartInit",value:function(e){var t=this;if(!this.isDestroy){if(!e||"__auto__"===e||"anytext"===e){var r=this.playerConfig,n=r.definition;if(n&&n.list&&n.list.length>0&&n.defaultDefinition&&(n.list.map((function(e){e.definition===n.defaultDefinition&&(r.url=e.url,t.player.curDefinition=e)})),!r.url||"__auto__"===e||"anytext"===e)){var i=n.list[0];e=i.url,r.url=i.url,this.player.curDefinition=i}}if(this.useVideoLoad)_playerStartInit.call(this.player,e);else{this.player.mp4MseFlag=!0,this.bufferEndTime=-1,this._reset();var a=this.playerConfig.vid;this.changeState(STATES.INIT),this._awPromise.then((function(){if(!t.isDestroy){t.changeState(STATES.AW_OK);var r=t._initMp4Kernel();t._initPromise=r,t._addPendingPromise(t._initPromise),r.then((function(r){t.isDestroy||(t.log("[Index] _initMp4Kernel.then vid:".concat(a," isDestroy").concat(t.isDestroy),r,t.mse?t.mse.url:""),t.mse&&(e=t.mse.url),t._abrService&&t._abrService.isCurrentInAbr()&&(t._abrService.enable(),t._abrService.execute()),t.changeState(STATES.PLAY_INIT_OK),t._bindEvents(),t._startProgress())})).catch((function(r){var n=t._initPromise.isBreak;if(!t.isDestroy&&!n)if(console.error("_initMp4Kernel.catch: ".concat(a," isDestroy:").concat(t.isDestroy," _initPromise.isBreak:").concat(n),r),-499897!==r.errorCode){var i=r;i.errorCode||((i=new Errors$1(t.player,{errorType:"runtime",errorTypeCode:1002,errorCode:ERROR_CODES.other,vid:t.playerConfig.vid,errorMessage:r.message,mediaError:{code:ERROR_CODES.other,message:r.message}})).url=e),t.changeState(STATES.PLAY_INIT_CATCH,{c:i.errorCode,m:i.message}),t.player.vtype="MP4_1",t.player.emit("playCatch","dash1mp4",i)}else t._emitExpireEvent(r)})).finally((function(){if(t._initPromise){var r=t._initPromise.isBreak;t._initPromise&&t._removePendingPromise(t._initPromise),t._initPromise=null,t._usePaused&&(t.playerConfig.autoplay=!1),t.log("_initMp4Kernel.finally:isDestroy".concat(t.isDestroy," _initPromise.isBreak:").concat(r)),!t.isDestroy&&!r&&_playerStartInit.call(t.player,e)}}))}})).catch((function(r){t.log("_awPromise.error",r),t.changeState(STATES.AW_ERROR),!t.isDestroy&&_playerStartInit.call(t.player,e)}))}}}},{key:"playNext",value:function(e){var t=this.player;t.resetState(),this._useVideoLoad=!1,t.pause(),this._reset(),t.setConfig(e),this.log("[Index] playNext",e),t.play(),this.emit("logger_next")}},{key:"next",value:function(e){this.playNext(e)}},{key:"changeDefinition",value:function(e,t,r){var n=this,i=this.player,a=this.playerConfig,o=this.mp4;if(this.useVideoLoad)return"__auto__"===e.url&&(e.url=i.config.definition.list[0].url),void _playerChangeDefinition.call(this.player,e,t);var s="è‡ªåŠ¨"===e.definition||"auto"===e.definition;if(r)this.log("[ABR], ready to switch bitRate, ",e.bitrate);else{var u=!1;if(s)this._abrService.enable(),u=!0;else if(this._finalError&&(this._finalError=null),this._abrService.disable(),!e.bitrate||e.bitrate<=0)for(var c=0;c<a.definition.list.length;c++)e.definition===a.definition.list[c].definition&&(e.bitrate=a.definition.list[c].bitrate);i.emit(DEFINITION_CHANGE,{from:t,to:e}),setTimeout((function(){n._abrService.updateAutoDefiDesc(i.curDefinition.definition,!s)})),u&&(e=i.curDefinition),this.log("[ABR_cbs],switch bitRate, ",e.bitrate)}i.curDefinition=e;var l=i.definitionList.filter((function(e){return e.definition===i.curDefinition.definition}));if(l.length>0&&(e=l[0]),this.config.keyValue=e.keyValue,a.url=e.url,a.backupURL=e.backupURL,o){var d=0,h=!1;if(this._abrService.isCurrentInAbr()){var f=i.getBufferedRange(i.buffered2);d=f[1],this.log("[ABR],switch bufferRange, ",f)}else d=i.currentTime,h=!0;var p=o.getFragmentIdx(d);p<0&&(p=this._curLoadSegmentIdx),this.log("[ABR],switch point,",p,",startTime,",o.timeRange[p].startTime),h&&i.emit("definitionSwitchTime",o.timeRange[p].startTime+1),o&&(o.MP4Loader&&o.MP4Loader.cancel(),o._loadingMoov&&(o._loadingMoov=!1));var g=i.getBufferedRange(i.buffered);g[1]>0&&g[1]-i.currentTime>5&&!this._abrService.isCurrentInAbr()&&(console.log("remove",i.currentTime+5,g[1]),this.mse.clearEnqueAndRemoveBuffer(CONTENT_TYPES.VIDEO,i.currentTime+5,g[1])),o.resetFragmentLoadState(p),this._curLoadSegmentIdx=p,this.mp4&&this.mp4.changeBitRate(e);var y={width:e.width||e.vwidth,height:e.height||e.vheight};i.emit("RESOLUTION_UPDATE",y)}}},{key:"switchURL",value:function(e){if(this.useVideoLoad)_playerSwitchUrl.call(this.player,e);else{var t=this.player,r=this.playerConfig;this.config.keyValue=e.keyValue,r.url=e.url,r.backupURL=e.backupURL,t.currentTime=0,t.pause(),this.reset(),this._isMseInit=!1,this.eme=null,this._handlerUrl(e.url),t.video.removeAttribute("src"),this._removeVideoSource(),t.resetState()}}},{key:"_handlerUrl",value:function(e){var t,r=this.config,n=this.playerConfig;if(!e)return!1;var i=[];if("String"===util$2.typeOf(e))t=e,n.backupURL&&i.push(n.backupURL);else if("Array"===util$2.typeOf(e)&&e.length>0&&(t=e[0].src,e.length>1))for(var a=1;a<e.length;a++)i.push(e[a].src);return!(!t&&0===i.length)&&(r._mainURL=t,r._backupURL=i,!0)}},{key:"_bindEvents",value:function(){var e=this,t=this.config;this._isEventInit||(this.on("seeking",this._onSeeking),this.on("waiting",this._onWaiting),this.on("ended",this._onEnded),this.on("detectGap",(function(){t.gapDegrade&&t.useEME&&(t.useEME=!1,e._replay())}))),this._isEventInit=!0,this.once("playing",this._onMp4Init)}},{key:"_unbindEvents",value:function(){this.off("seeking",this._onSeeking),this.off("waiting",this._onWaiting),this.off("playing",this._onMp4Init),this.off("ended",this._onEnded),this._isEventInit=!1}},{key:"changeState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._pTime||(this._pTime=util.nowTime());var r=util.nowTime()-this._pTime,n=util.nowTime()-this._sTime;this.log(">>>changeState[".concat(e,"]"),r,n,t),this.states.push({state:e,t1:r,t2:n,data:t}),this._pTime=util.nowTime();var i=util.nowTime()-this._pTime;t.state=e,i&&(t.t=i)}},{key:"checkIfCanPreload",value:function(){var e=this.player,t=this.useVideoLoad,r=this.config,n=t?5:r.minBufferLength,i=e.currentTime+n;i=i>e.duration?e.duration:i;var a=(t?e.getBufferedRange(e.buffered):e.getBufferedRange(e.buffered2))[1]-i;e.currentTime>=n&&(a>0||Math.abs(a)<1)&&this.preloader&&this.preloader.checkCanPreloadNext()&&this.emit("PRELOAD_NEXT")}},{key:"_getLicense",value:function(){var e=this,t=this.config,r=t.vid,n=t.kid,i=t.secretKey,a=new ProxyPromise,o={method:"getLicense",success:0};if(n||i){var s=getKeyValue(r,n,i,this);s.id="licensePromise",this._addPendingPromise(s),s.then((function(t){e._removePendingPromise(s),t.clearKeys?e.config.drm=t:e.config.keyValue=t,o.success=1,a.resolve(o)})).catch((function(t){throw e.log("licensePromise reject"),o.success=0,o.error=t,a.reject(o),t}))}else o.success=0,a.resolve(o);return a}},{key:"_initMp4",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.player,n=this.config;if((!t||!t.meta)&&n.needPreloadCheck)return this.useVideoLoad=!0,void this._initPromise.reject(new Error("no_preload"));this.mp4&&(this.mp4.off("metaReady",this._onMp4MetaReady),this.mp4.off("error",this._onMp4Error),this.mp4.off(MP4_EVENTS.TASK_PROGRESS,this._onMp4Progress),this.mp4.destroy(),this.mp4=null);try{this.mp4=new MP4$1(e,r.curDefinition.bitrate,{xhrSetup:n.xhrSetup,chunkSize:n.preloadSize,loadSize:800,playerId:this.playerId,vid:n.vid,useUrlRange:n.useUrlRange},this,null,t,this.config._backupURL)}catch(i){this._errorHandler(i)}this.mp4.once("metaReady",this._onMp4MetaReady),this.mp4.on("error",this._onMp4Error),this.mp4.on(MP4_EVENTS.TASK_PROGRESS,this._onMp4Progress)}},{key:"_checkPreloader",value:function(){var e=this,t=this.playerConfig,r=new ProxyPromise,n={method:"checkPreloader",success:0,type:"error",cacheKey:""};this.changeState("CHECK_PRELOAD");var i=this.player.curDefinition;console.log("_checkPreloader",i);var a=i.cacheKey?i.cacheKey:Mp4Preloader.generateUniqueKey({vid:t.vid,definition:i.definition||"",vtype:t.vtype,codecType:t.codecType});return n.cacheKey=a,this.preloader&&a?this.preloader.getPreLoadData(a).then((function(t){console.log(">>>>check Preloader result",a,t),t?(e.preLoadData=t,e.emit("PRELOAD_INFO",e.preLoadData),n.success=1,n.data=t,e.changeState("PRELOAD_OK",{l:e.preLoadData.byteLength,ck:a}),r.resolve(n)):(e.preLoadData=null,e.changeState("PRELOAD_ERROR",{t:0}),n.success=0,n.error=new Error("none_preload"),r.resolve(n))})):(this.changeState("PRELOAD_ERROR",{t:2}),n.success=0,n.error=new Error("no_preloader"),r.resolve(n)),r}},{key:"_initEME",value:function(e,t){var r=this.player,n=this.config,i=t.videoCodec.indexOf("hvc1")>-1||t.encv&&t.encv.data_format.indexOf("hvc1")>-1;n.useEME=!(!1===n.useEME||i),t.kid&&n.keyValue?n.drm={clearKeys:_defineProperty$5({},t.kid,n.keyValue)}:!t.kid&&n.keyValue&&(n.useEME=!1);var a=n.drm;a&&a.clearKeys&&(this.eme=new EME(a),e.kids=a,this.log("config.useEME: ",n.useEME),e.useEME=e.meta.moov.useEME=n.useEME,e.useEME||(e.kidValue=a.clearKeys[Object.keys(a.clearKeys)[0]])),!n.keyValue&&!a||n.useEME||e.kidValue||(e.kidValue=n.keyValue||a),e.useEME&&this.eme&&(this.eme.setOptions('video/mp4; codecs="avc1.64001E"','audio/mp4; codecs="mp4a.40.2"'),this.eme.SetupEME(r.video))}},{key:"_initMse",value:function(e,t){var r,n=this,i=this.playerConfig,a=this.config,o=t.videoCodec.indexOf("hvc1")>-1||t.encv&&t.encv.data_format.indexOf("hvc1")>-1,s=!!t.videoCodec,u=!!t.audioCodec;r=s&&u?o?'video/mp4; codecs="hev1.1.6.L93.B0, mp4a.40.5"':'video/mp4; codecs="avc1.64001E, mp4a.40.5"':s?o?'video/mp4; codecs="hev1.1.6.L93.B0"':'video/mp4; codecs="avc1.64001E"':'video/mp4; codecs="mp4a.40.5"',this.mse&&(this.mse.destroy(),this.mse=null);var c=_defineProperty$5({},CONTENT_TYPES.VIDEO,{mimeType:"video/mp4",codec:r}),l=new MSE$1(i.mediaType,this.log,a);l.init(c),l.sourceOpenPromise().then((function(){n.changeState(STATES.MSE_OPEN),n._isMseInit=!0,n._loadData()})).catch((function(e){console.error("[Index] _initMse error",e),n.changeState(STATES.MSE_OPEN_ERROR);var t=new Errors$1(n.player,{errorType:"runtime",errorTypeCode:1002,errorCode:ERROR_CODES.mseOpen,errorMessage:e.message,vid:i.vid,mediaError:{code:ERROR_CODES.mseOpen,message:e.message}});n._errorHandler(t)})),this.mse=l}},{key:"_checkCodecH265",value:function(e){return!(!e||!(e.videoCodec.indexOf("hvc1")>-1||e.encv&&e.encv.data_format.indexOf("hvc1")>-1))&&new Errors$1(this.player,{errorType:"format",errorTypeCode:1005,errorCode:ERROR_CODES.h265Error,errorMessage:"h265_is_not_support",vid:this.playerConfig.vid,mediaError:{code:ERROR_CODES.h265Error,message:"h265_is_not_support"}})}},{key:"_bindNetworkStateChange",value:function(){window.addEventListener("online",this._onOnlineHandler),window.addEventListener("offline",this._onOfflineHandler)}},{key:"_unbindNetworkStateChange",value:function(){window.removeEventListener("online",this._onOnlineHandler),window.removeEventListener("offline",this._onOfflineHandler)}},{key:"_onSuperStart",value:function(e){var t=this,r=this.player;log("_onSuperStart:".concat(e),this.mse),r.video.src=e,this.once("canplay",(function(){r.play(),t.on("waiting",t._onWaiting)}))}},{key:"_appendBuffer",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,a=this.mse,o=this.player,s=this.config,u=s.vid;this.log("player appendBuffer start==>>>",u,n.range,t.byteLength,",fragIndex,",n.fragIndex,", state,",i),a.appendBuffer(e,t).then((function(){if(i&&n.fragIndex===r.mp4.timeRange.length-1){var e=o.buffered;r.bufferEndTime=e.end(e.length-1),r._isEnded(),r.log("player appendBuffer ended !!!==>>>",u,n.range,", fragIndex,",n.fragIndex,", bufferEndTime,",r.bufferEndTime,",meta_duration,",r.mp4.meta.duration)}r.log("player appendBuffer end==>>>",u,n.range,", fragIndex,",n.fragIndex,", state,",i),r.gapJumpInst&&r.gapJumpInst.onSegmentAppend(r.mp4.timeRange)})).catch((function(e){console.error("appendBuffer error",u,n.vid,n.range,e);var t=new Errors$1(r.player,{errorType:"runtime",errorTypeCode:1002,errorCode:ERROR_CODES.mseAppend,errorMessage:e.message,vid:o.config.vid,mediaError:{code:ERROR_CODES.mseAppend,message:e.message}});r._errorHandler(t)}))}},{key:"_loadData",value:(r=_asyncToGenerator$1(regenerator.mark((function e(){return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.onLine){e.next=2;break}return e.abrupt("return");case 2:if(this.mp4&&this._isMseInit){e.next=5;break}return this.log("loadData, player.mp4 null",this._isMseInit),e.abrupt("return");case 5:return e.prev=5,e.next=8,this.mp4.load(this._curLoadSegmentIdx,this._loadDataSuccess,this._loadDataFail);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),console.error("[Index] _loadData error",this.playerConfig.vid,e.t0);case 13:case"end":return e.stop()}}),e,this,[[5,10]])}))),function(){return r.apply(this,arguments)})},{key:"getDataBitRate",value:function(e){var t=this.mp4,r=this.playerConfig;if(!t)return 0;for(var n=t.getDataBitRate(e),i=r.definition.list,a=0,o=0;o<i.length;o++)if(i[o].bitrate===n){a=i[o];break}return a}},{key:"_loadStuckCheck",value:function(){var e=this,t=this.config,r=this.playerConfig,n=this.player;t.disableBufferBreakCheck||(n.currentTime-(this._lastCurrentTime||0)>.1||n.paused?1!==this._bufferBreakFlag&&2!==this._bufferBreakFlag||(this.log("è§†é¢‘æ²¡æœ‰å¡æ­»,é‡ç½®å¡æ­»æ ‡è®°"),this._bufferBreakFlag=0,clearTimeout(this._bufferBreakTimer),this._bufferBreakFlag=null):this._bufferBreakFlag||(this._bufferBreakFlag=1,this.log("å¡æ­»è®¡æ—¶å¼€å§‹! æŒç»­".concat(BUFFER_BREAK,"æ¯«ç§’åˆ™ç¡®è®¤å¡æ­»")),this._bufferBreakTimer=setTimeout((function(){e.isDestroy||(1===e._bufferBreakFlag&&(e._bufferBreakFlag=2,e.log("ç¡®è®¤å¡æ­»!!!"),e._errorHandler(new Errors$1(e.player,{errorType:"runtime",errorTypeCode:1002,errorCode:ERROR_CODES.waitTimeout,errorMessage:"wait_timeout",vid:r.vid,mediaError:{code:ERROR_CODES.waitTimeout}}))),e._bufferBreakTimer=null)}),BUFFER_BREAK)),this._lastCurrentTime=n.currentTime)}},{key:"_doubleCheckBuffer",value:function(e){var t=this.player;if(!(e.startTime>t.currentTime))return!0;var r=t.video.buffered;if(1===r.length)return!0;for(var n=!1,i=0;i<r.length;i++){var a=r.start(i)-.5,o=r.end(i)+.5;if(a<=e.startTime&&e.endTime<=o){n=!0;break}}return n}},{key:"_onTimeUpdate",value:function(){var e=this,t=this.mse,r=this.mp4,n=this.player;if(this.useVideoLoad)this.checkIfCanPreload();else if(t&&r&&r.canDownload){this._loadStuckCheck();var i=r.timeRange,a=n.getBufferedRange(n.buffered2);this._checkRemoveSourceBuffer(a,n.currentTime);var o=n.paused?n.currentTime+this._maxPausedBufferLength:n.currentTime+this._maxBufferLength;a[1]-o<0&&i.every((function(t,r){if(t.downloaded){if(e._doubleCheckBuffer(t))return!0;t.downloaded=!1,t.isLoading=!1,e.log("".concat(r," download state error, no buffer, download again"))}t.startTime-n.currentTime<e._maxBufferLength?(e._curLoadSegmentIdx=r,e.log("[onTimeUpdate],load index==>>>, ",r,",IdxTimeRange, ",t.startTime,"-",t.endTime,",buffEnd, ",a[1],",playCurTime,",n.currentTime,", bufferLen,",a[1]-n.currentTime),e._loadData(0,t[0])):e.log("[onTimeUpdate] not load",t.endTime,t.endTime-n.currentTime,e._maxBufferLength,",bufferRange,",a)})),this.checkIfCanPreload(),this._isEnded()}}},{key:"_reset",value:function(){this.states=[],this._sTime=util.nowTime(),this._hasInited=!1,this._usePaused=!1,this.useVideoLoad=!1,this._isMseInit=!1,this._finalError=null,this.endofstream=!1,this._curLoadSegmentIdx=0,this.preLoadData=null,this.forPreloadTimeCache=null,this._initPromise&&"pending"===this._initPromise.state&&this._initPromise.reject("DESTROYED"),this._stopProgress(),this.mp4&&(this.mp4.off("metaReady",this._onMp4MetaReady),this.mp4.off("error",this._onMp4Error),this.mp4.off(MP4_EVENTS.TASK_PROGRESS,this._onMp4Progress),this.mp4.destroy(),this.mp4=null),this.mse&&(this.mse.destroy(),this.mse=null),this._clearMediaKeys(),this._unloadVideo(),this._cancelPendingPromises(),this._abrService&&(this._abrService.destroy(),this._abrService=null)}},{key:"removeExpiredUrls",value:function(e,t,r){var n=this.playerConfig;if(-499897!==e.errorCode&&-499892!==e.errorCode||this._emitExpireEvent(e),(-499897===e.errorCode||-499892===e.errorCode)&&"Array"===util$2.typeOf(n.url)&&r.length>1){if(r.length<2)return r=r[0].src;for(var i=0;i<r.length;i++)if(r[i].src===t){r.splice(i,1),r.length<2&&(r=r[0].src);break}}return r}},{key:"_errorHandler",value:function(e){var t=this.player,r=this.playerConfig;if(t&&!this.useVideoLoad&&!this._finalError){var n=t.paused;e.vid=r.vid,e.preloadHit=this.preLoadData&&this.preLoadData.byteLength>0?1:0,e.preloadCached=this.preLoadData?this.preLoadData.duration:0,e=new Errors$1(this.player,e),this.log("_errorHandle","preState is ".concat(n),e),!e.url&&(e.url=t.src),this.player.vtype="MP4_2",this._finalError=e,e.errd&&"object"===_typeof$4(e.errd)&&this.mp4&&(e.errd.url=this.mp4.url),this.mp4&&(e.url=this.mp4.url),this.emit("DATA_REPORT",e),this.mp4&&this.mp4.url&&this.removeExpiredUrls(e,this.mp4.url,r.url),this.log("error task cancel"),this.mp4&&this.mp4.MP4Loader&&this.mp4.MP4Loader.cancel(),this._abrService&&this._abrService.disable(),this.mp4&&this.mp4.bufferCache&&this.mp4.bufferCache.clear(),this._startDegradedPlayback()}}},{key:"degradedPlayback",value:function(e){this.log("[out cal degradedPlayback],outErr,",e),e&&(this._finalError=e),this._startDegradedPlayback()}},{key:"_startDegradedPlayback",value:function(){var e=this;this.mp4&&(this.mp4.canDownload=!1);var t=this.player;this.endofstream=!1,this.player.emit("playCatch","dash2mp4",this._finalError),t.currentTime&&(this._currentTime=t.currentTime),this.player.pause(),this._reset(),this._replay=null,this.useVideoLoad=!0,this.config.drm?(this._finalError&&Object.keys(this.config.drm).map((function(t){e._finalError[t]=e.config.drm[t]})),this.emit("error",this._finalError)):(this._setPlayerSrc(t.config.url),this.once("canplay",(function(){e._currentTime&&(t.currentTime=e._currentTime),!t.paused&&t.play()})))}},{key:"_stopProgress",value:function(){this._hasStartProgress=!1,this._requestTimer&&(this._requestTimer.stop(),this._requestTimer=null),this._bufferBreakTimer&&(clearTimeout(this._bufferBreakTimer),this._bufferBreakTimer=null,this._bufferBreakFlag=void 0)}},{key:"_startProgress",value:function(){var e=this;this._hasStartProgress||(this._stopProgress(),this._requestTimer=new Timer((function(){e._requestTimer&&e._onTimeUpdate()})),this._requestTimer.tickEvery(this._tickInSeconds),this._hasStartProgress=!0)}},{key:"_unloadVideo",value:function(){var e=this.player;try{this.log("unloadVideo src ".concat(e.video.src)),e.video&&e.video.src&&(e.video.removeAttribute("src"),e.video.load())}catch(error){this.log("unloadVideo error",error)}}},{key:"_addPendingPromise",value:function(e){this._pendingPromises.push(e)}},{key:"_removePendingPromise",value:function(e){this.log("removePendingPromise",e.id);var t=this._pendingPromises.indexOf(e);t>-1&&this._pendingPromises.splice(t,1)}},{key:"_cancelPendingPromises",value:function(){this._pendingPromises.length>0&&this._pendingPromises.forEach((function(e){e.reject(DESTROYED)})),this._pendingPromises=[]}},{key:"_onMediaExpired",value:function(){this._stopProgress(),this.emit(CUSTOM_EVENTS.MEDIA_EXPIRED)}},{key:"_onDestroyWasm",value:function(){this.awManager&&(this.awManager.destroy(),this.awManager=null)}},{key:"_isEnded",value:function(){var e=this.player,t=this.mp4,r=e.bufferedPoint,n=r?r.end:0;return!this.endofstream&&this.bufferEndTime>0&&this.bufferEndTime-e.currentTime<.5&&(this.log("[check player isEnded],deal mse.endOfStream, currentTime,",e.currentTime,", bufferend,",n,", duration,",t.meta.duration),this.endofstream=!0,this.mse.endOfStream().catch((function(e){console.error(e)}))),!!(t&&t.meta&&t.meta.duration-e.currentTime<.5)&&(this._stopProgress(),!0)}},{key:"_clearMediaKeys",value:function(){var e=this.player;"function"==typeof e.video.setMediaKeys&&e.video.setMediaKeys(null).catch((function(){}))}},{key:"_checkRemoveSourceBuffer",value:function(e,t){if(!(util.nowTime()-this._checkRemoveBufferLastTime<=3e4||this.endofstream)){this._checkRemoveBufferLastTime=util.nowTime();var r=this.mse;if(e&&e[0]>=0&&t-e[0]>this.config.removeBufferLen){var n=t-10;this.log("[removeSourceBuffer], range==>>>",e[0],n),r.reuse(e[0],n)}}}},{key:"onMediaUpdate",value:function(e){var t=e.vid,r=e.kid,n=e.url,i=this.player,a=this.config;if(t===this.playerConfig.vid&&r===a.kid&&n){this.playerConfig.url=n,this._handlerUrl(n);var o=a._mainURL;return this._hasInited?this.mp4&&this.mp4.update(o):i.src=n,!0}return!1}},{key:"enableAutoBuffer",value:function(e){var t=this;if(e){if(!this._allInitPromise)return void this.log("player destroyed!!");this._allInitPromise.then((function(){t.log("enableAutoBuffer true"),t._startProgress()}))}else this._stopProgress(),this.log("enableAutoBuffer false")}},{key:"bitRateAdapter",get:function(){return this.player&&this.player.plugins&&this.config.needAutoBitrate?this.player.plugins.bitrateselector:null}},{key:"getDefinitonFromAdapter",value:function(e,t){if(!this.bitRateAdapter)return null;var r=this.bitRateAdapter;return r.getSuitableBitrate?r.getSuitableBitrate(e,t):r.bitRateAdapter?r.bitRateAdapter.select(e):null}},{key:"addPreloader",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.playerId=this.playerId,this.preloader?this.preloader.addPreloader(e):this.log("preloader has destroyed")}},{key:"addPreloaderList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.preloader?this.preloader.addPreloaderList(e,this.playerId):this.log("preloader has destroyed")}},{key:"log",value:function(e){for(var t=this.playerConfig,r=t&&t.vid?"[Index]".concat(t.vid," ").concat(e):"[Index] ".concat(e),n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];log.apply(void 0,[r].concat(i))}},{key:"_emitInitFail",value:function(e){this.log("initFail, reason:",e),this.emit(CUSTOM_EVENTS.INIT_FAIL,e)}},{key:"emitParseError",value:function(){this.log("parseError"),this.emit(CUSTOM_EVENTS.PARSE_ERROR)}},{key:"useVideoLoad",get:function(){return this._useVideoLoad},set:function(e){this._useVideoLoad=e}},{key:"ready",get:function(){return this._allInitPromise}},{key:"speed",get:function(){return parseInt(MP4$1.speed,10)}},{key:"version",get:function(){return version$1}},{key:"realTimeSpeed",get:function(){return parseInt(MP4$1.realTimeSpeed,10)}},{key:"preloadState",get:function(){return this.preloader&&this.preloader.loadingCount}},{key:"moovSize",get:function(){return 0}},{key:"isDestroy",get:function(){return!this.player}},{key:"cancelPreloadTask",value:function(){this.preloader&&this.preloader.cancelLoading(this.playerId)}},{key:"CDNUrl",get:function(){var e=this.playerConfig.url,t=document.createElement("a");return t.href=e,t.host}},{key:"abrInstance",get:function(){return this._abrService?this._abrService.abrInstance:null}},{key:"_handleUrlExpire",value:function(){var e=this,t=this.config,r=this.player,n=r.paused;(new Date).getTime()/1e3>=this.urlExpireTimestamp&&this.urlExpireTimestamp>0&&!n&&t.getServerTime&&(r.serverTimeDiffPromise=r.serverTimeDiffPromise||t.getServerTime().catch((function(){return 0})),r.serverTimeDiffPromise.then((function(t){if(t&&(r.serverTimeDiff=(new Date).getTime()/1e3-t),(new Date).getTime()/1e3>=e.urlExpireTimestamp+r.serverTimeDiff){e.urlExpireTimestamp=(new Date).getTime()/1e3+86400;var n=new NetWorkError("network",ERROR_CODES[403]);e._emitExpireEvent(n)}})))}},{key:"_emitExpireEvent",value:function(e){var t=this.player,r=(new Date).getTime()/1e3;this.emitExpireTimestamp?r-this.emitExpireTimestamp>300&&(this.emitExpireTimestamp=r,t.emit("MEDIA_EXPIRED",e)):(this.emitExpireTimestamp=r,t.emit("MEDIA_EXPIRED",e))}}],[{key:"registerPreloader",value:function(e,t){e.vtype=VTYPES.MP4,Mp4Preloader.BitRateAdapter=t,new Mp4Preloader(e,this)}},{key:"pluginName",get:function(){return"Mp4EncryptPlayer"}},{key:"defaultConfig",get:function(){return{onlyInit:!1,useWaterLevel:!1,maxBufferLength:10,maxPausedBufferLength:5,minBufferLength:5,preloadTime:0,tickInSeconds:.2,preloadMaxCacheCount:0,getLicenseUrl:"",xhrSetup:{},retryCount:1,retryDelay:1e3,preloadCacheType:1,mp4Init:!1,needPreloadRangeList:!1,cdnHost:"",cdnBucket:"",isEncrypt:!1,needPreloadCheck:!1,needAutoBitrate:!0,keyValue:null,drm:null,removeBufferLen:40,focusUserDefinition:!1,resumePlayWaterLevel:2,waitJampBufferMaxCnt:3,useGapJump:!1,bufferThreshold:10,vtype:VTYPES.MP4}}},{key:"speed",get:function(){return MP4$1.speed}},{key:"realTimeSpeed",get:function(){return MP4$1.realTimeSpeed}},{key:"version",get:function(){return version$1}}]),a}(BasePlugin);Mp4EncryptPlayer.isSupported=isSupported,Mp4EncryptPlayer.isEMESupported=isEMESupported,Mp4EncryptPlayer.isSupportedWithXgmse=isSupportedWithXgmse,Mp4EncryptPlayer.isMediaSourceSupported=isMediaSourceSupported,Mp4EncryptPlayer.isWebAssemblySupported=isWebAssemblySupported,Mp4EncryptPlayer.getPlayLicenses=getPlayLicenses,Mp4EncryptPlayer.CUSTOM_EVENTS=CUSTOM_EVENTS,Mp4EncryptPlayer.Mp4Preloader=Mp4Preloader;var EVENTS={MENU_REPORT:"MENU_REPORT",MENU_LOG:"MENU_LOG"},INFO_TYPES={VID:5,TYPE:10,CODECS:20,SPEED:30,BUFFER:40,PLAY_QUALITY:50,SCHEME:60,RESOLUTION:70,VIEWPORT:80,VOLUME:90,CDN:100,P2P:110,PLAYER_VERSION:120},LOG_TYPES={MENU:0,INTERACT:1,CONTEXTMENU:2},MENU_TYPES={STATS:0,REPORT:1},INTERACT_TYPES={CLOSE:0,COPY:1},CONTEXTMENU_TYPES={SHOW:0,HIDE:1},LOG_EVENTS={STATS:"STATS",REPORT:"REPORT",CLOSE:"CLOSE",COPY:"COPY",CONTEXTMENU_SHOW:"CONTEXTMENU_SHOW",CONTEXTMENU_HIDE:"CONTEXTMENU_HIDE"},events=Object.freeze(Object.defineProperty({__proto__:null,CONTEXTMENU_TYPES:CONTEXTMENU_TYPES,EVENTS:EVENTS,INFO_TYPES:INFO_TYPES,INTERACT_TYPES:INTERACT_TYPES,LOG_EVENTS:LOG_EVENTS,LOG_TYPES:LOG_TYPES,MENU_TYPES:MENU_TYPES},Symbol.toStringTag,{value:"Module"})),_cn,_en;function _createSuper$c(e){var t=_isNativeReflectConstruct$c();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var LANG_CONFIGS={cn:(_cn={},_defineProperty$5(_cn,INFO_TYPES.VID,"VID"),_defineProperty$5(_cn,INFO_TYPES.TYPE,"ç±»åž‹"),_defineProperty$5(_cn,INFO_TYPES.CODECS,"ç¼–ç "),_defineProperty$5(_cn,INFO_TYPES.SPEED,"åŠ è½½é€Ÿåº¦"),_defineProperty$5(_cn,INFO_TYPES.BUFFER,"ç¼“å†²æ—¶é•¿"),_defineProperty$5(_cn,INFO_TYPES.PLAY_QUALITY,"ä¸¢å¸§çŽ‡"),_defineProperty$5(_cn,INFO_TYPES.SCHEME,"è§†é¢‘åè®®"),_defineProperty$5(_cn,INFO_TYPES.RESOLUTION,"åˆ†è¾¨çŽ‡"),_defineProperty$5(_cn,INFO_TYPES.VIEWPORT,"è§†å›¾å°ºå¯¸"),_defineProperty$5(_cn,INFO_TYPES.VOLUME,"éŸ³é‡å¤§å°"),_defineProperty$5(_cn,INFO_TYPES.CDN,"CDN"),_defineProperty$5(_cn,INFO_TYPES.P2P,"P2P"),_defineProperty$5(_cn,INFO_TYPES.PLAYER_VERSION,"æ’­æ”¾å™¨ç‰ˆæœ¬"),_cn),en:(_en={},_defineProperty$5(_en,INFO_TYPES.VID,"Video ID"),_defineProperty$5(_en,INFO_TYPES.TYPE,"Video Type"),_defineProperty$5(_en,INFO_TYPES.CODECS,"Codecs"),_defineProperty$5(_en,INFO_TYPES.SPEED,"Connection Speed"),_defineProperty$5(_en,INFO_TYPES.BUFFER,"Buffer Health"),_defineProperty$5(_en,INFO_TYPES.PLAY_QUALITY,"Dropped Frames"),_defineProperty$5(_en,INFO_TYPES.SCHEME,"Protocol"),_defineProperty$5(_en,INFO_TYPES.RESOLUTION,"Res"),_defineProperty$5(_en,INFO_TYPES.VIEWPORT,"Viewport"),_defineProperty$5(_en,INFO_TYPES.VOLUME,"Volume"),_defineProperty$5(_en,INFO_TYPES.CDN,"CDN"),_defineProperty$5(_en,INFO_TYPES.P2P,"P2P"),_defineProperty$5(_en,INFO_TYPES.PLAYER_VERSION,"Player Version"),_en)},MenuPlugin=function(e){_inherits$4(r,e);var t=_createSuper$c(r);function r(){return _classCallCheck$4(this,r),t.apply(this,arguments)}return _createClass$5(r,[{key:"afterCreate",value:function(){}},{key:"onPluginsReady",value:function(){var e=this.player.plugins.stats;this.menuInst=new Menu(this.player,this.config||{},e)}}],[{key:"pluginName",get:function(){return"MenuPlugin"}},{key:"defaultConfig",get:function(){return{enableDebug:!0}}}]),r}(BasePlugin),ReportIcon='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.71429 5C5.3198 5 5 5.3198 5 5.71429V14.2857C5 14.6802 5.3198 15 5.71429 15H14.2857C14.6802 15 15 14.6802 15 14.2857V10C15 9.44772 15.4477 9 16 9C16.5523 9 17 9.44772 17 10V14.2857C17 15.7848 15.7848 17 14.2857 17H5.71429C4.21523 17 3 15.7848 3 14.2857V5.71429C3 4.21523 4.21523 3 5.71429 3H10C10.5523 3 11 3.44772 11 4C11 4.55228 10.5523 5 10 5H5.71429Z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M16.7071 3.29289C17.0976 3.68342 17.0976 4.31658 16.7071 4.70711L10.7071 10.7071C10.3166 11.0976 9.68342 11.0976 9.29289 10.7071C8.90237 10.3166 8.90237 9.68342 9.29289 9.29289L15.2929 3.29289C15.6834 2.90237 16.3166 2.90237 16.7071 3.29289Z" fill="currentColor"/></svg>',StatsIcon='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 10C9 9.44771 9.44771 9 10 9C10.5523 9 11 9.44772 11 10V13C11 13.5523 10.5523 14 10 14C9.44771 14 9 13.5523 9 13V10Z" fill="currentColor"/><path d="M10 6C9.44771 6 9 6.44772 9 7C9 7.55228 9.44771 8 10 8C10.5523 8 11 7.55228 11 7C11 6.44772 10.5523 6 10 6Z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M18 10C18 14.4183 14.4183 18 10 18C5.58172 18 2 14.4183 2 10C2 5.58172 5.58172 2 10 2C14.4183 2 18 5.58172 18 10ZM10 16C13.3137 16 16 13.3137 16 10C16 6.68629 13.3137 4 10 4C6.68629 4 4 6.68629 4 10C4 13.3137 6.68629 16 10 16Z" fill="currentColor"/></svg>',CloseIcon$1='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16.1231 4.08053C16.5136 4.47105 16.5136 5.10422 16.1231 5.49474L11.453 10.1648L16.1231 14.8349C16.5136 15.2254 16.5136 15.8586 16.1231 16.2491C15.7326 16.6397 15.0994 16.6397 14.7089 16.2491L10.0388 11.579L5.36873 16.2491C4.9782 16.6397 4.34504 16.6397 3.95451 16.2491C3.56399 15.8586 3.56399 15.2254 3.95451 14.8349L8.6246 10.1648L3.95451 5.49474C3.56399 5.10422 3.56399 4.47105 3.95451 4.08053C4.34504 3.69001 4.9782 3.69001 5.36873 4.08053L10.0388 8.75061L14.7089 4.08053C15.0994 3.69 15.7326 3.69 16.1231 4.08053Z" fill="currentColor"/></svg>',CopyIcon='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6 3C5.44772 3 5 3.44772 5 4C5 4.55228 5.44772 5 6 5H13.5C14.3284 5 15 5.67157 15 6.5V14C15 14.5523 15.4477 15 16 15C16.5523 15 17 14.5523 17 14V6.5C17 4.567 15.433 3 13.5 3H6ZM4 8H12V16H4L4 8ZM2 8C2 6.89543 2.89543 6 4 6H12C13.1046 6 14 6.89543 14 8V16C14 17.1046 13.1046 18 12 18H4C2.89543 18 2 17.1046 2 16V8ZM5.75 9.5C5.33579 9.5 5 9.83579 5 10.25C5 10.6642 5.33579 11 5.75 11H10.25C10.6642 11 11 10.6642 11 10.25C11 9.83579 10.6642 9.5 10.25 9.5H5.75ZM5 13.75C5 13.3358 5.33579 13 5.75 13H10.25C10.6642 13 11 13.3358 11 13.75C11 14.1642 10.6642 14.5 10.25 14.5H5.75C5.33579 14.5 5 14.1642 5 13.75Z" fill="currentColor"/></g></svg>',Menu=function(){function e(t,r,n){_classCallCheck$4(this,e),this.player=t,this.options=r||{},this.statsPlugin=n;var i={report:ReportIcon,stats:StatsIcon,close:CloseIcon$1,copy:CopyIcon},a=Object.assign({},i,this.options.icons);this.options.icons=a,this.playerInstance="dash_"+(new Date).getTime(),window[this.playerInstance]=this.player,this.menuItems=[{name:"è§†é¢‘ç»Ÿè®¡ä¿¡æ¯",handler:this.showPanelInfo.bind(this),type:MENU_TYPES.STATS,icon:a.stats,eventName:LOG_EVENTS.STATS},{name:"æ’­æ”¾é—®é¢˜åé¦ˆ",handler:this._handleReport.bind(this),type:MENU_TYPES.REPORT,icon:a.report,eventName:LOG_EVENTS.REPORT}],this.playerHandler=[{evt:"RESOLUTION_UPDATE",handler:this._resolutionUpdate.bind(this)},{evt:"menusegment",handler:this._recordLastSegment.bind(this)},{evt:"resourceReady",handler:this._startup.bind(this)},{evt:"canplay",handler:this._startup.bind(this)},{evt:"ended",handler:this.destroyDOM.bind(this)},{evt:"destroy",handler:this.destroy.bind(this)},{evt:"playertypechange",handler:this.destroyDOM.bind(this)},{evt:"codecsupdate",handler:this._codecsUpdate.bind(this)}];for(var o=0;o<this.playerHandler.length;o++){var s=this.playerHandler[o],u=s.evt,c=s.handler;this.player.on(u,c)}this.debugInfo={ua:navigator.userAgent,version:this.player.playerVersion},this._pollTimer=null,this.hasInitDOM=!1,this._cacheMap={},this.menuHandler=this._menuHandler.bind(this),this.munuHideHandler=this._munuHideHandler.bind(this),this.rootClickHandler=this._rootClickHandler.bind(this),this._initDatas()}return _createClass$5(e,[{key:"_reset",value:function(){this.hasInitDOM=!1,this._cacheMap={},this._lastSegment=null}},{key:"_noop",value:function(){}},{key:"_recordLastSegment",value:function(e){this._lastSegment=e}},{key:"_resolutionUpdate",value:function(e){if(!this._cacheUpdate(INFO_TYPES.RESOLUTION)){var t=this.infoItems[INFO_TYPES.RESOLUTION];e?(t.value=e,this.updateInfoItem(t)):(t.hide=!0,this.createPanelInfo())}}},{key:"_codecsUpdate",value:function(e){if(!this._cacheUpdate(INFO_TYPES.CODECS)){var t=this.infoItems[INFO_TYPES.CODECS];t.value=e,this.updateInfoItem(t)}}},{key:"_cacheUpdate",value:function(e){return!this.hasInitDOM&&(this._cacheMap[e]=!0,!0)}},{key:"_handleReport",value:function(){for(var e=this.player.video.readyState,t=this.player.video.buffered,r=[],n=0;n<t.length;n++){var i=t.start(n),a=t.end(n);r.push({start:i,end:a})}var o={readyState:e,curTime:this.player.video.currentTime,err:this.player.video.error||-1,buffer:r},s=Object.assign({debug_date:new Date,type:this.type},this.debugInfo,{videoInfo:o});this._lastSegment&&(s.segment=this._lastSegment),this.options.enableDebug&&this.statsPlugin&&(s.stats=this.statsPlugin.getStats()),this.player.emit(EVENTS.MENU_REPORT,s)}},{key:"_startup",value:function(){if(!this.hasInitDOM){this.type=this.player.currentFormat,this._initDatas(),this._initDOM();for(var e=Object.keys(this._cacheMap),t=0;t<e.length;t++){var r=e[t],n=this.infoItems[r];this.updateInfoItem(n,!0)}}}},{key:"_initDatas",value:function(){var e;this.parentNode=this.player.root,this._isPlayQualitySupported=this.player.video&&"function"==typeof this.player.video.getVideoPlaybackQuality;var t=this.player.playerType,r=LANG_CONFIGS.cn,n=this.options.lang||"cn";this.langConfig=this.options.langConfig||LANG_CONFIGS[n]||r,this.infoItems=(_defineProperty$5(e={},INFO_TYPES.VID,{name:"VID",value:this.player.config.vid,render:renderPlainText,hide:!this.player.config.vid,key:"vid"}),_defineProperty$5(e,INFO_TYPES.TYPE,{name:"ç±»åž‹",value:t,render:renderPlainText,key:"player_type"}),_defineProperty$5(e,INFO_TYPES.CODECS,{name:"ç¼–ç ",value:this.player.menuCodeType,render:renderPlainText,key:"menuCodeType",hide:!this.player.menuCodeType}),_defineProperty$5(e,INFO_TYPES.SPEED,{name:"åŠ è½½é€Ÿåº¦",value:0,render:renderPlainText,posfix:" KB/s",hide:!this._isMenusHide("speed"),key:"speed"}),_defineProperty$5(e,INFO_TYPES.BUFFER,{name:"ç¼“å†²æ—¶é•¿",value:0,render:renderPlainText,posfix:"s",key:"buffer"}),_defineProperty$5(e,INFO_TYPES.PLAY_QUALITY,{name:"ä¸¢å¸§çŽ‡",value:{droppedVideoFrames:0,totalVideoFrames:0},render:renderPlayQuality,hide:null===this.player.video.getVideoPlaybackQuality,key:"frames_info"}),_defineProperty$5(e,INFO_TYPES.SCHEME,{name:"è§†é¢‘åè®®",value:"HTTPS",render:renderPlainText,key:"scheme"}),_defineProperty$5(e,INFO_TYPES.CDN,{name:"CDN",value:this.player.CDNUrl?this.player.CDNUrl:"false",render:renderPlainText,hide:!this._isMenusHide("cdn"),key:"CDN"}),_defineProperty$5(e,INFO_TYPES.P2P,{name:"P2P",value:"false",render:renderPlainText,hide:!0,key:"p2p"}),_defineProperty$5(e,INFO_TYPES.RESOLUTION,{name:"åˆ†è¾¨çŽ‡",value:{width:0,height:0,fps:void 0},render:renderResolution,hide:!this._isMenusHide("resolution"),key:"resolution"}),_defineProperty$5(e,INFO_TYPES.VIEWPORT,{name:"è§†å›¾å°ºå¯¸",value:{width:0,height:0},render:renderResolution,key:"viewport"}),_defineProperty$5(e,INFO_TYPES.VOLUME,{name:"éŸ³é‡å¤§å°",value:(100*this.player.config.volume).toFixed(0)+"%",render:renderPlainText,key:"volume"}),_defineProperty$5(e,INFO_TYPES.PLAYER_VERSION,{name:"æ’­æ”¾å™¨ç‰ˆæœ¬",value:this.player.playerVersion,render:renderPlainText,key:"player_version"}),e);for(var i=Object.keys(this.infoItems),a=0;a<i.length;a++){var o=i[a];this.infoItems[o].type=o}for(var s=this.options.infoItems||[],u=0;u<s.length;u++){var c=s[u];c.name&&c.type&&c.key?(c.render&&isFunction(c.render)||(c.render=renderPlainText),this.infoItems[c.type]=c):warn("".concat(c.name))}}},{key:"_isMenusHide",value:function(e){return!0===(this.player.supportMenus||{})[e]}},{key:"renderItemByType",value:function(e,t){var r=this.infoItems[e];r?(r.value=t,this._cacheUpdate(e)||this.updateInfoItem(r)):warn("".concat(e," item null"))}},{key:"_initDOM",value:function(){if(this.parentNode&&util$2){this.hasInitDOM=!0;var e=document.createDocumentFragment(),t=document.createElement("xg-menu");util$2.addClass(t,"xg-menu"),this.rightMenu=t;for(var r=this.menuItems.filter((function(e){return!e.hide})),n=0;n<r.length;n++)e.appendChild(this.createMenuItem(r[n]));t.appendChild(e),this.toggle(this.rightMenu,!1),this.parentNode.appendChild(t),this.parentNode.addEventListener("contextmenu",this.menuHandler,!1),document.addEventListener("click",this.munuHideHandler,!1),this.parentNode.addEventListener("click",this.rootClickHandler,!0),this.createPanelInfo(),this.bindEvents(),this.tick()}}},{key:"_menuHandler",value:function(e){if(e.preventDefault(),e.stopPropagation(),this.isPIPMode())return!1;var t=this.getOffset(),r=e.clientX-t.x+document.body.scrollLeft+document.documentElement.scrollLeft,n=e.clientY-t.y+document.body.scrollTop+document.documentElement.scrollTop,i=this.parentNode.clientWidth,a=this.parentNode.clientHeight;this.toggle(this.rightMenu,!0);var o=this.rightMenu.offsetWidth,s=this.rightMenu.offsetHeight,u=r+o>i?i-o:r,c=n+s>a?a-s:n;this.rightMenu.style.left=u+"px",this.rightMenu.style.top=c+"px",this.emitLog(LOG_TYPES.CONTEXTMENU,CONTEXTMENU_TYPES.SHOW,LOG_EVENTS.CONTEXTMENU_SHOW)}},{key:"getOffset",value:function(){for(var e=this.parentNode,t=0,r=0;e&&!Number.isNaN(e.offsetLeft)&&!Number.isNaN(e.offsetTop);)t+=e.offsetLeft-e.scrollLeft,r+=e.offsetTop-e.scrollTop,e=e.offsetParent;return{x:t,y:r}}},{key:"_munuHideHandler",value:function(){this.rightMenu&&"block"===this.rightMenu.style.display&&this.emitLog(LOG_TYPES.CONTEXTMENU,CONTEXTMENU_TYPES.HIDE,LOG_EVENTS.CONTEXTMENU_HIDE),this.toggle(this.rightMenu,!1)}},{key:"_rootClickHandler",value:function(e){"block"===this.rightMenu.style.display&&e.target===this.player.video&&(e.stopPropagation(),e.preventDefault(),this._munuHideHandler())}},{key:"tick",value:function(){var e=this;this._pollTimer=setTimeout((function(){clearTimeout(e._pollTimer),e._poll(),e.tick(),e.isPIPMode()&&(e.toggle(e.rightMenu,!1),e.toggle(e.panelInfo,!1))}),500)}},{key:"_poll",value:function(){var e=this.bufferLength,t=this.infoItems[INFO_TYPES.BUFFER];if(t.value=e,this.updateInfoItem(t),this.player.video.getVideoPlaybackQuality){var r=this.player.video.getVideoPlaybackQuality(),n=this.infoItems[INFO_TYPES.PLAY_QUALITY];n.value={totalVideoFrames:r.totalVideoFrames,droppedVideoFrames:r.droppedVideoFrames},this.updateInfoItem(n)}var i=this.infoItems[INFO_TYPES.SPEED];if(!i.hide){var a=Math.floor(this.player.downloadSpeed);i.value=a,this.updateInfoItem(i)}}},{key:"bindEvents",value:function(){var e=this,t=this.player.video;this.handleVolumeChange=this._handleVolumeChange.bind(this),t.addEventListener("volumechange",this.handleVolumeChange);t.addEventListener("DOMNodeInserted",(function r(){t.removeEventListener("DOMNodeInserted",r),e._onWinElemSizeChange()})),this.onWinSizeChange=debounce$1(this._onWinElemSizeChange.bind(this),1e3,!1),window.addEventListener("resize",this.onWinSizeChange),e._onWinElemSizeChange()}},{key:"_onWinElemSizeChange",value:function(){if(this.player&&this.player.video){var e=this.player.video.getBoundingClientRect(),t=this.infoItems[INFO_TYPES.VIEWPORT];if(t.value={width:Math.floor(e.width),height:Math.floor(e.height)},this._cacheUpdate(INFO_TYPES.VIEWPORT))return;this.updateInfoItem(t)}}},{key:"_handleVolumeChange",value:function(){var e=this.infoItems[INFO_TYPES.VOLUME];e.value=(100*this.player.video.volume).toFixed(0)+"%",this._cacheUpdate(INFO_TYPES.VOLUME)||this.updateInfoItem(e)}},{key:"createMenuItem",value:function(e){var t=this,r=document.createElement("div");if(r.classList.add("v-menu-item"),e.clsName&&r.classList.add(e.clsName),e.icon){var n=document.createElement("div");util$2.addClass(n,"menu-item-icon"),n.innerHTML=e.icon,r.appendChild(n)}var i=document.createElement("div");return util$2.addClass(i,"menu-item-content"),i.textContent=e.name,r.appendChild(i),!1!==r.clickable&&r.addEventListener("click",(function(r){r.stopPropagation(),r.preventDefault(),t.toggle(t.rightMenu,!1),e.handler(),t.emitLog(LOG_TYPES.MENU,e.type,e.eventName)})),r}},{key:"createIconBtn",value:function(e,t,r,n){var i=document.createElement("div");return util$2.addClass(i,e),i.innerHTML=t+"<div class='svg-hover'>".concat(r,"</div>"),n.appendChild(i),i}},{key:"createPanelInfo",value:function(){var e=this,t=document.createElement("xg-panel-info");util$2.addClass(t,"xg-panel-info"),this.createIconBtn("xg-info-close xg-interact-icon",this.options.icons.close,"å…³é—­",t).addEventListener("click",(function(){e.toggle(t,!1),e.panelVisible=!1,e.emitLog(LOG_TYPES.INTERACT,INTERACT_TYPES.CLOSE,LOG_EVENTS.CLOSE)})),this.createIconBtn("xg-info-copy xg-interact-icon",this.options.icons.copy,"å¤åˆ¶",t).addEventListener("click",(function(){for(var t=Object.values(e.infoItems).filter((function(e){return!e.hide})),r={},n=0;n<t.length;n++){var i=t[n],a=i.key,o=void 0;o=e.options.connectPrefix&&i.posfix?"".concat(i.value).concat(i.posfix):i.value,r[a]=o}e.options.enableDebug&&e.statsPlugin&&Object.assign(r,{stats:e.statsPlugin.getStats()}),e.copyToClipboard(JSON.stringify(r)),e.emitLog(LOG_TYPES.INTERACT,INTERACT_TYPES.COPY,LOG_EVENTS.COPY)}));var r=document.createElement("ul");util$2.addClass(r,"xg-panel-detail");for(var n=Object.values(this.infoItems).filter((function(e){return!e.hide})),i=document.createDocumentFragment(),a=0;a<n.length;a++){var o=this.createInfoItem(n[a]);i.appendChild(o)}r.appendChild(i),t.appendChild(r),this.panelInfo=t,this.player.root.appendChild(t)}},{key:"createInfoItem",value:function(e){var t=document.createElement("li");return e.elem=t,this.updateInfoItem(e),t}},{key:"showPanelInfo",value:function(){this.toggle(this.panelInfo,!0),this.panelVisible=!0;for(var e=Object.values(this.infoItems).filter((function(e){return!e.hide})),t=0;t<e.length;t++)this.updateInfoItem(e[t])}},{key:"copyToClipboard",value:function(e){var t=document.createElement("textarea");t.style.height="0px",t.style.width="1px",document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}},{key:"updateInfoItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.panelVisible||t){var r=e.elem;removeAllChildren(r);var n=document.createElement("label"),i=this.langConfig[e.type]||e.name;n.textContent=i+"",util$2.addClass(n,"xg-item-label"),r.appendChild(n);var a=document.createElement("span"),o=e.ctx||null,s=e.render.call(o,e.value);s instanceof Element?a.appendChild(s):a.textContent="".concat(s).concat(e.posfix?e.posfix:""),r.appendChild(a)}}},{key:"toggle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&(e.style.display=t?"block":"none")}},{key:"bufferLength",get:function(){var e=this.player.getBufferedRange(),t=this.player.video.currentTime,r=e[1]-Math.max(e[0],t);return r=Math.max(0,r).toFixed(2),parseFloat(r)}},{key:"destroyDOM",value:function(){this.parentNode.removeEventListener("contextmenu",this.menuHandler),document.removeEventListener("click",this.munuHideHandler,!1),this.parentNode.removeEventListener("click",this.rootClickHandler,!0),this._reset(),this.removeElement(this.rightMenu),this.removeElement(this.panelInfo),this.rightMenu=null,this.panelInfo=null,this._pollTimer&&clearTimeout(this._pollTimer)}},{key:"destroy",value:function(){this.destroyDOM(),this.destroyEvents()}},{key:"destroyEvents",value:function(){for(var e=0;e<this.playerHandler.length;e++){var t=this.playerHandler[e],r=t.evt,n=t.handler;this.player.off(r,n)}window.removeEventListener("resize",this.onWinSizeChange)}},{key:"removeElement",value:function(e){e&&e.parentNode&&e.parentNode.removeChild(e)}},{key:"isPIPMode",value:function(){return util$2.hasClass(this.parentNode,"xgplayer-pip-active")}},{key:"emitLog",value:function(e,t,r){this.player.emit(EVENTS.MENU_LOG,{logType:e,code:t,event:r})}}]),e}();function renderPlainText(e){return e}function renderPlayQuality(e){var t=e.droppedVideoFrames,r=e.totalVideoFrames,n=0;n=0===r?0:t/r*100;var i=document.createElement("span"),a=document.createElement("span");a.textContent=t,i.appendChild(a);var o=document.createElement("span");return o.textContent="/".concat(r,", ").concat(n.toFixed(2),"%"),i.appendChild(o),i}function renderResolution(e){var t=e.width,r=e.height,n=e.fps;return"".concat(t," * ").concat(r).concat(void 0!==n?" / ".concat(n,"fps"):"")}function removeAllChildren(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}function warn(e){console&&console.warn&&console.warn(e)}function isFunction(e){return"[object Function]"===Object.prototype.toString.call(e)}MenuPlugin.MenuEvents=events,MenuPlugin.Menu=Menu;var index$2="",ToastPlugin=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),(n=t.call(this,e)).toastNumber=0,n.toastMaps={},n}return _createClass$9(r,[{key:"beforePlayerInit",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"afterCreate",value:function(){}},{key:"destroy",value:function(){}},{key:"add",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.toastNumber+1;this.toastNumber=i;var a=this.renderToast(e,n,i);return this.root.appendChild(a),this.toastMaps[i]=a,setTimeout((function(){t.remove(i)}),r),i}},{key:"remove",value:function(e){var t=this.toastMaps[e];t&&(this.root.contains(t)&&this.root.removeChild(t),delete this.toastMaps[e])}},{key:"renderToast",value:function(e,t,r){var n=this,i=util$2.createDom("div","",void 0,"toast-container"),a=util$2.checkIsObject(e)?e:util$2.createDom("div",e,void 0,"toast-txt");if(i.appendChild(a),t){var o=util$2.createDom("span","Ã—",void 0,"toast-close-bt");o.addEventListener("click",(function(){n.remove(r)})),i.appendChild(o)}return i}},{key:"render",value:function(){return'<xg-sdk-toast class="xgplayer-sdk-toast"></xg-sdk-toast>'}}],[{key:"pluginName",get:function(){return"sdkToastPlugin"}},{key:"defaultConfig",get:function(){return{index:5}}}]),r}(Plugin),Hook=function(){function t(){_classCallCheck$8(this,t),this._hooks={},this._cache=[],this._hooksCache={}}return _createClass$9(t,[{key:"on",value:function(e,t){e&&t&&"function"==typeof t&&(this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(t))}},{key:"once",value:function(e,t){var r=this;if(e&&t&&"function"==typeof t){this.on(e,(function n(i){t(i),r.off(e,n)}))}}},{key:"off",value:function(e,t){if(e&&this._hooks[e]&&this._hooks[e].length)if(t){var r=this._hooks[e].indexOf(t);-1!==r&&this._hooks[e].splice(r,1)}else this._hooks[e]=[]}},{key:"emit",value:function(e,t,r){if(r){if(!e)return;-1!==this._cache.indexOf(r)?this._emit(e,t):(this._hooksCache.hasOwnProperty(r)||(this._hooksCache[r]={}),this._hooksCache[r].hasOwnProperty(e)||(this._hooksCache[r][e]=[]),this._hooksCache[r][e].push(t))}else this._emit(e,t)}},{key:"_emit",value:function(t,r){t&&this._hooks[t]&&this._hooks[t].length&&_toConsumableArray$3(this._hooks[t]).forEach((function(t){try{t(r)}catch(e){}}))}},{key:"set",value:function(e){e&&-1===this._cache.indexOf(e)&&this._cache.push(e)}}]),t}(),isObject=function(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)},isNumber=function(e){return"number"==typeof e&&!isNaN(e)},isString=function(e){return"string"==typeof e},getIndex=(lastEventId2=+Date.now()+Number("".concat(Math.random()).slice(2,8)),function(){return lastEventId2+=1}),lastEventId2,decrypto=function(e,t,r){if("string"==typeof e&&"number"==typeof t&&"number"==typeof r){var n,i=[];r=r<=25?r:r%25;var a=String.fromCharCode(r+97);n=e.split(a);for(var o=0;o<n.length;o++){var s=parseInt(n[o],r);s=1*s^t;var u=String.fromCharCode(s);i.push(u)}return i.join("")}},decodeUrl=function(e){return decrypto(e,64,25)},beforePageUnload=function(e){!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.addEventListener("pagehide",e,!1):window.addEventListener("beforeunload",e,!1)},parseURL=function(e){var t=document.createElement("a");return t.href=e,t},parseUrlQuery=function(t){var r={};try{var n=parseURL(t).search;(n=n.slice(1)).split("&").forEach((function(t){var n,i,a=t.split("=");a.length&&(n=a[0],i=a[1]);try{r[n]=decodeURIComponent(void 0===i?"":i)}catch(e){r[n]=i}}))}catch(e){}return r},hashCode=function(e){for(var t=0,r=0,n=(e+="").length,i=0;i<n;i++)((t=31*t+e.charCodeAt(r++))>0x7fffffffffff||t<-0x800000000000)&&(t&=0xffffffffffff);return t<0&&(t+=0x7ffffffffffff),t};function assign(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}var defaultConverter={read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function init(t,r){function n(e,n,i){if("undefined"!=typeof document){"number"==typeof(i=assign({},r,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var o in i)i[o]&&(a+="; "+o,!0!==i[o]&&(a+="="+i[o].split(";")[0]));return document.cookie=e+"="+t.write(n,e)+a}}return Object.create({set:n,get:function(r){if("undefined"!=typeof document&&(!arguments.length||r)){for(var n=document.cookie?document.cookie.split("; "):[],i={},a=0;a<n.length;a++){var o=n[a].split("="),s=o.slice(1).join("=");try{var u=decodeURIComponent(o[0]);if(i[u]=t.read(s,u),r===u)break}catch(e){}}return r?i[r]:i}},remove:function(e,t){n(e,"",assign({},t,{expires:-1}))},withAttributes:function(e){return init(this.converter,assign({},this.attributes,e))},withConverter:function(e){return init(assign({},this.converter,e),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}var api=init(defaultConverter,{path:"/"}),_getCookie=function(t,r){try{return api.get(t,{domain:r||document.domain})}catch(e){return""}},_setCookie=function(t,r,n,i){try{var a=i||document.domain,o=+new Date+(n||6048e5);api.set(t,r,{expires:new Date(o),path:"/",domain:a})}catch(e){}},Memory=function(){function e(){_classCallCheck$8(this,e),this.cache={}}return _createClass$9(e,[{key:"setItem",value:function(e,t){this.cache[e]=t}},{key:"getItem",value:function(e){return this.cache[e]}},{key:"removeItem",value:function(e){this.cache[e]=void 0}},{key:"getCookie",value:function(e,t){return _getCookie(e,t)}},{key:"setCookie",value:function(e,t,r,n){_setCookie(e,t,r,n)}}]),e}();function isSupportLS(){try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}function isSupportSession(){try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}var local={getItem:function(t){try{var r=localStorage.getItem(t),n=r;try{r&&"string"==typeof r&&(n=JSON.parse(r))}catch(e){}return n||{}}catch(e){}return{}},setItem:function(t,r){try{var n="string"==typeof r?r:JSON.stringify(r);localStorage.setItem(t,n)}catch(e){}},removeItem:function(t){try{localStorage.removeItem(t)}catch(e){}},getCookie:function(e,t){return _getCookie(e,t)},setCookie:function(e,t,r,n){_setCookie(e,t,r,n)},isSupportLS:isSupportLS()},session={getItem:function(t){try{var r=sessionStorage.getItem(t),n=r;try{r&&"string"==typeof r&&(n=JSON.parse(r))}catch(e){}return n||{}}catch(e){}return{}},setItem:function(t,r){try{var n="string"==typeof r?r:JSON.stringify(r);sessionStorage.setItem(t,n)}catch(e){}},removeItem:function(t){try{sessionStorage.removeItem(t)}catch(e){}},getCookie:function(e,t){return _getCookie(e,t)},setCookie:function(e,t,r,n){_setCookie(e,t,r,n)},isSupportSession:isSupportSession()},Storage=function(){function e(t,r){_classCallCheck$8(this,e),this._storage=r&&"session"===r?session:!t&&local.isSupportLS?local:new Memory}return _createClass$9(e,[{key:"getItem",value:function(e){return this._storage.getItem(e)}},{key:"setItem",value:function(e,t){this._storage.setItem(e,t)}},{key:"getCookie",value:function(e,t){return this._storage.getCookie(e,t)}},{key:"setCookie",value:function(e,t,r,n){this._storage.setCookie(e,t,r,n)}},{key:"removeItem",value:function(e){this._storage.removeItem(e)}}]),e}(),UTM=function(t,r,n,i){var a=new Storage(!1),o=new Storage(!1,"session"),s=t?"_tea_utm_cache_".concat(t):"_tea_utm_cache",u=t?"_$utm_from_url_".concat(t):"_$utm_from_url",c={},l=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],d={ad_id:Number(r.ad_id)||void 0,campaign_id:Number(r.campaign_id)||void 0,creative_id:Number(r.creative_id)||void 0,utm_source:r.utm_source,utm_medium:r.utm_medium,utm_campaign:r.utm_campaign,utm_term:r.utm_term,utm_content:r.utm_content,tr_shareuser:r.tr_shareuser,tr_admaster:r.tr_admaster,tr_param1:r.tr_param1,tr_param2:r.tr_param2,tr_param3:r.tr_param3,tr_param4:r.tr_param4};try{var h=!1;for(var f in d)d[f]&&(-1!==l.indexOf(f)?(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data[f]=d[f]):c[f]=d[f],h=!0);if(h)o.setItem(u,"1"),a.setCookie(s,JSON.stringify(c),i,n);else{var p=a.getCookie(s,n);p&&(c=JSON.parse(p))}o.getItem(u)&&(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data.$utm_from_url=1)}catch(e){return d}return c},Client=function(){function t(e,r,n){_classCallCheck$8(this,t),this.appid=e,this.domain=r,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=n}return _createClass$9(t,[{key:"init",value:function(){var e=window.navigator.userAgent,t=window.navigator.language,r=document.referrer,n=r?parseURL(r).hostname:"",i=parseUrlQuery(window.location.href),a=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(this.appVersion)?"wap":"web";this.utm=UTM(this.appid,i,this.domain,this.cookie_expire);var o=this.browser(),s=this.os();return{browser:o.browser,browser_version:o.browser_version,platform:a,os_name:s.os_name,os_version:s.os_version,userAgent:e,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(s.os_name),language:t,referrer:r,referrer_host:n,utm:this.utm,latest_data:this.last(r,n)}}},{key:"last",value:function(e,t){var r="",n="",i="",a=location.hostname,o=!1;if(e&&t&&a!==t){r=e,n=t,o=!0;var s=parseUrlQuery(e);s.keyword&&(i=s.keyword)}return{$latest_referrer:r,$latest_referrer_host:n,$latest_search_keyword:i,isLast:o}}},{key:"browser",value:function(){var e,t,r="",n="".concat(parseFloat(this.appVersion)),i=this.userAgent;return-1!==i.indexOf("Edge")||-1!==i.indexOf("Edg")?(r="Microsoft Edge",-1!==i.indexOf("Edge")?(e=i.indexOf("Edge"),n=i.substring(e+5)):(e=i.indexOf("Edg"),n=i.substring(e+4))):-1!==(e=i.indexOf("MSIE"))?(r="Microsoft Internet Explorer",n=i.substring(e+5)):-1!==(e=i.indexOf("Lark"))?(r="Lark",n=i.substring(e+5,e+11)):-1!==(e=i.indexOf("MetaSr"))?(r="sougoubrowser",n=i.substring(e+7,e+10)):-1!==i.indexOf("MQQBrowser")||-1!==i.indexOf("QQBrowser")?(r="qqbrowser",-1!==i.indexOf("MQQBrowser")?(e=i.indexOf("MQQBrowser"),n=i.substring(e+11,e+15)):-1!==i.indexOf("QQBrowser")&&(e=i.indexOf("QQBrowser"),n=i.substring(e+10,e+17))):-1!==i.indexOf("Chrome")?-1!==(e=i.indexOf("MicroMessenger"))?(r="weixin",n=i.substring(e+15,e+20)):-1!==(e=i.indexOf("360"))?(r="360browser",n=i.substring(i.indexOf("Chrome")+7)):-1!==i.indexOf("baidubrowser")||-1!==i.indexOf("BIDUBrowser")?(-1!==i.indexOf("baidubrowser")?(e=i.indexOf("baidubrowser"),n=i.substring(e+13,e+16)):-1!==i.indexOf("BIDUBrowser")&&(e=i.indexOf("BIDUBrowser"),n=i.substring(e+12,e+15)),r="baidubrowser"):-1!==(e=i.indexOf("xiaomi"))?-1!==i.indexOf("openlanguagexiaomi")?(r="openlanguage xiaomi",n=i.substring(e+7,e+13)):(r="xiaomi",n=i.substring(e-7,e-1)):-1!==(e=i.indexOf("TTWebView"))?(r="TTWebView",n=i.substring(e+10,e+23)):(-1!==(e=i.indexOf("Chrome"))||-1!==(e=i.indexOf("Chrome")))&&(r="Chrome",n=i.substring(e+7)):-1!==i.indexOf("Safari")?-1!==(e=i.indexOf("QQ"))?(r="qqbrowser",n=i.substring(e+10,e+16)):-1!==(e=i.indexOf("Safari"))&&(r="Safari",n=i.substring(e+7),-1!==(e=i.indexOf("Version"))&&(n=i.substring(e+8))):-1!==(e=i.indexOf("Firefox"))?(r="Firefox",n=i.substring(e+8)):-1!==(e=i.indexOf("MicroMessenger"))?(r="weixin",n=i.substring(e+15,e+20)):-1!==(e=i.indexOf("QQ"))&&(r="qqbrowser",n=i.substring(e+3,e+8)),-1!==(t=n.indexOf(";"))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(" "))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(")"))&&(n=n.substring(0,t)),{browser:r,browser_version:n}}},{key:"os",value:function(){for(var e="",t="",r=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],n=0;n<r.length;n++){var i=r[n];if(i.r.test(this.userAgent)){"Mac OS X"===(e=i.s)&&this.isNewIpad()&&(e="iOS");break}}var a=function(e,t){var r=e.exec(t);return r&&r[1]?r[1]:""},o=function(e,t){var r=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:".concat(e,")"),"i").exec(t);return r?r.slice(1)[0]:""};/Windows/.test(e)&&(t=a(/Windows (.*)/,e),e="windows");var s,u;switch(e){case"Mac OS X":t=o("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),e="mac";break;case"Android":s=this.userAgent,(u=a(/Android ([\.\_\d]+)/,s))||(u=a(/Android\/([\.\_\d]+)/,s)),t=u,e="android";break;case"iOS":t=this.isNewIpad()?o("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(t=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?"".concat(t[1],".").concat(t[2],".").concat(0|t[3]):"",e="ios"}return{os_name:e,os_version:t}}},{key:"getDeviceModel",value:function(t){var r="";try{if("android"===t)navigator.userAgent.split(";").forEach((function(e){e.indexOf("Build/")>-1&&(r=e.slice(0,e.indexOf("Build/")))}));else if("ios"===t||"mac"===t||"windows"===t)if(this.isNewIpad())r="iPad";else{var n=navigator.userAgent.replace("Mozilla/5.0 (",""),i=n.indexOf(";");r=n.slice(0,i)}}catch(e){return r.trim()}return r.trim()}},{key:"isNewIpad",value:function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1}}]),t}(),LOG;LOG={cn:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az28z1gz1hz1gz1cz18z1nz1gz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz21z1ez18z1jz1gz49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz18z1jz1gz24z18z49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k"};var AB_DOMAINS={cn:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},LOG_URL=LOG,SDK_VERSION="5.0.29",SDK_USE_TYPE="npm",SDK_TYPE=SDK_USE_TYPE,Types=function(e){return e.Init="init",e.Config="config",e.Start="start",e.Ready="ready",e.TokenComplete="token-complete",e.TokenStorage="token-storage",e.TokenFetch="token-fetch",e.TokenError="token-error",e.ConfigUuid="config-uuid",e.ConfigWebId="config-webid",e.ConfigDomain="config-domain",e.CustomWebId="custom-webid",e.TokenChange="token-change",e.TokenReset="token-reset",e.ConfigTransform="config-transform",e.EnvTransform="env-transform",e.SessionReset="session-reset",e.SessionResetTime="session-reset-time",e.Event="event",e.Events="events",e.EventNow="event-now",e.CleanEvents="clean-events",e.BeconEvent="becon-event",e.SubmitBefore="submit-before",e.SubmitScuess="submit-scuess",e.SubmitAfter="submit-after",e.SubmitError="submit-error",e.SubmitVerify="submit-verify",e.Stay="stay",e.ResetStay="reset-stay",e.StayReady="stay-ready",e.SetStay="set-stay",e.RouteChange="route-change",e.RouteReady="route-ready",e.Ab="ab",e.AbVar="ab-var",e.AbAllVars="ab-all-vars",e.AbConfig="ab-config",e.AbExternalVersion="ab-external-version",e.AbVersionChangeOn="ab-version-change-on",e.AbVersionChangeOff="ab-version-change-off",e.AbOpenLayer="ab-open-layer",e.AbCloseLayer="ab-close-layer",e.AbReady="ab-ready",e.AbComplete="ab-complete",e.Profile="profile",e.ProfileSet="profile-set",e.ProfileSetOnce="profile-set-once",e.ProfileUnset="profile-unset",e.ProfileIncrement="profile-increment",e.ProfileAppend="profile-append",e.ProfileClear="profile-clear",e.Autotrack="autotrack",e.AutotrackReady="autotrack-ready",e.CepReady="cep-ready",e.TracerReady="tracer-ready",e}(Types||{}),DebuggerMesssge$1=function(e){return e.DEBUGGER_MESSAGE="debugger-message",e.DEBUGGER_MESSAGE_SDK="debugger-message-sdk",e.DEBUGGER_MESSAGE_FETCH="debugger-message-fetch",e.DEBUGGER_MESSAGE_FETCH_RESULT="debugger-message-fetch-result",e.DEBUGGER_MESSAGE_EVENT="debugger-message-event",e.DEVTOOL_WEB_READY="devtool-web-ready",e}(DebuggerMesssge$1||{}),undef=void 0,date=new Date,timeZoneMin=date.getTimezoneOffset(),timezone=parseInt("".concat(-timeZoneMin/60),10),tz_offset=60*timeZoneMin,WEBID_URL="/webid",TOB_URL="/tobid",REPORT_URL="/list",COOKIE_EXPIRE=6048e5,ConfigManager=function(){function t(e,r){_classCallCheck$8(this,t),this.is_first_time=!0,this.configPersist=!1,this.initConfig=r,this.collect=e;var n=new Client(r.app_id,r.cookie_domain||"",r.cookie_expire||COOKIE_EXPIRE).init(),i="__tea_cache_first_".concat(r.app_id);this.configKey="__tea_cache_config_".concat(r.app_id),this.sessionStorage=new Storage(!1,"session"),this.localStorage=new Storage(!1,"local"),r.configPersist&&(this.configPersist=!0,this.storage=1===r.configPersist?this.sessionStorage:this.localStorage);var a=this.localStorage.getItem(i);a&&"1"===a?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(i,"1")),this.envInfo={user:{user_unique_id:undef,user_type:undef,user_id:undef,user_is_auth:undef,user_is_login:undef,device_id:undef,web_id:undef,ip_addr_id:undef,user_unique_id_type:undef},header:{app_id:undef,app_name:undef,app_install_id:undef,install_id:undef,app_package:undef,app_channel:undef,app_version:undef,os_name:n.os_name,os_version:n.os_version,device_model:n.device_model,ab_client:undef,traffic_type:undef,client_ip:undef,device_brand:undef,os_api:undef,access:undef,language:n.language,region:undef,app_language:undef,app_region:undef,ab_version:undef,creative_id:n.utm.creative_id,ad_id:n.utm.ad_id,campaign_id:n.utm.campaign_id,log_type:undef,rnd:undef,platform:n.platform,sdk_version:SDK_VERSION,sdk_lib:"js",province:undef,city:undef,timezone:timezone,tz_offset:tz_offset,tz_name:undef,sim_region:undef,carrier:undef,resolution:"".concat(n.screen_width,"x").concat(n.screen_height),browser:n.browser,browser_version:n.browser_version,referrer:n.referrer,referrer_host:n.referrer_host,width:n.screen_width,height:n.screen_height,screen_width:n.screen_width,screen_height:n.screen_height,utm_term:n.utm.utm_term,utm_content:n.utm.utm_content,utm_source:n.utm.utm_source,utm_medium:n.utm.utm_medium,utm_campaign:n.utm.utm_campaign,tracer_data:JSON.stringify(n.utm.tracer_data),custom:{},wechat_unionid:undef,wechat_openid:undef}},this.ab_version="",this.evtParams={},this.reportErrorCallback=function(){},this.initDomain()}return _createClass$9(t,[{key:"initDomain",value:function(){var e=this.initConfig.channel_domain;if(e)this.domain=e;else{var t=this.initConfig.channel;this.domain=decodeUrl(LOG_URL[t])}}},{key:"setDomain",value:function(e){this.domain=e}},{key:"getDomain",value:function(){return this.domain}},{key:"setAbVersion",value:function(e){this.ab_version=e}},{key:"getAbVersion",value:function(){return this.ab_version}},{key:"setAbData",value:function(e){this.ab_data=e}},{key:"getAbData",value:function(){return this.ab_data||{}}},{key:"getUrl",value:function(e){var t="";switch(e){case"event":t=this.initConfig.report_url||REPORT_URL;break;case"webid":t=WEBID_URL;break;case"tobid":t=TOB_URL}var r="";return this.initConfig.caller&&(r="?sdk_version=".concat(SDK_VERSION,"&sdk_name=web&app_id=").concat(this.initConfig.app_id,"&caller=").concat(this.initConfig.caller)),"".concat(this.getDomain()).concat(t).concat(r)}},{key:"set",value:function(e){var t=this;Object.keys(e).forEach((function(r){if(void 0!==e[r]&&null!==e[r]||t.delete(r),"evtParams"===r)t.evtParams=_objectSpread2$7(_objectSpread2$7({},t.evtParams||{}),e.evtParams||{});else if("_staging_flag"===r)t.evtParams=_objectSpread2$7(_objectSpread2$7({},t.evtParams||{}),{},{_staging_flag:e._staging_flag});else if("reportErrorCallback"===r&&"function"==typeof e[r])t.reportErrorCallback=e[r];else{var n="",i="";if(r.indexOf(".")>-1){var a=r.split(".");n=a[0],i=a[1]}n?"user"===n||"header"===n?t.envInfo[n][i]=e[r]:t.envInfo.header.custom[i]=e[r]:t.envInfo.user.hasOwnProperty(r)?["user_type","ip_addr_id"].indexOf(r)>-1?t.envInfo.user[r]=e[r]?Number(e[r]):e[r]:["user_id","web_id","user_unique_id","user_unique_id_type"].indexOf(r)>-1?t.envInfo.user[r]=e[r]?String(e[r]):e[r]:["user_is_auth","user_is_login"].indexOf(r)>-1?t.envInfo.user[r]=Boolean(e[r]):"device_id"===r&&(t.envInfo.user[r]=e[r]):t.envInfo.header.hasOwnProperty(r)?t.envInfo.header[r]=e[r]:t.envInfo.header.custom[r]=e[r]}}))}},{key:"get",value:function(t){try{return t?"evtParams"===t?this.evtParams:"reportErrorCallback"===t?this[t]:this.envInfo.user.hasOwnProperty(t)?this.envInfo.user[t]:this.envInfo.header.hasOwnProperty(t)?this.envInfo.header[t]:JSON.parse(JSON.stringify(this.envInfo[t])):JSON.parse(JSON.stringify(this.envInfo))}catch(e){console.log("get config stringify error "),this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:e.message})}}},{key:"setStore",value:function(t){try{if(!this.configPersist)return;var r=this.storage.getItem(this.configKey)||{};if(r&&Object.keys(t).length){var n=Object.assign(t,r);this.storage.setItem(this.configKey,n)}}catch(e){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:e.message})}}},{key:"getStore",value:function(){try{if(!this.configPersist)return null;var t=this.storage.getItem(this.configKey);return t&&Object.keys(t).length?t:null}catch(e){return this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:e.message}),null}}},{key:"delete",value:function(t){try{if(!this.configPersist)return;var r=this.storage.getItem(this.configKey);r&&r.hasOwnProperty(t)&&(delete r[t],this.storage.setItem(this.configKey,r))}catch(e){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:e.message})}}}]),t}(),Logger=function(){function e(t,r){_classCallCheck$8(this,e),this.isLog=r||!1,this.name=t||""}return _createClass$9(e,[{key:"info",value:function(e){this.isLog&&console.log("%c %s","color: yellow; background-color: black;","[instance: ".concat(this.name,"] ")+e)}},{key:"warn",value:function(e){this.isLog&&console.warn("[instance: ".concat(this.name,"] ")+e)}},{key:"error",value:function(e){this.isLog&&console.error("[instance: ".concat(this.name,"] ")+e)}},{key:"throw",value:function(e){throw this.error(this.name),new Error(e)}}]),e}(),AppBridge=function(){function t(e,r){_classCallCheck$8(this,t),this.collect=e,this.native=r}return _createClass$9(t,[{key:"bridgeInject",value:function(){try{return!!this.native&&(AppLogBridge?(console.log("AppLogBridge is injected"),!0):(console.log("AppLogBridge is not inject"),!1))}catch(e){return console.log("AppLogBridge is not inject"),!1}}},{key:"bridgeReady",value:function(){var t=this;return new Promise((function(r,n){try{t.bridgeInject()?AppLogBridge.hasStarted((function(e){console.log("AppLogBridge is started? : ".concat(e)),e?r(!0):n(!1)})):n(!1)}catch(e){console.log("AppLogBridge, error:".concat(JSON.stringify(e.stack))),n(!1)}}))}},{key:"setNativeAppId",value:function(t){try{AppLogBridge.setNativeAppId(JSON.stringify(t)),console.log("change bridge appid, event report with appid: ".concat(t))}catch(e){console.error("setNativeAppId error")}}},{key:"setConfig",value:function(t){var r=this;try{Object.keys(t).forEach((function(e){"user_unique_id"===e?r.setUserUniqueId(t[e]):t[e]?r.addHeaderInfo(e,t[e]):r.removeHeaderInfo(e)}))}catch(e){console.error("setConfig error")}}},{key:"setUserUniqueId",value:function(t){try{AppLogBridge.setUserUniqueId(t)}catch(e){console.error("setUserUniqueId error")}}},{key:"addHeaderInfo",value:function(t,r){try{AppLogBridge.addHeaderInfo(t,r)}catch(e){console.error("addHeaderInfo error")}}},{key:"setHeaderInfo",value:function(t){try{AppLogBridge.setHeaderInfo(JSON.stringify(t))}catch(e){console.error("setHeaderInfo error")}}},{key:"removeHeaderInfo",value:function(t){try{AppLogBridge.removeHeaderInfo(t)}catch(e){console.error("removeHeaderInfo error")}}},{key:"reportPv",value:function(e){this.onEventV3("predefine_pageview",e)}},{key:"onEventV3",value:function(t,r){try{AppLogBridge.onEventV3(t,r),this.collect.emit(DebuggerMesssge.DEBUGGER_MESSAGE,{type:DebuggerMesssge.DEBUGGER_MESSAGE_EVENT,info:"bridgeåŸ‹ç‚¹ä¸ŠæŠ¥",time:Date.now(),data:[{events:[{event:t,params:r}]}],code:200,status:"success"})}catch(e){console.error("onEventV3 error")}}},{key:"profileSet",value:function(e){try{AppLogBridge.profileSet(e)}catch(error){console.error("profileSet error")}}},{key:"profileSetOnce",value:function(e){try{AppLogBridge.profileSetOnce(e)}catch(error){console.error("profileSetOnce error")}}},{key:"profileIncrement",value:function(e){try{AppLogBridge.profileIncrement(e)}catch(error){console.error("profileIncrement error")}}},{key:"profileUnset",value:function(e){try{AppLogBridge.profileUnset(e)}catch(error){console.error("profileUnset error")}}},{key:"profileAppend",value:function(e){try{AppLogBridge.profileAppend(e)}catch(error){console.error("profileAppend error")}}}]),t}(),ERROR$1={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005};function fetch$1(t,r,n,i,a,o,s,u,c){try{var l=new XMLHttpRequest,d=u||"POST";l.open(d,"".concat(t),!0),l.setRequestHeader("Content-Type","application/json; charset=utf-8"),s&&l.setRequestHeader("X-MCS-AppKey","".concat(s)),i&&(l.withCredentials=!0),l.onload=function(){if(a){var t=null;if(l.responseText){try{t=JSON.parse(l.responseText)}catch(e){t={}}a(t,r)}}},n&&(l.timeout=n,l.ontimeout=function(){o&&o(r,ERROR$1.TIMEOUT)}),l.onerror=function(){l.abort(),o&&o(r,ERROR$1.XHR_ON)},c?l.send(r):l.send(JSON.stringify(r))}catch(e){}}var GIF_URL="/gif",ERROR={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005},isSupportBeacon=function(){return!(!window.navigator||!window.navigator.sendBeacon)},encodePayload=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&void 0!==e[r]&&(t+="&".concat(r,"=").concat(encodeURIComponent(JSON.stringify(e[r]))));return t="&"===t[0]?t.slice(1):t},sendByImg=function(t,r,n,i){try{var a=t.match(/\/v\d\//),o="";o=a?a[0]:-1!==t.indexOf("/v1/")?"/v1/":"/v2/";var s=t.split(o)[0];if(!s)return void i(t,r,ERROR.NO_URL);r.forEach((function(e){var a=encodePayload(e),o=new Image(1,1);o.onload=function(){o=null,n&&n()},o.onerror=function(){o=null,i&&i(t,r,ERROR.IMG_ON)},o.src="".concat(s).concat(GIF_URL,"?").concat(a)}))}catch(e){i&&i(t,r,ERROR.IMG_CATCH,e.message)}},request=function(e,t,r,n,i,a,o,s){var u=window.navigator.userAgent;if(-1===window.navigator.appName.indexOf("Microsoft Internet Explorer")||-1===u.indexOf("MSIE 8.0")&&-1===u.indexOf("MSIE 9.0")){if(o)return isSupportBeacon()?void(window.navigator.sendBeacon(e,JSON.stringify(t))?i():a(e,t,ERROR.BEACON_FALSE)):void sendByImg(e,t,i,a)}else sendByImg(e,t,i,a);fetch$1(e,t,r,n,i,a,"","",s)},EventCheck=function(){function e(t,r){_classCallCheck$8(this,e),this.collector=t,this.config=r,this.eventNameWhiteList=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure"],this.paramsNameWhiteList=["$inactive","$inline","$target_uuid_list","$source_uuid","$is_spider","$source_id","$is_first_time","_staging_flag"],this.regStr=new RegExp("^[a-zA-Z0-9][a-z0-9A-Z_.-]{1,255}$")}return _createClass$9(e,[{key:"checkVerify",value:function(e){var t=this;if(!e||!e.length)return!1;var r=e[0];if(!r)return!1;var n=r.events,i=r.header;if(!n||!n.length)return!1;var a=!0;return n.forEach((function(e){t.checkEventName(e.event)||(a=!1,e.checkEvent="äº‹ä»¶åä¸èƒ½ä»¥ $ or __å¼€å¤´"),t.checkEventParams(e.params)||(a=!1,e.checkParams="å±žæ€§åä¸èƒ½ä»¥ $ or __å¼€å¤´")})),this.checkEventParams(i)||(a=!1),a}},{key:"checkEventName",value:function(e){return!!e&&this.calculate(e,"event")}},{key:"checkEventParams",value:function(e){var t=e;if("string"==typeof e&&(t=JSON.parse(t)),!Object.keys(t).length)return!0;for(var r in t)return!!this.calculate(r,"params")&&(!("string"==typeof t[r]&&t[r].length>1024)||(console.warn("params: ".concat(r," can not over 1024 byte, please check;")),!1));return!0}},{key:"calculate",value:function(e,t){return-1!==("event"===t?this.eventNameWhiteList:this.paramsNameWhiteList).indexOf(e)||(this.regStr.test(e)?!new RegExp("^\\$").test(e)&&!new RegExp("^__").test(e)||(console.warn("".concat("event"===t?"event":"params"," name: ").concat(e," can not start with $ or __, pleace check;")),!1):(console.warn("".concat("event"===t?"event":"params"," name: ").concat(e," is illegal, can not start with $ or __, pleace check;")),!1))}}]),e}(),Event$1=function(){function t(){_classCallCheck$8(this,t),this.eventLimit=50,this.enable_ttwebid=!1,this.eventCache=[],this.beconEventCache=[]}return _createClass$9(t,[{key:"apply",value:function(e,t){var r=this;this.collect=e,this.config=t,this.configManager=e.configManager,this.eventCheck=new EventCheck(e,t),this.cacheStorgae=new Storage(!0),this.localStorage=new Storage(!1),this.maxReport=t.max_report||10,this.reportTime=t.reportTime||30,this.timeout=t.timeout||1e5,this.enable_ttwebid=t.enable_ttwebid,this.reportUrl=this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_".concat(this.configManager.get("app_id")),this.beconKey="__tea_cache_events_becon_".concat(this.configManager.get("app_id")),this.abKey="__tea_sdk_ab_version_".concat(this.configManager.get("app_id")),this.collect.on(Types.Ready,(function(){r.reportAll(!1)})),this.collect.on(Types.ConfigDomain,(function(){r.reportUrl=r.configManager.getUrl("event")})),this.collect.on(Types.Event,(function(e){r.event(e)})),this.collect.on(Types.BeconEvent,(function(e){r.beconEvent(e)})),this.collect.on(Types.CleanEvents,(function(){r.reportAll(!1)})),this.linster()}},{key:"linster",value:function(){var e=this;window.addEventListener("unload",(function(){e.reportAll(!0)}),!1),beforePageUnload((function(){e.reportAll(!0)})),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&e.reportAll(!0)}),!1)}},{key:"reportAll",value:function(e){this.report(e),this.reportBecon()}},{key:"event",value:function(t){var r=this;try{var n=this.cacheStorgae.getItem(this.eventKey)||[],i=[].concat(_toConsumableArray$3(t),_toConsumableArray$3(n));if(this.cacheStorgae.setItem(this.eventKey,i),this.reportTimeout&&clearTimeout(this.reportTimeout),i.length>=this.maxReport)this.report(!1);else{var a=this.reportTime;this.reportTimeout=setTimeout((function(){r.report(!1),r.reportTimeout=null}),a)}}catch(e){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:e.message})}}},{key:"beconEvent",value:function(e){var t=this.cacheStorgae.getItem(this.beconKey)||[],r=[].concat(_toConsumableArray$3(e),_toConsumableArray$3(t));this.cacheStorgae.setItem(this.beconKey,r),this.collect.destroyInstance||this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(r)),!0))}},{key:"reportBecon",value:function(){if(!this.collect.destroyInstance&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var e=this.cacheStorgae.getItem(this.beconKey)||[];e&&e.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))}}},{key:"report",value:function(e){if(!this.collect.destroyInstance&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var t=this.cacheStorgae.getItem(this.eventKey)||[];t.length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(t,e))}}},{key:"sliceEvent",value:function(e,t){if(e.length>this.eventLimit)for(var r=0;r<e.length;r+=this.eventLimit){var n;n=e.slice(r,r+this.eventLimit);var i=this.split(this.merge(n));this.send(i,t)}else{var a=this.split(this.merge(e));this.send(a,t)}}},{key:"merge",value:function(t,r){var n=this,i=this.configManager.get(),a=i.header,o=i.user;a.custom=JSON.stringify(a.custom);var s=this.configManager.get("evtParams"),u=this.configManager.get("user_unique_id_type"),c=t.map((function(t){try{Object.keys(s).length&&!r&&(t.params=_objectSpread2$7(_objectSpread2$7({},s),t.params)),u&&(t.params.$user_unique_id_type=u);var i=n.localStorage.getItem(n.abKey);return i&&i.uuid&&i.uuid===o.user_unique_id&&n.configManager.getAbVersion()&&(t.ab_sdk_version=n.configManager.getAbVersion()),t.session_id=n.collect.sessionManager.getSessionId(),t.params=JSON.stringify(t.params),t}catch(e){return n.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:e.message}),t}})),l=JSON.parse(JSON.stringify({events:c,user:o,header:a}));l.local_time=Math.floor(Date.now()/1e3),l.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0;var d=[];return d.push(l),d}},{key:"split",value:function(e){return e=e.map((function(e){var t=[];return t.push(e),t}))}},{key:"send",value:function(t,r){var n=this;t.length&&t.forEach((function(t){try{var i=JSON.parse(JSON.stringify(t));n.config.filter&&((i=n.config.filter(i))||console.warn("filter must return data !!")),n.collect.eventFilter&&i&&((i=n.collect.eventFilter(i))||console.warn("filterEvent api must return data !!"));var a=i||t;if(n.eventCheck.checkVerify(a),!a.length)return;n.collect.emit(Types.SubmitBefore,a),n.collect.emit(Types.SubmitVerify,a),request(n.reportUrl,a,n.timeout,n.enable_ttwebid,(function(e,t){e&&0!==e.e?(n.collect.emit(Types.SubmitError,{type:"f_data",eventData:t,errorCode:e.e,response:e}),n.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_EVENT,info:"åŸ‹ç‚¹ä¸ŠæŠ¥å¤±è´¥",time:Date.now(),data:a,code:e.e,failType:"æ•°æ®å¼‚å¸¸",status:"fail"})):(n.collect.emit(Types.SubmitScuess,{eventData:t,res:e}),n.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_EVENT,info:"åŸ‹ç‚¹ä¸ŠæŠ¥æˆåŠŸ",time:Date.now(),data:a,code:200,status:"success"}))}),(function(e,t){n.configManager.get("reportErrorCallback")(e,t),n.collect.emit(Types.SubmitError,{type:"f_net",eventData:e,errorCode:t}),n.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_EVENT,info:"åŸ‹ç‚¹ä¸ŠæŠ¥ç½‘ç»œå¼‚å¸¸",time:Date.now(),data:a,code:t,failType:"ç½‘ç»œå¼‚å¸¸",status:"fail"})}),r,!1),n.collect.emit(Types.SubmitAfter,a)}catch(e){console.warn("something error, ".concat(JSON.stringify(e.stack))),n.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:e.message})}}))}}]),t}(),b=function e(t){return t?(t^16*Math.random()>>t/4).toString(10):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)},localWebId=function(){return b().replace(/-/g,"").slice(0,19)},Token=function(){function e(){_classCallCheck$8(this,e),this.cacheToken={},this.enableCookie=!1,this.enable_ttwebid=!1,this.enableCustomWebid=!1}return _createClass$9(e,[{key:"apply",value:function(e,t){var r=this;this.collect=e,this.config=t,this.configManager=this.collect.configManager,this.storage=new Storage(!1),this.tokenKey="__tea_cache_tokens_".concat(t.app_id),this.enable_ttwebid=t.enable_ttwebid,this.enableCustomWebid=t.enable_custom_webid,this.collect.on(Types.ConfigUuid,(function(e){r.setUuid(e)})),this.collect.on(Types.ConfigWebId,(function(e){r.setWebId(e)})),this.enableCookie=t.cross_subdomain,this.expiresTime=t.cookie_expire||6048e5,this.cookieDomain=t.cookie_domain||"",this.checkStorage()}},{key:"checkStorage",value:function(){var e=this;if(this.enableCookie){var t=this.storage.getCookie(this.tokenKey,this.cookieDomain);this.cacheToken=t&&"string"==typeof t?JSON.parse(t):{}}else this.cacheToken=this.storage.getItem(this.tokenKey)||{};this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid?this.enableCustomWebid?this.collect.on(Types.CustomWebId,(function(){e.tokenReady=!0,e.collect.emit(Types.TokenComplete)})):this.checkEnv()||(this.enable_ttwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()}},{key:"check",value:function(){this.cacheToken&&this.cacheToken.web_id?this.complete(this.cacheToken):this.config.disable_webid?this.complete({web_id:localWebId(),user_unique_id:this.configManager.get("user_unique_id")||localWebId()}):this.remoteWebid()}},{key:"checkEnv",value:function(){var e=window.navigator.userAgent;if(-1!==e.indexOf("miniProgram")||-1!==e.indexOf("MiniProgram")){var t=parseUrlQuery(window.location.href);return!(!t||!t.Web_ID)&&(this.complete({web_id:"".concat(t.Web_ID),user_unique_id:this.configManager.get("user_unique_id")||"".concat(t.Web_ID)}),!0)}return!1}},{key:"remoteWebid",value:function(){var e=this,t=this.configManager.getUrl("webid"),r={app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""};this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK å‘èµ·WEBIDè¯·æ±‚",logType:"fetch",level:"info",time:Date.now(),data:r}),fetch$1(t,r,3e3,!1,(function(t){t&&0===t.e?e.complete({web_id:e.configManager.get("web_id")||t.web_id,user_unique_id:e.configManager.get("user_unique_id")||t.web_id}):(e.collect.emit(Types.TokenError),console.warn("[]appid: ".concat(e.config.app_id," webid error, init error~"))),e.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"WEBIDè¯·æ±‚æˆåŠŸ",logType:"fetch",level:"info",time:Date.now(),data:t})}),(function(){e.collect.emit(Types.TokenError),e.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"WEBIDè¯·æ±‚ç½‘ç»œå¼‚å¸¸",logType:"fetch",level:"error",time:Date.now(),data:null}),console.warn("[]appid: ".concat(e.config.app_id,", get webid error, init error~"))}))}},{key:"complete",value:function(e){var t=e.web_id,r=e.user_unique_id;e.timestamp=Date.now(),this.collect.configManager.set({web_id:t,user_unique_id:r}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(Types.TokenComplete)}},{key:"completeTtWid",value:function(e){var t=e.user_unique_id||"",r=this.configManager.get("user_unique_id");(r||t)&&this.configManager.set({user_unique_id:r||t}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(Types.TokenComplete)}},{key:"setUuid",value:function(e){if(e&&-1===["null","undefined","Null","None"].indexOf(e)){var t=String(e),r=this.configManager.get("user_unique_id"),n=this.cacheToken&&this.cacheToken.user_unique_id;if(t===r&&t===n)return;this.configManager.set({user_unique_id:t}),this.cacheToken||(this.cacheToken={}),this.cacheToken.user_unique_id=t,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(Types.TokenChange,"uuid"),this.collect.emit(Types.SessionReset)}else this.clearUuid()}},{key:"clearUuid",value:function(){this.config.enable_ttwebid||this.configManager.get("web_id")&&(this.configManager.set({user_unique_id:this.configManager.get("web_id")}),this.cacheToken&&this.cacheToken.web_id&&(this.cacheToken.user_unique_id=this.cacheToken.web_id,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken)),this.collect.emit(Types.TokenReset))}},{key:"setWebId",value:function(e){if(e&&!this.config.enable_ttwebid){this.cacheToken&&this.cacheToken.web_id?this.cacheToken.web_id!==e&&(this.cacheToken.user_unique_id=this.cacheToken.web_id===this.cacheToken.user_unique_id?e:this.cacheToken.user_unique_id,this.cacheToken.web_id=e):(this.cacheToken={},this.cacheToken.web_id=e,this.cacheToken.user_unique_id=e),this.cacheToken.timestamp=Date.now();var t=this.configManager.get("web_id"),r=this.configManager.get("user_unique_id");r&&r!==t||(this.configManager.set({user_unique_id:e}),this.collect.emit(Types.TokenChange,"uuid")),t!==e&&(this.configManager.set({web_id:e}),this.collect.emit(Types.TokenChange,"webid")),this.setStorage(this.cacheToken)}}},{key:"setStorage",value:function(e){e._type_=this.enableCustomWebid?"custom":"default",delete e["diss".split("").reverse().join("")],this.enableCookie||this.enable_ttwebid?(this.storage.setCookie(this.tokenKey,e,this.expiresTime,this.cookieDomain),this.enable_ttwebid&&(delete e.web_id,this.storage.setItem(this.tokenKey,e))):this.storage.setItem(this.tokenKey,e),this.cacheToken=e}},{key:"getReady",value:function(){return this.tokenReady}},{key:"getTobId",value:function(){var e=this,t=this.configManager.getUrl("tobid");return new Promise((function(r){fetch$1(t,{app_id:e.config.app_id,user_unique_id:e.configManager.get("user_unique_id"),web_id:e.configManager.get("web_id"),user_unique_id_type:e.configManager.get("user_unique_id_type")},3e4,e.enable_ttwebid,(function(e){e&&0===e.e?r(e.tobid):r("")}),(function(){r("")}))}))}}]),e}(),sessionId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},Session=function(){function e(){_classCallCheck$8(this,e)}return _createClass$9(e,[{key:"apply",value:function(e,t){var r=this;this.collect=e,this.storage=new Storage(!1,"session"),this.sessionKey="__tea_session_id_".concat(t.app_id),this.expireTime=t.expireTime||18e5,this.disableSession=t.disable_session,this.disableSession||(this.setSessionId(),this.collect.on(Types.SessionReset,(function(){r.resetSessionId()})),this.collect.on(Types.SessionResetTime,(function(){r.updateSessionIdTime()})))}},{key:"updateSessionIdTime",value:function(){var e=this.storage.getItem(this.sessionKey);if(e&&e.sessionId){var t=e.timestamp;Date.now()-t>this.expireTime?e={sessionId:sessionId(),timestamp:Date.now()}:e.timestamp=Date.now(),this.storage.setItem(this.sessionKey,e),this.resetExpTime()}}},{key:"setSessionId",value:function(){var e=this,t=this.storage.getItem(this.sessionKey);t&&t.sessionId?t.timestamp=Date.now():t={sessionId:sessionId(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t),this.sessionExp=setInterval((function(){e.checkEXp()}),this.expireTime)}},{key:"getSessionId",value:function(){var e=this.storage.getItem(this.sessionKey);return this.disableSession?"":e&&e.sessionId?e.sessionId:""}},{key:"resetExpTime",value:function(){var e=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval((function(){e.checkEXp()}),this.expireTime))}},{key:"resetSessionId",value:function(){var e={sessionId:sessionId(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,e)}},{key:"checkEXp",value:function(){var e=this.storage.getItem(this.sessionKey);e&&e.sessionId&&(Date.now()-e.timestamp+30>=this.expireTime&&(e={sessionId:sessionId(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e)))}}]),e}(),AutoBase=function(e){var t=e.app_id,r=e.channel,n=e.onTokenReady,i="".concat(LOG_URL[r],"/webid"),a=new Storage(!1),o="__tea_cache_tokens_".concat(t),s=a.getItem(o);s&&s.web_id?n(s.web_id):request(i,{app_key:"",app_id:t,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer},3e3,!1,(function(e){if(e&&0===e.e){n(e.web_id);var t={web_id:e.web_id,user_unique_id:e.web_id,timestamp:Date.now()};a.setItem(o,t)}else n("")}),(function(){n("")}),!0)},Debugger=function(){function t(e,r){_classCallCheck$8(this,t),this.devToolReady=!1,this.devToolOrigin="*",this.sendAlready=!1,this.collect=e,this.config=r,this.app_id=r.app_id,this.filterEvent=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure","bav2b_page","bav2b_beat","bav2b_page_statistics","bav2b_click","bav2b_page_exposure","_be_active","predefine_pageview","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append","predefine_page_alive","predefine_page_close","abtest_exposure"],this.load()}return _createClass$9(t,[{key:"loadScript",value:function(t){try{var r=document.createElement("script");r.src=t,r.onerror=function(){console.log("load DevTool render fail")},r.onload=function(){console.log("load DevTool render success")},document.getElementsByTagName("body")[0].appendChild(r)}catch(e){console.log("devTool load fail, ".concat(e.message))}}},{key:"load",value:function(){try{this.loadBaseInfo(),this.loadHook();var t=parseUrlQuery(window.location.href);if(!t.open_devtool_web||parseInt(t.app_id)!==this.app_id)return;this.addLintener(),this.loadDebuggerModule(),this.loadDevTool()}catch(e){console.log("debug fail, ".concat(e.message))}}},{key:"loadDevTool",value:function(){this.loadScript("https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/devtool/debug-web.js")}},{key:"loadBaseInfo",value:function(){var e=this;this.info=[{title:"åŸºæœ¬ä¿¡æ¯",type:1,infoName:{app_id:this.config.app_id,channel:this.config.channel,"ä¸ŠæŠ¥åŸŸå":this.collect.configManager.getDomain(),"SDKç‰ˆæœ¬":SDK_VERSION,"SDKå¼•å…¥æ–¹å¼":SDK_TYPE}},{title:"ç”¨æˆ·ä¿¡æ¯",type:2,infoName:{uuid:this.collect.configManager.get("user").user_unique_id||"",web_id:this.collect.configManager.get("user").web_id||"",ssid:"ç‚¹å‡»èŽ·å–SSID"}},{title:"å…¬å…±å‚æ•°ä¿¡æ¯",type:2,infoName:{"æµè§ˆå™¨":this.collect.configManager.get("browser"),"æµè§ˆå™¨ç‰ˆæœ¬":this.collect.configManager.get("browser_version"),"å¹³å°":this.collect.configManager.get("platform"),"è®¾å¤‡åž‹å·":this.collect.configManager.get("device_model"),"æ“ä½œç³»ç»Ÿ":this.collect.configManager.get("os_name"),"æ“ä½œç³»ç»Ÿç‰ˆæœ¬":this.collect.configManager.get("os_version"),"å±å¹•åˆ†è¾¨çŽ‡":this.collect.configManager.get("os_version"),"æ¥æº":this.collect.configManager.get("referrer"),"è‡ªå®šä¹‰ä¿¡æ¯":""}},{title:"é…ç½®ä¿¡æ¯",type:3,infoName:{"å…¨åŸ‹ç‚¹":!!this.config.autotrack,"åœç•™æ—¶é•¿":!!this.config.enable_stay_duration}},{title:"A/Bé…ç½®ä¿¡æ¯",type:4,infoName:{"A/Bå®žéªŒ":!!this.config.enable_ab_test}},{title:"å®¢æˆ·ç«¯ä¿¡æ¯",type:3,infoName:{"æ‰“é€šå¼€å…³":!!this.config.Native}}],this.log=[],this.event=[],this.collect.on(Types.Ready,(function(){e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id,e.info[2].infoName["è‡ªå®šä¹‰ä¿¡æ¯"]=JSON.stringify(e.collect.configManager.get("custom")),e.config.enable_ab_test&&(e.info[4].infoName["å·²æ›å…‰VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["A/BåŸŸå"]=e.config.ab_channel_domain||decodeUrl(AB_DOMAINS[e.config.channel]),e.info[4].infoName["å…¨éƒ¨é…ç½®"]=e.collect.configManager.getAbData()),e.config.Native&&(e.info[5].infoName["æ˜¯å¦æ‰“é€š"]=!!e.collect.bridgeReport)}))}},{key:"loadHook",value:function(){var e=this;this.collect.on(DebuggerMesssge$1.DEBUGGER_MESSAGE,(function(t){switch(t.type){case DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK:var r={time:t.time,type:t.logType||"sdk",level:t.level,name:t.info,show:!0,levelShow:!0,needDesc:!!t.data};return t.data&&(r.desc={content:JSON.stringify(t.data)}),e.updateLog(r),t.secType&&"AB"===t.secType?(e.info[4].infoName["å·²æ›å…‰VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["å…¨éƒ¨é…ç½®"]=e.collect.configManager.getAbData()):"USER"===t.secType&&(e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id),void e.updateInfo();case DebuggerMesssge$1.DEBUGGER_MESSAGE_EVENT:if(t.data&&t.data.length){var n=t.data[0],i=n.events;if(!i.length)return;i.forEach((function(r){r.checkShow=!0,r.searchShow=!0,r.success=t.status,r.type=-1!==e.filterEvent.indexOf(r.event)?"sdk":"cus",r.type=e.collect.bridgeReport?"bridge":r.type,r.info="","fail"===t.status&&(r.info={message:"code: ".concat(t.code,"ï¼Œ msg: ").concat(t.failType)})})),e.updateEvent(n)}return}}))}},{key:"addLintener",value:function(){var e=this;window.addEventListener("message",(function(t){if(t&&t.data&&"devtool:web:ready"===t.data.type){if(e.devToolOrigin=t.origin,e.devToolReady=!0,e.sendAlready)return;console.log("inittttt"),e.sendData("devtool:web:init",{info:e.info,log:e.log,event:e.event}),e.sendAlready=!0}t&&t.data&&"devtool:web:ssid"===t.data.type&&e.collect.getToken((function(t){e.info[1].infoName.ssid=t.tobid,e.updateInfo()}))}))}},{key:"sendData",value:function(t,r){try{var n={type:t,payload:r};(window.opener||window.parent).postMessage(n,this.devToolOrigin)}catch(e){}}},{key:"updateInfo",value:function(){this.devToolReady&&this.sendData("devtool:web:info",this.info)}},{key:"updateLog",value:function(e){this.devToolReady?this.sendData("devtool:web:log",e):this.log.push(e)}},{key:"updateEvent",value:function(e){this.devToolReady?this.sendData("devtool:web:event",e):this.event.push(e)}},{key:"loadDebuggerModule",value:function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.appendChild(document.createTextNode("#debugger-applog-web {\n      position: absolute;\n      width: 90px;\n      height: 30px;\n      background: #23c243;\n      border-radius: 6px;\n      color: #fff;\n      font-size: 12px;\n      bottom: 5%;\n      right: 10%;\n      text-align: center;\n      line-height: 30px;\n      cursor: pointer;\n      z-index:100;\n    }")),e.appendChild(t);var r=document.createElement("div");r.innerHTML='<div id="debugger-applog-web" class="debugger-applog-web">AppLogè°ƒè¯•</div>';var n=document.createElement("div");n.innerHTML='<div id="debugger-container" class="debugger-container"></div>',document.getElementsByTagName("body")[0].appendChild(r),document.getElementsByTagName("body")[0].appendChild(n),document.getElementById("debugger-applog-web").addEventListener("click",(function(){(window.opener||window.parent).postMessage({type:"devtool:web:open-draw"},location.origin)}))}}]),t}(),_excluded=["web_id","user_unique_id"],_Collector=function(){function t(e){_classCallCheck$8(this,t),this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroyInstance=!1,this.sdkReady=!1,this.adapters={},this.name=e,this.hook=new Hook,this.remotePlugin=new Map,this.Types=Types,this.adapters.fetch=fetch$1,this.adapters.storage=Storage}return _createClass$9(t,[{key:"usePlugin",value:function(e,t,r){e&&(t?"string"==typeof t?this.remotePlugin.get(e)||this.remotePlugin.set(e,{src:t,call:r}):this.remotePlugin.get(e)||this.remotePlugin.set(e,{instance:t}):this.remotePlugin.get(e)||this.remotePlugin.set(e,"sdk"))}},{key:"init",value:function(r){var n=this;this.inited?console.warn("[instance: ".concat(this.name,"], every instance's api: init,  can be call only one time!")):r&&isObject(r)?r.app_id&&isNumber(r.app_id)?!r.app_key||isString(r.app_key)?(r.channel_domain||-1!==["cn","sg","va"].indexOf(r.channel)||(console.warn("channel must be `cn`, `sg`,`va` !!!"),r.channel="cn"),this.logger=new Logger(this.name,r.log),this.appBridge=new AppBridge(this,r.Native),this.bridgeReport=this.appBridge.bridgeInject(),this.configManager=new ConfigManager(this,r),this.debugger=new Debugger(this,r),this.initConfig=r,this.emit(Types.Init),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK æ‰§è¡ŒINIT",data:r,level:"info",time:Date.now()}),r.disable_auto_pv&&(this.disableAutoPageView=!0),this.bridgeReport||(this.configManager.set({app_id:r.app_id}),this.eventManager=new Event$1,this.tokenManager=new Token,this.sessionManager=new Session,Promise.all([new Promise((function(e){n.once(Types.TokenComplete,(function(){e(!0)}))})),new Promise((function(e){n.once(Types.Start,(function(){e(!0)}))}))]).then((function(){try{t.plugins.reduce((function(e,t){var r=t.plugin,i=t.options,a=Object.assign(n.initConfig,i),o=new r;return o.apply(n,a),e.push(o),e}),n.pluginInstances)}catch(e){console.log("load plugin error, ".concat(e.message)),n.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:e.message})}n.sdkReady=!0,n.emit(Types.Ready),n.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK åˆå§‹åŒ–å®Œæˆ",time:Date.now(),level:"info",data:n.configManager.get("user")}),n.logger.info("appid: ".concat(r.app_id,", userInfo:").concat(JSON.stringify(n.configManager.get("user")))),n.logger.info("appid: ".concat(r.app_id,", sdk is ready, version is ").concat(SDK_VERSION,", you can report now !!!")),r.disable_auto_pv&&(n.disableAutoPageView=!0);try{(r.enable_ab_test||r.autotrack)&&(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(e){n.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:e.message})}n.pageView(),n.on(Types.TokenChange,(function(e){"webid"===e&&n.pageView(),n.logger.info("appid: ".concat(r.app_id," token change, new userInfo:").concat(JSON.stringify(n.configManager.get("user")))),n.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK è®¾ç½®äº†ç”¨æˆ·ä¿¡æ¯",time:Date.now(),secType:"USER",level:"info",data:n.configManager.get("user")})})),n.on(Types.TokenReset,(function(){n.logger.info("appid: ".concat(r.app_id," token reset, new userInfo:").concat(JSON.stringify(n.configManager.get("user")))),n.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK é‡ç½®äº†ç”¨æˆ·ä¿¡æ¯",time:Date.now(),secType:"USER",level:"info",data:n.configManager.get("user")})})),n.on(Types.RouteChange,(function(e){e.init||r.disable_route_report||n.pageView()}));try{(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(e){}})),this.tokenManager.apply(this,r),this.eventManager.apply(this,r),this.sessionManager.apply(this,r)),this.inited=!0):console.warn("app_key param is error, must be string, please check!"):console.warn("app_id param is error, must be number, please check!"):console.warn("init params error,please check")}},{key:"config",value:function(e){if(this.inited)if(e&&isObject(e))if(this.bridgeReport)this.appBridge.setConfig(e);else{e._staging_flag&&1===e._staging_flag&&(this.staging=!0),e.disable_auto_pv&&(this.disableAutoPageView=!0,delete e.disable_auto_pv);var t=_objectSpread2$7({},e);if(this.initConfig&&this.initConfig.configPersist){var r=this.configManager.getStore();r&&(t=Object.assign(r,e)),this.configManager.setStore(e)}var n=t;n.web_id,n.user_unique_id;var i=_objectWithoutProperties$3(n,_excluded);t.hasOwnProperty("web_id")&&this.emit(Types.ConfigWebId,t.web_id),t.hasOwnProperty("user_unique_id")&&this.emit(Types.ConfigUuid,t.user_unique_id),this.configManager.set(i),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK æ‰§è¡ŒCONFIG",level:"info",time:Date.now(),data:t})}else console.warn("config params is error, please check");else console.warn("config must be use after function init")}},{key:"setDomain",value:function(e){this.configManager&&this.configManager.setDomain(e),this.emit(Types.ConfigDomain)}},{key:"getConfig",value:function(e){return this.configManager.get(e)}},{key:"send",value:function(){this.start()}},{key:"start",value:function(){this.inited&&!this.sended&&(this.sended=!0,this.emit(Types.Start),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK æ‰§è¡ŒSTART",level:"info",time:Date.now()}),this.bridgeReport&&(this.pageView(),this.emit(Types.Ready)))}},{key:"event",value:function(t,r){var n=this;try{if(this.initConfig&&this.initConfig.disable_track_event)return;var i=[];Array.isArray(t)?t.forEach((function(e){i.push(n.processEvent(e[0],e[1]||{}))})):i.push(this.processEvent(t,r)),this.bridgeReport?i.forEach((function(e){var t=e.event,r=e.params;n.appBridge.onEventV3(t,JSON.stringify(r))})):i.length&&(this.emit(Types.Event,i),this.emit(Types.SessionResetTime))}catch(e){console.warn("something error, please check"),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:e.message})}}},{key:"beconEvent",value:function(e,t){if(!this.initConfig||!this.initConfig.disable_track_event)if(Array.isArray(e))console.warn("beconEvent not support batch report, please check");else{var r=[];r.push(this.processEvent(e,t||{})),r.length&&(this.emit(Types.BeconEvent,r),this.emit(Types.SessionResetTime))}}},{key:"processEvent",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var n=/^event\./,i=t;n.test(t)&&(i=t.slice(6));var a,o=r;"object"!==_typeof$7(o)&&(o={}),o.profile?delete o.profile:o.event_index=getIndex(),o.local_ms?(a=o.local_ms,delete o.local_ms):a=+new Date;var s={event:i,params:o,local_time_ms:a,is_bav:this.initConfig&&this.initConfig.autotrack?1:0};return s}catch(e){return this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"å‘ç”Ÿäº†å¼‚å¸¸",level:"error",time:Date.now(),data:e.message}),{event:t,params:r}}}},{key:"filterEvent",value:function(e){this.eventFilter=e}},{key:"on",value:function(e,t){this.hook.on(e,t)}},{key:"once",value:function(e,t){this.hook.once(e,t)}},{key:"off",value:function(e,t){this.hook.off(e,t)}},{key:"emit",value:function(e,t,r){this.hook.emit(e,t,r)}},{key:"set",value:function(e){this.hook.set(e)}},{key:"pageView",value:function(){this.disableAutoPageView||this.predefinePageView()}},{key:"predefinePageView",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={title:document.title||location.pathname,url:location.href,url_path:location.pathname,time:Date.now(),referrer:window.document.referrer,$is_first_time:"".concat(this.configManager.is_first_time)},r=_objectSpread2$7(_objectSpread2$7({},t),e);this.event("predefine_pageview",r)}},{key:"clearEventCache",value:function(){this.emit(Types.CleanEvents)}},{key:"setWebIDviaUnionID",value:function(e){if(e){var t=hashCode(e);this.config({web_id:"".concat(t),wechat_unionid:e}),this.emit(Types.CustomWebId)}}},{key:"setWebId",value:function(e){this.config({web_id:"".concat(e)})}},{key:"setWebIDviaOpenID",value:function(e){if(e){var t=hashCode(e);this.config({web_id:"".concat(t),wechat_openid:e}),this.emit(Types.CustomWebId)}}},{key:"setNativeAppId",value:function(e){this.bridgeReport&&this.appBridge.setNativeAppId(e)}},{key:"resetStayDuration",value:function(e,t,r){this.emit(Types.ResetStay,{url_path:e,title:t,url:r},Types.Stay)}},{key:"resetStayParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.emit(Types.SetStay,{url_path:e,title:t,url:r},Types.Stay)}},{key:"getToken",value:function(e,t){var r=this,n=!1,i=function(t){if(!n){n=!0;var i=r.configManager.get().user;return t&&(i.tobid=t,i["diss".split("").reverse().join("")]=t),e(_objectSpread2$7({},i))}},a=function(){r.tokenManager.getTobId().then((function(e){i(e)}))};this.sdkReady?a():(t&&setTimeout((function(){i()}),t),this.on(Types.Ready,(function(){a()})))}},{key:"profileSet",value:function(e){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(e)):this.emit(Types.ProfileSet,e,Types.Profile),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK æ‰§è¡ŒprofileSet",level:"info",time:Date.now(),data:e})}},{key:"profileSetOnce",value:function(e){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(e)):this.emit(Types.ProfileSetOnce,e,Types.Profile),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK æ‰§è¡ŒprofileSetOnce",level:"info",time:Date.now(),data:e})}},{key:"profileIncrement",value:function(e){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(e)):this.emit(Types.ProfileIncrement,e,Types.Profile),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK æ‰§è¡ŒprofileIncrement",level:"info",time:Date.now(),data:e})}},{key:"profileUnset",value:function(e){this.bridgeReport?this.appBridge.profileUnset(e):this.emit(Types.ProfileUnset,e,Types.Profile),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK æ‰§è¡ŒprofileUnset",level:"info",time:Date.now(),data:e})}},{key:"profileAppend",value:function(e){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(e)):this.emit(Types.ProfileAppend,e,Types.Profile),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK æ‰§è¡ŒprofileAppend",level:"info",time:Date.now(),data:e})}},{key:"setExternalAbVersion",value:function(e){this.emit(Types.AbExternalVersion,"string"==typeof e&&e?"".concat(e).trim():null,Types.Ab)}},{key:"getVar",value:function(e,t,r){this.emit(Types.AbVar,{name:e,defaultValue:t,callback:r},Types.Ab)}},{key:"getABconfig",value:function(e,t){this.emit(Types.AbConfig,{params:e,callback:t},Types.Ab)}},{key:"getAbSdkVersion",value:function(){return this.configManager.getAbVersion()}},{key:"onAbSdkVersionChange",value:function(e){var t=this;return this.emit(Types.AbVersionChangeOn,e,Types.Ab),function(){t.emit(Types.AbVersionChangeOff,e,Types.Ab)}}},{key:"offAbSdkVersionChange",value:function(e){this.emit(Types.AbVersionChangeOff,e,Types.Ab)}},{key:"openOverlayer",value:function(){this.emit(Types.AbOpenLayer,"",Types.Ab)}},{key:"closeOverlayer",value:function(){this.emit(Types.AbCloseLayer,"",Types.Ab)}},{key:"getAllVars",value:function(e){this.emit(Types.AbAllVars,e,Types.Ab)}},{key:"autoInitializationRangers",value:function(e){AutoBase(e)}},{key:"destoryInstace",value:function(){this.destroyInstance||(this.destroyInstance=!0,this.off(Types.TokenComplete))}}],[{key:"usePlugin",value:function(e,r,n){if(r){for(var i=!1,a=0,o=t.plugins.length;a<o;a++){if(t.plugins[a].name===r){t.plugins[a].plugin=e,t.plugins[a].options=n||{},i=!0;break}}i||t.plugins.push({name:r,plugin:e,options:n})}else t.plugins.push({plugin:e})}}]),t}(),Collector=_Collector;function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function asyncGeneratorStep(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(error){return void r(error)}s.done?t(u):Promise.resolve(u).then(n,i)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}Collector.plugins=[];var runtime_1=createCommonjsModule((function(e){var t=function(e){var t,r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(x){u=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i=t&&t.prototype instanceof y?t:y,a=Object.create(i.prototype),o=new I(n||[]);return a._invoke=function(e,t,r){var n=d;return function(i,a){if(n===f)throw new Error("Generator is already running");if(n===p){if("throw"===i)throw a;return P()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=w(o,r);if(s){if(s===g)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===d)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=f;var u=l(e,t,r);if("normal"===u.type){if(n=r.done?p:h,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=p,r.method="throw",r.arg=u.arg)}}}(e,r,o),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(x){return{type:"throw",arg:x}}}e.wrap=c;var d="suspendedStart",h="suspendedYield",f="executing",p="completed",g={};function y(){}function m(){}function v(){}var _={};_[a]=function(){return this};var b=Object.getPrototypeOf,A=b&&b(b($([])));A&&A!==r&&n.call(A,a)&&(_=A);var E=v.prototype=y.prototype=Object.create(_);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(i,a,o,s){var u=l(e[i],e,a);if("throw"!==u.type){var c=u.arg,d=c.value;return d&&"object"===_typeof$7(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return r("throw",e,o,s)}))}s(u.arg)}var i;this._invoke=function(e,n){function a(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(a,a):a()}}function w(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,w(e,r),"throw"===r.method))return g;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var i=l(n,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function $(e){if(e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}return{next:P}}function P(){return{value:t,done:!0}}return m.prototype=E.constructor=v,v.constructor=m,m.displayName=u(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,s,"GeneratorFunction")),e.prototype=Object.create(E),e},e.awrap=function(e){return{__await:e}},S(T.prototype),T.prototype[o]=function(){return this},e.AsyncIterator=T,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new T(c(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},S(E),u(E,s,"Generator"),E[a]=function(){return this},E.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=$,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return s.type="throw",s.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;k(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:$(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}(e.exports);try{regeneratorRuntime=t}catch(accidentalStrictMode){Function("r","regeneratorRuntime = r")(t)}})),device_id_key="xgplayer_device_id",user_id_key="xgplayer_user_id",getCookie=function(e){if(!document.cookie)return null;for(var t=document.cookie.split(";"),r=0,n=t.length;r<n;r++){var i=t[r];if(t[r].indexOf(e)>=0)return i.split("=")[1]||null}},genRandomID=function(e){return String(Math.floor(Math.random()*Math.pow(10,e)))},getDeviceID=function(){var e=getCookie(device_id_key);if(e)return e;var t=genRandomID(11);return document.cookie=device_id_key+"="+t+";max-age=31536000;path=/",t},getUserId=function(){var e=getCookie(user_id_key);if(e)return e;var t=genRandomID(12);return document.cookie=user_id_key+"="+t+";max-age=31536000;path=/",t},getLogId=function(){return genRandomID(12)};function getBrowser(){var e=navigator.userAgent.toLowerCase(),t={},r={IE:window.ActiveXObject||"ActiveXObject"in window,Chrome:e.indexOf("chrome")>-1&&e.indexOf("safari")>-1,Firefox:e.indexOf("firefox")>-1,Opera:e.indexOf("opera")>-1,Safari:e.indexOf("safari")>-1&&-1==e.indexOf("chrome"),Edge:e.indexOf("edge")>-1,QQBrowser:/qqbrowser/.test(e),WeixinBrowser:/MicroMessenger/i.test(e)};for(var n in r)if(r[n]){var i="";if("IE"===n)i=e.match(/(msie\s|trident.*rv:)([\w.]+)/)[2];else if("Chrome"===n){for(var a in navigator.mimeTypes)"application/360softmgrplugin"===navigator.mimeTypes[a].type&&(n="360");var o=e.match(/chrome\/([\d.]+)/);i=o?o[1]:"-1"}else if("Firefox"===n){var s=e.match(/firefox\/([\d.]+)/);i=s?s[1]:"-1"}else if("Opera"===n){var u=e.match(/opera\/([\d.]+)/);i=u?u[1]:"-1"}else if("Safari"===n){var c=e.match(/version\/([\d.]+)/);i=c?c[1]:"-1"}else if("Edge"===n){var l=e.match(/edge\/([\d.]+)/);i=l?l[1]:"-1"}else if("QQBrowser"===n){var d=e.match(/qqbrowser\/([\d.]+)/);i=d?d[1]:"-1"}t.type=n,t.versions=parseInt(i)}return t}var sniffer={get device(){return sniffer.os.isPc?"pc":"mobile"},get browser(){var e=getBrowser();return e.type+"_"+e.versions},get os(){var e=navigator.userAgent;navigator.platform.toLowerCase();var t=/(?:Windows Phone)/.test(e),r=/(?:SymbianOS)/.test(e)||t,n=/(?:Android)/.test(e),i=/(?:Firefox)/.test(e),a=/(?:iPad|PlayBook)/.test(e)||n&&!/(?:Mobile)/.test(e)||i&&/(?:Tablet)/.test(e),o=/(?:iPhone)/.test(e)&&!a;return{isTablet:a,isPhone:o,isAndroid:n,isPc:!(o||n||r||a),isSymbian:r,isWindowsPhone:t,isFireFox:i}},get operation_os(){for(var e=navigator.userAgent,t=[{s:"windows",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1|Windows 8.1|Windows NT 6.3|Windows 8|Windows NT 6.2|Windows 7|Windows NT 6.1)/},{s:"android",r:/Android/},{s:"linux",r:/(Linux|X11)/},{s:"ios",r:/(iPhone|iPad|iPod)/},{s:"mac",r:/Mac OS X/},{s:"mac",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],r=0;r<t.length;r++){var n=t[r];if(n.r.test(e))return n.s}return"unknown"}};function getCurrentTime(){return(new Date).getTime()}function getPlayFormat(e){var t="unknown";return"string"!=typeof e?t:e.indexOf(".flv")>-1?"flv":e.indexOf(".m3u8")>-1?"m3u8":e.indexOf(".mp4")>-1?"mp4":e.indexOf(".sdp")>-1?"rts":t}function getPlayerCore(e){if(e.plugins){if(e.plugins.flv)return e.plugins.flv;if(e.plugins.hls)return e.plugins.hls;if(e.plugins.rts)return e.plugins.rts;if(e.plugins.flvlive)return e.plugins.flvlive;if(e.plugins.hlslive)return e.plugins.hlslive;if(e.plugins.hlsvod)return e.plugins.hlsvod;if(e.plugins.hlslivemobile)return e.plugins.hlslivemobile;if(e.plugins.flvlivemobile)return e.plugins.flvlivemobile}return e.newHls||e.newFlv||e.__core__||e.flv}function getDefaultOptions(e){return{device_id:e.device_id||getDeviceID(),user_id:e.user_id||getUserId(),error_report_stop:!!e.error_report_stop,project_key:e.project_key||"xigua_live",product_line:e.product_line||"live",onReport:e.onReport||function(){}}}function getDefaultLog(){return{start_play:{start_play_time:0,event_key:"start_play"},first_frame:{start:0,first_frame_view:0,event_key:"first_frame",first_sei_delay:0,ntp_sync:0,ntp_delta:0,ttfb:-1,ttdb:-1,ttfb_end:0},first_frame_failed:{code:void 0,msg:"",event_key:"first_frame_failed"},stall_start:{ready_state:-1,stall_start_time:0,event_key:"stall_start"},stalling:{event_key:"stalling"},stall:{reason:0,stall_start:0,stall_end:0,ready_state:0,event_key:"stall"},play_stop:{code:0,stop_time:0,drop_percent:0,is_stream_received:0,stall_count:0,stall_time:0,retry_count:0,duration:0,stall_count_per_100sec:0,stall_time_per_100sec:0,event_key:"play_stop",dns_parse_time:-1,redirect:-1,ttfb:-1,buffered:[],is_firstframe_received:0,meta:null},playing:{index:0,stall_count:0,stall_time:0,play_time:1e4,retry_count:0,is_last:0,video_buffer_time:0,audio_buffer_time:0,speed_switch_count:0,speed_switch_info:"none",download_speed:0,decode_fps:0,render_fps:0,drop_count:0,drop_percent:0,sei_source:"",sei_delay:0,ntp_sync:0,ntp_delta:0,event_key:"playing",stop_time:0,duration:0,stall_count_per_100sec:0,stall_time_per_100sec:0},play_error:{code:void 0,info:"",event_key:"play_error"},play_low_decode:{fps:-1,decode_fps:-1,bitrate:-1,url:-1,msg:"",event_key:"play_low_decode"},play_av_unsync:{aDts:-1,vDts:-1,frameLength:-1,currentTime:-1,duration:0,event_key:"play_av_unsync"},play_loadstream:{loadstream_url:"",event_key:"play_loadstream"},play_stream_loaded:{event_key:"play_stream_loaded"},play_metadata_loaded:{metadata_type:"",event_key:"play_metadata_loaded"},stream_exception:{event_key:"stream_exception"},pause:{event_key:"pause"},play_url_change:{event_key:"play_url_change"},source_opened:{event_key:"source_opened"},source_updateend:{event_key:"source_updateend"},play_result:{event_key:"play_result",result:0,threshold:15e3,is_threshold:0},degrade:{event_key:"degrade",payload:{}}}}function getCommonLog(e){var t=e.player,r=t.config.mediaType;return _objectSpread2({project_key:e.project_key,live_sdk_version:getPlayerCore(t)||t.hlsOps?"2":"-1",player_sdk_version:t.version,logger_version:"1.0.0-alpha.9",report_version:"5",product_line:e.product_line,user_id:e.user_id,device_id:e.device_id,logger_id:getLogId(),app_name:e.app_name,cdn_ip:e.cdn_ip,is_wasm:+(!!r&&"video"!==r),review_is_live:t.config.isLive?2:1,aid:e.aid,live_id:e.live_id||e.aid+"-"+e.user_id+"-"+Date.now(),is_preview:e.is_preview?1:0,codec_type:e.codec_type||"h264",width:Math.floor(t.config.width),height:Math.floor(t.config.height),browser:sniffer.browser,ua:navigator.userAgent,href:window.location.href,timestamp:0,logger_init_time:Date.now(),play_current_time:0,cdn_play_url:t.config.url&&t.config.url.startsWith("//")?window.location.protocol+t.config.url:t.config.url,play_format:getPlayFormat(t.config.url)},e.ext)}function Utf8ArrayToStr(e){var t,r,n,i,a,o;for(t="",n=e.length,r=0;r<n;)switch((i=e[r++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(i);break;case 12:case 13:a=e[r++],t+=String.fromCharCode((31&i)<<6|63&a);break;case 14:a=e[r++],o=e[r++],t+=String.fromCharCode((15&i)<<12|(63&a)<<6|(63&o)<<0)}return t}var getResourceTiming=function(e){var t=performance.getEntriesByType("resource").filter((function(t){return t.name===e}));if(t.length){var r=t[0],n=t[t.length-1];return{dns_parse_time:Number.parseInt(r.domainLookupEnd-r.domainLookupStart),redirect:Number.parseInt(r.redirectEnd-r.redirectStart),ttfb:Number.parseInt(n.responseStart-n.requestStart)}}return{dns_parse_time:-1,redirect:-1,ttfb:-1}},video_error={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"},channelMapAppId={cn:7497,va:7997},Tea=new Collector("xglive"),Manage=function(){function e(e){var t=e.user_id,r=e.device_id,n=e.channel,i=void 0===n?"cn":n,a=e.channel_domain;if(!Tea.inited){var o={app_id:channelMapAppId[i],channel:i};a&&(o.channel_domain=a),Tea.init(o),Tea.start(),Tea.inited=!0}var s={};t&&(s.user_unique_id=t),r&&(s.device_id=r),Tea.config(s),this.logOptions=e,this._player=e.player}var t=e.prototype;return t.push=function(e){var t=this._player.config.url;this._player.video&&(e.play_current_time=this._player.currentTime),e.cdn_play_url=t&&t.startsWith("//")?window.location.protocol+t:t,e.play_format=getPlayFormat(t),e.timestamp=getCurrentTime(),this.send(e)},t.send=function(e){e.event_key&&(this.logOptions.onReport&&this.logOptions.onReport(e.event_key,e),Tea.event(e.event_key,_objectSpread2({},e)))},e}(),navgatorOnlineSupported=function(){return void 0!==navigator.onLine},navigatorConnectionType=function(){var e=navigator.connection;return e&&(e.effectiveType||e.type)},getNetStat=function(){return navgatorOnlineSupported()?navigator.onLine?navigatorConnectionType()||sniffer.device:"none":"unknown"},videoEvts=["play","playing","pause","ended","error","seeking","seeked","timeupdate","waiting","canplay","canplaythrough","durationchange","ratechange","volumechange","loadeddata"],isSafari=!1,LoggerControl=function(){function e(e){this.options=e,this.logger=new XgLiveLogger(e),this.restart=this.restart.bind(this),this.bindUrlChange(),isSafari=sniffer.browser.includes("Safari")}var t=e.prototype;return t.restart=function(e){this.destroy("string"!=typeof e&&Boolean(e)),this.logger=new XgLiveLogger(this.options),this.bindUrlChange(),this.logger.reportStartPlay(),this.logger.handlePlayerComlete()},t.bindUrlChange=function(){this.options&&this.options.player&&!this.options.manual_restart&&this.options.player.on("urlchange",this.restart)},t.setNTP=function(e){this.logger.setNTP(e)},t.updateExt=function(e){this.options.ext=Object.assign(this.options.ext||{},e),this.logger&&this.logger.updateExt(e)},t.destroy=function(e){this.logger.destroy(e),this.logger=null,this.options&&this.options.player&&!this.options.manual_restart&&this.options.player.off("urlchange",this.restart)},e}(),XgLiveLogger=function(){function t(e){if(!e.player)throw new Error("option player is necessary");this.options=Object.assign({},e,getDefaultOptions(e)),this._player=this.options.player,this._url=this._player.config.url,this.project_key=e.project_key||"xigua_live",this.product_line=e.product_line||"live",this.ntpDelta=this.options.ntp?Date.now()-this.options.ntp:0,this.inWaitingStart=0,this.errorNumber=0,this.tempDroppedFrameCount=0,this.tempTotalFrameCount=0;this.options.reportURL?this.options.reportURL:this.options.overseas||"https://log.isnssdk.com/video/v1/live_log/".replace("isnssdk","snssdk"),this._logmanager=new Manage(this.options),this.init(),this.started=!1,this.destroyed=!1,this.completed=!1,this.firstFrameViewed=!1,this.cacheRtcStats={}}var r=t.prototype;return r.setNTP=function(e){this.options&&(this.options.ntp=e,this.ntpDelta=Date.now()-this.options.ntp)},r.init=function(){this.bindCtx(),this.initLog(),this.initEvt()},r.bindCtx=function(){this.handlePlayerComlete=this.handlePlayerComlete.bind(this),this.handlePlayerPlaying=this.handlePlayerPlaying.bind(this),this.destroyFunc=this.destroyFunc.bind(this),this.handleUserLeave=this.handleUserLeave.bind(this),this.handlePlayerError=this.handlePlayerError.bind(this),this.handlePlayerReady=this.handlePlayerReady.bind(this),this.handlePlayerWaiting=this.handlePlayerWaiting.bind(this),this.handleAVUnsync=this.handleAVUnsync.bind(this),this.handlePlayerPause=this.handlePlayerPause.bind(this),this.handleTTFB=this.handleTTFB.bind(this),this.handleUrlChange=this.handleUrlChange.bind(this),this.handleKeyframe=this.handleKeyframe.bind(this),this.handleSourceOpen=this.handleSourceOpen.bind(this),this.handleBufferAppend=this.handleBufferAppend.bind(this),this.handleCoreEvent=this.handleCoreEvent.bind(this),this.handleDegrade=this.handleDegrade.bind(this)},r.initLog=function(){var e=this,t=this.options,r=t.player,n=void 0!==r.hlsOps;this.commonParams=_objectSpread2({os:sniffer.operation_os},getCommonLog(t)),this.log=Object.assign({},getDefaultLog());var i=this;for(var a in this.log){var o=function(t){Object.defineProperty(e.log[a],t,{get:function(){return null==this["_"+t]?i.commonParams[t]:this["_"+t]},set:function(e){this["_"+t]=e},enumerable:!0})};for(var s in this.commonParams)o(s);n&&Object.defineProperty(this.log[a],"m3u8",{get:function(){if(r.__core__){var e=r.__core__.m3u8Text;return e?e.slice(0,25e4):""}return""},enumerable:!0}),Object.defineProperty(this.log[a],"volume",{get:function(){if(r&&r.video)return r.volume||0},enumerable:!0}),Object.defineProperty(this.log[a],"access",{get:function(){return getNetStat()},enumerable:!0})}},r.updateExt=function(e){for(var t in this.log)for(var r in e)this.log[t][r]=e[r]},r.reportStartPlay=function(){this.started||(this.started=!0,this.log.start_play.start_play_time=this.log.start_play.timestamp=getCurrentTime(),this.logmanager.push(this.log.start_play,!0))},r.initWindowListener=function(){"pc"===sniffer.device?window.addEventListener("beforeunload",this.handleUserLeave):"mobile"===sniffer.device&&(window.addEventListener("beforeunload",this.handleUserLeave),window.addEventListener("pagehide",this.handleUserLeave))},r.removeWindowListener=function(){"pc"===sniffer.device?window.removeEventListener("beforeunload",this.handleUserLeave):"mobile"===sniffer.device&&(window.removeEventListener("beforeunload",this.handleUserLeave),window.removeEventListener("pagehide",this.handleUserLeave))},r.initEvt=function(){var e=this,t=this.player;videoEvts.forEach((function(t){e["handleVideo"+t+"Evt"]=function(){e["handleVideo"+t]&&e["handleVideo"+t]()},e.initWindowListener(),e.bindVideoEvt(t,e["handleVideo"+t+"Evt"])})),t.once("error",this.handlePlayerError),t.once("complete",this.handlePlayerComlete),t.once("playing",this.handlePlayerPlaying),t.once("timeupdate",this.handlePlayerPlaying),t.once("destroy",this.destroyFunc),t.on("ready",this.handlePlayerReady),t.on("waiting",this.handlePlayerWaiting),t.on("pause",this.handlePlayerPause),t.on("urlchange",this.handleUrlChange),t.once("sourceopen",this.handleSourceOpen),t.once("bufferappend",this.handleBufferAppend),t.on("core_event",this.handleCoreEvent),t.on("degrade",this.handleDegrade),this.hiJackPlayerStart()},r.handleCoreEvent=function(e){var t=e.eventName,r=e.headers,n=e.pts,i=e.type,a=e.meta,o=e.sei,s=e.decodeFps,u=e.url;switch(t){case"core.ttfb":this.handleTTFB(e);break;case"core.loadresponseheaders":var c=r.get("X-Server-Ip");void 0!==this.player.hlsOps&&(this.log.play_stop.review_ts_count+=1),c&&(this.commonParams.cdn_ip=c);break;case"core.loadretry":this.log.play_stop.retry_count++;break;case"core.keyframe":this.handleKeyframe(n);break;case"core.metadataparsed":this.handleMetaDataLoaded(i,a);break;case"core.sei":this.handleSEIParsed(o);break;case"core.lowdecode":this.commonParams.is_wasm&&(Object.assign(this.log.play_low_decode,e||{}),this.log.play_low_decode.decode_fps=s,this.log.play_low_decode.timestamp=getCurrentTime(),this.logmanager.push(this.log.play_low_decode,!0),this.commonParams.is_wasm=0);break;case"core.largeavgap":this.handleAVUnsync(e);break;case"core.loadstart":this.handlePlayerLoadStream(u);break;case"core.loadcomplete":this.handlePlayerLoadedStream();break;case"core.streamexception":this.handleStreamException(e)}},r.handleDegrade=function(e){this.log.degrade.payload=e,this.logmanager.push(this.log.degrade,!0)},r.hiJackPlayerStart=function(){var t=arguments,r=this;this.player._start=this.player.start;var n=this.player;n.start=function(){try{if(n._start)return n._start.apply(n,Array.prototype.slice.call(t,0))}catch(e){}r.destroyed||r.handlePlayerComlete()}},r.handleTTFB=function(e){var t=e||{},r=t.end,n=t.elapsed;this.log.first_frame.ttfb=n||-1,this.log.first_frame.ttfb_end=r||0},r.handleUrlChange=function(e){this.logmanager.push(Object.assign(this.log.play_url_change,{url:e,timestamp:getCurrentTime()}))},r.handleKeyframe=function(e){this.log.play_stop.is_firstframe_received=1,this.log.play_stop.firstframe_pts=e},r.handleSourceOpen=function(){this.log.source_opened.timestamp=getCurrentTime(),this.logmanager.push(this.log.source_opened)},r.handleBufferAppend=function(){this.log.source_updateend.timestamp=getCurrentTime(),this.logmanager.push(this.log.source_updateend)},r.handlePlayerPause=function(){this.log.pause.timestamp=getCurrentTime(),this.logmanager.push(this.log.pause,!0)},r.handlePlayerError=function(e){this.errorNumber=1;var t=e.errorType,r=e.errorCode;Object.assign(this.log.play_error,_objectSpread2({timestamp:getCurrentTime(),code:r||("parse"===t?31:21),info:e.message,detail:JSON.stringify(e)},this.videoSize)),this.logmanager.push(this.log.play_error,!0),this.destroyed||(0===this.log.first_frame.first_frame_view&&(Object.assign(this.log.first_frame_failed,{code:r||("parse"===t?31:21),msg:e.message}),void 0!==this.log.first_frame_failed.timestamp&&(this.log.first_frame_failed.timestamp=getCurrentTime()),this.logmanager.push(this.log.first_frame_failed,!0),this.log.play_result.is_threshold||(this.clearPlayResultTimer(),this.log.play_result.reason=e.message||"first frame failed",this.logmanager.push(this.log.play_result,!0))),this.options.error_report_stop?this.handleUserLeave():this.updatePlayStopParams())},r.handlePlayerLoadStream=function(e){if("string"==typeof e){var t=this.log.play_loadstream;t.timestamp=getCurrentTime(),t.loadstream_url=e,this.logmanager.push(t)}},r.handlePlayerLoadedStream=function(){var e=this.log.play_stream_loaded;e.timestamp=getCurrentTime(),this.logmanager.push(e)},r.handleSEIParsed=function(t){var r=this.log,n=r.playing,i=r.first_frame;if(100===t.code){var a=Utf8ArrayToStr(t.content);a=a.slice(a.indexOf("{"),a.lastIndexOf("}")+1);try{var o=JSON.parse(a),s=this.getPlayerBuffer()+this.ntpTime-o.ts;n.sei_delay=s,n.sei_source=o.source,n.ntp_sync=this.options.ntp?1:0,n.ntp_delta=this.ntp_delta,i.first_sei_delay=s,i.ntp_sync=this.options.ntp?1:0,i.ntp_delta=this.ntp_delta}catch(e){}}},r.handleMetaDataLoaded=function(e,t){this.log.play_stop.meta=this.log.play_stop.meta||{},e&&(this.log.play_stop.meta[e]=t),this.log.play_metadata_loaded.timestamp=getCurrentTime(),this.log.play_metadata_loaded.metadata_type=e,t&&(this.log.play_metadata_loaded.meta=t,this.log.play_metadata_loaded.codec=t.codec,this.commonParams.codec_type=t.codec),t||(this.log.play_metadata_loaded.meta=void 0,this.log.play_metadata_loaded.codec=void 0,"video"===e&&(this.commonParams.codec_type="unknown")),this.logmanager.push(this.log.play_metadata_loaded)},r.handleAVUnsync=function(e){Object.assign(this.log.play_av_unsync,e||{}),this.log.play_av_unsync.timestamp=getCurrentTime(),this.logmanager.push(this.log.play_av_unsync,!1)},r.handleStreamException=function(e){this.logmanager.push(Object.assign({},this.log.stream_exception,e))},r.handlePlayerComlete=function(){this.completed||(this.completed=!0,this.core=getPlayerCore(this.player),this.core&&(this.commonParams.live_sdk_version="2"),(this.player.config.autoplay||this.player.config.videoInit)&&this.reportStartPlay())},r.getPlayerBuffer=function(){var t=this.player.video.buffered;if(t){var r=Math.max(0,t.length-1);try{var n=Number.parseInt(1e3*(t.end(r)-this.player.video.currentTime));return this.log.playing.audio_buffer_time=this.log.playing.video_buffer_time=n,n}catch(e){return 0}}},r.getPlayerDownloadSpeed=function(){if(this.core&&this.core.core)return this.core.core.speedInfo().speed},r.getPlayerQuality=function(){var e=this.player.video;if(e.getVideoPlaybackQuality){var t=e.getVideoPlaybackQuality();this.log.playing.drop_count=t.droppedVideoFrames-this.tempDroppedFrameCount,this.log.playing.drop_percent=Number.parseFloat(this.tempTotalFrameCount/t.totalVideoFrames).toFixed(1),this.log.play_stop.drop_percent=Number.parseFloat(t.droppedVideoFrames/t.totalVideoFrames).toFixed(1),this.tempDroppedFrameCount=t.droppedVideoFrames,this.tempTotalFrameCount=t.totalVideoFrames}},r.getExtraStats=function(){var e=_asyncToGenerator(runtime_1.mark((function e(t,r){return runtime_1.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){if(isSafari||"undefined"!==window.InstallTrigger)return e();try{t.getStats((function(t){t.result().forEach((function(e){var t={};e.names().forEach((function(r){t[r]=e.stat(r)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,"ssrc"===e.type?(null!=t.googAccelerateRate&&(r.accelerate_rate=t.googAccelerateRate),"audio"===t.mediaType?(r.audio_jitter_buffer_ms=t.googJitterBufferMs,r.audio_rtt_ms=t.googRtt,r.expand_rate=t.googExpandRate):"video"===t.mediaType&&(r.video_rtt_ms=t.googRtt,r.video_codec_name=t.googCodecName)):"VideoBwe"===e.type&&(r.video_recv_retransmit_bps=t.googRetransmitBitrate)})),e()}))}catch(error){e()}})));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),r.getRtcStats=function(){var e=_asyncToGenerator(runtime_1.mark((function e(t){var r,n,i,a,o=this;return runtime_1.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.player.plugins.rts&&this.player.plugins.rts.pc){e.next=3;break}return e.abrupt("return");case 3:return n={},e.next=6,r.getStats();case 6:return i=e.sent,a=t-this.log.playing.timestamp,i.forEach((function(e){var t=e.type,r=e.mediaType,i=e.bytesReceived,s=e.packetsReceived,u=e.audioLevel,c=e.concealmentEvents,l=e.remoteTimestamp,d=e.timestamp,h=e.framesDropped,f=e.framesPerSecond,p=e.keyFramesDecoded,g=e.totalDecodeTime,y=e.framesDecoded,m=e.firCount,v=e.frameHeight,_=e.frameWidth,b=e.framesReceived,A=e.jitterBufferDelay,E=e.jitterBufferEmittedCount,S=e.jitter,T=e.nackCount,w=e.packetsLost,C=e.pliCount,k=e.totalSamplesReceived,I=e.concealedSamples;switch(t){case"inbound-rtp":"audio"===r?(n.audio_bytes_received=i,n.audio_packets_lost=w,n.audio_packets_received=s,n.audio_volume=-10*Math.log10(Math.pow(u,2))*255,n.concealment_event=c,n.audio_fraction_lost=w/s,null!=o.cacheRtcStats.totalSamplesReceived&&(n.audio_dec_sample_rate=(k-o.cacheRtcStats.totalSamplesReceived)/a),o.cacheRtcStats.totalSamplesReceived=k,n.concealed_samples=I,n.total_samples_received=k):(n.frames_dropped_by_framebuffer=h,n.frame_buffer_out_interval=f,n.iframes_jitter_buffer_out=p,n.video_bytes_received=i,n.video_dec_elapse=1e3*g,n.video_decoded_delay_ms=n.video_dec_elapse/y,n.video_fir_count=m,n.video_fraction_lost=w/s,n.video_frame_height=v,n.video_frame_width=_,null!=o.cacheRtcStats.framesDecoded&&(n.video_framerate_decoder_output=(y-o.cacheRtcStats.framesDecoded)/a),o.cacheRtcStats.framesDecoded=y,null!=o.cacheRtcStats.framesReceived&&(n.video_framerate_recv=(b-o.cacheRtcStats.framesReceived)/a),o.cacheRtcStats.framesReceived=b,n.video_jb_min_delay=A/E*1e3,n.video_jitter=1e3*S,n.video_nack_count=T,n.video_packets_lost=w,n.video_packets_received=s,n.video_pli_count=C);break;case"remote-outbound-rtp":n.e2e_delay_ms=d-l}n.total_delay=n.e2e_delay_ms+n.video_decoded_delay_ms+n.video_jb_min_delay})),e.next=11,this.getExtraStats(r,n);case 11:this.log.playing.rtc_stats=n;case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.reportPlaying=function(){var e=_asyncToGenerator(runtime_1.mark((function e(t){var r,n,i,a,o,s;return runtime_1.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.commonParams.is_wasm&&(this.commonParams.fps=this.player.video.fps,this.log.playing.render_fps=this.player.video.fps,this.log.playing.decode_fps=this.player.video.decodeFps),this.log.playing.index++,r=this.log.playing.timestamp,this.inWaitingStart&&this.inWaitingStart<getCurrentTime()&&(n=Math.min(this.options.playingInterval||this.log.playing.play_time,getCurrentTime()-Math.max(this.inWaitingStart,r))),this.getPlayerQuality(),this.getPlayerBuffer(),this.options.downloadSpeedInterval||(this.log.playing.current_speed=this.getPlayerDownloadSpeed()),i=getCurrentTime(),e.next=10,this.getRtcStats(i);case 10:a=i-r,o=(n>200?n:0)+this.log.playing.stall_time,s=(n>200?1:0)+this.log.playing.stall_count,this.options.aggregationDowngradeStallTime&&(this.log.playing.aggregation_downgrade_stall=(n>this.options.aggregationDowngradeStallTime?n:0)+(this.log.playing.aggregation_downgrade_stall||0)),Object.assign(this.log.playing,_objectSpread2({timestamp:i,stop_time:i,duration:t?0:a/1e3,stall_time_per_100sec:o/a*100,stall_count_per_100sec:1e3*s/a*100,stall_count:s,stall_time:o,play_current_time:this.player.currentTime},this.videoSize)),this.logmanager.push(Object.assign({},this.log.playing,{play_time:t?0:a}),!0),this.log.playing.download_speed_array=[],this.log.playing.stall_time=0,this.log.playing.stall_count=0,this.options.aggregationDowngradeStallTime&&(this.log.playing.aggregation_downgrade_stall=0);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.handlePlayerPlaying=function(){var e=_asyncToGenerator(runtime_1.mark((function e(){var t,r=this;return runtime_1.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.player&&this.player.video.readyState<3)){e.next=2;break}return e.abrupt("return");case 2:return this.player.off("playing",this.handlePlayerPlaying),this.player.off("timeupdate",this.handlePlayerPlaying),e.next=6,this.reportPlaying(!0);case 6:this.clearPlayingInterval(),t=this.options.playingInterval||this.log.playing.play_time,this.intervalId=setInterval(_asyncToGenerator(runtime_1.mark((function e(){return runtime_1.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Math.abs(Date.now()-r.log.playing.timestamp-t)<100||Date.now()-r.log.playing.timestamp>=t)){e.next=3;break}return e.next=3,r.reportPlaying();case 3:case"end":return e.stop()}}),e)}))),1e3),this.clearStallTimer(),this.handleVideoplaying(),this.started||this.reportStartPlay(),this.saveBuffered();case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.handlePlayerReady=function(){var e=this;this.log.start_play.start_play_time=getCurrentTime(),this.player.config.autoplay&&this.reportStartPlay(),this.options.playResultThreshold&&(this.log.play_result.threshold=this.options.playResultThreshold),this.clearPlayResultTimer(),this.playResultTimer=setTimeout((function(){e.log.play_result.is_threshold=1,e.logmanager.push(e.log.play_result,!0)}),this.log.play_result.threshold)},r.handlePlayerWaiting=function(){var e=this;!this.inWaitingStart&&this.log.first_frame.timestamp&&(this.log.stall.timestamp=this.inWaitingStart=this.log.stall.stall_start=getCurrentTime(),this.log.stall_start.ready_state=this.log.stall.ready_state=this.player.video.readyState,this.log.stall_start.timestamp=getCurrentTime(),this.log.stall_start.stall_start_time=getCurrentTime(),this.log.stall_start.video_buffer_time=this.player.video.readyState,this.log.stall_start.play_current_time=this.player.currentTime,this.log.stall.play_current_time=this.player.currentTime,this.log.stall_start.buffered=this.getBuffered(),this.log.stall.buffered=this.log.stall_start.buffered,this.log.stall.current_speed=this.getPlayerDownloadSpeed(),Object.assign(this.log.stall_start,this.videoSize),this.clearStallTimer(),this.stallStartTimer=setTimeout((function(){e.logmanager.push(e.log.stall_start,!0)}),205))},r.handleVideoseeking=function(){this.player&&this.player.video&&this.inWaitingStart&&this.player.video.duration<1/0&&(this.inWaitingStart=0,this.clearStallTimer())},r.handleVideoseeked=function(){this.player&&this.player.video&&this.inWaitingStart&&this.player.video.duration<1/0&&(this.inWaitingStart=0,this.log.play_stop.stall_count>0&&this.log.play_stop.stall_count--)},r.handleVideoplay=function(){this.reportStartPlay(),this.removeVideoEvt("play",this.handleVideoplay)},r.handleVideotimeupdate=function(){Math.abs(this.player.currentTime-this.log.stall_start.play_current_time)>.2&&this.stallEnd(),this.saveBuffered()},r.handleVideocanplay=function(){this.stallEnd(),this.reportFirstframe()},r.handleVideoplaying=function(){this.stallEnd(),this.log.play_stop.is_stream_received=1;var e=getCurrentTime();this.reportStartPlay(),this.log.first_frame.start=e},r.stallEnd=function(){this.clearStallTimer();var e=getCurrentTime();if(this.inWaitingStart){var t=e-this.inWaitingStart;t>200&&(this.log.play_stop.stall_count++,this.log.play_stop.stall_time+=e-this.inWaitingStart,this.log.playing.stall_time+=e-Math.max(this.inWaitingStart,this.log.playing.timestamp),this.log.stall.stall_end=e,this.log.stall.timestamp=getCurrentTime(),this.log.playing.stall_count++,Object.assign(this.log.stall,_objectSpread2({},this.videoSize)),this.logmanager.push(this.log.stall,!0)),this.options.aggregationDowngradeStallTime&&t>this.options.aggregationDowngradeStallTime&&(this.log.playing.aggregation_downgrade_stall=(this.log.playing.aggregation_downgrade_stall||0)+(e-Math.max(this.inWaitingStart,this.log.playing.timestamp)))}this.inWaitingStart=0},r.handleVideoloadeddata=function(){this.reportFirstframe()},r.handleVideoratechange=function(){this.log.playing.speed_switch_count++,this.log.playing.speed_switch_info=this.player.video.playbackRate},r.handleVideoended=function(){this.clearPlayingInterval(),this.clearStallTimer(),Object.assign(this.log.playing,_objectSpread2({timestamp:getCurrentTime(),is_last:1},this.videoSize)),this.logmanager.push(this.log.playing)},r.handleVideoerror=function(){var e=this;this.errorNumber=1;var t=this.player.video.error;Object.assign(this.log.play_error,_objectSpread2(_objectSpread2({timestamp:getCurrentTime()},this.videoSize),t&&{code:t.code,info:t.message})),this.logmanager.push(this.log.play_error,!0),0!==e.log.first_frame.first_frame_view||e.log.first_frame_failed.code||t&&(e.log.first_frame_failed.code=t.code,e.log.first_frame_failed.msg=video_error[t.code],void 0!==e.log.first_frame_failed.timestamp&&(e.log.first_frame_failed.timestamp=getCurrentTime()),e.logmanager.push(e.log.first_frame_failed,!0),e.log.play_result.is_threshold||(e.log.play_result.reason=video_error[t.code]||"first frame failed",e.clearPlayResultTimer(),e.logmanager.push(e.log.play_result,!0))),e.options.error_report_stop?e.handleUserLeave():e.updatePlayStopParams()},r.handleVideopause=function(){this.stallEnd(),this.clearPlayingInterval(),this.clearStallTimer(),clearTimeout(this.collectDownloadSpeedTimer),this.player.once("playing",this.handlePlayerPlaying),this.player.once("timeupdate",this.handlePlayerPlaying)},r.destroyFunc=function(e){var t=this;this.destroyed||(e||this.handleUserLeave(),this.destroyed=!0,"pc"===sniffer.device?window.removeEventListener("beforeunload",this.handleUserLeave):"mobile"===sniffer.device&&window.removeEventListener("pagehide",this.handleUserLeave),videoEvts.forEach((function(e){t.removeVideoEvt(e,t["handleVideo"+e+"Evt"])})),this.player&&(this.player._start&&(this.player.start=this.player._start,delete this.player._start),this.player.off("destroy",this.destroyFunc),this.player.off("complete",this.handlePlayerComlete),this.player.off("playing",this.handlePlayerPlaying),this.player.off("timeupdate",this.handlePlayerPlaying),this.player.off("ready",this.handlePlayerReady),this.player.off("waiting",this.handlePlayerWaiting),this.player.off("largeavgap",this.handleAVUnsync),this.player.off("error",this.handlePlayerError),this.player.off("SEI_PARSED",this.handleSEIParsed),this.player.off("pause",this.handlePlayerPause),this.player.off("ttfb",this.handleTTFB),this.player.off("urlchange",this.handleUrlChange),this.player.off("isKeyframe",this.handleKeyframe),this.player.off("sourceopen",this.handleSourceOpen),this.player.off("bufferappend",this.handleBufferAppend),this.player.off("core_event",this.handleCoreEvent),this.player.off("degrade",this.handleDegrade),this.clearPlayingInterval(),this.clearStallTimer(),clearTimeout(this.collectDownloadSpeedTimer),this._player=null))},r.handleUserLeave=function(){!this.destroyed&&this.started&&(this.destroyed=!0,this.updatePlayStopParams(),this.reportPlayStop(),this.clearPlayingInterval(),this.clearStallTimer(),clearTimeout(this.collectDownloadSpeedTimer),this.removeWindowListener())},r.saveBuffered=function(){try{var e=this.getBuffered();e&&e.length&&(this.log.play_stop.buffered=e)}catch(error){}},r.getBuffered=function(){try{for(var e=[],t=this.player.video,r=0;r<t.buffered.length;r++)e.push([t.buffered.start(r),t.buffered.end(r)]);return e}catch(error){}},r.reportPlayStop=function(){this.log.play_stop.play_current_time=this.player.currentTime||this.log.playing.play_current_time,this.saveBuffered(),this.logmanager.push(this.log.play_stop,!0)},r.reportFirstframe=function(){if(!this.firstFrameViewed){this.firstFrameViewed=!0;var e=getCurrentTime();Object.assign(this.log.first_frame,_objectSpread2({first_frame_view:e-this.log.start_play.start_play_time||e,timestamp:e},this.videoSize)),this.log.first_frame.ttfb_end&&(this.log.first_frame.ttdb=e-this.log.first_frame.ttfb_end),this.logmanager.push(this.log.first_frame,!0),this.clearPlayResultTimer(),this.log.play_result.result=1,this.logmanager.push(this.log.play_result,!0),this.log.play_stop.is_stream_received=1}},r.updatePlayStopParams=function(){var e=getResourceTiming(this._url),t=getCurrentTime();this.playedTime=t-this.log.start_play.start_play_time;var r=this.log.play_stop;Object.assign(r,_objectSpread2({},0===r.stall_count&&{stall_time:0})),this.inWaitingStart&&t-this.inWaitingStart>200&&(r.stall_time+=t-this.inWaitingStart),this.inWaitingStart=0,Object.assign(r,_objectSpread2({stall_time_per_100sec:r.stall_time/this.playedTime*100,stall_count_per_100sec:1e3*r.stall_count/this.playedTime*100},e)),0===this.log.play_stop.stall_count_per_100sec&&(this.log.play_stop.stall_time_per_100sec=0),this.log.play_stop.stall_time_per_100sec>100||this.log.play_stop.stall_time_per_100sec<0||(this.log.playing.index?(Object.assign(this.log.playing,_objectSpread2({timestamp:getCurrentTime(),is_last:1},this.videoSize)),this.logmanager.push(this.log.playing,!0)):(this.log.play_stop.error_code=this.log.play_error.code,this.log.play_stop.error_info=this.log.play_error.info),t=getCurrentTime(),Object.assign(r,_objectSpread2({timestamp:t,stop_time:t,duration:this.playedTime/1e3,play_time:this.playedTime/1e3},this.videoSize)),0===this.errorNumber&&(r.play_time_on_no_frame=r.stop_time-this.log.start_play.start_play_time))},r.clearPlayingInterval=function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},r.clearStallTimer=function(){clearTimeout(this.stallStartTimer)},r.clearPlayResultTimer=function(){clearTimeout(this.playResultTimer)},r.destroy=function(e){this.destroyFunc(!e)},r.bindVideoEvt=function(e,t){this.player&&this.player.video.addEventListener(e,t,!1)},r.removeVideoEvt=function(e,t){this.player&&this.player.video&&this.player.video.removeEventListener(e,t,!1)},r.send=function(e,t){this.logmanager.send(e,t)},_createClass(t,[{key:"videoSize",get:function(){return this.player?{width:this.player.video.videoWidth,height:this.player.video.videoHeight}:{width:0,height:0}}},{key:"player",get:function(){return this._player}},{key:"logmanager",get:function(){return this._logmanager}},{key:"ntpTime",get:function(){return Date.now()-this.ntpDelta}}]),t}(),LiveLogger=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){return _classCallCheck$8(this,r),t.apply(this,arguments)}return _createClass$9(r,[{key:"afterCreate",value:function(){var e,t,r=this;this.config.enable&&(this.config.appId?(this.openLog(),null===(e=this.player.plugins)||void 0===e||null===(t=e.sdkerrorplugin)||void 0===t||t.addErrDetail((function(){var e,t,n;if(r._liveLogger)return{label:"userId",value:null===(e=r._liveLogger)||void 0===e||null===(t=e.logger)||void 0===t||null===(n=t.options)||void 0===n?void 0:n.user_id}}))):console.info("not found appid, logger is closed"))}},{key:"startLog",value:function(){this._liveLogger=new LoggerControl({player:this.player,aid:this.config.appId,project_key:this.config.appId,app_name:this.config.appId,channel_domain:"//mcs.volceapplog.com"})}},{key:"closeLog",value:function(){this._liveLogger.destroy(),this._liveLogger=null}},{key:"openLog",value:function(){!this._liveLogger&&this.startLog()}}],[{key:"pluginName",get:function(){return"liveLogger"}},{key:"defaultConfig",get:function(){return{appId:"",enable:!0}}}]),r}(Plugin);function createSDKPreset(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,a=["default",getDefaultPreset(e)],o=isEncryptPlay(null==i?void 0:i.getVideoByToken),s=getPluginConfig(i,"EncryptHlsPlugin")||"hls"===t&&o;return r?a.push(getMobilePreset(e,t,n,s,i)):a.push(getPCPreset(e,t,s,i)),a}function getDefaultPreset(e){var t=[UnmutePlugin,ErrorPlugin,ToastPlugin];return e&&t.push(RefreshPlugin,LiveLogger),_createClass$9((function e(){_classCallCheck$8(this,e),this.plugins=t,this.ignores=["error"]}))}function getMobilePreset(e,t,r,n,i){var a,o=["error","playbackRate"],s=null==i||null===(a=i.autoBitrateOpts)||void 0===a?void 0:a.isOpenAutoDefi;n||s&&!e||o.push("definition");var u=["time","playnext","progress","progresspreview","replay","playbackRate","discontinue","PlaybackRateMobilePlugin"],c=e?[MoreButtonPlugin,DanmuPlugin]:[MoreButtonPlugin];switch(t){case"flv":r&&c.push(FlvPlugin);break;case"hls":HlsPlugin.isSupported(!0)&&r&&c.push(HlsPlugin);break;case"rtm":c.push(RtmPlugin);break;case"dash":var l,d;if(i.url)c.push(ShakaJsPlugin);else null!=DASHPlugin&&null!==(l=DASHPlugin.encryptUtils)&&void 0!==l&&null!==(d=l.isSupported)&&void 0!==d&&d.call(l)&&c.push(DASHPlugin)}return _createClass$9((function r(){_classCallCheck$8(this,r),this.plugins=getPluginByConfig(t,n,i,c),this.ignores=e?[].concat(u,o):[].concat(o)}))}function getPCPreset(e,t,r,n){var i,a=["cssfullscreen"],o=["time","playnext","progress","progresspreview","replay","playbackRate","discontinue"],s=e?[MultilinePlugin,DanmuPlugin]:[],u=null==n||null===(i=n.autoBitrateOpts)||void 0===i?void 0:i.isOpenAutoDefi;switch(r||u&&!e||(a.push("definition"),s.push(DefinitionPlugin)),t){case"flv":s.push(FlvPlugin);break;case"hls":s.push(HlsPlugin);break;case"rtm":s.push(RtmPlugin);break;case"dash":n.url?s.push(ShakaJsPlugin):s.push(DASHPlugin)}return _createClass$9((function i(){_classCallCheck$8(this,i),this.plugins=getPluginByConfig(t,r,n,s),this.ignores=e?[].concat(o,a):[].concat(a)}))}function getPluginByConfig(e,t,r,n){var i,a=[],o=isEncryptPlay(null==r?void 0:r.getVideoByToken);t&&(a.push(EncryptHlsPlugin),n=n.filter((function(e){return e!==HlsPlugin}))),getPluginConfig(r,"DASHPlugin")&&!n.includes(DASHPlugin)&&a.push(DASHPlugin),getPluginConfig(r,"vodLogOpts")&&a.push(xgVodLogger),r.enableContextmenu&&a.push(MenuPlugin),(r.enableMp4MSE||getPluginConfig(r,"Mp4EncryptPlayer")||"mp4"===e&&(o||null!=r&&null!==(i=r.autoBitrateOpts)&&void 0!==i&&i.isOpenAutoDefi))&&a.push(Mp4EncryptPlayer),!n.includes(DanmuPlugin)&&getPluginConfig(r,"DanmuPlugin")&&a.push(DanmuPlugin);var s=a.filter((function(e){var t,r,n,i,a;return"encrypthlsplugin"===(null==e||null===(t=e.pluginName)||void 0===t?void 0:t.toLowerCase())?!(null==e||null===(n=e.isSupported)||void 0===n||!n.call(e))||(console.warn("è¯¥æµè§ˆå™¨çŽ¯å¢ƒä¸­ EncryptHlsPlugin æ’ä»¶ä¸æ”¯æŒ"),!1):"dashplugin"!==(null==e||null===(r=e.pluginName)||void 0===r?void 0:r.toLowerCase())||(!(null==e||null===(i=e.encryptUtils)||void 0===i||null===(a=i.isSupported)||void 0===a||!a.call(i))||(console.warn("è¯¥æµè§ˆå™¨çŽ¯å¢ƒä¸­ DASHPlugin æ’ä»¶ä¸æ”¯æŒ"),!1))}));return[].concat(_toConsumableArray$3(n),_toConsumableArray$3(s))}function danmuSettingsSVG$1(){return(new DOMParser).parseFromString('<svg width="22" height="19" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" opacity=".6"><path d="M-4-4h28v28H-4z"/><path d="M1 19a1 1 0 01-1-1V1a1 1 0 011-1h17.2a1 1 0 011 1v3.75h-.001l.001 1.475a.9.9 0 11-1.8 0V1.8H1.8v15.4h8.442l-.029.019h.296a.89.89 0 01.017 1.78h7.691L18.2 19H1z" fill="#FFF" fill-rule="nonzero"/><path d="M5.507 7.698L5.33 9.279h2.511c0 2.015-.075 3.362-.2 4.042-.151.68-.792 1.054-1.934 1.124-.327 0-.653-.023-1.005-.047l-.339-1.136c.327.035.678.059 1.03.059.628 0 .98-.188 1.067-.563.088-.374.138-1.183.138-2.424H4l.352-3.679h2.122V5.132H4.113V4.09h3.654v3.608h-2.26zm3.089-2.214h1.507A8.91 8.91 0 009.16 4.03l1.193-.375c.351.469.665.96.93 1.5l-.792.328h1.733a14.68 14.68 0 00.93-1.921l1.242.41a8.956 8.956 0 01-.854 1.51H15v4.933h-2.587v.902h2.446l-1.014 1.148h-1.432v2.097h-1.28v-2.097h-2.99v-1.148h2.99v-.902H8.595V5.484zm5.249 3.912v-.913h-1.432v.913h1.432zm-2.713 0v-.913H9.764v.913h1.368zm-1.368-1.92h1.368v-.961H9.764v.96zm2.65-.961v.96h1.43v-.96h-1.43z" fill="#FFF" fill-rule="nonzero"/><path d="M17.595 9.84l2.957 1.69a1.2 1.2 0 01.605 1.041v3.358c0 .43-.23.828-.605 1.041l-2.957 1.69a1.2 1.2 0 01-1.19 0l-2.957-1.69a1.2 1.2 0 01-.605-1.041V12.57c0-.43.23-.828.605-1.041l2.957-1.69a1.2 1.2 0 011.19 0zM17 12.47c-.994 0-1.8.797-1.8 1.781a1.79 1.79 0 001.8 1.781c.994 0 1.8-.797 1.8-1.781a1.79 1.79 0 00-1.8-1.781z" fill="#FFF"/></g></svg>',"image/svg+xml").firstChild}function fullscreenActiveSVG$1(){return(new DOMParser).parseFromString('<svg width="21" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.892 2h4.445v1.778H3.892v4.444H2.114V3.778C2.114 2.796 2.91 2 3.892 2zm4.445 16v-4.444c0-.982-.796-1.778-1.778-1.778H2.114v1.778h2.944L2.264 16.35a.9.9 0 001.272 1.273l2.988-2.987a.918.918 0 00.035-.037V18h1.778zm8-6.222v4.444h-4.445V18h4.445c.981 0 1.777-.796 1.777-1.778v-4.444h-1.777zM11.892 2v4.445c0 .981.796 1.777 1.778 1.777h4.444V6.445H15.17l2.568-2.568a.9.9 0 10-1.273-1.273L13.67 5.4V2h-1.778z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function fullscreenDefaultSVG$1(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.778 2h4.444v1.778H3.778v4.444H2V3.778C2 2.796 2.796 2 3.778 2zM2 11.778v4.444C2 17.204 2.796 18 3.778 18h4.444v-1.778H4.823l2.313-2.313a.9.9 0 00-1.272-1.273l-2.086 2.086v-2.944H2zm14.222 0v4.444h-4.444V18h4.444c.982 0 1.778-.796 1.778-1.778v-4.444h-1.778zM18 8.222V3.778C18 2.796 17.204 2 16.222 2h-4.444v1.778h2.945l-2.587 2.586a.9.9 0 101.273 1.273l2.813-2.813v3.398H18z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function pauseSVG$1(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="5.313" y="3.75" width="3.125" height="12.5" rx=".625" fill="#fff"/><rect x="11.563" y="3.75" width="3.125" height="12.5" rx=".625" fill="#fff"/></svg>',"image/svg+xml").firstChild}function playSVG$1(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.121 8.299a2 2 0 010 3.402l-7.94 4.91c-1.332.825-3.051-.133-3.051-1.7V5.09c0-1.567 1.72-2.525 3.052-1.701l7.939 4.911z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function playNextSVG$1(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.03 8.312a2 2 0 010 3.376l-7.642 4.858c-1.332.847-3.073-.11-3.073-1.687V5.14c0-1.577 1.741-2.534 3.073-1.687l7.642 4.858z" fill="#fff"/><path d="M13 3.5a.5.5 0 01.5-.5h1a.5.5 0 01.5.5v13a.5.5 0 01-.5.5h-1a.5.5 0 01-.5-.5v-13z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function replaySVG(){return(new DOMParser).parseFromString('<svg width="72" height="72" viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><g fill="#FFF" fill-rule="evenodd"><circle fill-opacity=".3" cx="36" cy="36" r="36"/><path d="M40.167 32.667a.833.833 0 01-.834-.834v-1.666c0-.46.373-.834.834-.834h5.409a11.653 11.653 0 00-9.576-5c-6.443 0-11.667 5.224-11.667 11.667S29.557 47.667 36 47.667c5.285 0 9.749-3.514 11.183-8.333h3.445C49.112 46.014 43.138 51 36 51c-8.284 0-15-6.716-15-15 0-8.284 6.716-15 15-15 4.713 0 8.918 2.173 11.668 5.572l-.001-4.739c0-.46.373-.833.833-.833h1.667c.46 0 .833.373.833.833V31c0 .879-.68 1.598-1.542 1.662l-.125.005h-9.166z"/></g></svg>',"image/svg+xml").firstChild}function startPlaySVG(){return(new DOMParser).parseFromString('<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="60" height="60" rx="30" fill="#000" fill-opacity=".4"/><path d="M40.243 28.3a2 2 0 010 3.401L24.06 41.712c-1.332.825-3.052-.134-3.052-1.7V19.988c0-1.566 1.72-2.525 3.052-1.7l16.184 10.01z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function volumeLargeSVG(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.867 2.5h.55c.44 0 .799.34.83.771l.003.062v13.334c0 .44-.34.799-.771.83l-.062.003h-.55a.833.833 0 01-.444-.128l-.064-.045-4.867-3.744a.831.831 0 01-.322-.59l-.003-.07V7.077c0-.235.099-.458.271-.615l.054-.045L9.36 2.673a.832.832 0 01.43-.17l.078-.003h.55-.55zm6.767 2.278A7.474 7.474 0 0118.75 10a7.477 7.477 0 01-2.128 5.234.4.4 0 01-.57-.004l-.587-.586a.442.442 0 01.005-.617A5.812 5.812 0 0017.083 10c0-1.557-.61-2.97-1.603-4.017a.442.442 0 01-.003-.615l.586-.586a.4.4 0 01.57-.004zM2.5 6.667c.23 0 .417.186.417.416v5.834c0 .23-.187.416-.417.416h-.833a.417.417 0 01-.417-.416V7.083c0-.23.187-.416.417-.416H2.5zm11.768.46A4.153 4.153 0 0115.417 10c0 1.12-.442 2.137-1.162 2.886a.388.388 0 01-.555-.007l-.577-.578c-.176-.176-.156-.467.009-.655A2.49 2.49 0 0013.75 10a2.49 2.49 0 00-.61-1.636c-.163-.188-.182-.477-.006-.653l.578-.578a.388.388 0 01.556-.006z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function volumeMutedSVG(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.045 2.5h.55c.44 0 .8.34.831.771l.003.062v13.334c0 .44-.34.799-.771.83l-.063.003h-.55a.833.833 0 01-.443-.128l-.065-.045-4.866-3.744a.831.831 0 01-.323-.59l-.003-.07V7.077c0-.235.1-.458.272-.615l.054-.045 4.866-3.744a.832.832 0 01.43-.17l.078-.003h.55-.55zM2.68 6.667c.23 0 .416.186.416.416v5.834c0 .23-.186.416-.416.416h-.834a.417.417 0 01-.416-.416V7.083c0-.23.186-.416.416-.416h.834zm10.467.294a.417.417 0 01.59 0l1.767 1.768L17.27 6.96a.417.417 0 01.589 0l.59.59a.417.417 0 010 .589L16.68 9.908l1.768 1.767c.15.15.162.387.035.55l-.035.04-.589.589a.417.417 0 01-.59 0l-1.767-1.768-1.768 1.768a.417.417 0 01-.59 0l-.588-.59a.417.417 0 010-.589l1.767-1.768-1.767-1.767a.417.417 0 01-.035-.55l.035-.04.589-.589z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function volumeSmallSVG(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.867 2.5h.55c.44 0 .799.34.83.771l.003.062v13.334c0 .44-.34.799-.771.83l-.062.003h-.55a.833.833 0 01-.444-.128l-.064-.045-4.867-3.744a.831.831 0 01-.322-.59l-.003-.07V7.077c0-.235.099-.458.271-.615l.054-.045L9.36 2.673a.832.832 0 01.43-.17l.078-.003h.55-.55zM2.5 6.667c.23 0 .417.186.417.416v5.834c0 .23-.187.416-.417.416h-.833a.417.417 0 01-.417-.416V7.083c0-.23.187-.416.417-.416H2.5zm11.768.46A4.153 4.153 0 0115.417 10c0 1.12-.442 2.137-1.162 2.886a.388.388 0 01-.555-.007l-.577-.578c-.176-.176-.156-.467.009-.655A2.49 2.49 0 0013.75 10a2.49 2.49 0 00-.61-1.636c-.163-.188-.182-.477-.006-.653l.578-.578a.388.388 0 01.556-.006z" fill="#fff"/></svg>',"image/svg+xml").firstChild}var iconsOption$1={startPlay:startPlaySVG,play:playSVG$1,pause:pauseSVG$1,fullscreen:fullscreenDefaultSVG$1,exitFullscreen:fullscreenActiveSVG$1,playNext:playNextSVG$1,replay:replaySVG,refresh:refreshSVG$1,danmuSetting:danmuSettingsSVG$1,openDanmu:Default,closeDanmu:danmuActiveSVG$1,volumeLarge:volumeLargeSVG,volumeMuted:volumeMutedSVG,volumeSmall:volumeSmallSVG},initOption$1={whitelist:[""],widescreen:!0,width:"100%",height:"100%",lang:"zh",fitVideoSize:!1,autoplay:!0,autoplayMuted:!0,inactive:2e3,playsinline:!0,keyShortcut:"off",closeVideoClick:!0,closeVideoDblclick:!0,closePlayerBlur:!1,closeControlsBlur:!1,closePlayVideoFocus:!0,leavePlayerTime:0,mini:!1,pip:{position:"controlsRight",index:2.5,showIcon:!0},volume:{index:2.6},miniscreen:{left:window.innerWidth-360,top:window.innerHeight-450},time:{index:3},icons:_objectSpread2$7({},iconsOption$1)},liveOption$1={isLive:!0,closeVideoClick:!0,preloadTime:8,start:{isShowPause:!1,isShowEnd:!1,mode:"hide",disableAnimate:!0},retry:{count:0},flv:{retryCount:0},hls:{retryCount:0}},vodOption$1={isLive:!1,closeVideoClick:!1,defaultPlaybackRate:1,closeVideoStopPropagation:!0,playbackRate:[2,1.5,1.25,{rate:1,iconText:{zh:"å€é€Ÿ",en:"Speed",jp:"Speed"}},.75,.5],start:{isShowPause:!0,isShowEnd:!1,mode:"hide",disableAnimate:!0},progresspreview:{isShowCoverPreview:!0},progress:{isPauseMoving:!0}};function createPlayerOption$1(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=_objectSpread2$7({},initOption$1),r=_objectSpread2$7({},e?liveOption$1:vodOption$1);return _objectSpread2$7(_objectSpread2$7({},t),r)}function danmuSVG(){return(new DOMParser).parseFromString('<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.746 12.444a1 1 0 00-.62.216L1.75 13.75V2.166c0-.23.187-.417.417-.417h11.666c.23 0 .417.187.417.417v6.687c.44.044.86.156 1.25.326V2.167c0-.92-.746-1.667-1.667-1.667H2.167C1.247.5.5 1.246.5 2.167V14.61a.833.833 0 001.35.653l1.71-1.354a1 1 0 01.621-.216h5.543a4.195 4.195 0 01-.02-1.25H3.745z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M4.5 4a.5.5 0 00-.5.5V5a.5.5 0 00.5.5h5A.5.5 0 0010 5v-.5a.5.5 0 00-.5-.5h-5zm2.333 4.167a.5.5 0 00-.5.5v.666a.5.5 0 00.5.5h4.292c.311-.266.662-.487 1.042-.653v-.513a.5.5 0 00-.5-.5H6.834zm-3 .5a.5.5 0 01.5-.5H5a.5.5 0 01.5.5v.666a.5.5 0 01-.5.5h-.667a.5.5 0 01-.5-.5v-.666z" fill="#fff"/><path d="M11 4.5a.5.5 0 01.5-.5h.5a.5.5 0 01.5.5V5a.5.5 0 01-.5.5h-.5A.5.5 0 0111 5v-.5z" fill="#fff"/><circle cx="13.833" cy="13" r="3.333" fill="#3370FF"/><path d="M15.591 12.011l-2.133 2.134-1.22-1.22" stroke="#fff" stroke-linecap="round" stroke-linejoin="round"/></svg>',"image/svg+xml").firstChild}function danmuActiveSVG(){return(new DOMParser).parseFromString('<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.746 12.444a1 1 0 00-.62.216L1.75 13.75V2.166c0-.23.187-.417.417-.417h11.666c.23 0 .417.187.417.417v6.687c.44.044.86.156 1.25.326V2.167c0-.92-.746-1.667-1.667-1.667H2.167C1.247.5.5 1.246.5 2.167V14.61a.833.833 0 001.35.653l1.71-1.354a1 1 0 01.621-.216h5.543a4.195 4.195 0 01-.02-1.25H3.745z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M4.5 4a.5.5 0 00-.5.5V5a.5.5 0 00.5.5h5A.5.5 0 0010 5v-.5a.5.5 0 00-.5-.5h-5zm2.333 4.167a.5.5 0 00-.5.5v.666a.5.5 0 00.5.5h4.292c.311-.266.662-.487 1.042-.653v-.513a.5.5 0 00-.5-.5H6.834zm-3 .5a.5.5 0 01.5-.5H5a.5.5 0 01.5.5v.666a.5.5 0 01-.5.5h-.667a.5.5 0 01-.5-.5v-.666z" fill="#fff"/><path d="M11 4.5a.5.5 0 01.5-.5h.5a.5.5 0 01.5.5V5a.5.5 0 01-.5.5h-.5A.5.5 0 0111 5v-.5z" fill="#fff"/><circle cx="13.833" cy="13" r="2.733" stroke="#fff" stroke-width="1.2"/><path fill="#fff" d="M12.833 10.77l3.473 3.472-1.063 1.064-3.474-3.473z"/></svg>',"image/svg+xml").firstChild}function danmuSettingsSVG(){return(new DOMParser).parseFromString('<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.746 12.444a1 1 0 00-.62.216L1.75 13.75V2.166c0-.23.187-.417.417-.417h11.666c.23 0 .417.187.417.417v6.687c.44.044.86.156 1.25.326V2.167c0-.92-.746-1.667-1.667-1.667H2.167C1.247.5.5 1.246.5 2.167V14.61a.833.833 0 001.35.653l1.71-1.354a1 1 0 01.621-.216h5.543a4.195 4.195 0 01-.02-1.25H3.745z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M4.5 4a.5.5 0 00-.5.5V5a.5.5 0 00.5.5h5A.5.5 0 0010 5v-.5a.5.5 0 00-.5-.5h-5zm2.333 4.167a.5.5 0 00-.5.5v.666a.5.5 0 00.5.5h4.292c.311-.266.662-.487 1.042-.653v-.513a.5.5 0 00-.5-.5H6.834zm-3 .5a.5.5 0 01.5-.5H5a.5.5 0 01.5.5v.666a.5.5 0 01-.5.5h-.667a.5.5 0 01-.5-.5v-.666z" fill="#fff"/><path d="M11 4.5a.5.5 0 01.5-.5h.5a.5.5 0 01.5.5V5a.5.5 0 01-.5.5h-.5A.5.5 0 0111 5v-.5z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M14.387 10.134a1 1 0 00-1 0l-1.887 1.09a1 1 0 00-.5.865v2.179a1 1 0 00.5.866l1.887 1.09a1 1 0 001 0l1.886-1.09a1 1 0 00.5-.866v-2.179a1 1 0 00-.5-.866l-1.886-1.089zm-.5 4.711a1.667 1.667 0 100-3.333 1.667 1.667 0 000 3.333z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function fullscreenActiveSVG(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17.5 8.333h-4.167c-.92 0-1.666-.746-1.666-1.666V2.5h1.666v4.167H17.5v1.666zM2.5 6.667v1.666h4.167c.92 0 1.666-.746 1.666-1.666V2.5H6.667v4.167H2.5zM2.5 13.333h4.167V17.5h1.666v-4.167c0-.92-.746-1.666-1.666-1.666H2.5v1.666zM13.333 17.5v-4.167H17.5v-1.666h-4.167c-.92 0-1.666.746-1.666 1.666V17.5h1.666z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function fullscreenDefaultSVG(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.125 3a.375.375 0 00-.375.375v.75c0 .207.168.375.375.375H15.5v3.375c0 .207.168.375.375.375h.75A.375.375 0 0017 7.875v-4.5A.375.375 0 0016.625 3h-4.5zm0 12.5a.375.375 0 00-.375.375v.75c0 .207.168.375.375.375h4.5a.375.375 0 00.375-.375v-4.5a.375.375 0 00-.375-.375h-.75a.375.375 0 00-.375.375V15.5h-3.375zM3 3.375C3 3.168 3.168 3 3.375 3h4.5c.207 0 .375.168.375.375v.75a.375.375 0 01-.375.375H4.5v3.375a.375.375 0 01-.375.375h-.75A.375.375 0 013 7.875v-4.5zM7.875 15.5H4.5v-3.375a.375.375 0 00-.375-.375h-.75a.375.375 0 00-.375.375v4.5c0 .207.168.375.375.375h4.5a.375.375 0 00.375-.375v-.75a.375.375 0 00-.375-.375z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function pauseSVG(){return(new DOMParser).parseFromString('<svg style="\n    height: 18px;\n    width: 18px;\n" width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="7.438" y="5.25" width="4.375" height="17.5" rx=".875" fill="#fff"/><rect x="16.188" y="5.25" width="4.375" height="17.5" rx=".875" fill="#fff"/></svg>',"image/svg+xml").firstChild}function playSVG(){return(new DOMParser).parseFromString('<svg style="\n    height: 18px;\n    width: 18px;\n" width="28" height="28" fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"><path d="M19.77 11.619c1.768 1.094 1.768 3.668 0 4.762L8.653 23.257c-1.865 1.154-4.273-.188-4.273-2.381V7.125c0-2.194 2.408-3.536 4.273-2.382L19.77 11.62z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function playNextSVG(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.77 4.124l8.358 5.07c.38.23.486.704.238 1.056a.807.807 0 01-.238.22L4.77 15.543c-.38.231-.889.132-1.137-.221a.723.723 0 01-.134-.417V4.762c0-.421.368-.762.822-.762.159 0 .316.042.449.124z" stroke="#fff" stroke-width="1.5"/><path d="M15.5 4.5A.5.5 0 0116 4h.5a.5.5 0 01.5.5v11a.5.5 0 01-.5.5H16a.5.5 0 01-.5-.5v-11z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function refreshSVG(){return(new DOMParser).parseFromString('<svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h18v18H0z"/><path d="M10.875 7.5a.375.375 0 01-.375-.375v-.75c0-.207.168-.375.375-.375h2.434a5.25 5.25 0 10.723 4.5h1.55a6.75 6.75 0 11-1.332-5.743V2.626c0-.207.168-.375.375-.375h.75c.207 0 .375.168.375.375V6.75a.75.75 0 01-.694.748L15 7.5h-4.125z" fill="#FFF"/></g></svg>',"image/svg+xml").firstChild}var iconsOption={startPlay:startPlaySVG,play:playSVG,pause:pauseSVG,fullscreen:fullscreenDefaultSVG,exitFullscreen:fullscreenActiveSVG,playNext:playNextSVG,replay:replaySVG,refresh:refreshSVG,danmuSetting:danmuSettingsSVG,openDanmu:danmuSVG,closeDanmu:danmuActiveSVG,volumeLarge:volumeLargeSVG,volumeMuted:volumeMutedSVG,volumeSmall:volumeSmallSVG},isIOS=!sniffer$1.os.isAndroid,initOption={width:"100%",height:"100%",lang:"zh",playsinline:!0,closeVideoClick:!0,closeVideoTouch:!0,autoplay:!0,autoplayMuted:!0,whitelist:[""],"x5-video-player-type":"h5-page","x5-video-player-fullscreen":!1,"x5-video-orientation":"landscape|portrait",enterTips:{background:"linear-gradient(90deg,#000,#49e6d3,#49e6d3,#138afc,#000)"},retainPlay:!0,start:{isShowPause:!0,isShowEnd:!0,disableAnimate:!1},fullscreen:{useCssFullscreen:isIOS},plugins:[],time:{mode:"pc",index:2.5},controls:{mode:"flex"},danmusettings:{index:"2"},danmuicon:{index:"3"},cusPlaybackRatePlugin:{needCheck:!0,needPanel:!1},icons:_objectSpread2$7({},iconsOption)},liveOption={isLive:!0,closeVideoClick:!0,start:{isShowPause:!1,isShowEnd:!1,disableAnimate:!1,mode:"hide"},retry:{count:0},flv:{retryCount:0},hls:{retryCount:0},longwaiting:{duration:3e4},mobile:{gestureY:!1,gestureX:!1,disableActive:!0}},vodOption={isLive:!1,closeVideoClick:!1,playbackRate:[2,1.5,1.25,{rate:1,iconText:"å€é€Ÿ",en:"speed",jp:"speed"},.75,.5],defaultPlaybackRate:1,closeVideoStopPropagation:!0,mobile:{gestureY:!1},start:{isShowPause:!0,isShowEnd:!1,disableAnimate:!1,mode:"hide"}};function createPlayerOption(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=_objectSpread2$7({},initOption),r=_objectSpread2$7({},e?liveOption:vodOption);return _objectSpread2$7(_objectSpread2$7({},t),r)}var POSITIONS$7=Plugin.POSITIONS,extendPlugin=function(e){var t="mobile"===sniffer$1.device,r=e.pluginName,n=void 0===r?"ExtendPlugin".concat(Math.random().toString().slice(-5)):r,i=e.type,a=void 0===i?t?"inner":"normal":i,o=e.position,s=void 0===o?POSITIONS$7.CONTROLS_LEFT:o,u=e.icon,c=void 0===u?Default:u,l=e.index,d=void 0===l?1:l,h=e.hideAtFullScreen,f=void 0===h||h,p=e.tips,g=void 0===p?{jp:"custom",en:"custom",zh:"è‡ªå®šä¹‰","zh-hk":"è‡ªå®šä¹‰"}:p;return function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){return _classCallCheck$8(this,r),t.apply(this,arguments)}return _createClass$9(r,[{key:"afterCreate",value:function(){var e;this.appendChild(".xgplayer-icon",this.icons[n]),this.initEvents(),f&&null!==(e=this.player)&&void 0!==e&&e.fullscreen&&this.handleFullScreenChange()}},{key:"registerIcons",value:function(){return _defineProperty$9({},n,{icon:c,class:"xgplayer-extendicon-svg"})}},{key:"updateIcons",value:function(e){var t=this.find(".xgplayer-icon");t&&(t.innerHTML=e)}},{key:"registerLanguageTexts",value:function(){return _defineProperty$9({},n,g)}},{key:"initEvents",value:function(){this.handleCallback=debounce$2(this.handleCallback.bind(this),200);var e,t="mobile"===sniffer$1.device?"touchend":"click";(this.bind(t,this.handleCallback),this.show(),f)&&(null===(e=this.player)||void 0===e||e.on(FULLSCREEN_CHANGE,this.handleFullScreenChange.bind(this)))}},{key:"handleFullScreenChange",value:function(){var e,t=this.player;null===(e=this.player)||void 0===e||e.changePluginsIcon(n,!(null!=t&&t.fullscreen))}},{key:"handleCallback",value:function(e){var t=this.player;t&&(e.preventDefault(),e.stopPropagation(),t.emit(PluginEvents.PLAYER_EXTEND_BUTTON,n))}},{key:"destroy",value:function(){var e;(this.unbind(["touchend","click"],this.handleCallback),f)&&(null===(e=this.player)||void 0===e||e.off(FULLSCREEN_CHANGE,this.handleFullScreenChange.bind(this)))}},{key:"render",value:function(){return'\n      <xg-icon class="xgplayer-extend-icon">\n        <div class="xgplayer-icon">\n        </div>\n        <div class="xg-tips" lang-key="'.concat(n,'">').concat(this.langText[n],"</div>\n      </xg-icon>\n      ")}}],[{key:"isExtendPlugin",get:function(){return!0}},{key:"type",get:function(){return a}},{key:"textTips",get:function(){return g}},{key:"pluginName",get:function(){return n}},{key:"defaultConfig",get:function(){return{position:s,index:d}}}]),r}(Plugin)},MobilePlayerPanel=function(){function e(t){var r,n;_classCallCheck$8(this,e);var i=t.config,a=t.root,o=t.player;this.config=i,this.parent=a,this.player=o,this.mode=null!==(r=null==i?void 0:i.mode)&&void 0!==r?r:PLAYER_MODE.INNER,this.isAutoChange=null!==(n=null==i?void 0:i.isAutoChange)&&void 0!==n&&n,this.initEvents(),this.renderPanel()}var t;return _createClass$9(e,[{key:"initEvents",value:function(){var e;this.isAutoChange&&(window.addEventListener("orientationchange",this.handleOrientationChange.bind(this)),null===(e=this.player)||void 0===e||e.on(FULLSCREEN_CHANGE,this.handleOrientationChange.bind(this)))}},{key:"handleOrientationChange",value:function(){var e,t,r,n=[90,-90,"90","-90"].includes(window.orientation);null!==(e=this.player)&&void 0!==e&&e.fullscreen&&n?this.changeMode(PLAYER_MODE.FULLSCREEN):this.changeMode(null!==(t=null===(r=this.config)||void 0===r?void 0:r.mode)&&void 0!==t?t:PLAYER_MODE.INNER)}},{key:"changeConfig",value:function(e){this.config=e}},{key:"changeMode",value:function(e){this.mode=e,this.player.emit(PluginEvents.PANEL_MODE_CHANGE,{mode:e}),this.destroy(),this.renderPanel()}},{key:"renderPanel",value:function(){var e="xg-mobile-panel panel-".concat(["normal","inner","fullscreen"][this.mode]);switch(this.root=util$2.createDom("div","",{},e),this.parent&&(this.parent.appendChild(this.root),this.hide()),this.bind("click",this.handleHide.bind(this)),this.mode){case PLAYER_MODE.NORMAL:var t=util$2.createDom("div","",{},"xg-mobile-panel-content");this.root.appendChild(t),this.container=t,t.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault()}));break;case PLAYER_MODE.INNER:this.container=this.root;break;case PLAYER_MODE.FULLSCREEN:var r=util$2.createDom("div","",{},"xg-mobile-panel-content");this.root.appendChild(r),this.container=r,r.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault()}))}}},{key:"showPanel",value:(t=_asyncToGenerator$7(_regeneratorRuntime$5().mark((function e(t){var r,n=this,i=arguments;return _regeneratorRuntime$5().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:"",i.length>2&&void 0!==i[2]&&i[2]&&util$2.addClass(t,"item-list-panel-content"),this.setTitle(r),!this.children){e.next=9;break}return e.next=7,this.hide();case 7:return setTimeout((function(){n.children=t,n.container&&(n.title&&n.container.appendChild(n.title),n.container.appendChild(t)),n.show()})),e.abrupt("return");case 9:this.children=t,this.container&&(this.title&&this.container.appendChild(this.title),this.container.appendChild(t)),this.show();case 12:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updatePanel",value:function(e){this.children&&util$2.hasClass(this.children,"item-list-panel-content")&&util$2.addClass(e,"item-list-panel-content"),this.children=e,this.container&&(this.container.innerHTML="",this.title&&this.container.appendChild(this.title),this.container.appendChild(e)),this.show()}},{key:"setTitle",value:function(e){e&&this.mode!==PLAYER_MODE.INNER?this.title?this.title.innerHTML=e:this.title=this.renderTitle(e):this.title=void 0}},{key:"renderTitle",value:function(e){return util$2.createDom("div",e,{},"xg-mobile-panel-title")}},{key:"show",value:function(){util$2.removeClass(this.root,"hide"),util$2.addClass(this.root,"active")}},{key:"hide",value:function(){util$2.removeClass(this.root,"active"),util$2.addClass(this.root,"hide"),this.container&&(this.container.innerHTML="")}},{key:"handleHide",value:function(e){e.stopPropagation(),e.preventDefault(),this.hide()}},{key:"bind",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.root&&"on".concat(e)in this.root&&"function"==typeof t&&this.root.addEventListener(e,t,r)}},{key:"destroy",value:function(){var e;this.parent&&this.root&&this.parent.removeChild(this.root),window.removeEventListener("orientationchange",this.handleOrientationChange.bind(this)),null===(e=this.player)||void 0===e||e.off(FULLSCREEN_CHANGE,this.handleOrientationChange.bind(this))}}]),e}(),TOB_PLAY_DOMAIN="//vod.volcengineapi.com",TOC_PLAY_DOMAIN="//vod.bytedanceapi.com",LICENSE_URL="https://webmedia.zijieapi.com/video/drm/v1/play_licenses",TOB_KEY_DOMAIN="https://kds.bytedance.com";function DefinitionIconSVG(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M16 3.8001H4C3.55817 3.8001 3.2 4.15827 3.2 4.6001V12.6001C3.2 13.0419 3.55817 13.4001 4 13.4001H16C16.4418 13.4001 16.8 13.0419 16.8 12.6001V4.6001C16.8 4.15827 16.4418 3.8001 16 3.8001ZM4 2.6001C2.89543 2.6001 2 3.49553 2 4.6001V12.6001C2 13.7047 2.89543 14.6001 4 14.6001H16C17.1046 14.6001 18 13.7047 18 12.6001V4.6001C18 3.49553 17.1046 2.6001 16 2.6001H4ZM5.0249 6.24509V11.6001H5.9024V9.23009H8.6174V11.6001H9.4949V6.24509H8.6174V8.48009H5.9024V6.24509H5.0249ZM10.5474 6.24509V11.6001H12.5049C13.3749 11.6001 14.0274 11.3601 14.4774 10.8801C14.9049 10.4226 15.1224 9.77009 15.1224 8.92259C15.1224 8.06759 14.9049 7.41509 14.4774 6.96509C14.0274 6.48509 13.3749 6.24509 12.5049 6.24509H10.5474ZM11.4249 6.99509H12.3399C13.0074 6.99509 13.4949 7.14509 13.8024 7.45259C14.1024 7.75259 14.2524 8.24759 14.2524 8.92259C14.2524 9.58259 14.1024 10.0701 13.8024 10.3851C13.4949 10.6926 13.0074 10.8501 12.3399 10.8501H11.4249V6.99509ZM4.15 16.1001C3.79101 16.1001 3.5 16.3911 3.5 16.7501C3.5 17.1091 3.79101 17.4001 4.15 17.4001H15.85C16.209 17.4001 16.5 17.1091 16.5 16.7501C16.5 16.3911 16.209 16.1001 15.85 16.1001H4.15Z" fill="#ffffff"/>\n</svg>',"image/svg+xml").firstChild}var POSITIONS$6=Plugin.POSITIONS,DefinitionMobilePlugin=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),(n=t.call(this,e)).playerData=null,n.playerData=e.player.config.playerData,n.dataMonitoring(),n}return _createClass$9(r,[{key:"dataMonitoring",value:function(){var e=this;this.playerData&&MyProxy$1.subscribeProperty(this.playerData.current,"definition",(function(t,r){if(t!==r&&e.player){var n=e.playerData.getCurrentUrl();e.player.changeDefinition({definition:r,url:n}),e.updatePanel(),e.player.emit(PluginEvents.INNER_DEFINITION_CHANGE,{from:t,to:r,url:n}),e.player.emit(PluginEvents.PlAY_URL_CHANGE,{url:n,from:PluginEvents.INNER_DEFINITION_CHANGE}),setTimeout((function(){e.player.paused&&e.player.play()}),1e3)}}))}},{key:"registerIcons",value:function(){return{definition:{icon:DefinitionIconSVG,class:"xgplayer-definition-svg"}}}},{key:"registerLanguageTexts",value:function(){return{definition:{jp:"æ˜Žå¿«ã•",en:"Definition",zh:"æ¸…æ™°åº¦","zh-hk":"æ¸…æ™°åº¦"},definitionSelect:{jp:"ã‚¯ãƒ©ãƒªãƒ†ã‚£ã‚»ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³",en:"Definition Choose",zh:"æ¸…æ™°åº¦é€‰æ‹©","zh-hk":"æ¸…æ™°åº¦é¸æ“‡"},switching:{jp:"ã«åˆ‡ã‚Šæ›¿ãˆã‚‹",en:"Switching to",zh:"æ­£åœ¨åˆ‡æ¢è‡³","zh-hk":"æ­£åœ¨åˆ‡æ›è‡³"}}}},{key:"afterCreate",value:function(){this.appendChild(".xgplayer-icon",this.icons.definition),this.initEvents()}},{key:"afterPlayerInit",value:function(){}},{key:"initEvents",value:function(){this.bind(["click"],this.handleButtonChange.bind(this))}},{key:"handleButtonChange",value:function(){var e=this.renderItemList();this.renderPanel(e)}},{key:"renderItemList",value:function(){var e=this,t=this.playerData.current.lineId,r=this.playerData.getDefinitionListByLineId(t),n=util$2.createDom("div","",{},"definition-panel-content");return r.forEach((function(t){var r=e.renderItem(t);n.appendChild(r)})),n}},{key:"renderItem",value:function(e){var t=this,r=this.playerData.current.definition,n=util$2.createDom("div","",{},"panel-Item ".concat(r===e.definition?"select-in":""));return n.innerHTML=this.getShowText(this.i18n,e),n.addEventListener("click",(function(r){r.stopPropagation(),r.preventDefault(),t.showToast(e),t.playerData.current.definition=e.definition})),n}},{key:"getShowText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return e[t.definitionTextKey]||t.definitionTextKey||t.definition}},{key:"showToast",value:function(e){var t,r=null===(t=this.player)||void 0===t?void 0:t.getPlugin("sdkToastPlugin");if(r){var n=this.getShowText(this.i18n,e);r.add("".concat(this.langText.switching).concat(n,"..."),2e3,!0)}}},{key:"renderPanel",value:function(e){var t,r;null===(t=this.player)||void 0===t||null===(r=t.panel)||void 0===r||r.showPanel(e,this.langText.definitionSelect,!0)}},{key:"updatePanel",value:function(){var e,t,r=this.renderItemList();null===(e=this.player)||void 0===e||null===(t=e.panel)||void 0===t||t.updatePanel(r)}},{key:"destroy",value:function(){this.unbind(["click"],this.handleButtonChange.bind(this))}},{key:"render",value:function(){return'\n    <xg-icon class="xgplayer-mobile-definition">\n      <div class="xgplayer-icon">\n      </div>\n    </xg-icon>\n    '}}],[{key:"pluginName",get:function(){return"DefinitionMobilePlugin"}},{key:"textTips",get:function(){return{jp:"æ˜Žå¿«ã•",en:"Definition",zh:"æ¸…æ™°åº¦","zh-hk":"æ¸…æ™°åº¦"}}},{key:"defaultConfig",get:function(){return{position:POSITIONS$6.CONTROLS_RIGHT,index:2.7}}}]),r}(Plugin);function LineIconSVG(){return(new DOMParser).parseFromString('<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M12.7123 1C11.85 1 11.1173 1.55472 10.8516 2.32675L4.94973 2.32675C3.16413 2.32675 1.71662 3.77427 1.71662 5.55987C1.71662 7.34547 3.16413 8.79298 4.94973 8.79298L11.0483 8.79298L11.1134 8.79418C11.9936 8.82748 12.697 9.55166 12.697 10.44C12.697 11.3497 11.9596 12.0871 11.05 12.0871H5.01323C4.67882 11.4781 4.03143 11.0654 3.28763 11.0654C2.20111 11.0654 1.32031 11.9462 1.32031 13.0327C1.32031 14.1192 2.20111 15 3.28763 15C4.14992 15 4.88264 14.4452 5.14834 13.6732H11.05C12.8356 13.6732 14.2831 12.2256 14.2831 10.44C14.2831 8.65444 12.8356 7.20693 11.05 7.20693L4.94973 7.20693C4.04009 7.20693 3.30267 6.46951 3.30267 5.55987C3.30267 4.65022 4.04009 3.91281 4.94973 3.91281L10.9866 3.91281C11.321 4.52183 11.9685 4.93464 12.7123 4.93464C13.7988 4.93464 14.6796 4.05384 14.6796 2.96732C14.6796 1.8808 13.7988 1 12.7123 1ZM12.7123 2.18954C12.2827 2.18954 11.9345 2.53777 11.9345 2.96732C11.9345 3.39688 12.2827 3.7451 12.7123 3.7451C13.1418 3.7451 13.4901 3.39688 13.4901 2.96732C13.4901 2.53777 13.1418 2.18954 12.7123 2.18954ZM2.50986 13.0327C2.50986 12.6031 2.85808 12.2549 3.28763 12.2549C3.71719 12.2549 4.06541 12.6031 4.06541 13.0327C4.06541 13.4622 3.71719 13.8105 3.28763 13.8105C2.85808 13.8105 2.50986 13.4622 2.50986 13.0327Z" fill="#FFFFFF"/>\n</svg>',"image/svg+xml").firstChild}var POSITIONS$5=Plugin.POSITIONS,LineMobilePlugin=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),(n=t.call(this,e)).playerData=null,n.playerData=e.player.config.playerData,n.dataMonitoring(),n}return _createClass$9(r,[{key:"dataMonitoring",value:function(){var e=this;this.playerData&&MyProxy$1.subscribeProperty(this.playerData.current,"definition",(function(t,r){if(t!==r&&e.player){var n=e.playerData.getCurrentUrl();console.log(n),e.player.changeDefinition({definition:r,url:n}),e.updatePanel(),setTimeout((function(){e.player.paused&&e.player.play()}),1e3)}}))}},{key:"registerIcons",value:function(){return{line:{icon:LineIconSVG,class:"xgplayer-line-svg"}}}},{key:"registerLanguageTexts",value:function(){return{line:{jp:"ãƒ©ã‚¤ãƒ³",en:"Line",zh:"çº¿è·¯","zh-hk":"ç·šè·¯"},lineSelect:{jp:"ãƒ©ã‚¤ãƒ³é¸ã¶",en:"Line Choose",zh:"çº¿è·¯é€‰æ‹©","zh-hk":"ç·šè·¯é¸æ“‡"}}}},{key:"afterCreate",value:function(){this.appendChild(".xgplayer-icon",this.icons.line),this.initEvents()}},{key:"afterPlayerInit",value:function(){}},{key:"initEvents",value:function(){this.bind(["click"],this.handleButtonChange.bind(this))}},{key:"handleButtonChange",value:function(){var e=this.renderItemList();this.renderPanel(e)}},{key:"renderItemList",value:function(){var e=this,t=this.playerData.getLineList(),r=util$2.createDom("div","",{},"line-panel-content");return t.forEach((function(t){var n=e.renderItem(t);r.appendChild(n)})),r}},{key:"renderItem",value:function(e){var t=this,r=this.playerData.current.lineId,n=util$2.createDom("div","",{},"panel-Item ".concat(r===e.lineId?"select-in":""));return n.innerHTML=this.i18n[e.lineTextKey]||e.lineTextKey,n.addEventListener("click",(function(r){r.stopPropagation(),r.preventDefault(),t.player.emit(PluginEvents.LINE_CHANGE,{from:t.playerData.current.lineId,to:e.lineId}),t.playerData.current.lineId=e.lineId,t.player.emit(SDKEvents.PLAYER_REBUILD)})),n}},{key:"renderPanel",value:function(e){var t,r;null===(t=this.player)||void 0===t||null===(r=t.panel)||void 0===r||r.showPanel(e,this.langText.lineSelect,!0)}},{key:"updatePanel",value:function(){var e,t=this.renderItemList();null===(e=this.player)||void 0===e||e.panel.updatePanel(t)}},{key:"destroy",value:function(){this.unbind(["click"],this.handleButtonChange.bind(this))}},{key:"render",value:function(){return'\n    <xg-icon class="xgplayer-mobile-line">\n      <div class="xgplayer-icon">\n      </div>\n    </xg-icon>\n    '}}],[{key:"pluginName",get:function(){return"LineMobilePlugin"}},{key:"textTips",get:function(){return{jp:"ãƒ©ã‚¤ãƒ³",en:"Line",zh:"çº¿è·¯","zh-hk":"ç·šè·¯"}}},{key:"defaultConfig",get:function(){return{position:POSITIONS$5.CONTROLS_RIGHT,index:2.8}}}]),r}(Plugin);function RateIconSVG(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M14.6879 3.64579C14.7387 3.60575 14.7387 3.52868 14.6879 3.48864L13.3089 2.40296C13.2433 2.35132 13.147 2.39805 13.147 2.48153V4.6529C13.147 4.73639 13.2433 4.78312 13.3089 4.73147L14.6879 3.64579ZM4 2.61914H11.3001V3.91914H4C3.6134 3.91914 3.3 4.23254 3.3 4.61914V15.6191C3.3 16.0057 3.6134 16.3191 4 16.3191H16C16.3866 16.3191 16.7 16.0057 16.7 15.6191V6.75253H18V15.6191C18 16.7237 17.1046 17.6191 16 17.6191H4C2.89543 17.6191 2 16.7237 2 15.6191V4.61914C2 3.51457 2.89543 2.61914 4 2.61914ZM17.7879 3.48864C17.8388 3.52868 17.8388 3.60575 17.7879 3.64579L16.4089 4.73147C16.3433 4.78312 16.2471 4.73639 16.2471 4.6529V2.48153C16.2471 2.39805 16.3433 2.35132 16.4089 2.40296L17.7879 3.48864ZM6.82584 7.37256C6.26886 7.37256 5.82039 7.56063 5.48042 7.93677C5.14768 8.29121 4.98131 8.75415 4.97408 9.33282H5.82039C5.83485 8.92775 5.92166 8.61671 6.08079 8.41418C6.23993 8.19717 6.47863 8.08867 6.7969 8.08867C7.09347 8.08867 7.31771 8.15377 7.46961 8.29121C7.61428 8.42864 7.69385 8.63841 7.69385 8.92052C7.69385 9.20986 7.57811 9.48473 7.35388 9.7379C7.20921 9.8898 6.97774 10.0851 6.645 10.3166C6.04462 10.7289 5.64679 11.0471 5.45872 11.2642C5.11151 11.6548 4.94514 12.1105 4.94514 12.6385H8.54739V11.8935H6.00122C6.11696 11.6331 6.43523 11.3293 6.96327 10.982C7.46961 10.6421 7.83128 10.3672 8.03382 10.1502C8.36656 9.7813 8.54016 9.37622 8.54016 8.92775C8.54016 8.46481 8.38102 8.09591 8.06275 7.80657C7.73725 7.51723 7.32494 7.37256 6.82584 7.37256ZM9.90445 11.5463C9.74532 11.5463 9.60788 11.5969 9.50661 11.7126C9.39088 11.8211 9.34025 11.9586 9.34025 12.1177C9.34025 12.2768 9.39088 12.407 9.50661 12.5228C9.60788 12.624 9.74532 12.6819 9.90445 12.6819C10.0636 12.6819 10.1938 12.624 10.3095 12.5228C10.418 12.407 10.4759 12.2768 10.4759 12.1177C10.4759 11.9586 10.418 11.8211 10.3095 11.7126C10.1938 11.5969 10.0636 11.5463 9.90445 11.5463ZM11.665 8.12484C11.9977 7.6185 12.4679 7.37256 13.0755 7.37256C13.6759 7.37256 14.1461 7.6185 14.486 8.12484C14.8043 8.60225 14.9635 9.24602 14.9635 10.0562C14.9635 10.8663 14.8043 11.5101 14.486 11.9875C14.1461 12.4866 13.6759 12.7398 13.0755 12.7398C12.4679 12.7398 11.9977 12.4866 11.665 11.9875C11.3467 11.5101 11.1876 10.8663 11.1876 10.0562C11.1876 9.24602 11.3467 8.60225 11.665 8.12484ZM13.9435 8.77585C13.7699 8.31291 13.4806 8.08867 13.0755 8.08867C12.6632 8.08867 12.3739 8.31291 12.2075 8.77585C12.0918 9.08689 12.0339 9.51366 12.0339 10.0562C12.0339 10.5914 12.0918 11.0182 12.2075 11.3365C12.3739 11.7922 12.6632 12.0237 13.0755 12.0237C13.4806 12.0237 13.7699 11.7922 13.9435 11.3365C14.0593 11.0182 14.1171 10.5914 14.1171 10.0562C14.1171 9.51366 14.0593 9.08689 13.9435 8.77585Z" fill="#ffffff"/>\n</svg>',"image/svg+xml").firstChild}var POSITIONS$4=Plugin.POSITIONS,PlaybackRateMobilePlugin=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),(n=t.call(this,e)).playerData=null,n.state={currentRate:1,isSupport:!0},n.playerData=e.player.config.playerData,n}return _createClass$9(r,[{key:"registerIcons",value:function(){return{playbackRate:{icon:RateIconSVG,class:"xgplayer-rate-svg"}}}},{key:"registerLanguageTexts",value:function(){return{rate:{jp:"å€é€Ÿ",en:"PlaybackRate",zh:"å€é€Ÿ","zh-hk":"å€é€Ÿ"},rateSelect:{jp:"å€é€Ÿé¸ã¶",en:"PlaybackRate",zh:"å€é€Ÿé€‰æ‹©","zh-hk":"å€é€Ÿé¸æ“‡"}}}},{key:"afterCreate",value:function(){this.appendChild(".xgplayer-icon",this.icons.playbackRate),this.initEvents()}},{key:"afterPlayerInit",value:function(){}},{key:"initEvents",value:function(){this.bind(["click"],this.handleButtonChange.bind(this))}},{key:"handleButtonChange",value:function(){var e=this.renderItemList();this.renderPanel(e)}},{key:"renderItemList",value:function(){var e=this,t=util$2.createDom("div","",{},"playbackRate-panel-content");return this.config.list.forEach((function(r){var n=e.renderItem(r);t.appendChild(n)})),t}},{key:"renderItem",value:function(e){var t=this,r=isObject$z(e)?e:{textKey:e+"X",value:e},n=util$2.createDom("div","",{},"panel-Item ".concat(this.state.currentRate===r.value?"select-in":""));return n.innerHTML=this.i18n[r.textKey]||r.textKey,n.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault(),t.emit(RATE_CHANGE,{from:t.player.playbackRate,to:r.value}),t.state.currentRate=r.value,t.player.playbackRate=r.value,t.updatePanel()})),n}},{key:"renderPanel",value:function(e){var t,r;null===(t=this.player)||void 0===t||null===(r=t.panel)||void 0===r||r.showPanel(e,this.langText.rateSelect,!0)}},{key:"updatePanel",value:function(){var e,t=this.renderItemList();null===(e=this.player)||void 0===e||e.panel.updatePanel(t)}},{key:"destroy",value:function(){this.unbind(["click"],this.handleButtonChange.bind(this))}},{key:"render",value:function(){return'\n    <xg-icon class="xgplayer-mobile-playBackRate">\n      <div class="xgplayer-icon">\n      </div>\n    </xg-icon>\n    '}}],[{key:"pluginName",get:function(){return"PlaybackRateMobilePlugin"}},{key:"textTips",get:function(){return{jp:"å€é€Ÿ",en:"PlaybackRate",zh:"å€é€Ÿ","zh-hk":"å€é€Ÿ"}}},{key:"defaultConfig",get:function(){return{position:POSITIONS$4.CONTROLS_RIGHT,index:2.9,list:[2,1.5,1.25,1,.75,.5],default:1}}}]),r}(Plugin),SdkPlugin=function(){function e(t){_classCallCheck$8(this,e),this.__args=null,this.sdk=null,this.playerData=null,this.player=null,this._emitter=null,this.beforeCreate&&"function"==typeof this.beforeCreate&&this.beforeCreate(),this.__args=t,this.pluginName="",this.__init(t)}return _createClass$9(e,[{key:"beforeCreate",value:function(){}},{key:"afterCreate",value:function(){}},{key:"beforePlayerCreate",value:function(){}},{key:"afterPlayerCreate",value:function(){}},{key:"destroy",value:function(){}},{key:"__init",value:function(t){var r=this;e.defineGetterOrSetter(this,{sdk:{get:function(){return t.sdk},configurable:!0},player:{get:function(){return t.sdk.getPlayerInstance()},configurable:!0},playerData:{get:function(){return t.sdk.playerData},configurable:!0},pluginName:{get:function(){return t.pluginName?t.pluginName.toLowerCase():r.constructor.pluginName.toLowerCase()},configurable:!0},_emitter:{get:function(){return t.sdk._emitter},configurable:!0}})}},{key:"__destroy",value:function(){var e=this,t=this.sdk,r=this.pluginName;this.destroy&&"function"==typeof this.destroy&&this.destroy(),["sdk","player","playerData","pluginName","_emitter"].map((function(t){Object.defineProperty(e,t,{writable:!0})})),Object.keys(this).map((function(t){e[t]=null,delete e[t]})),Object.setPrototypeOf&&Object.setPrototypeOf(this,null),delete t._sdkPlugins[r]}}],[{key:"defineGetterOrSetter",value:function(e,t){for(var r in t)Object.defineProperty(e,r,t[r])}},{key:"pluginName",get:function(){return"pluginName"}}]),e}(),dist=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==_typeof$7(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=22)}([function(e,t,r){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,r){var n=r(12)("wks"),i=r(13),a=r(0).Symbol,o="function"==typeof a;(e.exports=function(e){return n[e]||(n[e]=o&&a[e]||(o?a:i)("Symbol."+e))}).store=n},function(e,t,r){var n=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=n)},function(e,t,r){var n=r(4);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){var n="function"==typeof Symbol&&"symbol"==_typeof$7(Symbol.iterator)?function(e){return _typeof$7(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof$7(e)};e.exports=function(e){return"object"===(void 0===e?"undefined":n(e))?null!==e:"function"==typeof e}},function(e,t,r){var n=r(6);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){e.exports=!r(15)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,r){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,r){var n=r(3),i=r(26),a=r(27),o=Object.defineProperty;t.f=r(7)?Object.defineProperty:function(e,t,r){if(n(e),t=a(t,!0),n(r),i)try{return o(e,t,r)}catch(s){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){e.exports=!1},function(e,t,r){var n=r(8),i=r(1)("toStringTag"),a="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,r,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(r){}}(t=Object(e),i))?r:a?n(t):"Object"==(o=n(t))&&"function"==typeof t.callee?"Arguments":o}},function(e,t,r){var n=r(2),i=r(0),a=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:r(10)?"pure":"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t,r){var n=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+i).toString(36))}},function(e,t,r){var n=r(9),i=r(28);e.exports=r(7)?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){e.exports=function(e){try{return!!e()}catch(t){return!0}}},function(e,t,r){var n=r(4),i=r(0).document,a=n(i)&&n(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t,r){var n=r(0),i=r(14),a=r(18),o=r(13)("src"),s=r(29),u=(""+s).split("toString");r(2).inspectSource=function(e){return s.call(e)},(e.exports=function(e,t,r,s){var c="function"==typeof r;c&&(a(r,"name")||i(r,"name",t)),e[t]!==r&&(c&&(a(r,o)||i(r,o,e[t]?""+e[t]:u.join(String(t)))),e===n?e[t]=r:s?e[t]?e[t]=r:i(e,t,r):(delete e[t],i(e,t,r)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[o]||s.call(this)}))},function(e,t,r){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,r){e.exports={}},function(e,t,r){var n,i,a,o=r(5),s=r(38),u=r(39),c=r(16),l=r(0),d=l.process,h=l.setImmediate,f=l.clearImmediate,p=l.MessageChannel,g=l.Dispatch,y=0,m={},v=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},_=function(e){v.call(e.data)};h&&f||(h=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return m[++y]=function(){s("function"==typeof e?e:Function(e),t)},n(y),y},f=function(e){delete m[e]},"process"==r(8)(d)?n=function(e){d.nextTick(o(v,e,1))}:g&&g.now?n=function(e){g.now(o(v,e,1))}:p?(a=(i=new p).port2,i.port1.onmessage=_,n=o(a.postMessage,a,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(n=function(e){l.postMessage(e+"","*")},l.addEventListener("message",_,!1)):n="onreadystatechange"in c("script")?function(e){u.appendChild(c("script")).onreadystatechange=function(){u.removeChild(this),v.call(e)}}:function(e){setTimeout(o(v,e,1),0)}),e.exports={set:h,clear:f}},function(e,t,r){var n=r(6);function i(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)}e.exports.f=function(e){return new i(e)}},function(e,t,r){e.exports=r(23)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),r(24);var n,i=(n=r(48))&&n.__esModule?n:{default:n};t.default={url:i.default},e.exports=t.default},function(e,t,r){var n,i,a,o,s=r(10),u=r(0),c=r(5),l=r(11),d=r(25),h=r(4),f=r(6),p=r(30),g=r(31),y=r(37),m=r(20).set,v=r(40)(),_=r(21),b=r(41),A=r(42),E=r(43),S=u.TypeError,T=u.process,w=T&&T.versions,C=w&&w.v8||"",k=u.Promise,I="process"==l(T),$=function(){},P=i=_.f,x=!!function(){try{var e=k.resolve(1),t=(e.constructor={})[r(1)("species")]=function(e){e($,$)};return(I||"function"==typeof PromiseRejectionEvent)&&e.then($)instanceof t&&0!==C.indexOf("6.6")&&-1===A.indexOf("Chrome/66")}catch(n){}}(),R=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},O=function(e,t){if(!e._n){e._n=!0;var r=e._c;v((function(){for(var n=e._v,i=1==e._s,a=0,o=function(t){var r,a,o,s=i?t.ok:t.fail,u=t.resolve,c=t.reject,l=t.domain;try{s?(i||(2==e._h&&M(e),e._h=1),!0===s?r=n:(l&&l.enter(),r=s(n),l&&(l.exit(),o=!0)),r===t.promise?c(S("Promise-chain cycle")):(a=R(r))?a.call(r,u,c):u(r)):c(n)}catch(d){l&&!o&&l.exit(),c(d)}};r.length>a;)o(r[a++]);e._c=[],e._n=!1,t&&!e._h&&D(e)}))}},D=function(e){m.call(u,(function(){var t,r,n,i=e._v,a=L(e);if(a&&(t=b((function(){I?T.emit("unhandledRejection",i,e):(r=u.onunhandledrejection)?r({promise:e,reason:i}):(n=u.console)&&n.error&&n.error("Unhandled promise rejection",i)})),e._h=I||L(e)?2:1),e._a=void 0,a&&t.e)throw t.v}))},L=function(e){return 1!==e._h&&0===(e._a||e._c).length},M=function(e){m.call(u,(function(){var t;I?T.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})}))},N=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),O(t,!0))},B=function e(t){var r,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw S("Promise can't be resolved itself");(r=R(t))?v((function(){var i={_w:n,_d:!1};try{r.call(t,c(e,i,1),c(N,i,1))}catch(a){N.call(i,a)}})):(n._v=t,n._s=1,O(n,!1))}catch(i){N.call({_w:n,_d:!1},i)}}};x||(k=function(e){p(this,k,"Promise","_h"),f(e),n.call(this);try{e(c(B,this,1),c(N,this,1))}catch(t){N.call(this,t)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(44)(k.prototype,{then:function(e,t){var r=P(y(this,k));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=I?T.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&O(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new n;this.promise=e,this.resolve=c(B,e,1),this.reject=c(N,e,1)},_.f=P=function(e){return e===k||e===o?new a(e):i(e)}),d(d.G+d.W+d.F*!x,{Promise:k}),r(45)(k,"Promise"),r(46)("Promise"),o=r(2).Promise,d(d.S+d.F*!x,"Promise",{reject:function(e){var t=P(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(s||!x),"Promise",{resolve:function(e){return E(s&&this===o?k:this,e)}}),d(d.S+d.F*!(x&&r(47)((function(e){k.all(e).catch($)}))),"Promise",{all:function(e){var t=this,r=P(t),n=r.resolve,i=r.reject,a=b((function(){var r=[],a=0,o=1;g(e,!1,(function(e){var s=a++,u=!1;r.push(void 0),o++,t.resolve(e).then((function(e){u||(u=!0,r[s]=e,--o||n(r))}),i)})),--o||n(r)}));return a.e&&i(a.v),r.promise},race:function(e){var t=this,r=P(t),n=r.reject,i=b((function(){g(e,!1,(function(e){t.resolve(e).then(r.resolve,n)}))}));return i.e&&n(i.v),r.promise}})},function(e,t,r){var n=r(0),i=r(2),a=r(14),o=r(17),s=r(5),u=function e(t,r,u){var c,l,d,h,f=t&e.F,p=t&e.G,g=t&e.P,y=t&e.B,m=p?n:t&e.S?n[r]||(n[r]={}):(n[r]||{}).prototype,v=p?i:i[r]||(i[r]={}),_=v.prototype||(v.prototype={});for(c in p&&(u=r),u)d=((l=!f&&m&&void 0!==m[c])?m:u)[c],h=y&&l?s(d,n):g&&"function"==typeof d?s(Function.call,d):d,m&&o(m,c,d,t&e.U),v[c]!=d&&a(v,c,h),g&&_[c]!=d&&(_[c]=d)};n.core=i,u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t,r){e.exports=!r(7)&&!r(15)((function(){return 7!=Object.defineProperty(r(16)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){var n=r(4);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){e.exports=r(12)("native-function-to-string",Function.toString)},function(e,t,r){e.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},function(e,t,r){var n=r(5),i=r(32),a=r(33),o=r(3),s=r(34),u=r(36),c={},l={},d=e.exports=function(e,t,r,d,h){var f,p,g,y,m=h?function(){return e}:u(e),v=n(r,d,t?2:1),_=0;if("function"!=typeof m)throw TypeError(e+" is not iterable!");if(a(m)){for(f=s(e.length);f>_;_++)if((y=t?v(o(p=e[_])[0],p[1]):v(e[_]))===c||y===l)return y}else for(g=m.call(e);!(p=g.next()).done;)if((y=i(g,v,p.value,t))===c||y===l)return y};d.BREAK=c,d.RETURN=l},function(e,t,r){var n=r(3);e.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(o){var a=e.return;throw void 0!==a&&n(a.call(e)),o}}},function(e,t,r){var n=r(19),i=r(1)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||a[i]===e)}},function(e,t,r){var n=r(35),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t,r){var n=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:n)(e)}},function(e,t,r){var n=r(11),i=r(1)("iterator"),a=r(19);e.exports=r(2).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||a[n(e)]}},function(e,t,r){var n=r(3),i=r(6),a=r(1)("species");e.exports=function(e,t){var r,o=n(e).constructor;return void 0===o||null==(r=n(o)[a])?t:i(r)}},function(e,t,r){e.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){var n=r(0).document;e.exports=n&&n.documentElement},function(e,t,r){var n=r(0),i=r(20).set,a=n.MutationObserver||n.WebKitMutationObserver,o=n.process,s=n.Promise,u="process"==r(8)(o);e.exports=function(){var e,t,r,c=function(){var n,i;for(u&&(n=o.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(a){throw e?r():t=void 0,a}}t=void 0,n&&n.enter()};if(u)r=function(){o.nextTick(c)};else if(!a||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var l=s.resolve(void 0);r=function(){l.then(c)}}else r=function(){i.call(n,c)};else{var d=!0,h=document.createTextNode("");new a(c).observe(h,{characterData:!0}),r=function(){h.data=d=!d}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}},function(e,t,r){e.exports=function(e){try{return{e:!1,v:e()}}catch(t){return{e:!0,v:t}}}},function(e,t,r){var n=r(0).navigator;e.exports=n&&n.userAgent||""},function(e,t,r){var n=r(3),i=r(4),a=r(21);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=a.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){var n=r(17);e.exports=function(e,t,r){for(var i in t)n(e,i,t[i],r);return e}},function(e,t,r){var n=r(9).f,i=r(18),a=r(1)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,a)&&n(e,a,{configurable:!0,value:t})}},function(e,t,r){var n=r(0),i=r(9),a=r(7),o=r(1)("species");e.exports=function(e){var t=n[e];a&&t&&!t[o]&&i.f(t,o,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(1)("iterator"),i=!1;try{var a=[7][n]();a.return=function(){i=!0},Array.from(a,(function(){throw 2}))}catch(o){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var a=[7],o=a[n]();o.next=function(){return{done:r=!0}},a[n]=function(){return o},e(a)}catch(s){}return r}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==_typeof$7(Symbol.iterator)?function(e){return _typeof$7(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof$7(e)};t.default=function(e,t,r){if(e&&t){var i=void 0;try{i=(0,a.getUri)(e,t,r)}catch(s){return Promise.reject(s.message)}return new o.default({type:"json",method:"GET",url:i}).then((function(e){return e&&e.response?"string"==typeof e.response?JSON.parse(e.response).Result:"object"===n(e.response)?e.response.Result:e.response:e}))}return Promise.reject("vid, host and token can't be empty")};var i,a=r(49),o=(i=r(51))&&i.__esModule?i:{default:i};e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getUri=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{e=JSON.parse((0,n.decode)(e))}catch(s){throw new Error("base64 decode error: "+s.message)}var i=[];for(var a in r)i.push(a+"="+r[a]);var o=(/^http/.test(t)?t:"//"+t)+"?"+e.GetPlayInfoToken+"&ssl=true";return i.length>0&&(o+="&"+i.join("&")),o};var n=r(50)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.decode=function(e){var t,r,n,i,a,o,s,u=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];for(o=e.length,a=0,s="";a<o;){do{t=u[255&e.charCodeAt(a++)]}while(a<o&&-1===t);if(-1===t)break;do{r=u[255&e.charCodeAt(a++)]}while(a<o&&-1===r);if(-1===r)break;s+=String.fromCharCode(t<<2|(48&r)>>4);do{if(61==(n=255&e.charCodeAt(a++)))return s;n=u[n]}while(a<o&&-1===n);if(-1===n)break;s+=String.fromCharCode((15&r)<<4|(60&n)>>2);do{if(61==(i=255&e.charCodeAt(a++)))return s;i=u[i]}while(a<o&&-1===i);if(-1===i)break;s+=String.fromCharCode((3&n)<<6|i)}return s}},function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.url,i=t.method,a=void 0===i?"GET":i,o=(t.type,t.data),s=void 0===o?{}:o,u=t.headers,c=void 0===u?{}:u;return n(this,e),new Promise((function(e,t){var n=new window.XMLHttpRequest,i=a.toUpperCase(),o=[];for(var u in s)o.push(u+"="+s[u]);if("GET"!==i)throw new Error("xhr "+i+" is not supported");for(var l in n.open(i,""+r,!0),n.responseType="",c)n.setRequestHeader(l,""+c[l]);n.send(),n.onload=function(){200===n.status||206===n.status?e(n):t(n)},n.onerror=function(){t(n)},n.ontimeout=function(){t(n)}}))},e.exports=t.default}]),AuthToken=function(e){_inherits$8(i,e);var t,r,n=_createSuper$u(i);function i(e){var t;return _classCallCheck$8(this,i),(t=n.call(this,e)).isPlayByToken=!1,t.isEncrypt=!1,t.config=null,t.getPlayInfoByAuthToken=function(){var e=_asyncToGenerator$7(_regeneratorRuntime$5().mark((function e(t){var r,n,i,a,o,s,u,c,l,d,h,f,p,g,y,m,v,_,b,A,E,S,T,w,C,k,I,$,P;return _regeneratorRuntime$5().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.playAuthToken,n=t.isInternal,i=void 0!==n&&n,a=t.playDomain,o=t.reqParams,s=void 0===o?{}:o,u=t.definitionMap,c=t.needThumbs,l=void 0!==c&&c,d=t.needBarrageMask,h=void 0!==d&&d,!r){e.next=15;break}return p=i?TOC_PLAY_DOMAIN:TOB_PLAY_DOMAIN,g=a||p,y=_objectSpread2$7(_objectSpread2$7({},s),{},{NeedThumbs:l?1:0,NeedBarrageMask:h?1:0}),e.next=7,dist.url(r,g,y);case 7:if(m=e.sent,v=i?m.Data:m,_=v.Status,b=v.PlayInfoList,A=void 0===b?[]:b,E=v.PosterUrl,S=v.CoverUrl,T=v.VideoID,w=v.Vid,C=v.Duration,k=v.BarrageMaskUrl,I=v.ThumbInfoList,$=void 0===I?[]:I,_!==VIDEO_STATUS_TYPE.VALID||null===(f=A[0])||void 0===f||!f.MainPlayUrl){e.next=14;break}return P=A.map((function(e){return _objectSpread2$7(_objectSpread2$7({lineId:1,lineName:"1",url:e.MainPlayUrl,streamType:e.Format,backUrlList:[e.BackupPlayUrl],bitrate:e.Bitrate,size:e.Size,kid:e.PlayAuthId,vwidth:e.Width,vheight:e.Height},e),getDefinitionInfo(e,u))})).filter((function(e){return e.definition})).sort((function(e,t){return t.Bitrate-e.Bitrate})),e.abrupt("return",{playList:P,poster:i?S:E,vid:i?T:w,duration:C,dashOpts:i?m:{Data:m},thumbs:$,barrageMaskUrl:k});case 14:console.warn("è§†é¢‘ä¸å¯ç”¨ï¼Œè¯·æ£€æŸ¥è§†é¢‘å‘å¸ƒçŠ¶æ€");case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.init(),t}return _createClass$9(i,[{key:"beforePlayerCreate",value:(r=_asyncToGenerator$7(_regeneratorRuntime$5().mark((function e(){return _regeneratorRuntime$5().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPlayByToken){e.next=3;break}return e.next=3,this.getConfig();case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getConfig",value:(t=_asyncToGenerator$7(_regeneratorRuntime$5().mark((function e(){var t,r,n,i,a,o,s,u,c,l,d,h,f,p,g,y;return _regeneratorRuntime$5().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"hls"!==(r=(null===(t=this.tokenInfo)||void 0===t?void 0:t.Format)||"mp4")||!this.config.keyToken){e.next=5;break}return this.getEncryptHlsConfig(),e.abrupt("return");case 5:return e.next=7,this.getPlayInfoByAuthToken(this.config);case 7:if(e.t0=e.sent,e.t0){e.next=10;break}e.t0={};case 10:n=e.t0,i=n.playList,a=n.poster,o=n.vid,s=n.dashOpts,u=n.thumbs,c=n.barrageMaskUrl,this.playerData.options.vid=o,this.config.needPoster&&(this.playerData.options.poster=a),this.config.needThumbs&&u.length>0&&this.getThumbnailConfig(u),this.config.needBarrageMask&&c&&this.getBarrageMaskUrl(c),("dash"===r||this.playerData.options.DASHPlugin)&&this.getDashPluginConfig(o,s),i.length>0&&(l=this.playerData.options,d=l.autoBitrateOpts,h=l.Mp4EncryptPlayer,f=l.enableMp4MSE,("mp4"===r&&this.isEncrypt||"mp4"===r&&null!=d&&d.isOpenAutoDefi||h||f)&&this.getMp4EncryptConfig({vid:o,playList:i}),this.playerData.playList="mp4"===r&&this.isEncrypt?[i[0]]:i,p=this.playerData.playList[0],g=(null==d?void 0:d.isOpenAutoDefi)&&(null==d?void 0:d.isPlayAutoDefi),this.playerData.options.definition=_objectSpread2$7(_objectSpread2$7({},g?{}:{defaultDefinition:p.definition}),{},{list:this.playerData.playList}),this.playerData.initCurrent(this.playerData.playList[0])),e.next=29;break;case 25:e.prev=25,e.t1=e.catch(0),null===(y=this._emitter)||void 0===y||y.emit(PluginEvents.GET_PLAY_URL_ERR),console.error(e.t1);case 29:case"end":return e.stop()}}),e,this,[[0,25]])}))),function(){return t.apply(this,arguments)})},{key:"getEncryptHlsConfig",value:function(){var e=this.config,t=e.playAuthToken,r=e.isInternal,n=void 0!==r&&r,i=e.playDomain,a=e.keyToken,o=e.keyDomain,s=e.getKeyType,u=n?TOC_PLAY_DOMAIN:TOB_PLAY_DOMAIN,c=_objectSpread2$7({},this.playerData.options.EncryptHlsPlugin||{});this.playerData.options.EncryptHlsPlugin=_objectSpread2$7({playAuthToken:t,keyToken:a,playDomain:i||u,getKeyType:s||"TOP",keyDomain:o||TOB_KEY_DOMAIN},c)}},{key:"getThumbnailConfig",value:function(e){var t=e[0],r=_objectSpread2$7({},this.playerData.options.thumbnail||{});this.playerData.options.thumbnail=_objectSpread2$7({pic_num:t.CaptureNum,urls:t.StoreUrls,width:t.CellWidth,height:t.CellHeight,col:t.ImgXLen,row:t.ImgYLen},r)}},{key:"getBarrageMaskUrl",value:function(e){var t,r,n=_objectSpread2$7({},(null===(t=this.playerData.options)||void 0===t||null===(r=t.DanmuPlugin)||void 0===r?void 0:r.maskConfig)||{});this.playerData.options.DanmuPlugin?(this.playerData.options.DanmuPlugin.active=!0,this.playerData.options.DanmuPlugin.maskActive=!0,this.playerData.options.DanmuPlugin.maskConfig=_objectSpread2$7({maskUrl:e},n)):this.playerData.options.DanmuPlugin={active:!0,maskActive:!0,maskConfig:_objectSpread2$7({maskUrl:e},n)}}},{key:"getDashPluginConfig",value:function(e,t){var r=_objectSpread2$7({},this.playerData.options.DASHPlugin||{});this.playerData.options.DASHPlugin=_objectSpread2$7({getLicenseUrl:LICENSE_URL,playInfoType:"TOP",vid:e,dashOpts:t,defaultFormat:"dash",definitionText:this.config.definitionMap},r)}},{key:"getMp4EncryptConfig",value:function(e){var t=e.playList,r=e.vid,n=_objectSpread2$7({},this.playerData.options.Mp4EncryptPlayer||{});this.playerData.options.Mp4EncryptPlayer=_objectSpread2$7(_objectSpread2$7({vid:r,bitrate:null==t?void 0:t[0].Bitrate},this.isEncrypt?{isEncrypt:!0,kid:t[0].kid,getLicenseUrl:LICENSE_URL}:{}),n)}},{key:"init",value:function(){var e=this.playerData.configs,t=e.getVideoByToken,r=void 0===t?{}:t;this.initConfig(r,e)}},{key:"initConfig",value:function(e,t){this.isPlayByToken=!!e.playAuthToken,this.isPlayByToken&&(!Object.keys(e).includes("isInternal")&&Object.keys(t).includes("isInternal")&&(e.isInternal=t.isInternal),this.config=e,this.isEncrypt=isEncryptPlay(e),this.tokenInfo=parseToken(e.playAuthToken))}},{key:"switchAuthToken",value:function(e){var t=this.playerData.configs;this.initConfig(e,t),this.player.emit(SDKEvents.PLAYER_REBUILD)}}],[{key:"pluginName",get:function(){return"AuthToken"}}]),i}(SdkPlugin);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var $$5=_export,copyWithin=arrayCopyWithin,addToUnscopables=addToUnscopables$6;$$5({target:"Array",proto:!0},{copyWithin:copyWithin}),addToUnscopables("copyWithin");var uncurryThis$1=functionUncurryThis,requireObjectCoercible=requireObjectCoercible$e,toString=toString$v,quot=/"/g,replace=uncurryThis$1("".replace),createHtml=function(e,t,r,n){var i=toString(requireObjectCoercible(e)),a="<"+t;return""!==r&&(a+=" "+r+'="'+replace(toString(n),quot,"&quot;")+'"'),a+">"+i+"</"+t+">"},fails$1=fails$10,stringHtmlForced=function(e){return fails$1((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))},$$4=_export,createHTML=createHtml,forcedStringHTMLMethod=stringHtmlForced;$$4({target:"String",proto:!0,forced:forcedStringHTMLMethod("link")},{link:function(e){return createHTML(this,"a","href",e)}});var $$3=_export,ArrayBufferViewCore=arrayBufferViewCore,NATIVE_ARRAY_BUFFER_VIEWS=ArrayBufferViewCore.NATIVE_ARRAY_BUFFER_VIEWS;$$3({target:"ArrayBuffer",stat:!0,forced:!NATIVE_ARRAY_BUFFER_VIEWS},{isView:ArrayBufferViewCore.isView});var $$2=_export,uncurryThis=functionUncurryThis,isArray=isArray$8,nativeReverse=uncurryThis([].reverse),test=[1,2];$$2({target:"Array",proto:!0,forced:String(test)===String(test.reverse())},{reverse:function(){return isArray(this)&&(this.length=this.length),nativeReverse(this)}});var abrAlgo=function(){var t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return function(r){var n,i,a=void 0!==(r=r||{})?r:{};a.ready=new Promise((function(e,t){n=e,i=t})),Object.getOwnPropertyDescriptor(a.ready,"_getPredictedBitrate")||(Object.defineProperty(a.ready,"_getPredictedBitrate",{configurable:!0,get:function(){ee("You are getting _getPredictedBitrate on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_getPredictedBitrate",{configurable:!0,set:function(){ee("You are setting _getPredictedBitrate on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_updateMediaInfo")||(Object.defineProperty(a.ready,"_updateMediaInfo",{configurable:!0,get:function(){ee("You are getting _updateMediaInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_updateMediaInfo",{configurable:!0,set:function(){ee("You are setting _updateMediaInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_updateBufferInfo")||(Object.defineProperty(a.ready,"_updateBufferInfo",{configurable:!0,get:function(){ee("You are getting _updateBufferInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_updateBufferInfo",{configurable:!0,set:function(){ee("You are setting _updateBufferInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_updateSwitchInfo")||(Object.defineProperty(a.ready,"_updateSwitchInfo",{configurable:!0,get:function(){ee("You are getting _updateSwitchInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_updateSwitchInfo",{configurable:!0,set:function(){ee("You are setting _updateSwitchInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_updateDeviceInfo")||(Object.defineProperty(a.ready,"_updateDeviceInfo",{configurable:!0,get:function(){ee("You are getting _updateDeviceInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_updateDeviceInfo",{configurable:!0,set:function(){ee("You are setting _updateDeviceInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_parseMPD")||(Object.defineProperty(a.ready,"_parseMPD",{configurable:!0,get:function(){ee("You are getting _parseMPD on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_parseMPD",{configurable:!0,set:function(){ee("You are setting _parseMPD on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_getPreloadBitrate")||(Object.defineProperty(a.ready,"_getPreloadBitrate",{configurable:!0,get:function(){ee("You are getting _getPreloadBitrate on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_getPreloadBitrate",{configurable:!0,set:function(){ee("You are setting _getPreloadBitrate on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_updatePreloadSupplier")||(Object.defineProperty(a.ready,"_updatePreloadSupplier",{configurable:!0,get:function(){ee("You are getting _updatePreloadSupplier on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_updatePreloadSupplier",{configurable:!0,set:function(){ee("You are setting _updatePreloadSupplier on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_updatePreloadInfo")||(Object.defineProperty(a.ready,"_updatePreloadInfo",{configurable:!0,get:function(){ee("You are getting _updatePreloadInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_updatePreloadInfo",{configurable:!0,set:function(){ee("You are setting _updatePreloadInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_setDebugModel")||(Object.defineProperty(a.ready,"_setDebugModel",{configurable:!0,get:function(){ee("You are getting _setDebugModel on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_setDebugModel",{configurable:!0,set:function(){ee("You are setting _setDebugModel on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_free")||(Object.defineProperty(a.ready,"_free",{configurable:!0,get:function(){ee("You are getting _free on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_free",{configurable:!0,set:function(){ee("You are setting _free on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"___stdio_exit")||(Object.defineProperty(a.ready,"___stdio_exit",{configurable:!0,get:function(){ee("You are getting ___stdio_exit on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"___stdio_exit",{configurable:!0,set:function(){ee("You are setting ___stdio_exit on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"onRuntimeInitialized")||(Object.defineProperty(a.ready,"onRuntimeInitialized",{configurable:!0,get:function(){ee("You are getting onRuntimeInitialized on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"onRuntimeInitialized",{configurable:!0,set:function(){ee("You are setting onRuntimeInitialized on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}));var o=Object.assign({},a);if(a.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -s ENVIRONMENT=web or -s ENVIRONMENT=node)");var s,u,c="";if("undefined"!=typeof document&&document.currentScript&&(c=document.currentScript.src),t&&(c=t),c=0!==c.indexOf("blob:")?c.substr(0,c.replace(/[?#].*/,"").lastIndexOf("/")+1):"","object"!=("undefined"==typeof window?"undefined":_typeof(window))&&"function"!=typeof importScripts)throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");s=function(e){try{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText}catch(n){var r=ke(e);if(r)return function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];n>255&&(S(!1,"Character code "+n+" ("+String.fromCharCode(n)+")  at offset "+r+" not in 0x00-0xFF."),n&=255),t.push(String.fromCharCode(n))}return t.join("")}(r);throw n}},u=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){if(200==n.status||0==n.status&&n.response)t(n.response);else{var i=ke(e);i?t(i.buffer):r()}},n.onerror=r,n.send(null)};var l,d=a.print||console.log.bind(console),h=a.printErr||console.warn.bind(console);function f(e){f.shown||(f.shown={}),f.shown[e]||(f.shown[e]=1,h(e))}function p(e,t){Object.getOwnPropertyDescriptor(a,e)||Object.defineProperty(a,e,{configurable:!0,get:function(){ee("Module."+e+" has been replaced with plain "+t+" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}})}function g(e,t){var r="'"+e+"' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the FAQ)";return t&&(r+=". Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you"),r}function y(e,t){Object.getOwnPropertyDescriptor(a,e)||Object.defineProperty(a,e,{configurable:!0,get:function(){ee(g(e,t))}})}function m(e,t){Object.getOwnPropertyDescriptor(a,e)||(a[e]=function(){return ee(g(e,t))})}Object.assign(a,o),o=null,l="fetchSettings",Object.getOwnPropertyDescriptor(a,l)&&ee("`Module."+l+"` was supplied but `"+l+"` not included in INCOMING_MODULE_JS_API"),a.arguments&&a.arguments,p("arguments","arguments_"),a.thisProgram&&a.thisProgram,p("thisProgram","thisProgram"),a.quit&&a.quit,p("quit","quit_"),S(void 0===a.memoryInitializerPrefixURL,"Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),S(void 0===a.pthreadMainPrefixURL,"Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),S(void 0===a.cdInitializerPrefixURL,"Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),S(void 0===a.filePackagePrefixURL,"Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),S(void 0===a.read,"Module.read option was removed (modify read_ in JS)"),S(void 0===a.readAsync,"Module.readAsync option was removed (modify readAsync in JS)"),S(void 0===a.readBinary,"Module.readBinary option was removed (modify readBinary in JS)"),S(void 0===a.setWindowTitle,"Module.setWindowTitle option was removed (modify setWindowTitle in JS)"),S(void 0===a.TOTAL_MEMORY,"Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),p("read","read_"),p("readAsync","readAsync"),p("readBinary","readBinary"),p("setWindowTitle","setWindowTitle"),S(!0,"worker environment detected but not enabled at build time.  Add 'worker' to `-s ENVIRONMENT` to enable."),S(!0,"node environment detected but not enabled at build time.  Add 'node' to `-s ENVIRONMENT` to enable."),S(!0,"shell environment detected but not enabled at build time.  Add 'shell' to `-s ENVIRONMENT` to enable.");var v,_=0;a.wasmBinary&&(v=a.wasmBinary),p("wasmBinary","wasmBinary"),a.noExitRuntime,p("noExitRuntime","noExitRuntime");var b,A={Memory:function(e){this.buffer=new ArrayBuffer(65536*e.initial)},Module:function(e){},Instance:function(e,t){this.exports=function(e){for(var t,r=new Uint8Array(123),n=25;n>=0;--n)r[48+n]=52+n,r[65+n]=n,r[97+n]=26+n;function i(e,t,n){for(var i,a,o=0,s=t,u=n.length,c=t+(3*u>>2)-("="==n[u-2])-("="==n[u-1]);o<u;o+=4)i=r[n.charCodeAt(o+1)],a=r[n.charCodeAt(o+2)],e[s++]=r[n.charCodeAt(o)]<<2|i>>4,s<c&&(e[s++]=i<<4|a>>2),s<c&&(e[s++]=a<<6|r[n.charCodeAt(o+3)])}r[43]=62,r[47]=63;var a=new ArrayBuffer(16),o=new Int32Array(a),s=new Float64Array(a);function u(e){return o[e]}function c(e,t){o[e]=t}function l(){return s[0]}function d(e){s[0]=e}return function(e){var r=e.memory,n=r.buffer;r.grow=function(e){e|=0;var i=0|si(),u=i+e|0;if(i<u&&u<65536){var c=new ArrayBuffer(m(u,65536));new Int8Array(c).set(a),a=new Int8Array(c),o=new Int16Array(c),s=new Int32Array(c),h=new Uint8Array(c),f=new Uint16Array(c),p=new Uint32Array(c),g=new Float32Array(c),y=new Float64Array(c),n=c,r.buffer=n,t=h}return i};var a=new Int8Array(n),o=new Int16Array(n),s=new Int32Array(n),h=new Uint8Array(n),f=new Uint16Array(n),p=new Uint32Array(n),g=new Float32Array(n),y=new Float64Array(n),m=Math.imul,v=Math.fround,_=Math.abs,b=Math.clz32,A=Math.min,E=Math.floor,S=Math.ceil,T=e.abort,w=e.gettimeofday,C=e.__assert_fail,k=e.__cxa_allocate_exception,I=e.__cxa_throw,$=e.emscripten_memcpy_big,P=e.fd_write,x=e.emscripten_resize_heap,R=e.fd_read,O=e.fd_close,D=e.abort,L=e.setTempRet0,M=e.fd_seek,N=20800,B=0,U=0,G=0;function V(e){var t,r=0,n=0,i=0,a=0,o=0,u=0,c=0,l=0,d=0,f=0,g=0,y=0;N=t=N-16|0;e:{t:{r:{n:{i:{a:{o:{s:{u:{c:{l:{if((e|=0)>>>0<=244){if(3&(r=(a=s[2763])>>>(n=(u=e>>>0<11?16:e+11&-8)>>>3|0)|0)){e=(o=s[(r=(i=n+(1&(-1^r))|0)<<3)+11100>>2])+8|0,(0|(n=s[o+8>>2]))!=(0|(r=r+11092|0))?(s[n+12>>2]=r,s[r+8>>2]=n):(g=11052,y=tr(i)&a,s[g>>2]=y),r=i<<3,s[o+4>>2]=3|r,s[(r=r+o|0)+4>>2]=1|s[r+4>>2];break e}if((f=s[2765])>>>0>=u>>>0)break l;if(r){n=e=(r=(0-(e=(0-(e=2<<n)|e)&r<<n)&e)-1|0)>>>12&16,n|=e=(r=r>>>e|0)>>>5&8,n|=e=(r=r>>>e|0)>>>2&4,d=s[(e=(n=((n|=e=(r=r>>>e|0)>>>1&2)|(e=(r=r>>>e|0)>>>1&1))+(r>>>e|0)|0)<<3)+11100>>2],(0|(r=s[d+8>>2]))!=(0|(e=e+11092|0))?(s[r+12>>2]=e,s[e+8>>2]=r):(a=tr(n)&a,s[2763]=a),e=d+8|0,s[d+4>>2]=3|u,o=(r=n<<3)-u|0,s[(i=u+d|0)+4>>2]=1|o,s[r+d>>2]=o,f&&(n=11092+((r=f>>>3|0)<<3)|0,d=s[2768],(r=1<<r)&a?r=s[n+8>>2]:(s[2763]=r|a,r=n),s[n+8>>2]=d,s[r+12>>2]=d,s[d+12>>2]=n,s[d+8>>2]=r),s[2768]=i,s[2765]=o;break e}if(!(c=s[2764]))break l;for(n=e=(r=(0-c&c)-1|0)>>>12&16,n|=e=(r=r>>>e|0)>>>5&8,n|=e=(r=r>>>e|0)>>>2&4,r=s[11356+(((n|=e=(r=r>>>e|0)>>>1&2)|(e=(r=r>>>e|0)>>>1&1))+(r>>>e|0)<<2)>>2],i=(-8&s[r+4>>2])-u|0,n=r;(e=s[n+16>>2])||(e=s[n+20>>2]);)i=(o=(n=(-8&s[e+4>>2])-u|0)>>>0<i>>>0)?n:i,r=o?e:r,n=e;if(l=s[r+24>>2],(0|(o=s[r+12>>2]))!=(0|r)){e=s[r+8>>2],s[e+12>>2]=o,s[o+8>>2]=e;break t}if(!(e=s[(n=r+20|0)>>2])){if(!(e=s[r+16>>2]))break c;n=r+16|0}for(;d=n,o=e,(e=s[(n=e+20|0)>>2])||(n=o+16|0,e=s[o+16>>2]););s[d>>2]=0;break t}if(u=-1,!(e>>>0>4294967231)&&(u=-8&(e=e+11|0),l=s[2764])){i=0-u|0,a=0,u>>>0<256||(a=31,u>>>0>16777215||(e=e>>>8|0,e<<=d=e+1048320>>>16&8,a=28+((e=((e<<=n=e+520192>>>16&4)<<(r=e+245760>>>16&2)>>>15|0)-(r|n|d)|0)<<1|u>>>e+21&1)|0));d:{h:{if(n=s[11356+(a<<2)>>2])for(e=0,r=u<<(31==(0|a)?0:25-(a>>>1|0)|0);;){if(!((d=(c=-8&s[n+4>>2])-u|0)>>>0>=i>>>0)&&(i=d,o=n,(0|u)==(0|c))){i=0,e=n;break h}if(d=s[n+20>>2],n=s[16+((r>>>29&4)+n|0)>>2],e=d?(0|d)==(0|n)?e:d:e,r<<=1,!n)break}else e=0;if(!(e|o)){if(o=0,!(e=(0-(e=2<<a)|e)&l))break l;n=e=(r=(e&0-e)-1|0)>>>12&16,n|=e=(r=r>>>e|0)>>>5&8,n|=e=(r=r>>>e|0)>>>2&4,e=s[11356+(((n|=e=(r=r>>>e|0)>>>1&2)|(e=(r=r>>>e|0)>>>1&1))+(r>>>e|0)<<2)>>2]}if(!e)break d}for(;i=(n=(r=(-8&s[e+4>>2])-u|0)>>>0<i>>>0)?r:i,o=n?e:o,e=(r=s[e+16>>2])||s[e+20>>2];);}if(!(!o|s[2765]-u>>>0<=i>>>0)){if(a=s[o+24>>2],(0|o)!=(0|(r=s[o+12>>2]))){e=s[o+8>>2],s[e+12>>2]=r,s[r+8>>2]=e;break r}if(!(e=s[(n=o+20|0)>>2])){if(!(e=s[o+16>>2]))break u;n=o+16|0}for(;d=n,r=e,(e=s[(n=e+20|0)>>2])||(n=r+16|0,e=s[r+16>>2]););s[d>>2]=0;break r}}}if((n=s[2765])>>>0>=u>>>0){i=s[2768],(r=n-u|0)>>>0>=16?(s[2765]=r,e=i+u|0,s[2768]=e,s[e+4>>2]=1|r,s[n+i>>2]=r,s[i+4>>2]=3|u):(s[2768]=0,s[2765]=0,s[i+4>>2]=3|n,s[(e=n+i|0)+4>>2]=1|s[e+4>>2]),e=i+8|0;break e}if((l=s[2766])>>>0>u>>>0){r=l-u|0,s[2766]=r,e=(n=s[2769])+u|0,s[2769]=e,s[e+4>>2]=1|r,s[n+4>>2]=3|u,e=n+8|0;break e}if(e=0,c=u+47|0,s[2881]?n=s[2883]:(s[2884]=-1,s[2885]=-1,s[2882]=4096,s[2883]=4096,s[2881]=t+12&-16^1431655768,s[2886]=0,s[2874]=0,n=4096),(n=(d=c+n|0)&(o=0-n|0))>>>0<=u>>>0)break e;if((i=s[2873])&&(a=(r=s[2871])+n|0)>>>0>i>>>0|r>>>0>=a>>>0)break e;if(4&h[11496])break a;l:{d:{if(i=s[2769])for(e=11500;;){if((r=s[e>>2])>>>0<=i>>>0&i>>>0<r+s[e+4>>2]>>>0)break d;if(!(e=s[e+8>>2]))break}if(-1==(0|(r=Qe(0))))break o;if(a=n,(e=(i=s[2882])-1|0)&r&&(a=(n-r|0)+(e+r&0-i)|0),a>>>0<=u>>>0|a>>>0>2147483646)break o;if((i=s[2873])&&i>>>0<(o=(e=s[2871])+a|0)>>>0|e>>>0>=o>>>0)break o;if((0|r)!=(0|(e=Qe(a))))break l;break i}if((a=o&d-l)>>>0>2147483646)break o;if((0|(r=Qe(a)))==(s[e>>2]+s[e+4>>2]|0))break s;e=r}if(!(-1==(0|e)|u+48>>>0<=a>>>0)){if((r=(r=s[2883])+(c-a|0)&0-r)>>>0>2147483646){r=e;break i}if(-1!=(0|Qe(r))){a=r+a|0,r=e;break i}Qe(0-a|0);break o}if(r=e,-1!=(0|e))break i;break o}o=0;break t}r=0;break r}if(-1!=(0|r))break i}s[2874]=4|s[2874]}if(n>>>0>2147483646)break n;if(-1==(0|(r=Qe(n)))|-1==(0|(e=Qe(0)))|e>>>0<=r>>>0)break n;if((a=e-r|0)>>>0<=u+40>>>0)break n}e=s[2871]+a|0,s[2871]=e,e>>>0>p[2872]&&(s[2872]=e);i:{a:{o:{if(c=s[2769]){for(e=11500;;){if(((i=s[e>>2])+(n=s[e+4>>2])|0)==(0|r))break o;if(!(e=s[e+8>>2]))break}break a}for((e=s[2767])>>>0<=r>>>0&&e||(s[2767]=r),e=0,s[2876]=a,s[2875]=r,s[2771]=-1,s[2772]=s[2881],s[2878]=0;n=(i=e<<3)+11092|0,s[i+11100>>2]=n,s[i+11104>>2]=n,32!=(0|(e=e+1|0)););n=(i=a-40|0)-(e=r+8&7?-8-r&7:0)|0,s[2766]=n,e=e+r|0,s[2769]=e,s[e+4>>2]=1|n,s[4+(r+i|0)>>2]=40,s[2770]=s[2885];break i}if(!(8&h[e+12|0]|i>>>0>c>>>0|r>>>0<=c>>>0)){s[e+4>>2]=n+a,n=(e=c+8&7?-8-c&7:0)+c|0,s[2769]=n,e=(r=s[2766]+a|0)-e|0,s[2766]=e,s[n+4>>2]=1|e,s[4+(r+c|0)>>2]=40,s[2770]=s[2885];break i}}p[2767]>r>>>0&&(s[2767]=r),n=r+a|0,e=11500;a:{o:{s:{u:{c:{l:{for(;;){if((0|n)!=s[e>>2]){if(e=s[e+8>>2])continue;break l}break}if(!(8&h[e+12|0]))break c}for(e=11500;;){if((n=s[e>>2])>>>0<=c>>>0&&(o=n+s[e+4>>2]|0)>>>0>c>>>0)break u;e=s[e+8>>2]}}if(s[e>>2]=r,s[e+4>>2]=s[e+4>>2]+a,s[(d=(r+8&7?-8-r&7:0)+r|0)+4>>2]=3|u,u=(a=n+(n+8&7?-8-n&7:0)|0)-(l=u+d|0)|0,(0|a)==(0|c)){s[2769]=l,e=s[2766]+u|0,s[2766]=e,s[l+4>>2]=1|e;break o}if(s[2768]==(0|a)){s[2768]=l,e=s[2765]+u|0,s[2765]=e,s[l+4>>2]=1|e,s[e+l>>2]=e;break o}if(1==(3&(e=s[a+4>>2]))){o=-8&e;c:if(e>>>0<=255){if(n=s[a+8>>2],e=e>>>3|0,(0|(r=s[a+12>>2]))==(0|n)){g=11052,y=s[2763]&tr(e),s[g>>2]=y;break c}s[n+12>>2]=r,s[r+8>>2]=n}else{if(c=s[a+24>>2],(0|a)==(0|(r=s[a+12>>2])))if((i=s[(e=a+20|0)>>2])||(i=s[(e=a+16|0)>>2])){for(;n=e,(i=s[(e=(r=i)+20|0)>>2])||(e=r+16|0,i=s[r+16>>2]););s[n>>2]=0}else r=0;else e=s[a+8>>2],s[e+12>>2]=r,s[r+8>>2]=e;if(c){n=s[a+28>>2];l:{if(s[(e=11356+(n<<2)|0)>>2]==(0|a)){if(s[e>>2]=r,r)break l;g=11056,y=s[2764]&tr(n),s[g>>2]=y;break c}if(s[c+(s[c+16>>2]==(0|a)?16:20)>>2]=r,!r)break c}s[r+24>>2]=c,(e=s[a+16>>2])&&(s[r+16>>2]=e,s[e+24>>2]=r),(e=s[a+20>>2])&&(s[r+20>>2]=e,s[e+24>>2]=r)}}u=o+u|0,a=a+o|0}if(s[a+4>>2]=-2&s[a+4>>2],s[l+4>>2]=1|u,s[u+l>>2]=u,u>>>0<=255){r=11092+((e=u>>>3|0)<<3)|0,(n=s[2763])&(e=1<<e)?e=s[r+8>>2]:(s[2763]=e|n,e=r),s[r+8>>2]=l,s[e+12>>2]=l,s[l+12>>2]=r,s[l+8>>2]=e;break o}if(e=31,u>>>0<=16777215&&(e=u>>>8|0,e<<=i=e+1048320>>>16&8,e=28+((e=((e<<=n=e+520192>>>16&4)<<(r=e+245760>>>16&2)>>>15|0)-(r|n|i)|0)<<1|u>>>e+21&1)|0),s[l+28>>2]=e,s[l+16>>2]=0,s[l+20>>2]=0,i=11356+(e<<2)|0,(n=s[2764])&(r=1<<e)){for(e=u<<(31==(0|e)?0:25-(e>>>1|0)|0),r=s[i>>2];;){if(n=r,(-8&s[r+4>>2])==(0|u))break s;if(r=e>>>29|0,e<<=1,!(r=s[(i=n+(4&r)|0)+16>>2]))break}s[i+16>>2]=l,s[l+24>>2]=n}else s[2764]=r|n,s[i>>2]=l,s[l+24>>2]=i;s[l+12>>2]=l,s[l+8>>2]=l;break o}for(n=(i=a-40|0)-(e=r+8&7?-8-r&7:0)|0,s[2766]=n,e=e+r|0,s[2769]=e,s[e+4>>2]=1|n,s[4+(r+i|0)>>2]=40,s[2770]=s[2885],s[(n=(e=(o+(o-39&7?39-o&7:0)|0)-47|0)>>>0<c+16>>>0?c:e)+4>>2]=27,e=s[2878],s[n+16>>2]=s[2877],s[n+20>>2]=e,e=s[2876],s[n+8>>2]=s[2875],s[n+12>>2]=e,s[2877]=n+8,s[2876]=a,s[2875]=r,s[2878]=0,e=n+24|0;s[e+4>>2]=7,r=e+8|0,e=e+4|0,r>>>0<o>>>0;);if((0|n)==(0|c))break i;if(s[n+4>>2]=-2&s[n+4>>2],o=n-c|0,s[c+4>>2]=1|o,s[n>>2]=o,o>>>0<=255){r=11092+((e=o>>>3|0)<<3)|0,(n=s[2763])&(e=1<<e)?e=s[r+8>>2]:(s[2763]=e|n,e=r),s[r+8>>2]=c,s[e+12>>2]=c,s[c+12>>2]=r,s[c+8>>2]=e;break i}if(e=31,s[c+16>>2]=0,s[c+20>>2]=0,o>>>0<=16777215&&(e=o>>>8|0,e<<=i=e+1048320>>>16&8,e=28+((e=((e<<=n=e+520192>>>16&4)<<(r=e+245760>>>16&2)>>>15|0)-(r|n|i)|0)<<1|o>>>e+21&1)|0),s[c+28>>2]=e,i=11356+(e<<2)|0,(n=s[2764])&(r=1<<e)){for(e=o<<(31==(0|e)?0:25-(e>>>1|0)|0),r=s[i>>2];;){if(n=r,(0|o)==(-8&s[r+4>>2]))break a;if(r=e>>>29|0,e<<=1,!(r=s[(i=n+(4&r)|0)+16>>2]))break}s[i+16>>2]=c,s[c+24>>2]=n}else s[2764]=r|n,s[i>>2]=c,s[c+24>>2]=i;s[c+12>>2]=c,s[c+8>>2]=c;break i}e=s[n+8>>2],s[e+12>>2]=l,s[n+8>>2]=l,s[l+24>>2]=0,s[l+12>>2]=n,s[l+8>>2]=e}e=d+8|0;break e}e=s[n+8>>2],s[e+12>>2]=c,s[n+8>>2]=c,s[c+24>>2]=0,s[c+12>>2]=n,s[c+8>>2]=e}if(!((e=s[2766])>>>0<=u>>>0)){r=e-u|0,s[2766]=r,e=(n=s[2769])+u|0,s[2769]=e,s[e+4>>2]=1|r,s[n+4>>2]=3|u,e=n+8|0;break e}}s[2720]=48,e=0;break e}r:if(a){n=s[o+28>>2];n:{if(s[(e=11356+(n<<2)|0)>>2]==(0|o)){if(s[e>>2]=r,r)break n;l=tr(n)&l,s[2764]=l;break r}if(s[a+(s[a+16>>2]==(0|o)?16:20)>>2]=r,!r)break r}s[r+24>>2]=a,(e=s[o+16>>2])&&(s[r+16>>2]=e,s[e+24>>2]=r),(e=s[o+20>>2])&&(s[r+20>>2]=e,s[e+24>>2]=r)}r:if(i>>>0<=15)e=i+u|0,s[o+4>>2]=3|e,s[(e=e+o|0)+4>>2]=1|s[e+4>>2];else if(s[o+4>>2]=3|u,s[(a=o+u|0)+4>>2]=1|i,s[a+i>>2]=i,i>>>0<=255)r=11092+((e=i>>>3|0)<<3)|0,(n=s[2763])&(e=1<<e)?e=s[r+8>>2]:(s[2763]=e|n,e=r),s[r+8>>2]=a,s[e+12>>2]=a,s[a+12>>2]=r,s[a+8>>2]=e;else{e=31,i>>>0<=16777215&&(e=i>>>8|0,e<<=d=e+1048320>>>16&8,e=28+((e=((e<<=n=e+520192>>>16&4)<<(r=e+245760>>>16&2)>>>15|0)-(r|n|d)|0)<<1|i>>>e+21&1)|0),s[a+28>>2]=e,s[a+16>>2]=0,s[a+20>>2]=0,r=11356+(e<<2)|0;n:{if((n=1<<e)&l){for(e=i<<(31==(0|e)?0:25-(e>>>1|0)|0),n=s[r>>2];;){if((-8&s[(r=n)+4>>2])==(0|i))break n;if(n=e>>>29|0,e<<=1,!(n=s[(d=(4&n)+r|0)+16>>2]))break}s[d+16>>2]=a}else s[2764]=n|l,s[r>>2]=a;s[a+24>>2]=r,s[a+12>>2]=a,s[a+8>>2]=a;break r}e=s[r+8>>2],s[e+12>>2]=a,s[r+8>>2]=a,s[a+24>>2]=0,s[a+12>>2]=r,s[a+8>>2]=e}e=o+8|0;break e}t:if(l){n=s[r+28>>2];r:{if(s[(e=11356+(n<<2)|0)>>2]==(0|r)){if(s[e>>2]=o,o)break r;g=11056,y=tr(n)&c,s[g>>2]=y;break t}if(s[l+(s[l+16>>2]==(0|r)?16:20)>>2]=o,!o)break t}s[o+24>>2]=l,(e=s[r+16>>2])&&(s[o+16>>2]=e,s[e+24>>2]=o),(e=s[r+20>>2])&&(s[o+20>>2]=e,s[e+24>>2]=o)}i>>>0<=15?(e=i+u|0,s[r+4>>2]=3|e,s[(e=e+r|0)+4>>2]=1|s[e+4>>2]):(s[r+4>>2]=3|u,s[(o=r+u|0)+4>>2]=1|i,s[i+o>>2]=i,f&&(n=11092+((e=f>>>3|0)<<3)|0,d=s[2768],(e=1<<e)&a?e=s[n+8>>2]:(s[2763]=e|a,e=n),s[n+8>>2]=d,s[e+12>>2]=d,s[d+12>>2]=n,s[d+8>>2]=e),s[2768]=o,s[2765]=i),e=r+8|0}return N=t+16|0,0|e}function F(e,t,r){var n,i,a,u=0,c=0,l=0,d=0,h=0,f=0,p=0,g=0,v=0,_=0,b=0,A=0;e:{t:{r:{n:{if((0|(u=Sn(t)))<=109){if(34==(0|u))break n;if(91==(0|u))break t;if(102!=(0|u))break e;i:{a:{if(102==(0|Sn(t))){if(pr(t),!(ir(t,97)&&ir(t,108)&&ir(t,115)&&ir(t,101)&&pt(r,0))){if(r=3,Tn(e))break a;_n(e,r,Mr(t)),Tn(e)}break i}C(2582,1472,883,1933),T()}C(2472,1472,891,1933),T()}return}if(123==(0|u))break r;if(116!=(0|u)){if(110!=(0|u))break e;i:{a:{if(110==(0|Sn(t))){if(pr(t),ir(t,117)&&ir(t,108)&&ir(t,108))Lt(_e(r+32|0));else{if(Tn(e))break a;_n(e,3,Mr(t)),Tn(e)}break i}C(2565,1472,857,1367),T()}C(2472,1472,865,1367),T()}return}i:{a:{if(116==(0|Sn(t))){if(pr(t),!(ir(t,114)&&ir(t,117)&&ir(t,101)&&pt(r,1))){if(r=3,Tn(e))break a;_n(e,r,Mr(t)),Tn(e)}break i}C(2548,1472,870,1815),T()}C(2472,1472,878,1815),T()}return}return void Y(e,t,r,0)}r:{n:{if(123==(0|Sn(t))){if(pr(t),We(_e(r+32|0),3),it(t),Tn(e))break r;if(ir(t,125))break n;for(;;){i:{a:{o:{s:{if(34!=(0|Sn(t))){if(Tn(e))break s;if(_n(e,4,Mr(t)),Tn(e))break r}if(Y(e,t,r,1),Tn(e))break r;if(it(t),Tn(e))break r;if(!ir(t,58)){if(Tn(e))break o;if(_n(e,5,Mr(t)),Tn(e))break r}if(it(t),Tn(e))break r;if(F(e,t,r),Tn(e))break r;if(it(t),Tn(e))break r;if(l=l+1|0,44==(0|(d=Sn(t))))break a;if(125==(0|d)&&(pr(t),Pe(r,l)))break r;if(Tn(e))break i;if(_n(e,6,Mr(t)),!Tn(e))continue;break r}C(2472,1472,758,1128),T()}C(2472,1472,767,1128),T()}if(pr(t),it(t),!Tn(e))continue;break r}break}C(2472,1472,792,1128),T()}C(2531,1472,741,1128),T()}Pe(r,0)}return}t:{r:{n:{if(91==(0|Sn(t))){if(pr(t),We(_e(r+32|0),4),it(t),Tn(e))break t;if(ir(t,93))break r;if(F(e,t,r),Tn(e))break t;for(;;){if(it(t),Tn(e))break t;l=l+1|0;i:{if(ir(t,44)){if(it(t),!Tn(e))break i;break t}if(ir(t,93)&&Je(r,l))break t;if(Tn(e))break n;if(_n(e,7,Mr(t)),Tn(e))break t}if(F(e,t,r),Tn(e))break}break t}C(2599,1472,809,1024),T()}C(2472,1472,842,1024),T()}Je(r,0)}return}N=n=N-32|0,u=n+8|0,i=Pt(n+16|0,t),s[u>>2]=i,a=mn(u),t=nr(u,45);e:{t:{r:{n:{i:{a:{o:{s:if(48!=(0|yn(u)))u:{c:{if(!((0|yn(u))<49||(0|yn(u))>57)){h=gn(u)-48|0,f=yn(u);l:{if(!t){if((0|f)>47)break l;break u}if((0|f)<48)break u;for(;;){if((0|yn(u))>57)break s;if(!(h>>>0<214748364)){if(214748364!=(0|h))break c;if(!((0|yn(u))<=56)){h=214748364;break c}}if(l=l+1|0,h=(gn(u)+m(h,10)|0)-48|0,!((0|yn(u))>47))break}break s}for(;;){if((0|yn(u))>57)break s;if(!(h>>>0<429496729)){if(429496729!=(0|h))break c;if(!((0|yn(u))<=53)){h=429496729;break c}}if(l=l+1|0,h=(gn(u)+m(h,10)|0)-48|0,!((0|yn(u))>47))break}break s}if(!Tn(e)){if(_n(e,3,mn(u)),Tn(e))break o;break s}C(2472,1472,1538,1166),T()}d=h,f=yn(u);c:{l:{if(!t){if(_=1,(0|f)<=47)break s;for(;;){if((0|yn(u))>57)break s;if(!(429496729==(0|c)&d>>>0<2576980377|c>>>0<429496729)){if(-1717986919!=(0|d)|429496729!=(0|c))break l;if(!((0|yn(u))<=53)){d=-1717986919,c=429496729;break l}}if(d=Ne(d,c,10,0),b=(c=G)+1|0,f=c,c=(d=d+(c=gn(u)-48|0)|0)>>>0<c>>>0?b:f,l=l+1|0,!((0|yn(u))>47))break}break c}if(_=1,(0|f)<48)break s;for(;;){if((0|yn(u))>57)break s;if(!(214748364==(0|c)&d>>>0<3435973836|c>>>0<214748364)){if(-858993460!=(0|d)|214748364!=(0|c))break l;if(!((0|yn(u))<=56)){d=-858993460,c=214748364;break l}}if(d=Ne(d,c,10,0),b=(c=G)+1|0,f=c,c=(d=d+(c=gn(u)-48|0)|0)>>>0<c>>>0?b:f,l=l+1|0,!((0|yn(u))>47))break}break c}if(p=+(d>>>0)+4294967296*+(c>>>0),g=1,!((0|yn(u))<48))for(;;){if((0|yn(u))>57)break c;if(p=10*p+ +(gn(u)-48|0),!((0|yn(u))>47))break}}}else gn(u);s:if(nr(u,46)){if(!((0|yn(u))>=48&&(0|yn(u))<58)){if(Tn(e))break a;if(_n(e,14,mn(u)),Tn(e))break o}if(!g){d=_?d:h,c=_?c:0;u:if(!((0|yn(u))<48))for(;;){if((0|yn(u))>57|c>>>0>2097151)break u;if(d=Ne(d,c,10,0),f=l,g=(l=G)+1|0,c=l,l=f+(0!=((c=(d=d+(l=gn(u)-48|0)|0)>>>0<l>>>0?g:c)|d))|0,v=v-1|0,!((0|yn(u))>47))break}p=+(d>>>0)+4294967296*+(c>>>0)}if((0|yn(u))<48)g=1;else for(g=1;;){if((0|yn(u))>57)break s;if(f=gn(u),(0|l)>16||(v=v-1|0,(p=10*p+ +(f-48|0))>0&&(l=l+1|0)),!((0|yn(u))>47))break}}if(nr(u,101)||(l=0,nr(u,69))){nr(u,43)||(A=nr(u,45));s:if((0|yn(u))<48||(0|yn(u))>57){if(Tn(e))break r;if(_n(e,15,mn(u)),l=0,Tn(e))break o}else{if(l=gn(u)-48|0,A){if((0|v)>0)break i;if((0|yn(u))<48)break s;for(f=(v+2147483639|0)/10|0;;){if((0|yn(u))>57)break s;u:if(!((0|f)>=(0|(l=(gn(u)+m(l,10)|0)-48|0))||(0|yn(u))<48))for(;;){if((0|yn(u))>57)break u;if(gn(u),!((0|yn(u))>47))break}if(!((0|yn(u))>47))break}break s}if((0|yn(u))<48)break s;for(f=308-v|0;;){if((0|yn(u))>57)break s;if((0|f)<(0|(l=(gn(u)+m(l,10)|0)-48|0))){if(Tn(e))break n;if(_n(e,13,a),Tn(e))break o}if(!((0|yn(u))>47))break}}p=g?p:+((_?d:h)>>>0)+4294967296*+((_?c:0)>>>0),g=1,l=A?0-l|0:l}if(u=l,g){if((p=(0|(d=u+v|0))<=-309?Rt(Rt(p,-308),d+308|0):Rt(p,d))>17976931348623157e292){if(Tn(e))break t;if(_n(e,13,a),Tn(e))break o}e=_e(r+32|0),s[e+16>>2]=0,s[e+20>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0,y[e>>3]=t?-p:p,o[e+18>>1]=534}else if(_){if(t){e=_e(r+32|0),s[e+16>>2]=0,s[e+20>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0,h=0-d|0,s[e>>2]=h,t=0-((0!=(0|d))+c|0)|0,s[e+4>>2]=t,o[e+18>>1]=150;s:{if((0|t)>0|(0|t)>=0){if(r=t?406:470,o[e+18>>1]=r,!t&h>>>0>2147483647|t)break s;r|=32}else if(r=182,-1==(0|t)&h>>>0<2147483648|-1!=(0|t))break s;o[e+18>>1]=r}break o}e=_e(r+32|0),s[e+16>>2]=0,s[e+20>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0,s[e>>2]=d,s[e+4>>2]=c,t=(0|c)>0|(0|c)>=0?406:278,o[e+18>>1]=t,c||(o[e+18>>1]=64|t,!c&d>>>0>2147483647|c||(o[e+18>>1]=96|t))}else t?(e=_e(r+32|0),s[e+16>>2]=0,s[e+20>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0,t=0-h|0,s[e>>2]=t,s[e+4>>2]=t>>31,o[e+18>>1]=(0|t)>=0?502:182):(e=_e(r+32|0),s[e+16>>2]=0,s[e+20>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0,s[e>>2]=h,s[e+4>>2]=0,o[e+18>>1]=(0|h)>=0?502:470)}jt(i),N=n+32|0;break e}C(2472,1472,1581,1166),T()}C(2219,1472,1645,1166),T()}C(2472,1472,1661,1166),T()}C(2472,1472,1666,1166),T()}C(2472,1472,1713,1166),T()}}function j(e,t,r,n,i){var u,c,l,d=0,f=0,p=0,g=0,v=0,_=0,b=0,A=0,E=0,S=0,T=0,w=0,C=0,k=0,I=0,$=0;N=u=N-80|0,s[u+76>>2]=t,l=u+55|0,c=u+56|0,t=0;e:{t:{r:{n:{i:for(;;){if((2147483647-b|0)<(0|t))break n;b=t+b|0;a:{o:{s:{if(_=s[u+76>>2],d=h[0|(t=_)])for(;;){u:{c:if(d&=255){if(37!=(0|d))break u;for(d=t;;){if(37!=h[t+1|0])break c;if(f=t+2|0,s[u+76>>2]=f,d=d+1|0,p=h[t+2|0],t=f,37!=(0|p))break}}else d=t;if((0|(t=d-_|0))>(0|(k=2147483647-b|0)))break n;if(e&&fe(e,_,t),(0|d)!=(0|_))continue i;S=-1,d=1,f=!vn(a[s[u+76>>2]+1|0]),t=s[u+76>>2],f|36!=h[t+2|0]||(S=a[t+1|0]-48|0,C=1,d=3),t=d+t|0,s[u+76>>2]=t,A=0;c:if((f=(g=a[0|t])-32|0)>>>0>31)d=t;else if(d=t,75913&(p=1<<f))for(;;){if(d=t+1|0,s[u+76>>2]=d,A|=p,(f=(g=a[t+1|0])-32|0)>>>0>=32)break c;if(t=d,!(75913&(p=1<<f)))break}c:if(42!=(0|g)){if((0|(E=Me(u+76|0)))<0)break n;t=s[u+76>>2]}else{if(vn(a[d+1|0])&&(t=s[u+76>>2],36==h[t+2|0]))s[((a[t+1|0]<<2)+i|0)-192>>2]=10,E=s[((a[t+1|0]<<3)+n|0)-384>>2],C=1,t=t+3|0;else{if(C)break s;C=0,E=0,e&&(t=s[r>>2],s[r>>2]=t+4,E=s[t>>2]),t=s[u+76>>2]+1|0}if(s[u+76>>2]=t,(0|E)>=0)break c;E=0-E|0,A|=8192}if(d=0,p=-1,T=0,46==h[0|t])if(42!=h[t+1|0])s[u+76>>2]=t+1,p=Me(u+76|0),t=s[u+76>>2],T=1;else{if(vn(a[t+2|0])&&(t=s[u+76>>2],36==h[t+3|0]))s[((a[t+2|0]<<2)+i|0)-192>>2]=10,p=s[((a[t+2|0]<<3)+n|0)-384>>2],t=t+4|0;else{if(C)break s;e?(t=s[r>>2],s[r>>2]=t+4,p=s[t>>2]):p=0,t=s[u+76>>2]+2|0}s[u+76>>2]=t,T=(-1^p)>>>31|0}for(;;){if(w=d,v=28,a[0|t]-123>>>0<4294967238)break r;if(g=t+1|0,s[u+76>>2]=g,d=a[0|t],t=g,!((d=h[7711+(d+m(w,58)|0)|0])-1>>>0<8))break}c:{l:{if(27!=(0|d)){if(!d)break r;if((0|S)>=0){s[(S<<2)+i>>2]=d,d=s[(t=(S<<3)+n|0)+4>>2],s[u+64>>2]=s[t>>2],s[u+68>>2]=d;break l}if(!e)break a;ee(u- -64|0,d,r),g=s[u+76>>2];break c}if((0|S)>=0)break r}if(t=0,!e)continue i}f=-65537&A,d=8192&A?f:A,A=0,S=1035,v=c;c:{l:{d:{h:{f:{p:{g:{y:{m:{v:{_:{b:{A:{E:{S:{T:switch(t=a[g-1|0],(t=w&&3==(15&t)?-33&t:t)-88|0){case 11:break c;case 9:case 13:case 14:case 15:break l;case 27:break g;case 12:case 17:break v;case 23:break _;case 0:case 32:break b;case 24:break A;case 22:break E;case 29:break S;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 10:case 16:case 18:case 19:case 20:case 21:case 25:case 26:case 28:case 30:case 31:break o;default:break T}T:switch(t-65|0){case 0:case 4:case 5:case 6:break l;case 2:break f;case 1:case 3:break o;default:break T}if(83==(0|t))break p;break o}g=s[u+64>>2],f=s[u+68>>2],S=1035;break m}t=0;E:switch(255&w){case 0:case 1:case 6:s[s[u+64>>2]>>2]=b;continue i;case 2:d=s[u+64>>2],s[d>>2]=b,s[d+4>>2]=b>>31;continue i;case 3:o[s[u+64>>2]>>1]=b;continue i;case 4:a[s[u+64>>2]]=b;continue i;case 7:break E;default:continue i}d=s[u+64>>2],s[d>>2]=b,s[d+4>>2]=b>>31;continue i}p=p>>>0>8?p:8,d|=8,t=120}if(_=c,I=32&t,(g=s[u+64>>2])|(f=s[u+68>>2]))for(;a[0|(_=_-1|0)]=I|h[8240+(15&g)|0],$=!f&g>>>0>15|0!=(0|f),w=f,f=f>>>4|0,g=(15&w)<<28|g>>>4,$;);if(!(8&d)|!(s[u+64>>2]|s[u+68>>2]))break y;S=1035+(t>>>4|0)|0,A=2;break y}if(t=c,(g=s[u+64>>2])|(f=s[u+68>>2]))for(;a[0|(t=t-1|0)]=7&g|48,w=!f&g>>>0>7|0!=(0|f),_=f,f=f>>>3|0,g=(7&_)<<29|g>>>3,w;);if(_=t,!(8&d))break y;p=(0|(t=c-_|0))<(0|p)?p:t+1|0;break y}f=t=s[u+68>>2],g=s[u+64>>2],(0|t)<0?(f=0-(f+(0!=(0|g))|0)|0,g=0-g|0,s[u+64>>2]=g,s[u+68>>2]=f,A=1,S=1035):2048&d?(A=1,S=1036):S=(A=1&d)?1037:1035}_=Ie(g,f,c)}if((0|p)<0&&T)break n;if(d=T?-65537&d:d,!(0!=((f=s[u+64>>2])|(t=s[u+68>>2]))|p)){_=c,p=0;break o}p=(0|(t=!(t|f)+(c-_|0)|0))<(0|p)?p:t;break o}g=0!=(0|(v=T=p>>>0<2147483647?p:2147483647));g:{y:{m:{v:if(!(!(3&(t=d=_=(t=s[u+64>>2])||2278))|!v))for(;;){if(!h[0|t])break m;if(g=0!=(0|(v=v-1|0)),!(3&(t=t+1|0)))break v;if(!v)break}if(!g)break y}m:if(!(!h[0|t]|v>>>0<4))for(;;){if((-1^(g=s[t>>2]))&g-16843009&-2139062144)break m;if(t=t+4|0,!((v=v-4|0)>>>0>3))break}if(v)for(;;){if(!h[0|t])break g;if(t=t+1|0,!(v=v-1|0))break}}t=0}if(v=(t=t?t-d|0:T)+_|0,(0|p)>=0){d=f,p=t;break o}if(d=f,p=t,h[0|v])break n;break o}if(p){v=s[u+64>>2];break h}t=0,Fe(e,32,E,0,d);break d}s[u+12>>2]=0,s[u+8>>2]=s[u+64>>2],v=u+8|0,s[u+64>>2]=v,p=-1}t=0;h:{for(;;){if(!(f=s[v>>2]))break h;if(!((_=(0|(f=ce(u+4|0,f)))<0)|f>>>0>p-t>>>0)){if(v=v+4|0,p>>>0>(t=t+f|0)>>>0)continue;break h}break}if(_)break t}if(v=61,(0|t)<0)break r;if(Fe(e,32,E,t,d),t)for(p=0,v=s[u+64>>2];;){if(!(f=s[v>>2]))break d;if((p=(f=ce(u+4|0,f))+p|0)>>>0>t>>>0)break d;if(fe(e,u+4|0,f),v=v+4|0,!(t>>>0>p>>>0))break}else t=0}Fe(e,32,E,t,8192^d),t=(0|t)<(0|E)?E:t;continue i}if((0|p)<0&&T)break n;if(v=61,(0|(t=0|oi[7](e,y[u+64>>3],E,p,d,t)))>=0)continue i;break r}a[u+55|0]=s[u+64>>2],p=1,_=l,d=f;break o}f=t+1|0,s[u+76>>2]=f,d=h[t+1|0],t=f}if(e)break e;if(!C)break a;for(t=1;;){if(e=s[(t<<2)+i>>2]){if(ee((t<<3)+n|0,e,r),b=1,10!=(0|(t=t+1|0)))continue;break e}break}if(b=1,t>>>0>=10)break e;for(;;){if(s[(t<<2)+i>>2])break s;if(10==(0|(t=t+1|0)))break}break e}v=28;break r}if((0|(p=(0|p)>(0|(g=v-_|0))?p:g))>(2147483647-A|0))break n;if(v=61,(0|k)<(0|(t=(0|(f=p+A|0))<(0|E)?E:f)))break r;Fe(e,32,t,f,d),fe(e,S,A),Fe(e,48,t,f,65536^d),Fe(e,48,p,g,0),fe(e,_,g),Fe(e,32,t,f,8192^d);continue}break}b=0;break e}v=61}s[2720]=v}b=-1}return N=u+80|0,b}function H(e){var t=0,r=0,n=0,i=0,a=0,o=0,u=0,c=0,l=0;e:if(e|=0){a=(n=e-8|0)+(e=-8&(t=s[e-4>>2]))|0;t:if(!(1&t)){if(!(3&t))break e;if((n=n-(t=s[n>>2])|0)>>>0<p[2767])break e;if(e=e+t|0,s[2768]==(0|n)){if(3==(3&(t=s[a+4>>2])))return s[2765]=e,s[a+4>>2]=-2&t,s[n+4>>2]=1|e,void(s[e+n>>2]=e)}else{if(t>>>0<=255){if(i=s[n+8>>2],t=t>>>3|0,(0|(r=s[n+12>>2]))==(0|i)){c=11052,l=s[2763]&tr(t),s[c>>2]=l;break t}s[i+12>>2]=r,s[r+8>>2]=i;break t}if(u=s[n+24>>2],(0|n)==(0|(t=s[n+12>>2])))if((r=s[(i=n+20|0)>>2])||(r=s[(i=n+16|0)>>2])){for(;o=i,(r=s[(i=(t=r)+20|0)>>2])||(i=t+16|0,r=s[t+16>>2]););s[o>>2]=0}else t=0;else r=s[n+8>>2],s[r+12>>2]=t,s[t+8>>2]=r;if(!u)break t;i=s[n+28>>2];r:{if(s[(r=11356+(i<<2)|0)>>2]==(0|n)){if(s[r>>2]=t,t)break r;c=11056,l=s[2764]&tr(i),s[c>>2]=l;break t}if(s[u+(s[u+16>>2]==(0|n)?16:20)>>2]=t,!t)break t}if(s[t+24>>2]=u,(r=s[n+16>>2])&&(s[t+16>>2]=r,s[r+24>>2]=t),!(r=s[n+20>>2]))break t;s[t+20>>2]=r,s[r+24>>2]=t}}if(!(n>>>0>=a>>>0)&&1&(t=s[a+4>>2])){t:{if(!(2&t)){if(s[2769]==(0|a)){if(s[2769]=n,e=s[2766]+e|0,s[2766]=e,s[n+4>>2]=1|e,s[2768]!=(0|n))break e;return s[2765]=0,void(s[2768]=0)}if(s[2768]==(0|a))return s[2768]=n,e=s[2765]+e|0,s[2765]=e,s[n+4>>2]=1|e,void(s[e+n>>2]=e);e=(-8&t)+e|0;r:if(t>>>0<=255){if(i=s[a+8>>2],t=t>>>3|0,(0|(r=s[a+12>>2]))==(0|i)){c=11052,l=s[2763]&tr(t),s[c>>2]=l;break r}s[i+12>>2]=r,s[r+8>>2]=i}else{if(u=s[a+24>>2],(0|a)==(0|(t=s[a+12>>2])))if((r=s[(i=a+20|0)>>2])||(r=s[(i=a+16|0)>>2])){for(;o=i,(r=s[(i=(t=r)+20|0)>>2])||(i=t+16|0,r=s[t+16>>2]););s[o>>2]=0}else t=0;else r=s[a+8>>2],s[r+12>>2]=t,s[t+8>>2]=r;if(u){i=s[a+28>>2];n:{if(s[(r=11356+(i<<2)|0)>>2]==(0|a)){if(s[r>>2]=t,t)break n;c=11056,l=s[2764]&tr(i),s[c>>2]=l;break r}if(s[u+(s[u+16>>2]==(0|a)?16:20)>>2]=t,!t)break r}s[t+24>>2]=u,(r=s[a+16>>2])&&(s[t+16>>2]=r,s[r+24>>2]=t),(r=s[a+20>>2])&&(s[t+20>>2]=r,s[r+24>>2]=t)}}if(s[n+4>>2]=1|e,s[e+n>>2]=e,s[2768]!=(0|n))break t;return void(s[2765]=e)}s[a+4>>2]=-2&t,s[n+4>>2]=1|e,s[e+n>>2]=e}if(e>>>0<=255)return t=11092+((e=e>>>3|0)<<3)|0,(r=s[2763])&(e=1<<e)?e=s[t+8>>2]:(s[2763]=e|r,e=t),s[t+8>>2]=n,s[e+12>>2]=n,s[n+12>>2]=t,void(s[n+8>>2]=e);i=31,s[n+16>>2]=0,s[n+20>>2]=0,e>>>0<=16777215&&(t=e>>>8|0,t<<=o=t+1048320>>>16&8,i=28+((t=((t<<=i=t+520192>>>16&4)<<(r=t+245760>>>16&2)>>>15|0)-(r|i|o)|0)<<1|e>>>t+21&1)|0),s[n+28>>2]=i,o=11356+(i<<2)|0;t:{r:{if((r=s[2764])&(t=1<<i)){for(i=e<<(31==(0|i)?0:25-(i>>>1|0)|0),t=s[o>>2];;){if(r=t,(-8&s[t+4>>2])==(0|e))break r;if(t=i>>>29|0,i<<=1,!(t=s[(o=r+(4&t)|0)+16>>2]))break}s[o+16>>2]=n,s[n+24>>2]=r}else s[2764]=t|r,s[o>>2]=n,s[n+24>>2]=o;s[n+12>>2]=n,s[n+8>>2]=n;break t}e=s[r+8>>2],s[e+12>>2]=n,s[r+8>>2]=n,s[n+24>>2]=0,s[n+12>>2]=r,s[n+8>>2]=e}e=s[2771]-1|0,s[2771]=e||-1}}}function Z(e,t){var r,n=0,i=0,a=0,o=0,u=0,c=0,l=0;r=e+t|0;e:{t:if(!(1&(n=s[e+4>>2]))){if(!(3&n))break e;t=(n=s[e>>2])+t|0;r:{if((0|(e=e-n|0))!=s[2768]){if(n>>>0<=255){if(a=s[e+8>>2],n=n>>>3|0,(0|(i=s[e+12>>2]))!=(0|a))break r;c=11052,l=s[2763]&tr(n),s[c>>2]=l;break t}if(u=s[e+24>>2],(0|(n=s[e+12>>2]))==(0|e))if((i=s[(a=e+20|0)>>2])||(i=s[(a=e+16|0)>>2])){for(;o=a,(i=s[(a=(n=i)+20|0)>>2])||(a=n+16|0,i=s[n+16>>2]););s[o>>2]=0}else n=0;else i=s[e+8>>2],s[i+12>>2]=n,s[n+8>>2]=i;if(!u)break t;a=s[e+28>>2];n:{if(s[(i=11356+(a<<2)|0)>>2]==(0|e)){if(s[i>>2]=n,n)break n;c=11056,l=s[2764]&tr(a),s[c>>2]=l;break t}if(s[u+(s[u+16>>2]==(0|e)?16:20)>>2]=n,!n)break t}if(s[n+24>>2]=u,(i=s[e+16>>2])&&(s[n+16>>2]=i,s[i+24>>2]=n),!(i=s[e+20>>2]))break t;s[n+20>>2]=i,s[i+24>>2]=n;break t}if(3!=(3&(n=s[r+4>>2])))break t;return s[2765]=t,s[r+4>>2]=-2&n,s[e+4>>2]=1|t,void(s[r>>2]=t)}s[a+12>>2]=i,s[i+8>>2]=a}t:{if(!(2&(n=s[r+4>>2]))){if(s[2769]==(0|r)){if(s[2769]=e,t=s[2766]+t|0,s[2766]=t,s[e+4>>2]=1|t,s[2768]!=(0|e))break e;return s[2765]=0,void(s[2768]=0)}if(s[2768]==(0|r))return s[2768]=e,t=s[2765]+t|0,s[2765]=t,s[e+4>>2]=1|t,void(s[e+t>>2]=t);t=(-8&n)+t|0;r:if(n>>>0<=255){if(a=s[r+8>>2],n=n>>>3|0,(0|(i=s[r+12>>2]))==(0|a)){c=11052,l=s[2763]&tr(n),s[c>>2]=l;break r}s[a+12>>2]=i,s[i+8>>2]=a}else{if(u=s[r+24>>2],(0|r)==(0|(n=s[r+12>>2])))if((a=s[(i=r+20|0)>>2])||(a=s[(i=r+16|0)>>2])){for(;o=i,(a=s[(i=(n=a)+20|0)>>2])||(i=n+16|0,a=s[n+16>>2]););s[o>>2]=0}else n=0;else i=s[r+8>>2],s[i+12>>2]=n,s[n+8>>2]=i;if(u){a=s[r+28>>2];n:{if(s[(i=11356+(a<<2)|0)>>2]==(0|r)){if(s[i>>2]=n,n)break n;c=11056,l=s[2764]&tr(a),s[c>>2]=l;break r}if(s[u+(s[u+16>>2]==(0|r)?16:20)>>2]=n,!n)break r}s[n+24>>2]=u,(i=s[r+16>>2])&&(s[n+16>>2]=i,s[i+24>>2]=n),(i=s[r+20>>2])&&(s[n+20>>2]=i,s[i+24>>2]=n)}}if(s[e+4>>2]=1|t,s[e+t>>2]=t,s[2768]!=(0|e))break t;return void(s[2765]=t)}s[r+4>>2]=-2&n,s[e+4>>2]=1|t,s[e+t>>2]=t}if(t>>>0<=255)return n=11092+((t=t>>>3|0)<<3)|0,(i=s[2763])&(t=1<<t)?t=s[n+8>>2]:(s[2763]=t|i,t=n),s[n+8>>2]=e,s[t+12>>2]=e,s[e+12>>2]=n,void(s[e+8>>2]=t);a=31,s[e+16>>2]=0,s[e+20>>2]=0,t>>>0<=16777215&&(n=t>>>8|0,n<<=o=n+1048320>>>16&8,a=28+((n=((n<<=a=n+520192>>>16&4)<<(i=n+245760>>>16&2)>>>15|0)-(i|a|o)|0)<<1|t>>>n+21&1)|0),s[e+28>>2]=a,o=11356+(a<<2)|0;t:{if((i=s[2764])&(n=1<<a)){for(a=t<<(31==(0|a)?0:25-(a>>>1|0)|0),n=s[o>>2];;){if(i=n,(-8&s[n+4>>2])==(0|t))break t;if(n=a>>>29|0,a<<=1,!(n=s[(o=i+(4&n)|0)+16>>2]))break}s[o+16>>2]=e,s[e+24>>2]=i}else s[2764]=n|i,s[o>>2]=e,s[e+24>>2]=o;return s[e+12>>2]=e,void(s[e+8>>2]=e)}t=s[i+8>>2],s[t+12>>2]=e,s[i+8>>2]=e,s[e+24>>2]=0,s[e+12>>2]=i,s[e+8>>2]=t}}function W(){var e=0,t=0,r=0,n=0,i=0;return 1&a[9832]||(s[2280]=0,s[2281]=0,s[2286]=0,s[2287]=0,s[2284]=-1,s[2285]=-1,s[2292]=-1,s[2293]=-1,s[2296]=0,s[2297]=0,s[2303]=0,s[2304]=0,s[2302]=1061158912,s[2300]=1045220557,s[2301]=1053609165,s[2315]=-1,s[2316]=-1,s[2282]=0,s[2283]=0,s[2288]=0,s[2289]=0,s[2290]=0,s[2291]=0,s[2294]=-1,s[2295]=-1,s[2298]=0,s[2299]=0,s[2305]=0,s[2306]=0,s[2307]=0,s[2308]=0,s[2317]=-1,s[2318]=-1,s[2321]=0,s[2322]=0,s[2319]=0,s[2320]=0,s[2328]=0,s[2329]=-1082130432,s[2330]=-1082130432,s[2331]=-1082130432,s[2332]=1065353216,s[2333]=1091567616,s[2334]=1073741824,s[2325]=1065353216,s[2323]=16842753,a[9296]=0,ne(9344,0,48),s[2358]=0,s[2359]=1076887552,s[2356]=0,s[2357]=1078067200,s[2354]=0,s[2355]=1077542912,It(9528),It(9540),It(9552),e=hn(9568),nt(9640),nt(9652),It(9672),It(9684),It(9696),It(9716),t=It(9728),r=It(9740),n=It(9752),i=It(9764),It(9776),It(9800),s[2380]=0,s[2381]=0,s[2378]=0,s[2379]=0,s[2376]=0,s[2377]=0,$n(9528),$n(9540),In(9552),s[e>>2]=0,s[2396]=0,s[2397]=0,s[2394]=0,s[2395]=0,$n(9592),s[2404]=0,s[2405]=0,s[2402]=0,In(t),In(n),In(i),In(r),s[2447]=-1,s[2448]=0,s[2449]=0,Qr(9800),s[2457]=0,s[2453]=-1,s[2454]=-1,s[2455]=-1,s[2456]=2,s[2280]=0,s[2281]=0,s[2308]=0,s[2286]=0,s[2287]=0,s[2282]=0,s[2283]=0,s[2288]=0,s[2289]=0,ne(9344,0,48),s[2305]=0,s[2306]=0,s[2298]=0,s[2299]=0,o[4646]=1,s[2290]=0,s[2291]=0,s[2292]=0,s[2293]=0,s[2376]=0,s[2377]=0,s[2378]=0,s[2379]=0,s[2380]=0,s[2381]=0,$n(9528),$n(9540),In(9552),In(9728),In(9764),s[2417]=5,$n(9696),s[2416]=0,$n(9672),$n(9684),s[2428]=5,$n(9716),s[2427]=0,Ct(9640),wt(9652),s[2352]=0,s[2353]=1076887552,s[2350]=0,s[2351]=1077805056,s[2348]=0,s[2349]=1077149696,s[2326]=1084227584,s[2327]=1084227584,s[2300]=1045220557,s[2301]=1053609165,s[2313]=4,s[2314]=2,s[2311]=12,s[2312]=5,s[2374]=0,s[2375]=1075314688,s[2372]=0,s[2373]=1077936128,s[2370]=-687194767,s[2371]=-1077055325,s[2368]=1717986918,s[2369]=1072064102,s[2366]=0,s[2367]=1071644672,s[2364]=0,s[2365]=1072168960,s[2362]=0,s[2363]=1073217536,s[2360]=-858993459,s[2361]=1072483532,s[2328]=1086324736,s[2309]=10,s[2310]=10,s[2302]=1061158912,s[2303]=0,s[2296]=0,s[2297]=0,a[9832]=1),9120}function K(e,t){var r,n,i=0,a=0,o=0,u=0,c=0,l=0,d=0,h=0,f=0,p=0,g=0,y=0,m=0;if(n=Pr(e),r=s[e+8>>2],kr(e),t){if(r)if(t>>>0>=4294967232)s[2720]=48,a=0;else{c=t>>>0<11?16:t+11&-8,o=-8&(h=s[(u=r-8|0)+4>>2]);e:if(3&h){l=o+u|0;t:if(o>>>0>=c>>>0){if((a=o-c|0)>>>0<16)break t;s[u+4>>2]=1&h|c|2,s[(i=u+c|0)+4>>2]=3|a,s[l+4>>2]=1|s[l+4>>2],Z(i,a)}else if(s[2769]!=(0|l))if(s[2768]!=(0|l)){if(2&(a=s[l+4>>2]))break e;if((f=o+(-8&a)|0)>>>0<c>>>0)break e;g=f-c|0;r:if(a>>>0<=255){if(d=s[l+8>>2],i=a>>>3|0,(0|(a=s[l+12>>2]))==(0|d)){y=11052,m=s[2763]&tr(i),s[y>>2]=m;break r}s[d+12>>2]=a,s[a+8>>2]=d}else{if(p=s[l+24>>2],(0|l)==(0|(o=s[l+12>>2])))if((i=s[(d=l+20|0)>>2])||(i=s[(d=l+16|0)>>2])){for(;a=d,o=i,(i=s[(d=i+20|0)>>2])||(d=o+16|0,i=s[o+16>>2]););s[a>>2]=0}else o=0;else i=s[l+8>>2],s[i+12>>2]=o,s[o+8>>2]=i;if(p){a=s[l+28>>2];n:{if(s[(i=11356+(a<<2)|0)>>2]==(0|l)){if(s[i>>2]=o,o)break n;y=11056,m=s[2764]&tr(a),s[y>>2]=m;break r}if(s[(s[p+16>>2]==(0|l)?16:20)+p>>2]=o,!o)break r}s[o+24>>2]=p,(i=s[l+16>>2])&&(s[o+16>>2]=i,s[i+24>>2]=o),(i=s[l+20>>2])&&(s[o+20>>2]=i,s[i+24>>2]=o)}}g>>>0<=15?(s[u+4>>2]=1&h|f|2,s[(i=u+f|0)+4>>2]=1|s[i+4>>2]):(s[u+4>>2]=1&h|c|2,s[(a=u+c|0)+4>>2]=3|g,s[(i=u+f|0)+4>>2]=1|s[i+4>>2],Z(a,g))}else{if((a=o+s[2765]|0)>>>0<c>>>0)break e;(i=a-c|0)>>>0>=16?(s[u+4>>2]=1&h|c|2,s[(d=u+c|0)+4>>2]=1|i,s[(a=a+u|0)>>2]=i,s[a+4>>2]=-2&s[a+4>>2]):(s[u+4>>2]=a|1&h|2,s[(i=a+u|0)+4>>2]=1|s[i+4>>2],i=0),s[2768]=d,s[2765]=i}else{if((d=o+s[2766]|0)>>>0<=c>>>0)break e;s[u+4>>2]=1&h|c|2,i=d-c|0,s[(a=u+c|0)+4>>2]=1|i,s[2766]=i,s[2769]=a}i=u}else{if(c>>>0<256)break e;if(o>>>0>=c+4>>>0&&(i=u,o-c>>>0<=s[2883]<<1>>>0))break e;i=0}a=i+8|0,i||(a=0,(u=V(t))&&(J(u,r,t>>>0>(i=(3&(i=s[r-4>>2])?-4:-8)+(-8&i)|0)>>>0?i:t),H(r),a=u))}else a=V(t);i=a}else H(r),i=0;s[e+8>>2]=i,s[e+16>>2]=t+i,s[e+12>>2]=i+n}function X(e,t,r){var n=0,i=0,a=0,o=0,u=0,c=0;e:for(;;){o=t-4|0;t:for(;;){for(n=e;;){r:{n:{i:{a:{o:{s:{u:{c:{l:switch(0|(i=(e=t-n|0)>>2)){case 5:break u;case 4:break c;case 2:break l;case 0:case 1:break r;case 3:break o;default:break s}if(!zr(e=t-4|0,n))break r;return void kt(n,e)}return void at(n,n+4|0,n+8|0,t-4|0)}return void Ye(n,n+4|0,n+8|0,n+12|0,t-4|0)}if((0|e)<=123){for(i=t,N=o=N-16|0,Ue(n,n+4|0,r=n+8|0),t=n+12|0;(0|t)!=(0|i);){if(zr(t,r)){for(s[o+12>>2]=s[t>>2],e=t;;){if(a=e,e=r,s[a>>2]=s[e>>2],(0|e)!=(0|n)){if(zr(o+12|0,r=e-4|0))continue}else e=n;break}s[e>>2]=s[o+12>>2]}r=t,t=t+4|0}return void(N=o+16|0)}if(a=((0|i)/2<<2)+n|0,u=e>>>0>=3997?Ye(n,(e=(0|i)/4<<2)+n|0,a,e+a|0,o):Ue(n,a,o),e=o,!zr(n,a)){for(;;){if((0|n)==(0|(e=e-4|0))){if(i=n+4|0,zr(n,o))break i;for(;;){if((0|i)==(0|o))break r;if(zr(n,i)){kt(i,o),i=i+4|0;break i}i=i+4|0}}if(zr(e,a))break}kt(n,e),u=u+1|0}if((i=n+4|0)>>>0>=e>>>0)break a;for(;;)if(c=i,i=i+4|0,!zr(c,a)){for(;!zr(e=e-4|0,a););if(e>>>0<c>>>0){i=c;break a}kt(c,e),a=(0|a)==(0|c)?e:a,u=u+1|0}}Ue(n,n+4|0,t-4|0);break r}if((0|i)!=(0|a)&&zr(a,i)&&(kt(i,a),u=u+1|0),!u){if(c=oe(n,i),oe(e=i+4|0,t)){if(t=i,e=n,!c)continue e;break r}if(a=2,c)break n}if((i-n|0)<(t-i|0)){X(n,i,r),e=i+4|0;continue t}X(i+4|0,t,r),t=i,e=n;continue e}if((0|(a=o))==(0|i))break r;for(;;)if(i=(e=i)+4|0,zr(n,e)){for(;zr(n,a=a-4|0););if(!(e>>>0<a>>>0))break;kt(e,a)}a=4}switch(n=e,a-2|0){case 0:continue t;case 2:continue;default:break r}}break}break}break}}function Y(e,t,r,n){var i,a,o=0,u=0,c=0;if(N=a=N-32|0,34==(0|Sn(i=Pt(a+16|0,t)))){pr(i),s[(o=a+8|0)+4>>2]=0,s[o>>2]=e;e:{t:{r:{n:{i:{a:{for(;;){o:{s:{if(92!=(0|(t=Sn(i)))){if(34!=(255&t))break s;pr(i),pe(o,0);break e}if(u=Mr(i),pr(i),t=Sn(i),c=h[5024+(255&t)|0]){pr(i),pe(o,c<<24>>24);continue}if(117==(0|t)){if(pr(i),t=Ae(e,i,u),Tn(e))break o;if(55296==(-1024&t)){if(!ir(i,92)||!ir(i,117)){if(Tn(e))break a;if(_n(e,9,u),Tn(e))break o}if(c=Ae(e,i,u),Tn(e))break o;if(c-57344>>>0<=4294966271){if(Tn(e))break i;if(_n(e,9,u),Tn(e))break o}t=65536+(c-56320|(t<<10)-56623104)|0}u:{c:{if(!(t>>>0<=127))if(t>>>0<=2047)pe(o,t>>>6|-64),t=63&t|-128;else if(t>>>0<=65535)pe(o,t>>>12|-32),pe(o,t>>>6&63|-128),t=63&t|-128;else{if(t>>>0>=1114112)break c;pe(o,t>>>18|-16),pe(o,t>>>12&63|-128),pe(o,t>>>6&63|-128),t=63&t|-128}pe(o,t<<24>>24);break u}C(2162,1443,115,2041),T()}continue}if(Tn(e))break n;if(_n(e,10,u),!Tn(e))continue;break o}if(!(t>>>0<=31)){Mr(i),pe(o,pr(i));continue}if(u=Tn(e),t){if(u)break t;if(_n(e,12,Mr(i)),!Tn(e))continue}else{if(u)break r;if(_n(e,11,Mr(i)),!Tn(e))continue}}break}break e}C(2472,1472,1029,1335),T()}C(2472,1472,1033,1335),T()}C(2472,1472,1039,1335),T()}C(2472,1472,1048,1335),T()}C(2472,1472,1050,1335),T()}return Tn(e)||(t=s[o+4>>2]-1|0,u=s[o+4>>2],Pr(o=s[o>>2])>>>0<u>>>0&&(C(2420,1498,139,1210),T()),c=o,o=s[o+12>>2]-u|0,s[c+12>>2]=o,he(r,o,t)),jt(i),void(N=a+32|0)}C(2616,1472,963,1576),T(),C(2472,1472,985,1576),T()}function z(e,t){var r,n,i,a,u,c,l=0,d=0;N=a=N-16|0,s[(l=a+8|0)+4>>2]=t,s[l>>2]=t,N=n=N+-64|0,r=n+24|0,jr(i=e+32|0)?(t=s[i>>2])||(C(2122,1498,173,1153),T()):t=0,Ot(r,t,256),en(d=r+24|0),s[r+32>>2]=2,u=un(n+16|0,e),N=t=N-16|0,Fr(d,0,0),c=un(t+8|0,r),it(l);e:{t:{r:if(!Tn(r)){n:{if(!Sn(l)){if(d=1,!Tn(r))break n;C(2472,1472,571,1921),T()}if(F(r,l,e),Tn(r))break r;if(it(l),Tn(r))break r;if(!Sn(l))break r;if(d=2,Tn(r))break t}_n(r,d,Mr(l)),Tn(r)}l=s[r+28>>2],s[n+8>>2]=s[r+24>>2],s[n+12>>2]=l,sn(s[c>>2]),N=t+16|0;break e}C(2472,1472,583,1921),T()}t=s[n+12>>2],s[e+56>>2]=s[n+8>>2],s[e+60>>2]=t,t=jr(e+56|0),s[n+4>>2]=0,s[n>>2]=t?0:3;e:{t:{if(s[n>>2]|1&s[n+4>>2]){if(24!=(0|Pr(i)))break t;(0|(t=mt(i,1)))!=(0|e)&&(l=s[t+4>>2],s[e>>2]=s[t>>2],s[e+4>>2]=l,l=s[t+20>>2],s[e+16>>2]=s[t+16>>2],s[e+20>>2]=l,l=s[t+12>>2],s[e+8>>2]=s[t+8>>2],s[e+12>>2]=l,o[t+18>>1]=0)}sn(t=s[u>>2]+32|0),s[t+12>>2]!=s[t+8>>2]?K(t,Pr(t)):(H(s[t+8>>2]),s[t+16>>2]=0,s[t+8>>2]=0,s[t+12>>2]=0),vr(r),N=n- -64|0;break e}C(2285,1415,2344,1355),T()}return N=a+16|0,e}function J(e,t,r){var n,i=0,o=0;if(r>>>0>=512)return $(0|e,0|t,0|r),e;n=e+r|0;e:if(3&(e^t))if(n>>>0<4)r=e;else if((i=n-4|0)>>>0<e>>>0)r=e;else for(r=e;a[0|r]=h[0|t],a[r+1|0]=h[t+1|0],a[r+2|0]=h[t+2|0],a[r+3|0]=h[t+3|0],t=t+4|0,i>>>0>=(r=r+4|0)>>>0;);else{t:if(3&e)if(r)for(r=e;;){if(a[0|r]=h[0|t],t=t+1|0,!(3&(r=r+1|0)))break t;if(!(r>>>0<n>>>0))break}else r=e;else r=e;if(!((i=-4&n)>>>0<64||(o=i+-64|0)>>>0<r>>>0))for(;s[r>>2]=s[t>>2],s[r+4>>2]=s[t+4>>2],s[r+8>>2]=s[t+8>>2],s[r+12>>2]=s[t+12>>2],s[r+16>>2]=s[t+16>>2],s[r+20>>2]=s[t+20>>2],s[r+24>>2]=s[t+24>>2],s[r+28>>2]=s[t+28>>2],s[r+32>>2]=s[t+32>>2],s[r+36>>2]=s[t+36>>2],s[r+40>>2]=s[t+40>>2],s[r+44>>2]=s[t+44>>2],s[r+48>>2]=s[t+48>>2],s[r+52>>2]=s[t+52>>2],s[r+56>>2]=s[t+56>>2],s[r+60>>2]=s[t+60>>2],t=t- -64|0,o>>>0>=(r=r- -64|0)>>>0;);if(r>>>0>=i>>>0)break e;for(;s[r>>2]=s[t>>2],t=t+4|0,i>>>0>(r=r+4|0)>>>0;);}if(r>>>0<n>>>0)for(;a[0|r]=h[0|t],t=t+1|0,(0|n)!=(0|(r=r+1|0)););return e}function Q(e,t,r){var n=0,i=0,a=0,o=0,s=0,u=0,c=0,l=0,d=0;n=e;e:{t:{r:{n:{i:{a:{o:{s:{u:{c:{if(t){if(!r)break c;break u}e=(n>>>0)/(r>>>0)|0,G=0;break e}if(!n)break s;break o}if(!(r-1&r))break a;i=0-(o=(b(r)+33|0)-b(t)|0)|0;break n}e=(t>>>0)/0|0,G=0;break e}if((e=32-b(t)|0)>>>0<31)break i;break r}if(1==(0|r))break t;r=31&(e=r?31-b(r-1^r)|0:32),(63&e)>>>0>=32?(e=0,t=t>>>r|0):(e=t>>>r|0,t=((1<<r)-1&t)<<32-r|n>>>r),G=e,e=t;break e}o=e+1|0,i=63-e|0}if(a=31&(e=63&o),e>>>0>=32?(e=0,s=t>>>a|0):(e=t>>>a|0,s=((1<<a)-1&t)<<32-a|n>>>a),a=e,i=31&(e=63&i),e>>>0>=32?(e=n<<i,n=0):(e=(1<<i)-1&n>>>32-i|t<<i,n<<=i),t=e,o)for(d=-1!=(0|(i=r-1|0))?0:-1;s=(e=s<<1|t>>>31)-(c=r&(u=d-((a=a<<1|s>>>31)+(e>>>0>i>>>0)|0)>>31))|0,a=a-(e>>>0<c>>>0)|0,t=t<<1|n>>>31,n=l|n<<1,l=1&u,o=o-1|0;);G=t<<1|n>>>31,e=l|n<<1;break e}n=0,t=0}G=t,e=n}return e}function q(e,t,r){var n,i=0,a=0,o=0,u=0,c=0;N=n=N-16|0;e:{if(on(t)){if(!Vr(r))break e;on(t)||(C(2461,1415,1246,1296),T()),un(e,s[t+8>>2]),Mt(i=n+8|0,t);t:if(Yr(e,i))for(;;){a=s[e>>2];r:{n:{if(Vr(r)){if(!Vr(a))break n;if((0|(o=Tt(r)))==(0|Tt(a))){if(i=1,(0|(u=xt(r)))==(0|(a=xt(a))))break r;i:{a:{o:{if(o>>>0>=4){if(3&(a|u))break o;for(;;){if(s[u>>2]!=s[a>>2])break o;if(a=a+4|0,u=u+4|0,!((o=o-4|0)>>>0>3))break}}if(!o)break a}for(;;){if((0|(i=h[0|u]))==(0|(c=h[0|a]))){if(a=a+1|0,u=u+1|0,o=o-1|0)continue;break a}break}i=i-c|0;break i}i=0}i=!i}else i=0;break r}C(2520,1415,2171,1377),T()}C(2500,1415,2172,1377),T()}if(i)break t;if(s[e>>2]=s[e>>2]+48,Mt(i=n+8|0,t),!Yr(e,i))break}return void(N=n+16|0)}C(2461,1415,1334,1178),T()}C(2515,1415,1335,1178),T()}function ee(e,t,r){e:switch(t-9|0){case 0:return t=s[r>>2],s[r>>2]=t+4,void(s[e>>2]=s[t>>2]);case 6:return t=s[r>>2],s[r>>2]=t+4,t=o[t>>1],s[e>>2]=t,void(s[e+4>>2]=t>>31);case 7:return t=s[r>>2],s[r>>2]=t+4,s[e>>2]=f[t>>1],void(s[e+4>>2]=0);case 8:return t=s[r>>2],s[r>>2]=t+4,t=a[0|t],s[e>>2]=t,void(s[e+4>>2]=t>>31);case 9:return t=s[r>>2],s[r>>2]=t+4,s[e>>2]=h[0|t],void(s[e+4>>2]=0);case 16:return t=s[r>>2]+7&-8,s[r>>2]=t+8,void(y[e>>3]=y[t>>3]);case 17:oi[8](e,r);default:return;case 1:case 4:case 14:return t=s[r>>2],s[r>>2]=t+4,t=s[t>>2],s[e>>2]=t,void(s[e+4>>2]=t>>31);case 2:case 5:case 11:case 15:return t=s[r>>2],s[r>>2]=t+4,s[e>>2]=s[t>>2],void(s[e+4>>2]=0);case 3:case 10:case 12:case 13:break e}t=s[r>>2]+7&-8,s[r>>2]=t+8,r=s[t+4>>2],s[e>>2]=s[t>>2],s[e+4>>2]=r}function te(e,t,r){var n,i=0,a=0,o=0,u=0;N=n=N-32|0,s[e+16>>2]=0,s[e>>2]=-1,s[e+4>>2]=-1,s[e+8>>2]=-1,s[e+12>>2]=2;e:{t:switch(0|r){case 0:i=dt(t,3);break e;case 1:o=dt(t,2),a=-1;r:if(!(s[t+544>>2]<2))for(u=t+576|0,i=1;;){if(.5*+s[t+668>>2]>+s[ur(u,i)>>2]&&(a=s[ur(u,i)>>2],i>>>0>2))break r;if(!((0|(i=i+1|0))<s[t+544>>2]))break}i=(0|a)<(0|o)?o:a;break e;default:break t}i=dt(t,3)}s[e>>2]=i,a=de(t,s[t+140>>2],s[t+144>>2]),s[t+108>>2]=a,(0|a)>0&&(i=me(t,i,a),s[e>>2]=i),1!=(0|(o=s[t+672>>2]))?(a=5e3,s[e+4>>2]=5e3,e=-1):(s[e+16>>2]=1,s[e+8>>2]=1024e3,a=-1,e=1024e3),u=s[t+668>>2],s[n+24>>2]=1,s[n+20>>2]=e,s[n+16>>2]=a,s[n+12>>2]=i,s[n+8>>2]=o,s[n+4>>2]=u,s[n>>2]=r,se(t,3459,n),N=n+32|0}function re(e,t,r){var n=0,i=0;e:if((0|e)!=(0|t)){if(t-(i=e+r|0)>>>0<=0-(r<<1)>>>0)return void J(e,t,r);if(n=3&(e^t),e>>>0<t>>>0){if(!n){if(3&e)for(;;){if(!r)break e;if(a[0|e]=h[0|t],t=t+1|0,r=r-1|0,!(3&(e=e+1|0)))break}if(!(r>>>0<=3))for(;s[e>>2]=s[t>>2],t=t+4|0,e=e+4|0,(r=r-4|0)>>>0>3;);}if(r)for(;a[0|e]=h[0|t],e=e+1|0,t=t+1|0,r=r-1|0;);}else{if(!n){if(3&i)for(;;){if(!r)break e;if(a[0|(n=(r=r-1|0)+e|0)]=h[t+r|0],!(3&n))break}if(!(r>>>0<=3))for(;s[(r=r-4|0)+e>>2]=s[t+r>>2],r>>>0>3;);}if(!r)break e;for(;a[(r=r-1|0)+e|0]=h[t+r|0],r;);}}}function ne(e,t,r){var n=0,i=0,o=0;if(r&&(a[0|e]=t,a[(i=e+r|0)-1|0]=t,!(r>>>0<3||(a[e+2|0]=t,a[e+1|0]=t,a[i-3|0]=t,a[i-2|0]=t,r>>>0<7||(a[e+3|0]=t,a[i-4|0]=t,r>>>0<9||(o=(i=0-e&3)+e|0,n=m(255&t,16843009),s[o>>2]=n,s[(r=(t=r-i&-4)+o|0)-4>>2]=n,t>>>0<9||(s[o+8>>2]=n,s[o+4>>2]=n,s[r-8>>2]=n,s[r-12>>2]=n,t>>>0<25||(s[o+24>>2]=n,s[o+20>>2]=n,s[o+16>>2]=n,s[o+12>>2]=n,s[r-16>>2]=n,s[r-20>>2]=n,s[r-24>>2]=n,s[r-28>>2]=n,(r=(r=t)-(t=4&o|24)|0)>>>0<32))))))))for(n=Ne(n,0,1,1),i=G,t=t+o|0;s[t+24>>2]=n,s[t+28>>2]=i,s[t+16>>2]=n,s[t+20>>2]=i,s[t+8>>2]=n,s[t+12>>2]=i,s[t>>2]=n,s[t+4>>2]=i,t=t+32|0,(r=r-32|0)>>>0>31;);return e}function ie(e,t){var r,n,i,a,o,u=0,c=0,l=0,d=0;if(s[e+4>>2]!=s[Wn(e)>>2])return N=c=N-16|0,u=Vt(c,e,1),ln(Wn(e),s[u+4>>2],t),s[u+4>>2]=s[u+4>>2]+4,Kr(u),void(N=c+16|0);if(N=r=N-32|0,i=Wn(e),c=ze(e,Dr(e)+1|0),l=Dr(e),N=n=N-16|0,s[n+12>>2]=0,dn((u=r+8|0)+12|0,i),c&&(d=hr(s[u+16>>2],c)),s[u>>2]=d,l=(l<<2)+d|0,s[u+8>>2]=l,s[u+4>>2]=l,a=jn(u),o=(c<<2)+d|0,s[a>>2]=o,N=n+16|0,ln(i,s[u+8>>2],t),s[u+8>>2]=s[u+8>>2]+4,Cn(e),t=u+4|0,er(Wn(e),s[e>>2],s[e+4>>2],t),kt(e,t),kt(e+4|0,u+8|0),kt(Wn(e),jn(u)),s[u>>2]=s[u+4>>2],Bn(e,Dr(e)),(0|(e=s[u+4>>2]))!=s[u+8>>2])for(;s[u+8>>2]=s[u+8>>2]-4,(0|e)!=s[u+8>>2];);s[u>>2]&&H(e=s[u>>2]),N=r+32|0}function ae(e,t,r,n){var i=0;s[n+8>>2]=t,s[n>>2]=0,s[n+4>>2]=0,s[r>>2]=n,s[s[e>>2]>>2]&&(s[e>>2]=s[s[e>>2]>>2]),r=(0|(n=s[Zn(e)>>2]))==(0|(t=s[r>>2])),a[t+12|0]=r;e:if(!r)for(;;){if(h[s[t+8>>2]+12|0])break e;i=xr(s[t+8>>2]),r=s[t+8>>2];t:{if(i){if(!(!(r=s[s[r+8>>2]+4>>2])|h[r+12|0]))break t;xr(t)||et(t=s[t+8>>2]),t=s[t+8>>2],a[t+12|0]=1,t=s[t+8>>2],a[t+12|0]=0,qe(t);break e}if(!(r=s[s[r+8>>2]>>2])|h[r+12|0]){xr(t)&&qe(t=s[t+8>>2]),t=s[t+8>>2],a[t+12|0]=1,t=s[t+8>>2],a[t+12|0]=0,et(t);break e}}if(t=s[t+8>>2],a[t+12|0]=1,t=s[t+8>>2],a[t+12|0]=(0|t)==(0|n),a[r+12|0]=1,(0|t)==(0|n))break}e=Wn(e),s[e>>2]=s[e>>2]+1}function oe(e,t){var r,n=0,i=0,a=0,o=0,u=0,c=0;N=r=N-16|0,o=1;e:{t:switch(t-e>>2){case 2:if(!zr(t=t-4|0,e))break e;kt(e,t);break e;case 3:Ue(e,e+4|0,t-4|0);break e;case 4:at(e,e+4|0,e+8|0,t-4|0);break e;case 5:Ye(e,e+4|0,e+8|0,e+12|0,t-4|0);break e;case 0:case 1:break e;default:break t}for(Ue(e,e+4|0,a=e+8|0),n=e+12|0;;){if((0|t)==(0|n))break e;t:{if(zr(n,a)){for(s[r+12>>2]=s[n>>2],i=n;;){if(c=i,i=a,s[c>>2]=s[i>>2],(0|e)!=(0|i)){if(zr(r+12|0,a=i-4|0))continue}else i=e;break}if(s[i>>2]=s[r+12>>2],8==(0|(u=u+1|0)))break t}a=n,n=n+4|0;continue}break}o=(n+4|0)==(0|t)}return N=r+16|0,o}function se(e,t,r){var n,i=0,a=0;if(N=n=N-16|0,h[e+174|0]){if(s[n+12>>2]=r,N=i=N-208|0,s[i+204>>2]=r,ne(e=i+160|0,0,40),s[i+200>>2]=s[i+204>>2],!((0|j(0,t,i+200|0,i+80|0,e))<0)){e=s[2183]>=0,r=s[2164],s[2182]<=0&&(s[2164]=-33&r);e:{t:{if(s[2176]){if(s[2168])break t}else s[2176]=80,s[2171]=0,s[2168]=0,s[2169]=0,a=s[2175],s[2175]=i;if(Ze(8656))break e}j(8656,t,i+200|0,i+80|0,i+160|0)}a&&(oi[s[2173]](8656,0,0),s[2176]=0,s[2175]=a,s[2171]=0,s[2168]=0,s[2169]=0),s[2164]=s[2164]|32&r}N=i+208|0}N=n+16|0}function ue(e,t){var r=0,n=0,i=0;if((0|e)!=(0|t)){if(!qr(e))return qr(t)?(i=Tr(t),t=yr(t),N=r=N-16|0,t>>>0<=10?(Gn(e,t),nn(e,i,t),a[r+15|0]=0,Mn(e+t|0,r+15|0)):ye(e,10,t-10|0,e=h[e+11|0],e,t,i),void(N=r+16|0)):(s[e+8>>2]=s[t+8>>2],r=s[t+4>>2],s[e>>2]=s[t>>2],void(s[e+4>>2]=r));i=Tr(t),t=yr(t),N=r=N-16|0,(n=Rr(e))>>>0>t>>>0?(n=s[e>>2],Un(e,t),nn(n,i,t),a[r+15|0]=0,Mn(t+n|0,r+15|0)):ye(e,n-1|0,1+(t-n|0)|0,e=s[e+4>>2],e,t,i),N=r+16|0}}function ce(e,t){if(!e)return 0;e:{t:{if(e){if(t>>>0<=127)break t;if(s[s[2757]>>2]){if(t>>>0<=2047){a[e+1|0]=63&t|128,a[0|e]=t>>>6|192,e=2;break e}if(!(57344!=(-8192&t)&t>>>0>=55296)){a[e+2|0]=63&t|128,a[0|e]=t>>>12|224,a[e+1|0]=t>>>6&63|128,e=3;break e}if(t-65536>>>0<=1048575){a[e+3|0]=63&t|128,a[0|e]=t>>>18|240,a[e+2|0]=t>>>6&63|128,a[e+1|0]=t>>>12&63|128,e=4;break e}}else if(57216==(-128&t))break t;s[2720]=25,e=-1}else e=1;break e}a[0|e]=t,e=1}return e}function le(e){var t,r=0,n=0,i=0,a=0;if(Or(t=e+608|0))for(e=0;r=Gr(t,e),(0|(i=s[r+4>>2]))>=0&(r=s[r>>2])>>>0>=2|(0|i)>0?(r=Gr(t,e),i=s[r>>2],r=s[r+4>>2]):(i=1,r=0),a+=1/(+(i>>>0)+4294967296*+(0|r)),e=e+1|0,Or(t)>>>0>e>>>0;);return Or(t)&&(n=+(Or(t)>>>0)/a),_(n)<0x8000000000000000?(G=_(n)>=1?~~(n>0?A(E(2.3283064365386963e-10*n),4294967295):S(2.3283064365386963e-10*(n-+(~~n>>>0>>>0))))>>>0:0,~~n>>>0):(G=-2147483648,0)}function de(e,t,r){var n,i=0,a=0,o=0,u=0,c=0,l=0,d=0;N=n=N-16|0,a=-1;e:if(!((0|t)<=0|(0|r)<=0)){if(s[e+544>>2]>0){for(o=(0|t)>(0|r)?t:r,u=(0|t)<(0|r)?t:r,c=e+576|0,l=e+564|0,d=e+552|0,r=0;;){if(t=s[ur(d,r)>>2],i=ur(l,r),a=-1,(0|t)<=0)break e;if((0|(i=s[i>>2]))<=0)break e;if(a=ur(c,r),(0|((0|t)<(0|i)?t:i))>=(0|u)|(0|((0|t)>(0|i)?t:i))>=(0|o)||!((0|(r=r+1|0))<s[e+544>>2]))break}a=s[a>>2]}s[n>>2]=a,se(e,3607,n)}return N=n+16|0,a}function he(e,t,r){var n,i,u,c=0;return c=_e(e+32|0),i=cr(e),N=n=N-16|0,s[c>>2]=0,s[c+4>>2]=0,s[c+16>>2]=0,s[c+20>>2]=0,s[c+8>>2]=0,s[c+12>>2]=0,s[(e=n+8|0)+4>>2]=r,s[e>>2]=t||5280,!r|t||(C(1064,1415,401,1617),T()),p[e+4>>2]<18?(o[c+18>>1]=7173,Ln(c,s[e+4>>2])):(o[c+18>>1]=3077,s[c>>2]=s[e+4>>2],Hn(t=c,c=ge(i,s[e+4>>2]+1|0))),u=J(c,s[e>>2],s[e+4>>2])+s[e+4>>2]|0,0,a[0|u]=0,N=n+16|0,1}function fe(e,t,r){var n=0,i=0,a=0;if(!(32&h[0|e]))e:{n=t;t:{if(!(e=s[(t=e)+16>>2])){if(Ze(t))break t;e=s[t+16>>2]}if(e-(a=s[t+20>>2])>>>0<r>>>0){oi[s[t+36>>2]](t,n,r);break e}r:if(!(s[t+80>>2]<0)){for(e=r;;){if(i=e,!e)break r;if(10==h[n+(e=i-1|0)|0])break}if(oi[s[t+36>>2]](t,n,i)>>>0<i>>>0)break t;n=n+i|0,r=r-i|0,a=s[t+20>>2]}J(a,n,r),s[t+20>>2]=s[t+20>>2]+r}}}function pe(e,t){var r,n=0,i=0;r=s[e>>2],(s[r+16>>2]-s[r+12>>2]|0)<=0&&(s[r+8>>2]?n=((n=kr(r))+1>>>1|0)+n|0:(s[r>>2]||(n=vt(1),s[r+4>>2]=n,s[r>>2]=n),n=s[r+20>>2]),K(r,n>>>0>(i=Pr(r)+1|0)>>>0?n:i));e:{t:{if(n=s[r+12>>2]){if((s[r+16>>2]-n|0)<=0)break t;s[r+12>>2]=n+1;break e}C(2133,1498,130,2030),T()}C(2323,1498,131,2030),T()}a[0|n]=t,s[e+4>>2]=s[e+4>>2]+1}function ge(e,t){var r=0,n=0,i=0,a=0;e:if(t){if(n=t+7&-8,!((t=s[e>>2])&&(i=n+(r=s[t+4>>2])|0)>>>0<=p[t>>2])){if(r=(t=s[e+4>>2])>>>0>n>>>0?t:n,s[e+12>>2]||(t=vt(1),s[e+16>>2]=t,s[e+12>>2]=t),(t=(t=r+16|0)?V(t):0)&&(s[t+4>>2]=0,s[t>>2]=r,s[t+8>>2]=s[e>>2],s[e>>2]=t),!t)break e;t=s[e>>2],i=n+(r=s[t+4>>2])|0}s[t+4>>2]=i,a=16+(t+r|0)|0}return a}function ye(e,t,r,n,i,o,u){var c,l=0,d=0;if(N=c=N-16|0,(-1^t)-17>>>0>=r>>>0)return l=Tr(e),t>>>0<2147483623?(s[c+8>>2]=t<<1,s[c+12>>2]=t+r,r=Dt(s[zt(c+12|0,c+8|0)>>2])):r=-18,r=vt(d=r+1|0),o&&nn(r,u,o),u=n-i|0,(0|n)!=(0|i)&&nn(r+o|0,i+l|0,u),10!=(0|t)&&H(l),Yn(e,r),Zr(e,d),Un(t=e,e=o+u|0),a[c+7|0]=0,Mn(e+r|0,c+7|0),void(N=c+16|0);ni(),T()}function me(e,t,r){var n,i=0,a=0,o=0,u=0;N=n=N-16|0,o=t;e:if(!((0|r)<=0|(0|t)<=(0|r)||(a=1,s[e+544>>2]<=0||(0|(i=s[ur(u=e+576|0,0)>>2]))>(0|r))))for(;;){if(o=i,s[e+544>>2]<=(0|a))break e;if(i=ur(u,a),a=a+1|0,!((0|(i=s[i>>2]))<=(0|r)))break}return s[n+8>>2]=o,s[n+4>>2]=r,s[n>>2]=t,se(e,3827,n),N=n+16|0,o}function ve(e,t,r,n){a[e+53|0]=1;e:if(s[e+4>>2]==(0|r)){a[e+52|0]=1;t:{if(!(r=s[e+16>>2])){if(s[e+36>>2]=1,s[e+24>>2]=n,s[e+16>>2]=t,1!=(0|n))break e;if(1==s[e+48>>2])break t;break e}if((0|t)==(0|r)){if(2==(0|(r=s[e+24>>2]))&&(s[e+24>>2]=n,r=n),1!=s[e+48>>2])break e;if(1==(0|r))break t;break e}s[e+36>>2]=s[e+36>>2]+1}a[e+54|0]=1}}function _e(e){var t=0,r=0;(s[e+16>>2]-s[e+12>>2]|0)<24&&(s[e+8>>2]?t=((t=kr(e))+1>>>1|0)+t|0:(s[e>>2]||(t=vt(1),s[e+4>>2]=t,s[e>>2]=t),t=s[e+20>>2]),K(e,t>>>0>(r=Pr(e)+24|0)>>>0?t:r));e:{t:{if(t=s[e+12>>2]){if((s[e+16>>2]-t|0)<24)break t;s[e+12>>2]=t+24;break e}C(2133,1498,130,2030),T()}C(2323,1498,131,2030),T()}return t}function be(e,t){var r,n,i;return N=i=(N=n=(N=r=N-16|0)-16|0)-32|0,$t(i,t),q(n,e,De(i+8|0,i)),N=i+32|0,s[(t=n+8|0)>>2]=s[n>>2],N=n+16|0,s[r+8>>2]=s[t>>2],N=t=N-16|0,on(e)||(C(2461,1415,1243,2048),T()),e=s[un(t+8|0,s[e+8>>2]+m(s[e>>2],48)|0)>>2],N=t+16|0,s[r>>2]=e,e=Yr(r+8|0,r),N=r+16|0,e}function Ae(e,t,r){for(var n=0,i=0,a=0;;){e:{n=(i=Sn(t))+(n<<4)|0;t:if((i-48&255)>>>0<=9)n=n-48|0;else if((i-65&255)>>>0<=5)n=n-55|0;else if((i-97&255)>>>0<=5)n=n-87|0;else{if(!Tn(e)){if(_n(e,8,r),!Tn(e))break t;n=0;break e}C(2472,1472,919,2203),T()}if(pr(t),4!=(0|(a=a+1|0)))continue}break}return n}function Ee(e,t,r){var n=0,i=0,a=0;n=pn(e),i=Zn(e);e:{if(n){t:{for(;;){r:{if(zr(r,a=n+16|0)){if(!s[n>>2])break e}else{if(!zr(a,r))break t;if(i=n+4|0,!s[n+4>>2])break r;n=i}i=n,n=s[n>>2];continue}break}return s[t>>2]=n,i}return s[t>>2]=n,i}n=Zn(e)}return s[t>>2]=n,n}function Se(e){var t=0,r=0,n=0;e:{if(3&(t=e))for(;;){if(!h[0|t])break e;if(!(3&(t=t+1|0)))break}for(;r=t,t=t+4|0,!((-1^(n=s[r>>2]))&n-16843009&-2139062144););if(!(255&n))return r-e|0;for(;n=h[r+1|0],r=t=r+1|0,n;);}return t-e|0}function Te(e,t){var r,n=0,i=0;if(s[e+4>>2]!=s[Wn(e)>>2])return N=i=N-16|0,n=ar(i,e),fn(Wn(e),s[n+4>>2],t),s[n+4>>2]=s[n+4>>2]+8,Kr(n),void(N=i+16|0);N=i=N-32|0,r=n=Wn(e),n=Oe(i+8|0,Ce(e,Or(e)+1|0),Or(e),n),fn(r,s[n+8>>2],t),s[n+8>>2]=s[n+8>>2]+8,st(e,n),rt(n),N=i+32|0}function we(e,t,r){var n=0;if(!r)return s[e+4>>2]==s[t+4>>2];if((0|e)==(0|t))return 1;r=s[e+4>>2],e=h[0|r],t=s[t+4>>2];e:if(!(!e|(0|(n=h[0|t]))!=(0|e)))for(;;){if(n=h[t+1|0],!(e=h[r+1|0]))break e;if(t=t+1|0,r=r+1|0,(0|e)!=(0|n))break}return(0|e)==(0|n)}function Ce(e,t){var r,n,i=0;if(N=r=N-16|0,s[r+12>>2]=t,N=n=N-16|0,s[n+12>>2]=536870911,s[n+8>>2]=2147483647,i=s[Yt(n+12|0,n+8|0)>>2],N=n+16|0,t>>>0<=i>>>0)return(e=Ir(e))>>>0<i>>>1>>>0&&(s[r+8>>2]=e<<1,i=s[zt(r+8|0,r+12|0)>>2]),N=r+16|0,i;Jn(),T()}function ke(e,t){var r,n,i,o=0,s=0;return N=i=N-16|0,r=Se(t),N=n=N-16|0,r>>>0<=4294967279?(r>>>0<=10?(Gn(e,r),o=e):(Yn(e,o=vt(s=Dt(r)+1|0)),Zr(e,s),Un(e,r)),nn(o,t,r),a[n+15|0]=0,Mn(r+o|0,n+15|0),N=n+16|0):(ni(),T()),N=i+16|0,e}function Ie(e,t,r){var n=0,i=0,o=0;if(t)for(;i=Ne(n=Q(e,t,10),o=G,10,0),a[0|(r=r-1|0)]=e-i|48,i=t>>>0>9,e=n,t=o,i;);else n=e;if(n)for(;e=(n>>>0)/10|0,a[0|(r=r-1|0)]=n-m(e,10)|48,t=n>>>0>9,n=e,t;);return r}function $e(e){var t,r,n=0,i=0,a=0,o=0,s=0,u=0,c=0;if(!((0|(r=Or(t=e+644|0)))<=1)){for(e=n=r-1|0;i=e-1|0,a=+(0|e),o=(y[Gr(t,e)>>3]-y[Gr(t,i)>>3])*a+o,s+=a,u=e>>>0>1,e=i,u;);(0|r)<=1||(c=o/(s*+(0|n)))}return c}function Pe(e,t){var r=0,n=0,i=0;return r=e+32|0,n=m(t,48),Pr(r)>>>0<n>>>0&&(C(2420,1498,139,1210),T()),n=s[r+12>>2]-n|0,s[r+12>>2]=n,r=Bt(r),e=cr(e),o[r+18>>1]=3,t?(Hn(r,i=ge(i=e,e=m(t,48))),J(i,n,e)):Hn(r,0),s[r>>2]=t,s[r+4>>2]=t,1}function xe(e,t){var r,n,i=0;r=Se(t),N=n=N-16|0,(i=qr(e)?Rr(e)-1|0:10)>>>0>=r>>>0?(i=Tr(e),r&&re(i,t,r),a[n+15|0]=0,Mn(r+i|0,n+15|0),qr(e)?Un(e,r):Gn(e,r)):ye(e,i,r-i|0,e=yr(e),e,r,t),N=n+16|0}function Re(e,t){var r,n,i=0;if(d(+e),r=0|u(1),n=0|u(0),2047!=(0|(i=r>>>20&2047))){if(!i)return 0==e?i=0:(e=Re(0x10000000000000000*e,t),i=s[t>>2]+-64|0),s[t>>2]=i,e;s[t>>2]=i-1022,c(0,0|n),c(1,-2146435073&r|1071644672),e=+l()}return e}function Oe(e,t,r,n){var i,a,o,u=0;return N=i=N-16|0,s[i+12>>2]=0,dn(e+12|0,n),t&&(t>>>0>536870911&&(je(1742),T()),u=vt(t<<3)),s[e>>2]=u,r=(r<<3)+u|0,s[e+8>>2]=r,s[e+4>>2]=r,a=jn(e),o=(t<<3)+u|0,s[a>>2]=o,N=i+16|0,e}function De(e,t){var r,n;return N=n=N-16|0,s[e>>2]=0,s[e+4>>2]=0,s[e+16>>2]=0,s[e+20>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0,s[(r=n+8|0)>>2]=s[t>>2],s[r+4>>2]=s[t+4>>2],o[e+18>>1]=1029,Hn(e,s[r>>2]),s[e>>2]=s[r+4>>2],N=n+16|0,e}function Le(e){var t,r=0,n=0;if(t=s[e+28>>2]){e:if(r=s[t>>2]){for(;;){if(s[t+8>>2]!=(0|r)){if(n=s[r+8>>2],H(r),s[t>>2]=n,r=n)continue;break e}break}s[r+4>>2]=0}(r=s[t+16>>2])&&H(r),H(t)}vr(e+32|0)}function Me(e){var t=0,r=0,n=0;if(!vn(a[s[e>>2]]))return 0;for(;n=s[e>>2],t=-1,r>>>0<=214748364&&(t=a[0|n]-48|0,t=(2147483647-(r=m(r,10))|0)<(0|t)?-1:t+r|0),s[e>>2]=n+1,r=t,vn(a[n+1|0]););return t}function Ne(e,t,r,n){var i,a,o,s,u=0,c=0;return s=m(u=r>>>16|0,c=e>>>16|0),u=(65535&(c=((o=m(i=65535&r,a=65535&e))>>>16|0)+m(c,i)|0))+m(u,a)|0,G=(m(t,r)+s|0)+m(e,n)+(c>>>16)+(u>>>16)|0,65535&o|u<<16}function Be(e,t,r){var n;if(!(n=s[e+16>>2]))return s[e+36>>2]=1,s[e+24>>2]=r,void(s[e+16>>2]=t);e:{if((0|t)==(0|n)){if(2!=s[e+24>>2])break e;return void(s[e+24>>2]=r)}a[e+54|0]=1,s[e+24>>2]=2,s[e+36>>2]=s[e+36>>2]+1}}function Ue(e,t,r){var n,i=0;i=zr(t,e),n=zr(r,t);e:{if(i){if(n)return kt(e,r),1;if(kt(e,t),i=1,!zr(r,t))break e;kt(t,r)}else{if(i=0,!n)break e;if(kt(t,r),i=1,!zr(t,e))break e;kt(e,t)}i=2}return i}function Ge(e){var t=0;return Lt(e),s[e+28>>2]=0,s[e+24>>2]=0,Ot(e+32|0,0,1024),en(e+56|0),s[e+24>>2]||(t=vt(20),s[t+16>>2]=0,s[t+12>>2]=0,s[t+8>>2]=0,s[t+4>>2]=65536,s[t>>2]=0,s[e+28>>2]=t,s[e+24>>2]=t),e}function Ve(e,t){var r,n,i;return N=r=N-32|0,$t(r,t),i=De(r+8|0,r),N=t=N-16|0,q(n=t+8|0,e,i),Mt(t,e),Yr(n,t)?(N=t+16|0,e=s[t+8>>2]+24|0):(C(1927,1415,1218,2143),T()),N=r+32|0,e}function Fe(e,t,r,n,i){var a;if(N=a=N-256|0,!(73728&i|(0|r)<=(0|n))){if(ne(a,255&t,(n=(r=r-n|0)>>>0<256)?r:256),!n)for(;fe(e,a,256),(r=r-256|0)>>>0>255;);fe(e,a,r)}N=a+256|0}function je(e){var t,r,n,i,a;t=0|k(8),s[t>>2]=8492,s[t>>2]=8536,n=vt((r=Se(e))+13|0),s[n+8>>2]=0,s[n+4>>2]=r,s[n>>2]=r,i=t,a=J(n+12|0,e,r+1|0),s[i+4>>2]=a,s[t>>2]=8584,I(0|t,8616,2),T()}function He(){var e,t,r=0,n=0;return N=r=N-16|0,w(r+8|0,0),n=s[r+12>>2],N=r+16|0,r=Ne(r=s[r+8>>2],r>>31,1e3,0),t=G,n=r+(e=Q(n,n>>31,1e3))|0,r=G+t|0,G=r=n>>>0<e>>>0?r+1|0:r,n}function Ze(e){var t=0;return t=s[e+72>>2],s[e+72>>2]=t-1|t,8&(t=s[e>>2])?(s[e>>2]=32|t,-1):(s[e+4>>2]=0,s[e+8>>2]=0,t=s[e+44>>2],s[e+28>>2]=t,s[e+20>>2]=t,s[e+16>>2]=t+s[e+48>>2],0)}function We(e,t){if(s[e>>2]=0,s[e+4>>2]=0,s[e+16>>2]=0,s[e+20>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0,t>>>0<7)return o[e+18>>1]=f[5282+(t<<1)>>1],void(5==(0|t)&&Ln(e,0));C(1968,1415,714,1825),T()}function Ke(e){var t=0,r=0;e&&(s[e+20>>2]!=s[e+28>>2]&&oi[s[e+36>>2]](e,0,0),(0|(t=s[e+4>>2]))!=(0|(r=s[e+8>>2]))&&(t=t-r|0,oi[s[e+40>>2]](e,t,t>>31,1)))}function Xe(e,t){var r,n,i,a;N=r=N-16|0,s[r+8>>2]=t,i=r,a=bn(e),s[i>>2]=a,n=rr((t=s[e>>2]+(s[r+8>>2]-s[r>>2]>>3<<3)|0)+8|0,s[e+4>>2],t),Or(e),_t(e,n),Xn(e),Zt(t),N=r+16|0}function Ye(e,t,r,n,i){var a=0;if(a=at(e,t,r,n),zr(i,n)){if(kt(n,i),!zr(n,r))return a+1|0;if(kt(r,n),!zr(r,t))return a+2|0;if(kt(t,r),!zr(t,e))return a+3|0;kt(e,t),a=a+4|0}return a}function ze(e,t){var r;if(N=r=N-16|0,s[r+12>>2]=t,t>>>0<=(t=ft(e))>>>0)return(e=$r(e))>>>0<t>>>1>>>0&&(s[r+8>>2]=e<<1,t=s[zt(r+8|0,r+12|0)>>2]),N=r+16|0,t;Jn(),T()}function Je(e,t){var r,n=0,i=0;return r=mt(n=e+32|0,t),n=Bt(n),e=cr(e),o[n+18>>1]=4,t?(Hn(n,i=ge(i=e,e=m(t,24))),J(i,r,e)):Hn(n,0),s[n>>2]=t,s[n+4>>2]=t,1}function Qe(e){var t,r;return(e=(t=s[2201])+(r=e+3&-4)|0)>>>0<=t>>>0&&r||e>>>0>si()<<16>>>0&&!(0|x(0|e))?(s[2720]=48,-1):(s[2201]=e,t)}function qe(e){var t,r=0;t=s[e>>2],r=s[t+4>>2],s[e>>2]=r,r&&Hn(r,e),s[t+8>>2]=s[e+8>>2],r=xr(e)?s[e+8>>2]:s[e+8>>2]+4|0,s[r>>2]=t,s[t+4>>2]=e,Hn(e,t)}function et(e){var t,r=0;t=s[e+4>>2],r=s[t>>2],s[e+4>>2]=r,r&&Hn(r,e),s[t+8>>2]=s[e+8>>2],r=xr(e)?s[e+8>>2]:s[e+8>>2]+4|0,s[r>>2]=t,s[t>>2]=e,Hn(e,t)}function tt(e,t){var r,n,i=0;N=r=N-32|0,n=i=Wn(e),i=Oe(r+8|0,Ce(e,Or(e)+1|0),Or(e),i),gr(n,s[i+8>>2],t),s[i+8>>2]=s[i+8>>2]+8,st(e,i),rt(i),N=r+32|0}function rt(e){var t=0;if((0|(t=s[e+4>>2]))!=s[e+8>>2])for(;s[e+8>>2]=s[e+8>>2]-8,(0|t)!=s[e+8>>2];);s[e>>2]&&H(t=s[e>>2])}function nt(e){var t,r,n,i;N=t=(N=r=N-16|0)-16|0,s[e+4>>2]=0,s[t+12>>2]=0,An(e+8|0,t+12|0),n=e,i=Zn(e),s[n>>2]=i,N=t+16|0,N=r+16|0}function it(e){var t,r=0;for(N=t=N-16|0,e=Pt(t,e);!((r=(255&Sn(e))-9|0)>>>0>23|!(1<<r&8388627));)pr(e);jt(e),N=t+16|0}function at(e,t,r,n){var i=0;if(i=Ue(e,t,r),zr(n,r)){if(kt(r,n),!zr(r,t))return i+1|0;if(kt(t,r),!zr(t,e))return i+2|0;kt(e,t),i=i+3|0}return i}function ot(e,t){var r;if(Dr(r=e+576|0))for(e=0;;){if(s[ur(r,e)>>2]==(0|t))return e;if(e=e+1|0,!(Dr(r)>>>0>e>>>0))break}return 0}function st(e,t){var r;wn(e),r=t+4|0,er(Wn(e),s[e>>2],s[e+4>>2],r),kt(e,r),kt(e+4|0,t+8|0),kt(Wn(e),jn(t)),s[t>>2]=s[t+4>>2],Or(e),Ir(e),Ir(e)}function ut(e,t,r,n){var i;N=i=N-16|0,n=Vt(i,e,n),(0|(e=r-t|0))>0&&(J(s[n+4>>2],t,e),s[n+4>>2]=e+s[n+4>>2]),Kr(n),N=i+16|0}function ct(e,t){e:{if(an(e)){if(p[e>>2]<=t>>>0)break e;return s[e+8>>2]+m(t,24)|0}C(2451,1415,1668,2143),T()}C(1721,1415,1669,2143),T()}function lt(e,t){var r,n,i;ft(e)>>>0<t>>>0&&(Jn(),T()),r=hr(Wn(e),t),s[e>>2]=r,s[e+4>>2]=r,n=Wn(e),i=(t<<2)+r|0,s[n>>2]=i,Bn(e)}function dt(e,t){var r;return Dr(r=e+576|0)?(e=s[e+544>>2]<=(0|t)?Dr(r)-1|0:(0|t)>0?t:0,s[Xr(r,e)>>2]):0}function ht(e){var t;s[e+4>>2],t=s[e>>2],s[e+4>>2]=t}function ft(e){var t;return N=t=N-16|0,s[t+12>>2]=1073741823,s[t+8>>2]=2147483647,e=s[Yt(t+12|0,t+8|0)>>2],N=t+16|0,e}function pt(e,t){return e=_e(e+32|0),s[e+16>>2]=0,s[e+20>>2]=0,s[e>>2]=0,s[e+4>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0,o[e+18>>1]=t?10:9,1}function gt(e){var t,r;return N=r=(N=t=N-16|0)-16|0,e=s[un(r+8|0,Zn(e))>>2],N=r+16|0,e=s[un(t+8|0,e)>>2],N=t+16|0,e}function yt(e,t,r){var n;return N=n=N-16|0,s[n+12>>2]=t,An(e,n+12|0),t=s[r+4>>2],s[e+4>>2]=s[r>>2],s[e+8>>2]=t,N=n+16|0,e}function mt(e,t){var r;return t=m(t,24),Pr(e)>>>0<t>>>0&&(C(2420,1498,139,1210),T()),r=e,e=s[e+12>>2]-t|0,s[r+12>>2]=e,e}function vt(e){var t=0;e=e||1;e:{for(;;){if(t=V(e))break e;if(!(t=s[3148]))break;oi[0|t]()}D(),T()}return t}function _t(e,t){s[e+4>>2],s[e+4>>2]=t}function bt(e,t){s[e+4>>2],s[e+4>>2]=t}function At(e){var t,r;return s[(e|=0)>>2]=8536,t=s[e+4>>2]-12|0,r=s[t+8>>2]-1|0,s[t+8>>2]=r,(0|r)<0&&H(t),0|e}function Et(e,t){var r,n;N=n=N-16|0,r=ar(n,e),gr(Wn(e),s[r+4>>2],t),s[r+4>>2]=s[r+4>>2]+8,Kr(r),N=n+16|0}function St(e,t){var r;return N=r=N-16|0,s[r+8>>2]=s[e>>2],s[r>>2]=s[t>>2],e=Yr(r+8|0,r),N=r+16|0,e}function Tt(e){if(Vr(e))return 16&h[e+19|0]?17-a[e+17|0]|0:s[e>>2];C(2520,1415,1857,1389),T()}function wt(e){var t=0,r=0;Jt(e,pn(e)),t=Wn(e),r=0,s[t>>2]=r,t=e,r=Zn(e),s[t>>2]=r,t=Zn(e),r=0,s[t>>2]=r}function Ct(e){var t=0,r=0;Ht(e,pn(e)),t=Wn(e),r=0,s[t>>2]=r,t=e,r=Zn(e),s[t>>2]=r,t=Zn(e),r=0,s[t>>2]=r}function kt(e,t){var r;N=r=N-16|0,s[r+12>>2]=s[e>>2],s[e>>2]=s[t>>2],s[t>>2]=s[r+12>>2],N=r+16|0}function It(e){var t;return N=t=N-16|0,s[e>>2]=0,s[e+4>>2]=0,s[t+12>>2]=0,ei(e+8|0),N=t+16|0,e}function $t(e,t){var r,n;s[e>>2]=t,t||(C(2232,1415,413,1308),T()),r=e,n=Se(t),s[r+4>>2]=n}function Pt(e,t){var r,n;return r=s[t+4>>2],n=s[t>>2],s[e+8>>2]=t,s[e>>2]=n,s[e+4>>2]=r,e}function xt(e){if(Vr(e))return 16&h[e+19|0]||(e=s[e+8>>2]),e;C(2520,1415,1852,1566),T()}function Rt(e,t){if((0|t)>=-308){if((0|t)>=0)return Ft(t)*e;e/=Ft(0-t|0)}else e=0;return e}function Ot(e,t,r){s[e+4>>2]=0,s[e+8>>2]=0,s[e>>2]=t,s[e+20>>2]=r,s[e+12>>2]=0,s[e+16>>2]=0}function Dt(e){var t=0;return e=e>>>0>=11?11==(0|(e=(t=e+16&-16)-1|0))?t:e:10}function Lt(e){s[e>>2]=0,s[e+4>>2]=0,s[e+16>>2]=0,s[e+20>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0}function Mt(e,t){on(t)||(C(2461,1415,1249,2048),T()),un(e,s[t+8>>2]+m(s[t>>2],48)|0)}function Nt(e){var t;N=t=N-16|0,s[e>>2]=0,s[e+4>>2]=0,s[e+8>>2]=0,N=t+16|0}function Bt(e){return Pr(e)>>>0<=23&&(C(2397,1498,146,1206),T()),s[e+12>>2]-24|0}function Ut(e){var t;return N=t=N-16|0,e=s[un(t+8|0,bn(e))>>2],N=t+16|0,e}function Gt(e){var t;return N=t=N-16|0,e=s[un(t+8|0,rn(e))>>2],N=t+16|0,e}function Vt(e,t,r){return s[e>>2]=t,t=s[t+4>>2],s[e+4>>2]=t,s[e+8>>2]=t+(r<<2),e}function Ft(e){return e>>>0>=309&&(C(2184,1532,48,2213),T()),y[5296+(e<<3)>>3]}function jt(e){var t,r;r=s[e+4>>2],t=s[e+8>>2],s[t>>2]=s[e>>2],s[t+4>>2]=r}function Ht(e,t){t&&(Ht(e,s[t>>2]),Ht(e,s[t+4>>2]),qn(t+16|0),H(t))}function Zt(e){var t;return N=t=N-16|0,e=s[un(t+8|0,e)>>2],N=t+16|0,e}function Wt(e){var t;return N=t=N-16|0,Yn(t+8|0,e),N=t+16|0,s[t+8>>2]}function Kt(e){var t;return N=t=N-16|0,s[t+8>>2]=e,N=t+16|0,s[t+8>>2]}function Xt(e){return 32&h[e+18|0]||(C(1588,1415,1816,1114),T()),s[e>>2]}function Yt(e,t){var r,n;return N=r=N-16|0,n=Jr(t,e),N=r+16|0,n?t:e}function zt(e,t){var r,n;return N=r=N-16|0,n=Jr(e,t),N=r+16|0,n?t:e}function Jt(e,t){t&&(Jt(e,s[t>>2]),Jt(e,s[t+4>>2]),ti(t+16|0),H(t))}function Qt(e){var t=0;wn(e),s[e>>2]&&(Vn(e),t=s[e>>2],Ir(e),H(t))}function qt(e){var t=0;Cn(e),s[e>>2]&&(Fn(e),t=s[e>>2],$r(e),H(t))}function er(e,t,r,n){e=r-t|0,r=s[n>>2]-e|0,s[n>>2]=r,(0|e)>0&&J(r,t,e)}function tr(e){var t;return(-1>>>(t=31&e)&-2)<<t|(-1<<(e=0-e&31)&-2)>>>e}function rr(e,t,r){var n;return n=t-e|0,(0|e)!=(0|t)&&re(r,e,n),r+n|0}function nr(e,t){var r;return(0|(r=yn(e)))==(0|t)&&gn(e),(0|t)==(0|r)}function ir(e,t){var r;return(0|(r=Sn(e)))==(0|t)&&pr(e),(0|t)==(0|r)}function ar(e,t){return s[e>>2]=t,t=s[t+4>>2],s[e+4>>2]=t,s[e+8>>2]=t+8,e}function or(e,t){var r;N=r=N-16|0,X(Kt(e),Kt(t),r+8|0),N=r+16|0}function sr(e,t,r){1==s[e+28>>2]|s[e+4>>2]!=(0|t)||(s[e+28>>2]=r)}function ur(e,t){return Dr(e)>>>0<=t>>>0&&(ri(),T()),s[e>>2]+(t<<2)|0}function cr(e){return(e=s[e+24>>2])||(C(2122,1415,2492,1153),T()),e}function lr(e){return an(e)||(C(2451,1415,1642,1810),T()),s[e>>2]}function dr(e,t){s[e+4>>2]==s[Wn(e)>>2]?tt(e,t):Et(e,t)}function hr(e,t){return t>>>0>1073741823&&(je(1742),T()),vt(t<<2)}function fr(e,t){p[e+4>>2]<p[Wn(e)>>2]?Et(e,t):tt(e,t)}function pr(e){var t;return t=e,e=s[e>>2],s[t>>2]=e+1,a[0|e]}function gr(e,t,r){e=s[r+4>>2],s[t>>2]=s[r>>2],s[t+4>>2]=e}function yr(e){return qr(e)?s[e+4>>2]:h[e+11|0]}function mr(e){var t=0;qr(e)&&(t=s[e>>2],Rr(e),H(t))}function vr(e){H(s[e+8>>2]),(e=s[e+4>>2])&&H(e)}function _r(e){var t;return t=s[e>>2],s[e>>2]=0,t}function br(e,t,r){s[e>>2]=s[t>>2],a[e+4|0]=h[0|r]}function Ar(e){return(s[Wn(e)>>2]-s[e>>2]|0)/48|0}function Er(e){return wr(e)||(ri(),T()),s[e>>2]}function Sr(e){return e?(s[2720]=e,-1):0}function Tr(e){return qr(e)?s[e>>2]:e}function wr(e){return(s[e+4>>2]-s[e>>2]|0)/48|0}function Cr(e,t){return a[e+4|0]=0,s[e>>2]=t,e}function kr(e){return s[e+16>>2]-s[e+8>>2]|0}function Ir(e){return s[Wn(e)>>2]-s[e>>2]>>3}function $r(e){return s[Wn(e)>>2]-s[e>>2]>>2}function Pr(e){return s[e+12>>2]-s[e+8>>2]|0}function xr(e){return s[s[e+8>>2]>>2]==(0|e)}function Rr(e){return 2147483647&s[e+8>>2]}function Or(e){return s[e+4>>2]-s[e>>2]>>3}function Dr(e){return s[e+4>>2]-s[e>>2]>>2}function Lr(e,t){return s[e>>2]=s[t>>2],e}function Mr(e){return s[e>>2]-s[e+4>>2]|0}function Nr(e){return s[e>>2]=s[e>>2]+8,e}function Br(e){return s[e>>2]=s[e>>2]-4,e}function Ur(e){return s[e>>2]=s[e>>2]-8,e}function Gr(e,t){return s[e>>2]+(t<<3)|0}function Vr(e){return(4&h[e+19|0])>>>2|0}function Fr(e,t,r){s[e+4>>2]=r,s[e>>2]=t}function jr(e){return 0!=s[(e|=0)>>2]|0}function Hr(e){return Nt(e),Nt(e+24|0),e}function Zr(e,t){s[e+8>>2]=-2147483648|t}function Wr(e){return Nt(e),Nt(e+32|0),e}function Kr(e){s[s[e>>2]+4>>2]=s[e+4>>2]}function Xr(e,t){return s[e>>2]+(t<<2)|0}function Yr(e,t){return s[e>>2]!=s[t>>2]}function zr(e,t){return s[e>>2]<s[t>>2]}function Jr(e,t){return p[e>>2]<p[t>>2]}function Qr(e){wr(e),ht(e),Ar(e),wr(e)}function qr(e){return h[e+11|0]>>>7|0}function en(e){s[e>>2]=0,s[e+4>>2]=0}function tn(e,t){Dr(e),bt(e,t),zn(e)}function rn(e){return Zt(s[e+4>>2])}function nn(e,t,r){r&&J(e,t,r)}function an(e){return 4==f[e+18>>1]}function on(e){return 3==f[e+18>>1]}function sn(e){s[e+12>>2]=s[e+8>>2]}function un(e,t){return s[e>>2]=t,e}function cn(e){return s[e>>2]+16|0}function ln(e,t,r){s[t>>2]=s[r>>2]}function dn(e,t){ei(e),Yn(e+4|0,t)}function hn(e){return It(e+24|0),e}function fn(e,t,r){y[t>>3]=y[r>>3]}function pn(e){return s[Zn(e)>>2]}function gn(e){return pr(s[e>>2])}function yn(e){return Sn(s[e>>2])}function mn(e){return Mr(s[e>>2])}function vn(e){return e-48>>>0<10}function _n(e,t,r){Fr(e+24|0,t,r)}function bn(e){return Zt(s[e>>2])}function An(e,t){s[e>>2]=s[t>>2]}function En(e){Ar(e),wr(e),Ar(e)}function Sn(e){return a[s[e>>2]]}function Tn(e){return jr(e+24|0)}function wn(e){Ir(e),Or(e),Ir(e)}function Cn(e){$r(e),Dr(e),$r(e)}function kn(e){return jr(e+56|0)}function In(e){Or(e),Vn(e),Xn(e)}function $n(e){Dr(e),Fn(e),zn(e)}function Pn(){U=20800,B=12608}function xn(e){mr(e+24|0),mr(e)}function Rn(e){mr(e+32|0),mr(e)}function On(e,t){return Ve(e,t)}function Dn(e){return 0|(e|=0)}function Ln(e,t){a[e+17|0]=17-t}function Mn(e,t){a[0|e]=h[0|t]}function Nn(e,t,r){J(t,r,48)}function Bn(e,t){$r(e),$r(e)}function Un(e,t){s[e+4>>2]=t}function Gn(e,t){a[e+11|0]=t}function Vn(e){_t(e,s[e>>2])}function Fn(e){bt(e,s[e>>2])}function jn(e){return e+12|0}function Hn(e,t){s[e+8>>2]=t}function Zn(e){return e+4|0}function Wn(e){return e+8|0}function Kn(e){H(e|=0)}function Xn(e){Ir(e),Or(e)}function Yn(e,t){s[e>>2]=t}function zn(e){$r(e),Dr(e)}function Jn(){je(1146),T()}function Qn(e){qt(e+24|0)}function qn(e){Rn(e+4|0)}function ei(e){s[e>>2]=0}function ti(e){xn(e+4|0)}function ri(){ni(),T()}function ni(){D(),T()}function ii(e){}i(t=h,1024,"UGFyc2VBcnJheQAtKyAgIDBYMHgALTBYKzBYIDBYLTB4KzB4IDB4AHN0ciAhPSAwIHx8IGxlbiA9PSAwdQBBbGdvcml0aG1CQUJCd2l0aFN0YWxsRXZlbnQAR2V0SW50AGhlaWdodABQYXJzZU9iamVjdABpdGVtcwB2ZWN0b3IAR2V0QWxsb2NhdG9yAFBhcnNlTnVtYmVyAEZpbmRNZW1iZXIAQWxnb3JpdGhtU3RhcnR1cABUb3AAUG9wAHN0YXRlX2luZm8Ac3RkOjpleGNlcHRpb24Adl9hZGFwdGF0aW9uAGFfYWRhcHRhdGlvbgBzZWdtZW50X2R1cmF0aW9uAHNldF9kdXJhdGlvbgBNZW1iZXJCZWdpbgBOb3ROdWxsU3RyTGVuAG5hbgBpdGVtX251bQBQYXJzZVN0cmluZ1RvU3RyZWFtAFBhcnNlU3RyZWFtAFBhcnNlTnVsbABTdHJpbmdFcXVhbABHZXRTdHJpbmdMZW5ndGgAYmFuZHdpZHRoAC4vbGlicy9yYXBpZGpzb24vZG9jdW1lbnQuaAAuL2xpYnMvcmFwaWRqc29uL2VuY29kaW5ncy5oAC4vbGlicy9yYXBpZGpzb24vcmVhZGVyLmgALi9saWJzL3JhcGlkanNvbi9pbnRlcm5hbC9zdGFjay5oAC4vbGlicy9yYXBpZGpzb24vaW50ZXJuYWwvcG93MTAuaABHZXRTdHJpbmcAUGFyc2VTdHJpbmcAZGF0YV8uZi5mbGFncyAmIGtJbnRGbGFnAGluZgBHZW5lcmljU3RyaW5nUmVmAHNldF9zaXplAGNvbnRlbnRfdG90YWxfc2l6ZQBjdXJyZW50X2NvbnRlbnRfZG93bmxvYWRfc2l6ZQBjdXJyZW50X2hlYWRlcl9kb3dubG9hZF9zaXplAGluZGV4IDwgZGF0YV8uYS5zaXplAGFsbG9jYXRvcjxUPjo6YWxsb2NhdGUoc2l6ZV90IG4pICduJyBleGNlZWRzIG1heGltdW0gc3VwcG9ydGVkIHNpemUAU2l6ZQBQYXJzZVRydWUAR2VuZXJpY1ZhbHVlAGNvbnRlbnRfZG93bmxvYWRfc3RhdGUAaGVhZGVyX2Rvd25sb2FkX3N0YXRlAHN0cmVhbV9iaXRyYXRlAGZyYW1lX3JhdGUAc2FtcGxlX3JhdGUAUGFyc2UAZmFsc2UAUGFyc2VGYWxzZQBwcmVsb2FkX3R5cGUAbWVkaWFfdHlwZQB0eXBlID49IGtOdWxsVHlwZSAmJiB0eXBlIDw9IGtOdW1iZXJUeXBlAHN0YXJ0X3RpbWUAR2V0RG91YmxlAFB1c2hVbnNhZmUARW5jb2RlAE1lbWJlckVuZABzdHJlYW1faWQAW1NlbGVjdG9yTG9nXSBbJXNdIGNoYW5nZSBxdWFsaXR5IGZyb20gJWQgLT4gJWQAY29kZWMAYWxsb2NhdG9yXwBzdGFja1RvcF8Ab3BlcmF0b3JbXQBOQU4ASU5GAGNvZGVwb2ludCA8PSAweDEwRkZGRgBuID49IDAgJiYgbiA8PSAzMDgAUGFyc2VIZXg0AFBvdzEwAGV4cEZyYWMgPD0gMABzdHIgIT0gMAAoZGF0YV8uZi5mbGFncyAmIGtVaW50NjRGbGFnKSAhPSAwAC4AKG51bGwpAHN0YWNrXy5HZXRTaXplKCkgPT0gc2l6ZW9mKFZhbHVlVHlwZSkAc3RhdGljX2Nhc3Q8c3RkOjpwdHJkaWZmX3Q+KHNpemVvZihUKSAqIGNvdW50KSA8PSAoc3RhY2tFbmRfIC0gc3RhY2tUb3BfKQBHZXRTaXplKCkgPj0gc2l6ZW9mKFQpAEdldFNpemUoKSA+PSBjb3VudCAqIHNpemVvZihUKQBJc0FycmF5KCkASXNPYmplY3QoKQAhSGFzUGFyc2VFcnJvcigpAElzTnVtYmVyKCkAcmhzLklzU3RyaW5nKCkAbmFtZS5Jc1N0cmluZygpAGlzLlBlZWsoKSA9PSAneycAaXMuUGVlaygpID09ICd0JwBpcy5QZWVrKCkgPT0gJ24nAGlzLlBlZWsoKSA9PSAnZicAaXMuUGVlaygpID09ICdbJwBzLlBlZWsoKSA9PSAnXCInACVkIABbU2VsZWN0b3JMb2ddIFN1cHBvcnQgYml0cmF0ZTogAFtTZWxlY3RvckxvZ10gdmlkZW9fc3RyZWFtIHN0cmVhbV9pZDolcyBzZWdtZW50X2R1cmF0aW9uOiVkIGJhbmR3aWR0aDolZCB3aWR0aDolZCBoZWlnaHQ6JWQgZnJhbWVyYXRlOiUuMmYgY29kZWM6JXMKAFtTZWxlY3RvckxvZ10gYXVkaW9fc3RyZWFtIHN0cmVhbV9pZDolcyBzZWdtZW50X2R1cmF0aW9uOiVkIGJhbmR3aWR0aDolZCBzYW1wbGVfcmF0ZTolZCBjb2RlYzolcwoAW1NlbGVjdG9yTG9nXSBQcmVsb2FkIGluZm8gaXM6ICVzCgBbU2VsZWN0b3JMb2ddIE1QRCBpbmZvIGlzOiAlcwoAW1NlbGVjdG9yTG9nXSBbJXNdIHRocmVzaG9sZCBoaWdoOiUuMmxmIGxvdzolLjJsZiBodXJyeTolLjJsZgoAW1NlbGVjdG9yTG9nXSBkZXZpY2VfaW5mbyBzY3JlZW5fd2lkdGg6JWQgc2NyZWVuX2hlaWdodDolZCBkZXZpY2VfcGl4ZWxfcmF0aW86JS4yZiBzY3JlZW5fZnBzOiUuMmYKAFtTZWxlY3RvckxvZ10gWyVzXSBzdGFydHVwX2luZm8gdGltZTolbGx1IGRvd25sb2FkX3NwZWVkOiVsbGQgcHJlZGljdGVkX2JhbmR3aWR0aDolbGxkIGJpdHJhdGU6JWQgY3VycmVudF9iaXRyYXRlOiVkIGJ1ZmZlcl9sZW5ndGg6JS4yZiBwcmVkaWN0ZWRfZXJyb3I6JS4yZiBtYXhfZXJyb3I6JS4yZiBzZWVrX2FjdGlvbjolZCBwbGF5X3Bvc2l0aW9uOiVsbGQgaGFzX3N0YXJ0OiVkIHN0YXJ0dXBfZGVjaXNpb25fY291bnQ6JWQKAFtTZWxlY3RvckxvZ10gdmlkZW9fbWVkaWFfaW5mbyBzZWdtZW50X2R1cmF0aW9uOiVkIGJpdHJhdGU6JWQgd2lkdGg6JWQgaGVpZ2h0OiVkIGJpdHJhdGVfbGV2ZWxzOiVkCgBbU2VsZWN0b3JMb2ddIFtQcmVsb2FkZXJdIG1ldGhvZDolZCBkb3dubG9hZF9zcGVlZDogJWQsIG1lZGlhX2Zvcm1hdDogJWQgcHJlbG9hZF9iaXRyYXRlOiVkIHByZWxvYWRfZHVyYXRpb246JWQgcHJlbG9hZF9zaXplOiVkIGNvbnNpZGVyX3NjcmVlbjolZAoAW1NlbGVjdG9yTG9nXSBbZmluZE1heEJpdHJhdGU0U2NyZWVuXSBTZXQgQUJSIG1heCBiaXRyYXRlIGZvciBzY3JlZW46JWQKAFtTZWxlY3RvckxvZ10gW3NlZWsgYWN0aW9uXSBub3dfY2hlY2tfdGltZTolbGxkIHNlZWtfYWN0aW9uOiVkIGVuYWJsZV9zZWVrX3N0YWJsZV9tb2RlbDolZAoAW1NlbGVjdG9yTG9nXSBQcmVsb2FkIGluZm8gaXRlbV9udW06JWQsIGl0ZW1zX3NpemU6JWQKAFtTZWxlY3RvckxvZ10gW2FkanVzdEJpdHJhdGVdIEFCUiBwcmVkaWN0IGJpdHJhdGU6JWQgYWRqdXN0IG1heCBiaXRyYXRlOiVkIHRvICVkCgBbU2VsZWN0b3JMb2ddIFtQcmVsb2FkZXJdIG1ldGhvZDolZCBkb3dubG9hZF9zcGVlZDogJWQsIG1lZGlhX2Zvcm1hdDogJWQKAFtTZWxlY3RvckxvZ10gW1ByZWxvYWRlcl0gZG93bmxvYWRfc3BlZWQ6ICVkLCBtZWRpYV9mb3JtYXQ6ICVkCgBbU2VsZWN0b3JMb2ddIFN0YXJ0dXAgdXNlIHByZWxvYWQgaXRlbSBhdCBiaXRyYXRlOiAlZAoAW1NlbGVjdG9yTG9nXSBbJXNdIG5vd19jaGVja190aW1lOiVsbGQsIGJ1ZmZlcl9sZW5ndGg6JS4ybGYvJS4yZiwgcGxheV9zcGVlZDolLjJmLCBjdXJyZW50X2JpdHJhdGU6JWQsIHByZWRpY3RfYml0cmF0ZTolZCwgYmFuZHdpZHRoOiVsbGQsIHByZWRpY3RlZF9iYW5kd2lkdGg6JWxsZCwgc2VnbWVudF9kdXJhdGlvbjolZCwgc3RhbGxfY291bnQ6JWQsIHNlZWtfYWN0aW9uOiVkLCBzZWVrX3N0YXlfdGltZTolLjJmLCBwbGF5X3Bvc2l0aW9uOiVsbGQsIGxhc3Rfc2Vla19jaGVja190aW1lOiVsbGQsIHN0YWxsX2V2ZW50OiVkLCBzdGFsbF9ldmVudF9jb3VudDolZC8lZCwgcW9lX3ZhbHVlOiUuMmYgKCUuMmYgJS4yZiAlLjJmKSAoJWQtPiVkKQoAW1NlbGVjdG9yTG9nXSBbRVJST1JdIFByZWxvYWQgaW5mbyBwYXJzZSBlcnJvciEKAFtTZWxlY3RvckxvZ10gW0VSUk9SXSBObyB2X2FkYXB0YXRpb24gaW4gTVBEIQoAW1NlbGVjdG9yTG9nXSBbRVJST1JdIE5vIGFfYWRhcHRhdGlvbiBpbiBNUEQhCgBbU2VsZWN0b3JMb2ddIFtzZWVrIGFjdGlvbl0gbm93X2NoZWNrX3RpbWU6JWxsZCBsYXN0X3NlZWtfY2hlY2tfdGltZTolbGxkIHNlZWtfYWN0aW9uOiVkIGhhbmcgdXAhISEhCgBbU2VsZWN0b3JMb2ddIFtFUlJPUl0gUHJlbG9hZCBpbmZvIGl0ZW1zIGVycm9yICEhIQoAW1NlbGVjdG9yTG9nXSBbRVJST1JdIFByZWxvYWQgaW5mbyBzdGF0ZSBlcnJvciAhISEKAFtTZWxlY3RvckxvZ10gW0VSUk9SXSB2X2FkYXB0YXRpb24gcGFyc2UgZXJyb3IgISEhCgBbU2VsZWN0b3JMb2ddIFtFUlJPUl0gYV9hZGFwdGF0aW9uIHBhcnNlIGVycm9yICEhIQoAW1NlbGVjdG9yTG9nXSBtT3BlbmVkVGltZTogJWxsZCwgbU1ldGhvZDogJWQsIG1CdWZmZXI6ICUuMmxmLyUuMmYgbURvd25sb2FkU3BlZWQ6JWxsZCAK"),i(t,5058,"Ig=="),i(t,5071,"Lw=="),i(t,5116,"XAAAAAAACAAAAAwAAAAAAAAACgAAAA0ACQ=="),i(t,5284,"CQAKAAMABAAFHPYDAAAAAAAA8D8AAAAAAAAkQAAAAAAAAFlAAAAAAABAj0AAAAAAAIjDQAAAAAAAavhAAAAAAICELkEAAAAA0BJjQQAAAACE15dBAAAAAGXNzUEAAAAgX6ACQgAAAOh2SDdCAAAAopQabUIAAEDlnDCiQgAAkB7EvNZCAAA0JvVrDEMAgOA3ecNBQwCg2IVXNHZDAMhOZ23Bq0MAPZFg5FjhQ0CMtXgdrxVEUO/i1uQaS0SS1U0Gz/CARPZK4ccCLbVEtJ3ZeUN46kSRAigsKosgRTUDMrf0rVRFAoT+5HHZiUWBEh8v5yfARSHX5vrgMfRF6oygOVk+KUYksAiI741fRhduBbW1uJNGnMlGIuOmyEYDfNjqm9D+RoJNx3JhQjNH4yB5z/kSaEcbaVdDuBeeR7GhFirTztJHHUqc9IeCB0ilXMPxKWM9SOcZGjf6XXJIYaDgxHj1pkh5yBj21rLcSEx9z1nG7xFJnlxD8LdrRknGM1TspQZ8SVygtLMnhLFJc8ihoDHl5UmPOsoIfl4bSppkfsUOG1FKwP3ddtJhhUowfZUUR7q6Sj5u3WxstPBKzskUiIfhJEtB/Blq6RlaS6k9UOIxUJBLE03kWj5kxEtXYJ3xTX35S224BG6h3C9MRPPC5OTpY0wVsPMdXuSYTBuccKV1Hc9MkWFmh2lyA031+T/pA084TXL4j+PEYm5NR/s5Drv9ok0ZesjRKb3XTZ+YOkZ0rA1OZJ/kq8iLQk49x93Wui53Tgw5lYxp+qxOp0Pd94Ec4k6RlNR1oqMWT7W5SROLTExPERQO7NavgU8WmRGnzBu2T1v/1dC/outPmb+F4rdFIVB/LyfbJZdVUF/78FHv/IpQG502kxXewFBiRAT4mhX1UHtVBbYBWypRbVXDEeF4YFHIKjRWGZeUUXo1wavfvMlRbMFYywsWAFLH8S6+jhs0Ujmuum1yImlSx1kpCQ9rn1Id2Lll6aLTUiROKL+jiwhTrWHyroyuPlMMfVftFy1zU09crehd+KdTY7PYYnX23VMecMddCboSVCVMObWLaEdULp+Hoq5CfVR9w5QlrUmyVFz0+W4Y3OZUc3G4ih6THFXoRrMW89tRVaIYYNzvUoZVyh5406vnu1U/Eytky3DxVQ7YNT3+zCVWEk6DzD1AW1bLENKfJgiRVv6UxkcwSsVWPTq4Wbyc+lZmJBO49aEwV4DtFyZzymRX4Oid7w/9mVeMscL1KT7QV+9dM3O0TQRYazUAkCFhOVjFQgD0ablvWLspgDji06NYKjSgxtrI2Fg1QUh4EfsOWcEoLevqXENZ8XL4pSU0eFmtj3YPL0GuWcwZqmm96OJZP6AUxOyiF1pPyBn1p4tNWjIdMPlId4JafiR8NxsVt1qeLVsFYtrsWoL8WEN9CCJbozsvlJyKVluMCju5Qy2MW5fmxFNKnMFbPSC26FwD9ltNqOMiNIQrXDBJzpWgMmFcfNtBu0h/lVxbUhLqGt/KXHlzS9JwywBdV1DeBk3+NF1t5JVI4D1qXcSuXS2sZqBddRq1OFeA1F0SYeIGbaAJXqt8TSREBEBe1ttgLVUFdF7MErl4qgapXn9X5xZVSN9er5ZQLjWNE19bvOR5gnBIX3LrXRijjH5fJ7M67+UXs1/xXwlr393nX+23y0VX1R1g9FKfi1alUmCxJ4curE6HYJ3xKDpXIr1gApdZhHY18mDD/G8l1MImYfT7yy6Jc1xheH0/vTXIkWHWXI8sQzrGYQw0s/fTyPthhwDQeoRdMWKpAISZ5bRlYtQA5f8eIptihCDvX1P10GKl6Oo3qDIFY8+i5UVSfzpjwYWva5OPcGMyZ5tGeLOkY/5AQlhW4Nljn2gp9zUsEGTGwvN0QzdEZHizMFIURXlkVuC8ZlmWr2Q2DDbg973jZEOPQ9h1rRhlFHNUTtPYTmXsx/QQhEeDZej5MRVlGbhlYXh+Wr4f7mU9C4/41tMiZgzOsrbMiFdmj4Ff5P9qjWb5sLvu32LCZjidauqX+/ZmhkQF5X26LGfUSiOvjvRhZ4kd7FqycZZn6ySn8R4OzGcTdwhX04gBaNeUyiwI6zVoDTr9N8pla2hIRP5inh+haFrVvfuFZ9VosUqtemfBCmmvTqys4LhAaVpi19cY53Rp8TrNDd8gqmnWRKBoi1TgaQxWyEKuaRRqj2t60xmESWpzBllIIOV/agikNy0077NqCo2FOAHr6GpM8KaGwSUfazBWKPSYd1Nru2syMX9ViGuqBn/93mq+aypkb17LAvNrNT0LNn7DJ2yCDI7DXbRdbNHHOJq6kJJsxvnGQOk0x2w3uPiQIwL9bCNzmzpWITJt609CyaupZm3m45K7FlScbXDOOzWOtNFtDMKKwrEhBm6Pci0zHqo7bpln/N9SSnFuf4H7l+ecpW7fYfp9IQTbbix9vO6U4hBvdpxrKjobRW+Ugwa1CGJ6bz0SJHFFfbBvzBZtzZac5G9/XMiAvMMZcM85fdBVGlBwQ4icROsghHBUqsMVJim5cOmUNJtvc+9wEd0AwSWoI3FWFEExL5JYcWtZkf26to5x49d63jQyw3HcjRkWwv73cVPxn5ty/i1y1PZDoQe/YnKJ9JSJyW6Xcqsx+ut7Ss1yC198c41OAnPNdlvQMOI2c4FUcgS9mmxz0HTHIrbgoXMEUnmr41jWc4amV5Yc7wt0FMj23XF1QXQYenRVztJ1dJ6Y0eqBR6t0Y//CMrEM4XQ8v3N/3U8VdQuvUN/Uo0p1Z22SC2WmgHXACHdO/s+0dfHKFOL9A+p11v5MrX5CIHaMPqBYHlNUdi9OyO7lZ4l2u2F6at/Bv3YVfYyiK9nzdlqcL4t2zyh3cIP7LVQDX3cmMr2cFGKTd7B+7MOZOsh3XJ7nNEBJ/nf5whAhyO0yeLjzVCk6qWd4pTCqs4iTnXhnXkpwNXzSeAH2XMxCGwd5gjN0fxPiPHkxoKgvTA1yeT3IkjufkKZ5TXp3Csc03HlwrIpm/KAReoxXLYA7CUZ6b604YIqLe3plbCN8Njexen9HLBsEheV6Xln3IUXmGnvblzo1689Qe9I9iQLmA4V7Ro0rg99EuntMOPuxC2vwe18Gep7OhSR89ocYRkKnWXz6VM9riQiQfDgqw8arCsR8x/RzuFYN+Xz48ZBmrFAvfTuXGsBrkmN9Cj0hsAZ3mH1MjClcyJTOfbD3mTn9HAN+nHUAiDzkN34DkwCqS91tfuJbQEpPqqJ+2nLQHONU136QjwTkGyoNf7rZgm5ROkJ/KZAjyuXIdn8zdKw8H3usf6DI64XzzOF/AAAAAAAAAAAZAAoAGRkZAAAAAAUAAAAAAAAJAAAAAAsAAAAAAAAAABkAEQoZGRkDCgcAAQAJCxgAAAkGCwAACwAGGQAAABkZGQ=="),i(t,7857,"DgAAAAAAAAAAGQAKDRkZGQANAAACAAkOAAAACQAOAAAO"),i(t,7915,"DA=="),i(t,7927,"EwAAAAATAAAAAAkMAAAAAAAMAAAM"),i(t,7973,"EA=="),i(t,7985,"DwAAAAQPAAAAAAkQAAAAAAAQAAAQ"),i(t,8031,"Eg=="),i(t,8043,"EQAAAAARAAAAAAkSAAAAAAASAAASAAAaAAAAGhoa"),i(t,8098,"GgAAABoaGgAAAAAAAAk="),i(t,8147,"FA=="),i(t,8159,"FwAAAAAXAAAAAAkUAAAAAAAUAAAU"),i(t,8205,"Fg=="),i(t,8217,"FQAAAAAVAAAAAAkWAAAAAAAWAAAWAAAwMTIzNDU2Nzg5QUJDREVGTjEwX19jeHhhYml2MTE2X19zaGltX3R5cGVfaW5mb0UAAAAA0CAAAEAgAADEIQAATjEwX19jeHhhYml2MTE3X19jbGFzc190eXBlX2luZm9FAAAA0CAAAHAgAABkIAAAAAAAAJQgAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAAAAAAAAYIQAADAAAABQAAAAOAAAADwAAABAAAAAVAAAAFgAAABcAAABOMTBfX2N4eGFiaXYxMjBfX3NpX2NsYXNzX3R5cGVfaW5mb0UAAAAA0CAAAPAgAACUIAAAAAAAAEghAAAYAAAAGQAAABoAAABTdDlleGNlcHRpb24AAAAAqCAAADghAAAAAAAAdCEAAAIAAAAbAAAAHAAAAFN0MTFsb2dpY19lcnJvcgDQIAAAZCEAAEghAAAAAAAAqCEAAAIAAAAdAAAAHAAAAFN0MTJsZW5ndGhfZXJyb3IAAAAA0CAAAJQhAAB0IQAAU3Q5dHlwZV9pbmZvAAAAAKggAAC0IQ=="),i(t,8656,"BQ=="),i(t,8668,"BA=="),i(t,8692,"BQAAAAYAAAB4JgAAAAQ="),i(t,8716,"AQ=="),i(t,8732,"/////wo="),i(t,8800,"0CEAAEBRAAAJ"),i(t,8820,"CQ=="),i(t,8840,"CgAAAAAAAAALAAAAKC0AAAAE"),i(t,8884,"/////w=="),i(t,8952,"aCIAAAAAAAAF"),i(t,8972,"CQ=="),i(t,8996,"BQAAAAsAAAAwMQ=="),i(t,9020,"Ag=="),i(t,9036,"//////////8="),i(t,9105,"Iw==");var ai,oi=((ai=[null,function(e){e|=0,$n(9528),$n(9540),In(9552),In(9728),In(9752),In(9764),In(9740),En(9800),s[2450]&&(ht(9800),e=s[2450],Ar(9800),H(e)),qt(9776),Qt(9764),Qt(9752),Qt(9740),Qt(9728),qt(9716),qt(9696),qt(9684),qt(9672),Jt(9652,pn(9652)),Ht(9640,pn(9640)),Qn(9568),Qt(9552),qt(9540),qt(9528)},At,jr,function(e){return 0},function(e,t,r){t|=0,r|=0;var n,i=0,a=0,o=0,u=0,c=0,l=0;N=n=N-32|0,i=s[28+(e|=0)>>2],s[n+16>>2]=i,a=s[e+20>>2],s[n+28>>2]=r,s[n+24>>2]=t,t=a-i|0,s[n+20>>2]=t,i=t+r|0,l=2;e:{t:{t=n+16|0;r:{if(!Sr(0|P(s[e+60>>2],0|t,2,n+12|0)))for(;;){if((0|(a=s[n+12>>2]))==(0|i))break r;if((0|a)<0)break t;if(o=a-((u=(o=s[t+4>>2])>>>0<a>>>0)?o:0)|0,s[(c=(u<<3)+t|0)>>2]=o+s[c>>2],s[(c=(u?12:4)+t|0)>>2]=s[c>>2]-o,i=i-a|0,t=u?t+8|0:t,l=l-u|0,Sr(0|P(s[e+60>>2],0|t,0|l,n+12|0)))break}if(-1!=(0|i))break t}t=s[e+44>>2],s[e+28>>2]=t,s[e+20>>2]=t,s[e+16>>2]=t+s[e+48>>2],e=r;break e}s[e+28>>2]=0,s[e+16>>2]=0,s[e+20>>2]=0,s[e>>2]=32|s[e>>2],e=0,2!=(0|l)&&(e=r-s[t+4>>2]|0)}return N=n+32|0,0|e},function(e,t,r,n){return G=0,0},function(e,t,r,n,i,o){e|=0,t=+t,r|=0,n|=0,i|=0,o|=0;var c,l=0,f=0,p=0,g=0,y=0,v=0,b=0,A=0,E=0,S=0,T=0,w=0,C=0,k=0,I=0,$=0,P=0,x=0;N=c=N-560|0,s[c+44>>2]=0,d(+t),l=0|u(1),u(0),(0|l)<0?(w=1,I=1045,d(+(t=-t)),l=0|u(1),u(0)):2048&i?(w=1,I=1048):(I=(w=1&i)?1051:1046,x=!w);e:if(2146435072!=(2146435072&l)){k=c+16|0;t:{r:{n:{if(t=Re(t,c+44|0),0!=(t+=t)){if(l=s[c+44>>2],s[c+44>>2]=l-1,97!=(0|(T=32|o)))break n;break t}if(97==(0|(T=32|o)))break t;y=s[c+44>>2],v=(0|n)<0?6:n;break r}y=l-29|0,s[c+44>>2]=y,t*=268435456,v=(0|n)<0?6:n}for(f=E=(0|y)<0?c+48|0:c+336|0;n=t<4294967296&t>=0?~~t>>>0:0,s[f>>2]=n,f=f+4|0,0!=(t=1e9*(t-+(n>>>0))););if((0|y)<=0)n=y,l=f,g=E;else for(g=E,n=y;;){if(n=(0|n)<29?n:29,!(g>>>0>(l=f-4|0)>>>0)){for(p=0;A=s[l>>2],b=31&n,$=p,(63&n)>>>0>=32?(p=A<<b,A=0):(p=(1<<b)-1&A>>>32-b,A<<=b),p=p+P|0,A=Ne(p=Q(b=$+A|0,p=b>>>0<A>>>0?p+1|0:p,1e9),G,1e9,0),s[l>>2]=b-A,g>>>0<=(l=l-4|0)>>>0;);p&&(s[(g=g-4|0)>>2]=p)}for(;g>>>0<(l=f)>>>0&&!s[(f=l-4|0)>>2];);if(n=s[c+44>>2]-n|0,s[c+44>>2]=n,f=l,!((0|n)>0))break}if((0|n)<0)for(C=1+((v+25>>>0)/9|0)|0,b=102==(0|T);;){if(p=(0|(n=0-n|0))<9?n:9,l>>>0<=g>>>0)f=s[g>>2];else{for(A=1e9>>>p|0,P=-1<<p^-1,n=0,f=g;$=n,n=s[f>>2],s[f>>2]=$+(n>>>p|0),n=m(A,n&P),(f=f+4|0)>>>0<l>>>0;);f=s[g>>2],n&&(s[l>>2]=n,l=l+4|0)}if(n=p+s[c+44>>2]|0,s[c+44>>2]=n,g=(!f<<2)+g|0,l=l-(f=b?E:g)>>2>(0|C)?f+(C<<2)|0:l,!((0|n)<0))break}if(n=0,!(l>>>0<=g>>>0||(n=m(E-g>>2,9),f=10,(p=s[g>>2])>>>0<10)))for(;n=n+1|0,p>>>0>=(f=m(f,10))>>>0;);if((0|(f=(v-(102==(0|T)?0:n)|0)-(103==(0|T)&0!=(0|v))|0))<(m(l-E>>2,9)-9|0)){if(y=((((0|y)<0?4:292)+c|0)+((b=(0|(p=f+9216|0))/9|0)<<2)|0)-4048|0,f=10,(0|(p=p-m(b,9)|0))<=7)for(;f=m(f,10),8!=(0|(p=p+1|0)););if(!(!(p=(b=s[y>>2])-m(f,C=(b>>>0)/(f>>>0)|0)|0)&(0|(A=y+4|0))==(0|l))&&(!(1&C)&&(t=9007199254740992,!(1&a[y-4|0])|1e9!=(0|f)|g>>>0>=y>>>0)||(t=9007199254740994),S=(0|l)==(0|A)?1:1.5,S=p>>>0<(A=f>>>1|0)>>>0?.5:(0|A)==(0|p)?S:1.5,45!=h[0|I]|x||(S=-S,t=-t),p=b-p|0,s[y>>2]=p,t+S!=t)){if(n=f+p|0,s[y>>2]=n,n>>>0>=1e9)for(;s[y>>2]=0,(y=y-4|0)>>>0<g>>>0&&(s[(g=g-4|0)>>2]=0),n=s[y>>2]+1|0,s[y>>2]=n,n>>>0>999999999;);if(n=m(E-g>>2,9),f=10,!((p=s[g>>2])>>>0<10))for(;n=n+1|0,p>>>0>=(f=m(f,10))>>>0;);}l=l>>>0>(f=y+4|0)>>>0?f:l}for(;f=l,!(p=l>>>0<=g>>>0)&&!s[(l=f-4|0)>>2];);if(103==(0|T)){if(v=((y=(0|(l=v||1))>(0|n)&(0|n)>-5)?-1^n:-1)+l|0,o=(y?-1:-2)+o|0,!(y=8&i)){if(l=-9,!p&&(b=s[f-4>>2])&&(p=10,l=0,!((b>>>0)%10|0))){for(;y=l,l=l+1|0,!((b>>>0)%((p=m(p,10))>>>0)|0););l=-1^y}p=m(f-E>>2,9),70!=(-33&o)?(y=0,v=(0|(l=(0|(l=((n+p|0)+l|0)-9|0))>0?l:0))>(0|v)?v:l):(y=0,v=(0|(l=(0|(l=(l+p|0)-9|0))>0?l:0))>(0|v)?v:l)}}else y=8&i;if(p=-1,(0|((T=y|v)?2147483645:2147483646))<(0|v))break e;if(b=1+((0!=(0|T))+v|0)|0,70!=(0|(A=-33&o))){if((k-(l=Ie(((l=n>>31)^n)-l|0,0,k))|0)<=1)for(;a[0|(l=l-1|0)]=48,(k-l|0)<2;);if(a[0|(C=l-2|0)]=o,a[l-1|0]=(0|n)<0?45:43,(0|(l=k-C|0))>(2147483647-b|0))break e}else{if((2147483647-b|0)<(0|n))break e;l=(0|n)>0?n:0}if((0|(n=l+b|0))>(2147483647^w))break e;Fe(e,32,r,o=n+w|0,i),fe(e,I,w),Fe(e,48,r,o,65536^i);r:{n:{i:{if(70==(0|A)){for(n=8|(l=c+16|0),y=9|l,g=p=g>>>0>E>>>0?E:g;;){l=Ie(s[g>>2],0,y);a:if((0|p)==(0|g))(0|l)==(0|y)&&(a[c+24|0]=48,l=n);else{if(c+16>>>0>=l>>>0)break a;for(;a[0|(l=l-1|0)]=48,c+16>>>0<l>>>0;);}if(fe(e,l,y-l|0),!(E>>>0>=(g=g+4|0)>>>0))break}if(T&&fe(e,2276,1),(0|v)<=0|f>>>0<=g>>>0)break i;for(;;){if((l=Ie(s[g>>2],0,y))>>>0>c+16>>>0)for(;a[0|(l=l-1|0)]=48,c+16>>>0<l>>>0;);if(fe(e,l,(0|v)<9?v:9),l=v-9|0,f>>>0<=(g=g+4|0)>>>0)break n;if(n=(0|v)>9,v=l,!n)break}break n}a:if(!((0|v)<0))for(p=f>>>0>g>>>0?f:g+4|0,n=8|(l=c+16|0),E=9|l,f=g;;){(0|E)==(0|(l=Ie(s[f>>2],0,E)))&&(a[c+24|0]=48,l=n);o:if((0|f)==(0|g))fe(e,l,1),l=l+1|0,y|v&&fe(e,2276,1);else{if(c+16>>>0>=l>>>0)break o;for(;a[0|(l=l-1|0)]=48,c+16>>>0<l>>>0;);}if(fe(e,$=l,(0|(l=E-l|0))>(0|v)?v:l),v=v-l|0,p>>>0<=(f=f+4|0)>>>0)break a;if(!((0|v)>=0))break}Fe(e,48,v+18|0,18,0),fe(e,C,k-C|0);break r}l=v}Fe(e,48,l+9|0,9,0)}Fe(e,32,r,o,8192^i),p=(0|r)<(0|o)?o:r;break e}if(v=(o<<26>>31&9)+I|0,!(n>>>0>11)){for(l=12-n|0,S=16;S*=16,l=l-1|0;);t=45!=h[0|v]?t+S-S:-(S+(-t-S))}for((0|k)==(0|(l=Ie(((l=(f=s[c+44>>2])>>31)^f)-l|0,0,k)))&&(a[c+15|0]=48,l=c+15|0),y=2|w,g=32&o,f=s[c+44>>2],a[0|(E=l-2|0)]=o+15,a[l-1|0]=(0|f)<0?45:43,p=8&i,f=c+16|0;o=f,l=_(t)<2147483648?~~t:-2147483648,a[0|f]=g|h[l+8240|0],!(p|(0|n)>0)&0==(t=16*(t-+(0|l)))|1!=((f=o+1|0)-(c+16|0)|0)||(a[o+1|0]=46,f=o+2|0),0!=t;);p=-1,(2147483645-(o=(b=k-E|0)+y|0)|0)<(0|n)||(Fe(e,32,r,n=(l=!n||((g=f-(c+16|0)|0)-2|0)>=(0|n)?g=f-(c+16|0)|0:n+2|0)+o|0,i),fe(e,v,y),Fe(e,48,r,n,65536^i),fe(e,c+16|0,g),Fe(e,48,l-g|0,0,0),fe(e,E,b),Fe(e,32,r,n,8192^i),p=(0|r)<(0|n)?n:r)}else Fe(e,32,r,n=w+3|0,-65537&i),fe(e,I,w),o&=32,fe(e,t!=t?o?1322:2154:o?1613:2158,3),Fe(e,32,r,n,8192^i),p=(0|r)<(0|n)?n:r;return N=c+560|0,0|p},function(e,t){e|=0;var r,n,i,a,o,u=0,d=0,h=0,f=0,p=0,g=0,m=0,v=0,_=0,b=0,A=0;d=t|=0,t=s[t>>2]+7&-8,s[d>>2]=t+16,i=e,v=s[(e=t)>>2],t=s[e+4>>2],n=h=s[e+12>>2],N=r=N-32|0;e:if((0|(u=(h&=2147483647)-1006698496|0))==(0|(f=h-1140785152|0))&(d=s[e+8>>2])>>>0<d>>>0|u>>>0<f>>>0){if(u=(e=d)<<4|t>>>28,h=d=n<<4|e>>>28,t=e=268435455&t,134217728==(0|e)&0!=(0|v)|e>>>0>134217728){e=h+1073741824|0,e=(t=u+1|0)?e:e+1|0,u=t;break e}if(e=h+1073741824|0,134217728^t|v)break e;e=(t=1&u)>>>0>(u=h=t+u|0)>>>0?e+1|0:e}else(!d&2147418112==(0|h)?!(t|v):h>>>0<2147418112)?(u=0,e=2146435072,h>>>0>1140785151||(e=0,(b=h>>>16|0)>>>0<15249||(u=v,e=t,h=f=65535&n|65536,_=d,p=d,64&(m=b-15233|0)?(f=u,u=31&(d=m+-64|0),(63&d)>>>0>=32?(e=f<<u,p=0):(e=(1<<u)-1&f>>>32-u|e<<u,p=f<<u),f=e,u=0,e=0):m&&(g=31&(d=m),(63&d)>>>0>=32?(d=p<<g,p=0):(d=(1<<g)-1&p>>>32-g|f<<g,p<<=g),f=d,A=p,p=u,g=31&(d=64-m|0),(63&d)>>>0>=32?(d=0,p=e>>>g|0):(d=e>>>g|0,p=((1<<g)-1&e)<<32-g|p>>>g),p|=A,f|=d,g=31&m,(63&m)>>>0>=32?(d=u<<g,u=0):(d=(1<<g)-1&u>>>32-g|e<<g,u<<=g),e=d),s[r+16>>2]=u,s[r+20>>2]=e,s[r+24>>2]=p,s[r+28>>2]=f,64&(d=15361-b|0)?(t=_,f=31&(e=d+-64|0),(63&e)>>>0>=32?(d=0,v=h>>>f|0):(d=h>>>f|0,v=((1<<f)-1&h)<<32-f|t>>>f),t=d,_=0,h=0):d&&(f=_,u=31&(e=64-d|0),(63&e)>>>0>=32?(e=f<<u,u=0):(e=(1<<u)-1&f>>>32-u|h<<u,u=f<<u),f=e,p=u,u=v,m=31&(e=d),(63&e)>>>0>=32?(d=0,t=t>>>m|0):(d=t>>>m|0,t=((1<<m)-1&t)<<32-m|u>>>m),v=p|t,t=d|f,d=_,f=31&e,(63&e)>>>0>=32?(e=0,_=h>>>f|0):(e=h>>>f|0,_=((1<<f)-1&h)<<32-f|d>>>f),h=e),s[r>>2]=v,s[r+4>>2]=t,s[r+8>>2]=_,s[r+12>>2]=h,u=(t=s[r+8>>2])<<4|(h=s[r+4>>2])>>>28,e=s[r+12>>2]<<4|t>>>28,134217728==(0|(h&=268435455))&0!=(0|(t=s[r>>2]|0!=(s[r+16>>2]|s[r+24>>2]|s[r+20>>2]|s[r+28>>2])))|h>>>0>134217728?(e=(t=u+1|0)?e:e+1|0,u=t):134217728^h|t||(e=(t=u+(1&u)|0)>>>0<u>>>0?e+1|0:e,u=t)))):(u=(e=d)<<4|t>>>28,e=524287&(d=n<<4|e>>>28)|2146959360);N=r+32|0,c(0,0|u),c(1,-2147483648&n|e),a=i,o=+l(),y[a>>3]=o},function(e){return 0|O(s[60+(e|=0)>>2])},function(e,t,r){e|=0,t|=0,r|=0;var n,i=0,o=0,u=0;N=n=N-32|0,s[n+16>>2]=t,i=s[e+48>>2],s[n+20>>2]=r-(0!=(0|i)),u=s[e+44>>2],s[n+28>>2]=i,s[n+24>>2]=u;e:{t:{if(Sr(0|R(s[e+60>>2],n+16|0,2,n+12|0)))t=32;else{if((0|(i=s[n+12>>2]))>0)break t;t=i?32:16}s[e>>2]=t|s[e>>2];break e}(u=s[n+20>>2])>>>0>=i>>>0?o=i:(o=s[e+44>>2],s[e+4>>2]=o,s[e+8>>2]=o+(i-u|0),s[e+48>>2]&&(s[e+4>>2]=o+1,a[(t+r|0)-1|0]=h[0|o]),o=r)}return N=n+32|0,0|o},function(e,t,r,n){var i;return t|=0,r|=0,n|=0,N=i=N-16|0,e=Sr(0|M(s[60+(e|=0)>>2],0|t,0|r,255&n,i+8|0)),N=i+16|0,G=e?-1:s[i+12>>2],0|(e?-1:s[i+8>>2])},Dn,Kn,ii,ii,function(e,t,r){r|=0;var n,i=0,a=0,o=0,u=0;if(N=n=N+-64|0,i=1,!we(e|=0,t|=0,0)&&(i=0,t)){N=i=N+-64|0,a=s[t>>2],o=s[a-4>>2],u=s[a-8>>2],s[i+20>>2]=0,s[i+16>>2]=8292,s[i+12>>2]=t,s[i+8>>2]=8340,a=0,ne(i+24|0,0,39),t=t+u|0;e:if(we(o,8340,0))s[i+56>>2]=1,oi[s[s[o>>2]+20>>2]](o,i+8|0,t,t,1,0),a=1==s[i+32>>2]?t:0;else{oi[s[s[o>>2]+24>>2]](o,i+8|0,t,1,0);t:switch(s[i+44>>2]){case 0:a=1==s[i+48>>2]&&1==s[i+36>>2]&&1==s[i+40>>2]?s[i+28>>2]:0;break e;case 1:break t;default:break e}1!=s[i+32>>2]&&s[i+48>>2]|1!=s[i+36>>2]|1!=s[i+40>>2]||(a=s[i+24>>2])}N=i- -64|0,i=0,a&&(ne(4|(t=n+8|0),0,52),s[n+56>>2]=1,s[n+20>>2]=-1,s[n+16>>2]=e,s[n+8>>2]=a,oi[s[s[a>>2]+28>>2]](a,t,s[r>>2],1),1==(0|(e=s[n+32>>2]))&&(s[r>>2]=s[n+24>>2]),i=1==(0|e))}return N=n- -64|0,0|i},function(e,t,r,n,i,a){r|=0,n|=0,i|=0,a|=0,we(e|=0,s[8+(t|=0)>>2],a)&&ve(t,r,n,i)},function(e,t,r,n,i){if(r|=0,n|=0,i|=0,we(e|=0,s[8+(t|=0)>>2],i))sr(t,r,n);else e:if(we(e,s[t>>2],i)){if(!(s[t+16>>2]!=(0|r)&s[t+20>>2]!=(0|r))){if(1!=(0|n))break e;return void(s[t+32>>2]=1)}s[t+20>>2]=r,s[t+32>>2]=n,s[t+40>>2]=s[t+40>>2]+1,1!=s[t+36>>2]|2!=s[t+24>>2]||(a[t+54|0]=1),s[t+44>>2]=4}},function(e,t,r,n){r|=0,n|=0,we(e|=0,s[8+(t|=0)>>2],0)&&Be(t,r,n)},Kn,function(e,t,r,n,i,a){r|=0,n|=0,i|=0,a|=0,we(e|=0,s[8+(t|=0)>>2],a)?ve(t,r,n,i):(e=s[e+8>>2],oi[s[s[e>>2]+20>>2]](e,t,r,n,i,a))},function(e,t,r,n,i){if(r|=0,n|=0,i|=0,we(e|=0,s[8+(t|=0)>>2],i))sr(t,r,n);else e:{if(we(e,s[t>>2],i)){if(!(s[t+16>>2]!=(0|r)&s[t+20>>2]!=(0|r))){if(1!=(0|n))break e;return void(s[t+32>>2]=1)}s[t+32>>2]=n;t:if(4!=s[t+44>>2]){if(o[t+52>>1]=0,e=s[e+8>>2],oi[s[s[e>>2]+20>>2]](e,t,r,r,1,i),h[t+53|0]){if(s[t+44>>2]=3,!h[t+52|0])break t;break e}s[t+44>>2]=4}if(s[t+20>>2]=r,s[t+40>>2]=s[t+40>>2]+1,1!=s[t+36>>2]|2!=s[t+24>>2])break e;return void(a[t+54|0]=1)}e=s[e+8>>2],oi[s[s[e>>2]+24>>2]](e,t,r,n,i)}},function(e,t,r,n){r|=0,n|=0,we(e|=0,s[8+(t|=0)>>2],0)?Be(t,r,n):(e=s[e+8>>2],oi[s[s[e>>2]+28>>2]](e,t,r,n))},Dn,Kn,function(e){return 1225},function(e){H(At(e|=0))},function(e){return s[4+(e|=0)>>2]},function(e){At(e|=0),H(e)}]).set=function(e,t){this[e]=t},ai.get=function(e){return this[e]},ai);function si(){return n.byteLength/65536|0}return{__wasm_call_ctors:function(){Pn(),s[2757]=10916,s[2739]=42},malloc:V,parseMPD:function(e){e|=0;var t,r,n,i=0,o=0,u=0,c=0,l=0,d=0,m=0,b=0,A=0,E=0,S=0,w=0,k=0,I=0,$=0,P=0,x=v(0),R=0,O=0;r=W(),N=t=N-240|0,Ct(l=r+520|0),wt(n=r+532|0),E=e,s[t+112>>2]=e,se(r,2919,t+112|0);e:if(!kn(z(S=Ge(t+176|0),e))&&be(S,1240)){if(an(A=Ve(S,1240))){if(lr(A))for(w=t+160|0,$=t+148|0;;){if(!(be(e=ct(A,b),2058)&&be(e,1266)&&be(e,1405)&&be(e,1898)&&be(e,1409)&&be(e,1121)&&be(e,2116))){se(r,4820,0);break e}o=Wr(i=t+128|0),xe(i,xt(On(e,2058))),m=+(0|Xt(On(e,1266)))/1e3,i=_(m)<2147483648?~~m:-2147483648,s[t+152>>2]=i,R=t,O=Xt(On(e,1405)),s[R+148>>2]=O,R=t,O=Xt(On(e,1409)),s[R+140>>2]=O,R=t,O=Xt(On(e,1121)),s[R+144>>2]=O;t:{r:{if(i=On(e,1898),(16&h[i+18|0])>>>4|0){if(512&(u=f[i+18>>1])){m=y[i>>3];break t}if(32&u){m=+s[i>>2];break t}if(64&u){m=+p[i>>2];break t}if(128&u){m=+p[i>>2]+4294967296*+s[i+4>>2];break t}if(!(256&u))break r;m=+p[i>>2]+4294967296*+p[i+4>>2];break t}C(2489,1415,1825,2020),T()}C(2241,1415,1830,2020),T()}if(g[t+156>>2]=m,xe(w,xt(On(e,2116))),N=d=N-32|0,R=d,O=Wt($),s[R+16>>2]=O,N=e=N-32|0,k=Ee(l,e+28|0,$),i=s[k>>2],a[e+27|0]=0,i||(N=c=N-16|0,i=Zn(l),P=yt(u=e+8|0,vt(64),Cr(c+8|0,i)),I=s[P>>2]+16|0,N=i=N-16|0,s[i+8>>2]=s[d+16>>2],s[I>>2]=s[s[i+8>>2]>>2],Wr(ne(I+4|0,0,44)),N=i+16|0,R=Zn(P),O=1,a[R+4|0]=O,N=c+16|0,ae(l,s[e+28>>2],k,s[u>>2]),i=_r(u),a[e+27|0]=1,c=s[u>>2],s[u>>2]=0,c&&(h[Zn(u)+4|0]&&qn(c+16|0),c&&H(c))),br(u=d+24|0,un(e+8|0,i),e+27|0),N=e+32|0,e=cn(u),N=d+32|0,ue(e=e+4|0,o),s[e+28>>2]=s[o+28>>2],i=s[o+24>>2],s[e+20>>2]=s[o+20>>2],s[e+24>>2]=i,i=s[o+16>>2],s[e+12>>2]=s[o+12>>2],s[e+16>>2]=i,ue(e+32|0,o+32|0),e=Tr(t+128|0),i=s[t+152>>2],u=s[t+148>>2],d=s[t+140>>2],c=s[t+144>>2],x=g[t+156>>2],R=t,O=Tr(w),s[R+96>>2]=O,y[t+88>>3]=x,s[t+80>>2]=c,s[t+76>>2]=d,s[t+72>>2]=u,s[t+68>>2]=i,s[t+64>>2]=e,se(r,2669,t- -64|0),Rn(o),b=b+1|0,!(lr(A)>>>0>b>>>0))break}if(s[r+548>>2]=5,$n(u=r+576|0),s[r+544>>2]=0,$n(d=r+552|0),$n(c=r+564|0),N=o=(N=e=N-16|0)-16|0,i=s[un(o+8|0,s[l>>2])>>2],N=o+16|0,o=s[un(e+8|0,i)>>2],N=e+16|0,s[(i=t+128|0)>>2]=o,R=t,O=gt(l),s[R+120>>2]=O,Yr(i,t+120|0))for(;;){if(R=r,O=s[cn(i)+28>>2],s[R+548>>2]=O,ie(u,cn(i)+24|0),s[r+544>>2]=s[r+544>>2]+1,ie(d,cn(i)+16|0),ie(c,cn(i)+20|0),e=s[r+548>>2],o=s[cn(i)+24>>2],b=s[cn(i)+16>>2],A=s[cn(i)+20>>2],s[t+48>>2]=s[r+544>>2],s[t+44>>2]=A,s[t+40>>2]=b,s[t+36>>2]=o,s[t+32>>2]=e,se(r,3359,t+32|0),e=s[i>>2],o=s[e+4>>2])for(e=o;o=e,e=s[e>>2];);else{if(!xr(e))for(;!xr(e=s[e+8>>2]););o=s[e+8>>2]}if(s[i>>2]=o,R=t,O=gt(l),s[R+120>>2]=O,!Yr(i,t+120|0))break}}if(!kn(z(S,E))&&be(S,1253)){if(an(d=Ve(S,1253))){if(lr(d))for($=r+596|0,A=t+152|0,c=t+140|0,b=0;;){if(!(be(e=ct(d,b),2058)&&be(e,1266)&&be(e,1405)&&be(e,1909)&&be(e,2116))){se(r,4872,0);break e}if(E=Hr(o=t+128|0),xe(o,xt(On(e,2058))),m=+(0|Xt(On(e,1266)))/1e3,o=_(m)<2147483648?~~m:-2147483648,s[t+144>>2]=o,R=t,O=Xt(On(e,1405)),s[R+140>>2]=O,R=t,O=Xt(On(e,1909)),s[R+148>>2]=O,xe(A,xt(On(e,2116))),N=l=N-32|0,R=l,O=Wt(c),s[R+16>>2]=O,N=e=N-32|0,I=Ee(n,e+28|0,c),i=s[I>>2],a[e+27|0]=0,i||(N=u=N-16|0,i=Zn(n),k=yt(o=e+8|0,vt(56),Cr(u+8|0,i)),w=s[k>>2]+16|0,N=i=N-16|0,s[i+8>>2]=s[l+16>>2],s[w>>2]=s[s[i+8>>2]>>2],Hr(ne(w+4|0,0,36)),N=i+16|0,R=Zn(k),O=1,a[R+4|0]=O,N=u+16|0,ae(n,s[e+28>>2],I,s[o>>2]),i=_r(o),a[e+27|0]=1,u=s[o>>2],s[o>>2]=0,u&&(h[Zn(o)+4|0]&&ti(u+16|0),u&&H(u))),br(o=l+24|0,un(e+8|0,i),e+27|0),N=e+32|0,e=cn(o),N=l+32|0,ue(e=e+4|0,E),s[e+20>>2]=s[E+20>>2],o=s[E+16>>2],s[e+12>>2]=s[E+12>>2],s[e+16>>2]=o,ue(e+24|0,E+24|0),s[r+592>>2]=s[t+144>>2],ie($,c),s[r+588>>2]=s[r+588>>2]+1,e=Tr(t+128|0),o=s[t+144>>2],i=s[t+140>>2],l=s[t+148>>2],R=t,O=Tr(A),s[R+16>>2]=O,s[t+12>>2]=l,s[t+8>>2]=i,s[t+4>>2]=o,s[t>>2]=e,se(r,2786,t),xn(E),b=b+1|0,!(lr(d)>>>0>b>>>0))break}or(bn(e=r+596|0),rn(e))}}else se(r,4567,0)}else se(r,4520,0);Le(S),N=t+240|0},updatePreloadInfo:function(e){e|=0;var t,r,n,i=0,a=0,o=0,u=0,c=0,l=0,d=0,h=0,f=0,p=0,g=0,y=0;n=W(),N=r=N-144|0,s[n+676>>2]=0,Qr(t=n+680|0),s[r+16>>2]=e,se(n,2884,r+16|0);e:if(!kn(z(c=Ge(r+80|0),e))&&be(c,1326)&&be(c,1140)){g=n,y=Xt(Ve(c,1326)),s[g+676>>2]=y;t:{if(an(d=Ve(c,1140))&&lr(d))for(;;){if(a=4716,!be(e=ct(d,h),1957))break t;if(!be(e,1944))break t;if(!be(e,1883))break t;if(!be(e,2009))break t;if(!be(e,1643))break t;if(!be(e,1214))break t;if(g=r,y=Xt(On(e,1957)),s[g+32>>2]=y,g=r,y=Xt(On(e,1944)),s[g+36>>2]=y,g=r,y=Xt(On(e,1883)),s[g+40>>2]=y,g=r,y=Xt(On(e,2009)),s[g+44>>2]=y,g=r,y=Xt(On(e,1643)),s[g+52>>2]=y,a=4768,!be(e=On(e,1214),1283))break t;if(!be(e,1634))break t;if(!be(e,1692))break t;if(!be(e,1662))break t;if(!be(e,1861))break t;if(!be(e,1838))break t;if(g=r,y=Xt(On(e,1283)),s[g+56>>2]=y,g=r,y=Xt(On(e,1634)),s[g+60>>2]=y,g=r,y=Xt(On(e,1692)),s[g+64>>2]=y,g=r,y=Xt(On(e,1662)),s[g+68>>2]=y,g=r,y=Xt(On(e,1861)),s[g+72>>2]=y,g=r,y=Xt(On(e,1838)),s[g+76>>2]=y,l=r+32|0,s[t+4>>2]==s[Wn(t)>>2]){if(N=f=N-32|0,p=Wn(t),i=f+8|0,u=wr(t)+1|0,N=e=N-16|0,s[e+12>>2]=u,N=o=N-16|0,s[o+12>>2]=89478485,s[o+8>>2]=2147483647,a=s[Yt(o+12|0,o+8|0)>>2],N=o+16|0,a>>>0>=u>>>0?((o=Ar(t))>>>0<a>>>1>>>0&&(s[e+8>>2]=o<<1,a=s[zt(e+8|0,e+12|0)>>2]),N=e+16|0,e=a):(Jn(),T()),u=wr(t),a=0,N=o=N-16|0,s[o+12>>2]=0,dn(i+12|0,p),e&&(e>>>0>89478485&&(je(1742),T()),a=vt(m(e,48))),s[i>>2]=a,u=m(u,48)+a|0,s[i+8>>2]=u,s[i+4>>2]=u,g=jn(i),y=m(e,48)+a|0,s[g>>2]=y,N=o+16|0,Nn(p,s[i+8>>2],l),s[i+8>>2]=s[i+8>>2]+48,En(t),e=i+4|0,l=s[t>>2],a=s[t+4>>2]-l|0,o=s[e>>2]+m((0|a)/-48|0,48)|0,s[e>>2]=o,(0|a)>0&&J(o,l,a),kt(t,e),kt(t+4|0,i+8|0),kt(Wn(t),jn(i)),s[i>>2]=s[i+4>>2],wr(t),Ar(t),Ar(t),(0|(e=s[i+4>>2]))!=s[i+8>>2])for(;s[i+8>>2]=s[i+8>>2]-48,(0|e)!=s[i+8>>2];);s[i>>2]&&H(e=s[i>>2]),N=f+32|0}else N=e=N-16|0,s[e>>2]=t,a=s[t+4>>2],s[e+4>>2]=a,s[e+8>>2]=a+48,Nn(Wn(t),s[e+4>>2],l),s[e+4>>2]=s[e+4>>2]+48,Kr(e),N=e+16|0;if(h=h+1|0,!(lr(d)>>>0>h>>>0))break}e=s[n+676>>2],g=r,y=wr(t),s[g+4>>2]=y,s[r>>2]=e,se(n,3772,r);break e}se(n,a,0)}else se(n,4471,0);Le(c),N=r+144|0},updateDeviceInfo:function(e,t,r,n){e|=0,t|=0,r=v(r),n=v(n);var i,a,o=0;i=W(),N=a=N-32|0,(0|e)<=0|(0|t)<=0||(s[i+152>>2]=t,s[i+148>>2]=e,s[i+144>>2]=t,s[i+140>>2]=e,(o=+r)>2.01?s[i+196>>2]=1073741824:o<.01?s[i+196>>2]=1065353216:g[i+196>>2]=r),n>v(0)&&(g[i+200>>2]=n),y[a+16>>3]=n,s[a+4>>2]=t,s[a>>2]=e,y[a+8>>3]=r,se(i,3013,a),N=a+32|0},updateMediaInfo:function(e,t,r,n){e|=0,t|=0,r=+r,n=+n;var i,a,o,u=0,c=0,l=0,d=0,h=0,f=0;if(N=i=N-96|0,a=hn(i+56|0),o=It(i+40|0),y[a+16>>3]=n,y[a+8>>3]=r,s[a>>2]=t,(0|t)>0)for(;ie(o,(u<<2)+e|0),(0|(u=u+1|0))!=(0|t););if(or(bn(o),rn(o)),(0|(e=a+24|0))!=(0|o)){N=t=N-16|0,u=(l=s[o+4>>2])-(c=s[o>>2])>>2;e:if($r(e)>>>0>=u>>>0){if(Dr(e)>>>0<u>>>0){s[t+12>>2]=c,d=Dr(e),s[t+12>>2]=s[t+12>>2]+(d<<2),rr(c,s[t+12>>2],s[e>>2]),ut(e,s[t+12>>2],l,u-Dr(e)|0);break e}tn(e,rr(c,l,s[e>>2]))}else s[e>>2]&&($n(e),d=s[e>>2],$r(e),H(d),h=Wn(e),f=0,s[h>>2]=f,s[e>>2]=0,s[e+4>>2]=0),lt(e,ze(e,u)),ut(e,c,l,u);N=t+16|0}if(e=W(),t=s[a+4>>2],s[i>>2]=s[a>>2],s[i+4>>2]=t,t=s[a+20>>2],s[i+16>>2]=s[a+16>>2],s[i+20>>2]=t,t=s[a+12>>2],s[i+8>>2]=s[a+8>>2],s[i+12>>2]=t,t=a+24|0,N=u=(N=l=N-16|0)-16|0,s[(c=i+24|0)>>2]=0,s[c+4>>2]=0,s[u+12>>2]=0,ei(c+8|0),N=u+16|0,(u=Dr(t))&&(lt(c,u),ut(c,s[t>>2],s[t+4>>2],u)),u=0,N=t=(N=l+16|0)-16|0,se(e,2637,0),y[e+456>>3]=y[i+8>>3],y[e+464>>3]=y[i+16>>3],s[e+448>>2]=s[i>>2],$n(c=e+472|0),Dr(l=i+24|0))for(;ie(c,Xr(l,u)),h=t,f=s[Xr(c,u)>>2],s[h>>2]=f,se(e,2633,t),u=u+1|0,Dr(l)>>>0>u>>>0;);se(e,5010,0),s[e+248>>2]=0,s[e+252>>2]=0,s[e+240>>2]=0,s[e+244>>2]=0,s[e+232>>2]=0,s[e+236>>2]=0,s[e+224>>2]=0,s[e+228>>2]=0,N=t+16|0,Qn(i),qt(o),Qn(a),N=i+96|0},updateBufferInfo:function(e,t,r,n,i,a,o,u,c){e=v(e),t=v(t),r=v(r),n=v(n),i=v(i),a|=0,o|=0,u=v(u),c|=0;var l,d,h=0,f=0,p=0;N=l=N-128|0,h=W(),g[l+104>>2]=t,g[l+112>>2]=+v(_(e))<=1e-6?v(1):e,a=(d=m(a,8e3))>>31,s[l+120>>2]=d,s[l+124>>2]=a,s[l+56>>2]=d,s[l+60>>2]=a,g[l+108>>2]=r,a=s[l+108>>2],s[l+40>>2]=s[l+104>>2],s[l+44>>2]=a,a=s[l+116>>2],s[l+48>>2]=s[l+112>>2],s[l+52>>2]=a,g[l+100>>2]=i,g[l+96>>2]=n,a=s[l+100>>2],s[l+32>>2]=s[l+96>>2],s[l+36>>2]=a,e=g[l+48>>2],+v(_(e))<=1e-6&&(s[l+48>>2]=1065353216,e=v(1)),y[h+224>>3]=g[l+32>>2],y[h+232>>3]=g[l+36>>2],g[h+76>>2]=g[l+40>>2],t=g[l+44>>2],g[h+72>>2]=t,y[h+288>>3]=v(t*g[h+80>>2]),y[h+272>>3]=v(t*g[h+84>>2]),y[h+280>>3]=v(t*g[h+88>>2]),y[h+376>>3]=+t/20*3,a=s[l+60>>2],s[h+24>>2]=s[l+56>>2],s[h+28>>2]=a,g[h+180>>2]=e,a=W(),s[l+80>>2]=o,g[l+88>>2]=u,s[l+72>>2]=-1,s[l+76>>2]=-1,s[l+8>>2]=-1,s[l+12>>2]=-1,s[l+84>>2]=c,o=s[l+84>>2],s[l+16>>2]=s[l+80>>2],s[l+20>>2]=o,o=s[l+92>>2],s[l+24>>2]=s[l+88>>2],s[l+28>>2]=o,s[l+64>>2]=-1,o=s[l+68>>2],s[l>>2]=s[l+64>>2],s[l+4>>2]=o,N=c=N-16|0,s[a+92>>2]=s[l+16>>2],e=g[l+24>>2],v(_(e))<v(0x8000000000000000)?(h=v(_(e))>=v(1)?~~(e>v(0)?v(A(v(E(v(e*v(2.3283064365386963e-10)))),v(4294967296))):v(S(v(v(e-v(~~e>>>0>>>0))*v(2.3283064365386963e-10)))))>>>0:0,o=~~e>>>0):(h=-2147483648,o=0),s[a+64>>2]=o,s[a+68>>2]=h,s[a+96>>2]=s[l+20>>2],ie(o=a+656|0,a+96|0),Dr(o)>>>0>=61&&(f=c,p=bn(o),s[f+8>>2]=p,h=s[Lr(c,c+8|0)>>2],N=a=N-16|0,s[a+8>>2]=h,f=a,p=bn(o),s[f>>2]=p,tn(o,rr((h=s[o>>2]+(s[a+8>>2]-s[a>>2]>>2<<2)|0)+4|0,s[o+4>>2],h)),Zt(h),N=a+16|0),N=c+16|0,N=l+128|0},updateSwitchInfo:function(e,t,r,n,i,o){e|=0,t|=0,r=v(r),n|=0,i=v(i),o=v(o);var u,c,l,d=v(0);N=c=N-80|0,u=W(),g[c+76>>2]=o,g[c+72>>2]=i,s[c+68>>2]=1061158912,s[c+60>>2]=1045220557,s[c+64>>2]=1053609165,g[c+56>>2]=r,a[c+52|0]=n,s[c+48>>2]=50,s[(n=c)+40>>2]=e,s[n+44>>2]=t,n=J(n,n+40|0,40),r=g[n+20>>2],+v(_(r))<=1e-6&&(s[n+20>>2]=1045220557,r=v(.20000000298023224)),i=g[n+24>>2],+v(_(i))<=1e-6&&(s[n+24>>2]=1053609165,i=v(.4000000059604645)),o=g[n+28>>2],+v(_(o))<=1e-6&&(s[n+28>>2]=1061158912,o=v(.75)),d=g[n+16>>2],+v(_(d))<=1e-6&&(s[n+16>>2]=1084227584,d=v(5)),e=s[n+4>>2],s[u+32>>2]=s[n>>2],s[u+36>>2]=e,e=t=s[n+8>>2],s[u+40>>2]=e,s[u+44>>2]=e>>31,e=h[n+12|0],s[u+188>>2]=1084227584,a[u+174|0]=e,g[u+184>>2]=d,d=v(0|t),y[u+288>>3]=v(r*d),g[u+88>>2]=o,g[u+84>>2]=i,g[u+80>>2]=r,y[u+280>>3]=v(o*d),l=+v(i*d),y[u+272>>3]=l,s[u+132>>2]=4,s[u+136>>2]=2,s[u+124>>2]=12,s[u+128>>2]=5,y[u+376>>3]=+(0|t)/20*3,s[u+360>>2]=-687194767,s[u+364>>2]=-1077055325,s[u+336>>2]=-1717986918,s[u+340>>2]=1072273817,s[u+328>>2]=858993459,s[u+332>>2]=1072902963,s[u+320>>2]=-858993459,s[u+324>>2]=1072483532,s[u+116>>2]=10,s[u+120>>2]=10,a[u+173|0]=0,y[u+368>>3]=l+12,s[u+64>>2]=0,s[u+68>>2]=0,s[u+92>>2]=0,N=n+80|0},updatePreloadSupplier:function(e,t){var r,n,i;e|=0,t|=0,N=r=N-16|0,n=W(),s[r+12>>2]=t,s[r+8>>2]=m(e,8e3),e=s[r+12>>2],s[r>>2]=s[r+8>>2],s[r+4>>2]=e,N=e=N-16|0,t=s[r>>2],s[n+668>>2]=t,i=s[r+4>>2],s[n+672>>2]=i,s[e+4>>2]=i,s[e>>2]=t,se(n,3983,e),N=e+16|0,N=r+16|0},getPredictedBitrate:function(e,t){e|=0,t|=0;var r,n=0,i=0,o=0,u=0,c=0,l=0,d=v(0),f=0,b=0,T=v(0),w=0,C=0,k=0,I=0,$=v(0),P=v(0),x=0,R=0,O=0,D=0,L=0,M=0,B=v(0),U=v(0),V=v(0),F=0,j=0,H=0,Z=0,K=0,X=0,Y=0,z=0,J=0,Q=0,q=0;if(n=W(),N=r=N-48|0,i=He(),u=s[n+36>>2],o=s[n+32>>2],s[n+8>>2]=i-o,s[n+12>>2]=G-((i>>>0<o>>>0)+u|0),l=y[n+256>>3],d=g[n+72>>2],c=s[n+28>>2],s[(i=r)+32>>2]=s[n+24>>2],s[i+36>>2]=c,y[i+24>>3]=d,y[i+16>>3]=l,s[i+8>>2]=t,s[i>>2]=o,s[i+4>>2]=u,se(n,4924,i),d=g[n+196>>2],T=v(d*v(s[n+148>>2])),t=v(_(T))<v(2147483648)?~~T:-2147483648,s[n+140>>2]=t,d=v(d*v(s[n+152>>2])),t=v(_(d))<v(2147483648)?~~d:-2147483648,s[n+144>>2]=t,N=t=N-160|0,f=ke(t+144|0,1189),i=He(),o=s[n+32>>2],u=G-(s[n+36>>2]+(o>>>0>i>>>0)|0)|0,o=i-o|0,s[n+8>>2]=o,s[n+12>>2]=u,i=-1,(b=o>>>0<(c=m(s[n+548>>2],1e3)-2e3|0)>>>0)&(0|u)<=(0|(o=c>>31))|(0|o)>(0|u)){if(wr(i=n+680|0)&&-1!=s[Er(i)+44>>2]&&-1!=(0|(i=s[Er(i)+8>>2])))s[t+96>>2]=i,se(n,4047,t+96|0);else{if(o=-1,(0|(c=s[n+544>>2]))<=0)u=-1;else{i=0;e:{for(;;){if((0|e)>=0){u=s[ur(n+576|0,0)>>2],c=s[n+544>>2];break e}if((0|(i=i+1|0))==(0|c))break}u=-1}if(!((0|c)<2))for(c=n+576|0,C=(0|e)<0,i=1;C||y[n+336>>3]*+s[n+24>>2]>+s[ur(c,i)>>2]&&(o=s[ur(c,i)>>2]),(0|(i=i+1|0))<s[n+544>>2];);}i=(0|o)>(0|u)?o:u}i=h[n+176|0]&&s[n+168>>2]>1?e:i,u=de(n,s[n+140>>2],s[n+144>>2]),s[n+108>>2]=u,(0|u)>0&&(i=me(n,i,u)),s[n+100>>2]=e,y[n+256>>3]=y[n+232>>3],Te(u=n+644|0,n+256|0),Or(u)>>>0>p[n+120>>2]&&(J=t,Q=bn(u),s[J+128>>2]=Q,Xe(u,s[Lr(t+136|0,t+128|0)>>2])),J=n,q=$e(n),y[J+264>>3]=q,s[t+128>>2]=e,s[t+132>>2]=e>>31,fr(u=n+620|0,t+128|0),Or(u)>>>0>s[n+116>>2]<<1>>>0&&(J=t,Q=bn(u),s[J+128>>2]=Q,Xe(u,s[Lr(t+120|0,t+128|0)>>2])),(o=s[n+24>>2])>>>0<40001&(0|(u=s[n+28>>2]))<=0|(0|u)<0||(d=v(v(+(o>>>0)+4294967296*+(0|u))/g[n+180>>2]),v(_(d))<v(0x8000000000000000)?(o=v(_(d))>=v(1)?~~(d>v(0)?v(A(v(E(v(d*v(2.3283064365386963e-10)))),v(4294967296))):v(S(v(v(d-v(~~d>>>0>>>0))*v(2.3283064365386963e-10)))))>>>0:0,u=~~d>>>0):(o=-2147483648,u=0),s[t+128>>2]=u,s[t+132>>2]=o,dr(u=n+608|0,t+128|0),Or(u)>>>0<=p[n+124>>2]||(J=t,Q=bn(u),s[J+112>>2]=Q,Xe(u,s[Lr(t+104|0,t+112|0)>>2]))),u=Tr(f),o=He(),c=s[n+24>>2],C=s[n+28>>2],b=s[n+48>>2],k=s[n+52>>2],l=y[n+256>>3],w=s[n+92>>2],D=s[n+64>>2],L=s[n+68>>2],M=h[n+176|0],s[t+84>>2]=s[n+168>>2],s[t+80>>2]=M,s[t+72>>2]=D,s[t+76>>2]=L,s[t- -64>>2]=w,s[t+56>>2]=0,s[t+60>>2]=0,s[t+48>>2]=0,s[t+52>>2]=0,y[t+40>>3]=l,s[t+36>>2]=e,s[t+32>>2]=i,s[t+24>>2]=b,s[t+28>>2]=k,s[t+16>>2]=c,s[t+20>>2]=C,s[t+8>>2]=o,s[t+12>>2]=G,s[t>>2]=u,se(n,3113,t)}if(mr(f),N=t+160|0,t=i,-1==(0|i)){if(i=0,N=o=N-336|0,C=ke(o+320|0,1086),u=He(),t=e,s[n+100>>2]=e,y[n+256>>3]=y[n+232>>3],e=s[n+32>>2],c=G-(s[n+36>>2]+(e>>>0>u>>>0)|0)|0,s[n+8>>2]=u-e,s[n+12>>2]=c,Te(e=n+644|0,n+256|0),Or(e)>>>0>p[n+120>>2]&&(J=o,Q=bn(e),s[J+304>>2]=Q,Xe(e,s[Lr(o+312|0,o+304|0)>>2])),J=n,q=$e(n),y[J+264>>3]=q,y[n+256>>3]<.1&&(s[n+156>>2]=s[n+156>>2]+1),1==s[n+96>>2]&&(s[n+160>>2]=s[n+160>>2]+1),N=e=N-16|0,J=e,Q=Gt(c=n+656|0),s[J+8>>2]=Q,J=e,Q=Ut(c),s[J>>2]=Q,St(e+8|0,e))for(;N=u=N-16|0,f=e+8|0,s[u+8>>2]=s[f>>2],b=s[Br(u+8|0)>>2],N=u+16|0,u=s[b>>2],Br(f),J=e,Q=Ut(c),s[J>>2]=Q,i=(1==(0|u))+i|0,St(f,e););if(N=e+16|0,s[n+164>>2]=i,s[o+304>>2]=t,k=t>>31,s[o+308>>2]=k,fr(f=n+620|0,o+304|0),Or(f)>>>0>s[n+116>>2]<<1>>>0&&(J=o,Q=bn(f),s[J+304>>2]=Q,Xe(f,s[Lr(o+296|0,o+304|0)>>2])),(i=s[n+24>>2])>>>0<40001&(0|(e=s[n+28>>2]))<=0|(0|e)<0||(d=v(v(+(i>>>0)+4294967296*+(0|e))/g[n+180>>2]),v(_(d))<v(0x8000000000000000)?(i=v(_(d))>=v(1)?~~(d>v(0)?v(A(v(E(v(d*v(2.3283064365386963e-10)))),v(4294967296))):v(S(v(v(d-v(~~d>>>0>>>0))*v(2.3283064365386963e-10)))))>>>0:0,e=~~d>>>0):(i=-2147483648,e=0),s[o+304>>2]=e,s[o+308>>2]=i,dr(e=n+608|0,o+304|0),Or(e)>>>0<=p[n+124>>2]||(J=o,Q=bn(e),s[J+288>>2]=Q,Xe(e,s[Lr(o+280|0,o+288|0)>>2]))),s[o+304>>2]=0,s[o+308>>2]=0,-1!=(s[n+56>>2]&s[n+60>>2])&&Or(e=n+608|0)){if(e=Gr(e,Or(e)-1|0),i=s[e>>2],w=s[e+4>>2],u=s[n+56>>2],e=s[n+60>>2]-(w+(i>>>0>u>>>0)|0)|0,u=u-i|0,u^=c=e>>31,y[o+304>>3]=(+(u-c>>>0)+4294967296*+((e^c)-((u>>>0<c>>>0)+c|0)|0))/(+(i>>>0)+4294967296*+(0|w)),Te(e=n+632|0,o+304|0),Or(e)>>>0>p[n+128>>2]&&(J=o,Q=bn(e),s[J+288>>2]=Q,Xe(e,s[Lr(o+272|0,o+288|0)>>2])),i=bn(e),u=rn(e),N=e=N-32|0,s[e+16>>2]=u,s[e+24>>2]=i,Yr(e+24|0,e+16|0)&&(s[e>>2]=s[e+24>>2],Yr(Nr(e),e+16|0)))for(;y[s[e+24>>2]>>3]<y[s[e>>2]>>3]&&(s[e+24>>2]=s[e>>2]),Yr(Nr(e),e+16|0););N=e+32|0,s[o+288>>2]=s[e+24>>2],l=y[s[o+288>>2]>>3],l=(+(le(n)>>>0)+4294967296*+(0|G))/(l+1),_(l)<0x8000000000000000?(i=_(l)>=1?~~(l>0?A(E(2.3283064365386963e-10*l),4294967295):S(2.3283064365386963e-10*(l-+(~~l>>>0>>>0))))>>>0:0,e=~~l>>>0):(i=-2147483648,e=0),s[n+48>>2]=e,s[n+52>>2]=i}else J=n,Q=le(n),s[J+48>>2]=Q,s[n+52>>2]=G,Te(n+632|0,o+304|0),e=s[n+48>>2],i=s[n+52>>2];s[n+56>>2]=e,s[n+60>>2]=i,(i=s[n+92>>2])&&(e=s[n+12>>2],u=s[n+8>>2],s[n+16>>2]=u,s[n+20>>2]=e,s[o+252>>2]=1,s[o+248>>2]=i,s[o+240>>2]=u,s[o+244>>2]=e,se(n,3680,o+240|0));e:{t:if(!(e=s[n+16>>2])&(0|(i=s[n+20>>2]))<=0|(0|i)<0||!(+((u=s[n+8>>2])-e>>>0)+4294967296*+((c=s[n+12>>2])-((e>>>0>u>>>0)+i|0)|0)<8e3)){h[n+172|0]&&(a[n+172|0]=0),l=y[n+312>>3],e=s[n+164>>2],x=y[n+304>>3],R=y[n+296>>3],i=Tr(C),O=21-(O=21-l)/(l=+(0|e)+1),y[o+232>>3]=O,R=31-(31-R)/l,y[o+224>>3]=R,s[o+208>>2]=i,x=41-(41-x)/l,y[o+216>>3]=x,se(n,2950,o+208|0);r:{n:{i:{if((l=y[n+256>>3])<O){if(e=s[n+544>>2]<=0,l=y[n+336>>3]*+s[n+48>>2],u=_(l)<2147483648?~~l:-2147483648,e)break i;if(e=0,(0|u)<s[ur(c=n+576|0,0)>>2])break i;for(;;){if(i=s[ur(c,e)>>2],(0|(e=e+1|0))>=s[n+544>>2])break n;if(!((0|u)>=s[ur(c,e)>>2]))break}break n}u=s[n+48>>2],i=s[n+52>>2];a:{if(l<R){if(e=t,u>>>0<1001&(0|i)<=0|(0|i)<0)break e;if(l=y[n+320>>3]*(+(u>>>0)+4294967296*+(0|i)),!(_(l)<2147483648))break a;i=~~l;break r}if(e=t,!(l>=x)|u>>>0<1001&(0|i)<=0|(0|i)<0|s[n+544>>2]<=0)break e;for(i=n+576|0,e=0;;){if((0|t)<s[ur(i,e)>>2]){e=s[ur(i,e)>>2],u=i=s[n+48>>2],c=e,i=(b=e>>>0<i>>>0)&(0|(i=s[n+52>>2]))>=(0|(e>>=31))|(0|e)<(0|i)?u:c;break r}if(!((0|(e=e+1|0))<s[n+544>>2]))break}break t}i=-2147483648;break r}i=u}if((0|i)>(0|(e=t)))break e}if(e=t,-1==(0|i))break e;if(s[n+544>>2]<=0)u=-1;else for(b=n+576|0,e=2147483647,u=-1;(0|(c=((c=(w=i-s[ur(b,I)>>2]|0)>>31)^w)-c|0))<(0|e)&&(u=s[ur(b,I)>>2],e=c),(0|(I=I+1|0))<s[n+544>>2];);if((0|t)>=(0|(e=u)))break e;if(!Or(f))break e;J=o,Q=Gt(f),s[J+288>>2]=Q,J=o,Q=Ut(f),s[J+264>>2]=Q,i=0;r:if(St(o+288|0,o+264|0))for(;;){if(N=u=N-16|0,s[u+8>>2]=s[o+288>>2],c=s[Ur(u+8|0)>>2],N=u+16|0,(0|t)!=s[c>>2]|(0|k)!=s[c+4>>2])break r;if(Ur(u=o+288|0),J=o,Q=Ut(f),s[J+264>>2]=Q,i=i+1|0,!St(u,o+264|0))break}if(!(s[n+132>>2]>(0|i)||+s[n+548>>2]>=y[n+256>>3]/+g[n+180>>2]))break e}else s[o+192>>2]=s[n+92>>2],s[o+184>>2]=e,s[o+188>>2]=i,s[o+176>>2]=u,s[o+180>>2]=c,se(n,4614,o+176|0);e=t}i=de(n,s[n+140>>2],s[n+144>>2]),s[n+108>>2]=i,(0|i)>0&&(e=me(n,e,i)),(0|(c=ot(n,t)))<=(0|(u=ot(n,e)))|(c-u|0)<3?i=u:(e=dt(n,i=c-2|0),f=Tr(C),s[o+168>>2]=i,s[o+164>>2]=u,s[o+160>>2]=f,se(n,2068,o+160|0)),u=Tr(C),f=s[n+548>>2],I=s[n+8>>2],b=s[n+12>>2],d=g[n+72>>2],T=g[n+180>>2],$=g[n+188>>2],P=g[n+204>>2],B=g[n+208>>2],U=g[n+212>>2],V=g[n+216>>2],l=y[n+256>>3],k=s[n+24>>2],w=s[n+28>>2],D=s[n+48>>2],L=s[n+52>>2],M=s[n+156>>2],F=s[n+92>>2],j=s[n+64>>2],H=s[n+68>>2],Z=s[n+20>>2],K=s[n+16>>2],X=s[n+96>>2],Y=s[n+164>>2],z=s[n+160>>2],s[o+156>>2]=i,s[o+152>>2]=c,s[o+112>>2]=z,s[o+108>>2]=Y,s[o+104>>2]=X,s[o+96>>2]=K,s[o+100>>2]=Z,s[o+88>>2]=j,s[o+92>>2]=H,s[o+72>>2]=F,s[o+68>>2]=M,s[o- -64>>2]=f,s[o+56>>2]=D,s[o+60>>2]=L,s[o+48>>2]=k,s[o+52>>2]=w,s[o+44>>2]=e,s[o+40>>2]=t,y[o+16>>3]=l,y[o+144>>3]=V,y[o+136>>3]=U,y[o+128>>3]=B,y[o+120>>3]=P,y[o+80>>3]=$,y[o+32>>3]=T,y[o+24>>3]=d,s[o+8>>2]=I,s[o+12>>2]=b,s[o>>2]=u,se(n,4102,o),s[n+104>>2]=e,t=s[n+12>>2],s[n>>2]=s[n+8>>2],s[n+4>>2]=t,y[n+248>>3]=y[n+232>>3],y[n+240>>3]=y[n+224>>3],mr(C),N=o+336|0,t=e}return N=r+48|0,e=W(),d=v(+p[e+48>>2]+4294967296*+s[e+52>>2]),T=g[W()+204>>2],$=g[W()+208>>2],P=v(g[W()+212>>2]*v(100)),n=v(_(P))<v(2147483648)?~~P:-2147483648,P=g[W()+216>>2],e=vt(28),s[e+20>>2]=n,$=v($*v(100)),i=v(_($))<v(2147483648)?~~$:-2147483648,s[e+16>>2]=i,T=v(T*v(100)),i=v(_(T))<v(2147483648)?~~T:-2147483648,s[e+12>>2]=i,i=v(_(d))<v(2147483648)?~~d:-2147483648,s[e+8>>2]=i,s[e+4>>2]=0,s[e>>2]=t,d=v(P*v(100)),t=v(_(d))<v(2147483648)?~~d:-2147483648,s[e+24>>2]=t,0|e},getPreloadBitrate:function(e){var t,r,n,i,a;return e|=0,N=t=N-32|0,n=W(),N=r=N-48|0,s[t+24>>2]=0,s[t+8>>2]=-1,s[t+12>>2]=-1,s[t+16>>2]=-1,s[t+20>>2]=2,i=s[n+672>>2],a=s[n+668>>2],s[r>>2]=e,s[r+4>>2]=a,s[r+8>>2]=i,se(n,3909,r),te(r+24|0,n,e||0),s[t+24>>2]=s[r+40>>2],e=s[r+36>>2],s[t+16>>2]=s[r+32>>2],s[t+20>>2]=e,e=s[r+28>>2],s[t+8>>2]=s[r+24>>2],s[t+12>>2]=e,N=r+48|0,e=vt(20),s[e>>2]=s[t+8>>2],s[e+4>>2]=s[t+12>>2],s[e+8>>2]=s[t+24>>2],s[e+12>>2]=s[t+16>>2],s[e+16>>2]=s[t+20>>2],N=t+32|0,0|e},setDebugModel:function(e){var t,r;e|=0,t=W(),r=e,a[t+174|0]=r},__indirect_function_table:oi,free:H,__errno_location:function(){return 10880},__stdio_exit:function(){var e=0;if(e=s[2719])for(;Ke(e),e=s[e+56>>2];);Ke(s[2238]),Ke(s[2200]),Ke(s[2276])},emscripten_stack_init:Pn,emscripten_stack_get_free:function(){return N-B|0},emscripten_stack_get_base:function(){return 0|U},emscripten_stack_get_end:function(){return 0|B},stackSave:function(){return 0|N},stackRestore:function(e){N=e|=0},stackAlloc:function(e){return N=e=N-(e|=0)&-16,0|e},dynCall_jiji:function(e,t,r,n,i){return t|=0,r|=0,n|=0,i|=0,e=0|oi[0|(e|=0)](t,r,n,i),L(0|G),0|e}}}(e)}(Ie)},instantiate:function(e,t){return{then:function(t){var r=new A.Module(e);return t({instance:new A.Instance(r)}),{catch:function(){}}}}},RuntimeError:Error};v=[],"object"!=_typeof(A)&&ee("no native wasm support detected");var E=!1;function S(e,t){e||ee("Assertion failed"+(t?": "+t:""))}function T(e,t,r,n,i){var o={string:function(e){var t=0;if(null!=e&&0!==e){var r=1+(e.length<<2);D(e,t=Me(r),r)}return t},array:function(e){var t=Me(e.length);return M(e,t),t}};var s=function(e){var t=a["_"+e];return S(t,"Cannot call unknown function "+e+", make sure it is exported"),t}(e),u=[],c=0;if(S("array"!==t,'Return type should not be "array".'),n)for(var l=0;l<n.length;l++){var d=o[r[l]];d?(0===c&&(c=De()),u[l]=d(n[l])):u[l]=n[l]}var h,f=s.apply(null,u);return h=f,0!==c&&Le(c),f=function(e){return"string"===t?R(e):"boolean"===t?Boolean(e):e}(h),f}var w,C,k,I,$,P="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function x(e,t,r){for(var n=t+r,i=t;e[i]&&!(i>=n);)++i;if(i-t>16&&e.subarray&&P)return P.decode(e.subarray(t,i));for(var a="";t<i;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var u=63&e[t++];if(224==(240&o)?o=(15&o)<<12|s<<6|u:(240!=(248&o)&&f("Invalid UTF-8 leading byte 0x"+o.toString(16)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!"),o=(7&o)<<18|s<<12|u<<6|63&e[t++]),o<65536)a+=String.fromCharCode(o);else{var c=o-65536;a+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else a+=String.fromCharCode((31&o)<<6|s)}else a+=String.fromCharCode(o)}return a}function R(e,t){return e?x(k,e,t):""}function O(e,t,r,n){if(!(n>0))return 0;for(var i=r,a=r+n-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343)s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o);if(s<=127){if(r>=a)break;t[r++]=s}else if(s<=2047){if(r+1>=a)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=a)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+3>=a)break;s>1114111&&f("Invalid Unicode code point 0x"+s.toString(16)+" encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF)."),t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-i}function D(e,t,r){return S("number"==typeof r,"stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),O(e,k,t,r)}function L(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),n<=127?++t:t+=n<=2047?2:n<=65535?3:4}return t}function M(e,t){S(e.length>=0,"writeArrayToMemory array must have a length (should be an array or typed array)"),C.set(e,t)}function N(e){w=e,a.HEAP8=C=new Int8Array(e),a.HEAP16=new Int16Array(e),a.HEAP32=I=new Int32Array(e),a.HEAPU8=k=new Uint8Array(e),a.HEAPU16=new Uint16Array(e),a.HEAPU32=$=new Uint32Array(e),a.HEAPF32=new Float32Array(e),a.HEAPF64=new Float64Array(e)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var B=8192;a.TOTAL_STACK&&S(B===a.TOTAL_STACK,"the stack size can no longer be determined at runtime");var U,G=a.INITIAL_MEMORY||65536;function V(){var e=Oe();S(0==(3&e)),I[e>>2]=34821223,I[e+4>>2]=2310721022,I[0]=1668509029}function F(){if(!E){var e=Oe(),t=$[e>>2],r=$[e+4>>2];34821223==t&&2310721022==r||ee("Stack overflow! Stack cookie has been overwritten, expected hex dwords 0x89BACDFE and 0x2135467, but received 0x"+r.toString(16)+" 0x"+t.toString(16)),1668509029!==I[0]&&ee("Runtime error: The application has corrupted its heap memory area (address zero)!")}}p("INITIAL_MEMORY","INITIAL_MEMORY"),S(G>=B,"INITIAL_MEMORY should be larger than TOTAL_STACK, was "+G+"! (TOTAL_STACK="+"8192)"),S("undefined"!=typeof Int32Array&&"undefined"!=typeof Float64Array&&null!=Int32Array.prototype.subarray&&null!=Int32Array.prototype.set,"JS engine does not provide full typed array support"),(b=a.wasmMemory?a.wasmMemory:new A.Memory({initial:G/65536,maximum:32768}))&&(w=b.buffer),S((G=w.byteLength)%65536==0),N(w),function(){var e=new Int16Array(1),t=new Int8Array(e.buffer);if(e[0]=25459,115!==t[0]||99!==t[1])throw"Runtime error: expected the system to be little-endian! (Run with -s SUPPORT_BIG_ENDIAN=1 to bypass)"}();var j=[],H=[],Z=[],W=!1;S(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),S(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),S(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),S(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var K=0,X=null,Y=null,z={};function J(e){for(var t=e;;){if(!z[e])return e;e=t+Math.random()}}function Q(e){K++,a.monitorRunDependencies&&a.monitorRunDependencies(K),e?(S(!z[e]),z[e]=1,null===X&&"undefined"!=typeof setInterval&&(X=setInterval((function(){if(E)return clearInterval(X),void(X=null);var e=!1;for(var t in z)e||(e=!0,h("still waiting on run dependencies:")),h("dependency: "+t);e&&h("(end of list)")}),1e4))):h("warning: run dependency added without ID")}function q(e){if(K--,a.monitorRunDependencies&&a.monitorRunDependencies(K),e?(S(z[e]),delete z[e]):h("warning: run dependency removed without ID"),0==K&&(null!==X&&(clearInterval(X),X=null),Y)){var t=Y;Y=null,t()}}function ee(e){a.onAbort&&a.onAbort(e),h(e="Aborted("+e+")"),E=!0;var t=new A.RuntimeError(e);throw i(t),t}a.preloadedImages={},a.preloadedAudios={};var te,re,ne,ie,ae="data:application/octet-stream;base64,";function oe(e){return e.startsWith(ae)}function se(e,t){return function(){var r=e,n=t;return t||(n=a.asm),S(W,"native function `"+r+"` called before runtime initialization"),S(!0,"native function `"+r+"` called after runtime exit (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n[e]||S(n[e],"exported native function `"+r+"` not found"),n[e].apply(null,arguments)}}function ue(e){try{if(e==te&&v)return new Uint8Array(v);var t=ke(e);if(t)return t;throw"both async and sync fetching of the wasm failed"}catch(r){ee(r)}}function ce(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?de(r)():de(r)(t.arg):r(void 0===t.arg?null:t.arg)}else t(a)}}function le(e){return e.replace(/\b_Z[\w\d_]+/g,(function(e){var t,r=(t=e,f("warning: build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),t);return e===r?e:r+" ["+e+"]"}))}function de(e){return U.get(e)}function he(e){this.excPtr=e,this.ptr=e-16,this.set_type=function(e){I[this.ptr+4>>2]=e},this.get_type=function(){return I[this.ptr+4>>2]},this.set_destructor=function(e){I[this.ptr+8>>2]=e},this.get_destructor=function(){return I[this.ptr+8>>2]},this.set_refcount=function(e){I[this.ptr>>2]=e},this.set_caught=function(e){e=e?1:0,C[this.ptr+12>>0]=e},this.get_caught=function(){return 0!=C[this.ptr+12>>0]},this.set_rethrown=function(e){e=e?1:0,C[this.ptr+13>>0]=e},this.get_rethrown=function(){return 0!=C[this.ptr+13>>0]},this.init=function(e,t){this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=I[this.ptr>>2];I[this.ptr>>2]=e+1},this.release_ref=function(){var e=I[this.ptr>>2];return I[this.ptr>>2]=e-1,S(e>0),1===e}}function fe(t){try{return b.grow(t-w.byteLength+65535>>>16),N(b.buffer),1}catch(e){h("emscripten_realloc_buffer: Attempted to grow heap from "+w.byteLength+" bytes to "+t+" bytes, but got error: "+e)}}oe(te="index.wasm")||(re=te,te=a.locateFile?a.locateFile(re,c):c+re);var pe={splitPath:function(e){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1)},normalizeArray:function(e,t){for(var r=0,n=e.length-1;n>=0;n--){var i=e[n];"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r;r--)e.unshift("..");return e},normalize:function(e){var t="/"===e.charAt(0),r="/"===e.substr(-1);return(e=pe.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e},dirname:function(e){var t=pe.splitPath(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},basename:function(e){if("/"===e)return"/";var t=(e=(e=pe.normalize(e)).replace(/\/$/,"")).lastIndexOf("/");return-1===t?e:e.substr(t+1)},extname:function(e){return pe.splitPath(e)[3]},join:function(){var e=Array.prototype.slice.call(arguments,0);return pe.normalize(e.join("/"))},join2:function(e,t){return pe.normalize(e+"/"+t)}};var ge={resolve:function(){for(var e="",t=!1,r=arguments.length-1;r>=-1&&!t;r--){var n=r>=0?arguments[r]:be.cwd();if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";e=n+"/"+e,t="/"===n.charAt(0)}return(t?"/":"")+(e=pe.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"))||"."},relative:function(e,t){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=ge.resolve(e).substr(1),t=ge.resolve(t).substr(1);for(var n=r(e.split("/")),i=r(t.split("/")),a=Math.min(n.length,i.length),o=a,s=0;s<a;s++)if(n[s]!==i[s]){o=s;break}var u=[];for(s=o;s<n.length;s++)u.push("..");return(u=u.concat(i.slice(o))).join("/")}},ye={ttys:[],init:function(){},shutdown:function(){},register:function(e,t){ye.ttys[e]={input:[],output:[],ops:t},be.registerDevice(e,ye.stream_ops)},stream_ops:{open:function(e){var t=ye.ttys[e.node.rdev];if(!t)throw new be.ErrnoError(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.ops.flush(e.tty)},flush:function(e){e.tty.ops.flush(e.tty)},read:function(t,r,n,i,a){if(!t.tty||!t.tty.ops.get_char)throw new be.ErrnoError(60);for(var o=0,s=0;s<i;s++){var u;try{u=t.tty.ops.get_char(t.tty)}catch(e){throw new be.ErrnoError(29)}if(void 0===u&&0===o)throw new be.ErrnoError(6);if(null==u)break;o++,r[n+s]=u}return o&&(t.node.timestamp=Date.now()),o},write:function(t,r,n,i,a){if(!t.tty||!t.tty.ops.put_char)throw new be.ErrnoError(60);try{for(var o=0;o<i;o++)t.tty.ops.put_char(t.tty,r[n+o])}catch(e){throw new be.ErrnoError(29)}return i&&(t.node.timestamp=Date.now()),o}},default_tty_ops:{get_char:function(e){if(!e.input.length){var t=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n"),!t)return null;e.input=we(t,!0)}return e.input.shift()},put_char:function(e,t){null===t||10===t?(d(x(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(d(x(e.output,0)),e.output=[])}},default_tty1_ops:{put_char:function(e,t){null===t||10===t?(h(x(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(h(x(e.output,0)),e.output=[])}}};var me={ops_table:null,mount:function(e){return me.createNode(null,"/",16895,0)},createNode:function(e,t,r,n){if(be.isBlkdev(r)||be.isFIFO(r))throw new be.ErrnoError(63);me.ops_table||(me.ops_table={dir:{node:{getattr:me.node_ops.getattr,setattr:me.node_ops.setattr,lookup:me.node_ops.lookup,mknod:me.node_ops.mknod,rename:me.node_ops.rename,unlink:me.node_ops.unlink,rmdir:me.node_ops.rmdir,readdir:me.node_ops.readdir,symlink:me.node_ops.symlink},stream:{llseek:me.stream_ops.llseek}},file:{node:{getattr:me.node_ops.getattr,setattr:me.node_ops.setattr},stream:{llseek:me.stream_ops.llseek,read:me.stream_ops.read,write:me.stream_ops.write,allocate:me.stream_ops.allocate,mmap:me.stream_ops.mmap,msync:me.stream_ops.msync}},link:{node:{getattr:me.node_ops.getattr,setattr:me.node_ops.setattr,readlink:me.node_ops.readlink},stream:{}},chrdev:{node:{getattr:me.node_ops.getattr,setattr:me.node_ops.setattr},stream:be.chrdev_stream_ops}});var i=be.createNode(e,t,r,n);return be.isDir(i.mode)?(i.node_ops=me.ops_table.dir.node,i.stream_ops=me.ops_table.dir.stream,i.contents={}):be.isFile(i.mode)?(i.node_ops=me.ops_table.file.node,i.stream_ops=me.ops_table.file.stream,i.usedBytes=0,i.contents=null):be.isLink(i.mode)?(i.node_ops=me.ops_table.link.node,i.stream_ops=me.ops_table.link.stream):be.isChrdev(i.mode)&&(i.node_ops=me.ops_table.chrdev.node,i.stream_ops=me.ops_table.chrdev.stream),i.timestamp=Date.now(),e&&(e.contents[t]=i,e.timestamp=i.timestamp),i},getFileDataAsTypedArray:function(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage:function(e,t){var r=e.contents?e.contents.length:0;if(!(r>=t)){t=Math.max(t,r*(r<1048576?2:1.125)>>>0),0!=r&&(t=Math.max(t,256));var n=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(n.subarray(0,e.usedBytes),0)}},resizeFileStorage:function(e,t){if(e.usedBytes!=t)if(0==t)e.contents=null,e.usedBytes=0;else{var r=e.contents;e.contents=new Uint8Array(t),r&&e.contents.set(r.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t}},node_ops:{getattr:function(e){var t={};return t.dev=be.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,be.isDir(e.mode)?t.size=4096:be.isFile(e.mode)?t.size=e.usedBytes:be.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&me.resizeFileStorage(e,t.size)},lookup:function(e,t){throw be.genericErrors[44]},mknod:function(e,t,r,n){return me.createNode(e,t,r,n)},rename:function(t,r,n){if(be.isDir(t.mode)){var i;try{i=be.lookupNode(r,n)}catch(e){}if(i)for(var a in i.contents)throw new be.ErrnoError(55)}delete t.parent.contents[t.name],t.parent.timestamp=Date.now(),t.name=n,r.contents[n]=t,r.timestamp=t.parent.timestamp,t.parent=r},unlink:function(e,t){delete e.contents[t],e.timestamp=Date.now()},rmdir:function(e,t){var r=be.lookupNode(e,t);for(var n in r.contents)throw new be.ErrnoError(55);delete e.contents[t],e.timestamp=Date.now()},readdir:function(e){var t=[".",".."];for(var r in e.contents)e.contents.hasOwnProperty(r)&&t.push(r);return t},symlink:function(e,t,r){var n=me.createNode(e,t,41471,0);return n.link=r,n},readlink:function(e){if(!be.isLink(e.mode))throw new be.ErrnoError(28);return e.link}},stream_ops:{read:function(e,t,r,n,i){var a=e.node.contents;if(i>=e.node.usedBytes)return 0;var o=Math.min(e.node.usedBytes-i,n);if(S(o>=0),o>8&&a.subarray)t.set(a.subarray(i,i+o),r);else for(var s=0;s<o;s++)t[r+s]=a[i+s];return o},write:function(e,t,r,n,i,a){if(S(!(t instanceof ArrayBuffer)),t.buffer===C.buffer&&(a=!1),!n)return 0;var o=e.node;if(o.timestamp=Date.now(),t.subarray&&(!o.contents||o.contents.subarray)){if(a)return S(0===i,"canOwn must imply no weird position inside the file"),o.contents=t.subarray(r,r+n),o.usedBytes=n,n;if(0===o.usedBytes&&0===i)return o.contents=t.slice(r,r+n),o.usedBytes=n,n;if(i+n<=o.usedBytes)return o.contents.set(t.subarray(r,r+n),i),n}if(me.expandFileStorage(o,i+n),o.contents.subarray&&t.subarray)o.contents.set(t.subarray(r,r+n),i);else for(var s=0;s<n;s++)o.contents[i+s]=t[r+s];return o.usedBytes=Math.max(o.usedBytes,i+n),n},llseek:function(e,t,r){var n=t;if(1===r?n+=e.position:2===r&&be.isFile(e.node.mode)&&(n+=e.node.usedBytes),n<0)throw new be.ErrnoError(28);return n},allocate:function(e,t,r){me.expandFileStorage(e.node,t+r),e.node.usedBytes=Math.max(e.node.usedBytes,t+r)},mmap:function(e,t,r,n,i,a){if(0!==t)throw new be.ErrnoError(28);if(!be.isFile(e.node.mode))throw new be.ErrnoError(43);var o,s,u=e.node.contents;if(2&a||u.buffer!==w){if((n>0||n+r<u.length)&&(u=u.subarray?u.subarray(n,n+r):Array.prototype.slice.call(u,n,n+r)),s=!0,!(o=void ee("internal error: mmapAlloc called but `emscripten_builtin_memalign` native symbol not exported")))throw new be.ErrnoError(48);C.set(u,o)}else s=!1,o=u.byteOffset;return{ptr:o,allocated:s}},msync:function(e,t,r,n,i){if(!be.isFile(e.node.mode))throw new be.ErrnoError(43);return 2&i||me.stream_ops.write(e,t,0,n,r,!1),0}}};var ve={0:"Success",1:"Arg list too long",2:"Permission denied",3:"Address already in use",4:"Address not available",5:"Address family not supported by protocol family",6:"No more processes",7:"Socket already connected",8:"Bad file number",9:"Trying to read unreadable message",10:"Mount device busy",11:"Operation canceled",12:"No children",13:"Connection aborted",14:"Connection refused",15:"Connection reset by peer",16:"File locking deadlock error",17:"Destination address required",18:"Math arg out of domain of func",19:"Quota exceeded",20:"File exists",21:"Bad address",22:"File too large",23:"Host is unreachable",24:"Identifier removed",25:"Illegal byte sequence",26:"Connection already in progress",27:"Interrupted system call",28:"Invalid argument",29:"I/O error",30:"Socket is already connected",31:"Is a directory",32:"Too many symbolic links",33:"Too many open files",34:"Too many links",35:"Message too long",36:"Multihop attempted",37:"File or path name too long",38:"Network interface is not configured",39:"Connection reset by network",40:"Network is unreachable",41:"Too many open files in system",42:"No buffer space available",43:"No such device",44:"No such file or directory",45:"Exec format error",46:"No record locks available",47:"The link has been severed",48:"Not enough core",49:"No message of desired type",50:"Protocol not available",51:"No space left on device",52:"Function not implemented",53:"Socket is not connected",54:"Not a directory",55:"Directory not empty",56:"State not recoverable",57:"Socket operation on non-socket",59:"Not a typewriter",60:"No such device or address",61:"Value too large for defined data type",62:"Previous owner died",63:"Not super-user",64:"Broken pipe",65:"Protocol error",66:"Unknown protocol",67:"Protocol wrong type for socket",68:"Math result not representable",69:"Read only file system",70:"Illegal seek",71:"No such process",72:"Stale file handle",73:"Connection timed out",74:"Text file busy",75:"Cross-device link",100:"Device not a stream",101:"Bad font file fmt",102:"Invalid slot",103:"Invalid request code",104:"No anode",105:"Block device required",106:"Channel number out of range",107:"Level 3 halted",108:"Level 3 reset",109:"Link number out of range",110:"Protocol driver not attached",111:"No CSI structure available",112:"Level 2 halted",113:"Invalid exchange",114:"Invalid request descriptor",115:"Exchange full",116:"No data (for no delay io)",117:"Timer expired",118:"Out of streams resources",119:"Machine is not on the network",120:"Package not installed",121:"The object is remote",122:"Advertise error",123:"Srmount error",124:"Communication error on send",125:"Cross mount point (not really error)",126:"Given log. name not unique",127:"f.d. invalid for this operation",128:"Remote address changed",129:"Can   access a needed shared lib",130:"Accessing a corrupted shared lib",131:".lib section in a.out corrupted",132:"Attempting to link in too many libs",133:"Attempting to exec a shared library",135:"Streams pipe error",136:"Too many users",137:"Socket type not supported",138:"Not supported",139:"Protocol family not supported",140:"Can't send after socket shutdown",141:"Too many references",142:"Host is down",148:"No medium (in tape drive)",156:"Level 2 not synchronized"},_e={},be={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(e=ge.resolve(be.cwd(),e)))return{path:"",node:null};var r={follow_mount:!0,recurse_count:0};if((t=Object.assign(r,t)).recurse_count>8)throw new be.ErrnoError(32);for(var n=pe.normalizeArray(e.split("/").filter((function(e){return!!e})),!1),i=be.root,a="/",o=0;o<n.length;o++){var s=o===n.length-1;if(s&&t.parent)break;if(i=be.lookupNode(i,n[o]),a=pe.join2(a,n[o]),be.isMountpoint(i)&&(!s||s&&t.follow_mount)&&(i=i.mounted.root),!s||t.follow)for(var u=0;be.isLink(i.mode);){var c=be.readlink(a);a=ge.resolve(pe.dirname(a),c);var l=be.lookupPath(a,{recurse_count:t.recurse_count+1});if(i=l.node,u++>40)throw new be.ErrnoError(32)}}return{path:a,node:i}},getPath:function(e){for(var t;;){if(be.isRoot(e)){var r=e.mount.mountpoint;return t?"/"!==r[r.length-1]?r+"/"+t:r+t:r}t=t?e.name+"/"+t:e.name,e=e.parent}},hashName:function(e,t){for(var r=0,n=0;n<t.length;n++)r=(r<<5)-r+t.charCodeAt(n)|0;return(e+r>>>0)%be.nameTable.length},hashAddNode:function(e){var t=be.hashName(e.parent.id,e.name);e.name_next=be.nameTable[t],be.nameTable[t]=e},hashRemoveNode:function(e){var t=be.hashName(e.parent.id,e.name);if(be.nameTable[t]===e)be.nameTable[t]=e.name_next;else for(var r=be.nameTable[t];r;){if(r.name_next===e){r.name_next=e.name_next;break}r=r.name_next}},lookupNode:function(e,t){var r=be.mayLookup(e);if(r)throw new be.ErrnoError(r,e);for(var n=be.hashName(e.id,t),i=be.nameTable[n];i;i=i.name_next){var a=i.name;if(i.parent.id===e.id&&a===t)return i}return be.lookup(e,t)},createNode:function(e,t,r,n){S("object"==_typeof(e));var i=new be.FSNode(e,t,r,n);return be.hashAddNode(i),i},destroyNode:function(e){be.hashRemoveNode(e)},isRoot:function(e){return e===e.parent},isMountpoint:function(e){return!!e.mounted},isFile:function(e){return 32768==(61440&e)},isDir:function(e){return 16384==(61440&e)},isLink:function(e){return 40960==(61440&e)},isChrdev:function(e){return 8192==(61440&e)},isBlkdev:function(e){return 24576==(61440&e)},isFIFO:function(e){return 4096==(61440&e)},isSocket:function(e){return 49152==(49152&e)},flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:function(e){var t=be.flagModes[e];if(void 0===t)throw new Error("Unknown file open mode: "+e);return t},flagsToPermissionString:function(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:function(e,t){return be.ignorePermissions||(!t.includes("r")||292&e.mode)&&(!t.includes("w")||146&e.mode)&&(!t.includes("x")||73&e.mode)?0:2},mayLookup:function(e){var t=be.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate:function(t,r){try{be.lookupNode(t,r);return 20}catch(e){}return be.nodePermissions(t,"wx")},mayDelete:function(t,r,n){var i;try{i=be.lookupNode(t,r)}catch(e){return e.errno}var a=be.nodePermissions(t,"wx");if(a)return a;if(n){if(!be.isDir(i.mode))return 54;if(be.isRoot(i)||be.getPath(i)===be.cwd())return 10}else if(be.isDir(i.mode))return 31;return 0},mayOpen:function(e,t){return e?be.isLink(e.mode)?32:be.isDir(e.mode)&&("r"!==be.flagsToPermissionString(t)||512&t)?31:be.nodePermissions(e,be.flagsToPermissionString(t)):44},MAX_OPEN_FDS:4096,nextfd:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:be.MAX_OPEN_FDS,r=e;r<=t;r++)if(!be.streams[r])return r;throw new be.ErrnoError(33)},getStream:function(e){return be.streams[e]},createStream:function(e,t,r){be.FSStream||(be.FSStream=function(){},be.FSStream.prototype={object:{get:function(){return this.node},set:function(e){this.node=e}},isRead:{get:function(){return 1!=(2097155&this.flags)}},isWrite:{get:function(){return 0!=(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}}}),e=Object.assign(new be.FSStream,e);var n=be.nextfd(t,r);return e.fd=n,be.streams[n]=e,e},closeStream:function(e){be.streams[e]=null},chrdev_stream_ops:{open:function(e){var t=be.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open&&e.stream_ops.open(e)},llseek:function(){throw new be.ErrnoError(70)}},major:function(e){return e>>8},minor:function(e){return 255&e},makedev:function(e,t){return e<<8|t},registerDevice:function(e,t){be.devices[e]={stream_ops:t}},getDevice:function(e){return be.devices[e]},getMounts:function(e){for(var t=[],r=[e];r.length;){var n=r.pop();t.push(n),r.push.apply(r,n.mounts)}return t},syncfs:function(e,t){"function"==typeof e&&(t=e,e=!1),be.syncFSRequests++,be.syncFSRequests>1&&h("warning: "+be.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var r=be.getMounts(be.root.mount),n=0;function i(e){return S(be.syncFSRequests>0),be.syncFSRequests--,t(e)}function a(e){if(e)return a.errored?void 0:(a.errored=!0,i(e));++n>=r.length&&i(null)}r.forEach((function(t){if(!t.type.syncfs)return a(null);t.type.syncfs(t,e,a)}))},mount:function(e,t,r){if("string"==typeof e)throw e;var n,i="/"===r,a=!r;if(i&&be.root)throw new be.ErrnoError(10);if(!i&&!a){var o=be.lookupPath(r,{follow_mount:!1});if(r=o.path,n=o.node,be.isMountpoint(n))throw new be.ErrnoError(10);if(!be.isDir(n.mode))throw new be.ErrnoError(54)}var s={type:e,opts:t,mountpoint:r,mounts:[]},u=e.mount(s);return u.mount=s,s.root=u,i?be.root=u:n&&(n.mounted=s,n.mount&&n.mount.mounts.push(s)),u},unmount:function(e){var t=be.lookupPath(e,{follow_mount:!1});if(!be.isMountpoint(t.node))throw new be.ErrnoError(28);var r=t.node,n=r.mounted,i=be.getMounts(n);Object.keys(be.nameTable).forEach((function(e){for(var t=be.nameTable[e];t;){var r=t.name_next;i.includes(t.mount)&&be.destroyNode(t),t=r}})),r.mounted=null;var a=r.mount.mounts.indexOf(n);S(-1!==a),r.mount.mounts.splice(a,1)},lookup:function(e,t){return e.node_ops.lookup(e,t)},mknod:function(e,t,r){var n=be.lookupPath(e,{parent:!0}).node,i=pe.basename(e);if(!i||"."===i||".."===i)throw new be.ErrnoError(28);var a=be.mayCreate(n,i);if(a)throw new be.ErrnoError(a);if(!n.node_ops.mknod)throw new be.ErrnoError(63);return n.node_ops.mknod(n,i,t,r)},create:function(e,t){return t=void 0!==t?t:438,t&=4095,t|=32768,be.mknod(e,t,0)},mkdir:function(e,t){return t=void 0!==t?t:511,t&=1023,t|=16384,be.mknod(e,t,0)},mkdirTree:function(t,r){for(var n=t.split("/"),i="",a=0;a<n.length;++a)if(n[a]){i+="/"+n[a];try{be.mkdir(i,r)}catch(e){if(20!=e.errno)throw e}}},mkdev:function(e,t,r){return void 0===r&&(r=t,t=438),t|=8192,be.mknod(e,t,r)},symlink:function(e,t){if(!ge.resolve(e))throw new be.ErrnoError(44);var r=be.lookupPath(t,{parent:!0}).node;if(!r)throw new be.ErrnoError(44);var n=pe.basename(t),i=be.mayCreate(r,n);if(i)throw new be.ErrnoError(i);if(!r.node_ops.symlink)throw new be.ErrnoError(63);return r.node_ops.symlink(r,n,e)},rename:function(t,r){var n,i,a=pe.dirname(t),o=pe.dirname(r),s=pe.basename(t),u=pe.basename(r);if(n=be.lookupPath(t,{parent:!0}).node,i=be.lookupPath(r,{parent:!0}).node,!n||!i)throw new be.ErrnoError(44);if(n.mount!==i.mount)throw new be.ErrnoError(75);var c,l=be.lookupNode(n,s),d=ge.relative(t,o);if("."!==d.charAt(0))throw new be.ErrnoError(28);if("."!==(d=ge.relative(r,a)).charAt(0))throw new be.ErrnoError(55);try{c=be.lookupNode(i,u)}catch(e){}if(l!==c){var h=be.isDir(l.mode),f=be.mayDelete(n,s,h);if(f)throw new be.ErrnoError(f);if(f=c?be.mayDelete(i,u,h):be.mayCreate(i,u))throw new be.ErrnoError(f);if(!n.node_ops.rename)throw new be.ErrnoError(63);if(be.isMountpoint(l)||c&&be.isMountpoint(c))throw new be.ErrnoError(10);if(i!==n&&(f=be.nodePermissions(n,"w")))throw new be.ErrnoError(f);be.hashRemoveNode(l);try{n.node_ops.rename(l,i,u)}catch(e){throw e}finally{be.hashAddNode(l)}}},rmdir:function(e){var t=be.lookupPath(e,{parent:!0}).node,r=pe.basename(e),n=be.lookupNode(t,r),i=be.mayDelete(t,r,!0);if(i)throw new be.ErrnoError(i);if(!t.node_ops.rmdir)throw new be.ErrnoError(63);if(be.isMountpoint(n))throw new be.ErrnoError(10);t.node_ops.rmdir(t,r),be.destroyNode(n)},readdir:function(e){var t=be.lookupPath(e,{follow:!0}).node;if(!t.node_ops.readdir)throw new be.ErrnoError(54);return t.node_ops.readdir(t)},unlink:function(e){var t=be.lookupPath(e,{parent:!0}).node;if(!t)throw new be.ErrnoError(44);var r=pe.basename(e),n=be.lookupNode(t,r),i=be.mayDelete(t,r,!1);if(i)throw new be.ErrnoError(i);if(!t.node_ops.unlink)throw new be.ErrnoError(63);if(be.isMountpoint(n))throw new be.ErrnoError(10);t.node_ops.unlink(t,r),be.destroyNode(n)},readlink:function(e){var t=be.lookupPath(e).node;if(!t)throw new be.ErrnoError(44);if(!t.node_ops.readlink)throw new be.ErrnoError(28);return ge.resolve(be.getPath(t.parent),t.node_ops.readlink(t))},stat:function(e,t){var r=be.lookupPath(e,{follow:!t}).node;if(!r)throw new be.ErrnoError(44);if(!r.node_ops.getattr)throw new be.ErrnoError(63);return r.node_ops.getattr(r)},lstat:function(e){return be.stat(e,!0)},chmod:function(e,t,r){var n;"string"==typeof e?n=be.lookupPath(e,{follow:!r}).node:n=e;if(!n.node_ops.setattr)throw new be.ErrnoError(63);n.node_ops.setattr(n,{mode:4095&t|-4096&n.mode,timestamp:Date.now()})},lchmod:function(e,t){be.chmod(e,t,!0)},fchmod:function(e,t){var r=be.getStream(e);if(!r)throw new be.ErrnoError(8);be.chmod(r.node,t)},chown:function(e,t,r,n){var i;"string"==typeof e?i=be.lookupPath(e,{follow:!n}).node:i=e;if(!i.node_ops.setattr)throw new be.ErrnoError(63);i.node_ops.setattr(i,{timestamp:Date.now()})},lchown:function(e,t,r){be.chown(e,t,r,!0)},fchown:function(e,t,r){var n=be.getStream(e);if(!n)throw new be.ErrnoError(8);be.chown(n.node,t,r)},truncate:function(e,t){if(t<0)throw new be.ErrnoError(28);var r;"string"==typeof e?r=be.lookupPath(e,{follow:!0}).node:r=e;if(!r.node_ops.setattr)throw new be.ErrnoError(63);if(be.isDir(r.mode))throw new be.ErrnoError(31);if(!be.isFile(r.mode))throw new be.ErrnoError(28);var n=be.nodePermissions(r,"w");if(n)throw new be.ErrnoError(n);r.node_ops.setattr(r,{size:t,timestamp:Date.now()})},ftruncate:function(e,t){var r=be.getStream(e);if(!r)throw new be.ErrnoError(8);if(0==(2097155&r.flags))throw new be.ErrnoError(28);be.truncate(r.node,t)},utime:function(e,t,r){var n=be.lookupPath(e,{follow:!0}).node;n.node_ops.setattr(n,{timestamp:Math.max(t,r)})},open:function(t,r,n,i,o){if(""===t)throw new be.ErrnoError(44);var s;if(n=void 0===n?438:n,n=64&(r="string"==typeof r?be.modeStringToFlags(r):r)?4095&n|32768:0,"object"==_typeof(t))s=t;else{t=pe.normalize(t);try{s=be.lookupPath(t,{follow:!(131072&r)}).node}catch(e){}}var u=!1;if(64&r)if(s){if(128&r)throw new be.ErrnoError(20)}else s=be.mknod(t,n,0),u=!0;if(!s)throw new be.ErrnoError(44);if(be.isChrdev(s.mode)&&(r&=-513),65536&r&&!be.isDir(s.mode))throw new be.ErrnoError(54);if(!u){var c=be.mayOpen(s,r);if(c)throw new be.ErrnoError(c)}512&r&&be.truncate(s,0),r&=-131713;var l=be.createStream({node:s,path:be.getPath(s),flags:r,seekable:!0,position:0,stream_ops:s.stream_ops,ungotten:[],error:!1},i,o);return l.stream_ops.open&&l.stream_ops.open(l),!a.logReadFiles||1&r||(be.readFiles||(be.readFiles={}),t in be.readFiles||(be.readFiles[t]=1)),l},close:function(t){if(be.isClosed(t))throw new be.ErrnoError(8);t.getdents&&(t.getdents=null);try{t.stream_ops.close&&t.stream_ops.close(t)}catch(e){throw e}finally{be.closeStream(t.fd)}t.fd=null},isClosed:function(e){return null===e.fd},llseek:function(e,t,r){if(be.isClosed(e))throw new be.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new be.ErrnoError(70);if(0!=r&&1!=r&&2!=r)throw new be.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,r),e.ungotten=[],e.position},read:function(e,t,r,n,i){if(n<0||i<0)throw new be.ErrnoError(28);if(be.isClosed(e))throw new be.ErrnoError(8);if(1==(2097155&e.flags))throw new be.ErrnoError(8);if(be.isDir(e.node.mode))throw new be.ErrnoError(31);if(!e.stream_ops.read)throw new be.ErrnoError(28);var a=void 0!==i;if(a){if(!e.seekable)throw new be.ErrnoError(70)}else i=e.position;var o=e.stream_ops.read(e,t,r,n,i);return a||(e.position+=o),o},write:function(e,t,r,n,i,a){if(n<0||i<0)throw new be.ErrnoError(28);if(be.isClosed(e))throw new be.ErrnoError(8);if(0==(2097155&e.flags))throw new be.ErrnoError(8);if(be.isDir(e.node.mode))throw new be.ErrnoError(31);if(!e.stream_ops.write)throw new be.ErrnoError(28);e.seekable&&1024&e.flags&&be.llseek(e,0,2);var o=void 0!==i;if(o){if(!e.seekable)throw new be.ErrnoError(70)}else i=e.position;var s=e.stream_ops.write(e,t,r,n,i,a);return o||(e.position+=s),s},allocate:function(e,t,r){if(be.isClosed(e))throw new be.ErrnoError(8);if(t<0||r<=0)throw new be.ErrnoError(28);if(0==(2097155&e.flags))throw new be.ErrnoError(8);if(!be.isFile(e.node.mode)&&!be.isDir(e.node.mode))throw new be.ErrnoError(43);if(!e.stream_ops.allocate)throw new be.ErrnoError(138);e.stream_ops.allocate(e,t,r)},mmap:function(e,t,r,n,i,a){if(0!=(2&i)&&0==(2&a)&&2!=(2097155&e.flags))throw new be.ErrnoError(2);if(1==(2097155&e.flags))throw new be.ErrnoError(2);if(!e.stream_ops.mmap)throw new be.ErrnoError(43);return e.stream_ops.mmap(e,t,r,n,i,a)},msync:function(e,t,r,n,i){return e&&e.stream_ops.msync?e.stream_ops.msync(e,t,r,n,i):0},munmap:function(e){return 0},ioctl:function(e,t,r){if(!e.stream_ops.ioctl)throw new be.ErrnoError(59);return e.stream_ops.ioctl(e,t,r)},readFile:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r.flags=r.flags||0,r.encoding=r.encoding||"binary","utf8"!==r.encoding&&"binary"!==r.encoding)throw new Error('Invalid encoding type "'+r.encoding+'"');var n=be.open(e,r.flags),i=be.stat(e),a=i.size,o=new Uint8Array(a);return be.read(n,o,0,a,0),"utf8"===r.encoding?t=x(o,0):"binary"===r.encoding&&(t=o),be.close(n),t},writeFile:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r.flags=r.flags||577;var n=be.open(e,r.flags,r.mode);if("string"==typeof t){var i=new Uint8Array(L(t)+1),a=O(t,i,0,i.length);be.write(n,i,0,a,void 0,r.canOwn)}else{if(!ArrayBuffer.isView(t))throw new Error("Unsupported data type");be.write(n,t,0,t.byteLength,void 0,r.canOwn)}be.close(n)},cwd:function(){return be.currentPath},chdir:function(e){var t=be.lookupPath(e,{follow:!0});if(null===t.node)throw new be.ErrnoError(44);if(!be.isDir(t.node.mode))throw new be.ErrnoError(54);var r=be.nodePermissions(t.node,"x");if(r)throw new be.ErrnoError(r);be.currentPath=t.path},createDefaultDirectories:function(){be.mkdir("/tmp"),be.mkdir("/home"),be.mkdir("/home/web_user")},createDefaultDevices:function(){be.mkdir("/dev"),be.registerDevice(be.makedev(1,3),{read:function(){return 0},write:function(e,t,r,n,i){return n}}),be.mkdev("/dev/null",be.makedev(1,3)),ye.register(be.makedev(5,0),ye.default_tty_ops),ye.register(be.makedev(6,0),ye.default_tty1_ops),be.mkdev("/dev/tty",be.makedev(5,0)),be.mkdev("/dev/tty1",be.makedev(6,0));var e=function(){if("object"==("undefined"==typeof crypto?"undefined":_typeof(crypto))&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}return function(){ee("no cryptographic support found for randomDevice. consider polyfilling it if you want to use something insecure like Math.random(), e.g. put this in a --pre-js: var crypto = { getRandomValues: function(array) { for (var i = 0; i < array.length; i++) array[i] = (Math.random()*256)|0 } };")}}();be.createDevice("/dev","random",e),be.createDevice("/dev","urandom",e),be.mkdir("/dev/shm"),be.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){be.mkdir("/proc");var e=be.mkdir("/proc/self");be.mkdir("/proc/self/fd"),be.mount({mount:function(){var t=be.createNode(e,"fd",16895,73);return t.node_ops={lookup:function(e,t){var r=+t,n=be.getStream(r);if(!n)throw new be.ErrnoError(8);var i={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return n.path}}};return i.parent=i,i}},t}},{},"/proc/self/fd")},createStandardStreams:function(){a.stdin?be.createDevice("/dev","stdin",a.stdin):be.symlink("/dev/tty","/dev/stdin"),a.stdout?be.createDevice("/dev","stdout",null,a.stdout):be.symlink("/dev/tty","/dev/stdout"),a.stderr?be.createDevice("/dev","stderr",null,a.stderr):be.symlink("/dev/tty1","/dev/stderr");var e=be.open("/dev/stdin",0),t=be.open("/dev/stdout",1),r=be.open("/dev/stderr",1);S(0===e.fd,"invalid handle for stdin ("+e.fd+")"),S(1===t.fd,"invalid handle for stdout ("+t.fd+")"),S(2===r.fd,"invalid handle for stderr ("+r.fd+")")},ensureErrnoError:function(){be.ErrnoError||(be.ErrnoError=function(e,t){this.node=t,this.setErrno=function(e){for(var t in this.errno=e,_e)if(_e[t]===e){this.code=t;break}},this.setErrno(e),this.message=ve[e],this.stack&&(Object.defineProperty(this,"stack",{value:(new Error).stack,writable:!0}),this.stack=le(this.stack))},be.ErrnoError.prototype=new Error,be.ErrnoError.prototype.constructor=be.ErrnoError,[44].forEach((function(e){be.genericErrors[e]=new be.ErrnoError(e),be.genericErrors[e].stack="<generic error, no stack>"})))},staticInit:function(){be.ensureErrnoError(),be.nameTable=new Array(4096),be.mount(me,{},"/"),be.createDefaultDirectories(),be.createDefaultDevices(),be.createSpecialDirectories(),be.filesystems={MEMFS:me}},init:function(e,t,r){S(!be.init.initialized,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),be.init.initialized=!0,be.ensureErrnoError(),a.stdin=e||a.stdin,a.stdout=t||a.stdout,a.stderr=r||a.stderr,be.createStandardStreams()},quit:function(){be.init.initialized=!1,Pe();for(var e=0;e<be.streams.length;e++){var t=be.streams[e];t&&be.close(t)}},getMode:function(e,t){var r=0;return e&&(r|=365),t&&(r|=146),r},findObject:function(e,t){var r=be.analyzePath(e,t);return r.exists?r.object:null},analyzePath:function(t,r){try{t=(i=be.lookupPath(t,{follow:!r})).path}catch(e){}var n={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var i=be.lookupPath(t,{parent:!0});n.parentExists=!0,n.parentPath=i.path,n.parentObject=i.node,n.name=pe.basename(t),i=be.lookupPath(t,{follow:!r}),n.exists=!0,n.path=i.path,n.object=i.node,n.name=i.node.name,n.isRoot="/"===i.path}catch(e){n.error=e.errno}return n},createPath:function(t,r,n,i){t="string"==typeof t?t:be.getPath(t);for(var a=r.split("/").reverse();a.length;){var o=a.pop();if(o){var s=pe.join2(t,o);try{be.mkdir(s)}catch(e){}t=s}}return s},createFile:function(e,t,r,n,i){var a=pe.join2("string"==typeof e?e:be.getPath(e),t),o=be.getMode(n,i);return be.create(a,o)},createDataFile:function(e,t,r,n,i,a){var o=t;e&&(e="string"==typeof e?e:be.getPath(e),o=t?pe.join2(e,t):e);var s=be.getMode(n,i),u=be.create(o,s);if(r){if("string"==typeof r){for(var c=new Array(r.length),l=0,d=r.length;l<d;++l)c[l]=r.charCodeAt(l);r=c}be.chmod(u,146|s);var h=be.open(u,577);be.write(h,r,0,r.length,0,a),be.close(h),be.chmod(u,s)}return u},createDevice:function(t,r,n,i){var a=pe.join2("string"==typeof t?t:be.getPath(t),r),o=be.getMode(!!n,!!i);be.createDevice.major||(be.createDevice.major=64);var s=be.makedev(be.createDevice.major++,0);return be.registerDevice(s,{open:function(e){e.seekable=!1},close:function(e){i&&i.buffer&&i.buffer.length&&i(10)},read:function(t,r,i,a,o){for(var s=0,u=0;u<a;u++){var c;try{c=n()}catch(e){throw new be.ErrnoError(29)}if(void 0===c&&0===s)throw new be.ErrnoError(6);if(null==c)break;s++,r[i+u]=c}return s&&(t.node.timestamp=Date.now()),s},write:function(t,r,n,a,o){for(var s=0;s<a;s++)try{i(r[n+s])}catch(e){throw new be.ErrnoError(29)}return a&&(t.node.timestamp=Date.now()),s}}),be.mkdev(a,o,s)},forceLoadFile:function(t){if(t.isDevice||t.isFolder||t.link||t.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!s)throw new Error("Cannot load without read() or XMLHttpRequest.");try{t.contents=we(s(t.url),!0),t.usedBytes=t.contents.length}catch(e){throw new be.ErrnoError(29)}},createLazyFile:function(e,t,r,n,i){function a(){this.lengthKnown=!1,this.chunks=[]}if(a.prototype.get=function(e){if(!(e>this.length-1||e<0)){var t=e%this.chunkSize,r=e/this.chunkSize|0;return this.getter(r)[t]}},a.prototype.setDataGetter=function(e){this.getter=e},a.prototype.cacheLength=function(){var e=new XMLHttpRequest;if(e.open("HEAD",r,!1),e.send(null),!(e.status>=200&&e.status<300||304===e.status))throw new Error("Couldn't load "+r+". Status: "+e.status);var t,n=Number(e.getResponseHeader("Content-length")),i=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t,a=(t=e.getResponseHeader("Content-Encoding"))&&"gzip"===t,o=1048576;i||(o=n);var s=this;s.setDataGetter((function(e){var t=e*o,i=(e+1)*o-1;if(i=Math.min(i,n-1),void 0===s.chunks[e]&&(s.chunks[e]=function(e,t){if(e>t)throw new Error("invalid range ("+e+", "+t+") or no bytes requested!");if(t>n-1)throw new Error("only "+n+" bytes available! programmer error!");var i=new XMLHttpRequest;if(i.open("GET",r,!1),n!==o&&i.setRequestHeader("Range","bytes="+e+"-"+t),i.responseType="arraybuffer",i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.send(null),!(i.status>=200&&i.status<300||304===i.status))throw new Error("Couldn't load "+r+". Status: "+i.status);return void 0!==i.response?new Uint8Array(i.response||[]):we(i.responseText||"",!0)}(t,i)),void 0===s.chunks[e])throw new Error("doXHR failed!");return s.chunks[e]})),!a&&n||(o=n=1,n=this.getter(0).length,o=n,d("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=n,this._chunkSize=o,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var o={isDevice:!1,url:r},s=be.createFile(e,t,o,n,i);o.contents?s.contents=o.contents:o.url&&(s.contents=null,s.url=o.url),Object.defineProperties(s,{usedBytes:{get:function(){return this.contents.length}}});var u={};return Object.keys(s.stream_ops).forEach((function(e){var t=s.stream_ops[e];u[e]=function(){return be.forceLoadFile(s),t.apply(null,arguments)}})),u.read=function(e,t,r,n,i){be.forceLoadFile(s);var a=e.node.contents;if(i>=a.length)return 0;var o=Math.min(a.length-i,n);if(S(o>=0),a.slice)for(var u=0;u<o;u++)t[r+u]=a[i+u];else for(u=0;u<o;u++)t[r+u]=a.get(i+u);return o},s.stream_ops=u,s},createPreloadedFile:function(e,t,r,n,i,a,o,s,c,l){var d=t?ge.resolve(pe.join2(e,t)):e,h=J("cp "+d);function f(r){function u(r){l&&l(),s||be.createDataFile(e,t,r,n,i,c),a&&a(),q(h)}Browser.handledByPreloadPlugin(r,d,u,(function(){o&&o(),q(h)}))||u(r)}Q(h),"string"==typeof r?function(e,t,r,n){var i=n?"":J("al "+e);u(e,(function(r){S(r,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(r)),i&&q(i)}),(function(t){if(!r)throw'Loading data file "'+e+'" failed.';r()})),i&&Q(i)}(r,(function(e){return f(e)}),o):f(r)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(t,r,n){r=r||function(){},n=n||function(){};var i=be.indexedDB();try{var a=i.open(be.DB_NAME(),be.DB_VERSION)}catch(e){return n(e)}a.onupgradeneeded=function(){d("creating db"),a.result.createObjectStore(be.DB_STORE_NAME)},a.onsuccess=function(){var e=a.result.transaction([be.DB_STORE_NAME],"readwrite"),i=e.objectStore(be.DB_STORE_NAME),o=0,s=0,u=t.length;function c(){0==s?r():n()}t.forEach((function(e){var t=i.put(be.analyzePath(e).object.contents,e);t.onsuccess=function(){++o+s==u&&c()},t.onerror=function(){s++,o+s==u&&c()}})),e.onerror=n},a.onerror=n},loadFilesFromDB:function(t,r,n){r=r||function(){},n=n||function(){};var i=be.indexedDB();try{var a=i.open(be.DB_NAME(),be.DB_VERSION)}catch(e){return n(e)}a.onupgradeneeded=n,a.onsuccess=function(){var i=a.result;try{var o=i.transaction([be.DB_STORE_NAME],"readonly")}catch(e){return void n(e)}var s=o.objectStore(be.DB_STORE_NAME),u=0,c=0,l=t.length;function d(){0==c?r():n()}t.forEach((function(e){var t=s.get(e);t.onsuccess=function(){be.analyzePath(e).exists&&be.unlink(e),be.createDataFile(pe.dirname(e),pe.basename(e),t.result,!0,!0,!0),++u+c==l&&d()},t.onerror=function(){c++,u+c==l&&d()}})),o.onerror=n},a.onerror=n},absolutePath:function(){ee("FS.absolutePath has been removed; use PATH_FS.resolve instead")},createFolder:function(){ee("FS.createFolder has been removed; use FS.mkdir instead")},createLink:function(){ee("FS.createLink has been removed; use FS.symlink instead")},joinPath:function(){ee("FS.joinPath has been removed; use PATH.join instead")},mmapAlloc:function(){ee("FS.mmapAlloc has been replaced by the top level function mmapAlloc")},standardizePath:function(){ee("FS.standardizePath has been removed; use PATH.normalize instead")}},Ae={DEFAULT_POLLMASK:5,calculateAt:function(e,t,r){if("/"===t[0])return t;var n;if(-100===e)n=be.cwd();else{var i=be.getStream(e);if(!i)throw new be.ErrnoError(8);n=i.path}if(0==t.length){if(!r)throw new be.ErrnoError(44);return n}return pe.join2(n,t)},doStat:function(t,r,n){try{var i=t(r)}catch(e){if(e&&e.node&&pe.normalize(r)!==pe.normalize(be.getPath(e.node)))return-54;throw e}return I[n>>2]=i.dev,I[n+4>>2]=0,I[n+8>>2]=i.ino,I[n+12>>2]=i.mode,I[n+16>>2]=i.nlink,I[n+20>>2]=i.uid,I[n+24>>2]=i.gid,I[n+28>>2]=i.rdev,I[n+32>>2]=0,ie=[i.size>>>0,(ne=i.size,+Math.abs(ne)>=1?ne>0?(0|Math.min(+Math.floor(ne/4294967296),4294967295))>>>0:~~+Math.ceil((ne-+(~~ne>>>0))/4294967296)>>>0:0)],I[n+40>>2]=ie[0],I[n+44>>2]=ie[1],I[n+48>>2]=4096,I[n+52>>2]=i.blocks,I[n+56>>2]=i.atime.getTime()/1e3|0,I[n+60>>2]=0,I[n+64>>2]=i.mtime.getTime()/1e3|0,I[n+68>>2]=0,I[n+72>>2]=i.ctime.getTime()/1e3|0,I[n+76>>2]=0,ie=[i.ino>>>0,(ne=i.ino,+Math.abs(ne)>=1?ne>0?(0|Math.min(+Math.floor(ne/4294967296),4294967295))>>>0:~~+Math.ceil((ne-+(~~ne>>>0))/4294967296)>>>0:0)],I[n+80>>2]=ie[0],I[n+84>>2]=ie[1],0},doMsync:function(e,t,r,n,i){var a=k.slice(e,e+r);be.msync(t,a,i,r,n)},doMkdir:function(e,t){return"/"===(e=pe.normalize(e))[e.length-1]&&(e=e.substr(0,e.length-1)),be.mkdir(e,t,0),0},doMknod:function(e,t,r){switch(61440&t){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-28}return be.mknod(e,t,r),0},doReadlink:function(e,t,r){if(r<=0)return-28;var n=be.readlink(e),i=Math.min(r,L(n)),a=C[t+i];return D(n,t,r+1),C[t+i]=a,i},doAccess:function(e,t){if(-8&t)return-28;var r=be.lookupPath(e,{follow:!0}).node;if(!r)return-44;var n="";return 4&t&&(n+="r"),2&t&&(n+="w"),1&t&&(n+="x"),n&&be.nodePermissions(r,n)?-2:0},doDup:function(e,t,r){var n=be.getStream(r);return n&&be.close(n),be.open(e,t,0,r,r).fd},doReadv:function(e,t,r,n){for(var i=0,a=0;a<r;a++){var o=I[t+8*a>>2],s=I[t+(8*a+4)>>2],u=be.read(e,C,o,s,n);if(u<0)return-1;if(i+=u,u<s)break}return i},doWritev:function(e,t,r,n){for(var i=0,a=0;a<r;a++){var o=I[t+8*a>>2],s=I[t+(8*a+4)>>2],u=be.write(e,C,o,s,n);if(u<0)return-1;i+=u}return i},varargs:void 0,get:function(){return S(null!=Ae.varargs),Ae.varargs+=4,I[Ae.varargs-4>>2]},getStr:function(e){return R(e)},getStreamFromFD:function(e){var t=be.getStream(e);if(!t)throw new be.ErrnoError(8);return t},get64:function(e,t){return S(e>=0?0===t:-1===t),e}};var Ee=function(e,t,r,n){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=be.nextInode++,this.name=t,this.mode=r,this.node_ops={},this.stream_ops={},this.rdev=n},Se=365,Te=146;function we(e,t,r){var n=r>0?r:L(e)+1,i=new Array(n),a=O(e,i,0,i.length);return t&&(i.length=a),i}Object.defineProperties(Ee.prototype,{read:{get:function(){return(this.mode&Se)===Se},set:function(e){e?this.mode|=Se:this.mode&=-366}},write:{get:function(){return(this.mode&Te)===Te},set:function(e){e?this.mode|=Te:this.mode&=-147}},isFolder:{get:function(){return be.isDir(this.mode)}},isDevice:{get:function(){return be.isChrdev(this.mode)}}}),be.FSNode=Ee,be.staticInit(),_e={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135};var Ce="function"==typeof atob?atob:function(e){var t,r,n,i,a,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",c=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=s.indexOf(e.charAt(c++))<<2|(i=s.indexOf(e.charAt(c++)))>>4,r=(15&i)<<4|(a=s.indexOf(e.charAt(c++)))>>2,n=(3&a)<<6|(o=s.indexOf(e.charAt(c++))),u+=String.fromCharCode(t),64!==a&&(u+=String.fromCharCode(r)),64!==o&&(u+=String.fromCharCode(n))}while(c<e.length);return u};function ke(e){if(oe(e))return function(e){try{for(var t=Ce(e),r=new Uint8Array(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}catch(i){throw new Error("Converting base64 string to bytes failed.")}}(e.slice(ae.length))}var Ie={__assert_fail:function(e,t,r,n){ee("Assertion failed: "+R(e)+", at: "+[t?R(t):"unknown filename",r,n?R(n):"unknown function"])},__cxa_allocate_exception:function(e){return $e(e+16)+16},__cxa_throw:function(e,t,r){throw new he(e).init(t,r),e+" - Exception catching is disabled, this exception cannot be caught. Compile with -s NO_DISABLE_EXCEPTION_CATCHING or -s EXCEPTION_CATCHING_ALLOWED=[..] to catch."},abort:function(){ee("native code called abort()")},emscripten_memcpy_big:function(e,t,r){k.copyWithin(e,t,t+r)},emscripten_resize_heap:function(e){var t=k.length;S((e>>>=0)>t);var r=2147483648;if(e>r)return h("Cannot enlarge memory, asked to go up to "+e+" bytes, but the limit is "+"2147483648 bytes!"),!1;for(var n,i,a=1;a<=4;a*=2){var o=t*(1+.2/a);o=Math.min(o,e+100663296);var s=Math.min(r,(n=Math.max(e,o))+((i=65536)-n%i)%i);if(fe(s))return h("Warning: Enlarging memory arrays, this is not fast! "+[t,s]),!0}return h("Failed to grow the heap from "+t+" bytes to "+s+" bytes, not enough memory!"),!1},fd_close:function(t){try{var r=Ae.getStreamFromFD(t);return be.close(r),0}catch(e){if(void 0===be||!(e instanceof be.ErrnoError))throw e;return e.errno}},fd_read:function(t,r,n,i){try{var a=Ae.getStreamFromFD(t),o=Ae.doReadv(a,r,n);return I[i>>2]=o,0}catch(e){if(void 0===be||!(e instanceof be.ErrnoError))throw e;return e.errno}},fd_seek:function(t,r,n,i,a){try{var o=Ae.getStreamFromFD(t),s=4294967296*n+(r>>>0),u=9007199254740992;return s<=-u||s>=u?-61:(be.llseek(o,s,i),ie=[o.position>>>0,(ne=o.position,+Math.abs(ne)>=1?ne>0?(0|Math.min(+Math.floor(ne/4294967296),4294967295))>>>0:~~+Math.ceil((ne-+(~~ne>>>0))/4294967296)>>>0:0)],I[a>>2]=ie[0],I[a+4>>2]=ie[1],o.getdents&&0===s&&0===i&&(o.getdents=null),0)}catch(e){if(void 0===be||!(e instanceof be.ErrnoError))throw e;return e.errno}},fd_write:function(t,r,n,i){try{var a=Ae.getStreamFromFD(t),o=Ae.doWritev(a,r,n);return I[i>>2]=o,0}catch(e){if(void 0===be||!(e instanceof be.ErrnoError))throw e;return e.errno}},getTempRet0:function(){return _},gettimeofday:function(e){var t=Date.now();return I[e>>2]=t/1e3|0,I[e+4>>2]=t%1e3*1e3|0,0},memory:b,setTempRet0:function(e){_=e}};!function(){var t={env:Ie,wasi_snapshot_preview1:Ie};function r(e,t){var r,n=e.exports;a.asm=n,S(U=a.asm.__indirect_function_table,"table not found in wasm exports"),r=a.asm.__wasm_call_ctors,H.unshift(r),q("wasm-instantiate")}Q("wasm-instantiate");var n=a;function o(e){S(a===n,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),n=null,r(e.instance)}function s(e){return(v||"function"!=typeof fetch?Promise.resolve().then((function(){return ue(te)})):fetch(te,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+te+"'";return e.arrayBuffer()})).catch((function(){return ue(te)}))).then((function(e){return A.instantiate(e,t)})).then((function(e){return e})).then(e,(function(e){h("failed to asynchronously prepare wasm: "+e),te.startsWith("file://")&&h("warning: Loading from a file URI ("+te+") is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing"),ee(e)}))}if(a.instantiateWasm)try{return a.instantiateWasm(t,r)}catch(e){return h("Module.instantiateWasm callback failed with error: "+e),!1}(v||"function"!=typeof A.instantiateStreaming||oe(te)||"function"!=typeof fetch?s(o):fetch(te,{credentials:"same-origin"}).then((function(e){return A.instantiateStreaming(e,t).then(o,(function(e){return h("wasm streaming compile failed: "+e),h("falling back to ArrayBuffer instantiation"),s(o)}))}))).catch(i)}(),a.___wasm_call_ctors=se("__wasm_call_ctors");var $e=a._malloc=se("malloc");a._parseMPD=se("parseMPD"),a._updatePreloadInfo=se("updatePreloadInfo"),a._updateDeviceInfo=se("updateDeviceInfo"),a._updateMediaInfo=se("updateMediaInfo"),a._updateBufferInfo=se("updateBufferInfo"),a._updateSwitchInfo=se("updateSwitchInfo"),a._updatePreloadSupplier=se("updatePreloadSupplier"),a._getPredictedBitrate=se("getPredictedBitrate"),a._getPreloadBitrate=se("getPreloadBitrate"),a._setDebugModel=se("setDebugModel"),a._free=se("free"),a.___errno_location=se("__errno_location");var Pe=a.___stdio_exit=se("__stdio_exit"),xe=a._emscripten_stack_init=function(){return(xe=a._emscripten_stack_init=a.asm.emscripten_stack_init).apply(null,arguments)};a._emscripten_stack_get_free=function(){return(a._emscripten_stack_get_free=a.asm.emscripten_stack_get_free).apply(null,arguments)},a._emscripten_stack_get_base=function(){return(a._emscripten_stack_get_base=a.asm.emscripten_stack_get_base).apply(null,arguments)};var Re,Oe=a._emscripten_stack_get_end=function(){return(Oe=a._emscripten_stack_get_end=a.asm.emscripten_stack_get_end).apply(null,arguments)},De=a.stackSave=se("stackSave"),Le=a.stackRestore=se("stackRestore"),Me=a.stackAlloc=se("stackAlloc");function Ne(e){function t(){Re||(Re=!0,a.calledRun=!0,E||(F(),S(!W),W=!0,a.noFSInit||be.init.initialized||be.init(),be.ignorePermissions=!1,ce(H),n(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),S(!a._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),function(){if(F(),a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;)e=a.postRun.shift(),Z.unshift(e);var e;ce(Z)}()))}K>0||(xe(),V(),function(){if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)e=a.preRun.shift(),j.unshift(e);var e;ce(j)}(),K>0||(a.setStatus?(a.setStatus("Running..."),setTimeout((function(){setTimeout((function(){a.setStatus("")}),1),t()}),1)):t(),F()))}if(a.dynCall_jiji=se("dynCall_jiji"),m("intArrayFromString",!1),m("intArrayToString",!1),a.ccall=T,a.cwrap=function(e,t,r,n){return function(){return T(e,t,r,arguments)}},m("setValue",!1),m("getValue",!1),m("allocate",!1),m("UTF8ArrayToString",!1),m("UTF8ToString",!1),m("stringToUTF8Array",!1),m("stringToUTF8",!1),m("lengthBytesUTF8",!1),m("stackTrace",!1),m("addOnPreRun",!1),m("addOnInit",!1),m("addOnPreMain",!1),m("addOnExit",!1),m("addOnPostRun",!1),m("writeStringToMemory",!1),a.writeArrayToMemory=M,m("writeAsciiToMemory",!1),m("addRunDependency",!0),m("removeRunDependency",!0),m("FS_createFolder",!1),m("FS_createPath",!0),m("FS_createDataFile",!0),m("FS_createPreloadedFile",!0),m("FS_createLazyFile",!0),m("FS_createLink",!1),m("FS_createDevice",!0),m("FS_unlink",!0),m("getLEB",!1),m("getFunctionTables",!1),m("alignFunctionTables",!1),m("registerFunctions",!1),m("addFunction",!1),m("removeFunction",!1),m("getFuncWrapper",!1),m("prettyPrint",!1),m("dynCall",!1),m("getCompilerSetting",!1),a.print=d,m("printErr",!1),m("getTempRet0",!1),m("setTempRet0",!1),m("callMain",!1),m("abort",!1),m("keepRuntimeAlive",!1),m("zeroMemory",!1),m("stringToNewUTF8",!1),m("emscripten_realloc_buffer",!1),m("ENV",!1),m("withStackSave",!1),m("ERRNO_CODES",!1),m("ERRNO_MESSAGES",!1),m("setErrNo",!1),m("inetPton4",!1),m("inetNtop4",!1),m("inetPton6",!1),m("inetNtop6",!1),m("readSockaddr",!1),m("writeSockaddr",!1),m("DNS",!1),m("getHostByName",!1),m("Protocols",!1),m("Sockets",!1),m("getRandomDevice",!1),m("traverseStack",!1),m("convertFrameToPC",!1),m("UNWIND_CACHE",!1),m("saveInUnwindCache",!1),m("convertPCtoSourceLocation",!1),m("readAsmConstArgsArray",!1),m("readAsmConstArgs",!1),m("mainThreadEM_ASM",!1),m("jstoi_q",!1),m("jstoi_s",!1),m("getExecutableName",!1),m("listenOnce",!1),m("autoResumeAudioContext",!1),m("dynCallLegacy",!1),m("getDynCaller",!1),m("dynCall",!1),m("callRuntimeCallbacks",!1),m("setWasmTableEntry",!1),m("getWasmTableEntry",!1),m("handleException",!1),m("runtimeKeepalivePush",!1),m("runtimeKeepalivePop",!1),m("callUserCallback",!1),m("maybeExit",!1),m("safeSetTimeout",!1),m("asmjsMangle",!1),m("asyncLoad",!1),m("alignMemory",!1),m("mmapAlloc",!1),m("reallyNegative",!1),m("unSign",!1),m("reSign",!1),m("formatString",!1),m("PATH",!1),m("PATH_FS",!1),m("SYSCALLS",!1),m("getSocketFromFD",!1),m("getSocketAddress",!1),m("JSEvents",!1),m("registerKeyEventCallback",!1),m("specialHTMLTargets",!1),m("maybeCStringToJsString",!1),m("findEventTarget",!1),m("findCanvasEventTarget",!1),m("getBoundingClientRect",!1),m("fillMouseEventData",!1),m("registerMouseEventCallback",!1),m("registerWheelEventCallback",!1),m("registerUiEventCallback",!1),m("registerFocusEventCallback",!1),m("fillDeviceOrientationEventData",!1),m("registerDeviceOrientationEventCallback",!1),m("fillDeviceMotionEventData",!1),m("registerDeviceMotionEventCallback",!1),m("screenOrientation",!1),m("fillOrientationChangeEventData",!1),m("registerOrientationChangeEventCallback",!1),m("fillFullscreenChangeEventData",!1),m("registerFullscreenChangeEventCallback",!1),m("registerRestoreOldStyle",!1),m("hideEverythingExceptGivenElement",!1),m("restoreHiddenElements",!1),m("setLetterbox",!1),m("currentFullscreenStrategy",!1),m("restoreOldWindowedStyle",!1),m("softFullscreenResizeWebGLRenderTarget",!1),m("doRequestFullscreen",!1),m("fillPointerlockChangeEventData",!1),m("registerPointerlockChangeEventCallback",!1),m("registerPointerlockErrorEventCallback",!1),m("requestPointerLock",!1),m("fillVisibilityChangeEventData",!1),m("registerVisibilityChangeEventCallback",!1),m("registerTouchEventCallback",!1),m("fillGamepadEventData",!1),m("registerGamepadEventCallback",!1),m("registerBeforeUnloadEventCallback",!1),m("fillBatteryEventData",!1),m("battery",!1),m("registerBatteryEventCallback",!1),m("setCanvasElementSize",!1),m("getCanvasElementSize",!1),m("demangle",!1),m("demangleAll",!1),m("jsStackTrace",!1),m("stackTrace",!1),m("getEnvStrings",!1),m("checkWasiClock",!1),m("writeI53ToI64",!1),m("writeI53ToI64Clamped",!1),m("writeI53ToI64Signaling",!1),m("writeI53ToU64Clamped",!1),m("writeI53ToU64Signaling",!1),m("readI53FromI64",!1),m("readI53FromU64",!1),m("convertI32PairToI53",!1),m("convertU32PairToI53",!1),m("setImmediateWrapped",!1),m("clearImmediateWrapped",!1),m("polyfillSetImmediate",!1),m("uncaughtExceptionCount",!1),m("exceptionLast",!1),m("exceptionCaught",!1),m("ExceptionInfo",!1),m("CatchInfo",!1),m("exception_addRef",!1),m("exception_decRef",!1),m("Browser",!1),m("funcWrappers",!1),m("getFuncWrapper",!1),m("setMainLoop",!1),m("wget",!1),m("FS",!1),m("MEMFS",!1),m("TTY",!1),m("PIPEFS",!1),m("SOCKFS",!1),m("_setNetworkCallback",!1),m("tempFixedLengthArray",!1),m("miniTempWebGLFloatBuffers",!1),m("heapObjectForWebGLType",!1),m("heapAccessShiftForWebGLHeap",!1),m("GL",!1),m("emscriptenWebGLGet",!1),m("computeUnpackAlignedImageSize",!1),m("emscriptenWebGLGetTexPixelData",!1),m("emscriptenWebGLGetUniform",!1),m("webglGetUniformLocation",!1),m("webglPrepareUniformLocationsBeforeFirstUse",!1),m("webglGetLeftBracePos",!1),m("emscriptenWebGLGetVertexAttrib",!1),m("writeGLArray",!1),m("AL",!1),m("SDL_unicode",!1),m("SDL_ttfContext",!1),m("SDL_audio",!1),m("SDL",!1),m("SDL_gfx",!1),m("GLUT",!1),m("EGL",!1),m("GLFW_Window",!1),m("GLFW",!1),m("GLEW",!1),m("IDBStore",!1),m("runAndAbortIfError",!1),m("warnOnce",!1),m("stackSave",!1),m("stackRestore",!1),m("stackAlloc",!1),m("AsciiToString",!1),m("stringToAscii",!1),m("UTF16ToString",!1),m("stringToUTF16",!1),m("lengthBytesUTF16",!1),m("UTF32ToString",!1),m("stringToUTF32",!1),m("lengthBytesUTF32",!1),m("allocateUTF8",!1),m("allocateUTF8OnStack",!1),a.writeStackCookie=V,a.checkStackCookie=F,m("intArrayFromBase64",!1),m("tryParseAsDataURI",!1),y("ALLOC_NORMAL",!1),y("ALLOC_STACK",!1),Y=function e(){Re||Ne(),Re||(Y=e)},a.run=Ne,a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return Ne(),r.ready}}(),Abr=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),(n=t.call(this,e)).isOpenAutoDefi=!1,n.config=null,n.init(),n}return _createClass$9(r,[{key:"init",value:function(){var e=this.playerData.options.autoBitrateOpts;this.config=e;var t=null==e?void 0:e.isOpenAutoDefi;if(util$2.checkIsObject(e)&&t){this.isOpenAutoDefi=t;var r=_objectSpread2$7({module:abrAlgo},e||{});if(this.isEnableMp4EncryptPlugin()){var n=this.playerData.options.Mp4EncryptPlayer||{};this.playerData.options.Mp4EncryptPlayer=_objectSpread2$7({autoBitrateOpts:r},n)}if(this.isEnableDashPlugin()){var i=this.playerData.options.DASHPlugin||{};this.playerData.options.DASHPlugin=_objectSpread2$7({autoBitrateOpts:r},i)}}}},{key:"afterPlayerCreate",value:function(){this.isOpenAutoDefi&&this.abrMonitor()}},{key:"isEnableMp4EncryptPlugin",value:function(){var e,t=this.playerData.getCurrentStreamType(),r=isEncryptPlay(null===(e=this.playerData.config)||void 0===e?void 0:e.getVideoByToken),n=this.playerData.options,i=n.autoBitrateOpts,a=n.Mp4EncryptPlayer,o=n.enableMp4MSE;return"mp4"===t&&r||"mp4"===t&&(null==i?void 0:i.isOpenAutoDefi)||a||o}},{key:"isEnableDashPlugin",value:function(){return"dash"===this.playerData.getCurrentStreamType()||this.playerData.options.DASHPlugin}},{key:"abrMonitor",value:function(){var e=this;this.player.on("ABR_AUTO_DESC_CHANGE",(function(t,r,n,i){var a=e.player.root.querySelector(".xgplayer-definition [url='__auto__']");a&&(a.innerHTML=r?t+"".concat(r?"(".concat(r,")"):""):t)}))}}],[{key:"pluginName",get:function(){return"Abr"}}]),r}(SdkPlugin),sdkPluginManager={init:function(e){e&&(e.isLive?e.sdkPlugins=[]:e.sdkPlugins=[AuthToken,Abr],e._sdkPlugins={})},registerPlugin:function(e,t){if(e&&t){var r=null,n=null;e.plugin&&"function"==typeof e.plugin?(r=e.plugin,n=e.options):(r=e,n={}),n.sdk=t;var i=n.pluginName||r.pluginName;if(!i)throw new Error("The property pluginName is necessary");var a=t._sdkPlugins;try{a[i.toLowerCase()]&&this.unRegister(i);var o=new r(n);return a[i.toLowerCase()]=o,a[i.toLowerCase()].func=r,o&&"function"==typeof o.afterCreate&&o.afterCreate(),o}catch(s){console.error(s)}}},unRegister:function(e,t){if(e&&t){e=e.toLowerCase();try{var r=t._sdkPlugins[e];r&&(r.pluginName&&r.__destroy(),delete t._sdkPlugins[e])}catch(n){console.error(n)}}},beforePlayerCreate:function(t){if(t){t._sdkPlugins||this.init(t);for(var r=t._sdkPlugins,n=[],i=0,a=Object.keys(r);i<a.length;i++){var o=a[i];if(r[o]&&r[o].beforePlayerCreate)try{var s=r[o].beforePlayerCreate();n.push(retPromise$1(s))}catch(e){throw n.push(retPromise$1(null)),e}}return new Promise((function(e){Promise.all([].concat(n)).then((function(){e(null)})).catch((function(t){console.error(t),e(null)}))}))}},afterPlayerCreate:function(t){if(t)for(var r=t._sdkPlugins,n=0,i=Object.keys(r);n<i.length;n++){var a=i[n];if(r[a]&&r[a].beforePlayerCreate)try{r[a].afterPlayerCreate()}catch(e){throw e}}},destroy:function(e){if(e){for(var t=e._sdkPlugins,r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];this.unRegister(i,e)}delete e._sdkPlugins}}};const name="@volcengine/veplayer",version="1.2.2",main="dist/index.min.js",module$1="dist/index.min.js",typings="dist/index.d.ts",sideEffects=["*.css","*.less"],files=["dist"],scripts={"test:e2e":"echo 'test'",lint:"npx lint-staged",dev:"libd dev demo","dev:vod":"libd dev demo/vod","dev:hth":"libd dev fixtures/hth",build:"libd build",release:"libd release",doc:"docg './src/**/*'",changelog:"libd changelog -s"},author="",license="BSD-3-Clause",devDependencies={"@byted/docg":"^0.5.1","@byted/libd":"^1.1.13","@commitlint/cli":"^16.2.1","@commitlint/config-conventional":"^16.2.1","@types/lodash":"^4.14.178","@typescript-eslint/eslint-plugin":"^5.12.0","@typescript-eslint/parser":"^5.12.0","cross-env":"^7.0.3",eslint:"^8.9.0","eslint-config-prettier":"^6.7.0","eslint-plugin-jest":"^23.20.0","eslint-plugin-prettier":"^3.1.0","git-cz":"^4.7.6",husky:"^8.0.1",less:"^4.1.2","lint-staged":"^11.1.2","node-fetch":"2.6.2","postcss-less":"^6.0.0",prettier:"^2.2.1",shelljs:"^0.8.5",stylelint:"^14.5.2","stylelint-config-standard":"^24.0.0","stylelint-prettier":"^2.0.0",typescript:"^4.5.5"},dependencies={"@byted/danmu-mask":"^0.3.4","@byted/xgplayer-app-logger":"^0.11.8","@byted/xgplayer-encrypt":"3.0.45","@byted/xgplayer-encrypt-hls":"4.0.0","@byted/xgplayer-encrypt-mp4":"3.0.0-alpha.31-29-28","@byted/xgplayer-live-logger":"1.0.0-alpha.9","@byted/xgplayer-rts":"^0.0.7","@byted/xgplayer-vod-abralgo":"^1.0.3","@byted/xgplayer-vod-menu":"3.0.3","danmu.js":"^0.6.3","dom-helpers":"^5.2.1",eventemitter3:"^4.0.7","js-cookie":"^3.0.1","lodash-es":"^4.17.21","proxy-polyfill":"^0.3.2",semver:"^7.3.7",xgplayer:"3.0.0-next.28","xgplayer-flv":"3.0.0-next.9-3","xgplayer-hls":"3.0.0-next.12-1","xgplayer-livevideo":"3.0.0-next.6-6","xgplayer-service":"^0.4.2","xgplayer-shaka":"^3.0.0-alpha.1","xgplayer-subtitles":"^1.0.22"},publishConfig={tag:"latest"};var pkgJson={name:name,version:version,main:main,module:module$1,typings:typings,sideEffects:sideEffects,files:files,scripts:scripts,author:author,license:license,devDependencies:devDependencies,dependencies:dependencies,"lint-staged":{"*.{less}":'stylelint --fix "src/**/*.less" --custom-syntax postcss-less',"*.{js,jsx,ts,tsx}":["eslint --fix"]},publishConfig:publishConfig};function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf$4(e)););return e}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=_superPropBase(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},_get.apply(this,arguments)}var $$1=_export,fails=fails$10,getOwnPropertyNames=objectGetOwnPropertyNamesExternal.f,FAILS_ON_PRIMITIVES=fails((function(){return!Object.getOwnPropertyNames(1)}));$$1({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES},{getOwnPropertyNames:getOwnPropertyNames});var $=_export,parseFloat$1=numberParseFloat;$({target:"Number",stat:!0,forced:Number.parseFloat!=parseFloat$1},{parseFloat:parseFloat$1});var webm="data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4EEQoWBAhhTgGcBAAAAAAAVkhFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsghV17AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU1LjMzLjEwMFdBjUxhdmY1NS4zMy4xMDBzpJBlrrXf3DCDVB8KcgbMpcr+RImIQJBgAAAAAAAWVK5rAQAAAAAAD++uAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDiDgQEj44OEAmJaAOABAAAAAAAABrCBsLqBkK4BAAAAAAAPq9eBAnPFgQKcgQAitZyDdW5khohBX1ZPUkJJU4OBAuEBAAAAAAAAEZ+BArWIQOdwAAAAAABiZIEgY6JPbwIeVgF2b3JiaXMAAAAAAoC7AAAAAAAAgLUBAAAAAAC4AQN2b3JiaXMtAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAxMDExMDEgKFNjaGF1ZmVudWdnZXQpAQAAABUAAABlbmNvZGVyPUxhdmM1NS41Mi4xMDIBBXZvcmJpcyVCQ1YBAEAAACRzGCpGpXMWhBAaQlAZ4xxCzmvsGUJMEYIcMkxbyyVzkCGkoEKIWyiB0JBVAABAAACHQXgUhIpBCCGEJT1YkoMnPQghhIg5eBSEaUEIIYQQQgghhBBCCCGERTlokoMnQQgdhOMwOAyD5Tj4HIRFOVgQgydB6CCED0K4moOsOQghhCQ1SFCDBjnoHITCLCiKgsQwuBaEBDUojILkMMjUgwtCiJqDSTX4GoRnQXgWhGlBCCGEJEFIkIMGQcgYhEZBWJKDBjm4FITLQagahCo5CB+EIDRkFQCQAACgoiiKoigKEBqyCgDIAAAQQFEUx3EcyZEcybEcCwgNWQUAAAEACAAAoEiKpEiO5EiSJFmSJVmSJVmS5omqLMuyLMuyLMsyEBqyCgBIAABQUQxFcRQHCA1ZBQBkAAAIoDiKpViKpWiK54iOCISGrAIAgAAABAAAEDRDUzxHlETPVFXXtm3btm3btm3btm3btm1blmUZCA1ZBQBAAAAQ0mlmqQaIMAMZBkJDVgEACAAAgBGKMMSA0JBVAABAAACAGEoOogmtOd+c46BZDppKsTkdnEi1eZKbirk555xzzsnmnDHOOeecopxZDJoJrTnnnMSgWQqaCa0555wnsXnQmiqtOeeccc7pYJwRxjnnnCateZCajbU555wFrWmOmkuxOeecSLl5UptLtTnnnHPOOeecc84555zqxekcnBPOOeecqL25lpvQxTnnnE/G6d6cEM4555xzzjnnnHPOOeecIDRkFQAABABAEIaNYdwpCNLnaCBGEWIaMulB9+gwCRqDnELq0ehopJQ6CCWVcVJKJwgNWQUAAAIAQAghhRRSSCGFFFJIIYUUYoghhhhyyimnoIJKKqmooowyyyyzzDLLLLPMOuyssw47DDHEEEMrrcRSU2011lhr7jnnmoO0VlprrbVSSimllFIKQkNWAQAgAAAEQgYZZJBRSCGFFGKIKaeccgoqqIDQkFUAACAAgAAAAABP8hzRER3RER3RER3RER3R8RzPESVREiVREi3TMjXTU0VVdWXXlnVZt31b2IVd933d933d+HVhWJZlWZZlWZZlWZZlWZZlWZYgNGQVAAACAAAghBBCSCGFFFJIKcYYc8w56CSUEAgNWQUAAAIACAAAAHAUR3EcyZEcSbIkS9IkzdIsT/M0TxM9URRF0zRV0RVdUTdtUTZl0zVdUzZdVVZtV5ZtW7Z125dl2/d93/d93/d93/d93/d9XQdCQ1YBABIAADqSIymSIimS4ziOJElAaMgqAEAGAEAAAIriKI7jOJIkSZIlaZJneZaomZrpmZ4qqkBoyCoAABAAQAAAAAAAAIqmeIqpeIqoeI7oiJJomZaoqZoryqbsuq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq4LhIasAgAkAAB0JEdyJEdSJEVSJEdygNCQVQCADACAAAAcwzEkRXIsy9I0T/M0TxM90RM901NFV3SB0JBVAAAgAIAAAAAAAAAMybAUy9EcTRIl1VItVVMt1VJF1VNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVN0zRNEwgNWQkAkAEAkBBTLS3GmgmLJGLSaqugYwxS7KWxSCpntbfKMYUYtV4ah5RREHupJGOKQcwtpNApJq3WVEKFFKSYYyoVUg5SIDRkhQAQmgHgcBxAsixAsiwAAAAAAAAAkDQN0DwPsDQPAAAAAAAAACRNAyxPAzTPAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAA0DwP8DwR8EQRAAAAAAAAACzPAzTRAzxRBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAAsDwP8EQR0DwRAAAAAAAAACzPAzxRBDzRAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAEOAAABBgIRQasiIAiBMAcEgSJAmSBM0DSJYFTYOmwTQBkmVB06BpME0AAAAAAAAAAAAAJE2DpkHTIIoASdOgadA0iCIAAAAAAAAAAAAAkqZB06BpEEWApGnQNGgaRBEAAAAAAAAAAAAAzzQhihBFmCbAM02IIkQRpgkAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAGHAAAAgwoQwUGrIiAIgTAHA4imUBAIDjOJYFAACO41gWAABYliWKAABgWZooAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAYcAAACDChDBQashIAiAIAcCiKZQHHsSzgOJYFJMmyAJYF0DyApgFEEQAIAAAocAAACLBBU2JxgEJDVgIAUQAABsWxLE0TRZKkaZoniiRJ0zxPFGma53meacLzPM80IYqiaJoQRVE0TZimaaoqME1VFQAAUOAAABBgg6bE4gCFhqwEAEICAByKYlma5nmeJ4qmqZokSdM8TxRF0TRNU1VJkqZ5niiKommapqqyLE3zPFEURdNUVVWFpnmeKIqiaaqq6sLzPE8URdE0VdV14XmeJ4qiaJqq6roQRVE0TdNUTVV1XSCKpmmaqqqqrgtETxRNU1Vd13WB54miaaqqq7ouEE3TVFVVdV1ZBpimaaqq68oyQFVV1XVdV5YBqqqqruu6sgxQVdd1XVmWZQCu67qyLMsCAAAOHAAAAoygk4wqi7DRhAsPQKEhKwKAKAAAwBimFFPKMCYhpBAaxiSEFEImJaXSUqogpFJSKRWEVEoqJaOUUmopVRBSKamUCkIqJZVSAADYgQMA2IGFUGjISgAgDwCAMEYpxhhzTiKkFGPOOScRUoox55yTSjHmnHPOSSkZc8w556SUzjnnnHNSSuacc845KaVzzjnnnJRSSuecc05KKSWEzkEnpZTSOeecEwAAVOAAABBgo8jmBCNBhYasBABSAQAMjmNZmuZ5omialiRpmud5niiapiZJmuZ5nieKqsnzPE8URdE0VZXneZ4oiqJpqirXFUXTNE1VVV2yLIqmaZqq6rowTdNUVdd1XZimaaqq67oubFtVVdV1ZRm2raqq6rqyDFzXdWXZloEsu67s2rIAAPAEBwCgAhtWRzgpGgssNGQlAJABAEAYg5BCCCFlEEIKIYSUUggJAAAYcAAACDChDBQashIASAUAAIyx1lprrbXWQGettdZaa62AzFprrbXWWmuttdZaa6211lJrrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmstpZRSSimllFJKKaWUUkoppZRSSgUA+lU4APg/2LA6wknRWGChISsBgHAAAMAYpRhzDEIppVQIMeacdFRai7FCiDHnJKTUWmzFc85BKCGV1mIsnnMOQikpxVZjUSmEUlJKLbZYi0qho5JSSq3VWIwxqaTWWoutxmKMSSm01FqLMRYjbE2ptdhqq7EYY2sqLbQYY4zFCF9kbC2m2moNxggjWywt1VprMMYY3VuLpbaaizE++NpSLDHWXAAAd4MDAESCjTOsJJ0VjgYXGrISAAgJACAQUooxxhhzzjnnpFKMOeaccw5CCKFUijHGnHMOQgghlIwx5pxzEEIIIYRSSsaccxBCCCGEkFLqnHMQQgghhBBKKZ1zDkIIIYQQQimlgxBCCCGEEEoopaQUQgghhBBCCKmklEIIIYRSQighlZRSCCGEEEIpJaSUUgohhFJCCKGElFJKKYUQQgillJJSSimlEkoJJYQSUikppRRKCCGUUkpKKaVUSgmhhBJKKSWllFJKIYQQSikFAAAcOAAABBhBJxlVFmGjCRcegEJDVgIAZAAAkKKUUiktRYIipRikGEtGFXNQWoqocgxSzalSziDmJJaIMYSUk1Qy5hRCDELqHHVMKQYtlRhCxhik2HJLoXMOAAAAQQCAgJAAAAMEBTMAwOAA4XMQdAIERxsAgCBEZohEw0JweFAJEBFTAUBigkIuAFRYXKRdXECXAS7o4q4DIQQhCEEsDqCABByccMMTb3jCDU7QKSp1IAAAAAAADADwAACQXAAREdHMYWRobHB0eHyAhIiMkAgAAAAAABcAfAAAJCVAREQ0cxgZGhscHR4fICEiIyQBAIAAAgAAAAAggAAEBAQAAAAAAAIAAAAEBB9DtnUBAAAAAAAEPueBAKOFggAAgACjzoEAA4BwBwCdASqwAJAAAEcIhYWIhYSIAgIABhwJ7kPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99YAD+/6tQgKOFggADgAqjhYIAD4AOo4WCACSADqOZgQArADECAAEQEAAYABhYL/QACIBDmAYAAKOFggA6gA6jhYIAT4AOo5mBAFMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAGSADqOFggB6gA6jmYEAewAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAj4AOo5mBAKMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAKSADqOFggC6gA6jmYEAywAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAz4AOo4WCAOSADqOZgQDzADECAAEQEAAYABhYL/QACIBDmAYAAKOFggD6gA6jhYIBD4AOo5iBARsAEQIAARAQFGAAYWC/0AAiAQ5gGACjhYIBJIAOo4WCATqADqOZgQFDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggFPgA6jhYIBZIAOo5mBAWsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAXqADqOFggGPgA6jmYEBkwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIBpIAOo4WCAbqADqOZgQG7ADECAAEQEAAYABhYL/QACIBDmAYAAKOFggHPgA6jmYEB4wAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIB5IAOo4WCAfqADqOZgQILADECAAEQEAAYABhYL/QACIBDmAYAAKOFggIPgA6jhYICJIAOo5mBAjMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAjqADqOFggJPgA6jmYECWwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYICZIAOo4WCAnqADqOZgQKDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggKPgA6jhYICpIAOo5mBAqsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCArqADqOFggLPgA6jmIEC0wARAgABEBAUYABhYL/QACIBDmAYAKOFggLkgA6jhYIC+oAOo5mBAvsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAw+ADqOZgQMjADECAAEQEAAYABhYL/QACIBDmAYAAKOFggMkgA6jhYIDOoAOo5mBA0sAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA0+ADqOFggNkgA6jmYEDcwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIDeoAOo4WCA4+ADqOZgQObADECAAEQEAAYABhYL/QACIBDmAYAAKOFggOkgA6jhYIDuoAOo5mBA8MAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA8+ADqOFggPkgA6jhYID+oAOo4WCBA+ADhxTu2sBAAAAAAAAEbuPs4EDt4r3gQHxghEr8IEK",mp4="data:video/mp4;base64, AAAAHGZ0eXBNNFYgAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXTeBAAAbGliZmFhYyAxLjI4AABCAJMgBDIARwAAArEGBf//rdxF6b3m2Ui3lizYINkj7u94MjY0IC0gY29yZSAxNDIgcjIgOTU2YzhkOCAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTQgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0wIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDE6MHgxMTEgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT03NjggdmJ2X2J1ZnNpemU9MzAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAFZliIQL8mKAAKvMnJycnJycnJycnXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXiEASZACGQAjgCEASZACGQAjgAAAAAdBmjgX4GSAIQBJkAIZACOAAAAAB0GaVAX4GSAhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGagC/AySEASZACGQAjgAAAAAZBmqAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZrAL8DJIQBJkAIZACOAAAAABkGa4C/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmwAvwMkhAEmQAhkAI4AAAAAGQZsgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGbQC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm2AvwMkhAEmQAhkAI4AAAAAGQZuAL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGboC/AySEASZACGQAjgAAAAAZBm8AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZvgL8DJIQBJkAIZACOAAAAABkGaAC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmiAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpAL8DJIQBJkAIZACOAAAAABkGaYC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmoAvwMkhAEmQAhkAI4AAAAAGQZqgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGawC/AySEASZACGQAjgAAAAAZBmuAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZsAL8DJIQBJkAIZACOAAAAABkGbIC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm0AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZtgL8DJIQBJkAIZACOAAAAABkGbgCvAySEASZACGQAjgCEASZACGQAjgAAAAAZBm6AnwMkhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AAAAhubW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAABDcAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAzB0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+kAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPpAAAAAAABAAAAAAKobWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAB1MAAAdU5VxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACU21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAhNzdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAkABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3ZAsTsBEAAAPpAADqYA8UKkgEABWjLg8sgAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAAeAAAD6QAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAAIxzdHN6AAAAAAAAAAAAAAAeAAADDwAAAAsAAAALAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAAiHN0Y28AAAAAAAAAHgAAAEYAAANnAAADewAAA5gAAAO0AAADxwAAA+MAAAP2AAAEEgAABCUAAARBAAAEXQAABHAAAASMAAAEnwAABLsAAATOAAAE6gAABQYAAAUZAAAFNQAABUgAAAVkAAAFdwAABZMAAAWmAAAFwgAABd4AAAXxAAAGDQAABGh0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAABDcAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAQkAAADcAABAAAAAAPgbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAAykBVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAADi21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADT3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVBbjYAAu4AAAADcoFgICAAhGQBoCAgAECAAAAIHN0dHMAAAAAAAAAAgAAADIAAAQAAAAAAQAAAkAAAAFUc3RzYwAAAAAAAAAbAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAEAAAABAAAABAAAAAIAAAABAAAABgAAAAEAAAABAAAABwAAAAIAAAABAAAACAAAAAEAAAABAAAACQAAAAIAAAABAAAACgAAAAEAAAABAAAACwAAAAIAAAABAAAADQAAAAEAAAABAAAADgAAAAIAAAABAAAADwAAAAEAAAABAAAAEAAAAAIAAAABAAAAEQAAAAEAAAABAAAAEgAAAAIAAAABAAAAFAAAAAEAAAABAAAAFQAAAAIAAAABAAAAFgAAAAEAAAABAAAAFwAAAAIAAAABAAAAGAAAAAEAAAABAAAAGQAAAAIAAAABAAAAGgAAAAEAAAABAAAAGwAAAAIAAAABAAAAHQAAAAEAAAABAAAAHgAAAAIAAAABAAAAHwAAAAQAAAABAAAA4HN0c3oAAAAAAAAAAAAAADMAAAAaAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAACMc3RjbwAAAAAAAAAfAAAALAAAA1UAAANyAAADhgAAA6IAAAO+AAAD0QAAA+0AAAQAAAAEHAAABC8AAARLAAAEZwAABHoAAASWAAAEqQAABMUAAATYAAAE9AAABRAAAAUjAAAFPwAABVIAAAVuAAAFgQAABZ0AAAWwAAAFzAAABegAAAX7AAAGFwAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTUuMzMuMTAw",oldIOS=function(){return"undefined"!=typeof navigator&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream},nativeWakeLock=function(){return"wakeLock"in navigator},NoSleep=function(){function e(){var t=this;_classCallCheck$4(this,e),this.enabled=!1,nativeWakeLock()?(this._wakeLock=null,this.handleVisibilityChange=function(){null!==t._wakeLock&&"visible"===document.visibilityState&&t.enable()},document.addEventListener("visibilitychange",this.handleVisibilityChange),document.addEventListener("fullscreenchange",this.handleVisibilityChange)):oldIOS()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"mp4",mp4),this._addSourceToVideo(this.noSleepVideo,"webm",webm),this.noSleepVideo.addEventListener("loadedmetadata",(function(){t.noSleepVideo&&(t.noSleepVideo.duration<=1?t.noSleepVideo.setAttribute("loop",""):(t.onTimeupdate=function(){t.noSleepVideo.currentTime>.5&&(t.noSleepVideo.currentTime=Math.random())},t.noSleepVideo.addEventListener("timeupdate",t.onTimeupdate)))})))}return _createClass$5(e,[{key:"_addSourceToVideo",value:function(e,t,r){var n=document.createElement("source");n.src=r,n.type="video/".concat(t),e.appendChild(n)}},{key:"isEnabled",get:function(){return this.enabled}},{key:"enable",value:function(){var e=this;if(nativeWakeLock())return navigator.wakeLock.request("screen").then((function(t){e._wakeLock=t,e.enabled=!0,e._wakeLock.addEventListener("release",(function(){console.log("Wake Lock released.")}))})).catch((function(t){e.enabled=!1,console.error("".concat(t.name,", ").concat(t.message))}));if(oldIOS())return this.disable(),console.warn("\n        NoSleep enabled for older iOS devices. This can interrupt\n        active or long-running network requests from completing successfully.\n        See https://github.com/richtr/NoSleep.js/issues/15 for more details.\n      "),this.noSleepTimer=window.setInterval((function(){document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))}),15e3),this.enabled=!0,Promise.resolve();if(this.noSleepVideo.paused){var t=this.noSleepVideo.play();return t&&t.then((function(t){return e.enabled=!0,t})).catch((function(t){console.log("noSleep: ",t.message),e.enabled=!1}))}}},{key:"disable",value:function(){nativeWakeLock()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):oldIOS()?this.noSleepTimer&&(console.warn("\n          NoSleep now disabled for older iOS devices.\n        "),window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}},{key:"toPlay",value:function(){if(this.noSleepVideo&&this.noSleepVideo.paused){var e=performance.now();this.lastTs||(this.lastTs=e),e-this.lastTs>1e4&&(this.enable(),this.lastTs=e)}}},{key:"destroy",value:function(){this.disable(),this.handleVisibilityChange&&(document.removeEventListener("visibilitychange",this.handleVisibilityChange),document.removeEventListener("fullscreenchange",this.handleVisibilityChange)),this.onTimeupdate&&this.noSleepVideo.removeEventListener("timeupdate",this.onTimeupdate),this.noSleepVideo=null}}]),e}(),ele;function initBgSilenceAudio(){if(!document.querySelector("#hackAudioPP")){var e=document.createElement("div");e.innerHTML="<audio id='hackAudioPP'></audio>",document.body.appendChild(e);var t=e.children.item(0);t.controls=!1,t.preload="auto",t.innerHTML="<source src=".concat("data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA//////////////////////////////////////////////////////////////////8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//sQxAADgnABGiAAQBCqgCRMAAgEAH///////////////7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq//////////////////9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",' type="audio/mpeg"></source>'),t.muted=!0,t.loop=!0,t.play().catch((function(){}))}}function playSlienceAudio(){var e=ele||(ele=document.querySelector("#hackAudioPP"));e||initBgSilenceAudio(),!1===e.paused&&!1===e.muted||(e.muted=!1,e.play().catch((function(e){console.log("bgAudio: ",e.message)})))}function pauseSlienceAudio(){var e=ele||(ele=document.querySelector("#hackAudioPP"));e&&e.pause()}(function(){var e=window.Document.prototype.createElement,t=window.Document.prototype.createElementNS,r=window.Document.prototype.importNode,n=window.Document.prototype.prepend,i=window.Document.prototype.append,a=window.DocumentFragment.prototype.prepend,o=window.DocumentFragment.prototype.append,s=window.Node.prototype.cloneNode,u=window.Node.prototype.appendChild,c=window.Node.prototype.insertBefore,l=window.Node.prototype.removeChild,d=window.Node.prototype.replaceChild,h=Object.getOwnPropertyDescriptor(window.Node.prototype,"textContent"),f=window.Element.prototype.attachShadow,p=Object.getOwnPropertyDescriptor(window.Element.prototype,"innerHTML"),g=window.Element.prototype.getAttribute,y=window.Element.prototype.setAttribute,m=window.Element.prototype.removeAttribute,v=window.Element.prototype.getAttributeNS,_=window.Element.prototype.setAttributeNS,b=window.Element.prototype.removeAttributeNS,A=window.Element.prototype.insertAdjacentElement,E=window.Element.prototype.insertAdjacentHTML,S=window.Element.prototype.prepend,T=window.Element.prototype.append,w=window.Element.prototype.before,C=window.Element.prototype.after,k=window.Element.prototype.replaceWith,I=window.Element.prototype.remove,$=window.HTMLElement,P=Object.getOwnPropertyDescriptor(window.HTMLElement.prototype,"innerHTML"),x=window.HTMLElement.prototype.insertAdjacentElement,R=window.HTMLElement.prototype.insertAdjacentHTML,O=new Set;function D(e){var t=O.has(e);return e=/^[a-z][.0-9_a-z]*-[\-.0-9_a-z]*$/.test(e),!t&&e}"annotation-xml color-profile font-face font-face-src font-face-uri font-face-format font-face-name missing-glyph".split(" ").forEach((function(e){return O.add(e)}));var L=document.contains?document.contains.bind(document):document.documentElement.contains.bind(document.documentElement);function M(e){var t=e.isConnected;if(void 0!==t)return t;if(L(e))return!0;for(;e&&!(e.__CE_isImportDocument||e instanceof Document);)e=e.parentNode||(window.ShadowRoot&&e instanceof ShadowRoot?e.host:void 0);return!(!e||!(e.__CE_isImportDocument||e instanceof Document))}function N(e){var t=e.children;if(t)return Array.prototype.slice.call(t);for(t=[],e=e.firstChild;e;e=e.nextSibling)e.nodeType===Node.ELEMENT_NODE&&t.push(e);return t}function B(e,t){for(;t&&t!==e&&!t.nextSibling;)t=t.parentNode;return t&&t!==e?t.nextSibling:null}function U(e,t,r){for(var n=e;n;){if(n.nodeType===Node.ELEMENT_NODE){var i=n;t(i);var a=i.localName;if("link"===a&&"import"===i.getAttribute("rel")){if(n=i.import,void 0===r&&(r=new Set),n instanceof Node&&!r.has(n))for(r.add(n),n=n.firstChild;n;n=n.nextSibling)U(n,t,r);n=B(e,i);continue}if("template"===a){n=B(e,i);continue}if(i=i.__CE_shadowRoot)for(i=i.firstChild;i;i=i.nextSibling)U(i,t,r)}n=n.firstChild?n.firstChild:B(e,n)}}function G(e,t,r){e[t]=r}function V(e){var t=document;this.c=e,this.a=t,this.b=void 0,re(this.c,this.a),"loading"===this.a.readyState&&(this.b=new MutationObserver(this.f.bind(this)),this.b.observe(this.a,{childList:!0,subtree:!0}))}function F(e){e.b&&e.b.disconnect()}function j(){var e=this;this.b=this.a=void 0,this.c=new Promise((function(t){e.b=t,e.a&&t(e.a)}))}function H(e){if(e.a)throw Error("Already resolved.");e.a=void 0,e.b&&e.b(void 0)}function Z(e){this.f=new Map,this.g=new Map,this.l=new Map,this.i=!1,this.b=e,this.j=new Map,this.c=function(e){return e()},this.a=!1,this.h=[],this.m=e.f?new V(e):void 0}function W(e,t){if(!D(t))throw new SyntaxError("The element name '"+t+"' is not valid.");if(Y(e,t))throw Error("A custom element with name '"+t+"' has already been defined.");if(e.i)throw Error("A custom element is already being defined.")}function K(e,t,r){var n;e.i=!0;try{var i=function(e){var t=a[e];if(void 0!==t&&!(t instanceof Function))throw Error("The '"+e+"' callback must be a function.");return t},a=r.prototype;if(!(a instanceof Object))throw new TypeError("The custom element constructor's prototype is not an object.");var o=i("connectedCallback"),s=i("disconnectedCallback"),u=i("adoptedCallback"),c=(n=i("attributeChangedCallback"))&&r.observedAttributes||[]}catch(l){throw l}finally{e.i=!1}return r={localName:t,constructorFunction:r,connectedCallback:o,disconnectedCallback:s,adoptedCallback:u,attributeChangedCallback:n,observedAttributes:c,constructionStack:[]},e.g.set(t,r),e.l.set(r.constructorFunction,r),r}function X(e){if(!1!==e.a){e.a=!1;for(var t=[],r=e.h,n=new Map,i=0;i<r.length;i++)n.set(r[i],[]);for(re(e.b,document,{upgrade:function(r){if(void 0===r.__CE_state){var i=r.localName,a=n.get(i);a?a.push(r):e.g.has(i)&&t.push(r)}}}),i=0;i<t.length;i++)ne(e.b,t[i]);for(i=0;i<r.length;i++){for(var a=r[i],o=n.get(a),s=0;s<o.length;s++)ne(e.b,o[s]);(a=e.j.get(a))&&H(a)}r.length=0}}function Y(e,t){var r=e.g.get(t);if(r)return r;if(r=e.f.get(t)){e.f.delete(t);try{return K(e,t,r())}catch(n){ae(n)}}}function z(){var e=ce&&ce.noDocumentConstructionObserver,t=ce&&ce.shadyDomFastWalk;this.b=[],this.c=[],this.a=!1,this.shadyDomFastWalk=t,this.f=!e}function J(e,t,r,n){var i=window.ShadyDOM;if(e.shadyDomFastWalk&&i&&i.inUse){if(t.nodeType===Node.ELEMENT_NODE&&r(t),t.querySelectorAll)for(e=i.nativeMethods.querySelectorAll.call(t,"*"),t=0;t<e.length;t++)r(e[t])}else U(t,r,n)}function Q(e,t){e.a&&J(e,t,(function(t){return q(e,t)}))}function q(e,t){if(e.a&&!t.__CE_patched){t.__CE_patched=!0;for(var r=0;r<e.b.length;r++)e.b[r](t);for(r=0;r<e.c.length;r++)e.c[r](t)}}function ee(e,t){var r=[];for(J(e,t,(function(e){return r.push(e)})),t=0;t<r.length;t++){var n=r[t];1===n.__CE_state?e.connectedCallback(n):ne(e,n)}}function te(e,t){var r=[];for(J(e,t,(function(e){return r.push(e)})),t=0;t<r.length;t++){var n=r[t];1===n.__CE_state&&e.disconnectedCallback(n)}}function re(e,t,r){var n=(r=void 0===r?{}:r).s,i=r.upgrade||function(t){return ne(e,t)},a=[];for(J(e,t,(function(t){if(e.a&&q(e,t),"link"===t.localName&&"import"===t.getAttribute("rel")){var r=t.import;r instanceof Node&&(r.__CE_isImportDocument=!0,r.__CE_registry=document.__CE_registry),r&&"complete"===r.readyState?r.__CE_documentLoadHandled=!0:t.addEventListener("load",(function(){var r=t.import;if(!r.__CE_documentLoadHandled){r.__CE_documentLoadHandled=!0;var a=new Set;n&&(n.forEach((function(e){return a.add(e)})),a.delete(r)),re(e,r,{s:a,upgrade:i})}}))}else a.push(t)}),n),t=0;t<a.length;t++)i(a[t])}function ne(e,t){try{var r=t.ownerDocument,n=r.__CE_registry,i=n&&(r.defaultView||r.__CE_isImportDocument)?Y(n,t.localName):void 0;if(i&&void 0===t.__CE_state){i.constructionStack.push(t);try{try{if(new i.constructorFunction!==t)throw Error("The custom element constructor did not produce the element being upgraded.")}finally{i.constructionStack.pop()}}catch(u){throw t.__CE_state=2,u}if(t.__CE_state=1,t.__CE_definition=i,i.attributeChangedCallback&&t.hasAttributes()){var a=i.observedAttributes;for(i=0;i<a.length;i++){var o=a[i],s=t.getAttribute(o);null!==s&&e.attributeChangedCallback(t,o,null,s,null)}}M(t)&&e.connectedCallback(t)}}catch(u){ae(u)}}function ie(r,n,i,a){var o=n.__CE_registry;if(o&&(null===a||"http://www.w3.org/1999/xhtml"===a)&&(o=Y(o,i)))try{var s=new o.constructorFunction;if(void 0===s.__CE_state||void 0===s.__CE_definition)throw Error("Failed to construct '"+i+"': The returned value was not constructed with the HTMLElement constructor.");if("http://www.w3.org/1999/xhtml"!==s.namespaceURI)throw Error("Failed to construct '"+i+"': The constructed element's namespace must be the HTML namespace.");if(s.hasAttributes())throw Error("Failed to construct '"+i+"': The constructed element must not have any attributes.");if(null!==s.firstChild)throw Error("Failed to construct '"+i+"': The constructed element must not have any children.");if(null!==s.parentNode)throw Error("Failed to construct '"+i+"': The constructed element must not have a parent node.");if(s.ownerDocument!==n)throw Error("Failed to construct '"+i+"': The constructed element's owner document is incorrect.");if(s.localName!==i)throw Error("Failed to construct '"+i+"': The constructed element's local name is incorrect.");return s}catch(u){return ae(u),n=null===a?e.call(n,i):t.call(n,a,i),Object.setPrototypeOf(n,HTMLUnknownElement.prototype),n.__CE_state=2,n.__CE_definition=void 0,q(r,n),n}return q(r,n=null===a?e.call(n,i):t.call(n,a,i)),n}function ae(e){var t=e.message,r=e.sourceURL||e.fileName||"",n=e.line||e.lineNumber||0,i=e.column||e.columnNumber||0,a=void 0;void 0===ErrorEvent.prototype.initErrorEvent?a=new ErrorEvent("error",{cancelable:!0,message:t,filename:r,lineno:n,colno:i,error:e}):((a=document.createEvent("ErrorEvent")).initErrorEvent("error",!1,!0,t,r,n),a.preventDefault=function(){Object.defineProperty(this,"defaultPrevented",{configurable:!0,get:function(){return!0}})}),void 0===a.error&&Object.defineProperty(a,"error",{configurable:!0,enumerable:!0,get:function(){return e}}),window.dispatchEvent(a),a.defaultPrevented||console.error(e)}V.prototype.f=function(e){var t=this.a.readyState;for("interactive"!==t&&"complete"!==t||F(this),t=0;t<e.length;t++)for(var r=e[t].addedNodes,n=0;n<r.length;n++)re(this.c,r[n])},Z.prototype.o=function(e,t){var r=this;if(!(t instanceof Function))throw new TypeError("Custom element constructor getters must be functions.");W(this,e),this.f.set(e,t),this.h.push(e),this.a||(this.a=!0,this.c((function(){return X(r)})))},Z.prototype.define=function(e,t){var r=this;if(!(t instanceof Function))throw new TypeError("Custom element constructors must be functions.");W(this,e),K(this,e,t),this.h.push(e),this.a||(this.a=!0,this.c((function(){return X(r)})))},Z.prototype.upgrade=function(e){re(this.b,e)},Z.prototype.get=function(e){if(e=Y(this,e))return e.constructorFunction},Z.prototype.whenDefined=function(e){if(!D(e))return Promise.reject(new SyntaxError("'"+e+"' is not a valid custom element name."));var t=this.j.get(e);if(t)return t.c;t=new j,this.j.set(e,t);var r=this.g.has(e)||this.f.has(e);return e=-1===this.h.indexOf(e),r&&e&&H(t),t.c},Z.prototype.polyfillWrapFlushCallback=function(e){this.m&&F(this.m);var t=this.c;this.c=function(r){return e((function(){return t(r)}))}},window.CustomElementRegistry=Z,Z.prototype.define=Z.prototype.define,Z.prototype.upgrade=Z.prototype.upgrade,Z.prototype.get=Z.prototype.get,Z.prototype.whenDefined=Z.prototype.whenDefined,Z.prototype.polyfillDefineLazy=Z.prototype.o,Z.prototype.polyfillWrapFlushCallback=Z.prototype.polyfillWrapFlushCallback,z.prototype.connectedCallback=function(e){var t=e.__CE_definition;if(t.connectedCallback)try{t.connectedCallback.call(e)}catch(r){ae(r)}},z.prototype.disconnectedCallback=function(e){var t=e.__CE_definition;if(t.disconnectedCallback)try{t.disconnectedCallback.call(e)}catch(r){ae(r)}},z.prototype.attributeChangedCallback=function(e,t,r,n,i){var a=e.__CE_definition;if(a.attributeChangedCallback&&a.observedAttributes.indexOf(t)>-1)try{a.attributeChangedCallback.call(e,t,r,n,i)}catch(o){ae(o)}};var oe=new function(){};function se(e,t,r){function n(t){return function(r){for(var n=[],i=0;i<arguments.length;++i)n[i]=arguments[i];i=[];for(var a=[],o=0;o<n.length;o++){var s=n[o];if(s instanceof Element&&M(s)&&a.push(s),s instanceof DocumentFragment)for(s=s.firstChild;s;s=s.nextSibling)i.push(s);else i.push(s)}for(t.apply(this,n),n=0;n<a.length;n++)te(e,a[n]);if(M(this))for(n=0;n<i.length;n++)(a=i[n])instanceof Element&&ee(e,a)}}void 0!==r.prepend&&G(t,"prepend",n(r.prepend)),void 0!==r.append&&G(t,"append",n(r.append))}function ue(e){function r(t,r){Object.defineProperty(t,"innerHTML",{enumerable:r.enumerable,configurable:!0,get:r.get,set:function(t){var n=this,i=void 0;if(M(this)&&(i=[],J(e,this,(function(e){e!==n&&i.push(e)}))),r.set.call(this,t),i)for(var a=0;a<i.length;a++){var o=i[a];1===o.__CE_state&&e.disconnectedCallback(o)}return this.ownerDocument.__CE_registry?re(e,this):Q(e,this),t}})}function n(t,r){G(t,"insertAdjacentElement",(function(t,n){var i=M(n);return t=r.call(this,t,n),i&&te(e,n),M(t)&&ee(e,n),t}))}function i(t,r){function n(t,r){for(var n=[];t!==r;t=t.nextSibling)n.push(t);for(r=0;r<n.length;r++)re(e,n[r])}G(t,"insertAdjacentHTML",(function(e,t){if("beforebegin"===(e=e.toLowerCase())){var i=this.previousSibling;r.call(this,e,t),n(i||this.parentNode.firstChild,this)}else if("afterbegin"===e)i=this.firstChild,r.call(this,e,t),n(this.firstChild,i);else if("beforeend"===e)i=this.lastChild,r.call(this,e,t),n(i||this.firstChild,null);else{if("afterend"!==e)throw new SyntaxError("The value provided ("+String(e)+") is not one of 'beforebegin', 'afterbegin', 'beforeend', or 'afterend'.");i=this.nextSibling,r.call(this,e,t),n(this.nextSibling,i)}}))}f&&G(Element.prototype,"attachShadow",(function(t){if(t=f.call(this,t),e.a&&!t.__CE_patched){t.__CE_patched=!0;for(var r=0;r<e.b.length;r++)e.b[r](t)}return this.__CE_shadowRoot=t})),p&&p.get?r(Element.prototype,p):P&&P.get?r(HTMLElement.prototype,P):function(e,t){e.a=!0,e.c.push(t)}(e,(function(e){r(e,{enumerable:!0,configurable:!0,get:function(){return s.call(this,!0).innerHTML},set:function(e){var r="template"===this.localName,n=r?this.content:this,i=t.call(document,this.namespaceURI,this.localName);for(i.innerHTML=e;n.childNodes.length>0;)l.call(n,n.childNodes[0]);for(e=r?i.content:i;e.childNodes.length>0;)u.call(n,e.childNodes[0])}})})),G(Element.prototype,"setAttribute",(function(t,r){if(1!==this.__CE_state)return y.call(this,t,r);var n=g.call(this,t);y.call(this,t,r),r=g.call(this,t),e.attributeChangedCallback(this,t,n,r,null)})),G(Element.prototype,"setAttributeNS",(function(t,r,n){if(1!==this.__CE_state)return _.call(this,t,r,n);var i=v.call(this,t,r);_.call(this,t,r,n),n=v.call(this,t,r),e.attributeChangedCallback(this,r,i,n,t)})),G(Element.prototype,"removeAttribute",(function(t){if(1!==this.__CE_state)return m.call(this,t);var r=g.call(this,t);m.call(this,t),null!==r&&e.attributeChangedCallback(this,t,r,null,null)})),G(Element.prototype,"removeAttributeNS",(function(t,r){if(1!==this.__CE_state)return b.call(this,t,r);var n=v.call(this,t,r);b.call(this,t,r);var i=v.call(this,t,r);n!==i&&e.attributeChangedCallback(this,r,n,i,t)})),x?n(HTMLElement.prototype,x):A&&n(Element.prototype,A),R?i(HTMLElement.prototype,R):E&&i(Element.prototype,E),se(e,Element.prototype,{prepend:S,append:T}),function(e){function t(t){return function(r){for(var n=[],i=0;i<arguments.length;++i)n[i]=arguments[i];i=[];for(var a=[],o=0;o<n.length;o++){var s=n[o];if(s instanceof Element&&M(s)&&a.push(s),s instanceof DocumentFragment)for(s=s.firstChild;s;s=s.nextSibling)i.push(s);else i.push(s)}for(t.apply(this,n),n=0;n<a.length;n++)te(e,a[n]);if(M(this))for(n=0;n<i.length;n++)(a=i[n])instanceof Element&&ee(e,a)}}var r=Element.prototype;void 0!==w&&G(r,"before",t(w)),void 0!==C&&G(r,"after",t(C)),void 0!==k&&G(r,"replaceWith",(function(t){for(var r=[],n=0;n<arguments.length;++n)r[n]=arguments[n];n=[];for(var i=[],a=0;a<r.length;a++){var o=r[a];if(o instanceof Element&&M(o)&&i.push(o),o instanceof DocumentFragment)for(o=o.firstChild;o;o=o.nextSibling)n.push(o);else n.push(o)}for(a=M(this),k.apply(this,r),r=0;r<i.length;r++)te(e,i[r]);if(a)for(te(e,this),r=0;r<n.length;r++)(i=n[r])instanceof Element&&ee(e,i)})),void 0!==I&&G(r,"remove",(function(){var t=M(this);I.call(this),t&&te(e,this)}))}(e)}var ce=window.customElements;function le(){var t=new z;!function(t){window.HTMLElement=function(){function r(){var r=this.constructor,n=document.__CE_registry.l.get(r);if(!n)throw Error("Failed to construct a custom element: The constructor was not registered with `customElements`.");var i=n.constructionStack;if(0===i.length)return i=e.call(document,n.localName),Object.setPrototypeOf(i,r.prototype),i.__CE_state=1,i.__CE_definition=n,q(t,i),i;var a=i.length-1,o=i[a];if(o===oe)throw Error("Failed to construct '"+n.localName+"': This element was already constructed.");return i[a]=oe,Object.setPrototypeOf(o,r.prototype),q(t,o),o}return r.prototype=$.prototype,Object.defineProperty(r.prototype,"constructor",{writable:!0,configurable:!0,enumerable:!1,value:r}),r}()}(t),function(e){G(Document.prototype,"createElement",(function(t){return ie(e,this,t,null)})),G(Document.prototype,"importNode",(function(t,n){return t=r.call(this,t,!!n),this.__CE_registry?re(e,t):Q(e,t),t})),G(Document.prototype,"createElementNS",(function(t,r){return ie(e,this,r,t)})),se(e,Document.prototype,{prepend:n,append:i})}(t),se(t,DocumentFragment.prototype,{prepend:a,append:o}),function(e){function t(t,r){Object.defineProperty(t,"textContent",{enumerable:r.enumerable,configurable:!0,get:r.get,set:function(t){if(this.nodeType===Node.TEXT_NODE)r.set.call(this,t);else{var n=void 0;if(this.firstChild){var i=this.childNodes,a=i.length;if(a>0&&M(this)){n=Array(a);for(var o=0;o<a;o++)n[o]=i[o]}}if(r.set.call(this,t),n)for(t=0;t<n.length;t++)te(e,n[t])}}})}G(Node.prototype,"insertBefore",(function(t,r){if(t instanceof DocumentFragment){var n=N(t);if(t=c.call(this,t,r),M(this))for(r=0;r<n.length;r++)ee(e,n[r]);return t}return n=t instanceof Element&&M(t),r=c.call(this,t,r),n&&te(e,t),M(this)&&ee(e,t),r})),G(Node.prototype,"appendChild",(function(t){if(t instanceof DocumentFragment){var r=N(t);if(t=u.call(this,t),M(this))for(var n=0;n<r.length;n++)ee(e,r[n]);return t}return r=t instanceof Element&&M(t),n=u.call(this,t),r&&te(e,t),M(this)&&ee(e,t),n})),G(Node.prototype,"cloneNode",(function(t){return t=s.call(this,!!t),this.ownerDocument.__CE_registry?re(e,t):Q(e,t),t})),G(Node.prototype,"removeChild",(function(t){var r=t instanceof Element&&M(t),n=l.call(this,t);return r&&te(e,t),n})),G(Node.prototype,"replaceChild",(function(t,r){if(t instanceof DocumentFragment){var n=N(t);if(t=d.call(this,t,r),M(this))for(te(e,r),r=0;r<n.length;r++)ee(e,n[r]);return t}n=t instanceof Element&&M(t);var i=d.call(this,t,r),a=M(this);return a&&te(e,r),n&&te(e,t),a&&ee(e,t),i})),h&&h.get?t(Node.prototype,h):function(e,t){e.a=!0,e.b.push(t)}(e,(function(e){t(e,{enumerable:!0,configurable:!0,get:function(){for(var e=[],t=this.firstChild;t;t=t.nextSibling)t.nodeType!==Node.COMMENT_NODE&&e.push(t.textContent);return e.join("")},set:function(e){for(;this.firstChild;)l.call(this,this.firstChild);null!=e&&""!==e&&u.call(this,document.createTextNode(e))}})}))}(t),ue(t),t=new Z(t),document.__CE_registry=t,Object.defineProperty(window,"customElements",{configurable:!0,enumerable:!0,value:t})}ce&&!ce.forcePolyfill&&"function"==typeof ce.define&&"function"==typeof ce.get||le(),window.__CE_installPolyfill=le}).call(self),function(){if(void 0!==window.Reflect&&void 0!==window.customElements&&!window.customElements.polyfillWrapFlushCallback){var e=HTMLElement,t=function(){return Reflect.construct(e,[],this.constructor)};window.HTMLElement=t,HTMLElement.prototype=e.prototype,HTMLElement.prototype.constructor=HTMLElement,Object.setPrototypeOf(HTMLElement,e)}}();var DevLogger=function(){function t(){var r=this;_classCallCheck$4(this,t);try{var n=/xgd=(\d)/.exec(document.cookie);this._status=!!n,this._level=n&&n[1]}catch(e){this._status=!1}["group","groupEnd","log","warn","error"].forEach((function(e){r[e]=function(t,n,i,a,o,s,u,c,l,d){var h;if(r._status){var f=t,p=[n,i,a,o,s,u,c,l,d].filter((function(e){return void 0!==e}));(h=console)[e].apply(h,["["+f+"]:"].concat(_toConsumableArray$1(p)))}}}))}return _createClass$5(t,[{key:"enable",get:function(){return this._status}},{key:"long",get:function(){return"2"===this._level}}]),t}(),logger=new DevLogger;function debounce(e,t){var r=Date.now(),n=null,i=!0;return function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];var u=Date.now();i&&(r=Date.now(),i=!1,e.apply(void 0,o)),u-r>t?(r=u,e.apply(void 0,o)):(n&&window.clearTimeout(n),n=setTimeout((function(){e.apply(void 0,o)}),t))}}function getAvcc(e,t){if(e&&t){var r=new Uint8Array(e.byteLength+t.byteLength+11);r[0]=1,r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=255,r[5]=225;var n=6;return r.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),n),n+=2,r.set(e,n),r[n+=e.byteLength]=1,n++,r.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),n),n+=2,r.set(t,n),r}}var Events={AUDIO:{AUDIO_READY:"audio_ready",AUDIO_WAITING:"audio_waiting",AUDIO_SYNC_DTS:"audio_sync_dts"},VIDEO:{VIDEO_DECODER_INIT:"video_decode_init",VIDEO_READY:"video_ready",VIDEO_WAITING:"video_waiting",AUTO_RUN:"auto_run",DECODE_LOW_FPS:"decode_low_fps",UPDATE_VIDEO_FILLTYPE:"update_video_filltype",UPDATE_VIDEO_COVER_POSITION:"update_video_cover_position"},TIMELINE:{PLAY_EVENT:"play_event",SET_METADATA:"set_metadata",APPEND_CHUNKS:"append_chunks",START_RENDER:"start_render",DO_PLAY:"do_play",DO_PAUSE:"do_pause",DO_SEEK:"do_seek",SYNC_DTS:"sync_dts",RESET_BASE_DTS:"reset_base_dts",UPDATE_VOLUME:"update_volume",SINGLE_TRACK:"single_track",DESTROY:"destroy",READY:"ready",UPDATE_GL_OPTIONS:"update_gl_options",SET_VIDEO_DURATION:"set_video_duration",SET_PLAY_MODE:"set_play_mode",UPDATE_CAPABILITY_LEVEL:"update_capability_level",INNER_DEGRADE:"inner_degrade",ADJUST_SEEK_TIME:"adjust_seek_time",CHASE_FRAME:"chase_frame",END_OF_STREAM:"end_of_stream",UPDATE_SEGMENT_END:"update_segment_end"},VIDEO_EVENTS:{WAITING:"waiting",CANPLAY:"canplay",PLAY:"play",PLAYING:"playing",PAUSE:"pause",SEEKING:"seeking",SEEKED:"seeked",LOADEDDATA:"loadeddata",TIMEUPDATE:"timeupdate",DURATION_CHANGE:"durationchange",VOLUME_CHANGE:"volumechange",PROGRESS:"progress",ERROR:"error",ENDED:"ended",RESIZE:"resize",DECODE_FPS:"decodefps",LOW_DECODE:"lowdecode",LARGE_AV_GAP:"largeavgap",FIRST_FRAME:"firstframe"},DECODE_EVENTS:{INIT:"init",READY:"decoderready",REMUX:"remux",INIT_FAILED:"initfailed",DATAREADY:"dataReady",PLAY_FAILED:"playfailed",FRAGMENT_END:"fragmentEnd",APPEND_VIDEO:"appendVideo",FIRST_FRAME:"firstFrame",DECODED:"decoded",RENDE_END:"rendeEnd",CHASE_VIDEO_FRAME:"chaseVideoFrame",CHASE_VIDEO_FRAME_END:"chaseVideoFrameEnd",CHASE_AUDIO_FRAME:"chaseAudioFrame",INIT_SEGMENT:"initSegment",MEDIA_SEGMENT:"mediaSegment",FRAME_MAX_COUNY:"frameMaxCount",FRAME_MIN_COUNY:"frameMinCount"}};function _createSuper$b(e){var t=_isNativeReflectConstruct$b();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$b(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var BaseRender=function(e){_inherits$4(r,e);var t=_createSuper$b(r);function r(e,n){var i;return _classCallCheck$4(this,r),(i=t.call(this))._config=e,i._parent=n,i._meta=null,i._ready=!1,i._isLive=!0,i._innerDegrade=!1,i._singleTrack=-1,i}return _createClass$5(r,[{key:"isLive",get:function(){return this._isLive}},{key:"innerDegrade",get:function(){return this._innerDegrade}},{key:"noAudio",get:function(){return 1===this._singleTrack||2===this._singleTrack}},{key:"noVideo",get:function(){return 3===this._singleTrack}},{key:"_bindEvents",value:function(){var e=this;this._parent.on(Events.TIMELINE.SET_METADATA,this._setMetadata.bind(this)),this._parent.on(Events.TIMELINE.APPEND_CHUNKS,this._appendChunk.bind(this)),this._parent.on(Events.TIMELINE.RESET_BASE_DTS,this._resetDts.bind(this)),this._parent.on(Events.TIMELINE.START_RENDER,this._startRender.bind(this)),this._parent.on(Events.TIMELINE.DO_PLAY,this._doPlay.bind(this)),this._parent.on(Events.TIMELINE.DO_PAUSE,this._doPause.bind(this)),this._parent.on(Events.TIMELINE.DO_SEEK,this._doSeek.bind(this)),this._parent.on(Events.TIMELINE.DESTROY,this._destroy.bind(this)),this._parent.on(Events.TIMELINE.CHASE_FRAME,this._doChaseFrame.bind(this)),this._parent.on(Events.TIMELINE.SINGLE_TRACK,(function(t){e._singleTrack=t})),this._parent.on(Events.TIMELINE.SET_PLAY_MODE,(function(t){e._isLive="LIVE"===t})),this._parent.on(Events.TIMELINE.INNER_DEGRADE,(function(){e._innerDegrade=!0})),this._parent.on(Events.TIMELINE.SET_VIDEO_DURATION,(function(t){e._timeRange.duration=t}))}}]),r}(EventEmitter$1),TOLERANCE$1=.5,AudioTimeRange=function(){function e(t){_classCallCheck$4(this,e),this.TAG="AudioTimeRange",this._parent=t,this._buffers=[],this._duration=0,this._baseDts=0,this._lastBuffer=null}return _createClass$5(e,[{key:"isLive",get:function(){return this._parent.isLive}},{key:"duration",get:function(){return this._duration},set:function(e){this._duration=e}},{key:"buffered",get:function(){var e=this;if(this.isLive)return{length:this._duration?1:0,start:function(){return 0},end:function(){return e._duration}};var t=this._mergeBufferRanges();return{length:t.length,start:function(e){var r=t[e];return r?r.start:0},end:function(e){var r=t[e];return r?r.end:1/0}}}},{key:"resetDts",value:function(e){this._baseDts=e}},{key:"dump",value:function(){for(var e=this.buffered,t=e.length,r="",n=0;n<t;n++)r+="".concat(e.start(n),"~").concat(e.end(n)," ");console.log(r)}},{key:"_transitionSamples",value:function(e){for(var t=e.numberOfChannels,r=e.length,n=512,i=0;i<t;i++){for(var a=e.getChannelData(i),o=0;o<n;o++)a[o]=a[o]*o/n;for(var s=r-n;s<r;s++)a[s]=a[s]*(r-s)/n}}},{key:"append",value:function(e,t,r,n){-1===this._baseDts&&(this._baseDts=r),this._transitionSamples(e);var i=(r-this._baseDts)/1e3,a=i+t,o={start:i,end:a,startDts:r,source:e,duration:t,delay:n};if(logger.log(this.TAG,"add new buffer range, startDts:".concat(r,", [").concat(o.start," , ").concat(o.end,"]")),!this._buffers.filter((function(e){return e.start===i})).length)return this._buffers.push(o),this.isLive&&(this._duration=a),o.start;console.error("éŸ³é¢‘é‡å¤")}},{key:"deletePassed",value:function(e){return this._buffers=this._buffers.filter((function(t){return t.start>=e})),this._buffers[0]}},{key:"canSeek",value:function(e){var t=this._buffers[this._buffers.length-1];return!!t&&!(t.start<e)}},{key:"_mergeBufferRanges",value:function(){var e=this._buffers.slice().sort((function(e,t){return e.start>t.start?1:-1})),t=e.length,r=[];if(!t)return r;for(var n={start:e[0].start,end:e[0].end},i=1;i<t;i++){var a=e[i];Math.abs(n.end-a.start)<TOLERANCE$1?n.end=a.end:(r.push(n),n={start:a.start,end:a.end})}return r.push(n),r}},{key:"getBuffer",value:function(e){if(this.isLive)return this._buffers.shift();var t=this._buffers.filter((function(t){return t.start<e+TOLERANCE$1&&t.end>e+TOLERANCE$1}))[0];return logger.log(this.TAG,"get audio buffer , currentTime:".concat(e," ,buffer:[").concat(t&&t.start," , ").concat(t&&t.end,"]")),0!==e||t?t:this._buffers[0]}},{key:"hasBuffer",value:function(){var e;return!(null===(e=this._buffers)||void 0===e||!e.length)}}]),e}(),Alaw2lpcm=[-5504,-5248,-6016,-5760,-4480,-4224,-4992,-4736,-7552,-7296,-8064,-7808,-6528,-6272,-7040,-6784,-2752,-2624,-3008,-2880,-2240,-2112,-2496,-2368,-3776,-3648,-4032,-3904,-3264,-3136,-3520,-3392,-22016,-20992,-24064,-23040,-17920,-16896,-19968,-18944,-30208,-29184,-32256,-31232,-26112,-25088,-28160,-27136,-11008,-10496,-12032,-11520,-8960,-8448,-9984,-9472,-15104,-14592,-16128,-15616,-13056,-12544,-14080,-13568,-344,-328,-376,-360,-280,-264,-312,-296,-472,-456,-504,-488,-408,-392,-440,-424,-88,-72,-120,-104,-24,-8,-56,-40,-216,-200,-248,-232,-152,-136,-184,-168,-1376,-1312,-1504,-1440,-1120,-1056,-1248,-1184,-1888,-1824,-2016,-1952,-1632,-1568,-1760,-1696,-688,-656,-752,-720,-560,-528,-624,-592,-944,-912,-1008,-976,-816,-784,-880,-848,5504,5248,6016,5760,4480,4224,4992,4736,7552,7296,8064,7808,6528,6272,7040,6784,2752,2624,3008,2880,2240,2112,2496,2368,3776,3648,4032,3904,3264,3136,3520,3392,22016,20992,24064,23040,17920,16896,19968,18944,30208,29184,32256,31232,26112,25088,28160,27136,11008,10496,12032,11520,8960,8448,9984,9472,15104,14592,16128,15616,13056,12544,14080,13568,344,328,376,360,280,264,312,296,472,456,504,488,408,392,440,424,88,72,120,104,24,8,56,40,216,200,248,232,152,136,184,168,1376,1312,1504,1440,1120,1056,1248,1184,1888,1824,2016,1952,1632,1568,1760,1696,688,656,752,720,560,528,624,592,944,912,1008,976,816,784,880,848],Ulaw2lpcm=[-32124,-31100,-30076,-29052,-28028,-27004,-25980,-24956,-23932,-22908,-21884,-20860,-19836,-18812,-17788,-16764,-15996,-15484,-14972,-14460,-13948,-13436,-12924,-12412,-11900,-11388,-10876,-10364,-9852,-9340,-8828,-8316,-7932,-7676,-7420,-7164,-6908,-6652,-6396,-6140,-5884,-5628,-5372,-5116,-4860,-4604,-4348,-4092,-3900,-3772,-3644,-3516,-3388,-3260,-3132,-3004,-2876,-2748,-2620,-2492,-2364,-2236,-2108,-1980,-1884,-1820,-1756,-1692,-1628,-1564,-1500,-1436,-1372,-1308,-1244,-1180,-1116,-1052,-988,-924,-876,-844,-812,-780,-748,-716,-684,-652,-620,-588,-556,-524,-492,-460,-428,-396,-372,-356,-340,-324,-308,-292,-276,-260,-244,-228,-212,-196,-180,-164,-148,-132,-120,-112,-104,-96,-88,-80,-72,-64,-56,-48,-40,-32,-24,-16,-8,0,32124,31100,30076,29052,28028,27004,25980,24956,23932,22908,21884,20860,19836,18812,17788,16764,15996,15484,14972,14460,13948,13436,12924,12412,11900,11388,10876,10364,9852,9340,8828,8316,7932,7676,7420,7164,6908,6652,6396,6140,5884,5628,5372,5116,4860,4604,4348,4092,3900,3772,3644,3516,3388,3260,3132,3004,2876,2748,2620,2492,2364,2236,2108,1980,1884,1820,1756,1692,1628,1564,1500,1436,1372,1308,1244,1180,1116,1052,988,924,876,844,812,780,748,716,684,652,620,588,556,524,492,460,428,396,372,356,340,324,308,292,276,260,244,228,212,196,180,164,148,132,120,112,104,96,88,80,72,64,56,48,40,32,24,16,8,0],silenceFrame=new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);function _doubleCheckSampleRateIndex(e,t){var r=(7&e[0])<<1|e[1]>>>7;return r!==t?r:t}function _constructAdtsHeader(e,t){var r=e.sampleRateIndex,n=e.channelCount;r=_doubleCheckSampleRateIndex(e.config,r);var i=new Uint8Array(7);i[0]=255,i[1]=240,i[1]=1|i[1],i[2]=64,i[2]=i[2]|60&r<<2,i[2]=i[2]|1&n>>2,i[3]=192&n<<6;var a=t.byteLength+7;return i[3]=i[3]|3&a>>11,i[4]=255&a>>3,i[5]=224&a<<5,i[5]=31|i[5],i[6]=252,i}function packageAACToAdts(e,t){var r=new Uint8Array(t.data.byteLength+7),n=_constructAdtsHeader(e,t.data);return r.set(n),r.set(t.data,7),r}function concatAdts(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0,n=0,i=e.length;n<i;n++)t&&n%t==0||(r+=e[n].byteLength);for(var a=new Uint8Array(r),o=0,s=0,u=e.length;s<u;s++)t&&s%t==0||(a.set(e[s],o),o+=e[s].byteLength);return a}function _decodeAlaw(e){for(var t=new Uint8Array(2*e.length),r=0,n=0;r<e.length;){var i=Alaw2lpcm[e[r]];if(void 0===i)throw new Error("can not decode g711 alaw data!");t[n]=255&i,t[n+1]=i>>8,r+=1,n+=2}return t}function _decodeUlaw(e){for(var t=new Uint8Array(2*e.length),r=0,n=0;r<e.length;){var i=Ulaw2lpcm[e[r]];if(void 0===i)throw new Error("can not decode g711 ulaw data!");t[n]=255&i,t[n+1]=i>>8,r+=1,n+=2}return t}function decodeG711(e,t){if("g7110a"===t)return _decodeAlaw(e);if("g7110m"===t)return _decodeUlaw(e);throw new Error("no supported format=".concat(t," for g711"))}function _getSampleCount(e,t,r){return e/t/r}function _uint16ToFloat32(e){return e>=32768?-(65536-e)/32768:e/32767}function createAudioBufferFromPcm(e,t,r,n,i){for(var a=_getSampleCount(t.byteLength,r,i),o=e.createBuffer(r,a,n),s=new DataView(t),u=0;u<r;u++)for(var c=o.getChannelData(u),l=void 0,d=0;d<a;d++)l=s.getUint16(d*(2*r)+2*u,!0),c[d]=_uint16ToFloat32(l);return{audioBuffer:o,duration:a/n}}function checkRefillFrame(e){e.length;var t=e[0].dts,r=e.filter((function(e){return e.dts===t})).length;if(!(r<=1))for(var n=0;n<r;n++)e[n].data=silenceFrame}var AudioHelper={decodeG711:decodeG711,createAudioBufferFromPcm:createAudioBufferFromPcm,packageAACToAdts:packageAACToAdts,concatAdts:concatAdts,checkRefillFrame:checkRefillFrame};function _createSuper$a(e){var t=_isNativeReflectConstruct$a();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var AudioContext=window.AudioContext||window.webkitAudioContext,MEDIA_ERR_DECODE$1=3,ERROR_MSG={INIT_AUDIO_ERR:"create new AudioContext error",DECODE_ERR:"audio data decode error"},AudioRender=function(t){_inherits$4(a,t);var r,n,i=_createSuper$a(a);function a(e,t){var r;return _classCallCheck$4(this,a),_defineProperty$5(_assertThisInitialized$4(r=i.call(this,e,t)),"emitTimelineEvents",r._emitTimelineEvents),r.TAG="AudioRender",r._timeRange=new AudioTimeRange(_assertThisInitialized$4(r)),r._lastTimeLineTime=0,r._sampleQueue=[],r._source=null,r._audioCanAutoplay=!0,r._lastBuffer=null,r._inDecoding=!1,r._endOfStream=!1,r._delay=0,r._isSourceBufferEnd=-1,r._onSourceBufferEnded=r._onSourceBufferEnded.bind(_assertThisInitialized$4(r)),r._initAudioCtx(e.volume||.6),r._bindEvents(),r}return _createClass$5(a,[{key:"baseDts",get:function(){return this._timeRange._baseDts}},{key:"currentTime",get:function(){return this._audioCtx?this._lastTimeLineTime+this._audioCtx.currentTime:0}},{key:"duration",get:function(){return this._timeRange.duration}},{key:"preloadTime",get:function(){return this.isLive?1:0}},{key:"timescale",get:function(){return 1e3}},{key:"buffered",get:function(){return this._timeRange.buffered}},{key:"ctxState",get:function(){return this._audioCtx.state}},{key:"audioCanAutoplay",get:function(){return this._audioCanAutoplay}},{key:"resume",value:function(){if(this._audioCtx&&"suspended"===this._audioCtx.state)return this._audioCtx.resume().catch((function(e){}))}},{key:"dump",value:function(){return this._timeRange.dump()}},{key:"canSeek",value:function(e){return this._timeRange.canSeek(e)}},{key:"_assembleErr",value:function(e){var t=new Error(e);return t.code=MEDIA_ERR_DECODE$1,t}},{key:"_emitTimelineEvents",value:function(e,t,r){var n,i;null===(n=this._parent)||void 0===n||null===(i=n.emit)||void 0===i||i.call(n,e,t,r)}},{key:"_initAudioCtx",value:function(e){var t=this;return logger.log(this.TAG,"init audioCtx"),this._audioCtx=new AudioContext,this._audioCtx?(this._gainNode=this._audioCtx.createGain(),this._gainNode.gain.value=e,this._gainNode.connect(this._audioCtx.destination),this._audioCanAutoplay="running"===this._audioCtx.state,logger.log(this.TAG,"webAudio state:",this._audioCtx.state),initBgSilenceAudio(),this._bindAudioCtxEvent(),this._audioCtx.suspend()):(logger.warn(this.TAG,"create webaudio error!"),void setTimeout((function(){t._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,"error",t._assembleErr(ERROR_MSG.INIT_AUDIO_ERR))})))}},{key:"_bindAudioCtxEvent",value:function(){var e=this;this._onStateChange=function(){e._audioCtx&&"running"===e._audioCtx.state&&e._ready&&e._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.PLAYING)},this._audioCtx.addEventListener("statechange",this._onStateChange)}},{key:"_bindEvents",value:function(){var e=this;_get(_getPrototypeOf$4(a.prototype),"_bindEvents",this).call(this),this._parent.on(Events.DECODE_EVENTS.CHASE_AUDIO_FRAME,this._doChaseFrame.bind(this)),this._parent.on(Events.TIMELINE.UPDATE_VOLUME,(function(t){e._gainNode&&(e._gainNode.gain.value=isFinite(t)?t:1,e._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.VOLUME_CHANGE))})),this._parent.on(Events.TIMELINE.END_OF_STREAM,(function(){var t;e._endOfStream=!0,e.noAudio||null!==(t=e._timeRange)&&void 0!==t&&t.hasBuffer()||null==e||e._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.ENDED)}))}},{key:"_setMetadata",value:function(e,t){"video"!==e&&(this.noAudio||(logger.warn(this.TAG,"audio set metadata",t),this._meta=t))}},{key:"_appendChunk",value:function(e,t){if(!this.noAudio){this._meta||(this._meta=t,logger.warn(this.TAG,"audio set metadata",this._meta));var r=t.samples;if(r.length)if(this._sampleQueue=this._sampleQueue.concat(r),t.samples=[],"aac"===this._meta.codecType){if(this._inDecoding)return;this._decodeAACWrapper()}else this._decodeG711()}}},{key:"_resetDts",value:function(e,t){"video"!==t&&this._timeRange.resetDts(e)}},{key:"_doPlay",value:function(){this.noAudio||this._parent.seeking||(this._source||!this.currentTime?this.resume():this._startRender())}},{key:"_doPause",value:function(){this.noAudio||this._audioCtx.suspend()}},{key:"_reInitAudioCtx",value:function(e){var t=this;if(this._lastTimeLineTime=e,this._lastBuffer=null,this._lastAudioBufferInfo=null,this._delay=0,!this._ready||!this._audioCtx.currentTime)return Promise.resolve();var r=this._gainNode.gain.value;return this._audioCtx.close().then((function(){return t._audioCtx.removeEventListener("statechange",t._onStateChange),t._audioCtx=null,t._source&&t._source.removeEventListener("ended",t._onSourceBufferEnded),t._source=null,t._initAudioCtx(r)}))}},{key:"_doSeek",value:function(e){var t=this;this._reInitAudioCtx(e).then((function(){t._getAudioBuffer(!0)})).catch((function(e){}))}},{key:"_doChaseFrame",value:function(e){var t=this,r=e.position,n=this._timeRange.deletePassed(r);n&&(logger.log(this.TAG,"_doChaseFrame","startTime:",n.start,"buffeLength:",this.buffered.end(0)-n.start),this._reInitAudioCtx(n.start).then((function(){t._startRender(),t._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.TIMEUPDATE)})).catch((function(e){})))}},{key:"_decodeAACWrapper",value:(n=_asyncToGenerator$1(regenerator.mark((function e(){var t,r,n,i,a,o,s,u,c,l;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._sampleQueue.length,r=this._sampleQueue[0],n=this._sampleQueue[t-1],!((i=(n.dts-r.dts)/this.timescale)<1)){e.next=6;break}return e.abrupt("return");case 6:for(a=parseInt(i/3-1)||1,o=parseInt(t/a),s=[],u=0;u<a;u++)u<a-1?s.push(this._sampleQueue.slice(u*o,(u+1)*o)):s.push(this._sampleQueue.slice(u*o));return this._sampleQueue=[],this._inDecoding=!0,e.prev=12,e.next=15,this._decodeCycle(s);case 15:this._isLive||(c=this._timeRange._buffers,(l=c[c.length-1])&&this.emitTimelineEvents(Events.TIMELINE.UPDATE_SEGMENT_END,l.end)),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(12),this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,"error",this._assembleErr("ERROR_MSG.DECODE_ERR:".concat(e.t0&&e.t0.message)));case 21:this._inDecoding=!1;case 22:case"end":return e.stop()}}),e,this,[[12,18]])}))),function(){return n.apply(this,arguments)})},{key:"_decodeCycle",value:(r=_asyncToGenerator$1(regenerator.mark((function e(t){var r;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.shift()){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this._decodeAAC(r);case 5:return e.next=7,this._decodeCycle(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_decodeAAC",value:function(e){var t=this,r=e[0],n=0;AudioHelper.checkRefillFrame(e);var i=e.map((function(e){return AudioHelper.packageAACToAdts(t._meta,e)})),a=AudioHelper.concatAdts(i,0);return new Promise((function(e,i){var o=t._audioCtx.decodeAudioData(a.buffer,(function(i){if(t._timeRange){if(t._lastAudioBufferInfo&&t.isLive){var a=t._lastAudioBufferInfo,o=a.dts+a.duration;(n=r.dts-o)>1&&(t._timeRange._duration+=n/1e3,logger.log(t.TAG,"_decodeAAC","audio data dts is not continue, last end dts:",o,",now start Dts:",r.dts,"delay:",n))}t._lastAudioBufferInfo={duration:Math.floor(1e3*i.duration),dts:r.dts};var s=t._timeRange.append(i,i.duration,r.dts,n/1e3);if(!t._ready){var u=Math.abs(s+i.duration-t.currentTime)<.5;(t.isLive||!u)&&(t._ready=!0,logger.log(t.TAG,"_decodeAAC","set ready true start=",s),t.emit(Events.AUDIO.AUDIO_READY,s))}t._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.PROGRESS),t._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.DURATION_CHANGE),e()}}),i);o.catch&&o.catch(i)}))}},{key:"_decodeG711",value:function(){var t=this._sampleQueue.length,r=this._sampleQueue[0];if(!((this._sampleQueue[t-1].dts-r.dts)/this.timescale<.5)){var n=this._sampleQueue.reduce((function(e,t){return e+=t.data.byteLength}),0),i=new Uint8Array(n),a=0,o=0;this._sampleQueue.forEach((function(e,t){0===t&&(a=e.dts),i.set(e.data,o),o+=e.data.byteLength})),this._sampleQueue=[];try{var s=this._meta,u=s.codecType,c=s.channelCount,l=s.sampleSize,d=s.sampleRate,h=AudioHelper.decodeG711(i,u),f=AudioHelper.createAudioBufferFromPcm(this._audioCtx,h.buffer,c,d,l/8),p=f.audioBuffer,g=f.duration,y=this._timeRange.append(p,g,a,0);this._ready||(this._ready=!0,logger.log(this.TAG,"_decodeG711","set ready true"),this.emit(Events.AUDIO.AUDIO_READY,y)),this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.PROGRESS),this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.DURATION_CHANGE)}catch(e){this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,"error",this._assembleErr("ERROR_MSG.DECODE_ERR:".concat(e&&e.message)))}}}},{key:"_onSourceBufferEnded",value:function(){this._isSourceBufferEnd=!0,logger.long&&logger.log(this.TAG,"source play end! currentTime:".concat(this.currentTime," , duration:").concat(this.duration)),this._checkBufferLength(),this._startRender()}},{key:"_ajustSeekTime",value:function(e){var t=this._timeRange.getBuffer(e,0);t&&(logger.log(this.TAG,"ajust seek time to:",t.start),this._lastTimeLineTime=t.start,this._parent.emit(Events.TIMELINE.ADJUST_SEEK_TIME,t.start))}},{key:"_getAudioBuffer",value:function(e){var t=this;if(this._timeRange){var r=this._timeRange.getBuffer(this._lastBuffer?this._lastBuffer.end:this.currentTime,0);return r?e?(this._ajustSeekTime(r.start),void this.emit(Events.AUDIO.AUDIO_READY)):r:(this._endOfStream||!this._isLive)&&this.currentTime-this.duration>-.5?(this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.TIMEUPDATE),void this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.ENDED)):(this._ready=!1,this._audioCtx.suspend(),this.emit(Events.AUDIO.AUDIO_WAITING),void(e&&(this._onAudioReady||(this._onAudioReady=function(e){t._ajustSeekTime(e)}),this.removeListener(Events.AUDIO.AUDIO_READY,this._onAudioReady),this.once(Events.AUDIO.AUDIO_READY,this._onAudioReady))))}}},{key:"_startRender",value:function(t){if(!this.noAudio){if("video"===t&&this.isLive&&this._ready&&!this._isSourceBufferEnd)return console.log(this.TAG,"_startRender, audio currentTime",this.currentTime,"from:",t,"_isSourceBufferEnd:",this._isSourceBufferEnd,"ready:",this._ready),void this._doPlay();var r=this._getAudioBuffer();if(r){"suspended"===this._audioCtx.state&&(this._audioCtx.resume().catch((function(e){})),playSlienceAudio()),this._lastBuffer=r,this._source=null;var n=this._audioCtx.createBufferSource();n.buffer=r.source,n.loop=!1,this._source=n,n.addEventListener("ended",this._onSourceBufferEnded),n.connect(this._gainNode),r.delay&&r.delay>.001&&(this._delay+=r.delay),this.startDts=r.startDts;try{this._isSourceBufferEnd=!1,n.start(),this._ts=performance.now()}catch(e){}r.startDts&&this._emitTimelineEvents(Events.TIMELINE.SYNC_DTS,r.startDts)}}}},{key:"_checkBufferLength",value:function(){var e=this.currentTime,t=this.buffered.end(0)-e;t>6&&(this._dropSampleGap=50),t<5&&(this._dropSampleGap=0)}},{key:"_destroy",value:function(){logger.log(this.TAG,"destroy audio..."),this._source&&this._source.removeEventListener("ended",this._onSourceBufferEnded),this._audioCtx&&"closed"!==this.ctxState&&this._audioCtx.close(),this._audioCtx=null,this._sampleQueue=null,this._timeRange=null,this._parent=null,this.removeAllListeners()}}]),a}(BaseRender),TOLERANCE=1,VideoTimeRange=function(){function e(t){_classCallCheck$4(this,e),this.TAG="VideoTimeRange",this._parent=t,this._baseDts=0,this._lastDuration=0,this._duration=0,this._bitrate=0,this._totalSize=0,this._buffers=[],this._currentFrameQueue=[],this._frameIndexInQueue=0,this._delayEstimateList=[],this._keyframeQueue=[]}return _createClass$5(e,[{key:"isLive",get:function(){return this._parent.isLive}},{key:"baseDts",get:function(){return this._baseDts}},{key:"duration",get:function(){return this._duration},set:function(e){this._duration=e}},{key:"buffered",get:function(){var e=this;if(this.isLive)return{length:this._duration?1:0,start:function(){return 0},end:function(){return e._duration}};var t=this._mergeBufferRanges();return{length:t.length,start:function(e){var r=t[e];return r?r.start:0},end:function(e){var r=t[e];return r?r.end:1/0}}}},{key:"frameLength",get:function(){return this._currentFrameQueue.length}},{key:"keyFrameLength",get:function(){return this._keyframeQueue.length}},{key:"totalSize",get:function(){return this._totalSize}},{key:"bitrate",get:function(){return this._bitrate},set:function(e){this._bitrate=e}},{key:"lastDuration",get:function(){return this._lastDuration}},{key:"frames",get:function(){return this._currentFrameQueue}},{key:"getCurrentTime",value:function(e){return this._lastDuration+(e-this._baseDts)/1e3}},{key:"resetDts",value:function(e){this._baseDts=e}},{key:"_mergeBufferRanges",value:function(){var e=this._buffers.sort((function(e,t){return e.start>t.start?1:-1})),t=e.length,r=[];if(!t)return r;for(var n={start:e[0].start,end:e[0].end},i=1;i<t;i++){var a=e[i];Math.abs(n.end-a.start)<TOLERANCE?n.end=a.end:(r.push(n),n={start:a.start,end:a.end})}return r.push(n),r}},{key:"_caclBaseDts",value:function(e){-1===this._baseDts&&e&&(this._baseDts=e.dts,logger.log(this.TAG,"set baseDts: ",this._baseDts,"frame len:",this._currentFrameQueue.length))}},{key:"_updateDuration",value:function(e){for(var t=e.length,r=e[t-1],n=0;n<t;n++){var i=e[n];if(i&&i.options&&i.options.meta){var a=e[n-1]||this._currentFrameQueue[this._currentFrameQueue.length-1];a?this._lastDuration+=(a.dts-this._baseDts)/1e3:this._lastDuration=this._duration,logger.log(this.TAG,"updateBaseDts,record lastDuration:",this._lastDuration),this._baseDts=i.dts;break}}r&&(this._duration=(r.dts-this._baseDts)/1e3+this._lastDuration)}},{key:"_estimateBitRate",value:function(e){var t=e.length;if(t<=2){if(this._delayEstimateList=this._delayEstimateList.concat(e),(t=this._delayEstimateList.length)<=30)return;e=this._delayEstimateList,this._delayEstimateList=[]}for(var r=0,n=0;n<t;n++){var i=e[n];r+=i.data?i.data.length:i.units.reduce((function(e,t){return e+t.byteLength}),0)}this._totalSize+=r;var a=r/(e[t-1].dts-e[0].dts);this._bitrate=parseInt(8e3*a)}},{key:"_appendVodBufferWrapper",value:function(e){var t=this;if(e.length){for(var r=[],n=[],i=0,a=e.length;i<a;i++)e[i].keyframe&&n.length>=10&&(r.push(n),n=[]),n.push(e[i]);n.length&&r.push(n),r.forEach((function(e){return t._appendVodBuffer(e)}))}}},{key:"_appendVodBuffer",value:function(e){var t=this;if(e.length){e.forEach((function(e){e.baseDts=t._baseDts}));var r=e[0],n=e[e.length-1],i=(r.dts-this._baseDts)/1e3,a=(n.dts-this._baseDts)/1e3;logger.log(this.TAG,"add new buffer range [".concat(i," , ").concat(a,"]")),this._buffers.filter((function(e){return e.start===i})).length||this._buffers.push({start:i,end:a,duartion:a-i,frames:e.slice()}),this._buffers.sort((function(e,t){return e.start>t.start?1:-1}))}}},{key:"_recordKeyframes",value:function(e){var t=this;e.forEach((function(e){if(e.keyframe){var r=(e.dts-t._baseDts)/1e3;t._keyframeQueue.push({position:r,frame:e})}})),this.isLive&&this._keyframeQueue.length>40&&this._keyframeQueue.splice(0,20)}},{key:"toAnnexBNalu",value:function(e){e.forEach((function(e){var t=e.units;if(t){var r=t.reduce((function(e,t){return e+4+t.byteLength}),0),n=new Uint8Array(r),i=0;t.forEach((function(e){n.set([0,0,0,1],i),i+=4,n.set(e,i),i+=e.byteLength})),e.units=null,e.data=n}}))}},{key:"append",value:function(e,t,r){r&&this.toAnnexBNalu(e),this._caclBaseDts(e[0]),t&&this._updateDuration(e),this._estimateBitRate(e),this._recordKeyframes(e),this.isLive?this._currentFrameQueue=this._currentFrameQueue.concat(e):this._appendVodBufferWrapper(e)}},{key:"updateSegmentEnd",value:function(e){var t=this._buffers[this._buffers.length-1];t&&(Math.abs(t.end-e)<.5||(t.end=e,t.duartion=e-t.start,logger.log(this.TAG,"video data lack, reset end:",e)))}},{key:"getFrame",value:function(){var e;if(this.isLive)return this._currentFrameQueue.shift();if(!(e=this._currentFrameQueue[this._frameIndexInQueue])){if(!(e=this._currentFrameQueue[--this._frameIndexInQueue]))return;return this.switchBuffer((e.dts-e.baseDts)/1e3),this.getFrame()}return this._frameIndexInQueue++,e}},{key:"switchBuffer",value:function(e){var t=this._buffers.filter((function(t){return t.start<e+TOLERANCE&&t.end>e+TOLERANCE}))[0];t?(logger.log(this.TAG,"switch video buffer, time:".concat(e," , buffer:[").concat(t.start," , ").concat(t.end,"]")),this._currentFrameQueue=t.frames.slice()):this._currentFrameQueue=[],this._frameIndexInQueue=0}},{key:"getChaseFrameStartPosition",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(this._keyframeQueue.forEach((function(r){r.position<e&&(t=r)})),t)return e-t.position<r?t:void 0}},{key:"nextFrame",value:function(){return this._currentFrameQueue[0]}},{key:"deletePassed",value:function(e){this._currentFrameQueue=this._currentFrameQueue.filter((function(t){return t.dts>=e}))}},{key:"getDtsOfTime",value:function(e){var t=e-this._lastDuration;return this._baseDts+1e3*t}},{key:"clean",value:function(){this._currentFrameQueue=[]}}]),e}();function _checkClose(e){var t;(null===(t=e.buffer)||void 0===t?void 0:t.close)&&e.buffer.close()}var FrameQueue=function(){function e(t){_classCallCheck$4(this,e),this.TAG="FrameQueue",this._parent=t,this._lastGopId=0,this._frames=[]}return _createClass$5(e,[{key:"currentTimeDts",get:function(){return this._parent.preciseVideoDts}},{key:"length",get:function(){return this._frames.length}},{key:"frames",get:function(){return this._frames}},{key:"append",value:function(e){if(e.info){var t=e.info,r=t.dts,n=t.keyframe,i=t.gopId;i&&i<this._lastGopId&&r<this.currentTimeDts?_checkClose(e):(n&&(this._lastGopId=i),this._frames.push(e),this._frames.sort((function(e,t){return e.info.dts>t.info.dts?1:-1})))}else _checkClose(e)}},{key:"appendVodFrame",value:function(e){this._frames.push(e)}},{key:"nextFrame",value:function(){var e=this._frames.length;return 1===this._parent.noAudio&&e>3&&(this._frames=this._frames.slice(e-2)),this._frames[0]}},{key:"shift",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=this.nextFrame();if(!(r&&r.gopId&&this._lastGopId&&r.gopId<this._lastGopId))return r=this._frames.shift(),this.deletePassed(t),r;this._frames=this._frames.filter((function(t){return t.gopId>=e._lastGopId||_checkClose(t),!0}))}},{key:"deletePassed",value:function(e){this._frames=this._frames.filter((function(t){return!!(t.info&&t.info.dts>e)||(_checkClose(t),!1)}))}},{key:"empty",value:function(){this._frames.forEach((function(e){return _checkClose(e)})),this._frames=[]}},{key:"destroy",value:function(){this.empty(),this._lastGopId=0}}]),e}(),MAX_QUEUE_LENGTH=5,MAX_LOW_FPS_RECORD=30,DecodeEstimate=function(){function e(t){_classCallCheck$4(this,e),this.TAG="DecodeEstimate",this._needEstimate=!0,this._parent=t,this._lastDecodeDot=0,this._lastDecodeCost=0,this._lastFrameDts=0,this._dtsDeltas=[],this._decodeCosts=[],this._lowDecodeQueue=[],this._fps=0,this._decodeFps=0,this._gopLength=0,this._webcodec=!1}return _createClass$5(e,[{key:"fps",get:function(){return this._fps}},{key:"decodeFps",get:function(){return this._decodeFps}},{key:"decodeCost",get:function(){return this._lastDecodeCost}},{key:"gopLength",get:function(){return this._gopLength}},{key:"webcodec",set:function(e){this._webcodec=e}},{key:"updateGopCount",value:function(){this._gopLength++}},{key:"needEstimateFps",value:function(){this._needEstimate=!0}},{key:"addDecodeInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{dts:0};this._estimateDecodeFps(e),this._estimateFps(e)}},{key:"resetDecodeDot",value:function(e){this._lastDecodeDot=e||0}},{key:"reset",value:function(){this._decodeCosts=[],this._lowDecodeQueue=[]}},{key:"_estimateFps",value:function(e){if(this._needEstimate)if(this._lastFrameDts){var t=e.dts-this._lastFrameDts;if(this._lastFrameDts=e.dts,!(Math.abs(t)>200)){this._dtsDeltas.push(t);var r=this._dtsDeltas.length;r<MAX_QUEUE_LENGTH||(this._fps=Math.ceil(1e3/this._avg(this._dtsDeltas,r)),logger.log(this.TAG,"estimate fps:",this._fps),this._needEstimate=!1)}}else this._lastFrameDts=e.dts}},{key:"_estimateDecodeFps",value:function(e){if(this._lastDecodeDot){var t=performance.now(),r=t-this._lastDecodeDot;this._lastDecodeDot=t,e.cost=r,this._lastDecodeCost=r,this._decodeCosts.push(r);var n=this._decodeCosts.length;if(!(n<MAX_QUEUE_LENGTH)){var i=this._avg(this._decodeCosts,n);this._decodeFps=Math.floor(1e3/i),this._decodeCosts=[],this._lowDecodeDetect()}}else this._lastDecodeDot=performance.now()}},{key:"_avg",value:function(e,t){var r=e.reduce((function(e,t){return e+=t}),0);return Math.floor(r/t)||1}},{key:"_lowDecodeDetect",value:function(){this._decodeFps?(this._decodeFps<this._fps+(this.webcodec?0:3)?this._lowDecodeQueue.push(this._decodeFps):this._lowDecodeQueue.pop(),this._lowDecodeQueue.length>MAX_LOW_FPS_RECORD&&(this._lowDecodeQueue=[],logger.log(this.TAG,"è§£ç æ•ˆçŽ‡è¿‡ä½Ž,åº”è¯¥é™çº§"),this._parent.emit(Events.VIDEO.DECODE_LOW_FPS))):this._parent.emit(Events.VIDEO.DECODE_LOW_FPS)}}]),e}(),shell="\n    var timer;\n\n    function initTimer (interval) {\n      destroy()\n      clearInterval(timer);\n      timer = setInterval(() => {\n          self.postMessage({type: 'NEXT_TICK'});\n      }, interval)\n    }\n\n    function destroy () {\n      clearInterval(timer);\n    }\n\n    self.onmessage = function (e) {\n      var {type,interval} = e.data;\n      switch (type) {\n          case 'START':\n            initTimer(interval);\n            break;\n          case 'DESTROY':\n            destroy();\n            break;\n      }\n    }\n",TickTimer=function(){function e(t){_classCallCheck$4(this,e),this._task=t;var r=new Blob([shell],{type:"application/javascript"});this._worker=new Worker(URL.createObjectURL(r)),this._bindEvent()}return _createClass$5(e,[{key:"_bindEvent",value:function(){var e=this;this._worker.addEventListener("message",(function(){e._task()}))}},{key:"start",value:function(e){(e=parseInt(e))<10&&(e=10),e>60?e=60:e>25&&(e=25),this._worker.postMessage({type:"START",interval:e})}},{key:"stop",value:function(){this._worker.postMessage({type:"DESTROY"})}},{key:"destroy",value:function(){this._worker&&(this._worker.postMessage({type:"DESTROY"}),this._worker.terminate(),this._worker=null)}}]),e}();function _createSuper$9(e){var t=_isNativeReflectConstruct$9();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$9(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var HAVE_NOTHING=0,HAVE_METADATA=1,HAVE_CURRENT_DATA=2,HAVE_FUTURE_DATA=3,HAVE_ENOUGH_DATA=4,MEDIA_ERR_DECODE=3,VideoBaseRender=function(e){_inherits$4(r,e);var t=_createSuper$9(r);function r(e,n){var i;return _classCallCheck$4(this,r),(i=t.call(this,e,n))._timeRange=new VideoTimeRange(_assertThisInitialized$4(i)),i._decodeEstimate=new DecodeEstimate(_assertThisInitialized$4(i)),i._frameQueue=new FrameQueue(_assertThisInitialized$4(i)),i._canvas=e.canvas||document.createElement("canvas"),i._lastTimeupdate=0,i._renderCost=0,i._canAutoPlay=!0,i._videoDecode=!1,i._frameRender=null,i._configuration=null,i._render=i._render.bind(_assertThisInitialized$4(i)),i._tickTimer=new TickTimer(i._render),i._initCanvas(),i._bindEvents(),i}return _createClass$5(r,[{key:"canAutoPlay",get:function(){return this._canAutoPlay}},{key:"canvas",get:function(){return this._canvas}},{key:"timescale",get:function(){return 1e3}},{key:"fps",get:function(){return this._decodeEstimate.fps||this._meta&&this._meta.fpsNum/this._meta.fpsDen||24}},{key:"decodeFps",get:function(){return this._decodeEstimate.decodeFps}},{key:"decodeCost",get:function(){return this._decodeEstimate.decodeCost}},{key:"renderCost",get:function(){return this._renderCost}},{key:"totalSize",get:function(){return this._timeRange.totalSize}},{key:"bitrate",get:function(){return this._timeRange.bitrate},set:function(e){this._timeRange.bitrate=e}},{key:"gopLength",get:function(){return this._decodeEstimate.gopLength}},{key:"is540p",get:function(){return this._canvas.height<720}},{key:"duration",get:function(){return this._timeRange.duration}},{key:"buffered",get:function(){return this._timeRange.buffered}},{key:"interval",get:function(){return Math.floor(1e3/this.fps)}},{key:"baseDts",get:function(){return this._timeRange.baseDts}},{key:"currentTime",get:function(){return this._timeRange.getCurrentTime(this.preciseVideoDts)}},{key:"timelinePosition",get:function(){return this._parent.timelinePosition}},{key:"lastTimelinePosition",get:function(){return this._lastTimelinePosition||0},set:function(e){this._lastTimelinePosition=e}},{key:"audioSyncDts",get:function(){return this._audioDts||this.baseDts},set:function(e){this._audioDts=e}},{key:"preciseVideoDts",get:function(){return this.audioSyncDts+Math.floor(1e3*(this.timelinePosition-this.lastTimelinePosition))}},{key:"readyState",get:function(){var e=this._frameQueue.length||(this.currentTime?1:0);return e?e>=8?HAVE_ENOUGH_DATA:e>=4?HAVE_FUTURE_DATA:e>=2?HAVE_CURRENT_DATA:HAVE_METADATA:HAVE_NOTHING}},{key:"isHevc",get:function(){return!("hev1.1.6.L93.B0"!==(this._meta||{}).codec)}},{key:"videoDecode",get:function(){return this._videoDecode}},{key:"decoderMode",get:function(){var e;return null===(e=this._decodeController)||void 0===e?void 0:e.decoderMode}},{key:"configuration",get:function(){var e,t;return this._configuration||(this._configuration=this._meta.configuration||getAvcc(null===(e=this._meta)||void 0===e?void 0:e.sps[0],null===(t=this._meta)||void 0===t?void 0:t.pps[0])),this._configuration},set:function(e){this._configuration=e.configuration||getAvcc(e.sps[0],e.pps[0])}},{key:"getDtsOfTime",value:function(e){return this._timeRange.getDtsOfTime(e)}},{key:"updateReady",value:function(){this._whenReady()}},{key:"forceRender",value:function(){this._render(!0)}},{key:"getChaseFrameStartPosition",value:function(e,t){return this._timeRange.getChaseFrameStartPosition(e,t)}},{key:"canSeek",value:function(){throw new Error("need override by children")}},{key:"emitResizeEvent",value:function(){null==this||this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.RESIZE)}},{key:"_assembleErr",value:function(e){var t=new Error(e);return t.code=MEDIA_ERR_DECODE,t}},{key:"_emitTimelineEvents",value:function(e,t,r){var n;null===(n=this._parent)||void 0===n||n.emit(e,t,r)}},{key:"_initCanvas",value:function(){this._canvas.style.margin="auto",this._canvas.style.position="absolute",this._canvas.style.pointerEvents="none"}},{key:"_bindEvents",value:function(){var e=this;_get(_getPrototypeOf$4(r.prototype),"_bindEvents",this).call(this);var t=function(t){var r=t.width,n=t.height,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e._canvas,s=o.width,u=o.height,c=n*s/u,l=r*u/s,d=r-c,h=n-l,f=d*i+"px",p=h*a+"px";e._canvas.style.left=f,e._canvas.style.top=p,logger.warn(e.TAG,"cvsWidth=".concat(s,", cvsHeight=").concat(u,", scaleCvsWidth=").concat(c,", scaleCvsHeight=").concat(l)),logger.warn(e.TAG,"cover position: deltaX=".concat(d,", deltaY=").concat(h,", width=").concat(r,", height=").concat(n,", pX=").concat(f,", pY=").concat(p))};this._parent.on(Events.VIDEO.UPDATE_VIDEO_FILLTYPE,(function(r,n){var i=n.width,a=n.height,o=e._canvas,s=o.width,u=o.height,c=!i||i/a>s/u;if(logger.warn(e.TAG,"UPDATE_VIDEO_FILLTYPE isGapX =",c,"type =",r,s,u,i,a),e._canvas.style.maxWidth="initial",e._canvas.style.maxHeight="initial","cover"===r)return c?(e._canvas.style.left=0,e._canvas.style.top=0,e._canvas.style.height="auto",e._canvas.style.width="100%",void t({width:i,height:a},0,.5)):(e._canvas.style.left=0,e._canvas.style.top=0,e._canvas.style.width="auto",e._canvas.style.height="100%",void t({width:i,height:a},.5,0));if("fill"===r)return e._canvas.style.width="100%",void(e._canvas.style.height="100%");(e._canvas.style.top=0,e._canvas.style.bottom=0,e._canvas.style.left=0,e._canvas.style.right=0,e._canvas.style.maxWidth="100%",e._canvas.style.maxHeight="100%",e._canvas.style.width="initial",e._canvas.style.height="initial",s<i&&u<a)&&(s/i>u/a?e._canvas.style.width="100%":e._canvas.style.height="100%")})),this._parent.on(Events.VIDEO.UPDATE_VIDEO_COVER_POSITION,t),this._parent.on(Events.TIMELINE.SYNC_DTS,(function(t){var r,n=e._frameQueue.nextFrame();if(e.lastTimelinePosition=e.timelinePosition,e.noAudio){var i=e._timeRange.nextFrame();t=t||n&&n.info.dts||i&&i.dts||e.preciseVideoDts}e.audioSyncDts=t;var a=n&&n.info&&n.info.dts;if(a&&a-t>500&&e._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.LARGE_AV_GAP,{aDts:t,vDts:a,frameLength:e._frameQueue.length,currentTime:e._parent.currentTime,duration:e._parent.duration}),logger.log(e.TAG,"audio current buffer play finish, next buffer dts=",t,"currentTime:",e._parent.currentTime,"next video frame dts:",a,"frame length:",e._frameQueue.length),!(e._isLive||null!==(r=e._parent)&&void 0!==r&&r.seeking)){var o=e._timeRange.nextFrame();if(o){var s=(o.dts-o.baseDts)/1e3;e._parent.currentTime-s>1&&(logger.warn(e.TAG,"è§†é¢‘è§£ç å¤ªæ…¢,ä¸¢å¸§!"),e.ajustSeekTime(e._parent.currentTime))}}})),this._parent.on(Events.TIMELINE.UPDATE_GL_OPTIONS,(function(t){e._config.glCtxOptions=t})),this._parent.on(Events.TIMELINE.UPDATE_SEGMENT_END,this._updateSegmentEnd.bind(this)),this.on(Events.VIDEO.AUTO_RUN,this._startRender.bind(this))}},{key:"ajustSeekTime",value:function(){throw new Error("need override by children")}},{key:"_resetDts",value:function(e,t){"audio"!==t&&this._timeRange.resetDts(e)}},{key:"_setMetadata",value:function(e,t){if("audio"!==e){logger.warn(this.TAG,"video set metadata"),this._meta=t;var r=t&&t.frameRate&&t.frameRate.fps;r?logger.log(this.TAG,"detect fps:",r):logger.warn(this.TAG,"no detect fps,start estimate"),this._initDecoder()}}},{key:"_initDecoder",value:function(){throw new Error("need override by children")}},{key:"_whenDecoderReady",value:function(){throw new Error("need override by children")}},{key:"_appendChunk",value:function(){throw new Error("need override by children")}},{key:"_startDecode",value:function(){throw new Error("need override by children")}},{key:"_receiveFrame",value:function(e,t){if(this._parent&&this._timeRange){var r=e.info||{};if(this._decodeEstimate.addDecodeInfo(r),!this._isLive){var n=r&&void 0!==r.baseDts&&(r.dts-r.baseDts)/1e3;if(void 0!==n&&this._parent&&Math.abs(n-this._parent.currentTime)>=4)return void _checkClose(e)}this._isLive?this._frameQueue.append(e):this._frameQueue.appendVodFrame(e),t&&t(),this._ready||this.readyState>=HAVE_METADATA&&this._whenReady()}}},{key:"_startRender",value:function(){this._tickTimer.start(this.interval)}},{key:"_render",value:function(){throw new Error("need override by children")}},{key:"_updateSegmentEnd",value:function(){throw new Error("need override by children")}},{key:"_whenReady",value:function(){this._ready=!0,this.emit(Events.VIDEO.VIDEO_READY),(this.readyState===HAVE_METADATA||this.currentTime<10)&&this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.LOADEDDATA),this.noAudio&&this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.PLAYING)}},{key:"_doPlay",value:function(){this._tickTimer.start()}},{key:"_doPause",value:function(){this._tickTimer.stop()}},{key:"_doSeek",value:function(){this._tickTimer.stop(),this._ready=!1,this._frameQueue.destroy()}},{key:"_doChaseFrame",value:function(){throw new Error("need override by children")}},{key:"destroy",value:function(){this._tickTimer.destroy(),this._frameQueue.destroy(),this._frameRender&&this._frameRender.destroy(),this._canvas=null,this._timeRange=null,this._decodeEstimate=null,this._parent=null,this.removeAllListeners()}}]),r}(BaseRender),YUVCanvas=function(){function t(e,r){_classCallCheck$4(this,t),this.TAG="YUVCanvas",this.configs=Object.assign({},e),this.canvas=this.configs.canvas,this.meta=Object.assign({},this.configs.meta),this.parent=r,this._initMeta(),this._initContextGL(),this.contextGL&&(this._initProgram(),this._initBuffers(),this._initTextures())}return _createClass$5(t,[{key:"_initMeta",value:function(){this.chroma=this.meta.chromaFormat,this.height=this.meta.height,this.width=this.meta.width,this.canvas.width===this.meta.width&&this.canvas.height===this.meta.height||(this.canvas.width=this.meta.width,this.canvas.height=this.meta.height,this.parent.emitResizeEvent())}},{key:"_initContextGL",value:function(){if("2d"!==this.configs.type){for(var t=this.canvas,r=null,n=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=0;!r&&i<n.length;){var a=n[i];try{r=t.getContext(a,this.configs.glCtxOptions),logger.log("YUVCanvas","use=",a,this.configs.glCtxOptions);break}catch(e){r=null}r&&"function"==typeof r.getParameter||(r=null),++i}this.contextGL=r}else this.ctx=this.canvas.getContext("2d")}},{key:"_initProgram",value:function(){var e,t,r=this.contextGL;e=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 uTexturePos;","attribute vec4 vTexturePos;","varying vec2 textureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","  uTextureCoord = uTexturePos.xy;","  vTextureCoord = vTexturePos.xy;","}"].join("\n"),t=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 YUV2RGB;","void main(void) {","  highp float y = texture2D(ySampler,  textureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n");var n=r.createShader(r.VERTEX_SHADER);r.shaderSource(n,e),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS)||console.log("Vertex shader failed to compile: "+r.getShaderInfoLog(n));var i=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(i,t),r.compileShader(i),r.getShaderParameter(i,r.COMPILE_STATUS)||console.log("Fragment shader failed to compile: "+r.getShaderInfoLog(i));var a=r.createProgram();r.attachShader(a,n),r.attachShader(a,i),r.linkProgram(a),r.getProgramParameter(a,r.LINK_STATUS)||console.log("Program failed to compile: "+r.getProgramInfoLog(a)),r.useProgram(a);var o=r.getUniformLocation(a,"YUV2RGB");r.uniformMatrix4fv(o,!1,[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1]),this.shaderProgram=a}},{key:"_initBuffers",value:function(){var e=this.contextGL,t=this.shaderProgram,r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var n=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0);var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var a=e.getAttribLocation(t,"texturePos");e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),this.texturePosBuffer=i;var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var s=e.getAttribLocation(t,"uTexturePos");e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),this.uTexturePosBuffer=o;var u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var c=e.getAttribLocation(t,"vTexturePos");e.enableVertexAttribArray(c),e.vertexAttribPointer(c,2,e.FLOAT,!1,0,0),this.vTexturePosBuffer=u}},{key:"_initTextures",value:function(){var e=this.contextGL,t=this.shaderProgram,r=this._initTexture(),n=e.getUniformLocation(t,"ySampler");e.uniform1i(n,0),this.yTextureRef=r;var i=this._initTexture(),a=e.getUniformLocation(t,"uSampler");e.uniform1i(a,1),this.uTextureRef=i;var o=this._initTexture(),s=e.getUniformLocation(t,"vSampler");e.uniform1i(s,2),this.vTextureRef=o,e.pixelStorei(e.UNPACK_ALIGNMENT,1)}},{key:"_initTexture",value:function(){var e=this.contextGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t}},{key:"_drawPictureGL",value:function(e,t,r,n,i){var a=n*r,o=i*r/2;444!==this.chroma&&422!==this.chroma||(o*=2);var s={yData:(e=new Uint8Array(e)).subarray(0,a),uData:e.subarray(a,a+o),vData:e.subarray(a+o,a+o+o)};this._drawPictureGL420(s,t,r,n,i)}},{key:"_drawPictureGL420",value:function(e,t,r,n,i){var a=this.contextGL,o=this.texturePosBuffer,s=this.uTexturePosBuffer,u=this.vTexturePosBuffer,c=this.yTextureRef,l=this.uTextureRef,d=this.vTextureRef,h=e.yData,f=e.uData,p=e.vData,g=n,y=r,m=i,v=r/2;422!==this.chroma&&444!==this.chroma||(v=r);var _=i,b=v,A=this.canvas.width/this.width,E=this.canvas.height/this.height,S=0,T=0,w=this.canvas.width,C=this.canvas.height;A<E?(C=this.height*this.canvas.width/this.width,T=parseInt((this.canvas.height-this.height*this.canvas.width/this.width)/2)):(w=this.width*this.canvas.height/this.height,S=parseInt((this.canvas.width-this.width*this.canvas.height/this.height)/2)),a.viewport(S,T,w,C);var k=new Float32Array([1,0,0,0,1,1,0,1]);a.bindBuffer(a.ARRAY_BUFFER,o),a.bufferData(a.ARRAY_BUFFER,k,a.DYNAMIC_DRAW);var I=new Float32Array([1,0,0,0,1,1,0,1]);a.bindBuffer(a.ARRAY_BUFFER,s),a.bufferData(a.ARRAY_BUFFER,I,a.DYNAMIC_DRAW);var $=new Float32Array([1,0,0,0,1,1,0,1]);a.bindBuffer(a.ARRAY_BUFFER,u),a.bufferData(a.ARRAY_BUFFER,$,a.DYNAMIC_DRAW),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,c),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,g,y,0,a.LUMINANCE,a.UNSIGNED_BYTE,h),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,l),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,m,v,0,a.LUMINANCE,a.UNSIGNED_BYTE,f),a.activeTexture(a.TEXTURE2),a.bindTexture(a.TEXTURE_2D,d),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,_,b,0,a.LUMINANCE,a.UNSIGNED_BYTE,p),a.drawArrays(a.TRIANGLE_STRIP,0,4)}},{key:"_drawPicture2d",value:function(e){if(e&&this.canvas){this.ctx||(this.ctx=this.canvas.getContext("2d"));var t=e.displayWidth||e.width,r=e.displayHeight||e.height;this.canvas.height===r&&this.canvas.width===t||(this.canvas.height=r,this.canvas.width=t);try{this.ctx.drawImage(e.dom||e,0,0,t,r)}catch(error){console.log(this.ctx,this.ctx.drawImage),console.error(this.TAG,"_drawPicture2d",e,e.dom,error,error.message)}}}},{key:"_resize",value:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.canvas.width=e,this.canvas.height=t,this.parent.emitResizeEvent())}},{key:"render",value:function(e,t,r,n,i){this._resize(t,r),this.contextGL?this._drawPictureGL(e,t,r,n,i):this._drawPicture2d(e)}},{key:"resetMeta",value:function(e){this.meta=Object.assign({},e),this._initMeta()}},{key:"destroy",value:function(){this.contextGL=null,this.shaderProgram=null,this.canvas=null}}]),t}(),TrackType={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},VideoCodecType={AVC:"avc",HEVC:"hevc"};function concatUint8Array(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=t.filter(Boolean);var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){n.set(e,i),i+=e.byteLength})),n}var UINT32_MAX=Math.pow(2,32)-1,MP4=function(){function e(){_classCallCheck$4(this,e)}return _createClass$5(e,null,[{key:"box",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=8+(r=r.filter(Boolean)).reduce((function(e,t){return e+t.byteLength}),0),a=new Uint8Array(i);a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(e,4);var o=8;return r.forEach((function(e){a.set(e,o),o+=e.byteLength})),a}},{key:"ftyp",value:function(t){return t.find((function(e){return e.type===TrackType.VIDEO&&e.codecType===VideoCodecType.HEVC}))?e.FTYPHEV1:e.FTYPAVC1}},{key:"initSegment",value:function(t){return concatUint8Array(e.ftyp(t),e.moov(t))}},{key:"moov",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat(_toConsumableArray$1(t.map((function(t){return e.trak(t)}))),[e.mvex(t)]))}},{key:"mvhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdia(t))}},{key:"tkhd",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minf(t))}},{key:"mdhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,85,196,0,0]))}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"minf",value:function(t){return e.box(e.types.minf,t.type===TrackType.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stbl(t))}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.STTS,e.STSC,e.STSZ,e.STCO)}},{key:"stsd",value:function(t){return e.box(e.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),t.type===TrackType.VIDEO?e.avc1hev1(t):e.mp4a(t))}},{key:"avc1hev1",value:function(t){var r=t.codecType===VideoCodecType.HEVC,n=r?e.types.hvc1:e.types.avc1,i=r?e.hvcC(t):e.avcC(t),a=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i];return t.sarRatio&&t.sarRatio.length>1&&a.push(e.pasp(t.sarRatio)),e.box.apply(e,[n].concat(a))}},{key:"avcC",value:function(t){var r,n=[],i=[];return t.sps.forEach((function(e){r=e.byteLength,n.push(r>>>8&255),n.push(255&r),n.push.apply(n,_toConsumableArray$1(e))})),t.pps.forEach((function(e){r=e.byteLength,i.push(r>>>8&255),i.push(255&r),i.push.apply(i,_toConsumableArray$1(e))})),e.box(e.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|t.sps.length].concat(n).concat([t.pps.length]).concat(i)))}},{key:"hvcC",value:function(t){var r=t.hvcC;if(r instanceof ArrayBuffer)return r;var n,i=t.vps,a=t.sps,o=t.pps;if(r){var s=r.generalProfileCompatibilityFlags,u=r.generalConstraintIndicatorFlags,c=(i.length&&1)+(a.length&&1)+(o.length&&1);n=[1,r.generalProfileSpace<<6|r.generalTierFlag<<5|r.generalProfileIdc,s>>>24,s>>>16,s>>>8,s,u[0],u[1],u[2],u[3],u[4],u[5],r.generalLevelIdc,240,0,252,252|r.chromaFormatIdc,248|r.bitDepthLumaMinus8,248|r.bitDepthChromaMinus8,0,0,r.numTemporalLayers<<3|r.temporalIdNested<<2|3,c];var l=function(e){var t;n.push(e.length>>8,e.length),(t=n).push.apply(t,_toConsumableArray$1(e))};i.length&&(n.push(160,0,i.length),i.forEach(l)),a.length&&(n.push(161,0,a.length),a.forEach(l)),o.length&&(n.push(162,0,o.length),o.forEach(l))}else n=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return e.box(e.types.hvcC,new Uint8Array(n))}},{key:"pasp",value:function(t){var r=_slicedToArray$1(t,2),n=r[0],i=r[1];return e.box(e.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i]))}},{key:"mp4a",value:function(t){return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,255&t.sampleRate,0,0]),t.config.length?e.esds(t.config):void 0)}},{key:"esds",value:function(t){var r=t.length;return e.box(e.types.esds,new Uint8Array([0,0,0,0,3,23+r,0,0,0,4,15+r,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([r]).concat(t).concat([6,1,2])))}},{key:"mvex",value:function(t){return e.box.apply(e,[e.types.mvex].concat(_toConsumableArray$1(t.map((function(t){return e.trex(t.id)})))))}},{key:"trex",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"moof",value:function(t,r){return e.box.apply(e,[e.types.moof,e.mfhd(t)].concat(_toConsumableArray$1(r.map((function(t){return e.traf(t)})))))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"traf",value:function(t){return e.box(e.types.traf,e.tfhd(t.id),e.tfdt(t.baseMediaDecodeTime),e.trun(t.samples,76))}},{key:"tfhd",value:function(t){return e.box(e.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"tfdt",value:function(t){var r=Math.floor(t/(UINT32_MAX+1)),n=Math.floor(t%(UINT32_MAX+1));return e.box(e.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n]))}},{key:"trun",value:function(t,r){var n=t.length,i=12+16*n;r+=8+i;var a=new Uint8Array(i);a.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0);for(var o=0;o<n;o++){var s=t[o],u=s.duration,c=s.size,l=s.flag,d=void 0===l?{}:l,h=s.cts,f=void 0===h?0:h;a.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,c>>>24&255,c>>>16&255,c>>>8&255,255&c,d.isLeading<<2|(null==d.dependsOn?1:d.dependsOn),d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|(null==d.isNonSyncSample?1:d.isNonSyncSample),61440&d.degradationPriority,15&d.degradationPriority,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*o)}return e.box(e.types.trun,a)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"moovMP4",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat(_toConsumableArray$1(t.map((function(t){return e.trackMP4(t)})))))}},{key:"trackMP4",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdiaMP4(t))}},{key:"mdiaMP4",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minfMP4(t))}},{key:"minfMP4",value:function(t){return e.box(e.types.minf,t.type===TrackType.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stblMP4(t))}},{key:"stblMP4",value:function(t){var r=t.ext,n=[e.stsd(t),e.stts(r.stts),e.stsc(r.stsc),e.stsz(r.stsz),e.stco(r.stco)];return r.stss.length&&n.push(e.stss(r.stss)),r.ctts.length&&n.push(e.ctts(r.ctts)),e.box.apply(e,[e.types.stbl].concat(n))}},{key:"stts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.stts,concatUint8Array(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsc",value:function(t){var r=t.length,n=new Uint8Array(12*r),i=0;return t.forEach((function(e){var t=e.firstChunk,r=e.samplesPerChunk,a=e.sampleDescIndex;n.set([t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a],i),i+=12})),e.box(e.types.stsc,concatUint8Array(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsz",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stsz,concatUint8Array(new Uint8Array([0,0,0,0,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stco",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stco,concatUint8Array(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stss",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stss,concatUint8Array(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"ctts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.ctts,concatUint8Array(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}}]),e}();_defineProperty$5(MP4,"types",["avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trun","trex","tkhd","vmhd","smhd","ctts","stss"].reduce((function(e,t){return e[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)],e}),Object.create(null))),_defineProperty$5(MP4,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])}),_defineProperty$5(MP4,"FTYPAVC1",MP4.box(MP4.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))),_defineProperty$5(MP4,"FTYPHEV1",MP4.box(MP4.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49]))),_defineProperty$5(MP4,"DINF",MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])))),_defineProperty$5(MP4,"VMHD",MP4.box(MP4.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))),_defineProperty$5(MP4,"SMHD",MP4.box(MP4.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0]))),_defineProperty$5(MP4,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0])),_defineProperty$5(MP4,"STTS",MP4.box(MP4.types.stts,MP4.StblTable)),_defineProperty$5(MP4,"STSC",MP4.box(MP4.types.stsc,MP4.StblTable)),_defineProperty$5(MP4,"STSZ",MP4.box(MP4.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]))),_defineProperty$5(MP4,"STCO",MP4.box(MP4.types.stco,MP4.StblTable));var MP4Remuxer=function(){function e(t,r){_classCallCheck$4(this,e),this.videoTrack=t,this.audioTrack=r}return _createClass$5(e,[{key:"remux",value:function(e,t){this.videoTrack=e||this.videoTrack,this.audioTrack=t||this.audioTrack;var r,n,i=(null==e?void 0:e.exist())&&(null==e?void 0:e.hasSample()),a=(null==t?void 0:t.exist())&&(null==t?void 0:t.hasSample());return i&&a?r=this._remuxMix(e,t):i?r=this._remuxTrack(e):a&&(n=this._remuxTrack(t)),e&&(e.samples=[]),t&&(t.samples=[]),{videoSegment:r,audioSegment:n}}},{key:"_remuxMix",value:function(e,t){var r=MP4.ftyp([e,t]),n=this._remuxData(e,r.byteLength+8),i=n.mdatData,a=n.chunkOffset,o=this._remuxData(t,a).mdatData,s=MP4.mdat(concatUint8Array(i,o)),u=MP4.moovMP4([e,t]);return e.ext=void 0,t.ext=void 0,e.samples=[],t.samples=[],concatUint8Array(r,s,u)}},{key:"_remuxTrack",value:function(e){var t=MP4.ftyp([e]),r=this._remuxData(e,t.byteLength+8).mdatData,n=MP4.mdat(r),i=MP4.moovMP4([e]);return e.ext=void 0,e.samples=[],concatUint8Array(t,n,i)}},{key:"_remuxData",value:function(e,t){var r=e.type===TrackType.VIDEO,n=e.samples,i=0;r?n.forEach((function(e){i+=e.units.reduce((function(e,t){return e+t.byteLength}),0),i+=4*e.units.length})):i=n.reduce((function(e,t){return e+t.size}),0);for(var a,o=new Uint8Array(i),s=new DataView(o.buffer),u=e.ext={stts:[],stsc:[],stsz:[],stco:[],stss:[],ctts:[]},c=0,l=0,d=n.length,h=0;h<d;h++){l+=(a=n[h]).duration;var f=r?0:a.size;r?a.units.forEach((function(e){s.setUint32(c,e.byteLength),c+=4,o.set(e,c),c+=e.byteLength,f+=4+e.byteLength})):(o.set(a.data,c),c+=f),a.size=f,u.stsz.push(f),r&&this._fillCttsSamples(u.ctts,a.cts),this._fillSttsSamples(u.stts,a,n[h+1]),this._fillStcoSamples(u.stco,h,1,t),t+=f,r&&a.keyframe&&u.stss.push(h+1)}return e.duration=l,this._fillStscSamples(u.stsc,d,1),{mdatData:o,chunkOffset:t}}},{key:"_fillSttsSamples",value:function(e,t,r){var n=e[e.length-1];r?n&&n.value===t.duration?n.count++:e.push({value:t.duration,count:1}):n?n.count++:e.push({value:40,count:1})}},{key:"_fillCttsSamples",value:function(e,t){var r=e[e.length-1];r&&r.value===t?r.count++:e.push({value:t,count:1})}},{key:"_fillStcoSamples",value:function(e,t,r,n){t%r||e.push(n)}},{key:"_fillStscSamples",value:function(e,t,r){if(t<=r)e.push({firstChunk:1,samplesPerChunk:t,sampleDescIndex:1});else{var n=Math.floor(t/r),i=t%r;e.push({firstChunk:1,samplesPerChunk:r,sampleDescIndex:1}),i&&e.push({firstChunk:n+1,samplesPerChunk:i,sampleDescIndex:1})}}}]),e}();function _createSuper$8(e){var t=_isNativeReflectConstruct$8();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$8(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var DEFAULT_PLAYBACKRATE=2,CANVAS_COUNT=45,FRAME_DURATION=25,MAX_VIDEO_HEIGHT=720,MAX_FPS=30,MIN_FPS=15,VideoDecoder=function(t){_inherits$4(n,t);var r=_createSuper$8(n);function n(e){var t;return _classCallCheck$4(this,n),(t=r.call(this)).TAG="VideoDecoder",t._video=t._createVideo(),t._IsInDecoding=!1,t._fps=0,t._framId=null,t._screenShotNum=0,t._allPicNum=0,t._currentBlob=null,t._basePTS=0,t._totleTime=0,t._isVideoONRun=!0,t.firstEmit=!1,t.ptsArray=[],t._currentCanvasHeight=0,t._canvasList=[],t._realFrameDuration=FRAME_DURATION,t._maxVideoHeight=e.maxVideoHeight||MAX_VIDEO_HEIGHT,t._minFPSTime=0,t._maxFPSTime=0,t._playFailed=!1,t._isPhoneSafari=!1,t._createCanvasList(),t._bindEvents(),t}return _createClass$5(n,[{key:"_createCanvasList",value:function(){this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d",{alpha:!1});for(var e=0;e<CANVAS_COUNT;e++){var t=this._createCanvas(),r=t.dom,n=t.ctx;this._canvasList.push({dom:r,ctx:n})}}},{key:"_createCanvas",value:function(){var e=document.createElement("canvas"),t=e.getContext("2d");return{dom:e,ctx:t}}},{key:"_createVideo",value:function(){var e=document.createElement("video");return e.setAttribute("muted",!0),e.setAttribute("autoplay",!0),e.setAttribute("controls",!0),e.setAttribute("webkit-playsinline",!0),e.setAttribute("playsinline",!0),e.setAttribute("x5-video-player-type","h5"),e.setAttribute("x5-video-player-type","h5-page"),e.style.position="absolute",e}},{key:"_initVideo",value:function(t,r){if(t.blobUrl&&void 0!==t.dts){var n=t.blobUrl;this._currentBlob=n,this._basePTS=t.dts,this._currentDuration=t.duration;try{logger.log(this.TAG,"_initVideo, basePTS:",t.dts),this._setVideoSrc(n,r),this._video.paused&&this._videoPlay("_initVideo")}catch(e){console.error(this.TAG,"_initVideo, load error",e)}}else console.error(this.TAG,"_initVideo","input info is error, blobUrl:",t.blobUrl,"dts:",t.dts)}},{key:"_setVideoSrc",value:function(t,r){try{var n=this._video;n.src=t,n.load(),n.playbackRate=DEFAULT_PLAYBACKRATE}catch(e){console.error(this.TAG,"_setVideoSrc",e)}}},{key:"_videoPlay",value:function(e){var t=this,r=this._video;if(logger.log(this.TAG,"_videoPlay, video is pause:",r.paused,e),r&&r.paused){var n=r.play();void 0!==n&&n.then((function(){t._playFailed=!1,logger.log(t.TAG,"_videoPlay success")})).catch((function(e){console.error(t.TAG,"_videoPlay failed,",e.message),t._playFailed=!0,t.emit(Events.DECODE_EVENTS.PLAY_FAILED,t.firstEmit)}))}}},{key:"_removeEvents",value:function(){var e=this._video;e.removeEventListener("playing",this._onPlaying.bind(this)),e.removeEventListener("ended",this._onEnded.bind(this)),e.removeEventListener("error",this._onError.bind(this)),e.removeEventListener("loadeddata",this._onLoadeddata.bind(this)),e.removeEventListener("timeupdate",this._onTimeUpdate.bind(this))}},{key:"_bindEvents",value:function(){var e=this,t=this._video;t?(document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this)),t.addEventListener("playing",this._onPlaying.bind(this)),t.addEventListener("ended",this._onEnded.bind(this)),t.addEventListener("error",this._onError.bind(this)),t.addEventListener("loadeddata",this._onLoadeddata.bind(this)),t.addEventListener("timeupdate",this._onTimeUpdate.bind(this)),t.addEventListener("pause",(function(){logger.log("on pause, currentTime, duration:",e._vCurrentTime,e._vDuration)})),this.on("outputresolutionchange",this._onChange.bind(this)),this.on("fpsreduce",(function(t){e._adaptFrameDuration(t)}))):console.error(this.TAG,"_bindEvents")}},{key:"_onTimeUpdate",value:function(){this._lastCurrentTime=this._vCurrentTime}},{key:"_onVisibilityChange",value:function(){this._isVideoONRun="visible"===document.visibilityState}},{key:"_onChange",value:function(e,t){this._width=e,this._height=t}},{key:"_onPlaying",value:function(){this._IsInDecoding&&(console.warn(this.TAG,"_onPlaying","last video not correct end"),this._framId&&(window.cancelAnimationFrame(this._framId),this._framId=null)),logger.log(this.TAG,"_onPlaying, video duration:",this._vDuration,"currentTime:",this._vCurrentTime,"_lastPts:",this._lastPts),this._isInDecoding=!0,this._lastCurrentTime=this._vCurrentTime,this.ptsArray=[],this.playingTime||(this.playingTime=!0),this._getFrame()}},{key:"_onEnded",value:function(e,t){logger.log(this.TAG,"_onEnded","current fmp4 duration is:",this._vDuration,"_isInDecoding:",this._isInDecoding,"_lastPts:",this._lastPts,"_realFrameDuration:",this._realFrameDuration,"from:",t),this._isInDecoding&&(this._isInDecoding=!1,this._lastMp4Duration=Math.min(this._vDuration,this._vCurrentTime),this._framId&&(logger.log(this.TAG,"_onEnded","cancelAnimationFrame"),window.cancelAnimationFrame(this._framId),this._framId=null),this._decodeFPS=parseInt(this._screenShotNum/(this._vDuration/1e3)),this.emit("fps",this._screenShotNum,this._totleTime,this._vDuration,this._metaFPS,{height:this._currentCanvasHeight,relHeight:this._video.videoHeight}),logger.log("_timePerFrame",this._totleTime/this._screenShotNum),this._timePerFrame=this._totleTime/this._screenShotNum,this._screenShotNum=0,this._allPicNum=0,this._totleTime=0,this._currentBlob&&(URL.revokeObjectURL(this._currentBlob),this._currentBlob=null,this._basePTS=0),this.emit(Events.DECODE_EVENTS.FRAGMENT_END,this._decodeFPS,this._video.duration))}},{key:"_onError",value:function(){this._isInDecoding=!1;var e=this._video;console.error("video error:",e.error.code,e.error.message),this.emit("error",e.error,this.firstEmit)}},{key:"_onLoadeddata",value:function(){var e=this,t=this._video;t.currentTime=.001,this.firstEmit||(this._playFailed?(t.style.visibility="hidden",this.emit(Events.DECODE_EVENTS.APPEND_VIDEO,t),setTimeout((function(){logger.log(e.TAG,"onloadeddata, setTimeout firstEmit:",e.firstEmit),e._getFirstFrame()}),40)):(logger.log(this.TAG,"onloadeddata, firstEmit:",this.firstEmit),this._getFirstFrame()))}},{key:"_getFirstFrame",value:function(){this.firstTime=Date.now();var e=this._vCurrentTime,t=this._basePTS+e,r=this._getImageData(t).imageData;this.firstEmit=!0,this.emit(Events.DECODE_EVENTS.FIRST_FRAME,r,t)}},{key:"_getFrame",value:function(){var t=this._video,r=t.videoWidth,n=t.videoHeight;if(this._allPicNum++,this._isInDecoding){if(r||n){var i=this._vCurrentTime,a=this._basePTS+i;if(this.ptsArray.push(a),this._lastCurrentTime&&this._lastCurrentTime===this._vDuration&&(logger.log(this.TAG,"_getFrame, video ended, lastCurrentTime",this._lastCurrentTime,"duration:",this._vDuration,"isInDecoding:",this._isInDecoding),this._onEnded(null,"getFrame")),this._lastPts&&a<=this._lastPts)return void(this._framId=window.requestAnimationFrame(this._getFrame.bind(this)));if(this._lastPts&&a-this._lastPts<this._realFrameDuration)return void(this._framId=window.requestAnimationFrame(this._getFrame.bind(this)));this._screenShotNum++;var o,s=null,u=Date.now();try{s=(o=this._getImageData(a)).imageData}catch(e){console.error(e,o,this._canvasList.length)}this._lastPts=a;var c=Date.now()-u;return this._totleTime+=c,this.emit(Events.DECODE_EVENTS.DECODED,s,a),void(this._framId=window.requestAnimationFrame(this._getFrame.bind(this)))}this._framId=window.requestAnimationFrame(this._getFrame.bind(this))}else this._framId&&(window.cancelAnimationFrame(this._framId),this._framId=null)}},{key:"_getImageData",value:function(){var t,r,n,i=this._video,a=i.videoWidth,o=i.videoHeight,s=a,u=o;if(this._width&&this._height&&(s=this._width,u=this._height),u>this._maxVideoHeight&&(u=this._maxVideoHeight,s=parseInt(u*(a/o))),(n=this._canvasList.shift())||(console.warn(this.TAG,"_getImageData, _canvansList length is 0"),n=this._createCanvas()),n.width=s,n.height=u,t=n.dom,r=n.ctx,this._currentCanvasHeight=u,!t)return{imageData:n};t.width!==s&&(t.width=s,t.height=u);try{o&&a&&s&&u&&r.drawImage(i,0,0,a,o,0,0,s,u)}catch(e){console.error(this.TAG,"_getImageData, drawImage:",e)}return{imageData:n}}},{key:"_adaptFrameDuration",value:function(e){e<MIN_FPS?this._minFPSTime++:this._minFPSTime=0,e>MAX_FPS?this._maxFPSTime++:this._maxFPSTime=0,this._minFPSTime>0&&this._decodeFPS<MIN_FPS&&(this._realFrameDuration-=this._timePerFrame,this._realFrameDuration<15&&(this._realFrameDuration=15),this._minFPSTime=0),this._maxFPSTime>0&&this._decodeFPS>MAX_FPS&&(this._realFrameDuration+=this._timePerFrame,this._maxFPSTime=0)}},{key:"_vDuration",get:function(){return parseInt(1e3*this._video.duration)}},{key:"_vCurrentTime",get:function(){return parseInt(1e3*this._video.currentTime)}},{key:"_reset",value:function(){this._isInDecoding=!1,this._lastPts=0,this._screenShotNum=0,this._allPicNum=0,this._totleTime=0}},{key:"reStartDecode",value:function(){this._video.pause(),this._reset();var e=this._currentBlob,t=this._basePTS;this._framId&&(window.cancelAnimationFrame(this._framId),this._framId=null),this._initVideo({blobUrl:e,dts:t})}},{key:"doSeek",value:function(e){if(this._isInDecoding){if(e<=0)return;var t=this._vCurrentTime/1e3+e>=this._vDuration/1e3?this._vDuration/1e3:this._vCurrentTime/1e3+1;console.error("doSeek",t),this._video.currentTime=t}}},{key:"pause",value:function(){this._isInDecoding&&this._video.pause()}},{key:"play",value:function(){if(this._isInDecoding&&this._video.paused)return logger.log("video play",this._vCurrentTime),this._video.play()}},{key:"startDecode",value:function(e,t,r){this._initVideo(e,r),this._metaFPS=t}},{key:"stopDecode",value:function(){this._video.paused||(this._video.pause(),this._reset())}},{key:"canPlayType",value:function(e){return this._video.canPlayType(e)}},{key:"destroy",value:function(){this._isInDecoding=!1,window.cancelAnimationFrame(this._framId),this._video.pause(),this._removeEvents()}},{key:"videoWidth",get:function(){return this._video?this._video.videoWidth:0}},{key:"videoHeight",get:function(){return this._video?this._video.videoHeight:0}}]),n}(EventEmitter$1);function _createSuper$7(e){var t=_isNativeReflectConstruct$7();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$7(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var MAX_FRAMESIZE=40,MIN_FRAMESIZE=25,DEFAULT_FPS=20,LEVELS=[{base:720,level:1},{base:540,level:2},{base:360,level:3},{base:280,level:4}],VideoDecoderController=function(t){_inherits$4(n,t);var r=_createSuper$7(n);function n(e,t){var i;return _classCallCheck$4(this,n),(i=r.call(this)).TAG="VideoDecoderController",i._decoder=new VideoDecoder(e),i._remux=new MP4Remuxer,i._bindEvents(),i._isInit=!1,i._isDataReady=!1,i._ready=!1,i._blobURLList=[],i._isInDecoding=!1,i._mediaSegmentReady=!1,i._parent=t,i._isDecodePause=!1,i._playSuccess=!0,i._isVideoOnRun=!0,i._startDts=0,i._fDuration=0,i._minFPSTime=0,i._lastPts=0,i._frameLengthPerFragment=0,i._gopBufferLength=0,i._maxGopDuration=0,i._minGopDuration=0,i._currentLevel=-1,i._endLevel=e.endLevel||2,i.currentFragmentDuration=0,i._handleKeyFrameVideo=i._handleKeyFrameVideo.bind(_assertThisInitialized$4(i)),i}return _createClass$5(n,[{key:"_bindEvents",value:function(){var e=this;document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this)),this._decoder.on(Events.DECODE_EVENTS.APPEND_VIDEO,this._onAppendVideo.bind(this)),this._decoder.on(Events.DECODE_EVENTS.PLAY_FAILED,this._onPlayFailed.bind(this)),this._decoder.on("error",this._onError.bind(this)),this._decoder.on(Events.DECODE_EVENTS.DECODED,this._onDecoded.bind(this)),this._decoder.on(Events.DECODE_EVENTS.FIRST_FRAME,this._onFirstFrame.bind(this)),this._decoder.on(Events.DECODE_EVENTS.FRAGMENT_END,this._onFragmentEnd.bind(this)),this._decoder.on("fps",(function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=[e._metaFPS].concat(r,[e._frameLengthPerFragment]);e.emit.apply(e,["fps"].concat(_toConsumableArray$1(i)))})),this.on("keyFrame",this._handleKeyFrameVideo)}},{key:"_onRemuxed",value:function(e){var t={blobUrl:this._createBlobURL(e),dts:this.currentFragmentDts,duration:this.currentFragmentDuration,frameDuration:Math.floor(1e3/this._metaFPS)};this._recordGopDuration(this.currentFragmentDuration),this._pushBlob(t),logger.log(this.TAG,"_onRemuxed","maxgopduration:",this._maxGopDuration,"_gopBufferLength:",this._gopBufferLength),!this._isDataReady&&this._gopBufferLength>=this._maxGopDuration&&this._checkDataReady()}},{key:"_onPlayFailed",value:function(e){this._isInDecoding=!1,this._parent.emit(Events.DECODE_EVENTS.PLAY_FAILED,e)}},{key:"_onAppendVideo",value:function(e){this._parent.emit(Events.DECODE_EVENTS.APPEND_VIDEO,e)}},{key:"_onVisibilityChange",value:function(){this._isVideoOnRun="visible"===document.visibilityState}},{key:"_onDecoded",value:function(e,t){this._frameLengthPerFragment++;var r=this._buildFrameInfo(e,t);this._parent.emit(Events.DECODE_EVENTS.DECODED,r),this._lastPts=t}},{key:"_onFirstFrame",value:function(e,t){var r=this._buildFrameInfo(e,t);this._parent.emit(Events.DECODE_EVENTS.FIRST_FRAME,r)}},{key:"_onFragmentEnd",value:function(e,t){var r=this;logger.log(this.TAG,"_onFragmentEnd ,_isDecodePause:",this._isDecodePause,"decodeFPS:",e),e&&this._reduceResolution(e),this._isInDecoding=!1,this._inDecodeId=-1,this._currentInfo=null,this._frameLengthPerFragment=0,this._getBlobLength()&&!this._isDecodePause?this.startDecode():this.loadNextHandle=setInterval((function(){r._getBlobLength()&&!r._isDecodePause&&r._isVideoOnRun&&!r._isInDecoding&&(logger.log(r.TAG,"_onFragmentEnd, setInterval start next mp4 decode"),r.startDecode(),clearInterval(r.loadNextHandle))}))}},{key:"_onError",value:function(e,t){this._isInDecoding=!1,this._parent.emit("error",e,t)}},{key:"_checkReady",value:function(){this._isDataReady&&this._isInit&&(this.ready=!0,logger.log(this.TAG,"checkReady trigger ready"),this._parent.emit(Events.DECODE_EVENTS.READY))}},{key:"_checkDataReady",value:function(){this._isDataReady=!0,this._checkReady()}},{key:"_reduceResolution",value:function(e){if(logger.log(this.TAG,"_reduceResolution","currentLevel:",this._currentLevel,"endLevel:",this._endLevel),this._videoHeight>720&&(logger.log(this.TAG,"_reduceResolution","trigger DECODE_LOW_FPS"),this._parent.emit(Events.VIDEO.DECODE_LOW_FPS)),e&&e<DEFAULT_FPS?(this._minFPSTime++,this._decoder.emit("fpsreduce",e)):this._minFPSTime=0,this._currentLevel>=this._endLevel)return logger.log(this.TAG,"_reduceResolution","trigger DECODE_LOW_FPS",this._currentLevel,this._endLevel),void this._parent.emit(Events.VIDEO.DECODE_LOW_FPS);if(this._minFPSTime>2){var t,r=this._videoWidth,n=this._videoHeight;if(t=this._findLevel(n,this._currentLevel)){if(this._currentLevel=t.level,4===this._currentLevel)return logger.log(this.TAG,"_reduceResolution","trigger DECODE_LOW_FPS, _currentLevel: ",this._currentLevel),void this._parent.emit(Events.VIDEO.DECODE_LOW_FPS);this.width=t.base*(r/n),this.height=t.base,this._decoder.emit("outputresolutionchange",this.width,this.height)}this._minFPSTime=0}}},{key:"_findLevel",value:function(e,t){return LEVELS.find((function(r){return r.base<e&&r.level>t}))}},{key:"_buildFrameInfo",value:function(t,r){try{var n=t.width,i=t.height;return{msg:"DECODED",width:n,height:i,buffer:t,yLinesize:n,uvLinesize:n/2,info:{baseDts:void 0,dts:r,gopId:0,isGop:void 0,key:!1,pts:r},type:"rgb"}}catch(e){logger.log(this.TAG,e)}}},{key:"_pushBlob",value:function(e){logger.log("push blob",e.dts,e.duration),e&&e.duration&&(this._gopBufferLength+=e.duration),this._blobURLList.push(e)}},{key:"_shiftBlob",value:function(){var e=this._blobURLList.shift();return e&&e.duration&&(this._gopBufferLength-=e.duration),e}},{key:"_filterBlob",value:function(e){var t=this;this._blobURLList=this._blobURLList.filter((function(r){return r.dts<e&&(URL.revokeObjectURL(r.blobUrl),r.duration&&(t._gopBufferLength-=r.duration)),r.dts>=e}))}},{key:"_emptyBlobList",value:function(){this._blobURLList=[],this._gopBufferLength=0}},{key:"_getBlobLength",value:function(){return this._blobURLList.length}},{key:"_handleKeyFrameVideo",value:function(t){try{var r=this._parent._timeRange.frames||[];if(this._parent._timeRange.clean(),!r.length)return;var n=r[0].dts,i=r[r.length-1].dts,a=n-this.endDts;logger.log(this.TAG,"_handleKeyFrameVideo","startDts:",n,"endDts:",i,"samples length:",r.length),this.endDts&&a>Math.floor(1e3/this._metaFPS)+1&&logger.log(this.TAG,"_handleKeyFrame, keyFrame dts:",n,"sample length:",r.length,"endDts:",i,"delay:",a);var o=i-n;if(this._fDuration||(this._fDuration=o),o<1500)return void logger.log(this.TAG,"_handleKeyFrame gopDuration :",o,"sample length:",r.length,"gopStartDts:",n,"gopEndDts:",i);if(this.firstDts||(this.firstDts=r[0].dts),this.currentFragmentDts=r[0].dts,this.currentFragmentDuration=this._getFragmentDuration(r),this.endDts=i,this.currentFragmentDts<this._startDts)return console.warn(this.TAG,"_handleKeyFrameVideo","currentFragmentDts < this._startDts",this.currentFragmentDts,this._startDts),void(r=[]);this.startRemux(r),r=[]}catch(e){console.error(this.TAG,"_handleKeyFrameVideo",e)}}},{key:"_getFragmentDuration",value:function(e){var t=0,r=0;return e[0].keyframe||console.error(this.TAG,"_getFragmentDuration","gop firstFrame is not keyframe"),e.forEach((function(n,i){n.keyframe&&i&&(t+=e[i-1].dts-e[r].dts,r=i)})),t+=e[e.length-1].dts-e[r].dts}},{key:"_createBlobURL",value:function(e){if(e){var t=new window.Blob([e.buffer],{type:"video/mp4"});return window.URL.createObjectURL(t)}}},{key:"_recordGopDuration",value:function(e){var t=e;this._minGopDuration||(this._minGopDuration=t),t>this._maxGopDuration&&(this._maxGopDuration=t),t<this._minGopDuration&&(this._minGopDuration=t)}},{key:"checkMaxFrames",value:function(e){"number"==typeof e&&(this._isDecodePause=e>MAX_FRAMESIZE,this._playSuccess&&this._isDecodePause&&this._decoder.pause())}},{key:"checkMinFrames",value:function(e){var t=this;if("number"==typeof e&&(this._isDecodePause=!(e<MIN_FRAMESIZE),!this._isDecodePause)){var r=this._decoder.play();void 0!==r?r.then((function(){t._playSuccess=!0})).catch((function(){t._playSuccess=!1})):setTimeout((function(){t._playSuccess=!0}),20)}}},{key:"frameRendend",value:function(e){if(e.dom){if(e.dom.width=0,e.dom.height=0,this._decoder._canvasList.length>MAX_FRAMESIZE)return;this._decoder._canvasList.push(e)}else logger.error(this.TAG,"_onRendend","imageObj. is error",e)}},{key:"checkValidBlob",value:function(e){this._filterBlob(e)}},{key:"chaseVideoFrame",value:function(e){logger.log(this.TAG,e,e.frame.dts,this.currentFragmentDts);var t=e.frame.dts;if(this._startDts=t,t===this.currentFragmentDts){if(logger.log(this.TAG,"_onChaseFrame","_inDecodeId:",this._inDecodeId,"currentFragmentDts:",this.currentFragmentDts),this._inDecodeId>0&&this._inDecodeId<t)return logger.log(this.TAG,"_onChaseFrame, _inDecodeId > 0 && _inDecodeId < startDts, _inDecodeId:",this._inDecodeId,"startDts:",t),this.stopDecode(),this._filterBlob(t),void this.startDecode();if(this._inDecodeId===t)return logger.log(this.TAG,"_onChaseFrame, _inDecodeId === startDts, startDts:",t),this.stopDecode(),void this.reStrartDecode(this._currentInfo);-1===this._inDecodeId&&(logger.log(this.TAG,"_onChaseFrame","_inDecodeId==-1"),this.startDecode())}t>this.currentFragmentDts&&(logger.log(this.TAG,"_onChaseFrame, startDts > currentFragmentDts, startDts:",t,"currentFragmentDts:",this.currentFragmentDts),this.stopDecode(),this._emptyBlobList()),t<this.currentFragmentDts&&(logger.log(this.TAG,"_onChaseFrame, startDts < currentFragmentDts, startDts:",t,"currentFragmentDts:",this.currentFragmentDts),t>this._inDecodeId&&(this._filterBlob(t),this.stopDecode(),this.startDecode()))}},{key:"init",value:function(e){this._isInit||(this._metaFPS=e.fpsNum/e.fpsDen||25,this._videoWidth=e.width,this._videoHeight=e.height,this._width=this._videoWidth,this._height=this._videoHeight,this._frameDuration=parseInt(1e3/this._metaFPS),this._isInit=!0,logger.log("".concat(this.TAG," has inited")),this._isInit=!0,this._checkReady())}},{key:"reStrartDecode",value:function(t){if(t)try{logger.log(this.TAG,"reStrartDecode"),this._isInDecoding=!0,this._inDecodeId=t.dts,this._currentInfo=t,this._decoder.startDecode(t,this._metaFPS,this._startTime),this._startTime=0}catch(e){console.error("load error",e)}}},{key:"stopDecode",value:function(){this._isInDecoding=!1,this._inDecodeId=-1,this._currentInfo=null,this._frameLengthPerFragment=0,this._decoder.stopDecode()}},{key:"startDecode",value:function(){if(this._isInDecoding)logger.log(this.TAG,"startDecode","this decoder is in decoding");else{var t=this._getBlobLength();if(this._decoder&&t){logger.log(this.TAG,"startDecode","blob url length:",t);var r=this._shiftBlob()||{};try{logger.log(this.TAG,"startDecode",r.dts,r.duration),this._isInDecoding=!0,this._inDecodeId=r.dts,this._currentInfo=r,this._decoder.startDecode(r,this._metaFPS)}catch(e){console.error(this.TAG,"startDecode","load error",e)}}}}},{key:"canSeek",value:function(e){var t=e.frame.dts;return!!(this.currentFragmentDts>=t&&this._isInDecoding)&&(this._inDecodeId!==t&&this._inDecodeId<t)}},{key:"startRemux",value:function(e){if(logger.log("startRemux samples length:",e.length),e.length){var t=this._parent._meta;t.samples=e;var r=this._remux.remux(t).videoSegment;this._onRemuxed(r)}else console.error("frame length is 0")}},{key:"canPlayType",value:function(t){if(this._decoder)try{return this._decoder.canPlayType('video/mp4;codecs="'+t.codec+'"')}catch(e){console.error(e)}}},{key:"destroy",value:function(){this._blobURLList=[],this._decoder.destroy()}},{key:"empty",value:function(){if(logger.log("empty"),this._decoder){var e=this._decoder._canvasList;return logger.log(this.TAG,"empty >>>>>>>>>>>>>>>>>>length:",e.length),e.forEach((function(e){e.dom&&(logger.log("clear >>>>>>>>>>>>>>>>>>"),e.dom.width=0,e.dom.height=0,e.dom=null)})),e.length}}},{key:"isIDLE",get:function(){return logger.log(this.TAG,"isIDEL","blob length:",this._getBlobLength(),"_isInDecoding:",this._isInDecoding,"isVideoOnRun:",this._isVideoOnRun,"_isDecodePause",this._isDecodePause),!this._getBlobLength()&&!this._isInDecoding&&this._isVideoOnRun}},{key:"ready",get:function(){return this._ready},set:function(e){this._ready=e}},{key:"remux",get:function(){return this._remux}},{key:"isInit",get:function(){return this._isInit}}]),n}(EventEmitter$1);function _createSuper$6(e){var t=_isNativeReflectConstruct$6();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$6(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var VideoRenderFromVideo=function(t){_inherits$4(n,t);var r=_createSuper$6(n);function n(e,t){var i;return _classCallCheck$4(this,n),(i=r.call(this,e,t)).TAG="VideoRenderFromVideo",i._videoDecodeController=new VideoDecoderController(e,_assertThisInitialized$4(i)),i._canAutoPlay=!0,i._videoDecode=e.videoDecode,i._chaseToFrame=null,i}return _createClass$5(n,[{key:"videoDecode",get:function(){return this._videoDecode},set:function(e){this._videoDecode=e}},{key:"_bindEvents",value:function(){var e=this;_get(_getPrototypeOf$4(n.prototype),"_bindEvents",this).call(this),this.on("keyFrame",this._onKeyFrame.bind(this)),this.on(Events.DECODE_EVENTS.READY,this._onReady.bind(this)),this.on(Events.DECODE_EVENTS.DECODED,this._onDecoded.bind(this)),this.on(Events.DECODE_EVENTS.PLAY_FAILED,this._onPlayFailed.bind(this)),this.on("error",this._onError.bind(this)),this.on(Events.DECODE_EVENTS.APPEND_VIDEO,this._onAppendVideo.bind(this)),this.on(Events.DECODE_EVENTS.FIRST_FRAME,this._onFirstFrame.bind(this)),this._parent.on(Events.DECODE_EVENTS.CHASE_VIDEO_FRAME,this._onChaseVideoFrame.bind(this)),this._parent.on(Events.TIMELINE.SYNC_DTS,this._onTimeLineSyncDTS.bind(this)),window.addEventListener("unload",(function(){e._empty()}))}},{key:"_onTimeLineSyncDTS",value:function(e){this._videoDecodeController.checkValidBlob(e)}},{key:"_onChaseVideoFrame",value:function(e){this._doChaseVideoFrame(e)}},{key:"_onAppendVideo",value:function(t){try{this._parent._parent.appendChild(t)}catch(e){cosole.error(this.TAG,"onAppendVideo",e)}}},{key:"_onKeyFrame",value:function(){logger.log(this.TAG,"_onKeyFrame,  keyframe"),this._videoDecodeController.emit("keyFrame")}},{key:"_onError",value:function(e,t){console.error(this.TAG,"decoder error",e,t),t||this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,"error",this._assembleErr(e&&e.message))}},{key:"_onReady",value:function(){if(!this._frameRender){var t=Object.assign(this._config,{meta:this._meta,canvas:this._canvas,type:"2d"});try{this._frameRender=new YUVCanvas(t,this)}catch(e){this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,"error",this._assembleErr(e&&e.message))}}this._startDecode()}},{key:"_onFirstFrame",value:function(e){logger.log(this.TAG,"onFirstFrame"),this._receiveFrame(e),this._firstFrame=!0}},{key:"_onDecoded",value:function(e){var t=this;if(this._inChaseFrame){if(this.chaseFrameAfter++,1===this.chaseFrameAfter&&this._chaseToFrame){if(this._parent.emit(Events.DECODE_EVENTS.CHASE_VIDEO_FRAME_END,this._chaseToFrame),this._frameQueue.length)this._frameQueue.frames.forEach((function(e){t._videoDecodeController.frameRendend(e.buffer)}));this._frameQueue.empty(),this._videoDecodeController.checkMinFrames(this._frameQueue.length),this._timeRange.deletePassed(this._chaseToFrame.frame.dts),this._inChaseFrame=!1,this._chaseToFrame=null,console.warn(this.TAG,"onDecoded","_inChaseFrame end")}}else this.chaseFrameAfter=0;this._receiveFrame(e)}},{key:"_onPlayFailed",value:function(e){console.warn(this.TAG,"onPlayFailed, this._ready:",this._ready,",firstEmit:",e,",frame length:",this._frameQueue.length),this._ready||e||this._whenReady(),this._canAutoPlay=!1}},{key:"canSeek",value:function(e){return this._videoDecodeController.canSeek(e)}},{key:"_initDecoder",value:function(){this._isInit||(logger.log(this.TAG,"_initDecoder"),this._videoDecodeController.isInit||this._videoDecodeController.init(this._meta),this._isInit=!0)}},{key:"_receiveFrame",value:function(e){_get(_getPrototypeOf$4(n.prototype),"_receiveFrame",this).call(this,e),this._videoDecodeController.checkMaxFrames(this._frameQueue._frames.length)}},{key:"_setMetadata",value:function(e){logger.warn(this.TAG,"video set metadata",e),this._meta=e;var t=e.fpsNum/e.fpsDen;t?logger.log(this.TAG,"detect fps:",t):logger.warn(this.TAG,"no detect fps,start estimate"),this._initDecoder(e)}},{key:"_doChaseVideoFrame",value:function(e){this._inChaseFrame=!0,this._chaseToFrame=e,this._videoDecodeController.chaseVideoFrame(e)}},{key:"_appendChunk",value:function(e){this._meta||this._setMetadata(e);for(var t=e.samples.slice(),r=t.length,n=0;n<r;n++){var i=t.shift();i.keyframe&&this.emit("keyFrame"),this._timeRange.append([i],this.noAudio,!1)}}},{key:"_startDecode",value:function(){this._videoDecodeController.startDecode()}},{key:"_checkToDecode",value:function(){this._startDecode()}},{key:"_startRender",value:function(){logger.log(this.TAG,"_startRender interval",this.interval),this._tickTimer.start(this.interval)}},{key:"_render",value:function(e){var t=this,r=this._frameQueue.nextFrame(),n=this.preciseVideoDts;if(r&&this._timeRange){var i=r.info;if(!i)return this._frameQueue.shift(),void console.error("not info");this._renderDts=i.dts;var a=i.dts-n;if(a<-150){this.lastPrecise;var o=this._frameQueue.frames,s=this._getDeleteFrames(o,n),u=s.deleteFrames,c=s.useFrames;return o.splice(0),c.forEach((function(e){o.push(e)})),u.forEach((function(e){t._videoDecodeController.frameRendend(e.buffer)})),this._videoDecodeController.emit("renderDelay",a,this._frameQueue._frames.length),void this._videoDecodeController.checkMinFrames(this._frameQueue.length)}if(!(!e&&a>30&&a<6e4)){Math.abs(this._lastTimeupdate-i.dts)>250&&(this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.TIMEUPDATE),this._lastTimeupdate=i.dts),logger.long&&logger.log(this.TAG,"render delay:".concat(a," , timelinePosition:").concat(n," , dts:").concat(i.dts," , cost:").concat(i.cost," , gopID:").concat(i.gopId," , rest:").concat(this._frameQueue.length,", buffer frame:").concat(this._timeRange.frameLength));var l=performance.now();this._frameRender.render(r.buffer,r.width,r.height,r.yLinesize,r.uvLinesize),this.hasFirstFrame||e||(this.hasFirstFrame=!0,this._parent.emit(Events.TIMELINE.PLAY_EVENT,"firstframe")),this._videoDecodeController.frameRendend(r.buffer),this._frameQueue.shift(),this._videoDecodeController.checkMinFrames(this._frameQueue.length),this._videoDecodeController.emit("renderDelay",a,this._frameQueue._frames.length),this._renderCost=performance.now()-l,e||(this.lastTime&&(this.lastPrecise,Date.now(),this.lastTime),this.lastFrameinfo=i.dts,this.lastPrecise=n,this.lastTime=Date.now(),this.lastAudioTime=this._parent.audioRender.currentTime)}}else{if(this._videoDecodeController.checkMinFrames(this._frameQueue._frames.length),this._parent._paused)return;if(!this._firstFrame)return void logger.log(this.TAG,"_render","not first frame return");var d=this._videoDecodeController;if(logger.log(this.TAG,",lack frame, _inDecoding:",this._videoDecodeController._isInDecoding,this._videoDecodeController._isDecodePause,",_frameQueue.length:",this._frameQueue.length),!this._frameQueue.length&&d.isIDLE){this._ready=!1;var h=this._parent.audioRender;console.warn(this.TAG,"trigger video waiting vdecode, preciseVideoDts:",n,h.currentTime,h.duration,h.buffered.end(0),h.baseDts),this.emit(Events.VIDEO.VIDEO_WAITING)}this._checkToDecode()}}},{key:"_updateSegmentEnd",value:function(){}},{key:"_destroy",value:function(e){this._empty(),_get(_getPrototypeOf$4(n.prototype),"destroy",this).call(this,e),this._videoDecodeController.destroy()}},{key:"_doPause",value:function(){logger.log(this.TAG,">>>>>>>>doPause"),this._tickTimer.stop()}},{key:"_getDeleteFrames",value:function(e,t){var r=[],n=[];return e.forEach((function(e){e.info&&e.info.dts>t?n.push(e):e.info&&e.info.dts<=t&&r.push(e)})),{deleteFrames:r,useFrames:n}}},{key:"_empty",value:function(){this._videoDecodeController&&(this._videoDecodeController.empty(),this._frameQueue.frames.forEach((function(e){e.buffer&&e.buffer.dom&&(e.buffer.dom.width=0,e.buffer.dom.height=0,e.buffer.dom=null)})))}}]),n}(VideoBaseRender);function _createSuper$5(e){var t=_isNativeReflectConstruct$5();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$5(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var DecodeController=function(e){_inherits$4(r,e);var t=_createSuper$5(r);function r(e){var n;return _classCallCheck$4(this,r),_defineProperty$5(_assertThisInitialized$4(n=t.call(this)),"_parent",null),_defineProperty$5(_assertThisInitialized$4(n),"_decoderReady",!1),_defineProperty$5(_assertThisInitialized$4(n),"_inDecoding",!1),_defineProperty$5(_assertThisInitialized$4(n),"_id",(new Date).getMilliseconds()),_defineProperty$5(_assertThisInitialized$4(n),"_workerErrorCallback",null),_defineProperty$5(_assertThisInitialized$4(n),"_workerMessageCallback",null),_defineProperty$5(_assertThisInitialized$4(n),"_decoderWorkers",[]),n._parent=e,n}return _createClass$5(r,[{key:"inDecoding",get:function(){return this._inDecoding}},{key:"decoderMode",get:function(){return this._decoderMode}},{key:"workerLength",get:function(){return this._decoderWorkers.length}},{key:"decoderReady",get:function(){return this._decoderReady}},{key:"needToDecode",get:function(){return this._inDecoding?0:this._continueDecodeThreshold}},{key:"maxDecodeOnce",get:function(){return this._maxDecodeOnce}},{key:"meta",get:function(){var e;return null===(e=this._parent)||void 0===e?void 0:e._meta},set:function(e){this._parent&&(this._parent._meta=e)}},{key:"init",value:function(e,t){this._workerMessageCallback=e,this._workerErrorCallback=t,this._initWorker()}},{key:"_initWorker",value:function(){throw new Error("need override by children")}},{key:"doDecode",value:function(){var e=this,t=this._getFramesToDecode();t&&this.meta&&(logger.log(this.TAG,"doDecode ".concat(t.length," frames")),t.forEach((function(t){e._doDecodeInternal(t)})),this._inDecoding=!0,this._decoderWorkers.filter((function(e){return e.using})).forEach((function(e){e.postMessage({msg:"finish_flag"})})))}},{key:"_getFramesToDecode",value:function(){var e=this._parent,t=e._timeRange,r=e._decodeEstimate;if(this._decoderReady&&t){var n=t.frameLength;if(n&&!(n<this.maxDecodeOnce)){var i=this.maxDecodeOnce;1===n&&r.resetDecodeDot(performance.now());for(var a=[];i>0;){var o=t&&t.getFrame();if(!o)break;a.push(o),o.gopId&&o.gopId-1==0&&r.updateGopCount(),i--}return a}}}},{key:"_doDecodeInternal",value:function(e){var t=this._decoderWorkers.length,r=0;e.gopId&&(r=e.gopId-1);var n=this._decoderWorkers[r%t];n.using=1,null!=e&&e.meta&&(this.meta=e.meta,logger.warn(this.TAG,"detect metadata! flush decoder"),this._initDecoderWithConfiguration(n,e.meta)),n.postMessage({msg:"decode",data:e.data,info:{baseDts:e.baseDts,dts:e.dts,pts:e.pts||e.dts+e.cts,originDts:e.originDts,originPts:e.originPts,keyframe:e.keyframe,gopId:e.gopId,id:this._id}})}},{key:"_initDecoderWithConfiguration",value:function(){throw new Error("need override by children")}},{key:"flushDecoder",value:function(){this._decoderWorkers.forEach((function(e){e.postMessage({msg:"flush"})}))}},{key:"destroy",value:function(){throw new Error("need override by children")}}]),r}(EventEmitter$1);function decodeBase64(e,t){var r=atob(e);if(t){for(var n=new Uint8Array(r.length),i=0,a=r.length;i<a;++i)n[i]=r.charCodeAt(i);return String.fromCharCode.apply(null,new Uint16Array(n.buffer))}return r}function createURL(e,t,r){var n=void 0===t?null:t,i=decodeBase64(e,void 0!==r&&r),a=i.indexOf("\n",10)+1,o=i.substring(a)+(n?"//# sourceMappingURL="+n:""),s=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(s)}function createBase64WorkerFactory(e,t,r){var n;return function(i){return n=n||createURL(e,t,r),new Worker(n,i)}}var WorkerFactory$3=createBase64WorkerFactory("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgdmFyIGRlY29kZXIgPSBudWxsOwoKICB2YXIgZnJhbWVRdWV1ZSA9IFtdOwoKICB2YXIgcmVjZWl2ZUZyYW1lVGltZXIgPSAwOwoKICB2YXIgaGFzUmVjZWl2ZUZyYW1lID0gZmFsc2U7CgogIHNlbGYuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChlKSB7CiAgICBzd2l0Y2ggKGUuZGF0YS5tc2cpIHsKICAgICAgY2FzZSAnY29uZmlndXJhdGlvbic6CiAgICAgICAgZGVjb2RlciA9IG5ldyBzZWxmLlZpZGVvRGVjb2Rlcih7CiAgICAgICAgICBvdXRwdXQ6IGZ1bmN0aW9uIChmcmFtZSkgewogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnZGVjb2RlZCEnLCBkZWNvZGVyLmRlY29kZVF1ZXVlU2l6ZSwgZnJhbWVRdWV1ZS5sZW5ndGgpCgogICAgICAgICAgICBoYXNSZWNlaXZlRnJhbWUgPSB0cnVlOwoKICAgICAgICAgICAgaWYgKHJlY2VpdmVGcmFtZVRpbWVyKSB7CiAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHJlY2VpdmVGcmFtZVRpbWVyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgZiA9IGZyYW1lUXVldWUuc2hpZnQoKTsKICAgICAgICAgICAgaWYgKCFmKSB7CiAgICAgICAgICAgICAgZnJhbWUuY2xvc2UoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgIHR5cGU6ICdERUNPREVEJywKICAgICAgICAgICAgICAgIHdpZHRoOiBmcmFtZS5kaXNwbGF5V2lkdGgsCiAgICAgICAgICAgICAgICBoZWlnaHQ6IGZyYW1lLmRpc3BsYXlIZWlnaHQsCiAgICAgICAgICAgICAgICBpbmZvOiBmLAogICAgICAgICAgICAgICAgYnVmZmVyOiBmcmFtZQogICAgICAgICAgICAgIH0sIFtmcmFtZV0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGVjb2Rlci5kZWNvZGVRdWV1ZVNpemUgPT09IGZyYW1lUXVldWUubGVuZ3RoKSB7CiAgICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICB0eXBlOiAnQkFUQ0hfRklOSVNIX0ZMQUcnCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1tXZWJjb2RlY1dvcmtlcl06JywgZSk7CiAgICAgICAgICAgIGlmIChlLm1lc3NhZ2UgPT09ICdDb2RlYyByZWNsYWltZWQgZHVlIHRvIGluYWN0aXZpdHkuJykgcmV0dXJuCiAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgIHR5cGU6ICdGQUlMRUQnLAogICAgICAgICAgICAgIG1lc3NhZ2U6IGUgJiYgZS5tZXNzYWdlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHNlbGYuVmlkZW9EZWNvZGVyLmlzQ29uZmlnU3VwcG9ydGVkKGUuZGF0YS5kYXRhKQogICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHN0YXR1cykgewogICAgICAgICAgICBpZiAoc3RhdHVzLnN1cHBvcnRlZCkgewogICAgICAgICAgICAgIGRlY29kZXIuY29uZmlndXJlKGUuZGF0YS5kYXRhKTsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW1dlYmNvZGVjV29ya2VyXTonLCAnaXNDb25maWdTdXBwb3J0ZWQnLCBzdGF0dXMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgdHlwZTogJ0RFQ09ERVJfUkVBRFknIH0pOwoKICAgICAgICAgICAgLy8g5o6i5rWL6ZW/5pe26Ze05peg6Kej56CB5bin6L6T5Ye6LOmZjee6p+WIsHdhc20KICAgICAgICAgICAgcmVjZWl2ZUZyYW1lVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICBpZiAoaGFzUmVjZWl2ZUZyYW1lKSByZXR1cm4KICAgICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgdHlwZTogJ0ZBSUxFRCcsIG1lc3NhZ2U6ICdubyBmcmFtZSBvdXRwdXQnIH0pOwogICAgICAgICAgICB9LCAyMDAwKTsKICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgdHlwZTogJ0ZBSUxFRCcsCiAgICAgICAgICAgICAgbWVzc2FnZTogZSAmJiBlLm1lc3NhZ2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICBicmVhawogICAgICBjYXNlICdkZWNvZGUnOgogICAgICAgIHZhciBkID0gZS5kYXRhLmRhdGE7CgogICAgICAgIHZhciBzYW1wbGVJbmZvID0gZS5kYXRhLmluZm87CgogICAgICAgIGZyYW1lUXVldWUucHVzaChzYW1wbGVJbmZvKTsKCiAgICAgICAgdmFyIGZyYW1lU2l6ZSA9IGQuYnl0ZUxlbmd0aCAtIDQ7CgogICAgICAgIHZhciBkdiA9IG5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIoNCkpOwoKICAgICAgICBkdi5zZXRVaW50MzIoMCwgZnJhbWVTaXplLCBmYWxzZSk7CgogICAgICAgIGQuc2V0KG5ldyBVaW50OEFycmF5KGR2LmJ1ZmZlciksIDApOwoKICAgICAgICBpZiAoc2FtcGxlSW5mby5rZXlmcmFtZSkgewogICAgICAgICAgZGVjb2Rlci5mbHVzaCgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNodW5rID0gbmV3IHNlbGYuRW5jb2RlZFZpZGVvQ2h1bmsoewogICAgICAgICAgdHlwZTogc2FtcGxlSW5mby5rZXlmcmFtZSA/ICdrZXknIDogJ2RlbHRhJywKICAgICAgICAgIHRpbWVzdGFtcDogc2FtcGxlSW5mby5wdHMsCiAgICAgICAgICBkYXRhOiBkCiAgICAgICAgfSk7CiAgICAgICAgZGVjb2Rlci5kZWNvZGUoY2h1bmspOwogICAgICAgIGJyZWFrCiAgICAgIGNhc2UgJ2Rlc3Ryb3knOgogICAgICAgIGlmIChkZWNvZGVyKSB7CiAgICAgICAgICBkZWNvZGVyLmZsdXNoKCk7CiAgICAgICAgICBkZWNvZGVyLmNsb3NlKCk7CiAgICAgICAgfQogICAgICAgIGNsZWFyVGltZW91dChyZWNlaXZlRnJhbWVUaW1lcik7CiAgICAgICAgYnJlYWsKICAgICAgY2FzZSAnY2hlY2tEZWNvZGUnOgogICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgdHlwZTogJ0NIRUNLX1RPX0RFQ09ERScsCiAgICAgICAgICBkYXRhOiBNYXRoLmFicyhkZWNvZGVyLmRlY29kZVF1ZXVlU2l6ZSAtIGZyYW1lUXVldWUubGVuZ3RoKSA9PT0gMAogICAgICAgIH0pOwogICAgICAgIGJyZWFrCiAgICB9CiAgfSk7Cgp9KSgpOwoK",null,!1);function _createSuper$4(e){var t=_isNativeReflectConstruct$4();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$4(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var MAX_DECODE_ONCE_DEFAULT$1=20,WebCodecDecodeController=function(e){_inherits$4(r,e);var t=_createSuper$4(r);function r(){var e;_classCallCheck$4(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$5(_assertThisInitialized$4(e=t.call.apply(t,[this].concat(i))),"TAG","WebCodecController"),_defineProperty$5(_assertThisInitialized$4(e),"_decoderMode",4),_defineProperty$5(_assertThisInitialized$4(e),"_maxDecodeOnce",MAX_DECODE_ONCE_DEFAULT$1),_defineProperty$5(_assertThisInitialized$4(e),"_continueDecodeThreshold",MAX_DECODE_ONCE_DEFAULT$1/2),e}return _createClass$5(r,[{key:"webcodec",get:function(){return!0}},{key:"needToDecode",get:function(){return this._inDecoding?(this._checkToDecode(),0):this._continueDecodeThreshold}},{key:"_initWorker",value:function(){var e=this;logger.log(this.TAG,"start init webcodec worker");var t=new WorkerFactory$3;t.onMessage=function(t){var r,n;switch(t.data.type){case"DECODER_READY":logger.log(e.TAG,"webcodec worker ready "),e._decoderReady=!0,e._workerMessageCallback({type:"DECODER_READY"});break;case"DECODED":if(e._inDecoding=!0,(null===(r=t.data)||void 0===r||null===(n=r.info)||void 0===n?void 0:n.id)!==e._id)return;e._workerMessageCallback({type:"RECEIVE_FRAME",data:t.data});break;case"BATCH_FINISH_FLAG":if(e._inDecoding=!1,!e._workerMessageCallback)return;e._workerMessageCallback({type:"BATCH_FINISH"});break;case"CHECK_TO_DECODE":e._inDecoding=t.data.data;break;case"FAILED":e._whenError(t.data.message)}},t.onError=function(t){var r,n,i=null===(r=e._parent)||void 0===r||null===(n=r._parent)||void 0===n?void 0:n._parent;i&&i.removeChild(i.querySelector("canvas")),e._whenError(t.message)},t.addEventListener("message",t.onMessage),t.addEventListener("error",t.onError),this._decoderWorkers.push(t),this._initDecoderWithConfiguration(t,this._parent.configuration)}},{key:"_whenError",value:function(e){r.canUse=!1,this._workerErrorCallback(e)}},{key:"_initDecoderWithConfiguration",value:function(e,t){e.postMessage({msg:"configuration",data:{codec:this._parent._meta.codec,codedHeight:this._parent._meta.height,codedWidth:this._parent._meta.width,description:t}})}},{key:"_checkToDecode",value:function(){this._decoderWorkers.forEach((function(e){e.postMessage({msg:"checkDecode"})}))}},{key:"destroy",value:function(){this._decoderWorkers.forEach((function(e){e.removeEventListener("message",e.onMessage),e.removeEventListener("error",e.onError),e.postMessage({msg:"destroy"}),e.terminate()})),this._decoderWorkers=[]}}],[{key:"isSupported",value:function(){return!!window.VideoDecoder&&!1!==r.canUse}}]),r}(DecodeController),WorkerFactory$2=createBase64WorkerFactory("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyogZXNsaW50LWRpc2FibGUgbm8tdW5kZWYgKi8KICAvLyDnm67liY3ku4XmlK/mjIF5dXY0MjAKCiAgZnVuY3Rpb24gc2hpbUltcG9ydFNjcmlwdHMgKHNyYykgewogICAgcmV0dXJuIGZldGNoKHNyYykKICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIHJldHVybiByZXMudGV4dCgpCiAgICAgIH0pCiAgICAgIC50aGVuKGZ1bmN0aW9uICh0ZXh0KSB7CiAgICAgICAgZXZhbCh0ZXh0KTsKICAgICAgICBzZWxmLk1vZHVsZSA9IE1vZHVsZTsKICAgICAgICBzZWxmLmFkZE9uUG9zdFJ1biA9IGFkZE9uUG9zdFJ1bjsKICAgICAgfSkKICB9CgogIHZhciBNQVhfU1RSRUFNX0JVRkZFUl9MRU5HVEggPSAxMDI0ICogMTAyNCAqIDI7CiAgdmFyIGluaXRUcyA9IDA7CgogIHZhciBEZWNvZGVyID0gZnVuY3Rpb24gKHNlbGYpIHsKICAgIHRoaXMuaW5pdGVkID0gZmFsc2U7CiAgICB0aGlzLmluZm9JZCA9IDA7CiAgICB0aGlzLnNlbGYgPSBzZWxmOwogICAgdGhpcy5tZXRhID0gdGhpcy5zZWxmLm1ldGE7CiAgICB0aGlzLnRzID0gMDsKICAgIHRoaXMuaW5mb2xpc3QgPSBbXTsKICAgIHNlbGYucGFyX2Jyb2Fkd2F5T25Ccm9hZHdheUluaXRlZCA9IHRoaXMuYnJvYWR3YXlPbkJyb2Fkd2F5SW5pdGVkLmJpbmQodGhpcyk7CiAgICBzZWxmLnBhcl9icm9hZHdheU9uUGljdHVyZURlY29kZWQgPSB0aGlzLmJyb2Fkd2F5T25QaWN0dXJlRGVjb2RlZC5iaW5kKHRoaXMpOwogIH07CgogIERlY29kZXIucHJvdG90eXBlLnRvVThBcnJheSA9IGZ1bmN0aW9uIChwdHIsIGxlbmd0aCkgewogICAgcmV0dXJuIE1vZHVsZS5IRUFQVTguc3ViYXJyYXkocHRyLCBwdHIgKyBsZW5ndGgpCiAgfTsKCiAgRGVjb2Rlci5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uICgpIHsKICAgIE1vZHVsZS5fYnJvYWR3YXlJbml0KCk7CiAgICB0aGlzLm9mZnNldCA9IE1vZHVsZS5fYnJvYWR3YXlDcmVhdGVTdHJlYW0oTUFYX1NUUkVBTV9CVUZGRVJfTEVOR1RIKTsKICB9OwoKICBEZWNvZGVyLnByb3RvdHlwZS5icm9hZHdheU9uUGljdHVyZURlY29kZWQgPSBmdW5jdGlvbiAoCiAgICBvZmZzZXQsCiAgICB3aWR0aCwKICAgIGhlaWdodCwKICAgIGluZm9pZCwKICAgIHNsaWNlVHlwZQogICkgewogICAgLy8gaWYgKHRoaXMuaW5mb2xpc3RbMF0gJiYgdGhpcy5pbmZvbGlzdFswXS5rZXkgJiYgc2xpY2VUeXBlICE9PSAyKSB7CiAgICAvLyAgIHRoaXMuc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAvLyAgICAgbXNnOiAnTE9HJywKICAgIC8vICAgICBsb2c6IGBkcm9wIHNhbXBsZWAKICAgIC8vICAgfSk7CiAgICAvLyAgIHJldHVybjsKICAgIC8vIH0KCiAgICB2YXIgaW5mbyA9IHRoaXMuaW5mb2xpc3Quc2hpZnQoKTsKICAgIHZhciB5Um93Y291bnQgPSBoZWlnaHQ7CiAgICB2YXIgdXZSb3djb3VudCA9IGhlaWdodCAvIDI7CiAgICB2YXIgeUxpbmVzaXplID0gd2lkdGg7CiAgICB2YXIgdXZMaW5lc2l6ZSA9IHdpZHRoIC8gMjsKICAgIGlmICh0aGlzLm1ldGEgJiYgKHRoaXMubWV0YS5jaHJvbWFGb3JtYXQgPT09IDQ0NCB8fCB0aGlzLm1ldGEuY2hyb21hRm9ybWF0ID09PSA0MjIpKSB7CiAgICAgIHV2Um93Y291bnQgPSBoZWlnaHQ7CiAgICB9CiAgICB2YXIgZGF0YSA9IHRoaXMudG9VOEFycmF5KG9mZnNldCwgeUxpbmVzaXplICogeVJvd2NvdW50ICsgMiAqICh1dkxpbmVzaXplICogdXZSb3djb3VudCkpOwogICAgLy8gdGhpcy5pbmZvbGlzdFtpbmZvaWRdID0gbnVsbDsKICAgIHZhciBkYXRldGVtcCA9IG5ldyBVaW50OEFycmF5KGRhdGEubGVuZ3RoKTsKICAgIGRhdGV0ZW1wLnNldChkYXRhKTsKICAgIHZhciBidWZmZXIgPSBkYXRldGVtcC5idWZmZXI7CgogICAgdGhpcy5zZWxmLnBvc3RNZXNzYWdlKAogICAgICB7CiAgICAgICAgbXNnOiAnREVDT0RFRCcsCiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0LAogICAgICAgIHlMaW5lc2l6ZSwKICAgICAgICB1dkxpbmVzaXplLAogICAgICAgIGluZm8sCiAgICAgICAgYnVmZmVyCiAgICAgIH0sCiAgICAgIFtidWZmZXJdCiAgICApOwogIH07CgogIERlY29kZXIucHJvdG90eXBlLmJyb2Fkd2F5T25Ccm9hZHdheUluaXRlZCA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLmluaXRlZCkgewogICAgICByZXR1cm4KICAgIH0KICAgIHRoaXMuaW5pdGVkID0gdHJ1ZTsKICAgIHRoaXMuc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgIG1zZzogJ0xPRycsCiAgICAgIGxvZzogJ2RlY29kZXIgaW5pdGVkJwogICAgfSk7CiAgICB2YXIgY29zdCA9IDA7CiAgICBpZiAoaW5pdFRzKSB7CiAgICAgIGNvc3QgPSBwZXJmb3JtYW5jZS5ub3coKSAtIGluaXRUczsKICAgIH0KICAgIHRoaXMuc2VsZi5wb3N0TWVzc2FnZSh7IG1zZzogJ0RFQ09ERVJfUkVBRFknLCBjb3N0IH0pOwogIH07CgogIERlY29kZXIucHJvdG90eXBlLmRlY29kZSA9IGZ1bmN0aW9uIChkYXRhLCBpbmZvKSB7CiAgICBsZXQgdGltZSA9IHBhcnNlSW50KG5ldyBEYXRlKCkuZ2V0VGltZSgpKTsKICAgIGxldCBpbmZvaWQgPSB0aW1lIC0gTWF0aC5mbG9vcih0aW1lIC8gMTBlOCkgKiAxMGU4OwogICAgdGhpcy5pbmZvbGlzdC5wdXNoKGluZm8pOwogICAgaWYgKGluZm8gJiYgaW5mby5rZXlmcmFtZSkgewogICAgICB0aGlzLmluZm9saXN0ID0gW2luZm9dOwogICAgICBNb2R1bGUuX2Jyb2Fkd2F5Rmx1c2hTdHJlYW0oaW5mb2lkKTsKICAgIH0KICAgIE1vZHVsZS5IRUFQVTguc2V0KGRhdGEsIHRoaXMub2Zmc2V0KTsKICAgIE1vZHVsZS5fYnJvYWR3YXlQbGF5U3RyZWFtKGRhdGEubGVuZ3RoLCB0aGlzLmluZm9JZCk7CiAgfTsKCiAgRGVjb2Rlci5wcm90b3R5cGUuZmx1c2ggPSBmdW5jdGlvbiAoKSB7CiAgICBNb2R1bGUuX2Jyb2Fkd2F5Rmx1c2hTdHJlYW0oKTsKICB9OwoKICBEZWNvZGVyLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgTW9kdWxlLl9icm9hZHdheUV4aXQoKTsKICB9OwoKICBEZWNvZGVyLnByb3RvdHlwZS51cGRhdGVNZXRhID0gZnVuY3Rpb24gKG1ldGEpIHsKICAgIHRoaXMubWV0YSA9IG1ldGE7CiAgfTsKCiAgdmFyIGRlY29kZXI7CgogIGZ1bmN0aW9uIG9uUG9zdFJ1biAoKSB7CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgbXNnOiAnTE9HJywKICAgICAgbG9nOiAnZG8gcG9zdCBydW4nCiAgICB9KTsKICAgIGRlY29kZXIgPSBuZXcgRGVjb2Rlcih0aGlzKTsKICAgIGRlY29kZXIuaW5pdCgpOwogIH0KCiAgdmFyIFdBU01fQ0ROX1BBVEhfUFJFRklYID0gJyc7CgogIGZ1bmN0aW9uIGluaXQgKHVybCkgewogICAgV0FTTV9DRE5fUEFUSF9QUkVGSVggPSB1cmwuc3BsaXQoJy8nKS5zbGljZSgwLCAtMSkuam9pbignLycpOwogICAgaW5pdFRzID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICB2YXIgaXNEZWdyYWRlID0gL2FzbS8udGVzdCh1cmwpOwogICAgaWYgKCFkZWNvZGVyKSB7CiAgICAgIHZhciB0YXNrOwoKICAgICAgaWYgKCFzZWxmLmltcG9ydFNjcmlwdHMpIHsKICAgICAgICB0YXNrID0gc2hpbUltcG9ydFNjcmlwdHModXJsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXNrID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgaWYgKCFzZWxmLmNvbnNvbGUpIHsKICAgICAgICAgICAgc2VsZi5jb25zb2xlID0gewogICAgICAgICAgICAgIGxvZzogZnVuY3Rpb24gKCkge30sCiAgICAgICAgICAgICAgd2FybjogZnVuY3Rpb24gKCkge30sCiAgICAgICAgICAgICAgaW5mbzogZnVuY3Rpb24gKCkge30sCiAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHt9CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBzZWxmLmltcG9ydFNjcmlwdHModXJsKTsKICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRhc2sKICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoaXNEZWdyYWRlKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhdXRvIGluc3RhbmNlIERlY29kZXIhJyk7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICBvblBvc3RSdW4uY2FsbChzZWxmKTsKICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICB9CgogICAgICAgICAgaWYoc2VsZi5tKSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmCiAgICAgICAgICAgIC5tKHsKICAgICAgICAgICAgICBpbnN0YW50aWF0ZVdhc206IGZ1bmN0aW9uIChpbmZvLCByZWNlaXZlSW5zdGFuY2UpIHsKICAgICAgICAgICAgICAgIGZldGNoKGAke1dBU01fQ0ROX1BBVEhfUFJFRklYfS9kZWNvZGVyLndhc20uanNgKQogICAgICAgICAgICAgICAgICAudGhlbihyZXMgPT4gcmVzLmFycmF5QnVmZmVyKCkpCiAgICAgICAgICAgICAgICAgIC50aGVuKGJ1ZmZlciA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKGJ1ZmZlciwgaW5mbykKICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZWNlaXZlSW5zdGFuY2UocmVzdWx0Lmluc3RhbmNlKQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChNb2QpIHsKICAgICAgICAgICAgICBzZWxmLk1vZHVsZSA9IE1vZDsKICAgICAgICAgICAgICBvblBvc3RSdW4uY2FsbChzZWxmKTsKICAgICAgICAgICAgfSkKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICBhZGRPblBvc3RSdW4ob25Qb3N0UnVuLmJpbmQoc2VsZikpOwoKICAgICAgICAgICAgTW9kdWxlLm9uUnVudGltZUluaXRpYWxpemVkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIE1vZHVsZS5vbkFib3J0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICByZWplY3QoZSAmJiBlLm1lc3NhZ2UgPyBlIDogbmV3IEVycm9yKCd3YXNtIGluaXQgZXJyb3InKSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCd3YXNtIGxvYWQgdGltZW91dCcpKTsKICAgICAgICAgICAgfSwgNjAwMCk7CiAgICAgICAgICB9KQoKICAgICAgICB9KQogICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIG1zZzogJ0lOSVRfRkFJTEVEJywKICAgICAgICAgICAgbG9nOiBlLm1lc3NhZ2UKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfQogIH0KCiAgc2VsZi5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkgewogICAgdmFyIGRhdGEgPSBlLmRhdGE7CiAgICBpZiAoIWRhdGEubXNnKSB7CiAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgIG1zZzogJ0VSUk9SOmludmFsaWQgbWVzc2FnZScKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBpZiAoZGF0YS5tc2cgIT09ICdpbml0JyAmJiBkYXRhLm1zZyAhPT0gJ3ByZWxvYWQnICYmICFkZWNvZGVyKSByZXR1cm4KICAgICAgc3dpdGNoIChkYXRhLm1zZykgewogICAgICAgIGNhc2UgJ3ByZWxvYWQnOgogICAgICAgICAgaW5pdChkYXRhLnVybCk7CiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgJ2luaXQnOgogICAgICAgICAgc2VsZi5tZXRhID0gZGF0YS5tZXRhOwogICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIG1zZzogJ0xPRycsCiAgICAgICAgICAgIGxvZzogJ3dvcmtlciBpbml0ZWQnCiAgICAgICAgICB9KTsKICAgICAgICAgIGluaXQoZGF0YS51cmwpOwogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICd1cGRhdGVtZXRhJzoKICAgICAgICAgIHNlbGYubWV0YSA9IGRhdGEubWV0YTsKICAgICAgICAgIGRlY29kZXIudXBkYXRlTWV0YShkYXRhLm1ldGEpOwogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdpbml0RGVjb2Rlcic6CiAgICAgICAgICBkZWNvZGVyLmRlY29kZShkYXRhLmRhdGEpOwogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdkZWNvZGUnOgogICAgICAgICAgZGVjb2Rlci5kZWNvZGUoZGF0YS5kYXRhLCBkYXRhLmluZm8pOwogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdmbHVzaCc6CiAgICAgICAgICBkZWNvZGVyLmZsdXNoKCk7CiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgJ2ZpbmlzaF9mbGFnJzoKICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBtc2c6ICdCQVRDSF9GSU5JU0hfRkxBRycKICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdkZXN0b3J5JzoKICAgICAgICAgIGRlY29kZXIuZGVzdHJveSgpOwogICAgICAgICAgYnJlYWsKICAgICAgfQogICAgfQogIH07Cgp9KSgpOwoK",null,!1),WorkerFactory$1=createBase64WorkerFactory("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyogZXNsaW50LWRpc2FibGUgbm8tdW5kZWYgKi8KICAvLyDnm67liY3ku4XmlK/mjIF5dXY0MjAKCiAgZnVuY3Rpb24gc2hpbUltcG9ydFNjcmlwdHMgKHNyYykgewogICAgcmV0dXJuIGZldGNoKHNyYykKICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIHJldHVybiByZXMudGV4dCgpCiAgICAgIH0pCiAgICAgIC50aGVuKGZ1bmN0aW9uICh0ZXh0KSB7CiAgICAgICAgZXZhbCh0ZXh0KTsKICAgICAgICBzZWxmLk1vZHVsZSA9IE1vZHVsZTsKICAgICAgICBzZWxmLmFkZE9uUG9zdFJ1biA9IGFkZE9uUG9zdFJ1bjsKICAgICAgfSkKICB9CgogIHZhciBNQVhfU1RSRUFNX0JVRkZFUl9MRU5HVEggPSAxMDI0ICogMTAyNCAqIDU7IC8vIOWIhumFjSA1TSDnqbrpl7TlrZjlgqjluKfmlbDmja4KICB2YXIgQkFUQ0hfREVDT0RFX1NJWkUgPSAxMDsgLy8g5LiA5qyh5aSE55CG55qE5bin5pWw6YePCiAgdmFyIGluaXRUcyA9IDA7CgogIHZhciBEZWNvZGVyID0gZnVuY3Rpb24gKHNlbGYpIHsKICAgIHRoaXMuaW5pdGVkID0gZmFsc2U7CiAgICB0aGlzLmluZm9JZCA9IDA7CiAgICB0aGlzLnNlbGYgPSBzZWxmOwogICAgdGhpcy5tZXRhID0gc2VsZi5tZXRhOwogICAgdGhpcy50cyA9IDA7CiAgICB0aGlzLmluZm9saXN0ID0gW107CiAgICBzZWxmLnBhcl9icm9hZHdheU9uQnJvYWR3YXlJbml0ZWQgPSB0aGlzLmJyb2Fkd2F5T25Ccm9hZHdheUluaXRlZC5iaW5kKHRoaXMpOwogICAgc2VsZi5wYXJfYnJvYWR3YXlPblBpY3R1cmVEZWNvZGVkID0gdGhpcy5icm9hZHdheU9uUGljdHVyZURlY29kZWQuYmluZCh0aGlzKTsKICB9OwoKICBEZWNvZGVyLnByb3RvdHlwZS50b1U4QXJyYXkgPSBmdW5jdGlvbiAocHRyLCBsZW5ndGgpIHsKICAgIHJldHVybiBNb2R1bGUuSEVBUFU4LnN1YmFycmF5KHB0ciwgcHRyICsgbGVuZ3RoKQogIH07CgogIERlY29kZXIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7CiAgICBNb2R1bGUuX2Jyb2Fkd2F5SW5pdCgpOwoKICAgIC8vIOWtmOWCqOW4p+aVsOaNrueahGJ1ZmZlcuW8gOWni+S9jee9rgogICAgdGhpcy5zdHJlYW1CdWZmZXJQdHIgPSBNb2R1bGUuX2Jyb2Fkd2F5Q3JlYXRlU3RyZWFtKE1BWF9TVFJFQU1fQlVGRkVSX0xFTkdUSCk7CiAgICB0aGlzLnN0cmVhbUJ1ZmZlciA9IHRoaXMudG9VOEFycmF5KHRoaXMuc3RyZWFtQnVmZmVyUHRyLCBNQVhfU1RSRUFNX0JVRkZFUl9MRU5HVEgpOwogICAgLy8g55So5p2l5a2Y5YKo5q+P5binc2l6ZeeahOaVsOaNrueahOW8gOWni+S9jee9rgogICAgdGhpcy5idWZmZXJTaXplc1B0ciA9IE1vZHVsZS5fbWFsbG9jKDQgKiBCQVRDSF9ERUNPREVfU0laRSk7CiAgICB0aGlzLmJ1ZmZlclNpemVzID0gdGhpcy50b1U4QXJyYXkodGhpcy5idWZmZXJTaXplc1B0ciwgNCAqIEJBVENIX0RFQ09ERV9TSVpFKTsKICAgIHRoaXMuc3RyZWFtQnVmZmVyT2Zmc2V0ID0gMDsKICAgIHRoaXMuZnJhbWVMZW5zT2Zmc2V0ID0gMDsKICAgIHRoaXMuZnJhbWVMZW5zQnVmZmVyID0gbmV3IFVpbnQzMkFycmF5KEJBVENIX0RFQ09ERV9TSVpFKTsKICB9OwoKICBEZWNvZGVyLnByb3RvdHlwZS5icm9hZHdheU9uUGljdHVyZURlY29kZWQgPSBmdW5jdGlvbiAob2Zmc2V0LCB3aWR0aCwgaGVpZ2h0KSB7CiAgICB2YXIgaW5mbyA9IHRoaXMuaW5mb2xpc3Quc2hpZnQoKTsKICAgIHZhciB5Um93Y291bnQgPSBoZWlnaHQ7CiAgICB2YXIgdXZSb3djb3VudCA9IGhlaWdodCAvIDI7CiAgICB2YXIgeUxpbmVzaXplID0gd2lkdGg7CiAgICB2YXIgdXZMaW5lc2l6ZSA9IHdpZHRoIC8gMjsKICAgIGlmICh0aGlzLm1ldGEgJiYgKHRoaXMubWV0YS5jaHJvbWFGb3JtYXQgPT09IDQ0NCB8fCB0aGlzLm1ldGEuY2hyb21hRm9ybWF0ID09PSA0MjIpKSB7CiAgICAgIHV2Um93Y291bnQgPSBoZWlnaHQ7CiAgICB9CiAgICB2YXIgZGF0YSA9IHRoaXMudG9VOEFycmF5KG9mZnNldCwgeUxpbmVzaXplICogeVJvd2NvdW50ICsgMiAqICh1dkxpbmVzaXplICogdXZSb3djb3VudCkpOwogICAgLy8gdGhpcy5pbmZvbGlzdFtpbmZvaWRdID0gbnVsbDsKICAgIHZhciBkYXRldGVtcCA9IG5ldyBVaW50OEFycmF5KGRhdGEubGVuZ3RoKTsKICAgIGRhdGV0ZW1wLnNldChkYXRhKTsKICAgIHZhciBidWZmZXIgPSBkYXRldGVtcC5idWZmZXI7CgogICAgdGhpcy5zZWxmLnBvc3RNZXNzYWdlKAogICAgICB7CiAgICAgICAgbXNnOiAnREVDT0RFRCcsCiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0LAogICAgICAgIHlMaW5lc2l6ZSwKICAgICAgICB1dkxpbmVzaXplLAogICAgICAgIGluZm8sCiAgICAgICAgYnVmZmVyCiAgICAgIH0sCiAgICAgIFtidWZmZXJdCiAgICApOwogIH07CgogIERlY29kZXIucHJvdG90eXBlLmJyb2Fkd2F5T25Ccm9hZHdheUluaXRlZCA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLmluaXRlZCkgewogICAgICByZXR1cm4KICAgIH0KICAgIHRoaXMuaW5pdGVkID0gdHJ1ZTsKICAgIHRoaXMuc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgIG1zZzogJ0xPRycsCiAgICAgIGxvZzogJ2RlY29kZXIgaW5pdGVkJwogICAgfSk7CiAgICB2YXIgY29zdCA9IDA7CiAgICBpZiAoaW5pdFRzKSB7CiAgICAgIGNvc3QgPSBwZXJmb3JtYW5jZS5ub3coKSAtIGluaXRUczsKICAgIH0KICAgIHRoaXMuc2VsZi5wb3N0TWVzc2FnZSh7IG1zZzogJ0RFQ09ERVJfUkVBRFknLCBjb3N0IH0pOwogIH07CgogIERlY29kZXIucHJvdG90eXBlLnN0b3JlQnVmZmVyID0gZnVuY3Rpb24gKGRhdGEsIGZJbmZvKSB7CiAgICBpZiAoZkluZm8gJiYgZkluZm8ua2V5ZnJhbWUpIHsKICAgICAgdGhpcy5mbHVzaCgpOwogICAgfQogICAgdGhpcy5pbmZvbGlzdC5wdXNoKGZJbmZvKTsKICAgIHRoaXMuc3RyZWFtQnVmZmVyLnNldChkYXRhLCB0aGlzLnN0cmVhbUJ1ZmZlck9mZnNldCk7CiAgICB0aGlzLmZyYW1lTGVuc0J1ZmZlclt0aGlzLmZyYW1lTGVuc09mZnNldF0gPSBkYXRhLmxlbmd0aDsKICAgIHRoaXMuc3RyZWFtQnVmZmVyT2Zmc2V0ICs9IGRhdGEubGVuZ3RoOwogICAgdGhpcy5mcmFtZUxlbnNPZmZzZXQgKz0gMTsKICAgIHRoaXMuYmF0Y2hEZWNvZGUoKTsKICB9OwoKICBEZWNvZGVyLnByb3RvdHlwZS5iYXRjaERlY29kZSA9IGZ1bmN0aW9uIChmbHVzaCkgewogICAgLy8g5pSSMTDluKflpITnkIbkuIDmrKEg5oiW6ICFIOW8uuWItuino+eggQogICAgdmFyIHRvZG8gPSB0aGlzLmZyYW1lTGVuc09mZnNldCA+PSBCQVRDSF9ERUNPREVfU0laRSB8fCAoZmx1c2ggJiYgdGhpcy5mcmFtZUxlbnNPZmZzZXQpOwogICAgaWYgKHRvZG8pIHsKICAgICAgdGhpcy5idWZmZXJTaXplcy5zZXQobmV3IFVpbnQ4QXJyYXkodGhpcy5mcmFtZUxlbnNCdWZmZXIuYnVmZmVyKSwgMCk7CiAgICAgIE1vZHVsZS5fYnJvYWR3YXlQbGF5U3RyZWFtMSh0aGlzLmJ1ZmZlclNpemVzUHRyLCB0aGlzLmZyYW1lTGVuc09mZnNldCk7CiAgICAgIHRoaXMuZnJhbWVMZW5zT2Zmc2V0ID0gMDsKICAgICAgdGhpcy5zdHJlYW1CdWZmZXJPZmZzZXQgPSAwOwogICAgfQogIH07CgogIERlY29kZXIucHJvdG90eXBlLmRlY29kZSA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB0aGlzLnN0cmVhbUJ1ZmZlci5zZXQoZGF0YSk7CiAgICBNb2R1bGUuX2Jyb2Fkd2F5UGxheVN0cmVhbShkYXRhLmxlbmd0aCwgMCk7CiAgfTsKCiAgRGVjb2Rlci5wcm90b3R5cGUuZmx1c2ggPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmJhdGNoRGVjb2RlKHRydWUpOwogICAgTW9kdWxlLl9icm9hZHdheUZsdXNoU3RyZWFtKCk7CiAgfTsKCiAgRGVjb2Rlci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgIE1vZHVsZS5fYnJvYWR3YXlFeGl0KCk7CiAgfTsKCiAgRGVjb2Rlci5wcm90b3R5cGUudXBkYXRlTWV0YSA9IGZ1bmN0aW9uIChtZXRhKSB7CiAgICB0aGlzLm1ldGEgPSBtZXRhOwogIH07CgogIHZhciBkZWNvZGVyOwoKICBmdW5jdGlvbiBvblBvc3RSdW4gKCkgewogICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgIG1zZzogJ0xPRycsCiAgICAgIGxvZzogJ2RvIHBvc3QgcnVuJwogICAgfSk7CiAgICBkZWNvZGVyID0gbmV3IERlY29kZXIodGhpcyk7CiAgICBkZWNvZGVyLmluaXQoKTsKICB9CgogIHZhciBXQVNNX0NETl9QQVRIX1BSRUZJWCA9ICcnOwoKICBmdW5jdGlvbiBpbml0ICh1cmwpIHsKICAgIFdBU01fQ0ROX1BBVEhfUFJFRklYID0gdXJsLnNwbGl0KCcvJykuc2xpY2UoMCwgLTEpLmpvaW4oJy8nKTsKICAgIGluaXRUcyA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgaWYgKCFkZWNvZGVyKSB7CiAgICAgIHZhciB0YXNrOwoKICAgICAgaWYgKCFzZWxmLmltcG9ydFNjcmlwdHMpIHsKICAgICAgICB0YXNrID0gc2hpbUltcG9ydFNjcmlwdHModXJsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXNrID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgaWYgKCFzZWxmLmNvbnNvbGUpIHsKICAgICAgICAgICAgc2VsZi5jb25zb2xlID0gewogICAgICAgICAgICAgIGxvZzogZnVuY3Rpb24gKCkge30sCiAgICAgICAgICAgICAgd2FybjogZnVuY3Rpb24gKCkge30sCiAgICAgICAgICAgICAgaW5mbzogZnVuY3Rpb24gKCkge30sCiAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHt9CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBzZWxmLmltcG9ydFNjcmlwdHModXJsKTsKICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRhc2sKICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gZmV0Y2goV0FTTV9DRE5fUEFUSF9QUkVGSVggKyAnL2RlY29kZXIud29ya2VyLmpzJykKICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICAgIHJldHVybiByZXMuYmxvYigpCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChibG9iKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHNlbGYubSh7CiAgICAgICAgICAgICAgICBsb2NhdGVGaWxlOiBmdW5jdGlvbiAoc3VmZml4KSB7CiAgICAgICAgICAgICAgICAgIGlmICgvXC53b3JrZXJcLmpzJC8udGVzdChzdWZmaXgpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoL1wud2FzbSQvLnRlc3Qoc3VmZml4KSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBXQVNNX0NETl9QQVRIX1BSRUZJWCArICcvZGVjb2Rlci53YXNtJwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmICgvXC5tZW0kLy50ZXN0KHN1ZmZpeCkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gV0FTTV9DRE5fUEFUSF9QUkVGSVggKyAnL2RlY29kZXIuanMubWVtJwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWFpblNjcmlwdFVybE9yQmxvYjogV0FTTV9DRE5fUEFUSF9QUkVGSVggKyAnL2RlY29kZXIuanMnCiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKE1vZCkgewogICAgICAgICAgICAgIHNlbGYuTW9kdWxlID0gTW9kOwogICAgICAgICAgICAgIG9uUG9zdFJ1bi5jYWxsKHNlbGYpOwogICAgICAgICAgICB9KQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgbXNnOiAnSU5JVF9GQUlMRUQnLAogICAgICAgICAgICBsb2c6IGUubWVzc2FnZQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9CiAgfQoKICBzZWxmLm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChlKSB7CiAgICB2YXIgZGF0YSA9IGUuZGF0YTsKICAgIGlmICghZGF0YS5tc2cpIHsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgbXNnOiAnRVJST1I6aW52YWxpZCBtZXNzYWdlJwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChkYXRhLm1zZyAhPT0gJ2luaXQnICYmIGRhdGEubXNnICE9PSAncHJlbG9hZCcgJiYgIWRlY29kZXIpIHJldHVybgogICAgICBzd2l0Y2ggKGRhdGEubXNnKSB7CiAgICAgICAgY2FzZSAncHJlbG9hZCc6CiAgICAgICAgICBpbml0KGRhdGEudXJsKTsKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAnaW5pdCc6CiAgICAgICAgICBzZWxmLm1ldGEgPSBkYXRhLm1ldGE7CiAgICAgICAgICBCQVRDSF9ERUNPREVfU0laRSA9IGRhdGEuYmF0Y2hEZWNvZGVDb3VudDsKICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBtc2c6ICdMT0cnLAogICAgICAgICAgICBsb2c6ICd3b3JrZXIgaW5pdGVkJwogICAgICAgICAgfSk7CiAgICAgICAgICBpbml0KGRhdGEudXJsKTsKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAndXBkYXRlbWV0YSc6CiAgICAgICAgICBzZWxmLm1ldGEgPSBkYXRhLm1ldGE7CiAgICAgICAgICBkZWNvZGVyLnVwZGF0ZU1ldGEoZGF0YS5tZXRhKTsKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAnaW5pdERlY29kZXInOgogICAgICAgICAgaWYgKGRlY29kZXIuZnJhbWVMZW5zT2Zmc2V0KSB7CiAgICAgICAgICAgIGRlY29kZXIuYmF0Y2hEZWNvZGUodHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBkZWNvZGVyLmRlY29kZShkYXRhLmRhdGEpOwogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdkZWNvZGUnOgogICAgICAgICAgZGVjb2Rlci5zdG9yZUJ1ZmZlcihkYXRhLmRhdGEsIGRhdGEuaW5mbyk7CiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgJ2ZpbmlzaF9mbGFnJzoKICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBtc2c6ICdCQVRDSF9GSU5JU0hfRkxBRycKICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdkZXN0b3J5JzoKICAgICAgICAgIGRlY29kZXIuZGVzdHJveSgpOwogICAgICAgICAgYnJlYWsKICAgICAgfQogICAgfQogIH07Cgp9KSgpOwoK",null,!1),WorkerFactory=createBase64WorkerFactory("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyogZXNsaW50LWRpc2FibGUgbm8tdW5kZWYgKi8KCiAgZnVuY3Rpb24gc2hpbUltcG9ydFNjcmlwdHMgKHNyYykgewogICAgcmV0dXJuIGZldGNoKHNyYykKICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIHJldHVybiByZXMudGV4dCgpCiAgICAgIH0pCiAgICAgIC50aGVuKGZ1bmN0aW9uICh0ZXh0KSB7CiAgICAgICAgZXZhbCh0ZXh0KTsKICAgICAgICBzZWxmLk1vZHVsZSA9IE1vZHVsZTsKICAgICAgICBzZWxmLmFkZE9uUG9zdFJ1biA9IGFkZE9uUG9zdFJ1bjsKICAgICAgfSkKICB9CgogIHZhciBNQVhfU1RSRUFNX0JVRkZFUl9MRU5HVEggPSAxMDI0ICogMTAyNDsKICB2YXIgaW5pdFRzID0gMDsKCiAgdmFyIERlY29kZXIgPSBmdW5jdGlvbiAoc2VsZikgewogICAgdGhpcy5pbml0ZWQgPSBmYWxzZTsKICAgIHRoaXMuc2VsZiA9IHNlbGY7CiAgICB0aGlzLm1ldGEgPSBzZWxmLm1ldGE7CiAgICB0aGlzLmluZm9saXN0ID0gW107CiAgICBzZWxmLnBhcl9icm9hZHdheU9uQnJvYWR3YXlJbml0ZWQgPSB0aGlzLmJyb2Fkd2F5T25Ccm9hZHdheUluaXRlZC5iaW5kKHRoaXMpOwogICAgc2VsZi5wYXJfYnJvYWR3YXlPblBpY3R1cmVEZWNvZGVkID0gdGhpcy5icm9hZHdheU9uUGljdHVyZURlY29kZWQuYmluZCh0aGlzKTsKICB9OwoKICBEZWNvZGVyLnByb3RvdHlwZS50b1U4QXJyYXkgPSBmdW5jdGlvbiAocHRyLCBsZW5ndGgpIHsKICAgIHJldHVybiBNb2R1bGUuSEVBUFU4LnN1YmFycmF5KHB0ciwgcHRyICsgbGVuZ3RoKQogIH07CgogIERlY29kZXIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7CiAgICBNb2R1bGUuX2Jyb2Fkd2F5SW5pdCgpOwogICAgdGhpcy5zdHJlYW1CdWZmZXIgPSB0aGlzLnRvVThBcnJheSgKICAgICAgTW9kdWxlLl9icm9hZHdheUNyZWF0ZVN0cmVhbShNQVhfU1RSRUFNX0JVRkZFUl9MRU5HVEgsIDApLCAvLyAwOiDlhbPpl60gZmZtcGVnIGxvZywKICAgICAgTUFYX1NUUkVBTV9CVUZGRVJfTEVOR1RICiAgICApOwogIH07CgogIERlY29kZXIucHJvdG90eXBlLmJyb2Fkd2F5T25QaWN0dXJlRGVjb2RlZCA9IGZ1bmN0aW9uICgKICAgIG9mZnNldCwKICAgIHdpZHRoLAogICAgaGVpZ2h0LAogICAgeUxpbmVzaXplLAogICAgdXZMaW5lc2l6ZSwKICAgIGluZm9pZCwKICAgIGtleUZyYW1lCiAgKSB7CiAgICBsZXQgZmlyc3RGcmFtZSA9IHRoaXMuaW5mb2xpc3RbMF07CiAgICBpZiAoZmlyc3RGcmFtZSAmJiBmaXJzdEZyYW1lLmtleWZyYW1lICYmICFrZXlGcmFtZSkgcmV0dXJuCgogICAgbGV0IGluZm8gPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmluZm9saXN0LnNoaWZ0KCkpOwogICAgbGV0IHlSb3djb3VudCA9IGhlaWdodDsKICAgIGxldCB1dlJvd2NvdW50ID0gaGVpZ2h0IC8gMjsKICAgIGlmICgKICAgICAgdGhpcy5tZXRhICYmCiAgICAgICh0aGlzLm1ldGEuY2hyb21hRm9ybWF0ID09PSA0NDQgfHwgdGhpcy5tZXRhLmNocm9tYUZvcm1hdCA9PT0gNDIyKQogICAgKSB7CiAgICAgIHV2Um93Y291bnQgPSBoZWlnaHQ7CiAgICB9CiAgICB2YXIgZGF0YSA9IHRoaXMudG9VOEFycmF5KG9mZnNldCwgeUxpbmVzaXplICogeVJvd2NvdW50ICsgMiAqICh1dkxpbmVzaXplICogdXZSb3djb3VudCkpOwogICAgdmFyIGRhdGV0ZW1wID0gbmV3IFVpbnQ4QXJyYXkoZGF0YS5sZW5ndGgpOwogICAgZGF0ZXRlbXAuc2V0KGRhdGEpOwogICAgdmFyIGJ1ZmZlciA9IGRhdGV0ZW1wLmJ1ZmZlcjsKCiAgICB0aGlzLnNlbGYucG9zdE1lc3NhZ2UoCiAgICAgIHsKICAgICAgICBtc2c6ICdERUNPREVEJywKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgeUxpbmVzaXplLAogICAgICAgIHV2TGluZXNpemUsCiAgICAgICAgaW5mbywKICAgICAgICBidWZmZXIKICAgICAgfSwKICAgICAgW2J1ZmZlcl0KICAgICk7CiAgfTsKCiAgRGVjb2Rlci5wcm90b3R5cGUuYnJvYWR3YXlPbkJyb2Fkd2F5SW5pdGVkID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5pbml0ZWQgPSB0cnVlOwogICAgdGhpcy5zZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgbXNnOiAnTE9HJywKICAgICAgbG9nOiAnZGVjb2RlciBpbml0ZWQnCiAgICB9KTsKICAgIHZhciBjb3N0ID0gMDsKICAgIGlmIChpbml0VHMpIHsKICAgICAgY29zdCA9IHBlcmZvcm1hbmNlLm5vdygpIC0gaW5pdFRzOwogICAgfQogICAgdGhpcy5zZWxmLnBvc3RNZXNzYWdlKHsgbXNnOiAnREVDT0RFUl9SRUFEWScsIGNvc3QgfSk7CiAgfTsKCiAgRGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlID0gZnVuY3Rpb24gKGRhdGEsIGluZm8pIHsKICAgIGlmIChpbmZvKSB7CiAgICAgIHRoaXMuaW5mb2xpc3QucHVzaChpbmZvKTsKICAgIH0KICAgIGlmIChpbmZvICYmIGluZm8ua2V5ZnJhbWUpIHsKICAgICAgdGhpcy5pbmZvbGlzdCA9IFtpbmZvXTsKICAgIH0KICAgIHRoaXMuc3RyZWFtQnVmZmVyLnNldChkYXRhKTsKICAgIE1vZHVsZS5fYnJvYWR3YXlQbGF5U3RyZWFtKGRhdGEubGVuZ3RoLCAwKTsKICB9OwoKICBEZWNvZGVyLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgTW9kdWxlLl9icm9hZHdheUV4aXQoKTsKICB9OwoKICBEZWNvZGVyLnByb3RvdHlwZS51cGRhdGVNZXRhID0gZnVuY3Rpb24gKG1ldGEpIHsKICAgIHRoaXMubWV0YSA9IG1ldGE7CiAgfTsKCiAgdmFyIGRlY29kZXI7CgogIGZ1bmN0aW9uIG9uUG9zdFJ1biAoKSB7CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgbXNnOiAnTE9HJywKICAgICAgbG9nOiAnZG8gcG9zdCBydW4nCiAgICB9KTsKCiAgICBkZWNvZGVyID0gbmV3IERlY29kZXIodGhpcyk7CiAgICBkZWNvZGVyLmluaXQoKTsKICB9CgogIHZhciBXQVNNX0NETl9QQVRIX1BSRUZJWCA9ICcnOwoKICBmdW5jdGlvbiBpbml0ICh1cmwpIHsKICAgIFdBU01fQ0ROX1BBVEhfUFJFRklYID0gdXJsLnNwbGl0KCcvJykuc2xpY2UoMCwgLTEpLmpvaW4oJy8nKTsKICAgIGluaXRUcyA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgdmFyIGlzRGVncmFkZSA9IC9hc20vLnRlc3QodXJsKTsKICAgIGlmICghZGVjb2RlcikgewogICAgICB2YXIgdGFzazsKICAgICAgaWYgKCFzZWxmLmltcG9ydFNjcmlwdHMpIHsKICAgICAgICB0YXNrID0gc2hpbUltcG9ydFNjcmlwdHModXJsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXNrID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgaWYgKCFzZWxmLmNvbnNvbGUpIHsKICAgICAgICAgICAgc2VsZi5jb25zb2xlID0gewogICAgICAgICAgICAgIGxvZzogZnVuY3Rpb24gKCkge30sCiAgICAgICAgICAgICAgd2FybjogZnVuY3Rpb24gKCkge30sCiAgICAgICAgICAgICAgaW5mbzogZnVuY3Rpb24gKCkge30sCiAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHt9CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBzZWxmLmltcG9ydFNjcmlwdHModXJsKTsKICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRhc2sKICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoaXNEZWdyYWRlKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhdXRvIGluc3RhbmNlIERlY29kZXIhJyk7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICBvblBvc3RSdW4uY2FsbChzZWxmKTsKICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHNlbGYKICAgICAgICAgICAgLm0oewogICAgICAgICAgICAgIGluc3RhbnRpYXRlV2FzbTogZnVuY3Rpb24gKGluZm8sIHJlY2VpdmVJbnN0YW5jZSkgewogICAgICAgICAgICAgICAgZmV0Y2goYCR7V0FTTV9DRE5fUEFUSF9QUkVGSVh9L2RlY29kZXIud2FzbS5qc2ApCiAgICAgICAgICAgICAgICAgIC50aGVuKHJlcyA9PiByZXMuYXJyYXlCdWZmZXIoKSkKICAgICAgICAgICAgICAgICAgLnRoZW4oYnVmZmVyID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gV2ViQXNzZW1ibHkuaW5zdGFudGlhdGUoYnVmZmVyLCBpbmZvKQogICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlY2VpdmVJbnN0YW5jZShyZXN1bHQuaW5zdGFuY2UpCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKE1vZCkgewogICAgICAgICAgICAgIHNlbGYuTW9kdWxlID0gTW9kOwogICAgICAgICAgICAgIG9uUG9zdFJ1bi5jYWxsKHNlbGYpOwogICAgICAgICAgICB9KQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgbXNnOiAnSU5JVF9GQUlMRUQnLAogICAgICAgICAgICBsb2c6IGUubWVzc2FnZQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9CiAgfQoKICBzZWxmLm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChlKSB7CiAgICB2YXIgZGF0YSA9IGUuZGF0YTsKICAgIGlmICghZGF0YS5tc2cpIHsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgbXNnOiAnRVJST1I6aW52YWxpZCBtZXNzYWdlJwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICgoZGF0YS5tc2cgIT09ICdpbml0JyAmJiBkYXRhLm1zZyAhPT0gJ3ByZWxvYWQnKSAmJiAhZGVjb2RlcikgcmV0dXJuCiAgICAgIHN3aXRjaCAoZGF0YS5tc2cpIHsKICAgICAgICBjYXNlICdwcmVsb2FkJzoKICAgICAgICAgIGluaXQoZGF0YS51cmwpOwogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdpbml0JzoKICAgICAgICAgIHNlbGYubWV0YSA9IGRhdGEubWV0YTsKICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBtc2c6ICdMT0cnLAogICAgICAgICAgICBsb2c6ICd3b3JrZXIgaW5pdGVkJwogICAgICAgICAgfSk7CiAgICAgICAgICBpbml0KGRhdGEudXJsKTsKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAndXBkYXRlbWV0YSc6CiAgICAgICAgICBzZWxmLm1ldGEgPSBkYXRhLm1ldGE7CiAgICAgICAgICBkZWNvZGVyLnVwZGF0ZU1ldGEoZGF0YS5tZXRhKTsKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAnaW5pdERlY29kZXInOgogICAgICAgICAgZGVjb2Rlci5kZWNvZGUoZGF0YS5kYXRhKTsKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAnZGVjb2RlJzoKICAgICAgICAgIGRlY29kZXIuZGVjb2RlKGRhdGEuZGF0YSwgZGF0YS5pbmZvKTsKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAnZmluaXNoX2ZsYWcnOgogICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIG1zZzogJ0JBVENIX0ZJTklTSF9GTEFHJwogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgJ2Rlc3RvcnknOgogICAgICAgICAgZGVjb2Rlci5kZXN0cm95KCk7CiAgICAgICAgICBicmVhawogICAgICB9CiAgICB9CiAgfTsKCn0pKCk7Cgo=",null,!1),EleName="live-video";function getDecoderUrls(){var e=customElements.get(EleName);return e?{H264_DECODER_URL:e.h264Url,ASM_H264_DECODER_URL:e.h264AsmUrl,H265_DECODER_URL:e.h265Url,H265_THREAD_DECODER_URL:e.h265ThreadUrl,ASM_H265_DECODER_URL:e.h265AsmUrl}:{}}function threadSupported(){var e=customElements.get(EleName);return!!window.SharedArrayBuffer&&(null==e?void 0:e.h265ThreadUrl)}function preloadWorker(){var e;return(null===(e=customElements.get(EleName))||void 0===e?void 0:e.preloadWorker)||!1}function _createSuper$3(e){var t=_isNativeReflectConstruct$3();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$3(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var CAN_USE_HEVC_THREAD_DECODE=threadSupported(),MAX_DECODE_ONCE_FAST=80,MAX_DECODE_ONCE_DEFAULT=12,workerCached=[],WasmDecodeController=function(e){_inherits$4(r,e);var t=_createSuper$3(r);function r(e){var n;return _classCallCheck$4(this,r),_defineProperty$5(_assertThisInitialized$4(n=t.call(this,e)),"TAG","WasmController"),_defineProperty$5(_assertThisInitialized$4(n),"_avccpushed",!1),_defineProperty$5(_assertThisInitialized$4(n),"_maxDecodeOnce",MAX_DECODE_ONCE_DEFAULT),_defineProperty$5(_assertThisInitialized$4(n),"_continueDecodeThreshold",MAX_DECODE_ONCE_DEFAULT/2),_defineProperty$5(_assertThisInitialized$4(n),"_wasmInitCost",0),_defineProperty$5(_assertThisInitialized$4(n),"_decoderMode",window.WebAssembly?2:3),n._preload=n._parent.preloadWasmWorker,n._preloadWorker(),n}return _createClass$5(r,[{key:"wasmInitCost",get:function(){return this._decoderWorkers.length?this._decoderWorkers[0]._wasmInitCost:0}},{key:"isHevc",get:function(){var e;return this._preload?"h265"===this._preload:null===(e=this._parent)||void 0===e?void 0:e.isHevc}},{key:"_preloadWorker",value:function(){if(this._preload&&!workerCached.length){logger.log(this.TAG,"preload worker");var e=this._selectDecodeWorker()||{},t=e.decoder,r=e.url;t&&(this._avccpushed=!1,this._bindWorkerEvent(t),t.postMessage({msg:"preload",batchDecodeCount:10,url:r}),this._decoderWorkers.push(t))}}},{key:"_selectDecodeWorker",value:function(){var e,t=getDecoderUrls(),r=t.H264_DECODER_URL,n=t.H265_DECODER_URL,i=t.H265_THREAD_DECODER_URL,a=t.ASM_H264_DECODER_URL,o=t.ASM_H265_DECODER_URL;return logger.log(this.TAG,"start init wasm worker:",performance.now(),"hevc:",this.isHevc,"decoderMode:",this._decoderMode),this.isHevc?(e=3===this._decoderMode?o:1===this._decoderMode?i:n)?{decoder:1===this._decoderMode?new WorkerFactory$1:new WorkerFactory$2,url:e}:void this._workerErrorCallback("no found decoder url, decodeMode:".concat(this._decoderMode)):(e=3===this._decoderMode?a:r)?{decoder:new WorkerFactory,url:e}:void this._workerErrorCallback("no found decoder url, decodeMode:".concat(this._decoderMode))}},{key:"_initWorker",value:function(){var e=this;this._decoderReady&&this._workerMessageCallback({type:"DECODER_READY"}),CAN_USE_HEVC_THREAD_DECODE&&this.isHevc&&(this._decoderMode=1),this._decoderWorkers.length?this._decoderReady&&this._decoderWorkers.forEach((function(t){e._initDecoderWithConfiguration(t,e.meta)})):this._initDecodeWorkerInternal()}},{key:"_initDecodeWorkerInternal",value:function(e){var t=this._selectDecodeWorkerFromCache().decoder;if(t)return logger.warn(this.TAG,"select decoder from cache"),this._avccpushed=!1,this._bindWorkerEvent(t),this._decoderReady=!0,e||this._decoderWorkers.push(t),this._initDecoderWithConfiguration(t,this.meta),void this._workerMessageCallback({type:"DECODER_READY",data:t});var r=this._selectDecodeWorker()||{},n=r.decoder,i=r.url;n&&(this._avccpushed=!1,this._bindWorkerEvent(n),n.postMessage({msg:"init",meta:this.meta,batchDecodeCount:10,url:i}),e||this._decoderWorkers.push(n))}},{key:"_selectDecodeWorkerFromCache",value:function(){return{decoder:workerCached.pop()}}},{key:"_bindWorkerEvent",value:function(e){var t=this,r=function(r,n){if(3===t._decoderMode)t._workerErrorCallback(r);else{if(logger.log(t.TAG,"use asm: ",r,n),t._decoderMode=1===t._decoderMode?2:3,t._destroyWorker(e),!t.meta)return;t._initDecodeWorkerInternal()}};e.onMessage=function(n){var i,a;switch(n.data.msg){case"DECODER_READY":if(logger.log(t.TAG,"wasm worker ready ",performance.now(),"cost:",n.data.cost),t._decoderReady=!0,e._wasmInitCost=parseInt(n.data.cost),!t.meta)return;t._avccpushed||t._initDecoderWithConfiguration(e,t.meta),t.emit(Events.VIDEO.VIDEO_DECODER_INIT,e),t._workerMessageCallback({type:"DECODER_READY",data:e});break;case"DECODED":if(t._inDecoding=!0,(null===(i=n.data)||void 0===i||null===(a=i.info)||void 0===a?void 0:a.id)!==t._id)return;t._workerMessageCallback({type:"RECEIVE_FRAME",data:n.data});break;case"BATCH_FINISH_FLAG":if(e.using=0,t._inDecoding=!1,!t._workerMessageCallback)return;t._workerMessageCallback({type:"BATCH_FINISH"});break;case"INIT_FAILED":r(n.data.log,1)}},e.onError=function(e){r(e.message,2)},e.addEventListener("message",e.onMessage),e.addEventListener("error",e.onError)}},{key:"addDecodeWorker",value:function(){var e=this;this._initDecodeWorkerInternal(!0);var t=this._parent,r=t._timeRange,n=t._decodeEstimate,i=t.gopLength;return new Promise((function(t){e.once(Events.VIDEO.VIDEO_DECODER_INIT,(function(a){if(console.log("å¤šworker å¼€å§‹!"),!(e._decoderWorkers.length>=2)){var o=r.nextFrame();((o?o.gopId:0)-1)%2?e._decoderWorkers.unshift(a):e._decoderWorkers.push(a);var s=Math.max(Math.min(2*i,120),MAX_DECODE_ONCE_FAST);e._maxDecodeOnce=s,e._continueDecodeThreshold=parseInt(s/2),logger.log(e.TAG,"maxDecodeOnce = ".concat(s)),n.reset(),t()}}))}))}},{key:"_initDecoderWithConfiguration",value:function(e,t){logger.log(this.TAG,"init decoder with configuration"),this._avccpushed=!0,e.postMessage({msg:"updatemeta",meta:t});var r=t.rawVps||t.vps[0],n=t.rawSps||t.sps[0],i=t.rawPps||t.pps[0];if(r){var a=new Uint8Array(r.byteLength+4);a.set([0,0,0,1]),a.set(r,4),e.postMessage({msg:"initDecoder",data:a})}var o=new Uint8Array(n.byteLength+4);o.set([0,0,0,1]),o.set(n,4),e.postMessage({msg:"initDecoder",data:o}),(o=new Uint8Array(i.byteLength+4)).set([0,0,0,1]),o.set(i,4),e.postMessage({msg:"initDecoder",data:o})}},{key:"destroy",value:function(e){if(e&&!workerCached.length&&!this.isHevc&&1===this._decoderWorkers.length){var t=this._decoderWorkers.pop();return t._timer&&clearTimeout(t._timer),t.removeEventListener("message",t.onMessage),t.removeEventListener("error",t.onError),void workerCached.push(t)}this._destroyWorker()}},{key:"_destroyInternal",value:function(e){e._timer&&clearTimeout(e._timer),e.removeEventListener("message",e.onMessage),e.removeEventListener("error",e.onError),e.postMessage({msg:"destroy"}),e.terminate(),this._decoderWorkers=this._decoderWorkers.filter((function(t){return t!==e}))}},{key:"_destroyWorker",value:function(e){var t=this;logger.log(this.TAG,"destroy worker..."),e?this._destroyInternal(e):(this._decoderWorkers.forEach((function(e){t._destroyInternal(e)})),this._decoderWorkers=[])}}]),r}(DecodeController);function _createSuper$2(e){var t=_isNativeReflectConstruct$2();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$2(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var VideoRenderWithDecoder=function(t){_inherits$4(n,t);var r=_createSuper$2(n);function n(t,i){var a;return _classCallCheck$4(this,n),_defineProperty$5(_assertThisInitialized$4(a=r.call(this,t,i)),"preloadWasmWorker",preloadWorker()),_defineProperty$5(_assertThisInitialized$4(a),"_decoderErrorCallback",(function(e){a._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,"error",a._assembleErr(e))})),_defineProperty$5(_assertThisInitialized$4(a),"_decoderMessageCallback",(function(t){var r,n,i=t.type,o=t.data;switch(i){case"DECODER_READY":if(!a._frameRender){var s=Object.assign(a._config,{meta:a._meta,canvas:a._canvas,type:a._decodeController.webcodec?"2d":""});try{a._frameRender=new YUVCanvas(s,_assertThisInitialized$4(a)),logger.log(a.TAG,"create frameRender with config",s)}catch(e){a._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,"error",a._assembleErr(e&&e.message))}}a._startDecode();break;case"RECEIVE_FRAME":if(a._inChaseFrame&&(null===(r=a._decodeController)||void 0===r||!r.webcodec))return;a._receiveFrame(o);break;case"BATCH_FINISH":null===(n=_assertThisInitialized$4(a))||void 0===n||n._decodeEstimate.resetDecodeDot(),a._inChaseFrame&&(a._inChaseFrame=!1,a._frameQueue.empty())}})),a.TAG="VideoRenderWithDecoder",a._recentMeta=null,a.preloadWasmWorker&&(a._decodeController=new WasmDecodeController(_assertThisInitialized$4(a))),a}return _createClass$5(n,[{key:"wasmInitCost",get:function(){var e;return null===(e=this._decodeController)||void 0===e?void 0:e.wasmInitCost}},{key:"hevcThread",get:function(){return 1===this.decodeMode}},{key:"lowlatency",get:function(){return this._parent.lowlatency}},{key:"switchToMultiWorker",value:function(){var e;null===(e=this._decodeController)||void 0===e||e.addDecodeWorker()}},{key:"ajustSeekTime",value:function(e){var t;logger.log(this.TAG,"ajust seek time: ",e),null===(t=this._decodeController)||void 0===t||t.flushDecoder(),this._switchVideoBuffer(e)}},{key:"canSeek",value:function(){return!0}},{key:"_bindEvents",value:function(){var e,t=this;_get(_getPrototypeOf$4(n.prototype),"_bindEvents",this).call(this),this.on(Events.VIDEO.VIDEO_WAITING,(function(){if(0!==t.bitrate){clearInterval(e);var r=1;e=setInterval((function(){logger.log(t.TAG,"å¡é¡¿",r),console.log(t.TAG,"å¡é¡¿",r),r++,t.bitrate=t.bitrate/r,t.bitrate<4e4&&(t.bitrate=0,clearInterval(e))}),1e3)}})),this._parent.on(Events.TIMELINE.START_RENDER,(function(){clearInterval(e)})),this._parent.on(Events.TIMELINE.DESTROY,(function(){clearInterval(e)}))}},{key:"_appendChunk",value:function(e){var t;if(!this.noVideo&&this._timeRange){if(this._meta){if(this._recentMeta.width!==e.width||this._recentMeta.height!==e.height){logger.warn(this.TAG,"metadata changed! width: ".concat(this._recentMeta.width," -> ").concat(e.width,", height: ").concat(this._recentMeta.height," -> ").concat(e.height));var r=e.samples[0];r&&(this._recentMeta=r.meta=Object.assign({},e,{samples:null}))}}else{this._recentMeta=this._meta=Object.assign({},e,{samples:null}),logger.warn(this.TAG,"video set metadata",this._meta,"configuration:",this.configuration);var n=e.fpsNum/e.fpsDen;n?logger.log(this.TAG,"detect fps:",n):logger.warn(this.TAG,"no detect fps,start estimate"),this._selectDecoder(),this._initDecoder()}var i;if(this._timeRange.append(e.samples,this._isLive&&this.noAudio,!this.videoDecode),e.samples=[],e.samples=[],this.isLive||this._timeRange.frameLength||this._switchVideoBuffer(this._parent.currentTime),!this._ready&&null!==(t=this._decodeController)&&void 0!==t&&t.decoderReady)!this.noAudio&&null!==(i=this._decodeController)&&void 0!==i&&i.inDecoding||this._startDecode();this.noAudio&&this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.DURATION_CHANGE)}}},{key:"_selectDecoder",value:function(){if(!this.preloadWasmWorker)return!this.isHevc&&WebCodecDecodeController.isSupported()?(this._decodeController=new WebCodecDecodeController(this),void(this._decodeEstimate.webcodec=!0)):void(this._decodeController=new WasmDecodeController(this))}},{key:"_initDecoder",value:function(){var e;null===(e=this._decodeController)||void 0===e||e.init(this._decoderMessageCallback,this._decoderErrorCallback)}},{key:"_startDecode",value:function(){var e;null===(e=this._decodeController)||void 0===e||e.doDecode()}},{key:"_switchVideoBuffer",value:function(e){this._timeRange.switchBuffer(e),this._startDecode()}},{key:"_checkToDecode",value:function(){var e,t,r;(null!==(e=this._decodeController)&&void 0!==e&&e.webcodec?this._frameQueue.length<=(null===(t=this._decodeController)||void 0===t?void 0:t.needToDecode):this._frameQueue.length<(null===(r=this._decodeController)||void 0===r?void 0:r.needToDecode))&&this._startDecode()}},{key:"_render",value:function(e){var t;if(!this.noVideo){var r=this._frameQueue&&this._frameQueue.nextFrame();if(r){var n=r.info;if(!n)return this._frameQueue.shift(),void console.error("not info");this._renderDts=n.dts;var i=n.dts-this.preciseVideoDts;if(!(!e&&i>0&&i<1e3)){this._frameQueue.shift(this.preciseVideoDts),Math.abs(this._lastTimeupdate-n.dts)>250&&(this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.TIMEUPDATE,{pts:n.originPts/90}),this._lastTimeupdate=n.dts),logger.long&&logger.log(this.TAG,"render delay:".concat(i," , timelinePosition:").concat(this.preciseVideoDts," , dts:").concat(n.dts," , cost:").concat(n.cost," , gopID:").concat(n.gopId," , rest:").concat(this._frameQueue.length,", buffer frame:").concat(this._timeRange.frameLength));var a=performance.now();this._frameRender.render(r.buffer,r.width,r.height,r.yLinesize,r.uvLinesize),null!==(t=this._decodeController)&&void 0!==t&&t.webcodec&&r.buffer.close(),this._renderCost=performance.now()-a,this._checkToDecode()}}else{var o;if(logger.log(this.TAG,"lack frame",null===(o=this._decodeController)||void 0===o?void 0:o.inDecoding),this._checkToDecode(),this.noAudio){if(!this.isLive&&Math.abs(this.currentTime-this.duration)<.5)return null==this||this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.TIMEUPDATE),void(null==this||this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.ENDED));this._timeRange.frameLength||(this._ready=!1,this.emit(Events.VIDEO.VIDEO_WAITING))}}}}},{key:"_updateSegmentEnd",value:function(e){var t;null===(t=this._timeRange)||void 0===t||t.updateSegmentEnd(e)}},{key:"_doChaseFrame",value:function(e){var t=e.frame;this._inChaseFrame=!0,this._timeRange.deletePassed(t.dts),this._frameQueue.empty()}},{key:"_destroy",value:function(e){var t;logger.log(this.TAG,"destroy video decoder"),_get(_getPrototypeOf$4(n.prototype),"destroy",this).call(this),null===(t=this._decodeController)||void 0===t||t.destroy(e),this._decodeController=null}}]),n}(VideoBaseRender);function _createSuper$1(e){var t=_isNativeReflectConstruct$1();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct$1(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var TimeLine=function(e){_inherits$4(r,e);var t=_createSuper$1(r);function r(e,n){var i;return _classCallCheck$4(this,r),(i=t.call(this)).TAG="TimeLine",i._parent=n,i._seeking=!1,i.audioRender=new AudioRender(e,_assertThisInitialized$4(i)),i.videoRender=i._getController(n.videoDecode,e),i._readyStatus={audio:!1,video:!1},i._paused=!0,i._switchToMultiWorker=!1,i._lowdecodeEmited=!1,i._lastSeekTime=0,i._singleTrack=-1,i._bindEvent(),i._parent.updateCanplayStatus(i.currentAudioCanAutoplay),i._decodeVideo=e.video,i}return _createClass$5(r,[{key:"ready",get:function(){return this._readyStatus.video&&this._readyStatus.audio}},{key:"played",get:function(){var e=this;return{length:this.currentTime?1:0,start:function(){return 0},end:function(){return e.currentTime}}}},{key:"noAudio",get:function(){return 1===this._singleTrack||2===this._singleTrack}},{key:"seeking",get:function(){return this._seeking}},{key:"decodeFps",get:function(){return this.videoRender.decodeFps}},{key:"decodeCost",get:function(){return this.videoRender.decodeCost}},{key:"renderCost",get:function(){return this.videoRender.renderCost}},{key:"wasmInitCost",get:function(){return this.videoRender.wasmInitCost}},{key:"fps",get:function(){return this.videoRender.fps}},{key:"totalSize",get:function(){return this.videoRender.totalSize}},{key:"bitrate",get:function(){return this.videoRender.bitrate}},{key:"gopLength",get:function(){return this.videoRender.gopLength}},{key:"currentTime",get:function(){return this.noAudio?this.videoRender.currentTime:this.audioRender.currentTime}},{key:"timelinePosition",get:function(){return this.noAudio?performance.now()/1e3:this.audioRender.currentTime}},{key:"canvas",get:function(){return this.videoRender.canvas}},{key:"readyState",get:function(){return this.videoRender.readyState}},{key:"buffered",get:function(){return this.noAudio?this.videoRender.buffered:this.audioRender.buffered}},{key:"duration",get:function(){return this.noAudio?this.videoRender.duration:this.audioRender.duration}},{key:"paused",get:function(){return this._paused},set:function(e){this._paused=e}},{key:"lowlatency",get:function(){return this._parent.lowlatency}},{key:"decoderMode",get:function(){return this.videoRender.decoderMode}},{key:"audioCanAutoplay",get:function(){return this._parent._audioCanAutoplay}},{key:"currentAudioCanAutoplay",get:function(){return this.audioRender.audioCanAutoplay}},{key:"_getController",value:function(e,t){return e?new VideoRenderFromVideo(t,this):new VideoRenderWithDecoder(t,this)}},{key:"_resetReadyStatus",value:function(){this._readyStatus.audio=!1,this._readyStatus.video=!1}},{key:"_bindEvent",value:function(){var e=this;this.on(Events.DECODE_EVENTS.REMUX,(function(t){e.videoRender.setRemux(t)})),this.on(Events.DECODE_EVENTS.CHASE_VIDEO_FRAME_END,(function(t){e.emit(Events.DECODE_EVENTS.CHASE_AUDIO_FRAME,t)})),this.audioRender.on(Events.AUDIO.AUDIO_READY,(function(){logger.log(e.TAG,"audio ready!"),e._readyStatus.video&&e._startRender(),e._readyStatus.audio=!0})),this.audioRender.on(Events.AUDIO.AUDIO_WAITING,(function(){e.noAudio||(logger.warn(e.TAG,"lack data, audio waiting,currentTime:",e.currentTime),e.emit(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.TIMEUPDATE),e.emit(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.WAITING),e.emit(Events.TIMELINE.DO_PAUSE),e._readyStatus.audio=!1)})),this.videoRender.on(Events.VIDEO.VIDEO_WAITING,(function(){logger.warn(e.TAG,"lack data, video waiting"),e.emit(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.WAITING),e.emit(Events.TIMELINE.DO_PAUSE),e._readyStatus.video=!1})),this.videoRender.on(Events.VIDEO.VIDEO_READY,(function(){logger.log(e.TAG,"video ready!"),e._readyStatus.audio&&e._startRender("video"),e._readyStatus.video=!0})),this.videoRender.on(Events.VIDEO.DECODE_LOW_FPS,(function(){e.currentTime<2||e._lowdecodeEmited||(e._lowdecodeEmited=!0,e.emit(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.LOW_DECODE))})),this.on(Events.TIMELINE.ADJUST_SEEK_TIME,(function(t){e.videoRender.ajustSeekTime(t)})),this.on(Events.TIMELINE.SINGLE_TRACK,(function(t){e._singleTrack=t,1!==t&&2!==t||(e._readyStatus.audio=!0),3===t&&(e._readyStatus.video=!0),e.emit(Events.TIMELINE.SYNC_DTS,0)})),this.on(Events.TIMELINE.DESTROY,(function(){e.removeAllListeners(),e.videoRender=null,e.audioRender=null})),this.on(Events.TIMELINE.DO_PLAY,(function(t){e._parent.startPlayed||(e._parent.startPlayed=!0,e.emit(Events.TIMELINE.START_RENDER)),e._paused=!1}))}},{key:"_startRender",value:function(e){if(!this._parent.error&&this.videoRender){if(this.noAudio&&this.emit(Events.TIMELINE.SYNC_DTS,0),logger.warn(this.TAG,"startRender: time=",this.currentTime,"paused:",this.paused,"seeking:",this.seeking),this.videoRender.forceRender(),!this._parent.live&&this._paused&&this.seeking)return this._seeking=!1,void this.emit(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.SEEKED);this.emit(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.CANPLAY),this._parent.startPlayed||this.emit(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.FIRST_FRAME),(this._parent.autoplay||this._parent.startPlayed)&&(this._parent.startPlayed=!0,this.emit(Events.TIMELINE.START_RENDER,e)),this.emit(Events.TIMELINE.READY),this._seeking&&(this.currentAudioCanAutoplay||this.pause(),this._seeking=!1,this.emit(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.SEEKED),logger.groupEnd())}}},{key:"_checkHlsTracks",value:function(e,t){if(!(null==e?void 0:e.samples[0])){if(!this.buffered.length){var r=new Error("lack video sample");r.code=3,this.emit(Events.TIMELINE.PLAY_EVENT,"error",r)}return!1}return!0}},{key:"appendBuffer",value:function(e,t){if(!this._parent.live&&!this._checkHlsTracks(e,t))return;this.emit(Events.TIMELINE.APPEND_CHUNKS,e,t)}},{key:"play",value:function(){var e=this;return new Promise((function(t,r){var n=e.currentAudioCanAutoplay;e._parent.startPlayed||(e.emit(Events.TIMELINE.START_RENDER),e._parent.startPlayed=!0),e.noAudio?n=!0:e.audioRender&&e.audioRender.resume().then((function(){logger.log(e.TAG,"audioCtx start play"),e._paused?e.emit(Events.TIMELINE.DO_PAUSE):n=!0})),setTimeout((function(){return e.emit(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.TIMEUPDATE),n?e.videoRender&&!e.videoRender.canAutoPlay?(console.warn("video render an't autoplay"),e.pause(),void r({name:"NotAllowedError"})):(e._paused=!1,void t()):(logger.log(e.TAG,"audioCtx can't autoplay"),void(e._parent.firstWebAudio?(e._paused=!0,e.emit(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.PAUSE),r({name:"NotAllowedError"})):(e.pause(),t())))}),50)}))}},{key:"pause",value:function(){var e=this;this._paused||!this.ready&&!this._seeking||(this.emit(Events.TIMELINE.DO_PAUSE),setTimeout((function(){e._paused=!0,e.emit(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.PAUSE)})))}},{key:"seek",value:function(e){var t=this;if(this._seeking&&logger.groupEnd(),this.noAudio)this.emit(Events.TIMELINE.SYNC_DTS,this.videoRender.getDtsOfTime(e));else if(this._parent.live){if(this.currentTime<.1||!this.audioCanAutoplay||this.paused)return;var r=this.videoRender.getChaseFrameStartPosition(e,this._parent.preloadTime+1);if(r){var n=this.audioRender.canSeek(r.position),i=this.videoRender.canSeek(r);if(!n||!i)return void logger.log(this.TAG,"seek, !!!!!!!!!can not seek, audioCanSeek:",n,"videoCanSeek:",i);logger.warn(this.TAG,"seek, chase frame to time: ",r.position,"duration:",this.duration),this.videoRender.videoDecode?(this.audioRender._doPause(),r.position=r.position-1.5,this.emit(Events.DECODE_EVENTS.CHASE_VIDEO_FRAME,r)):this.emit(Events.TIMELINE.CHASE_FRAME,r)}}else this._lastSeekTime!==e&&(this._lastSeekTime=e,e>=this.duration&&(e=this.duration-1),e<0&&(e=0),logger.group(this.TAG,"start seek to:",e),this._seeking=!0,this._resetReadyStatus(),this.emit(Events.TIMELINE.DO_SEEK,e),new Promise((function(e){t.emit(Events.TIMELINE.PLAY_EVENT,Events.VIDEO_EVENTS.SEEKING),e()})))}},{key:"dump",value:function(){return this.audioRender.dump()}}]),r}(EventEmitter$1);function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var VIDEO_DECODE_MODE_VALUE="7",SINGLE_TRACK_TYPE={LOW_LATENCY:1,NO_AUDIO:2,NO_VIDEO:3},MVideo=function(t){_inherits$4(n,t);var r=_createSuper(n);function n(){var e;return _classCallCheck$4(this,n),(e=r.call(this)).TAG="MVideo",e._proxyProps(),e._isLive=!0,e._vMeta=null,e._aMeta=null,e._degradeVideo=document.createElement("video"),e._eventsBackup=[],e._audioCanAutoplay=!0,e._startPlayed=!1,e._endOfStream=!1,e._debounceSeek=debounce(e._seek.bind(_assertThisInitialized$4(e)),600),e._onTouchEnd=e._onTouchEnd.bind(_assertThisInitialized$4(e)),e}return _createClass$5(n,[{key:"_proxyProps",value:function(){var t=this;Object.getOwnPropertyNames(n.prototype).forEach((function(r){if(/^__/.test(r)){var n=r.replace("__","");Object.defineProperty(t,n,{get:function(){try{return this[r]}catch(e){}return 0},set:function(t){try{this[r]=t}catch(e){}}})}}))}},{key:"addEventListener",value:function(e,t,r){_get(_getPrototypeOf$4(n.prototype),"addEventListener",this).call(this,e,t,r),this._eventsBackup.push([e,t,r])}},{key:"removeEventListener",value:function(e,t,r){_get(_getPrototypeOf$4(n.prototype),"removeEventListener",this).call(this,e,t,r),this._eventsBackup=this._eventsBackup.filter((function(n){return!(n.eventName===e&&n.handler===t&&n.capture===r)}))}},{key:"setAttribute",value:function(e,t){_get(_getPrototypeOf$4(n.prototype),"setAttribute",this).call(this,e,t),"src"!==e&&this._degradeVideo.setAttribute(e,t)}},{key:"_init",value:function(){this.timeline=new TimeLine({volume:this.volume,canvas:this.querySelector("canvas"),videoContext:this.videoContext,videoDecode:this.videoDecode,maxVideoHeight:this.getAttribute("maxVideoHeight"),endLevel:parseInt(this.getAttribute("endLevel"))},this),this._firstWebAudio=!1,this._noSleep=new NoSleep,this._logFirstFrame=!1,this._playRequest=null,this._degradeVideoUserGestured=!1,this._bindEvents(),this._vMeta&&!this.videoDecode&&this.setVideoMeta(this._vMeta),this._glCtxOptions&&(this.glCtxOptions=this._glCtxOptions),this.timeline&&(this.innerDegrade&&this.timeline.emit(Events.TIMELINE.INNER_DEGRADE),this.timeline.emit(Events.TIMELINE.SET_PLAY_MODE,this._isLive?"LIVE":"VOD"),this.muted=this.muted)}},{key:"_bindEvents",value:function(){var e=this;this.timeline.on(Events.TIMELINE.PLAY_EVENT,(function(t,r){if("canplay"===t&&(e.querySelector("canvas")||(logger.log(e.TAG,"_bindEvents, appendChild canvas"),e.appendChild(e.canvas))),"loadeddata"!==t&&"resize"!==t||Promise.resolve().then((function(){e.updateVideoPostion()})),"error"===t){if(logger.warn(e.TAG,"detect error:",null==r?void 0:r.message),e.pause(),e._disabled(!0),e.innerDegrade||4===e.decoderMode)return e.degradeInfo={decodeFps:e.decodeFps,bitrate:e.bitrate,wasmInitCost:e.wasmInitCost,fps:e.fps,url:e.src,msg:null==r?void 0:r.message,decoderMode:e.decoderMode},void e._innerDispatchEvent("lowdecode");e._err=r}if("lowdecode"===t)return e._disabled(),e.degradeInfo={decodeFps:e.decodeFps,bitrate:e.bitrate,wasmInitCost:e.wasmInitCost,fps:e.fps,url:e.src,decoderMode:e.decoderMode},void e._innerDispatchEvent(t,e.degradeInfo);if("largeavgap"===t&&(e.unsyncInfo=r),"ended"===t){if(e.paused)return;e.pause()}"progress"===t&&e._noSleep.toPlay(),e._innerDispatchEvent(t,r)}))}},{key:"_disabled",value:function(e){!this.videoDecode&&this.innerDegrade&&(e||!this.decodeFps||this.decodeFps/this.fps<=.8&&this.bitrate<2e6?localStorage.setItem("mvideo_dis265",1):localStorage.getItem("mvideo_dis265")||(localStorage.setItem("mvideo_dis265",2),localStorage.setItem("mvideo_disTime",(new Date).getTime())))}},{key:"degrade",value:function(e){var t=this;!!this.querySelector("canvas")?this.replaceChild(this._degradeVideo,this.canvas):this.appendChild(this._degradeVideo),this.destroy(),this._eventsBackup.forEach((function(e){var r=_slicedToArray$1(e,3),i=r[0],a=r[1],o=r[2];_get(_getPrototypeOf$4(n.prototype),"removeEventListener",t).call(t,i,a,o),t._degradeVideo.addEventListener(i,a,o)})),this._eventsBackup=[],e&&(this._degradeVideo.muted=!1,this._degradeVideo.src=e,this._degradeVideo.load())}},{key:"disconnectedCallback",value:function(){logger.log(this.TAG,"video disconnected"),document.removeEventListener("touchend",this._onTouchEnd,!0),this.destroy()}},{key:"connectedCallback",value:function(){logger.log(this.TAG,"video connected to document",performance.now()),this.timeline||(this._init(),this._firstWebAudio=!0),this.style.width="100%",this.style.height="100%",this.style.position="absolute",this.style.left="0px",this.style.top="0px",document.addEventListener("touchend",this._onTouchEnd,!0)}},{key:"_onTouchEnd",value:function(){playSlienceAudio(),this._degradeVideoInteract(),this._noSleep&&this._noSleep.enable()}},{key:"handleMediaInfo",value:function(){this._logFirstFrame=!1}},{key:"_degradeVideoInteract",value:function(){var e=this;if(this._degradeVideo&&(1===this.innerDegrade||3===this.innerDegrade)){if(this._degradeVideoUserGestured)return;var t=this._degradeVideo.play();t&&t.then((function(){e._degradeVideo.pause(),e._degradeVideoUserGestured=!0})).catch((function(e){console.log("degrade video: ",e.message)}))}}},{key:"play",value:function(e){var t=this;if(logger.log(this.TAG,"mvideo called play(),ready:".concat(this.timeline.ready,", paused:").concat(this.timeline.paused,", force:").concat(e)),this._endOfStream=!1,this._degradeVideoInteract(),this.timeline.ready&&this.timeline.paused||e){if(e=e||this._isLive,this._playRequest=null,!e)return this.timeline.emit(Events.TIMELINE.DO_PLAY),this._innerDispatchEvent("play"),Promise.resolve();this.destroy(!0),this._init(),this._innerDispatchEvent("waiting")}return this._playRequest||!this.timeline.ready||this.timeline.paused?(this._playRequest=this._playRequest||new Promise((function(e,r){t.timeline._paused=!1,t._innerDispatchEvent("timeupdate"),t._innerDispatchEvent("play"),t._noSleep.enable(),t.timeline.once("ready",(function(){logger.log(t.TAG,"timeline emit ready"),t.timeline.play().then(e).catch(r).then((function(){t._playRequest=null}))}))})),this._playRequest):Promise.resolve()}},{key:"pause",value:function(){this._playRequest=null,this.timeline&&this.timeline.pause();try{this._noSleep.disable(),pauseSlienceAudio()}catch(e){}}},{key:"load",value:function(){}},{key:"appendBuffer",value:function(e,t){if(this.timeline){if(!this._logFirstFrame){var r=e&&e.samples[0],n=t&&t.samples[0];if(!r&&!n)return;if(r||n){var i=(null==e?void 0:e.duration)/((null==e?void 0:e.formatTimescale)||1/0),a=(null==t?void 0:t.duration)/((null==t?void 0:t.formatTimescale)||1/0);logger.warn(this.TAG,"video firstDts:".concat(r&&r.dts," , audio firstDts:").concat(n&&n.dts," videoTrack.duration=").concat(i,", audioTrack.duration=").concat(a)),this._logFirstFrame=!0,(i||a)&&(this.setPlayMode("VOD"),this.timeline.emit(Events.TIMELINE.SET_PLAY_MODE,this._isLive?"LIVE":"VOD"),this.duration=Math.max(i,a))}this.lowlatency&&(logger.warn(this.TAG,"single track! type=",SINGLE_TRACK_TYPE.LOW_LATENCY),this.timeline.emit(Events.TIMELINE.SINGLE_TRACK,SINGLE_TRACK_TYPE.LOW_LATENCY)),n||t.exist()||(logger.warn(this.TAG,"single track! type=",SINGLE_TRACK_TYPE.NO_AUDIO),this.timeline.emit(Events.TIMELINE.SINGLE_TRACK,SINGLE_TRACK_TYPE.NO_AUDIO)),r||e.exist()||(logger.warn(this.TAG,"single track! type=",SINGLE_TRACK_TYPE.NO_VIDEO),this.timeline.emit(Events.TIMELINE.SINGLE_TRACK,SINGLE_TRACK_TYPE.NO_VIDEO)),window.firstFrameTime=Date.now()}e.formatTimescale&&e.samples.forEach((function(t){t.dts=t.dts/e.formatTimescale*1e3,t.pts=t.pts/e.formatTimescale*1e3})),t.formatTimescale&&t.samples.forEach((function(e){e.dts=e.dts/t.formatTimescale*1e3,e.pts=e.pts/t.formatTimescale*1e3})),this.timeline.appendBuffer(e,t)}}},{key:"setAudioMeta",value:function(e){this._aMeta=e,this.timeline.emit(Events.TIMELINE.SET_METADATA,"audio",e)}},{key:"setVideoMeta",value:function(e){!this._isLive&&this._vMeta||(this.timeline.emit(Events.TIMELINE.SET_METADATA,"video",e),this._vMeta=e)}},{key:"setDecodeMode",value:function(e){this.setAttribute("decodeMode",e)}},{key:"setPlayMode",value:function(e){this._isLive="LIVE"===e}},{key:"endOfStream",value:function(){var e;this.currentTime&&(this._endOfStream=!0,null===(e=this.timeline)||void 0===e||e.emit(Events.TIMELINE.END_OF_STREAM))}},{key:"updateVideoPostion",value:function(){var e;null===(e=this.timeline)||void 0===e||e.emit(Events.VIDEO.UPDATE_VIDEO_FILLTYPE,this.xgfillType,this.containerLayout)}},{key:"_innerDispatchEvent",value:function(e,t){this.dispatchEvent(new CustomEvent(e,{detail:t}))}},{key:"destroy",value:function(e){this.timeline&&(this._noSleep.destroy(),logger.log(this.TAG,"call destroy"),this.timeline.emit(Events.TIMELINE.DESTROY,e),this.querySelector("video")&&this.removeChild(this.querySelector("video")),this.timeline=null,this._err=null,this._noSleep=null)}},{key:"updateCanplayStatus",value:function(e){if(!e){var t=navigator.userAgent;/Chrome/.test(t)||(this._audioCanAutoplay=e)}}},{key:"updateObjectPosition",value:function(e,t){this.timeline.emit(Events.VIDEO.UPDATE_VIDEO_COVER_POSITION,this.containerLayout,e,t),this._degradeVideo&&(this._degradeVideo.style.objectPosition="".concat(100*e,"% ").concat(100*t,"%"))}},{key:"dump",value:function(){return this.timeline.dump()}},{key:"setVideoDecode",value:function(){logger.log(this.TAG,"set videoDecode",this.videoDecode),this.videoDecode&&this.timeline&&this.timeline.videoRender&&(this.timeline.videoRender.videoDecode=this.videoDecode)}},{key:"startPlayed",get:function(){return this._startPlayed},set:function(e){this._startPlayed=e}},{key:"live",get:function(){return this._isLive}},{key:"firstWebAudio",get:function(){return this._firstWebAudio}},{key:"lowlatency",get:function(){return"true"===this.getAttribute("lowlatency")},set:function(e){this.setAttribute("lowlatency",e)}},{key:"autoplay",get:function(){return"true"===this.getAttribute("autoplay")},set:function(e){this.setAttribute("autoplay",e)}},{key:"__canvas",get:function(){return this.timeline.canvas}},{key:"__ended",get:function(){return!!this._endOfStream&&Math.abs(this.currentTime-this.duration)<.5}},{key:"__width",get:function(){return this.getAttribute("width")||this.videoWidth},set:function(e){var t="number"==typeof e?"".concat(e,"px"):e;this.setAttribute("width",t),this.canvas.width=e}},{key:"__height",get:function(){return this.getAttribute("height")},set:function(e){var t="number"==typeof e?"".concat(e,"px"):e;this.setAttribute("height",t),this.canvas.height=e}},{key:"__videoWidth",get:function(){return this.canvas.width}},{key:"__videoHeight",get:function(){return this.canvas.height}},{key:"__volume",get:function(){return Number(this.getAttribute("volume"))},set:function(e){e<=0&&(e=0),e>=1&&(e=1),this.setAttribute("volume",e),this.muted||this.timeline.emit(Events.TIMELINE.UPDATE_VOLUME,e)}},{key:"__muted",get:function(){return"true"===this.getAttribute("muted")},set:function(e){this.setAttribute("muted",e),this._degradeVideoInteract(),this._noSleep.enable(),this.timeline.emit(Events.TIMELINE.UPDATE_VOLUME,e?0:this.volume)}},{key:"__currentTime",get:function(){if(!this.timeline)return 0;var e=this.timeline.currentTime,t=this.timeline.duration;return Math.min(e,t)},set:function(e){this._debounceSeek(e)}},{key:"_seek",value:function(e){this.timeline&&(this.buffered.length||this.play(),this.timeline.seek(Number(e)))}},{key:"__duration",get:function(){return this._isLive?1/0:this.timeline.duration},set:function(e){this.timeline.emit(Events.TIMELINE.SET_VIDEO_DURATION,e),this._innerDispatchEvent("durationchange")}},{key:"__seeking",get:function(){return this.timeline.seeking}},{key:"__paused",get:function(){return this.timeline.paused}},{key:"__fps",get:function(){return this.timeline.fps}},{key:"__decodeFps",get:function(){return this.timeline.decodeFps}},{key:"__decodeCost",get:function(){return parseInt(this.timeline.decodeCost)}},{key:"__renderCost",get:function(){return this.timeline.renderCost}},{key:"__wasmInitCost",get:function(){return this.timeline.wasmInitCost}},{key:"__totalSize",get:function(){return this.timeline.totalSize}},{key:"__bitrate",get:function(){return this.timeline.bitrate}},{key:"__gopLength",get:function(){return this.timeline.gopLength}},{key:"__readyState",get:function(){return this.timeline.readyState}},{key:"__buffered",get:function(){return this.timeline.buffered}},{key:"__decoderMode",get:function(){return this.timeline.decoderMode}},{key:"src",get:function(){return this.getAttribute("src")},set:function(e){this.src&&this.buffered.length&&(this._vMeta=null,this.startPlayed=!1),this.setAttribute("src",e)}},{key:"currentSrc",get:function(){return this.getAttribute("src")}},{key:"playbackRate",get:function(){return 1},set:function(e){}},{key:"networkState",get:function(){return 0}},{key:"preloadTime",get:function(){var e=this.getAttribute("preloadtime");if(e){var t=Number.parseFloat(e);if(t>0&&!Number.isNaN(t))return t}return 1/0},set:function(e){e&&Number(e)>0&&this.setAttribute("preloadtime",e)}},{key:"innerDegrade",get:function(){var e=this.getAttribute("innerdegrade");return parseInt(e)}},{key:"__glCtxOptions",set:function(e){this._glCtxOptions=e,this.timeline.emit(Events.TIMELINE.UPDATE_GL_OPTIONS,e)}},{key:"__error",get:function(){return this._err},set:function(e){this.timeline.emit(Events.TIMELINE.PLAY_EVENT,"error",e)}},{key:"degradeVideo",get:function(){return this._degradeVideo}},{key:"degradeInfo",get:function(){return this._deradeInfo},set:function(e){this._deradeInfo=e}},{key:"unsyncInfo",get:function(){return this._unsyncInfo},set:function(e){this._unsyncInfo=e}},{key:"xgfillType",get:function(){return this.parentNode.getAttribute("data-xgfill")}},{key:"containerLayout",get:function(){var e=this.parentNode;return{width:e.clientWidth,height:e.clientHeight}}},{key:"videoDecode",get:function(){return this.getAttribute("decodeMode")===VIDEO_DECODE_MODE_VALUE}}],[{key:"version",get:function(){return"3.0.0-next.6-6"}},{key:"init",value:function(e){var t=e.h264Url,r=e.h264AsmUrl,n=e.h265AsmUrl,i=e.h265Url,a=e.h265ThreadUrl,o=customElements.get(EleName);o&&(o.h264Url=t,o.h265Url=i,o.h265AsmUrl=n,o.h264AsmUrl=r,o.h265ThreadUrl=a)}},{key:"isSupported",value:function(){var e=localStorage.getItem("mvideo_dis265");if(!e)return!0;if("1"===e)return!1;if("2"===e){var t=localStorage.getItem("mvideo_disTime")||0;if(t=Number(t),((new Date).getTime()-t)/1e3<86400)return!1;localStorage.removeItem("mvideo_disTime"),localStorage.removeItem("mvideo_dis265")}return!0}},{key:"preloadWorker",get:function(){return n._preloadWorker||""},set:function(e){n._preloadWorker=e}}]),n}(_wrapNativeSuper(HTMLElement));customElements.get(EleName)||customElements.define(EleName,MVideo);var H264_DECODER_URL="https://sf1-cdn-tos.huoshanstatic.com/obj/media-fe/decoder/1.1.1/h264/decoder.js",ASM_H264_DECODER_URL="https://sf1-cdn-tos.huoshanstatic.com/obj/media-fe/decoder/1.1.1/h264/decoder_asm.js",H265_DECODER_URL="https://sf1-cdn-tos.huoshanstatic.com/obj/media-fe/decoder/1.1.1/h265/decoder_1596185762157.js",H265_THREAD_DECODER_URL="https://sf1-cdn-tos.huoshanstatic.com/obj/media-fe/decoder/1.1.0/h265thread/decoder.js",ASM_H265_DECODER_URL="https://sf1-cdn-tos.huoshanstatic.com/obj/media-fe/decoder/1.1.1/h265/decoder_asm_1594191692633.js";MVideo.init({h264Url:H264_DECODER_URL,h264AsmUrl:ASM_H264_DECODER_URL,h265Url:H265_DECODER_URL,h265AsmUrl:ASM_H265_DECODER_URL,h265ThreadUrl:H265_THREAD_DECODER_URL});var index_min="",VePlayer=function(){function e(t){return _classCallCheck$8(this,e),this.player=null,this.mountingDom=null,this.playerContainer=null,this.mobilePanel=null,this._isFirstCreated=!0,this.sdkPlugins=[],this._sdkPlugins={},this._init(t),new Proxy(this,{get:function(e,t,r){var n;return"string"==typeof t&&["playerData","player","mountingDom","playerContainer","mobilePanel","_emitter","isFirstCreated"].includes(t)?Reflect.get(e,t,r):null!==(n=Reflect.get(e,t,r))&&void 0!==n?n:Reflect.get(e.getPlayerInstance(),t,r)}})}var t,r,n,i;return _createClass$9(e,[{key:"_init",value:function(e){this.playerData=new PlayerData(e),this._emitter=new EventEmitter$1,this._initSdkPlugins(),this.renderDom(),this.createPlayer(),this.dataMonitoring(),this._initI18N(this.playerData.languageData)}},{key:"_initSdkPlugins",value:function(){var e=this;sdkPluginManager.init(this),_toConsumableArray$3(this.sdkPlugins).map((function(t){return sdkPluginManager.registerPlugin(t,e)}))}},{key:"on",value:function(e,t){this._emitter.on(e,t)}},{key:"emit",value:function(e,t){this._emitter.emit(e,t)}},{key:"once",value:function(e,t){this._emitter.once(e,t)}},{key:"off",value:function(e,t){this._emitter.off(e,t)}},{key:"dataMonitoring",value:function(){}},{key:"renderDom",value:function(){var e=this.playerData,t=e.id,r=e.root,n=document.createElement("div");this.playerContainer=n;var i=r||document.querySelector("#".concat(t));i&&(i.appendChild(n),this.mountingDom=i)}},{key:"renderPoster",value:function(){if(this.playerContainer){var e=this.playerData.options,t=e.poster,r=void 0===t?"":t,n=e.width,i=e.height;r&&(this.playerContainer.style.cssText='background: url("'.concat(r,'");\n    background-size: cover;\n    width:').concat(n?n+"px":"100%",";\n    height:").concat(i?i+"px":"100%",";\n    "))}}},{key:"createPlayer",value:(i=_asyncToGenerator$7(_regeneratorRuntime$5().mark((function e(){var t,r,n,i,a,o,s,u,c,l,d,h,f,p,g,y,m,v,_,b,A,E,S,T,w,C,k;return _regeneratorRuntime$5().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._destroyPlayer();case 2:return e.next=4,this.beforePlayerCreate();case 4:if(i=this.playerData,a=i.isLive,o=i.options,s=i.plugins,u=i.isMobile,c=i.openSoftDecoding,l=i.configs,d=this.playerData.getCurrentUrl(),h=this.playerData.getCurrentStreamType()||getFormat(null==l?void 0:l.getVideoByToken),(f=getPluginConfig(l,"EncryptHlsPlugin"))||"hls"===h&&isEncryptPlay(null==l?void 0:l.getVideoByToken)||d&&h){e.next=13;break}return console.warn("æ— å¿…è¦æ¡ä»¶: url:".concat(d,", streamType").concat(h)),this.renderPoster(),e.abrupt("return");case 13:return p=createSDKPreset(a,h,u,c,l),g=u?createPlayerOption(a):createPlayerOption$1(a),y=this.getSoftDecodingOption(c),m=this._analyzeExtendPlugins(),v=m.basicPlugins,_=void 0===v?[]:v,b=m.iconPlugins,A=void 0===b?[]:b,E=this.playerData.getLineList(),S=this.playerData.current.lineId,T=this.playerData.getDefinitionListByLineId(S),w=_objectSpread2$7(_objectSpread2$7(_objectSpread2$7(_objectSpread2$7({},g),o),y),{},{icons:_objectSpread2$7(_objectSpread2$7({},g.icons),null!==(t=null==o?void 0:o.icons)&&void 0!==t?t:{}),MoreButtonPlugin:{iconPlugins:[].concat(_toConsumableArray$3(null!==(r=null===(n=o.MoreButtonPlugin)||void 0===n?void 0:n.iconPlugins)&&void 0!==r?r:[]),_toConsumableArray$3(A),[PlaybackRateMobilePlugin])},playerData:this.playerData}),E.length>1&&w.MoreButtonPlugin.iconPlugins.push(LineMobilePlugin),T.length>1&&w.MoreButtonPlugin.iconPlugins.push(DefinitionMobilePlugin),this.setDefaultConfigOptions(w),C=[].concat(_toConsumableArray$3(_),_toConsumableArray$3(s)),this._isFirstCreated?this._isFirstCreated=!1:(w.autoplayMuted=!1,w.ignores=[].concat(_toConsumableArray$3(null!==(k=null==w?void 0:w.ignores)&&void 0!==k?k:[]),["sdkUnmutePlugin"])),this.setHlsEncryptConfig(w,f,d),this.player=new PresetPlayer(_objectSpread2$7(_objectSpread2$7({el:this.playerContainer,presets:p,url:d,isLive:a},w),{},{plugins:_toConsumableArray$3(C)})),this.player.playerData=this.playerData,this._emitter.emit(SDKEvents.PLAYER_CREATED_FINISH),this.afterPlayerCreate(),e.abrupt("return",this.player);case 32:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setHlsEncryptConfig",value:function(e,t,r){r&&t&&!t.url&&setPluginConfig(e,"EncryptHlsPlugin","url",r),t&&!t.playDomain&&setPluginConfig(e,"EncryptHlsPlugin","playDomain",TOB_PLAY_DOMAIN),t&&!t.getKeyType&&setPluginConfig(e,"EncryptHlsPlugin","getKeyType","TOP"),t&&!t.keyDomain&&setPluginConfig(e,"EncryptHlsPlugin","keyDomain",TOB_KEY_DOMAIN)}},{key:"setDefaultConfigOptions",value:function(e){if(this._isFirstCreated){var t=this.playerData,r=t.defaultConfig,n=t.isHitDefault;if(r){var i=null!=r?r:{},a=i.volume,o=i.startTime,s=i.DanmuPlugin,u=i.LiveSubtitlesIconPlugin;if(a&&(e.volume=e.volume?_objectSpread2$7(_objectSpread2$7({},e.volume),{},{default:a}):a),n){var c,l;if(o&&(e.startTime=o),s)e.DanmuPlugin=_objectSpread2$7(_objectSpread2$7({},null!==(c=e.DanmuPlugin)&&void 0!==c?c:{}),s);if(u)e.LiveSubtitlesIconPlugin=_objectSpread2$7(_objectSpread2$7({},null!==(l=e.LiveSubtitlesIconPlugin)&&void 0!==l?l:{}),u)}}}}},{key:"getCurrentPlayerConfig",value:function(){var e,t,r=this.playerData,n=r.isLive,i=r.current,a=i.lineId,o={type:n?"live":"vod",isLive:n,definition:i.definition,lineId:a,volume:null!==(e=this.player.volume)&&void 0!==e?e:.6};n||(o.startTime=null!==(t=this.player.video.currentTime)&&void 0!==t?t:0);return _objectSpread2$7({},o)}},{key:"_analyzeExtendPlugins",value:function(){var e,t=this.playerData.options,r=t.extendPlugin||[],n=null!==(e=null==t?void 0:t.ignore)&&void 0!==e?e:[],i=[],a=[];return r.forEach((function(e){var t=extendPlugin(e);"inner"!==t.type||n[e.pluginName]?i.push(t):a.push(t)})),{basicPlugins:i,iconPlugins:a}}},{key:"beforePlayerCreate",value:(n=_asyncToGenerator$7(_regeneratorRuntime$5().mark((function e(){return _regeneratorRuntime$5().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,sdkPluginManager.beforePlayerCreate(this);case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"afterPlayerCreate",value:function(){var e=this.playerData.isMobile;this._mountingPlayerPanel(e),this._mountingExtendMethods(),this._bindSdkEvents(),this._bindPlayerEvents(),this._setPlayerInfo(),sdkPluginManager.afterPlayerCreate(this)}},{key:"_setPlayerInfo",value:function(){var e,t;if(this.player){this.player.playerVersion=pkgJson.version;var r=this.playerData.getCurrentStreamType()||getFormat(null===(e=this.playerData)||void 0===e||null===(t=e.configs)||void 0===t?void 0:t.getVideoByToken);this.player.playerType||(this.player.playerType=r)}}},{key:"_mountingPlayerPanel",value:function(e){var t,r=this.playerData,n=r.options,i=r.isLive;this.player&&e&&(this.mobilePanel=new MobilePlayerPanel({config:null!==(t=n.panel)&&void 0!==t?t:{mode:i?PLAYER_MODE.INNER:PLAYER_MODE.NORMAL,isAutoChange:!0},root:this.player.root,player:this.player}),this.player.panel=this.mobilePanel)}},{key:"_bindPlayerEvents",value:function(){this.player&&this.player.on(SDKEvents.PLAYER_REBUILD,this.createPlayer.bind(this))}},{key:"_bindSdkEvents",value:function(){var e=this;[].concat(_toConsumableArray$3(Object.values(PluginEvents)),_toConsumableArray$3(Object.values(SDKEvents)),_toConsumableArray$3(Object.values(Events$1))).forEach((function(t){"string"==typeof t&&e.player.on(t,(function(r){e._emitter.emit(t,r)}))}))}},{key:"_mountingExtendMethods",value:function(){this.player&&(this.player.changePluginsIcon=this.changePluginsIcon.bind(this))}},{key:"_offPlayerEvents",value:function(){this.player&&this.player.off(SDKEvents.PLAYER_REBUILD,this.createPlayer.bind(this))}},{key:"changePluginsIcon",value:function(e,t){var r;if(this.player){var n=this.player.getPlugin(e);if(n&&null!=n&&n.root){var i=util$2.hasClass(null==n?void 0:n.parent,"panel-icon-svg")?null==n||null===(r=n.parent)||void 0===r?void 0:r.parentNode:null==n?void 0:n.root;i&&(t?util$2.show(i,"block"):util$2.hide(i))}}}},{key:"getSdkPlugin",value:function(e){var t=this._sdkPlugins[e.toLowerCase()];return t&&t.pluginName?t:null}},{key:"switchAuthToken",value:function(e){var t=this.getSdkPlugin("AuthToken");t&&t.switchAuthToken(e)}},{key:"_destroyPlayer",value:(r=_asyncToGenerator$7(_regeneratorRuntime$5().mark((function e(){var t,r;return _regeneratorRuntime$5().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._offPlayerEvents(),e.next=3,null===(t=this.mobilePanel)||void 0===t?void 0:t.destroy();case 3:return e.next=5,null===(r=this.player)||void 0===r?void 0:r.destroy();case 5:this.player=null;case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getPlayerInstance",value:function(){return this.player}},{key:"getSoftDecodingOption",value:function(e){var t,r=(null==HlsPlugin?void 0:HlsPlugin.isSupported(!0))||(null==FlvPlugin?void 0:FlvPlugin.isSupported(!0))||(null==DASHPlugin||null===(t=DASHPlugin.encryptUtils)||void 0===t?void 0:t.isSupported());return r||console.log("è½¯è§£ä¸æ”¯æŒ"),e&&window.customElements&&r?(this.playerData.encodeType&&(window.customElements.get("live-video").preloadWorker=this.playerData.encodeType),{mediaType:"live-video",innerDegrade:1}):{}}},{key:"_initI18N",value:function(e){var t=e.extraLangList,r=e.extendLangList;null==t||t.forEach((function(e){I18N.use(e)})),r&&I18N.extend(r)}},{key:"destroy",value:(t=_asyncToGenerator$7(_regeneratorRuntime$5().mark((function e(){return _regeneratorRuntime$5().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._destroyPlayer();case 2:this.mountingDom&&this.mountingDom.removeChild(this.playerContainer),this._emitter.removeAllListeners(),this._emitter=null,sdkPluginManager.destroy(this);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function getI18N(){return I18N}var index$1="",aisub="",aisubIcon="",index="";function OpenIcon(){return(new DOMParser).parseFromString('<svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M2 0.5C0.895431 0.5 0 1.39543 0 2.5V13.5C0 14.6046 0.89543 15.5 2 15.5H16C17.1046 15.5 18 14.6046 18 13.5V2.5C18 1.39543 17.1046 0.5 16 0.5H2ZM7.49634 11.0454C8.00741 10.606 8.29061 10.0037 8.34595 9.23877H6.8811C6.84855 9.67171 6.71997 9.99235 6.49536 10.2007C6.27401 10.4058 5.93709 10.5083 5.48462 10.5083C4.98332 10.5083 4.61548 10.3309 4.3811 9.97607C4.14998 9.62126 4.03442 9.05973 4.03442 8.2915V7.75439C4.04093 7.01872 4.16463 6.47673 4.40552 6.12842C4.64966 5.77686 5.01587 5.60107 5.50415 5.60107C5.95337 5.60107 6.28703 5.70524 6.50513 5.91357C6.72648 6.11865 6.85506 6.45068 6.89087 6.90967H8.35571C8.27759 6.1154 7.98787 5.49854 7.48657 5.05908C6.98527 4.61963 6.32446 4.3999 5.50415 4.3999C4.9117 4.3999 4.39087 4.53988 3.94165 4.81982C3.49569 5.09652 3.15226 5.49528 2.91138 6.01611C2.67049 6.53695 2.55005 7.13916 2.55005 7.82275V8.25732C2.55005 9.32829 2.81047 10.1714 3.3313 10.7866C3.85539 11.3986 4.57316 11.7046 5.48462 11.7046C6.31795 11.7046 6.98853 11.4849 7.49634 11.0454ZM14.5393 11.0454C15.0504 10.606 15.3336 10.0037 15.3889 9.23877H13.9241C13.8915 9.67171 13.7629 9.99235 13.5383 10.2007C13.317 10.4058 12.9801 10.5083 12.5276 10.5083C12.0263 10.5083 11.6584 10.3309 11.4241 9.97607C11.193 9.62126 11.0774 9.05973 11.0774 8.2915V7.75439C11.0839 7.01872 11.2076 6.47673 11.4485 6.12842C11.6926 5.77686 12.0588 5.60107 12.5471 5.60107C12.9963 5.60107 13.33 5.70524 13.5481 5.91357C13.7695 6.11865 13.898 6.45068 13.9338 6.90967H15.3987C15.3206 6.1154 15.0308 5.49854 14.5295 5.05908C14.0282 4.61963 13.3674 4.3999 12.5471 4.3999C11.9547 4.3999 11.4338 4.53988 10.9846 4.81982C10.5387 5.09652 10.1952 5.49528 9.95435 6.01611C9.71346 6.53695 9.59302 7.13916 9.59302 7.82275V8.25732C9.59302 9.32829 9.85343 10.1714 10.3743 10.7866C10.8984 11.3986 11.6161 11.7046 12.5276 11.7046C13.3609 11.7046 14.0315 11.4849 14.5393 11.0454Z" fill="white"/>\n</svg>',"image/svg+xml").firstChild}function CloseIcon(){return(new DOMParser).parseFromString('<svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M7.49609 11.0454C8.00716 10.606 8.29037 10.0037 8.3457 9.23877H6.88086C6.84831 9.67171 6.71973 9.99235 6.49512 10.2007C6.27376 10.4058 5.93685 10.5083 5.48438 10.5083C4.98307 10.5083 4.61523 10.3309 4.38086 9.97607C4.14974 9.62126 4.03418 9.05973 4.03418 8.2915V7.75439C4.04069 7.01872 4.16439 6.47673 4.40527 6.12842C4.64941 5.77686 5.01562 5.60107 5.50391 5.60107C5.95312 5.60107 6.28678 5.70524 6.50488 5.91357C6.72624 6.11865 6.85482 6.45068 6.89062 6.90967H8.35547C8.27734 6.1154 7.98763 5.49854 7.48633 5.05908C6.98503 4.61963 6.32422 4.3999 5.50391 4.3999C4.91146 4.3999 4.39062 4.53988 3.94141 4.81982C3.49544 5.09652 3.15202 5.49528 2.91113 6.01611C2.67025 6.53695 2.5498 7.13916 2.5498 7.82275V8.25732C2.5498 9.32829 2.81022 10.1714 3.33105 10.7866C3.85514 11.3986 4.57292 11.7046 5.48438 11.7046C6.31771 11.7046 6.98828 11.4849 7.49609 11.0454Z" fill="white"/>\n<path d="M14.5391 11.0454C15.0501 10.606 15.3333 10.0037 15.3887 9.23877H13.9238C13.8913 9.67171 13.7627 9.99235 13.5381 10.2007C13.3167 10.4058 12.9798 10.5083 12.5273 10.5083C12.026 10.5083 11.6582 10.3309 11.4238 9.97607C11.1927 9.62126 11.0771 9.05973 11.0771 8.2915V7.75439C11.0837 7.01872 11.2074 6.47673 11.4482 6.12842C11.6924 5.77686 12.0586 5.60107 12.5469 5.60107C12.9961 5.60107 13.3298 5.70524 13.5479 5.91357C13.7692 6.11865 13.8978 6.45068 13.9336 6.90967H15.3984C15.3203 6.1154 15.0306 5.49854 14.5293 5.05908C14.028 4.61963 13.3672 4.3999 12.5469 4.3999C11.9544 4.3999 11.4336 4.53988 10.9844 4.81982C10.5384 5.09652 10.195 5.49528 9.9541 6.01611C9.71322 6.53695 9.59277 7.13916 9.59277 7.82275V8.25732C9.59277 9.32829 9.85319 10.1714 10.374 10.7866C10.8981 11.3986 11.6159 11.7046 12.5273 11.7046C13.3607 11.7046 14.0312 11.4849 14.5391 11.0454Z" fill="white"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M0 2.5C0 1.39543 0.895431 0.5 2 0.5H16C17.1046 0.5 18 1.39543 18 2.5V13.5C18 14.6046 17.1046 15.5 16 15.5H2C0.89543 15.5 0 14.6046 0 13.5V2.5ZM2 2.3H16C16.1105 2.3 16.2 2.38954 16.2 2.5V13.5C16.2 13.6105 16.1105 13.7 16 13.7H2C1.88954 13.7 1.8 13.6105 1.8 13.5V2.5C1.8 2.38954 1.88954 2.3 2 2.3Z" fill="white"/>\n</svg>\n',"image/svg+xml").firstChild}function Uint8ArrayToString(e){var t=String.fromCharCode.apply(null,e);return t.slice(t.indexOf("{"),t.lastIndexOf("}")+1)}var LiveSubTitlesPlugin=function(t){_inherits$8(n,t);var r=_createSuper$u(n);function n(e){var t;return _classCallCheck$8(this,n),(t=r.call(this,e)).state={showLang:"",subTitleList:[],rtmpDtsGap:0,dtsBase:0,showingSubtitle:"",currentSub:null},t.clearLineTimer=null,t.showTimer=null,t.state.showLang=e.showLang,t}return _createClass$9(n,[{key:"beforePlayerInit",value:function(){var e=this;this.on(TIME_UPDATE,this.handleVideoTimeupdate.bind(this)),this.on(PAUSE,this.onPause.bind(this)),this.on(PLAY,this.onPlay.bind(this)),this.on(DESTROY,this.destroy.bind(this)),this.on(URL_CHANGE,this.clearRtmpDtsGap.bind(this)),this.on(SEI_PARSED,this.handleSEIParsed.bind(this)),this.on("core_event",(function(t){"core.sei"===t.eventName&&e.handleSEIParsed(t.sei,t.originPts)}))}},{key:"onPause",value:function(){this.clearSubTitle(!1)}},{key:"onPlay",value:function(){this.clearSubTitle(!0)}},{key:"destroy",value:function(){this.clearSubTitle(!0),this.off(TIME_UPDATE,this.handleVideoTimeupdate.bind(this)),this.off(SEI_PARSED,this.handleSEIParsed.bind(this)),this.off(PAUSE,this.onPause.bind(this)),this.off(PLAY,this.onPlay.bind(this)),this.off(DESTROY,this.destroy.bind(this)),this.off(URL_CHANGE,this.clearRtmpDtsGap.bind(this))}},{key:"clearRtmpDtsGap",value:function(){this.state.rtmpDtsGap=0,this.state.dtsBase=0,this.clearSubTitle(!0)}},{key:"clearSubTitle",value:function(e){if(this.state.subTitleList=[],this.state.showingSubtitle="",this.state.currentSub=null,clearTimeout(this.showTimer),clearTimeout(this.clearLineTimer),e){var t=this.find(".xgplayer-subtitles-inner");t&&this.resetDom(t)}}},{key:"getIsSoft",value:function(){var e;return"LIVE-VIDEO"===(null!==(e=this.player.video)&&void 0!==e?e:{}).tagName}},{key:"handleVideoTimeupdate",value:function(e){var t,r,n=this.player.video.currentTime,i=this.getIsSoft(),a=(null==e||null===(t=e.detail)||void 0===t?void 0:t.pts)/1e3,o=i?a:n;if(this.state.showLang&&o&&this.player.isPlaying){var s=this.findSubTitleByTime(o);s&&s.text!==this.state.showingSubtitle&&null!==(r=s.wordpiece)&&void 0!==r&&r.length&&(this.renderSubtitle(s),this.player.emit(PluginEvents.AI_SUBTITLE_MATCH,{subTitle:s,lang:this.state.showLang}),this.state.subTitleList.length>1e3&&(this.state.subTitleList=this.state.subTitleList.filter((function(e){return e.timestamp+e.duration/1e3>=o}))))}}},{key:"renderSubtitle",value:function(e){var t=this,r=this.root,n=this.find(".xgplayer-subtitles-inner"),i=this.find(".xgplayer-subtitles-helper");if(n){this.clearLineTimer&&clearTimeout(this.clearLineTimer),this.showTimer&&(clearTimeout(this.showTimer),this.showSurplus());var a=this.createNewDom(n);this.state.showingSubtitle=e.text,this.state.currentSub={subObj:e,dom:a,index:0};var o=Date.now(),s="",u=0;!function c(){var l,d=e.wordpiece,h=void 0===d?[]:d,f=e.delimiter;if(u===h.length)return s="",t.showTimer=null,void(t.clearLineTimer=setTimeout((function(){t.resetDom(n),t.clearLineTimer=null}),1e3));var p=h[u].duration-(Date.now()-o-h[u].OffsetMs);if(p<0)for(;p<0&&u<h.length-1;)s=s+f+h[u+=1].text,p=h[u].duration-(Date.now()-o-h[u].OffsetMs);else s=s+f+h[u].text;i.textContent=s;var g=null!==(l=null==r?void 0:r.offsetWidth)&&void 0!==l?l:300;i.offsetWidth>g&&(a=t.createNewDom(n),t.state.currentSub.dom=a,s=h[u].text),a.textContent=s,t.showTimer=setTimeout(c,p),u+=1,t.state.currentSub.index=u}()}}},{key:"handleSEIParsed",value:function(t,r){var n=t.dts;if(5===t.code)try{var i="string"==typeof t.content?t.content:Uint8ArrayToString(t.content),a=JSON.parse(i).rtmp_dts;if(a&&n){var o=r||n;this.state.rtmpDtsGap=a-o}}catch(e){}}},{key:"insertSubTitle",value:function(){for(var e,t=this,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];n.forEach((function(e){e.timestamp=t.adjustSubTitleTime(e.timestamp)})),(e=this.state.subTitleList).push.apply(e,n)}},{key:"setCurrentLang",value:function(e){this.state.showLang=e,this.player.emit(PluginEvents.AI_SUBTITLE_LANG_CHANGE,e)}},{key:"adjustSubTitleTime",value:function(e){var t,r,n,i,a,o,s,u;if(this.getIsSoft())return(e-this.state.rtmpDtsGap)/1e3;var c=(null===(t=this.player)||void 0===t||null===(r=t.plugins)||void 0===r?void 0:r.flvlive)||(null===(n=this.player)||void 0===n||null===(i=n.plugins)||void 0===i?void 0:i.hlslive);if(c){var l,d,h,f,p,g,y,m=null!==(l=null==c||null===(d=c._context)||void 0===d||null===(h=d.getInstance("COMPATIBILITY"))||void 0===h?void 0:h._videoLargeGap)&&void 0!==l?l:0,v=null==c||null===(f=c._context)||void 0===f?void 0:f.getInstance("MP4_REMUXER"),_=null!==(p=null!==(g=null===(y=v.remuxer)||void 0===y?void 0:y.videoDtsBase)&&void 0!==g?g:null==v?void 0:v.videoDtsBase)&&void 0!==p?p:0;return this.state.dtsBase=_-m,(e+m-_-this.state.rtmpDtsGap)/1e3}var b=(null===(a=this.player)||void 0===a||null===(o=a.plugins)||void 0===o?void 0:o.flv)||(null===(s=this.player)||void 0===s||null===(u=s.plugins)||void 0===u?void 0:u.hls);if(b){var A,E,S,T=null===(A=b.core._bufferService)||void 0===A||null===(E=A._demuxer)||void 0===E||null===(S=E._fixer)||void 0===S?void 0:S._baseDts;return this.state.dtsBase=T,(e-T-this.state.rtmpDtsGap)/1e3}return(e-this.state.rtmpDtsGap)/1e3}},{key:"findSubTitleByTime",value:function(e){var t=this,r=this.state.subTitleList,n=r.findIndex((function(r){var n=t.player,i=r.lang===t.state.showLang,a=((null==n?void 0:n.__curUrl)||n.config.url)===r.url,o=r.timestamp;return o+r.duration/1e3>=e&&o<=e&&a&&i}));if(!(n<0)){var i=r.splice(0,n+1),a=i[i.length-1];return this.splitSubTitle(a)}}},{key:"splitSubTitle",value:function(e){var t="en"===e.lang?" ":"",r=e.text.split(t);if(!e.wordpiece){var n=e.duration/r.length,i=r.map((function(e,t){return{text:e,OffsetMs:n*t,duration:n}}));return _objectSpread2$7(_objectSpread2$7({},e),{},{delimiter:t,textArr:r,wordpiece:i})}return _objectSpread2$7(_objectSpread2$7({},e),{},{delimiter:t,textArr:r})}},{key:"showSurplus",value:function(){var e,t=this;if(this.state.currentSub){var r=this.state.currentSub,n=r.index,i=r.subObj,a=r.dom,o=null!=i?i:{},s=o.wordpiece,u=o.delimiter;if(!(n>=s.length)){var c=this.find(".xgplayer-subtitles-helper"),l=this.find(".xgplayer-subtitles-inner"),d=this.root,h=null!==(e=null==d?void 0:d.offsetWidth)&&void 0!==e?e:300,f=s.length,p=a.textContent;s.slice(n,f).forEach((function(e){p=p+u+e.text,c.textContent=p,c.offsetWidth>h&&(t.state.currentSub.dom=t.createNewDom(l),p=e.text),t.state.currentSub.dom.textContent=p}))}}}},{key:"createNewDom",value:function(e){if(e){e.children.length>2&&e.firstElementChild&&e.removeChild(e.firstElementChild);var t=document.createElement("span");if(e.appendChild(t),e.children.length>2){var r=e.classList.contains("scroll-1"),n=e.classList.contains("scroll-2");r&&e.classList.replace("scroll-1","scroll-2"),n&&e.classList.replace("scroll-2","scroll-1"),r||n||e.classList.add("scroll-1")}return t}}},{key:"test",value:function(){var e=this,t=this.splitSubTitle({duration:1e4,lang:"zh",text:"ä½ å‘¼å¸ å·²æ”¹å˜ åœæ»žäºŽæŸæ®µæµå¹´ ç¦»åˆ«çš„ä½ æˆ‘ æ‰æ˜Žç™½æŒ¥éœæœ‰æœŸé™,é€åŽ»çš„äººä¸æ›¾èµ°è¿œ åƒ çªå¦‚å…¶æ¥æ¸©æš–æˆ‘çš„æ™´å¤© åƒ å€¾ç›†å¤§é›¨æˆ‘èº²é¿çš„å±‹æª",timestamp:0,url:"xxx"});this.renderSubtitle(t),setTimeout((function(){e.test()}),1e4)}},{key:"getPlayTime",value:function(){var e=this,t=this.getIsSoft();this.on(TIME_UPDATE,(function(r){if(t){var n,i={pts:null==r||null===(n=r.detail)||void 0===n?void 0:n.pts,rtmpDtsGap:e.state.rtmpDtsGap};i.timestamp=i.pts+i.rtmpDtsGap,console.log("ç›´æ’­å½“å‰æ—¶é—´æˆ³ï¼š",i.timestamp,i)}else{var a={currentTime:1e3*e.player.video.currentTime,dtsBase:e.state.dtsBase,rtmpDtsGap:e.state.rtmpDtsGap};a.timestamp=a.currentTime+a.dtsBase+a.rtmpDtsGap,console.log("ç›´æ’­å½“å‰æ—¶é—´æˆ³ï¼š",a.timestamp,a)}}))}},{key:"resetDom",value:function(e){e&&(this.state.currentSub=null,e&&(e.innerHTML="",e.classList.remove("scroll-1","scroll-2")))}},{key:"render",value:function(){return'<xg-subtitles class="xgplayer-subtitles"><xg-subtitles-inner class="xgplayer-subtitles-inner"></xg-subtitles-inner><xg-subtitles-helper class="xgplayer-subtitles-helper"></xg-helper></xg-subtitles>'}}],[{key:"pluginName",get:function(){return"LiveSubtitlesPlugin"}},{key:"defaultConfig",get:function(){return{position:Plugin.POSITIONS.ROOT,showLang:""}}}]),n}(Plugin),POSITIONS$3=Plugin.POSITIONS,LiveSubtitlesIconPlugin=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),(n=t.call(this,e)).isMobile="mobile"===sniffer$1.device,n.isOpenState=!0,n.optionList=null,n.currentLang="",n}return _createClass$9(r,[{key:"afterCreate",value:function(){this.appendChild(".xgplayer-icon",this.icons.aiSubOpen),this.appendChild(".xgplayer-icon",this.icons.aiSubClose),this.renderOptionList(),this.initEvents(),this.currentLang=this.config.default,this.config.defaultOpen?this.open(!0):this.close()}},{key:"afterPlayerInit",value:function(){this.config.defaultOpen&&this.changeSubTitleLang(this.config.default,!0)}},{key:"registerIcons",value:function(){return{aiSubOpen:{icon:OpenIcon,class:"xgplayer-aisub-open-svg"},aiSubClose:{icon:CloseIcon,class:"xgplayer-aisub-close-svg"}}}},{key:"registerLanguageTexts",value:function(){return{sub:{jp:"AI å­—å¹•",en:"AI Subtitles",zh:"AI å­—å¹•","zh-hk":"AI å­—å¹•"},subOpen:{jp:"å­—å¹•ã‚’ã‚ªãƒ³ã«ã™ã‚‹",en:"Show subtitles",zh:"å¼€å¯å­—å¹•","zh-hk":"é–‹å•Ÿå­—å¹•"},subClose:{jp:"ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³",en:"Hide subtitles",zh:"å…³é—­å­—å¹•","zh-hk":"é—œé–‰å­—å¹•"}}}},{key:"children",value:function(){return{LiveSubTitlesPlugin:{plugin:LiveSubTitlesPlugin,options:{root:this.player.root,showLang:this.currentLang}}}}},{key:"initEvents",value:function(){this.bind(["click"],this.handleButtonChange.bind(this)),this.bind(["mouseenter"],this.showPanel.bind(this)),this.bind(["mouseleave"],this.hidePanel.bind(this))}},{key:"handleButtonChange",value:function(){(this.close=this.close.bind(this),this.open=this.open.bind(this),this.isMobile)?this.showMobilePanel():(this.isOpenState?this.close:this.open)()}},{key:"showMobilePanel",value:function(){var e,t=this.renderItemList();null===(e=this.player.panel)||void 0===e||e.showPanel(t,this.langText.sub,!0)}},{key:"renderItemList",value:function(){var e=this,t=_toConsumableArray$3(this.config.list),r=util$2.createDom("div","",{},"ai-panel-content");return t.push({key:"",showText:this.langText.subClose}),t.forEach((function(t){var n=e.renderItem(t);r.appendChild(n)})),r}},{key:"renderItem",value:function(e){var t=this,r=""===e.key&&!this.isOpenState||this.currentLang===e.key&&this.isOpenState,n=util$2.createDom("div","",{},"panel-Item ".concat(r?"select-in":""));return n.innerHTML=e.showText,n.addEventListener("click",(function(r){r.stopPropagation(),r.preventDefault(),t.changeSubTitleLang(e.key),t.updatePanel()})),n}},{key:"updatePanel",value:function(){var e,t=this.renderItemList();null===(e=this.player.panel)||void 0===e||e.updatePanel(t)}},{key:"showPanel",value:function(){var e;!this.isMobile&&this.isOpenState&&(null===(e=this.optionList)||void 0===e||e.show())}},{key:"hidePanel",value:function(){var e;!this.isMobile&&this.isOpenState&&(null===(e=this.optionList)||void 0===e||e.hide())}},{key:"open",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isOpenState=!0,util$2.removeClass(this.root,"isClose"),util$2.addClass(this.root,"isOpen"),!e&&this.showPanel(),this.toggleSubTitle()}},{key:"close",value:function(){var e;this.isOpenState=!1,util$2.removeClass(this.root,"isOpen"),util$2.addClass(this.root,"isClose"),null===(e=this.optionList)||void 0===e||e.hide(),this.toggleSubTitle()}},{key:"renderOptionList",value:function(){var e,t=this;if(!((null===(e=this.config.list)||void 0===e?void 0:e.length)<2||this.isMobile)){var r={config:{data:this.config.list.map((function(e){return e.key===t.config.default&&(e.isCurrent=!0,e.selected=!0),e})),className:"",onItemClick:function(e,r){var n;e.stopPropagation(),e.preventDefault(),t.changeSubTitleLang(null===(n=r.to)||void 0===n?void 0:n.key)}},root:this.root};this.optionList=new OptionList(r)}}},{key:"changeSubTitleLang",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.currentLang=e,e?this.open(t):this.close()}},{key:"toggleSubTitle",value:function(){var e;null===(e=this.player.getPlugin("LiveSubtitlesPlugin"))||void 0===e||e.setCurrentLang(this.isOpenState?this.currentLang:"")}},{key:"destroy",value:function(){var e;this.unbind(["click"],this.handleButtonChange.bind(this)),this.unbind(["mouseenter"],this.showPanel.bind(this)),this.unbind(["mouseleave"],this.hidePanel.bind(this)),null===(e=this.optionList)||void 0===e||e.destroy()}},{key:"render",value:function(){return'\n    <xg-icon class="xgplayer-aisub">\n      <div class="xgplayer-icon">\n      </div>\n      <div class="xg-tips" lang-key="subOpen">'.concat(this.langText.subOpen,"</div>\n    </xg-icon>\n    ")}}],[{key:"pluginName",get:function(){return"LiveSubtitlesIconPlugin"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$3.CONTROLS_RIGHT,index:2.7,defaultOpen:!0,default:"en",list:[{key:"zh",showText:"ä¸­æ–‡"},{key:"en",showText:"En"}]}}}]),r}(Plugin),POSITIONS$2=Plugin.POSITIONS,IS_MOBILE="mobile"===sniffer$1.device,DEFAULT_CLOSE_TYPE="text-close";function formatList(e){var t=-1;return e.map((function(e,r){e.id||e.language||(e.id=""+r),!e.url&&(e.url=e.src),!e.text&&(e.text=e.label),!e.language&&(e.language=e.srclang),void 0===e.isDefault&&(e.isDefault=e.default),(e.isDefault||e.default)&&(t<0?t=r:e.isDefault=e.default=!1)})),t}var Subtitle=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){var e;return _classCallCheck$8(this,r),(e=t.apply(this,arguments)).isOpenState=!0,e.optionList=null,e.currentLang="",e.handlerClickSwitch=function(t,r){t.stopPropagation(),t.preventDefault(),e.subTitles&&(r.type===DEFAULT_CLOSE_TYPE?e.switchOffSubtitle():e.switchSubTitle({language:r.language,id:r.id}))},e.onPlayerFocus=function(t){e.subTitles&&e.config.style.follow&&e.rePosition()},e.onPlayerBlur=function(t){e.subTitles&&e.config.style.follow&&!e.playerConfig.marginControls&&e.subTitles.root&&(e.subTitles.root.style.transform="translate(0, 0)")},e}return _createClass$9(r,[{key:"beforeCreate",value:function(e){var t=e.player.config.VttSubtitle||e.player.config.vttSubtitle||e.player.config.vttsubtitle;"Array"===util$2.typeOf(t)&&(e.config.list=t)}},{key:"afterCreate",value:function(){var e=this.config,t=e.list,n=e.style,i=e.isDefaultOpen;if(t&&!(t.length<1)){this.curIndex=-1,this.curItem=null;var a=formatList(t);_get$2(_getPrototypeOf$8(r.prototype),"afterCreate",this).call(this);var o={subTitles:t,defaultOpen:i};this.isOpenState=i,Object.keys(n).map((function(e){o[e]=n[e]})),!this.playerConfig.marginControls&&this.player.controls.root&&(this.on(PLAYER_FOCUS,this.onPlayerFocus),this.on(PLAYER_BLUR,this.onPlayerBlur)),this.subTitles=new SubTitles(o),this.subTitles.attachPlayer(this.player),this.changeTipText(),n.follow&&this.subTitles.root&&util$2.addClass(this.subTitles.root,"follow-control"),t&&0!==t.length&&(i&&a<0?(t[0].isDefault=!0,this.curIndex=0,this.curItem=t[0]):(this.curIndex=a,this.curItem=t[a]),this.appendChild(".xgplayer-icon",this.icons.vttSubOpen),this.appendChild(".xgplayer-icon",this.icons.vttSubClose),this.creatOptionList(),this.initEvents(),this.isOpenState?util$2.addClass(this.root,"isOpen"):util$2.addClass(this.root,"isClose"))}}},{key:"initEvents",value:function(){this.bind(["click"],this.handleButtonChange.bind(this)),this.bind(["mouseenter"],this.showList.bind(this)),this.bind(["mouseleave"],this.hideList.bind(this)),this._delegates=[]}},{key:"handleButtonChange",value:function(e){e.preventDefault(),e.stopPropagation(),e.delegateTarget||(IS_MOBILE?this.showMobilePanel():this.isOpenState?this.switchOffSubtitle():this.openSubtitle())}},{key:"showList",value:function(){var e;!IS_MOBILE&&this.isOpenState&&(null===(e=this.optionList)||void 0===e||e.show())}},{key:"hideList",value:function(){var e;!IS_MOBILE&&this.isOpenState&&(null===(e=this.optionList)||void 0===e||e.hide())}},{key:"openSubtitle",value:function(){this.curIndex>-1&&this.curItem&&this.switchSubTitle(this.curItem)}},{key:"registerIcons",value:function(){return{vttSubOpen:{icon:OpenIcon,class:"xgplayer-vttsub-open-svg"},vttSubClose:{icon:CloseIcon,class:"xgplayer-vttsub-close-svg"}}}},{key:"registerLanguageTexts",value:function(){return{sub:{jp:"å­—å¹•",en:"Subtitles",zh:"å­—å¹•","zh-hk":"å­—å¹•"},subOpen:{jp:"å­—å¹•ã‚’ã‚ªãƒ³ã«ã™ã‚‹",en:"Show subtitles",zh:"å¼€å¯å­—å¹•","zh-hk":"é–‹å•Ÿå­—å¹•"},subClose:{jp:"ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³",en:"Hide subtitles",zh:"å…³é—­å­—å¹•","zh-hk":"é—œé–‰å­—å¹•"}}}},{key:"creatOptionList",value:function(){var e,t=this;if(!((null===(e=this.config.list)||void 0===e?void 0:e.length)<2||IS_MOBILE)){var r={config:{data:this.getList(),className:"",onItemClick:function(e,r){t.handlerClickSwitch(e,null==r?void 0:r.to)}},root:this.root};this.optionList=new OptionList(r)}}},{key:"getList",value:function(){var e=this;return this.config.list.map((function(t,r){return r===e.curIndex&&e.isOpenState?(t.isCurrent=!0,t.selected=!0):(t.isCurrent=!1,t.selected=!1),t.showText=e.getTextByLang(t),t}))}},{key:"renderOptionList",value:function(){this.optionList.renderItemList(this.getList())}},{key:"switchSubTitle",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:"",language:""},r=-1;if(t&&(t.id||t.language)&&(this.config.list.map((function(e,n){e.id+""==t.id+""&&e.language+""==t.language+""&&(r=n)})),!(r<0||this.isOpenState&&r===this.curIndex)))return this.subTitles.switch(t).then((function(n){0===n.code&&(t.off=!1,t.isListUpdate=!1,t.list=[],e.curIndex=r,e.curItem=e.config.list[r],e.isOpenState=!0,util$2.removeClass(e.root,"isClose"),util$2.addClass(e.root,"isOpen"),e.renderItemList(),e.changeTipText(),e.emit("subtitle_change",t))})).catch((function(e){return console.error("switch subtitle err: ",e)}))}},{key:"switchOffSubtitle",value:function(){var e;this.subTitles.switchOff(),this.emit("subtitle_change",{off:!0,isListUpdate:!1,list:[]}),this.isOpenState=!1,util$2.removeClass(this.root,"isOpen"),util$2.addClass(this.root,"isClose"),this.renderItemList(),this.changeTipText(),null===(e=this.optionList)||void 0===e||e.hide()}},{key:"renderItemList",value:function(){IS_MOBILE?this.updatePanel():this.renderOptionList()}},{key:"updateSubtitles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e){var r=[];e.map((function(e){r.push(e)}));var n=formatList(r);this.curIndex=n,this.curItem=n>-1?r[n]:null;var i=n>-1;if(this.config.list=r,this.subTitles&&this.subTitles.setSubTitles(r,i,t),r.length>0){var a;if(!IS_MOBILE)null===(a=this.optionList)||void 0===a||a.show()}else{var o,s;if(this.switchOffSubtitle(),IS_MOBILE?this.showMobilePanel():null===(o=this.optionList)||void 0===o||o.show(),!IS_MOBILE)null===(s=this.optionList)||void 0===s||s.hide();this.hide()}this.renderItemList()}}},{key:"changeTipText",value:function(){this.isOpenState?this.find(".xg-tips").innerHTML=this.langText.subClose:this.find(".xg-tips").innerHTML=this.langText.subOpen}},{key:"showMobilePanel",value:function(){var e,t=this.renderPanel();null===(e=this.player.panel)||void 0===e||e.showPanel(t,this.langText.sub,!0)}},{key:"updatePanel",value:function(){var e,t=this.renderPanel();null===(e=this.player.panel)||void 0===e||e.updatePanel(t)}},{key:"renderPanel",value:function(){var e=this,t=_toConsumableArray$3(this.config.list),r=util$2.createDom("div","",{},"ai-panel-content");t.map((function(t,n){var i=_objectSpread2$7({language:t.language||t.srclang,"data-id":t.id,selected:e.isOpenState&&e.curIndex===n,showText:e.getTextByLang(t)},t),a=e.renderPanelItem(i);r.appendChild(a)}));var n={showText:this.langText.subClose,"data-type":DEFAULT_CLOSE_TYPE,selected:!this.isOpenState};return r.appendChild(this.renderPanelItem(n)),r}},{key:"renderPanelItem",value:function(e){var t=this,r=e.showText,n=e.selected,i=util$2.createDom("div","",{language:e.language,"data-id":e["data-id"],"data-type":e["data-type"]},"panel-Item ".concat(n?"select-in":""));i.innerHTML=r;var a=IS_MOBILE?"touchend":"click",o=Plugin.delegate(i,".panel-Item",a,(function(r){e["data-type"]===DEFAULT_CLOSE_TYPE?(r.stopPropagation(),r.preventDefault(),t.switchOffSubtitle()):t.handlerClickSwitch(r,e)}));return this._delegates.push(o),i}},{key:"getTextByLang",value:function(e,t,r){if(void 0===e)return"";var n=this.config.list;return!r&&(r=this.player.lang),t=!t||util$2.isUndefined(e[t])?"text":t,"number"==typeof e&&(e=n[e]),"object"===_typeof$7(e[t])?e[t][r]||e[t].zh:e[t]||""}},{key:"rePosition",value:function(){var e=this.config.style.fitVideo,t=0-this.player.controls.root.getBoundingClientRect().height;if(e){var r=this.player,n=r.video,i=r.root.getBoundingClientRect(),a=i.height,o=i.width,s=n.videoHeight,u=n.videoWidth,c=parseInt(s/u*100,10)*o/100;c>a&&(c=a);var l=(a-c)/2-t;l<0&&(this.subTitles.root.style.transform="translate(0, ".concat(l,"px)"))}else this.subTitles.root.style.transform="translate(0, ".concat(t,"px)")}},{key:"destroy",value:function(){var e;this.subTitles&&(this.subTitles.destroy(),this.subTitles=null),this.unbind(["click"],this.handleButtonChange.bind(this)),this.unbind(["mouseenter"],this.showList.bind(this)),this.unbind(["mouseleave"],this.hideList.bind(this)),null===(e=this.optionList)||void 0===e||e.destroy(),this._delegates&&this._delegates.length>0&&(this._delegates.map((function(e){Array.isArray(e)&&e.map((function(e){e.destroy&&e.destroy()})),e.destroy&&e.destroy()})),this._delegates=null),_get$2(_getPrototypeOf$8(r.prototype),"destroy",this).call(this)}},{key:"render",value:function(){return'\n    <xg-icon class="xgplayer-vttsub">\n      <div class="xgplayer-icon">\n      </div>\n      <div class="xg-tips" lang-key="vttSubOpen">'.concat(this.langText.subOpen,"</div>\n    </xg-icon>\n    ")}}],[{key:"pluginName",get:function(){return"Subtitle"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$2.CONTROLS_RIGHT,index:CONTROL_ICON_INDEX.Subtitle,list:[],isDefaultOpen:!0,style:{follow:!0,mode:"stroke",followBottom:50,fitVideo:!0,offsetBottom:4,baseSizeX:49,baseSizeY:28,minSize:16,minMobileSize:13,line:"double",fontColor:"#fff"}}}}]),r}(Plugin),DefinitionDemotePlugin=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),(n=t.call(this,e)).waitings=[],n.longWaitingEmitTime=0,n.waitingStartTime=0,n.playerData=null,n.isNeedShowTips=!0,n.playerData=n.playerConfig.playerData,n}return _createClass$9(r,[{key:"registerLanguageTexts",value:function(){return{definition_demote_txt:{jp:"ç¾åœ¨ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯ä¸å®‰å®šã§ã™ã€‚ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™",en:"The current network is unstable, it is recommended to switch to ",zh:"å½“å‰ç½‘ç»œä¸ç¨³å®šï¼Œå»ºè®®åˆ‡æ¢åˆ°","zh-hk":"ç•¶å‰ç¶²çµ¡ä¸ç©©å®šï¼Œå»ºè­°åˆ‡æ›åˆ°"}}}},{key:"afterCreate",value:function(){this.bindCtx(),this.bindEvents()}},{key:"bindCtx",value:function(){this._count=this._count.bind(this),this._time=this._time.bind(this),this._waiting=this._waiting.bind(this),this._clearTime=this._clearTime.bind(this)}},{key:"bindEvents",value:function(){var e=this;this.on(WAITING,this._waiting),this.on(PLAYING,this._clearTime),this.on(PAUSE,this._clearTime),this.on(TIME_UPDATE,this._clearTime),this.on(PLAY,this._clearTime),this.on(CANPLAY,(function(){e.isNeedShowTips=!0})),this.config.isNeedAutoDemote&&this.player.on(PluginEvents.LONG_WAITING,this.demote.bind(this))}},{key:"_waiting",value:function(){this._count(),this._time()}},{key:"_count",value:function(){var e=Date.now();if(this.waitings.push(e),this.waitings.length===this.config.oftenWaitingCount){var t=this.waitings.shift();t&&e-t<=this.config.oftenWaitingTime&&(this.player.emit(PluginEvents.OFTEN_WAITING),this.clearState())}}},{key:"_time",value:function(){var e=this;if(this.timer)console.log("è¿žç»­è§¦å‘äº†waiting,è·ç¦»ä¸Šæ¬¡waitingæ—¶é—´:",Date.now()-this.waitingStartTime);else{this.waitingStartTime=Date.now();var t=this.player.currentTime;this.timer=setTimeout((function(){e.player&&e.player.currentTime<=t+.1&&(console.log("waitingæŒç»­æ—¶é—´è¶…è¿‡ ".concat(e.config.longWaitingTime," ç§’")),e.player.emit(PluginEvents.LONG_WAITING),e.clearState())}),this.config.longWaitingTime)}}},{key:"_clearTime",value:function(){this.waitingStartTime&&console.log("waitingæŒç»­æ—¶é•¿:",Date.now()-this.waitingStartTime),this.clearState()}},{key:"clearState",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.waitings.length>0&&(this.waitings=[]),this.waitingStartTime&&(this.waitingStartTime=0)}},{key:"demote",value:function(){if(this.playerData){var e=this.playerData.getNextDefinition(!0,this.config.demotePriority),t=null==e?void 0:e[0];if(t){var r=t.definition;if(r){var n=this.playerData.current.definition;if(this.player.emit(PluginEvents.DEFINITION_DEMOTE,{currentDef:n,willChangeDef:r,next:t}),"auto"===n){var i=t.url;this.changeUrl(i)}else r!==n&&this.showToast(t)}}}}},{key:"changeUrl",value:function(e){this.player&&e&&(this.player.config.url=e,this.player.switchURL(e,!1),this.player.emit(PluginEvents.PlAY_URL_CHANGE,{url:e,from:"definition_demote"}))}},{key:"showToast",value:function(e){var t,r=this,n=null===(t=this.player)||void 0===t?void 0:t.getPlugin("sdkToastPlugin");if(n&&this.isNeedShowTips){var i=this.i18n[e.definitionTextKey]||e.definitionTextKey||e.definition,a=util$2.createDom("div",this.langText.definition_demote_txt,void 0,"toast-txt"),o=util$2.createDom("span",i,void 0,"toast-txt-bt");a.appendChild(o);var s=n.add(a,5e3,!0);o.addEventListener("click",(function(){r.playerData&&(r.playerData.current.definition=e.definition,n.remove(s))})),this.isNeedShowTips=!1,setTimeout((function(){r.isNeedShowTips=!0}),3e4)}}},{key:"destroy",value:function(){this.clearState()}}],[{key:"pluginName",get:function(){return"DefinitionDemotePlugin"}},{key:"defaultConfig",get:function(){return{oftenWaitingCount:3,oftenWaitingTime:5e3,longWaitingTime:5e3,isNeedAutoDemote:!1,demotePriority:[]}}}]),r}(Plugin),formatTime=function(e){var t=Math.floor(e/3600),r=e%3600,n=Math.floor(r/60),i=Math.round(r%60);return t>0?(n<10&&(n="0"+n),i<10&&(i="0"+i),"".concat(t,":").concat(n,":").concat(i)):(i<10&&(i="0"+i),"".concat(n,":").concat(i))},POSITIONS$1=Plugin.POSITIONS,UpperLimit=604800,MinMoveTime=6,TimeShiftPlugin=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){var e;return _classCallCheck$8(this,r),(e=t.apply(this,arguments)).isMobile="mobile"===sniffer$1.device,e.playedBar=null,e.cachedBar=null,e.innerBar=null,e.progressBtn=null,e.progressPoint=null,e.backLiveBt=null,e.cardDomList=[],e.initTime=0,e.liveGap=0,e.shiftTimeGap=0,e.isProgressMoving=!1,e.isPlayTimeShift=!1,e.liveUrl="",e.onBodyClick=function(e){e.preventDefault(),e.stopPropagation(),util$2.event(e)},e}return _createClass$9(r,[{key:"duration",get:function(){var e,t=this.liveGap+Math.floor(Date.now()/1e3-this.initTime),r=(null!==(e=this.config)&&void 0!==e?e:{}).maxMoveTime;return r&&t>r?r:t>UpperLimit?UpperLimit:t}},{key:"registerLanguageTexts",value:function(){return{BACKLIVE:{jp:"ãƒ©ã‚¤ãƒ–ã«æˆ»ã‚‹",en:"Back to live",zh:"è¿”å›žç›´æ’­","zh-hk":"è¿”å›žç›´æ’­"}}}},{key:"updateLang",value:function(){this.backLiveBt&&(this.backLiveBt.innerHTML=this.langText.BACKLIVE)}},{key:"afterCreate",value:function(){this.liveUrl=this.player.config.url,this.playedBar=this.find(".xgplayer-progress-played"),this.cachedBar=this.find(".xgplayer-progress-cache"),this.progressBtn=this.find(".xgplayer-progress-btn"),this.progressPoint=this.find(".xgplayer-shift-progress-point"),this.innerBar=this.find(".xgplayer-progress-inner"),this.createBackLiveBtDom(),this.clacTime(),this.initEvents(),this.bindDomEvents(),this.isMobile||this.createTimeShiftCard()}},{key:"clacTime",value:function(){var e,t=null!==(e=this.config)&&void 0!==e?e:{},r=t.livingStartTime,n=t.currentTime;this.initTime=Math.floor(Date.now()/1e3),this.liveGap=Math.floor(n-r)}},{key:"initEvents",value:function(){this.on(TIME_UPDATE,this.handleTimeUpdate.bind(this))}},{key:"bindDomEvents",value:function(){if(this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseEnter=this.handleMouseEnter.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.tipsUpdate=this.tipsUpdate.bind(this),this.isMobile){this.bind("touchstart",this.handleMouseDown);var e=this.player.controls;e&&(e.root&&e.root.addEventListener("touchmove",util$2.stopPropagation),e.center&&e.center.addEventListener("touchend",util$2.stopPropagation))}else this.bind("mousedown",this.handleMouseDown),this.bind("mouseenter",this.handleMouseEnter)}},{key:"handleTimeUpdate",value:function(){this.isProgressMoving||this.progressUpdate()}},{key:"handleMouseDown",value:function(e){if(e.target!==this.backLiveBt){this.onBodyClick(e),this.focus(),util$2.addClass(this.progressBtn,"active");var t=this.computeTime(e);this.updateShiftTime(t.percent),this.isProgressMoving=!0,this.isMobile?(this.bind("touchmove",this.handleMouseMove),this.bind("touchend",this.handleMouseUp)):(document.addEventListener("mousemove",this.handleMouseMove,!1),document.addEventListener("mouseup",this.handleMouseUp,!1))}}},{key:"handleMouseMove",value:function(e){this.onBodyClick(e);var t=this.computeTime(e);this.updateShiftTime(t.percent)}},{key:"handleMouseUp",value:function(e){this.onBodyClick(e),this.isProgressMoving=!1,util$2.removeClass(this.progressBtn,"active"),this.changeTimeUrl(),this.isMobile?(this.unbind("touchmove",this.handleMouseMove),this.unbind("touchend",this.handleMouseUp)):(document.removeEventListener("mousemove",this.handleMouseMove,!1),document.removeEventListener("mouseup",this.handleMouseUp,!1))}},{key:"handleMouseEnter",value:function(e){this.bind("mouseleave",this.handleMouseLeave),this.bind("mousemove",this.tipsUpdate),this.tipsUpdate(e),this.focus()}},{key:"handleMouseLeave",value:function(){this.unbind("mouseleave",this.handleMouseLeave),this.unbind("mousemove",this.tipsUpdate),this.blur()}},{key:"focus",value:function(){this.player.controls.pauseAutoHide(),util$2.addClass(this.root,"active")}},{key:"blur",value:function(){this.player.controls.recoverAutoHide(),util$2.removeClass(this.root,"active")}},{key:"computeTime",value:function(e){var t,r,n,i=this.player,a=this.root.getBoundingClientRect(),o=a.width,s=a.height,u=a.top,c=a.left,l=util$2.getEventPos(e,i.zoom);90===i.rotateDeg?(t=s,r=u,n=l.clientY):(t=o,r=c,n=l.clientX);var d=n-r,h=(d=d>t?t:d<0?0:d)/t;return{percent:h=h<0?0:h>1?1:h,offset:d,width:t,left:r,e:e}}},{key:"tipsUpdate",value:function(e){var t=this.computeTime(e),r=Math.floor(this.duration*(1-t.percent));this.progressPoint.style.left="".concat(100*t.percent,"%"),this.progressPoint.innerHTML="-".concat(formatTime(r))}},{key:"updateShiftTime",value:function(e){this.shiftTimeGap=Math.floor(this.duration*(1-e)),this.progressUpdate()}},{key:"getCurrentProgress",value:function(){return Math.floor(this.duration-this.shiftTimeGap)}},{key:"progressUpdate",value:function(){var e=this.getCurrentProgress()/this.duration;this.progressBtn.style.left="".concat(100*e,"%"),this.playedBar.style.width="".concat(100*e,"%"),this.cardProcessUpdate()}},{key:"changeTimeShift",value:function(e){var t=this.calcCardProcess(e);t<0||(this.updateShiftTime(t),this.changeTimeUrl())}},{key:"changeTimeUrl",value:function(){var e=this.config.timeShiftUrl,t="";this.isPlayTimeShift=!0,this.toggleBackButton();var r=this.shiftTimeGap<MinMoveTime?MinMoveTime:this.shiftTimeGap;t=e?e.replace("{}",r):addUrlParam(this.liveUrl,{timeshift:r}),this.player.src=t,this.player.config.url=t,this.player.emit(PluginEvents.TIME_SHIFT_CHANGE,!0),this.player.emit(PluginEvents.PlAY_URL_CHANGE,{shiftUrl:t,from:PluginEvents.TIME_SHIFT_CHANGE})}},{key:"createBackLiveBtDom",value:function(){var e,t=this;if(this.backLiveBt)return this.backLiveBt;this.backLiveBt=util$2.createDom("xg-back-live-bt",this.langText.BACKLIVE,void 0,"xgplayer-back-live-bt"),this.backLiveBt.addEventListener("click",(function(e){t.onBodyClick(e),t.backLive()})),null===(e=this.player.root)||void 0===e||e.appendChild(this.backLiveBt)}},{key:"backLive",value:function(){this.liveUrl&&(this.player.src=this.liveUrl,this.player.config.url=this.liveUrl,this.shiftTimeGap=0,this.isPlayTimeShift=!1,this.toggleBackButton(),this.player.emit(PluginEvents.TIME_SHIFT_CHANGE,!1),this.player.emit(PluginEvents.PlAY_URL_CHANGE,{url:this.liveUrl,from:PluginEvents.TIME_SHIFT_CHANGE}))}},{key:"toggleBackButton",value:function(){this.backLiveBt&&(this.backLiveBt.style.display=this.isPlayTimeShift?"flex":"none")}},{key:"updateCardList",value:function(e){this.config.cardList=_toConsumableArray$3(e),this.clearCardDom(),this.createTimeShiftCard()}},{key:"clearCardDom",value:function(){var e=this;this.cardDomList.forEach((function(t){t.dom&&e.innerBar.contains(t.dom)&&e.innerBar.removeChild(t.dom)})),this.cardDomList=[]}},{key:"createTimeShiftCard",value:function(){var e,t=this;(null===(e=this.config.cardList)||void 0===e?void 0:e.length)<=0||this.config.cardList.forEach((function(e){t.renderCard(e)}))}},{key:"renderCard",value:function(e){if(e.img){var t=util$2.createDom("xg-card","",void 0,"xgplayer-shift-progress-card"),r=util$2.createDom("img","",{src:e.img},"xgplayer-shift-progress-card-img"),n=util$2.createDom("div","",void 0,"xgplayer-shift-progress-card-point");t.appendChild(r),t.appendChild(n),this.cardDomList.push(_objectSpread2$7(_objectSpread2$7({},e),{},{dom:t}))}}},{key:"cardProcessUpdate",value:function(){var e=this;0!==this.cardDomList.length&&this.cardDomList.forEach((function(t){if(t.dom){var r=e.calcCardProcess(t.timestamp);if(!(r>1)){var n=e.innerBar.contains(t.dom);r<0?n&&e.innerBar.removeChild(t.dom):(n||e.innerBar.appendChild(t.dom),t.dom.style.left="".concat(100*r,"%"))}}}))}},{key:"calcCardProcess",value:function(e){var t,r=null!==(t=this.config)&&void 0!==t?t:{},n=r.maxMoveTime,i=r.livingStartTime,a=this.liveGap+Math.floor(Date.now()/1e3-this.initTime);return n&&a>n&&(i=a-n),e<i?-1:(e-i)/this.duration}},{key:"destroy",value:function(){if(this.off(TIME_UPDATE,this.handleTimeUpdate.bind(this)),this.isMobile){this.unbind("touchstart",this.handleMouseDown);var e=this.player.controls;e&&(e.root&&e.root.removerEventListener("touchmove",util$2.stopPropagation),e.center&&e.center.removerEventListener("touchend",util$2.stopPropagation))}else this.unbind("mousedown",this.handleMouseDown),this.unbind("mouseenter",this.handleMouseEnter);var t;this.backLiveBt&&(null===(t=this.player.root)||void 0===t||t.removeChild(this.backLiveBt),this.backLiveBt=null)}},{key:"render",value:function(){if(this.config.disable)return"";var e=this.player.controls?this.player.controls.config.mode:"";return'\n      <xg-progress class="xgplayer-progress '.concat("bottom"===e?"xgplayer-progress-bottom":"",' xgplayer-shift">\n        <xg-outer class="xgplayer-progress-outer">\n          <xg-inners class="progress-list">\n            <xg-inner class="xgplayer-progress-inner" style="flex: 1">\n              <xg-cache class="xgplayer-progress-cache" style="width: 100%;"></xg-cache>\n              <xg-played class="xgplayer-progress-played" style="width: 100%;"></xg-played>\n            </xg-inner>\n          </xg-inners>\n          <xg-progress-btn class="xgplayer-progress-btn"></xg-progress-btn>\n          <xg-point class="xgplayer-shift-progress-point">00:00</xg-point>\n        </xg-outer>\n      </xg-progress>\n    ')}}],[{key:"pluginName",get:function(){return"TimeShiftPlugin"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$1.CONTROLS_CENTER,livingStartTime:Date.now()/1e3,maxMoveTime:0,currentTime:Date.now()/1e3,timeShiftUrl:"",cardList:[]}}}]),r}(Plugin),debug$1="object"===("undefined"==typeof process?"undefined":_typeof$7(process))&&process.env&&{}.NODE_DEBUG&&/\bsemver\b/i.test({}.NODE_DEBUG)?function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=console).error.apply(e,["SEMVER"].concat(r))}:function(){},debug_1=debug$1,SEMVER_SPEC_VERSION="2.0.0",MAX_LENGTH$1=256,MAX_SAFE_INTEGER$1=Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH=16,constants={SEMVER_SPEC_VERSION:SEMVER_SPEC_VERSION,MAX_LENGTH:MAX_LENGTH$1,MAX_SAFE_INTEGER:MAX_SAFE_INTEGER$1,MAX_SAFE_COMPONENT_LENGTH:MAX_SAFE_COMPONENT_LENGTH},re$1={exports:{}};!function(e,t){var r=constants.MAX_SAFE_COMPONENT_LENGTH,n=debug_1,i=(t=e.exports={}).re=[],a=t.src=[],o=t.t={},s=0,u=function(e,t,r){var u=s++;n(e,u,t),o[e]=u,a[u]=t,i[u]=new RegExp(t,r?"g":void 0)};u("NUMERICIDENTIFIER","0|[1-9]\\d*"),u("NUMERICIDENTIFIERLOOSE","[0-9]+"),u("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),u("MAINVERSION","(".concat(a[o.NUMERICIDENTIFIER],")\\.")+"(".concat(a[o.NUMERICIDENTIFIER],")\\.")+"(".concat(a[o.NUMERICIDENTIFIER],")")),u("MAINVERSIONLOOSE","(".concat(a[o.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(a[o.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(a[o.NUMERICIDENTIFIERLOOSE],")")),u("PRERELEASEIDENTIFIER","(?:".concat(a[o.NUMERICIDENTIFIER],"|").concat(a[o.NONNUMERICIDENTIFIER],")")),u("PRERELEASEIDENTIFIERLOOSE","(?:".concat(a[o.NUMERICIDENTIFIERLOOSE],"|").concat(a[o.NONNUMERICIDENTIFIER],")")),u("PRERELEASE","(?:-(".concat(a[o.PRERELEASEIDENTIFIER],"(?:\\.").concat(a[o.PRERELEASEIDENTIFIER],")*))")),u("PRERELEASELOOSE","(?:-?(".concat(a[o.PRERELEASEIDENTIFIERLOOSE],"(?:\\.").concat(a[o.PRERELEASEIDENTIFIERLOOSE],")*))")),u("BUILDIDENTIFIER","[0-9A-Za-z-]+"),u("BUILD","(?:\\+(".concat(a[o.BUILDIDENTIFIER],"(?:\\.").concat(a[o.BUILDIDENTIFIER],")*))")),u("FULLPLAIN","v?".concat(a[o.MAINVERSION]).concat(a[o.PRERELEASE],"?").concat(a[o.BUILD],"?")),u("FULL","^".concat(a[o.FULLPLAIN],"$")),u("LOOSEPLAIN","[v=\\s]*".concat(a[o.MAINVERSIONLOOSE]).concat(a[o.PRERELEASELOOSE],"?").concat(a[o.BUILD],"?")),u("LOOSE","^".concat(a[o.LOOSEPLAIN],"$")),u("GTLT","((?:<|>)?=?)"),u("XRANGEIDENTIFIERLOOSE","".concat(a[o.NUMERICIDENTIFIERLOOSE],"|x|X|\\*")),u("XRANGEIDENTIFIER","".concat(a[o.NUMERICIDENTIFIER],"|x|X|\\*")),u("XRANGEPLAIN","[v=\\s]*(".concat(a[o.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(a[o.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(a[o.XRANGEIDENTIFIER],")")+"(?:".concat(a[o.PRERELEASE],")?").concat(a[o.BUILD],"?")+")?)?"),u("XRANGEPLAINLOOSE","[v=\\s]*(".concat(a[o.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(a[o.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(a[o.XRANGEIDENTIFIERLOOSE],")")+"(?:".concat(a[o.PRERELEASELOOSE],")?").concat(a[o.BUILD],"?")+")?)?"),u("XRANGE","^".concat(a[o.GTLT],"\\s*").concat(a[o.XRANGEPLAIN],"$")),u("XRANGELOOSE","^".concat(a[o.GTLT],"\\s*").concat(a[o.XRANGEPLAINLOOSE],"$")),u("COERCE","".concat("(^|[^\\d])(\\d{1,").concat(r,"})")+"(?:\\.(\\d{1,".concat(r,"}))?")+"(?:\\.(\\d{1,".concat(r,"}))?")+"(?:$|[^\\d])"),u("COERCERTL",a[o.COERCE],!0),u("LONETILDE","(?:~>?)"),u("TILDETRIM","(\\s*)".concat(a[o.LONETILDE],"\\s+"),!0),t.tildeTrimReplace="$1~",u("TILDE","^".concat(a[o.LONETILDE]).concat(a[o.XRANGEPLAIN],"$")),u("TILDELOOSE","^".concat(a[o.LONETILDE]).concat(a[o.XRANGEPLAINLOOSE],"$")),u("LONECARET","(?:\\^)"),u("CARETTRIM","(\\s*)".concat(a[o.LONECARET],"\\s+"),!0),t.caretTrimReplace="$1^",u("CARET","^".concat(a[o.LONECARET]).concat(a[o.XRANGEPLAIN],"$")),u("CARETLOOSE","^".concat(a[o.LONECARET]).concat(a[o.XRANGEPLAINLOOSE],"$")),u("COMPARATORLOOSE","^".concat(a[o.GTLT],"\\s*(").concat(a[o.LOOSEPLAIN],")$|^$")),u("COMPARATOR","^".concat(a[o.GTLT],"\\s*(").concat(a[o.FULLPLAIN],")$|^$")),u("COMPARATORTRIM","(\\s*)".concat(a[o.GTLT],"\\s*(").concat(a[o.LOOSEPLAIN],"|").concat(a[o.XRANGEPLAIN],")"),!0),t.comparatorTrimReplace="$1$2$3",u("HYPHENRANGE","^\\s*(".concat(a[o.XRANGEPLAIN],")")+"\\s+-\\s+"+"(".concat(a[o.XRANGEPLAIN],")")+"\\s*$"),u("HYPHENRANGELOOSE","^\\s*(".concat(a[o.XRANGEPLAINLOOSE],")")+"\\s+-\\s+"+"(".concat(a[o.XRANGEPLAINLOOSE],")")+"\\s*$"),u("STAR","(<|>)?=?\\s*\\*"),u("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),u("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(re$1,re$1.exports);var opts=["includePrerelease","loose","rtl"],parseOptions$1=function(e){return e?"object"!==_typeof$7(e)?{loose:!0}:opts.filter((function(t){return e[t]})).reduce((function(e,t){return e[t]=!0,e}),{}):{}},parseOptions_1=parseOptions$1,numeric=/^[0-9]+$/,compareIdentifiers$1=function(e,t){var r=numeric.test(e),n=numeric.test(t);return r&&n&&(e=+e,t=+t),e===t?0:r&&!n?-1:n&&!r?1:e<t?-1:1},rcompareIdentifiers=function(e,t){return compareIdentifiers$1(t,e)},identifiers={compareIdentifiers:compareIdentifiers$1,rcompareIdentifiers:rcompareIdentifiers},debug=debug_1,MAX_LENGTH=constants.MAX_LENGTH,MAX_SAFE_INTEGER=constants.MAX_SAFE_INTEGER,re=re$1.exports.re,t=re$1.exports.t,parseOptions=parseOptions_1,compareIdentifiers=identifiers.compareIdentifiers,SemVer$1=function(){function e(r,n){if(_classCallCheck$8(this,e),n=parseOptions(n),r instanceof e){if(r.loose===!!n.loose&&r.includePrerelease===!!n.includePrerelease)return r;r=r.version}else if("string"!=typeof r)throw new TypeError("Invalid Version: ".concat(r));if(r.length>MAX_LENGTH)throw new TypeError("version is longer than ".concat(MAX_LENGTH," characters"));debug("SemVer",r,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;var i=r.trim().match(n.loose?re[t.LOOSE]:re[t.FULL]);if(!i)throw new TypeError("Invalid Version: ".concat(r));if(this.raw=r,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>MAX_SAFE_INTEGER||this.major<0)throw new TypeError("Invalid major version");if(this.minor>MAX_SAFE_INTEGER||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>MAX_SAFE_INTEGER||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map((function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<MAX_SAFE_INTEGER)return t}return e})):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}return _createClass$9(e,[{key:"format",value:function(){return this.version="".concat(this.major,".").concat(this.minor,".").concat(this.patch),this.prerelease.length&&(this.version+="-".concat(this.prerelease.join("."))),this.version}},{key:"toString",value:function(){return this.version}},{key:"compare",value:function(t){if(debug("SemVer.compare",this.version,this.options,t),!(t instanceof e)){if("string"==typeof t&&t===this.version)return 0;t=new e(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}},{key:"compareMain",value:function(t){return t instanceof e||(t=new e(t,this.options)),compareIdentifiers(this.major,t.major)||compareIdentifiers(this.minor,t.minor)||compareIdentifiers(this.patch,t.patch)}},{key:"comparePre",value:function(t){if(t instanceof e||(t=new e(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;var r=0;do{var n=this.prerelease[r],i=t.prerelease[r];if(debug("prerelease compare",r,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return compareIdentifiers(n,i)}while(++r)}},{key:"compareBuild",value:function(t){t instanceof e||(t=new e(t,this.options));var r=0;do{var n=this.build[r],i=t.build[r];if(debug("prerelease compare",r,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return compareIdentifiers(n,i)}while(++r)}},{key:"inc",value:function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var r=this.prerelease.length;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);-1===r&&this.prerelease.push(0)}t&&(0===compareIdentifiers(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: ".concat(e))}return this.format(),this.raw=this.version,this}}]),e}(),semver=SemVer$1,SemVer=semver,compare$1=function(e,t,r){return new SemVer(e,r).compare(new SemVer(t,r))},compare_1=compare$1,compare=compare_1,gte=function(e,t,r){return compare(e,t,r)>=0},gte_1=gte,TO_NATIVE_API_NAME={v1:"byteview_live_bridge",v2:"lark_vc_live_bridge"},TO_WEB_API_NAME={v1:"byteview_live_event",v2:"lark_vc_live_bridge"},IsInLark=window.navigator.userAgent.indexOf("Lark")>-1,GapLarkVersion="5.1.0";function getLarkVersion(){var e,t,r;if(IsInLark){var n=null===(e=window)||void 0===e||null===(t=e.navigator)||void 0===t||null===(r=t.userAgent)||void 0===r?void 0:r.match(/ Lark\/(\d+\.\d+\.\d+)/i);if(n)return n[1]}}var EventName=function(e){return e.UNKNOWN_NATIVE_EVENT="UNKNOWN_NATIVE_EVENT",e.SWITCH_NORMAL_WINDOW="SWITCH_NORMAL_WINDOW",e.SWITCH_MINI_WINDOW="SWITCH_MINI_WINDOW",e}(EventName||{}),CallNativeEvent=function(e){return e[e.Unknown=0]="Unknown",e[e.LiveReady=1]="LiveReady",e[e.LiveStart=2]="LiveStart",e[e.LivePause=3]="LivePause",e[e.LiveEnd=4]="LiveEnd",e[e.LiveError=5]="LiveError",e[e.LiveMuted=6]="LiveMuted",e[e.LiveStreamChange=7]="LiveStreamChange",e[e.DanmakuChange=8]="DanmakuChange",e[e.JsReady=9]="JsReady",e}(CallNativeEvent||{}),CallWebEvent=function(e){return e[e.Unknown=0]="Unknown",e[e.SwitchNormalMode=1]="SwitchNormalMode",e[e.SwitchMiniMode=2]="SwitchMiniMode",e[e.ContainerModeChange=3]="ContainerModeChange",e}(CallWebEvent||{}),ContainerMode=function(e){return e[e.Unknown=0]="Unknown",e[e.Normal=1]="Normal",e[e.Mini=2]="Mini",e}(ContainerMode||{}),LarkJsBridge=function(){function e(){var t=this;_classCallCheck$8(this,e),this.emitter=new eventemitter3.exports.EventEmitter,this.currentHost="",this.currentLarkVersion="",this.currentLiveId="",this.isInAndroid=!1,this.isInIOS=!1,this.isInLark=!1,this.isInitialized=!1,this.useV2=!1,this.handleContainerModeChange=function(e,r){var n,i;switch(e){case CallWebEvent.SwitchMiniMode:i=EventName.SWITCH_MINI_WINDOW;break;case CallWebEvent.SwitchNormalMode:i=EventName.SWITCH_NORMAL_WINDOW;break;case CallWebEvent.ContainerModeChange:i=(null==r||null===(n=r.params)||void 0===n?void 0:n.mode)===ContainerMode.Normal?EventName.SWITCH_NORMAL_WINDOW:EventName.SWITCH_MINI_WINDOW;break;default:i=EventName.SWITCH_NORMAL_WINDOW}window.addEventListener("resize",(function e(){t.emitter.emit(i,r),window.removeEventListener("resize",e)}))},this.init()}return _createClass$9(e,[{key:"init",value:function(e){this.initVariables(e),this.initNativeCallWebCallback()}},{key:"initVariables",value:function(e){if(console.log(IsInLark),IsInLark){var t,r=null!==(t=null==e?void 0:e.liveId)&&void 0!==t?t:"";if(this.isInitialized)return void(this.currentLiveId=r);var n=getLarkVersion();this.currentLiveId=r,this.currentHost="https://".concat(window.location.host),this.currentLarkVersion=null!=n?n:"0.0.0",this.isInAndroid=!!sniffer$1.os.isAndroid,this.isInIOS=!!sniffer$1.os.isIos,this.isInLark=IsInLark&&"mobile"===sniffer$1.device,this.useV2=gte_1(this.currentLarkVersion,GapLarkVersion)}}},{key:"initNativeCallWebCallback",value:function(){var e=this;this.isInLark&&(this.isInitialized||(this.isInitialized=!0,window.LarkWebViewJavaScriptBridge=window.LarkWebViewJavaScriptBridge||{nativeCallBack:function(t){var r=t.callbackID,n=void 0===r?"":r,i=t.data,a=void 0===i?{}:i;if([TO_WEB_API_NAME.v1,TO_WEB_API_NAME.v2].includes(n)){var o=a.live_event,s=void 0===o?CallWebEvent.Unknown:o;s&&e.callWebHandler(s,a)}}}))}},{key:"callWebHandler",value:function(e,t){switch(e){case CallWebEvent.SwitchNormalMode:case CallWebEvent.SwitchMiniMode:case CallWebEvent.ContainerModeChange:this.handleContainerModeChange(e,t)}}},{key:"genTransferNativeData",value:function(e,t){return this.useV2?this.generateCallNativeDataV2(e,t):this.generateCallNativeDataV1(e,t)}},{key:"generateCallNativeDataV1",value:function(e,t){if(this.currentLiveId)return{apiName:TO_NATIVE_API_NAME.v1,data:{live_host:this.currentHost,live_id:this.currentLiveId,stream_link:t.stream_link,live_action:e,muted:t.muted,danmaku_active:t.danmaku_active}}}},{key:"generateCallNativeDataV2",value:function(e,t){return{apiName:TO_NATIVE_API_NAME.v2,callbackID:TO_NATIVE_API_NAME.v2,data:{live_event:e,version:this.currentLarkVersion,params:_objectSpread2$7({live_host:this.currentHost},t)},extra:"v2"}}},{key:"postMessage",value:function(e,t){if(this.isInLark&&(this.isInAndroid||this.isInIOS)){var r=this.genTransferNativeData(e,t);if(r){var n,i,a,o,s,u,c;if(this.isInIOS)null===(n=window)||void 0===n||null===(i=n.webkit)||void 0===i||null===(a=i.messageHandlers)||void 0===a||null===(o=a.invokeNative)||void 0===o||o.postMessage(r);if(this.isInAndroid)null===(s=window)||void 0===s||null===(u=s.Lark_Bridge)||void 0===u||null===(c=u.invokeNative)||void 0===c||c.call(u,JSON.stringify(r))}}}},{key:"addEventListener",value:function(e,t){this.emitter.addListener(e,t)}},{key:"removeEventListener",value:function(e,t){this.emitter.removeListener(e,t)}},{key:"destroy",value:function(){this.emitter.removeAllListeners()}}]),e}(),NativeWindowPlugin=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){var e;return _classCallCheck$8(this,r),(e=t.apply(this,arguments)).isFirstLoad=!0,e.larkJsBridge=new LarkJsBridge,e.handleReady=function(){e.postMessage(CallNativeEvent.LiveReady)},e.handlePlay=function(){e.postMessage(CallNativeEvent.LiveStart)},e.handlePause=function(){e.postMessage(CallNativeEvent.LivePause)},e.handleError=function(){e.postMessage(CallNativeEvent.LiveError)},e.handleMuted=function(){e.postMessage(CallNativeEvent.LiveMuted)},e.handleDanmakuChange=function(){e.postMessage(CallNativeEvent.DanmakuChange)},e.handleLoadedData=function(){e.isFirstLoad?e.isFirstLoad=!1:e.postMessage(CallNativeEvent.LiveStreamChange)},e.handleMiniMode=function(){e.player&&(e.handleDanmaku(!1),e.player.root&&util$2.addClass(e.player.root,"xgplayer-mini-mode"),e.player.emit(PluginEvents.LARKWINDOW_CHANGE,!0))},e.handleNormalMode=function(){e.player&&(e.handleDanmaku(!0),e.player.root&&util$2.removeClass(e.player.root,"xgplayer-mini-mode"),e.player.emit(PluginEvents.LARKWINDOW_CHANGE,!1))},e}return _createClass$9(r,[{key:"afterCreate",value:function(){var e,t,r;null===(e=this.larkJsBridge)||void 0===e||e.postMessage(CallNativeEvent.JsReady,{}),this.player&&(this.player.on("ready",this.handleReady),this.player.on("play",this.handlePlay),this.player.on("pause",this.handlePause),this.player.on("error",this.handleError),this.player.on("volumechange",this.handleMuted),this.player.on("danmaku_click",this.handleDanmakuChange),this.player.on("loadeddata",this.handleLoadedData),null===(t=this.larkJsBridge)||void 0===t||t.addEventListener(EventName.SWITCH_MINI_WINDOW,this.handleMiniMode),null===(r=this.larkJsBridge)||void 0===r||r.addEventListener(EventName.SWITCH_NORMAL_WINDOW,this.handleNormalMode))}},{key:"destroy",value:function(){var e,t,r,n;this.player.off("ready",this.handleReady),this.player.off("play",this.handlePlay),this.player.off("pause",this.handlePause),this.player.off("error",this.handleError),this.player.off("volumechange",this.handleMuted),this.player.off("danmaku_click",this.handleDanmakuChange),this.player.off("loadeddata",this.handleLoadedData),null===(e=this.larkJsBridge)||void 0===e||e.postMessage(CallNativeEvent.LiveEnd,{}),null===(t=this.larkJsBridge)||void 0===t||t.removeEventListener(EventName.SWITCH_MINI_WINDOW,this.handleMiniMode),null===(r=this.larkJsBridge)||void 0===r||r.removeEventListener(EventName.SWITCH_NORMAL_WINDOW,this.handleNormalMode),null===(n=this.larkJsBridge)||void 0===n||n.destroy()}},{key:"postMessage",value:function(e,t){if(this.larkJsBridge){var r,n,i,a,o=this.player.config.url||"",s={stream_link:null!=o&&o.startsWith("https:")?o:"https:".concat(o),muted:this.player.muted,danmaku_active:null!==(r=null===(n=this.player)||void 0===n||null===(i=n.plugins)||void 0===i||null===(a=i.danmu)||void 0===a?void 0:a.isOpen)&&void 0!==r&&r};this.larkJsBridge.postMessage(e,_objectSpread2$7(_objectSpread2$7({},s),t))}}},{key:"handleDanmaku",value:function(e){var t=this;this.player&&this.player.danmu&&e&&setTimeout((function(){var e,r;null===(e=(r=t.player.danmu).resize)||void 0===e||e.call(r)}),300)}}],[{key:"pluginName",get:function(){return"nativeWindowPlugin"}}]),r}(BasePlugin);function GetMirrorSvg(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M8.5 0.199997C8.5 0.0895386 8.5896 0 8.69995 0H9.30005C9.4104 0 9.5 0.0895386 9.5 0.199997V1.8C9.5 1.91046 9.4104 2 9.30005 2H8.69995C8.5896 2 8.5 1.91046 8.5 1.8V0.199997Z" fill="white"/>\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M0 1.95424C0 1.85173 0.0773926 1.76582 0.179443 1.75529L7.27954 1.02277C7.34546 1.01596 7.40649 1.04182 7.44751 1.08664C7.47998 1.12207 7.5 1.16936 7.5 1.22171V14.7783C7.5 14.8969 7.39746 14.9894 7.27954 14.9773L0.179443 14.2447C0.0773926 14.2342 0 14.1483 0 14.0458V1.95424ZM1.5 12.873V3.12701L6 2.66273V13.3373L1.5 12.873Z" fill="white"/>\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M18 1.95424C18 1.85173 17.9226 1.76582 17.8206 1.75529L10.7205 1.02277C10.6025 1.01059 10.5 1.10313 10.5 1.22171V14.7783C10.5 14.8969 10.6025 14.9894 10.7205 14.9773L17.8206 14.2447C17.9226 14.2342 18 14.1483 18 14.0458V1.95424ZM16.5 3.12701L12 2.66273V13.3373L16.5 12.873V3.12701Z" fill="white"/>\n    <path d="M8.69995 3C8.5896 3 8.5 3.08954 8.5 3.2V4.8C8.5 4.91046 8.5896 5 8.69995 5H9.30005C9.32642 5 9.35156 4.9949 9.37451 4.98564C9.39111 4.97896 9.40674 4.97011 9.4209 4.95944C9.46899 4.92293 9.5 4.8651 9.5 4.8V3.2C9.5 3.14664 9.47925 3.09818 9.44507 3.06232C9.40869 3.02393 9.35718 3 9.30005 3H8.69995Z" fill="white"/>\n    <path d="M8.5 6.2C8.5 6.08954 8.5896 6 8.69995 6H9.30005C9.34277 6 9.38232 6.01344 9.41479 6.03635C9.46631 6.07254 9.5 6.13234 9.5 6.2V7.8C9.5 7.85072 9.48096 7.89703 9.44995 7.9323C9.41821 7.96826 9.37354 7.99272 9.32373 7.99861C9.31592 7.99953 9.30811 8 9.30005 8H8.69995C8.5896 8 8.5 7.91046 8.5 7.8V6.2Z" fill="white"/>\n    <path d="M8.53711 9.08395C8.51367 9.11667 8.5 9.15674 8.5 9.20001V10.8C8.5 10.9105 8.5896 11 8.69995 11H9.30005C9.4104 11 9.5 10.9105 9.5 10.8V9.20001C9.5 9.08954 9.4104 9 9.30005 9H8.69995C8.68384 9 8.66821 9.00189 8.65332 9.00546C8.60571 9.01688 8.5647 9.04529 8.53711 9.08395Z" fill="white"/>\n    <path d="M8.5 12.2C8.5 12.1371 8.52905 12.081 8.57446 12.0443C8.60864 12.0166 8.65234 12 8.69995 12H9.30005C9.4104 12 9.5 12.0895 9.5 12.2V13.8C9.5 13.8664 9.46753 13.9253 9.41772 13.9616C9.38477 13.9857 9.34399 14 9.30005 14H8.69995C8.5896 14 8.5 13.9105 8.5 13.8V12.2Z" fill="white"/>\n    <path d="M8.69995 15C8.5896 15 8.5 15.0895 8.5 15.2V15.8C8.5 15.9105 8.5896 16 8.69995 16H9.30005C9.4104 16 9.5 15.9105 9.5 15.8V15.2C9.5 15.0895 9.4104 15 9.30005 15H8.69995Z" fill="white"/>\n</svg>\n',"image/svg+xml").firstChild}function ExitMirrorSvg(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M8.5 0.2C8.5 0.0895431 8.58954 0 8.7 0H9.3C9.41046 0 9.5 0.0895431 9.5 0.2V1.8C9.5 1.91046 9.41046 2 9.3 2H8.7C8.58954 2 8.5 1.91046 8.5 1.8V0.2Z" fill="white"/>\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M0 1.95424C0 1.85173 0.0775055 1.76582 0.179474 1.7553L7.27947 1.02276C7.39742 1.01059 7.5 1.10313 7.5 1.2217V14.7783C7.5 14.8969 7.39742 14.9894 7.27947 14.9773L0.179474 14.2447C0.0775053 14.2342 0 14.1483 0 14.0458V1.95424ZM1.5 12.873V3.12702L6 2.66273V13.3373L1.5 12.873Z" fill="white"/>\n    <path d="M17.8205 1.7553C17.9225 1.76582 18 1.85173 18 1.95424V14.0458C18 14.1483 17.9225 14.2342 17.8205 14.2447L10.7205 14.9773C10.6026 14.9894 10.5 14.8969 10.5 14.7783V1.2217C10.5 1.10313 10.6026 1.01059 10.7205 1.02276L17.8205 1.7553Z" fill="white"/>\n    <path d="M8.7 3C8.58954 3 8.5 3.08954 8.5 3.2V4.8C8.5 4.91046 8.58954 5 8.7 5H9.3C9.41046 5 9.5 4.91046 9.5 4.8V3.2C9.5 3.08954 9.41046 3 9.3 3H8.7Z" fill="white"/>\n    <path d="M8.5 6.2C8.5 6.08954 8.58954 6 8.7 6H9.3C9.41046 6 9.5 6.08954 9.5 6.2V7.8C9.5 7.91046 9.41046 8 9.3 8H8.7C8.58954 8 8.5 7.91046 8.5 7.8V6.2Z" fill="white"/>\n    <path d="M8.7 9C8.58954 9 8.5 9.08954 8.5 9.2V10.8C8.5 10.9105 8.58954 11 8.7 11H9.3C9.41046 11 9.5 10.9105 9.5 10.8V9.2C9.5 9.08954 9.41046 9 9.3 9H8.7Z" fill="white"/>\n    <path d="M8.5 12.2C8.5 12.0895 8.58954 12 8.7 12H9.3C9.41046 12 9.5 12.0895 9.5 12.2V13.8C9.5 13.9105 9.41046 14 9.3 14H8.7C8.58954 14 8.5 13.9105 8.5 13.8V12.2Z" fill="white"/>\n    <path d="M8.7 15C8.58954 15 8.5 15.0895 8.5 15.2V15.8C8.5 15.9105 8.58954 16 8.7 16H9.3C9.41046 16 9.5 15.9105 9.5 15.8V15.2C9.5 15.0895 9.41046 15 9.3 15H8.7Z" fill="white"/>\n</svg>\n',"image/svg+xml").firstChild}var POSITIONS=Plugin.POSITIONS,MirrorStateKeys={GetMirror:"getMirror",ExitMirror:"exitMirror"},MirrorPlugin=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),(n=t.call(this,e)).isEnableMirror=!0,n.isEnableMirror=n.config.defaultEnable,n}return _createClass$9(r,[{key:"afterCreate",value:function(){this.config.disable||(this.initIcons(),this.btnClick=this.btnClick.bind(this),this.bind(["touchend","click"],this.btnClick),this.updateMirrorState(this.isEnableMirror))}},{key:"registerIcons",value:function(){var e;return _defineProperty$9(e={},MirrorStateKeys.GetMirror,{icon:GetMirrorSvg,class:"xg-get-mirror"}),_defineProperty$9(e,MirrorStateKeys.ExitMirror,{icon:ExitMirrorSvg,class:"xg-exit-mirror"}),e}},{key:"initIcons",value:function(){var e=this.icons,t=this.find(".xgplayer-icon");t.appendChild(e[MirrorStateKeys.GetMirror]),t.appendChild(e[MirrorStateKeys.ExitMirror])}},{key:"registerLanguageTexts",value:function(){return{getMirror:{jp:"ãƒŸãƒ©ãƒ¼ã‚’é–‹ã",en:"Turn on mirroring",zh:"å¼€å¯é•œåƒ","zh-hk":"é–‹å•Ÿé¡åƒ"},exitMirror:{jp:"ãƒŸãƒ©ãƒ¼ã‚’é–‰ã˜ã‚‹",en:"Turn off mirroring",zh:"å…³é—­é•œåƒ","zh-hk":"é—œé–‰é¡åƒ"}}}},{key:"btnClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.isEnableMirror?this.action(!1):this.action(!0)}},{key:"action",value:function(e){this.isEnableMirror=e,this.updateMirrorState(this.isEnableMirror),this.player.emit(PluginEvents.MIRROR_CHANGE,this.isEnableMirror)}},{key:"updateMirrorState",value:function(e){var t=this.player;e?t.addClass("xgplayer-mirror"):t.removeClass("xgplayer-mirror"),this.animate(e)}},{key:"animate",value:function(e){this.root&&(e?this.setAttr("data-state","enable"):this.setAttr("data-state","normal"),this.switchTips(e))}},{key:"switchTips",value:function(e){this.changeLangTextKey(this.find(".xg-tips"),e?MirrorStateKeys.ExitMirror:MirrorStateKeys.GetMirror)}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class=\'xgplayer-mirror-icon\'>\n    <div class="xgplayer-icon">\n    </div>\n    <div class="xg-tips" lang-key="mirror">'.concat(this.langText[MirrorStateKeys.GetMirror],"</div>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"mirrorPlugin"}},{key:"defaultConfig",get:function(){return{position:POSITIONS.CONTROLS_RIGHT,index:CONTROL_ICON_INDEX.mirrorPlugin,disable:!1,defaultEnable:!1}}}]),r}(Plugin);function retPromise(e){return e&&e.then?e:new Promise((function(t){t(e)}))}var MemoryPlay=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(e){var n;return _classCallCheck$8(this,r),(n=t.call(this,e)).memoryId="",n.canJump=!1,n.saveTimeFun=util$2.checkIsFunction(n.config.saveTime)?n.config.saveTime:n.saveTimeByStorage,n.getTimeFun=util$2.checkIsFunction(n.config.getTime)?n.config.getTime:n.getTimeByStorage,n.startTime=0,n.memoryId=n.config.memoryId,n.showToast=n.showToast.bind(_assertThisInitialized$8(n)),n}return _createClass$9(r,[{key:"registerLanguageTexts",value:function(){return{preText:{jp:"ã«ä½ç½®ä»˜ã‘ã‚‰ã‚Œã¾ã—ãŸ",en:"Has located for you to ",zh:"å·²ä¸ºæ‚¨å®šä½è‡³","zh-hk":"å·²ç‚ºæ‚¨å®šä½è‡³"}}}},{key:"children",value:function(){return{toast:ToastPlugin}}},{key:"afterCreate",value:function(){this.once(CANPLAY,this.showToast)}},{key:"beforePlayerInit",value:function(){return this.memoryId||(this.playerConfig.vid?this.memoryId=this.playerConfig.vid:this.player.url&&(this.memoryId=this.player.url.replace(/\?.*$/,""))),this.setSave(),this.getTime()}},{key:"destroy",value:function(){0!==this.player.currentTime&&this.player.currentTime!==this.player.duration&&this.saveTimeFun(this.memoryId,this.player.currentTime)}},{key:"getTime",value:function(){var e=this;return new Promise((function(t){retPromise(e.getTimeFun(e.memoryId)).then((function(r){var n=parseFloat(r);isNaN(n)||0===n?console.warn("the time got is invalid",r):(e.startTime=n,e.canJump=!0,e.playerConfig.startTime=e.startTime,"mobile"===sniffer$1.device&&e.player.once("canplay",(function(){e.player.currentTime=e.startTime}))),t()})).catch((function(e){console.error("getTime function occur error",e),t()}))}))}},{key:"setSave",value:function(){var e=this;document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&0!==e.player.currentTime&&e.player.currentTime!==e.player.duration&&e.saveTimeFun(e.memoryId,e.player.currentTime)})),document.addEventListener("pagehide",(function(){0!==e.player.currentTime&&e.player.currentTime!==e.player.duration&&e.saveTimeFun(e.memoryId,e.player.currentTime)})),window.addEventListener("beforeunload",(function(){0!==e.player.currentTime&&e.player.currentTime!==e.player.duration&&e.saveTimeFun(e.memoryId,e.player.currentTime)}))}},{key:"showToast",value:function(){if(this.canJump){var e,t=null===(e=this.player)||void 0===e?void 0:e.getPlugin("sdkToastPlugin");if(!t)return;var r=util$2.format(this.startTime);t.add("".concat(this.langText.preText).concat(r),4e3,!0)}}},{key:"saveTimeByStorage",value:function(e,t){localStorage.setItem(e,t)}},{key:"getTimeByStorage",value:function(e){return localStorage.getItem(e)}}],[{key:"pluginName",get:function(){return"memoryPlay"}},{key:"defaultConfig",get:function(){return{getTime:null,saveTime:null,memoryId:""}}}]),r}(Plugin),LiveInfoPanel=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){var e;return _classCallCheck$8(this,r),(e=t.apply(this,arguments))._infoItems=[],e}return _createClass$9(r,[{key:"streamType",get:function(){return this.playerConfig.playerData.getCurrentStreamType()}},{key:"afterCreate",value:function(){var e=this;["flv","hls"].includes(this.streamType)?(this.player.on("error",(function(){return e._handleError()})),this.player.on("loadeddata",(function(){return e._handleLoadedData()}))):this.close()}},{key:"registerLanguageTexts",value:function(){return{DECODEFPS:{en:"decodeFps",zh:"è§£ç æ•ˆçŽ‡"},DECODECOST:{en:"decodeCost",zh:"è§£ç æ¶ˆè€—"},FORMAT:{en:"format",zh:"æ ¼å¼"},FPS:{en:"fps",zh:"å¸§çŽ‡"},BITRATE:{en:"birate",zh:"ç çŽ‡"},GOP:{en:"GOP",zh:"GOP"},RESOLUTION:{en:"resolution",zh:"åˆ†è¾¨çŽ‡"},DECODETYPE:{en:"decodeType",zh:"ç¼–ç æ–¹å¼"},BUFFEREND:{en:"bufferEnd",zh:"bufferæ°´ä½"},CURRENTTIME:{en:"currentTime",zh:"æ’­æ”¾è¿›åº¦"}}}},{key:"_getDefaultInfo",value:function(e){var t={h265Title:{key:"h265Title",label:"H265è§£ç ",type:"title"},decodeEfficiency:{key:"decodeEfficiency",label:"è§£ç æ•ˆçŽ‡",labelTextKey:"DECODEFPS",value:e.decodeFps,render:function(e){return e+"frames/s"}},decodeCost:{key:"decodeCost",label:"è§£ç æ¶ˆè€—",labelTextKey:"DECODECOST",value:e.decodeFps,render:function(e){return e?(1e3/e).toFixed()+"ms":""}}};return _objectSpread2$7({format:{key:"format",label:"æ ¼å¼",labelTextKey:"FORMAT",value:e.format},framerate:{key:"framerate",label:"å¸§çŽ‡",labelTextKey:"FPS",value:e.fps,render:function(e){return"".concat(e," fps")}},bitrate:{key:"bitrate",label:"ç çŽ‡",labelTextKey:"BITRATE",value:e.bitrate,render:function(e){return"".concat(e/1e3," kbps")}},gop:{key:"gop",label:"GOP",labelTextKey:"GOP",value:e.gop,render:function(e){return"".concat(e," frames")}},resolution:{key:"resolution",label:"è§†é¢‘åˆ†è¾¨çŽ‡",labelTextKey:"RESOLUTION",value:{width:e.width,height:e.height},render:function(e){return"".concat(e.width," * ").concat(e.height)}},encodeType:{key:"encodeType",label:"ç¼–ç æ–¹å¼",labelTextKey:"DECODETYPE",value:e.encodeType},bufferEnd:{key:"bufferEnd",label:"bufferæ°´ä½",labelTextKey:"BUFFEREND",value:e.bufferEnd},currentTime:{key:"currentTime",label:"æ’­æ”¾è¿›åº¦",labelTextKey:"CURRENTTIME",value:e.currentTime,render:function(e){return e?e.toFixed(6)+"s":""}}},e.isOpenSoftDecoding&&this.config.showH265Info?t:{})}},{key:"_init",value:function(){var e=this,t=this._initDom(this._getInfoListData());this._infoItems=new Proxy(t,{set:function(t,r,n){return e._updateDom(t[r].dom,n),Reflect.set(t,r,n)}}),this._tick()}},{key:"_getStats",value:function(){var e,t;return"flv"===this.streamType?null===(e=this.player.plugins.flv)||void 0===e?void 0:e.getStats():"hls"===this.streamType?null===(t=this.player.plugins.hls)||void 0===t?void 0:t.getStats():{}}},{key:"_getInfoListData",value:function(){var e=this._getStats()||{};return this._getDefaultInfo(Object.assign(e,{format:"".concat(this.streamType,"_live"),isOpenSoftDecoding:"live-video"==this.playerConfig.mediaType}))}},{key:"_initDom",value:function(e){var t=this,r=this.find(".veplayer-livepanel-container");return r.innerHTML="",Object.values(e).forEach((function(e){var n=util$2.createDom("veplayer-livepanel-div","",void 0,"veplayer-livepanel-container-row");"title"===e.type?t._updateTitle(n,e):t._updateDom(n,e),r.appendChild(n),e.dom=n})),e}},{key:"_updateTitle",value:function(e,t){e.innerHTML="";var r=util$2.createDom("veplayer-livepanel-span",t.label,void 0,"veplayer-livepanel-container-row-title");e.appendChild(r)}},{key:"_updateDom",value:function(e,t){e.innerHTML="";var r=util$2.createDom("veplayer-livepanel-span",this._renderLabel(t),void 0,"veplayer-livepanel-container-row-label");if(e.appendChild(r),"title"!==t.type){var n=util$2.createDom("veplayer-livepanel-span",this._renderValue(t));e.appendChild(n)}}},{key:"_renderLabel",value:function(e){return e.labelTextKey&&this.langText[e.labelTextKey]}},{key:"_renderValue",value:function(e){return e.render?e.render(e.value):e.value}},{key:"_handleDataChange",value:function(){var e=this,t=this._getInfoListData();Object.values(this._infoItems).forEach((function(r){"title"!==r.type&&e._renderValue(r)!==e._renderValue(t[r.key])&&(e._infoItems[r.key]=_objectSpread2$7(_objectSpread2$7({},r),t[r.key]))}))}},{key:"_tick",value:function(){var e=this;this._pollTimer=setTimeout((function(){clearTimeout(e._pollTimer),e._poll(),e._tick()}),500)}},{key:"_poll",value:function(){this._handleDataChange()}},{key:"destroy",value:function(){clearTimeout(this._pollTimer)}},{key:"_handleError",value:function(){this._close()}},{key:"_handleLoadedData",value:function(){this.config.visible&&this._open()}},{key:"_open",value:function(){var e=this.find(".veplayer-livepanel-container");util$2.removeClass(e,"veplayer-livepanel-hidden"),this._init()}},{key:"_close",value:function(){var e=this.find(".veplayer-livepanel-container");util$2.addClass(e,"veplayer-livepanel-hidden"),clearTimeout(this._pollTimer)}},{key:"open",value:function(){this._open(),this.config.visible=!0}},{key:"close",value:function(){this._close(),this.config.visible=!1}},{key:"render",value:function(){return'\n    <xg-livepanel class="xgplayer-livepanel">\n        <xg-livepanel-container class="veplayer-livepanel-container '.concat(!this.config.visible&&"veplayer-livepanel-hidden",'">\n    </xg-livepanel-container></xg-livepanel>\n    ')}}],[{key:"pluginName",get:function(){return"LiveInfoPanel"}},{key:"defaultConfig",get:function(){return{visible:!0,showH265Info:!1}}}]),r}(Plugin),VePlayerUmd=function(e){_inherits$8(r,e);var t=_createSuper$u(r);function r(){return _classCallCheck$8(this,r),t.apply(this,arguments)}return _createClass$9(r)}(VePlayer);return VePlayerUmd.LiveSubtitlesIconPlugin=LiveSubtitlesIconPlugin,VePlayerUmd.LiveSubtitlesPlugin=LiveSubTitlesPlugin,VePlayerUmd.DefinitionDemotePlugin=DefinitionDemotePlugin,VePlayerUmd.TimeShiftPlugin=TimeShiftPlugin,VePlayerUmd.LarkWindowPlugin=NativeWindowPlugin,VePlayerUmd.MirrorPlugin=MirrorPlugin,VePlayerUmd.MemoryPlay=MemoryPlay,VePlayerUmd.Subtitle=Subtitle,VePlayerUmd.Service=dist,VePlayerUmd.LiveInfoPanel=LiveInfoPanel,VePlayerUmd.Event=Event$2,VePlayerUmd.getI18N=getI18N,VePlayerUmd}));